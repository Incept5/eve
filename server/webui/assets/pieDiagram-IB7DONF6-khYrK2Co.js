import{p as U}from"./chunk-4BMEZGHF-Cy7lSkGa.js";import{aa as y,a2 as z,aF as j,C as H,n as Z,o as q,s as J,g as K,c as Q,b as X,_ as p,l as F,t as Y,d as tt,D as et,H as at,O as rt,k as nt}from"./index-DBKEda1c.js";import{p as it}from"./radar-MK3ICKWK-CmH-akLr.js";import{d as P}from"./arc-Ht8zY-Yg.js";import{o as st}from"./ordinal-Cboi1Yqb.js";import"./_baseUniq-CHQvu4t-.js";import"./_basePickBy-SSxHVhEw.js";import"./clone-Coe7xGcN.js";import"./init-Gi6I4Gst.js";function ot(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function lt(t){return t}function ct(){var t=lt,e=ot,a=null,n=y(0),i=y(z),r=y(0);function o(o){var l,s,p,c,d,u=(o=j(o)).length,f=0,g=new Array(u),h=new Array(u),m=+n.apply(this,arguments),y=Math.min(z,Math.max(-z,i.apply(this,arguments)-m)),x=Math.min(Math.abs(y)/u,r.apply(this,arguments)),S=x*(y<0?-1:1);for(l=0;l<u;++l)(d=h[g[l]=l]=+t(o[l],l,o))>0&&(f+=d);for(null!=e?g.sort((function(t,a){return e(h[t],h[a])})):null!=a&&g.sort((function(t,e){return a(o[t],o[e])})),l=0,p=f?(y-u*S)/f:0;l<u;++l,m=c)s=g[l],c=m+((d=h[s])>0?d*p:0)+S,h[s]={data:o[s],index:l,value:d,startAngle:m,endAngle:c,padAngle:x};return h}return o.value=function(e){return arguments.length?(t="function"==typeof e?e:y(+e),o):t},o.sortValues=function(t){return arguments.length?(e=t,a=null,o):e},o.sort=function(t){return arguments.length?(a=t,e=null,o):a},o.startAngle=function(t){return arguments.length?(n="function"==typeof t?t:y(+t),o):n},o.endAngle=function(t){return arguments.length?(i="function"==typeof t?t:y(+t),o):i},o.padAngle=function(t){return arguments.length?(r="function"==typeof t?t:y(+t),o):r},o}var R=H.pie,G={sections:new Map,showData:!1,config:R},b=G.sections,O=G.showData,ut=structuredClone(R),pt=p((()=>structuredClone(ut)),"getConfig"),gt=p((()=>{b=new Map,O=G.showData,Y()}),"clear"),dt=p((({label:t,value:e})=>{b.has(t)||(b.set(t,e),F.debug(`added new section: ${t}, with value: ${e}`))}),"addSection"),ft=p((()=>b),"getSections"),mt=p((t=>{O=t}),"setShowData"),ht=p((()=>O),"getShowData"),I={getConfig:pt,clear:gt,setDiagramTitle:Z,getDiagramTitle:q,setAccTitle:J,getAccTitle:K,setAccDescription:Q,getAccDescription:X,addSection:dt,getSections:ft,setShowData:mt,getShowData:ht},vt=p(((t,e)=>{U(t,e),e.setShowData(t.showData),t.sections.map(e.addSection)}),"populateDb"),St={parse:p((async t=>{const e=await it("pie",t);F.debug(e),vt(e,I)}),"parse")},yt=p((t=>`\n  .pieCircle{\n    stroke: ${t.pieStrokeColor};\n    stroke-width : ${t.pieStrokeWidth};\n    opacity : ${t.pieOpacity};\n  }\n  .pieOuterCircle{\n    stroke: ${t.pieOuterStrokeColor};\n    stroke-width: ${t.pieOuterStrokeWidth};\n    fill: none;\n  }\n  .pieTitleText {\n    text-anchor: middle;\n    font-size: ${t.pieTitleTextSize};\n    fill: ${t.pieTitleTextColor};\n    font-family: ${t.fontFamily};\n  }\n  .slice {\n    font-family: ${t.fontFamily};\n    fill: ${t.pieSectionTextColor};\n    font-size:${t.pieSectionTextSize};\n    // fill: white;\n  }\n  .legend text {\n    fill: ${t.pieLegendTextColor};\n    font-family: ${t.fontFamily};\n    font-size: ${t.pieLegendTextSize};\n  }\n`),"getStyles"),xt=yt,At=p((t=>{const e=[...t.entries()].map((t=>({label:t[0],value:t[1]}))).sort(((t,e)=>e.value-t.value));return ct().value((t=>t.value))(e)}),"createPieArcs"),wt=p(((t,e,a,n)=>{F.debug("rendering pie chart\n"+t);const i=n.db,r=tt(),o=et(i.getConfig(),r.pie),l=18,s=450,p=s,c=at(e),d=c.append("g");d.attr("transform","translate(225,225)");const{themeVariables:u}=r;let[f]=rt(u.pieOuterStrokeWidth);f??(f=2);const g=o.textPosition,h=Math.min(p,s)/2-40,m=P().innerRadius(0).outerRadius(h),y=P().innerRadius(h*g).outerRadius(h*g);d.append("circle").attr("cx",0).attr("cy",0).attr("r",h+f/2).attr("class","pieOuterCircle");const x=i.getSections(),S=At(x),w=[u.pie1,u.pie2,u.pie3,u.pie4,u.pie5,u.pie6,u.pie7,u.pie8,u.pie9,u.pie10,u.pie11,u.pie12],C=st(w);d.selectAll("mySlices").data(S).enter().append("path").attr("d",m).attr("fill",(t=>C(t.data.label))).attr("class","pieCircle");let b=0;x.forEach((t=>{b+=t})),d.selectAll("mySlices").data(S).enter().append("text").text((t=>(t.data.value/b*100).toFixed(0)+"%")).attr("transform",(t=>"translate("+y.centroid(t)+")")).style("text-anchor","middle").attr("class","slice"),d.append("text").text(i.getDiagramTitle()).attr("x",0).attr("y",-200).attr("class","pieTitleText");const v=d.selectAll(".legend").data(C.domain()).enter().append("g").attr("class","legend").attr("transform",((t,e)=>"translate(216,"+(22*e-22*C.domain().length/2)+")"));v.append("rect").attr("width",l).attr("height",l).style("fill",C).style("stroke",C),v.data(S).append("text").attr("x",22).attr("y",14).text((t=>{const{label:e,value:a}=t.data;return i.getShowData()?`${e} [${a}]`:e}));const A=512+Math.max(...v.selectAll("text").nodes().map((t=>(null==t?void 0:t.getBoundingClientRect().width)??0)));c.attr("viewBox",`0 0 ${A} 450`),nt(c,s,A,o.useMaxWidth)}),"draw"),Ct={draw:wt},Gt={parser:St,db:I,renderer:Ct,styles:xt};export{Gt as diagram};