(()=>{var __webpack_modules__={160:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AnthropicModelClient=void 0;const n=r(9970),s=r(63118),i=r(72123),a=o(r(19055)),c=r(78695),l=r(81495);t.AnthropicModelClient=class{constructor(e){this.anthropic=new n.Anthropic({apiKey:e.apiKey}),this.modelId=e.modelId,this.transformer=new s.AnthropicMessageTransformer;const t=(0,i.createStateManager)(),r=(0,i.createPatternUtils)();this.streamProcessor=(0,i.createStreamProcessor)(t,r)}getModelId(){return this.modelId}getModelMetadata(){return this.modelMetadata?this.modelMetadata:{modelId:this.modelId,providerId:"anthropic",name:this.modelId,contextWindow:1e5,maxOutputTokens:4e3,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!0,supportsThinkingTokens:!0,supportsCancellation:!0,inputCostPerMillionTokens:8,outputCostPerMillionTokens:24}}setModelMetadata(e){this.modelMetadata=e}supportsCancellation(){return!0}async generateSimpleResponse(e,t,r={},o){a.default.info(`[AnthropicModelClient] Generating simple response for model: ${this.modelId}`),(0,l.validateSimpleResponseOptions)(r);const n=this.transformer.toProviderFormat(t),s=this.getModelMetadata(),i=r.maxTokens||s.maxOutputTokens,c=this.modelMetadata?.metadata?.extraHeaders||{},d=[{type:"text",text:e,cache_control:{type:"ephemeral"}}],u={model:this.modelId,system:d,messages:n,stream:!1,max_tokens:i,temperature:r.temperature,top_p:r.topP},p=await this.anthropic.messages.create(u,{signal:o,headers:{...c,"anthropic-beta":"prompt-caching-2024-07-31"}}),f=p.content.find((e=>"text"===e.type));return{content:f?.text||"",usage:{inputTokens:p.usage.input_tokens,outputTokens:p.usage.output_tokens,cacheReadTokens:p.usage.cache_read_input_tokens,cacheWriteTokens:p.usage.cache_creation_input_tokens},stopReason:(0,l.mapGenericStopReason)(p.stop_reason),finishReason:p.stop_reason||void 0,providerId:"anthropic",modelId:this.modelId,metadata:{model:p.model,stopSequence:p.stop_sequence,anthropicVersion:p.type}}}async*generateResponse(e,t,r,o){let n,s;a.default.info(`[AnthropicModelClient] Generating response for task ${r} with model ${this.modelId}`);try{n=this.transformer.toProviderFormat(t),n=this.transformer.applyPromptCaching(n);const i=this.modelMetadata?.metadata?.extraHeaders||{},l=this.getModelMetadata(),d=e.length>500?e.substring(0,500)+"...":e;a.default.info(`[AnthropicModelClient] System prompt for task ${r}: ${e.length} chars, preview: "${d.replace(/\n/g,"\\n")}"`),s=c.TokenEstimator.getDetailedTokenBreakdown(e,t,"anthropic"),a.default.info(`[AnthropicModelClient] Token breakdown for task ${r}:\n  System prompt: ${s.systemTokens} tokens\n  Messages: ${s.messageBreakdown.length} (${s.totalTokens-s.systemTokens} tokens)\n  Total estimated: ${s.totalTokens} tokens`);const u=c.TokenEstimator.calculateDynamicMaxTokens(e,t,l.contextWindow,l.maxOutputTokens,.15,"anthropic");a.default.info(`[AnthropicModelClient] Dynamic max tokens calculated: ${u} (Context Window: ${l.contextWindow}, Model Max Output: ${l.maxOutputTokens}, Estimated Input: ${s.totalTokens})`);const p=[{type:"text",text:e,cache_control:{type:"ephemeral"}}],f=await this.anthropic.messages.create({model:this.modelId,system:p,messages:n,max_tokens:u,stream:!0},{signal:o,headers:{...i,"anthropic-beta":"prompt-caching-2024-07-31"}}),h=this.streamProcessor.processStream(f,r,o);yield*async function*(e,t=10){const r={};let o=null;for await(const n of e){if("blockUpdate"!==n.type||!("appendContent"in n)||void 0===n.appendContent){o&&r[o]&&(yield{type:"blockUpdate",blockId:o,appendContent:r[o]},r[o]=""),yield n;continue}const{blockId:e,appendContent:s}=n;if(o&&o!==e&&r[o]&&(yield{type:"blockUpdate",blockId:o,appendContent:r[o]},r[o]=""),r[e]||(r[e]=""),s.length<t)r[e]+=s,r[e].length>=t&&(yield{type:"blockUpdate",blockId:e,appendContent:r[e]},r[e]="");else if(r[e]){const t=r[e]+s;yield{type:"blockUpdate",blockId:e,appendContent:t},r[e]=""}else yield n;o=e}for(const[e,t]of Object.entries(r))t&&(yield{type:"blockUpdate",blockId:e,appendContent:t})}(h,10)}catch(o){if(o.message&&o.message.includes("prompt is too long")){const i=o.message.match(/(\d+) tokens > (\d+) maximum/);if(i){const o=parseInt(i[1]),c=parseInt(i[2]),l=s?.totalTokens||"unknown";a.default.error(`[AnthropicModelClient] TOKEN COUNT MISMATCH for task ${r}:\n  Anthropic reported: ${o} tokens\n  Our estimate: ${l} tokens\n  Discrepancy: ${o-("number"==typeof l?l:0)} tokens\n  Context limit: ${c} tokens\n  System prompt size: ${e.length} chars\n  Message count: ${t.length}`);try{const t=JSON.stringify({model:this.modelId,system:[{type:"text",text:e,cache_control:{type:"ephemeral"}}],messages:n});a.default.error(`[AnthropicModelClient] Actual request payload: ${t.length} chars, ${n.length} transformed messages`)}catch(e){a.default.error(`[AnthropicModelClient] Could not serialize payload for debugging: ${e.message}`)}}}throw a.default.error(`[AnthropicModelClient] Error generating response: ${o.message}`,o.stack),o}}}},308:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FindFiles=void 0;const c=r(83153),l=r(11569),d=i(r(16928)),u=i(r(79896)),p=a(r(19055));class f extends c.Tool{static async main(e,t,r,o,n){p.default.info(`Starting find files search in workspace: ${e}`),p.default.info(`Parameters - startPath: ${t}, searchTerm: ${r}, fileExtensions: ${o}, max: ${n}`);const s=new f(e),i=await s._call({startPath:t,searchTerm:r,fileExtensions:o,max:n});return p.default.info("Find files search completed"),i}constructor(e){super(),this.name="find_files",this.description="Find all file paths in the repository that contain a given search term (case insensitive) in their names",this.schema=l.z.object({startPath:l.z.string().describe("The relative path under repo root to start search from (use '.' for entire repo)"),searchTerm:l.z.string().describe("Search term (case insensitive) or regex to match in the file names"),fileExtensions:l.z.string().optional().describe("Optional regex for file extensions to limit search to (e.g. '\\.(ts|js|java)$')"),max:l.z.number().optional().describe("Maximum number of files to return (optional, defaults to 50)")}),this.MAX_RESULTS=50,this.workspaceRootDir=e}async _call(e){try{const{startPath:t,searchTerm:r,fileExtensions:o,max:n}=e,s=d.resolve(this.workspaceRootDir,t),i=n||this.MAX_RESULTS,a=new RegExp(r,"i"),c=o?new RegExp(o):null,l=[];let f=!1;const h=e=>{if(l.length>=i)return void(f=!0);const t=u.readdirSync(e,{withFileTypes:!0});for(const r of t){if(l.length>=i){f=!0;break}const t=d.join(e,r.name);r.isDirectory()?h(t):r.isFile()&&a.test(r.name)&&(c&&!c.test(r.name)||l.push(d.relative(this.workspaceRootDir,t)))}};h(s);const m={matchingFiles:l};if(f){const e=`Stopped searching after finding ${i} files. There may be more matching files.`;p.default.info(e),m.warning=e}return p.default.info(`Found ${l.length} matching files`),JSON.stringify(m,null,2)}catch(e){throw p.default.error(`Error in find files search: ${e.message}`),new Error(`Error performing find files search: ${e.message}`)}}}t.FindFiles=f},376:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.DataSourceModule=void 0;const n=r(3563),s=r(72776);let i=class{};t.DataSourceModule=i,t.DataSourceModule=i=o([(0,n.Module)({providers:[{provide:s.AppDataSource,useFactory:s.getAppDataSource},{provide:"KNEX",useFactory:e=>e.knex,inject:[s.AppDataSource]}],exports:[s.AppDataSource,"KNEX"]})],i)},726:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CustomPersonaService=void 0;const c=r(3563),l=(r(31832),r(59100)),d=r(32398),u=r(56292),p=a(r(19055));let f=o=class{constructor(e,t,r){this.knex=e,this.toolProvider=t,this.personaRegistry=r,this.TABLE_NAME="eve_custom_personas",p.default.info(`[${o.name}] CustomPersonaService initialized`)}async create(e,t){p.default.debug(`[${o.name}] Creating custom persona: ${t.name} for user: ${e}`),this.validatePersonaName(t.name),this.validateSystemPrompt(t.systemPrompt),this.validateEnabledTools(t.enabledTools),await this.checkDuplicateName(e,t.name);const r=(0,l.ulid)(),n=new Date;let s={...t};if(t.copyFromPersonaId){p.default.debug(`[${o.name}] Copying from persona: ${t.copyFromPersonaId}`);const r=await this.getPersonaForCopy(t.copyFromPersonaId,e);s={name:t.name,systemPrompt:t.systemPrompt||r.systemPrompt,enabledTools:t.enabledTools.length>0?t.enabledTools:r.enabledTools,enabledOptionalComponents:t.enabledOptionalComponents||r.enabledOptionalComponents}}const i=s.enabledOptionalComponents||["general-agent-behavior","objective","workspace-files","user-rules"],a={id:r,userId:e,name:s.name,systemPrompt:s.systemPrompt,enabledTools:s.enabledTools,enabledOptionalComponents:i,isActive:!0,createdAt:n,updatedAt:n};try{return await this.knex(this.TABLE_NAME).insert({id:a.id,user_id:a.userId,name:a.name,system_prompt:a.systemPrompt,enabled_tools:JSON.stringify(a.enabledTools),enabled_optional_components:JSON.stringify(a.enabledOptionalComponents),is_active:a.isActive,created_at:a.createdAt,updated_at:a.updatedAt}),p.default.info(`[${o.name}] Created custom persona: ${a.name} (ID: ${a.id})`),this.entityToDto(a)}catch(e){throw p.default.error(`[${o.name}] Failed to create custom persona:`,e),new c.BadRequestException("Failed to create custom persona")}}async update(e,t,r){p.default.debug(`[${o.name}] Updating custom persona: ${e} for user: ${t}`);const n=await this.findById(e,t);if(!n)throw new c.NotFoundException("Custom persona not found");void 0!==r.name&&(this.validatePersonaName(r.name),r.name!==n.name&&await this.checkDuplicateName(t,r.name,e)),void 0!==r.systemPrompt&&this.validateSystemPrompt(r.systemPrompt),void 0!==r.enabledTools&&this.validateEnabledTools(r.enabledTools);const s={updated_at:new Date};void 0!==r.name&&(s.name=r.name),void 0!==r.systemPrompt&&(s.system_prompt=r.systemPrompt),void 0!==r.enabledTools&&(s.enabled_tools=JSON.stringify(r.enabledTools)),void 0!==r.enabledOptionalComponents&&(s.enabled_optional_components=JSON.stringify(r.enabledOptionalComponents)),void 0!==r.isActive&&(s.is_active=r.isActive);try{await this.knex(this.TABLE_NAME).where({id:e,user_id:t}).update(s),p.default.info(`[${o.name}] Updated custom persona: ${e}`);return await this.findById(e,t)}catch(e){throw p.default.error(`[${o.name}] Failed to update custom persona:`,e),new c.BadRequestException("Failed to update custom persona")}}async delete(e,t){p.default.debug(`[${o.name}] Deleting custom persona: ${e} for user: ${t}`);if(!await this.findById(e,t))throw new c.NotFoundException("Custom persona not found");try{if(0===await this.knex(this.TABLE_NAME).where({id:e,user_id:t}).del())throw new c.NotFoundException("Custom persona not found");p.default.info(`[${o.name}] Deleted custom persona: ${e}`)}catch(e){if(e instanceof c.NotFoundException)throw e;throw p.default.error(`[${o.name}] Failed to delete custom persona:`,e),new c.BadRequestException("Failed to delete custom persona")}}async findByUser(e){p.default.debug(`[${o.name}] Finding custom personas for user: ${e}`);try{const t=(await this.knex(this.TABLE_NAME).where({user_id:e,is_active:!0}).orderBy("created_at","desc")).map((e=>this.rowToEntity(e))).map((e=>this.entityToDto(e)));return p.default.debug(`[${o.name}] Found ${t.length} custom personas for user: ${e}`),t}catch(e){throw p.default.error(`[${o.name}] Failed to find custom personas for user:`,e),new c.BadRequestException("Failed to retrieve custom personas")}}async findById(e,t){p.default.debug(`[${o.name}] Finding custom persona by ID: ${e} for user: ${t}`);try{const r=await this.knex(this.TABLE_NAME).where({id:e,user_id:t,is_active:!0}).first();if(!r)return null;const o=this.rowToEntity(r);return this.entityToDto(o)}catch(e){throw p.default.error(`[${o.name}] Failed to find custom persona by ID:`,e),new c.BadRequestException("Failed to retrieve custom persona")}}async copy(e,t,r){p.default.debug(`[${o.name}] Copying persona: ${e} to: ${r} for user: ${t}`);const n=await this.getPersonaForCopy(e,t),s={name:r,systemPrompt:n.systemPrompt,enabledTools:n.enabledTools,enabledOptionalComponents:n.enabledOptionalComponents};return this.create(t,s)}getAllToolNames(){return this.toolProvider.getAllToolFactories().map((e=>e.getToolName()))}validatePersonaName(e){if(!e||0===e.trim().length)throw new c.BadRequestException("Persona name is required");if(e.length>255)throw new c.BadRequestException("Persona name must be 255 characters or less");if(["software-engineer","product-manager","architect"].includes(e.toLowerCase()))throw new c.BadRequestException("Persona name conflicts with system persona")}validateSystemPrompt(e){if(!e||0===e.trim().length)throw new c.BadRequestException("System prompt is required");if(e.length<50)throw new c.BadRequestException("System prompt must be at least 50 characters");if(e.length>1e4)throw new c.BadRequestException("System prompt must be 10000 characters or less")}validateEnabledTools(e){if(!Array.isArray(e)||0===e.length)throw new c.BadRequestException("At least one tool must be enabled");const t=this.getAllToolNames(),r=e.filter((e=>!t.includes(e)));if(r.length>0)throw new c.BadRequestException(`Invalid tools: ${r.join(", ")}`)}async checkDuplicateName(e,t,r){const o=this.knex(this.TABLE_NAME).where({user_id:e,name:t,is_active:!0});r&&o.whereNot({id:r});if(await o.first())throw new c.ConflictException("A persona with this name already exists")}async getPersonaForCopy(e,t){const r=await this.findById(e,t);if(r)return{systemPrompt:r.systemPrompt,enabledTools:r.enabledTools,enabledOptionalComponents:r.enabledOptionalComponents};if(this.personaRegistry.isSystemPersona(e))try{const t=(await this.personaRegistry.getPersona(e)).getConfiguration();return{systemPrompt:t.corePrompt,enabledTools:t.toolNames,enabledOptionalComponents:t.optionalComponents}}catch(t){throw p.default.error(`[${o.name}] Failed to get system persona config for ${e}:`,t),new c.BadRequestException(`Failed to access system persona: ${e}`)}throw new c.BadRequestException(`Source persona not found: ${e}`)}rowToEntity(e){let t;return t=e.enabled_optional_components?JSON.parse(e.enabled_optional_components):["general-agent-behavior","objective","workspace-files","user-rules"],{id:e.id,userId:e.user_id,name:e.name,systemPrompt:e.system_prompt,enabledTools:JSON.parse(e.enabled_tools),enabledOptionalComponents:t,isActive:e.is_active,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}entityToDto(e){return{id:e.id,userId:e.userId,name:e.name,systemPrompt:e.systemPrompt,enabledTools:e.enabledTools,enabledOptionalComponents:e.enabledOptionalComponents,isActive:e.isActive,createdAt:e.createdAt,updatedAt:e.updatedAt}}};t.CustomPersonaService=f,t.CustomPersonaService=f=o=n([(0,c.Injectable)(),i(0,(0,c.Inject)("KNEX")),i(2,(0,c.Inject)((0,c.forwardRef)((()=>u.PersonaRegistry)))),s("design:paramtypes",[Function,d.ToolProvider,u.PersonaRegistry])],f)},1098:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MlxProvider=void 0;const i=r(3563),a=r(36206),c=r(31424),l=r(78706),d=r(91386),u=r(34313),p=s(r(19055));let f=class{constructor(e,t){this.providerRegistry=e,this.registryService=t,this.config={providerId:u.MLX_PROVIDER_ID,name:"MLX Server",description:"Local MLX server optimized for Apple Silicon with OpenAI-compatible API",website:"https://ml-explore.github.io/mlx/",docsLink:"https://ml-explore.github.io/mlx/build/html/index.html",baseUrl:"http://localhost:10240/v1",apiKeyName:"MLX_API_KEY",defaultModelId:(0,u.getDefaultMlxModelId)(),modelDiscovery:"api",features:{supportsStreaming:!0,supportsCaching:!1,supportsTools:!0,supportsImages:!1}},p.default.info("[MlxProvider] Initialized"),this.providerRegistry.registerProvider(this)}getId(){return this.config.providerId}getName(){return this.config.name}getMetadata(){return{website:this.config.website,docs_link:this.config.docsLink,api_version:"v1",default_base_url:this.config.baseUrl,is_local:!0,requires_server:!0,optimized_for:"Apple Silicon",framework:"MLX",unified_memory:!0}}requiresApiKey(){return!1}getDefaultBaseUrl(){return this.config.baseUrl}getDefaultModelId(){return this.config.defaultModelId}getApiKeyName(){return this.config.apiKeyName}getModelClient(e){const t={...e,baseUrl:e.baseUrl||this.config.baseUrl,apiKey:"noop",draftModelId:e.draftModelId},r={enableVerboseLogging:!1,maxOutputTokens:e.maxOutputTokens},o=new l.OpenAIModelClient(t,r);return this.discoverModels(void 0,t.baseUrl).then((t=>{const r=t.find((t=>t.modelId===e.modelId));r?o.setModelMetadata(r):p.default.debug(`[MlxProvider] Metadata not found for model ${e.modelId}`)})).catch((e=>{p.default.debug(`[MlxProvider] Failed to discover models: ${e.message}`)})),o}getProviderMetadata(){const e=d.OpenAICompatibleUtils.createProviderMetadata(this.config);return{...e,requiresApiKey:!1,features:{...e.features,supportsSpeculativeDecoding:!0}}}getStaticModels(){return[]}async discoverDynamicModels(e,t){const r=t||this.config.baseUrl;return{models:await(0,u.discoverMlxModels)(r,this.registryService),discoveredAt:new Date,discoveryMethod:"api",source:r}}requiresApiKeyForDiscovery(){return!1}async discoverModels(e,t){return(0,u.discoverMlxModels)(t||this.config.baseUrl,this.registryService)}};t.MlxProvider=f,t.MlxProvider=f=o([(0,i.Injectable)(),n("design:paramtypes",[a.ProviderRegistry,c.OpenSourceModelRegistryService])],f)},1145:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.RuleSource=void 0,function(e){e.REPO="repo",e.USER="user",e.EVE="eve"}(r||(t.RuleSource=r={}))},1708:e=>{"use strict";e.exports=require("node:process")},2115:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.McpHubService=void 0;const u=r(3563),p=r(11569),f=c(r(29231)),h=d(r(77078)),m=r(58500),g=d(r(34251)),y=r(16406),v=r(19668),_=r(77332),w=d(r(19055));let b,k,S,T,R,C,P,E,I;async function O(){if(!b){const[e,t,o,n,s]=await Promise.all([Promise.resolve().then((()=>c(r(96804)))),Promise.resolve().then((()=>c(r(19969)))),Promise.resolve().then((()=>c(r(27497)))),Promise.resolve().then((()=>c(r(35754)))),Promise.resolve().then((()=>c(r(10815))))]);b=e.Client,k=t.StdioClientTransport,S=o.SSEClientTransport,T=n.StreamableHTTPClientTransport,R=s.CallToolResultSchema,C=s.ListResourcesResultSchema,P=s.ListResourceTemplatesResultSchema,E=s.ListToolsResultSchema,I=s.ReadResourceResultSchema}}const $=3e4;let M=n=class{constructor(e,t){this.mcpConfigService=e,this.userService=t,this.connections=new Map,this.isConnecting=!1,this.initializationPromises=new Map,this.settingsWatchers=new Map,this.fileWatchers=new Map,this.pendingNotifications=new Map,this.notificationCallbacks=new Map,w.default.info(`[${n.name}] McpHubService initialized with Cline architecture`)}async connectToServer(e,t,r){const o=`${e}:${t}`;await this.deleteConnection(o);try{await O();const s=new b({name:"Eve",version:"1.0.0"},{capabilities:{}}),i=await this.createTransport(r,t),a={userId:e,server:{name:t,config:JSON.stringify(r),status:"connecting",disabled:r.disabled||!1,error:""},client:s,transport:i};this.connections.set(o,a),await s.connect(i),a.server.status="connected",a.server.error="",await this.setupNotificationHandlers(a,t),a.server.tools=await this.fetchToolsList(o),a.server.resources=await this.fetchResourcesList(o),a.server.resourceTemplates=await this.fetchResourceTemplatesList(o),"stdio"===r.type&&this.setupFileWatcher(o,r),w.default.info(`[${n.name}] Successfully connected to MCP server: ${t} for user: ${e}`)}catch(e){const r=this.connections.get(o);throw r&&(r.server.status="disconnected",this.appendErrorMessage(r,e instanceof Error?e.message:String(e))),w.default.error(`[${n.name}] Failed to connect to MCP server ${t}:`,e),e}}async createTransport(e,t){switch(await O(),e.type){case"stdio":{const r=new k({command:e.command,args:e.args||[],cwd:e.cwd,env:{...e.env||{},...process.env.PATH?{PATH:process.env.PATH}:{}},stderr:"pipe"});r.onerror=async e=>{w.default.error(`Transport error for "${t}":`,e);const r=this.findConnection(t);r&&(r.server.status="disconnected",this.appendErrorMessage(r,e instanceof Error?e.message:`${e}`))},r.onclose=async()=>{const e=this.findConnection(t);e&&(e.server.status="disconnected")};const o=r.stderr;return o&&o.on("data",(async e=>{const r=e.toString();if(/INFO/i.test(r))w.default.info(`Server "${t}" info:`,r);else{w.default.error(`Server "${t}" stderr:`,r);const e=this.findConnection(t);e&&this.appendErrorMessage(e,r)}})),r}case"sse":{const r={requestInit:{headers:e.headers||{}}},o={max_retry_time:5e3,withCredentials:!!e.headers?.Authorization};global.EventSource=g.default;const n=new S(new URL(e.url),{...r,eventSourceInit:o});return n.onerror=async e=>{w.default.error(`Transport error for "${t}":`,e);const r=this.findConnection(t);r&&(r.server.status="disconnected",this.appendErrorMessage(r,e instanceof Error?e.message:`${e}`))},n}case"streamableHttp":{const r=new T(new URL(e.url),{requestInit:{headers:e.headers||{}}});return r.onerror=async e=>{w.default.error(`Transport error for "${t}":`,e);const r=this.findConnection(t);r&&(r.server.status="disconnected",this.appendErrorMessage(r,e instanceof Error?e.message:`${e}`))},r}default:throw new Error(`Unknown transport type: ${e.type}`)}}async setupNotificationHandlers(e,t){try{const r=p.z.object({method:p.z.literal("notifications/message"),params:p.z.object({level:p.z.enum(["debug","info","warning","error"]).optional(),logger:p.z.string().optional(),data:p.z.string().optional(),message:p.z.string().optional()}).optional()});e.client.setNotificationHandler(r,(async r=>{const o=r.params||{},n=o.level||"info",s=o.data||o.message||"",i=o.logger||"",a=i?`[${i}] ${s}`:s,c=e.userId,l=this.notificationCallbacks.get(c);l?l(t,n,a):(this.pendingNotifications.has(c)||this.pendingNotifications.set(c,[]),this.pendingNotifications.get(c).push({serverName:t,level:n,message:a,timestamp:Date.now()}))})),e.client.fallbackNotificationHandler=async e=>{w.default.info(`MCP Fallback Notification from ${t}:`,JSON.stringify(e,null,2))}}catch(e){w.default.error(`Error setting notification handlers for ${t}:`,e)}}async updateServerConnections(e,t){this.isConnecting=!0;try{const r=Array.from(this.connections.entries()).filter((([t])=>t.startsWith(`${e}:`))),o=new Set(r.map((([e])=>e.split(":")[1]))),n=new Set(Object.keys(t));for(const t of o)n.has(t)||(await this.deleteConnection(`${e}:${t}`),w.default.info(`Deleted MCP server: ${t} for user: ${e}`));for(const[r,o]of Object.entries(t)){const t=`${e}:${r}`,n=this.connections.get(t);if(n){if(!(0,h.default)(JSON.parse(n.server.config),o))try{await this.deleteConnection(t),await this.connectToServer(e,r,o),w.default.info(`Reconnected MCP server with updated config: ${r}`)}catch(e){w.default.error(`Failed to reconnect MCP server ${r}:`,e)}}else try{await this.connectToServer(e,r,o)}catch(e){w.default.error(`Failed to connect to new MCP server ${r}:`,e)}}}finally{this.isConnecting=!1}}setupFileWatcher(e,t){const r=t.args?.find((e=>e.includes("build/index.js")));if(r){const t=f.watch(r);t.on("change",(()=>{w.default.info(`Detected change in ${r}. Restarting server...`),this.restartConnection(e)})),this.fileWatchers.set(e,t)}}async watchUserSettings(e){const t=await this.mcpConfigService.getUserConfigFilePath(e),r=f.watch(t);r.on("change",(async()=>{w.default.info(`MCP settings changed for user: ${e}`);try{const t=await this.mcpConfigService.getUserSettings(e);await this.updateServerConnections(e,t.mcpServers)}catch(t){w.default.error(`Failed to process MCP settings change for user ${e}:`,t)}})),this.settingsWatchers.set(e,r)}findConnection(e){return Array.from(this.connections.values()).find((t=>t.server.name===e))}appendErrorMessage(e,t){const r=e.server.error?`${e.server.error}\n${t}`:t;e.server.error=r}async fetchToolsList(e){try{const t=this.connections.get(e);if(!t)throw new Error(`No connection found for key: ${e}`);const r=await t.client.request({method:"tools/list"},E,{timeout:$}),[o,n]=e.split(":"),s=await this.mcpConfigService.getUserSettings(o),i=s.mcpServers[n]?.autoApprove||[];return(r?.tools||[]).map((e=>({name:e.name||"",description:e.description,inputSchema:e.inputSchema,autoApprove:i.includes(e.name||"")})))}catch(t){return w.default.error(`Failed to fetch tools for ${e}:`,t),[]}}async fetchResourcesList(e){try{const t=this.connections.get(e);if(!t)return[];const r=await t.client.request({method:"resources/list"},C,{timeout:$});return r?.resources||[]}catch(e){return[]}}async fetchResourceTemplatesList(e){try{const t=this.connections.get(e);if(!t)return[];const r=await t.client.request({method:"resources/templates/list"},P,{timeout:$});return r?.resourceTemplates||[]}catch(e){return[]}}async deleteConnection(e){const t=this.connections.get(e);if(t){try{await t.transport.close(),await t.client.close()}catch(t){w.default.error(`Failed to close transport for ${e}:`,t)}this.connections.delete(e);const r=this.fileWatchers.get(e);r&&(await r.close(),this.fileWatchers.delete(e))}}async restartConnection(e){const t=this.connections.get(e);if(!t)return;const r=JSON.parse(t.server.config),o=t.userId,n=t.server.name;t.server.status="connecting",t.server.error="",await(0,m.setTimeout)(500);try{await this.deleteConnection(e),await this.connectToServer(o,n,r)}catch(t){w.default.error(`Failed to restart connection for ${e}:`,t)}}async initializeUserServers(e){if(this.initializationPromises.has(e))return w.default.debug(`[${n.name}] Initialization already in progress for user: ${e}, awaiting completion.`),this.initializationPromises.get(e);const t=this.performInitialization(e);this.initializationPromises.set(e,t);try{await t}finally{this.initializationPromises.delete(e)}}async performInitialization(e){try{const t=await this.mcpConfigService.getUserSettings(e);await this.updateServerConnections(e,t.mcpServers),this.settingsWatchers.has(e)||await this.watchUserSettings(e),w.default.info(`[${n.name}] Initialized MCP servers for user: ${e}`)}catch(t){w.default.error(`[${n.name}] Failed to initialize MCP servers for user ${e}:`,t)}}async callTool(e,t,r,o){const s=`${e}:${t}`,i=this.connections.get(s);if(!i)throw new Error(`No connection found for server: ${t}. Please make sure to use MCP servers available under 'Connected MCP Servers'.`);if(i.server.disabled)throw new Error(`Server "${t}" is disabled and cannot be used`);let a=$;try{const e=JSON.parse(i.server.config);a=1e3*(_.ServerConfigSchema.parse(e).timeout||60)}catch(e){w.default.error(`Failed to parse timeout configuration for server ${t}: ${e}`)}const c=await i.client.request({method:"tools/call",params:{name:r,arguments:o}},R,{timeout:a});return w.default.debug(`[${n.name}] MCP tool call response for '${r}':`,JSON.stringify(c,null,2)),{...c,content:c.content??[]}}async readResource(e,t,r){const o=`${e}:${t}`,s=this.connections.get(o);if(!s)throw new Error(`No connection found for server: ${t}`);if(s.server.disabled)throw new Error(`Server "${t}" is disabled`);const i=await s.client.request({method:"resources/read",params:{uri:r}},I);return w.default.debug(`[${n.name}] MCP read resource response for '${r}':`,JSON.stringify(i,null,2)),i}getConnectedServers(e){return Array.from(this.connections.values()).filter((t=>t.userId===e&&"connected"===t.server.status&&!t.server.disabled)).map((e=>e.server))}getAllUserServers(e){return Array.from(this.connections.values()).filter((t=>t.userId===e)).map((e=>e.server))}setNotificationCallback(e,t){this.notificationCallbacks.set(e,t),w.default.debug(`[${n.name}] Notification callback set for user: ${e}`)}clearNotificationCallback(e){this.notificationCallbacks.delete(e),w.default.debug(`[${n.name}] Notification callback cleared for user: ${e}`)}getPendingNotifications(e){const t=this.pendingNotifications.get(e)||[];return this.pendingNotifications.set(e,[]),t}async restartServer(e,t){const r=`${e}:${t}`;await this.restartConnection(r)}async refreshAutoApprovalSettings(e,t){const r=`${e}:${t}`,o=this.connections.get(r);if(o&&"connected"===o.server.status)try{const r=await this.mcpConfigService.getUserSettings(e),s=r.mcpServers[t]?.autoApprove||[];o.server.tools&&(o.server.tools=o.server.tools.map((e=>({...e,autoApprove:s.includes(e.name)})))),w.default.debug(`[${n.name}] Refreshed auto-approval settings for server: ${t}`)}catch(e){w.default.error(`[${n.name}] Failed to refresh auto-approval settings for ${t}:`,e)}}async onModuleDestroy(){w.default.info(`[${n.name}] Shutting down MCP Hub Service...`);for(const e of this.fileWatchers.values())await e.close();this.fileWatchers.clear();for(const e of this.settingsWatchers.values())await e.close();this.settingsWatchers.clear();for(const e of this.connections.keys())await this.deleteConnection(e);this.connections.clear(),w.default.info(`[${n.name}] MCP Hub Service shutdown complete`)}};t.McpHubService=M,t.McpHubService=M=n=a([(0,u.Injectable)(),l("design:paramtypes",[y.McpConfigService,v.UserService])],M)},2410:e=>{"use strict";e.exports=require("glob")},2620:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RateLimitRetryService=void 0;const i=r(3563),a=r(50461),c=r(59100),l=r(9581),d=r(50074),u=r(55324),p=r(91280),f=s(r(19055));let h=class{constructor(e,t,r){this.errorMapperRegistry=e,this.blockService=t,this.eventEmitter=r}async retryWithRateLimit(e,t,r,o={}){const n={maxRetries:3,retryDelaySeconds:60,emitErrorBlocks:!0,providerId:"unknown",...o};let s,i=0;for(;i<=n.maxRetries;)try{f.default.info(`[RateLimitRetryService] Attempt ${i+1}/${n.maxRetries+1} for task ${t}`);const r=await e();return i>0&&(f.default.info(`[RateLimitRetryService] Operation succeeded on attempt ${i+1} for task ${t}`),n.emitErrorBlocks&&await this.createRetrySuccessBlock(t,i+1)),{success:!0,result:r,attemptsUsed:i+1}}catch(e){i++;const o=this.errorMapperRegistry.mapError(n.providerId,e);s=o;if(!(o instanceof l.RateLimitError||this.errorMapperRegistry.isRateLimitError(n.providerId,e)))return f.default.info(`[RateLimitRetryService] Non-rate-limit error encountered for task ${t}: ${o.message}`),{success:!1,error:o,attemptsUsed:i};if(i>n.maxRetries)return f.default.error(`[RateLimitRetryService] All ${n.maxRetries} retries exhausted for task ${t}`),n.emitErrorBlocks&&await this.createFinalFailureBlock(t,o,n.maxRetries),{success:!1,error:o,attemptsUsed:i};let a=n.retryDelaySeconds;o instanceof l.RateLimitError&&o.context?.retryAfterSeconds&&(a=Math.max(a,o.context.retryAfterSeconds)),f.default.warn(`[RateLimitRetryService] Rate limit error on attempt ${i}/${n.maxRetries+1} for task ${t}. Retrying in ${a} seconds.`),n.emitErrorBlocks&&await this.createRetryErrorBlock(t,o,i,n.maxRetries,a),this.eventEmitter.emit(p.InternalEvents.AGENT_ERROR_NOTIFICATION,{clientId:r,taskId:t,error:`Rate limit exceeded. Retrying in ${a} seconds (attempt ${i}/${n.maxRetries+1})`,type:"api_error",code:o.code,context:{attempt:i,maxRetries:n.maxRetries,delaySeconds:a,retryAfterSeconds:o instanceof l.RateLimitError?o.context?.retryAfterSeconds:void 0,errorType:"rate_limit_retry"}}),await this.delay(1e3*a)}return{success:!1,error:s||new l.EveAgentError("Unknown error in rate limit retry"),attemptsUsed:i}}async createRetryErrorBlock(e,t,r,o,n){try{const s=(0,c.ulid)(),i=`⏱️ **Rate Limit Exceeded**\n\nThe API rate limit has been exceeded. Automatically retrying...\n\n**Attempt:** ${r}/${o+1}\n**Retry in:** ${n} seconds\n**Error:** ${t.toUserMessage()}\n\nPlease wait while I retry the request.`;await this.blockService.createBlock({blockId:s,taskId:e,role:"assistant",blockType:"error",status:"finished",content:i,errorText:`Rate limit retry attempt ${r}/${o+1}`}),f.default.debug(`[RateLimitRetryService] Created retry error block ${s} for task ${e}`)}catch(t){f.default.error(`[RateLimitRetryService] Failed to create retry error block for task ${e}: ${t.message}`)}}async createRetrySuccessBlock(e,t){try{const r=(0,c.ulid)(),o=`✅ **Retry Successful**\n\nThe request succeeded after ${t} attempt${t>1?"s":""}. Continuing with the task.`;await this.blockService.createBlock({blockId:r,taskId:e,role:"assistant",blockType:"text",status:"finished",content:o}),f.default.debug(`[RateLimitRetryService] Created retry success block ${r} for task ${e}`)}catch(t){f.default.error(`[RateLimitRetryService] Failed to create retry success block for task ${e}: ${t.message}`)}}async createFinalFailureBlock(e,t,r){try{const o=(0,c.ulid)(),n=`❌ **Rate Limit Retry Failed**\n\nAll ${r} retry attempts have been exhausted due to persistent rate limiting.\n\n**Final Error:** ${t.toUserMessage()}\n\nPlease try again later when the rate limit has reset, or consider reducing the frequency of requests.`;await this.blockService.createBlock({blockId:o,taskId:e,role:"assistant",blockType:"error",status:"finished",content:n,errorText:`Rate limit retries exhausted after ${r} attempts`}),f.default.debug(`[RateLimitRetryService] Created final failure block ${o} for task ${e}`)}catch(t){f.default.error(`[RateLimitRetryService] Failed to create final failure block for task ${e}: ${t.message}`)}}delay(e){return new Promise((t=>setTimeout(t,e)))}};t.RateLimitRetryService=h,t.RateLimitRetryService=h=o([(0,i.Injectable)(),n("design:paramtypes",[d.ProviderErrorMapperRegistry,u.BlockService,a.EventEmitter2])],h)},3060:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AttemptCompletionTool=void 0;const a=r(3563),c=r(20436),l=i(r(19055));let d=o=class extends c.BaseTool{constructor(e){super(e),this.name="attempt_completion",this.description="After each tool use, the user will respond with the result of that tool use, i.e. if it succeeded or failed, along with any reasons for failure. Once you've received the results of tool uses and can confirm that the task is complete, use this tool to present the result of your work to the user.",l.default.info(`[${o.name}] AttemptCompletionTool initialized`)}getModeSpecificGuidance(e){return null}getBaseUsageInstructions(e){return"## attempt_completion\nDescription: After each tool use, the user will respond with the result of that tool use, i.e. if it succeeded or failed, along with any reasons for failure. Once you've received the results of tool uses and can confirm that the task is complete, use this tool to present the result of your work to the user. Optionally you may provide a CLI command to showcase the result of your work. The user may respond with feedback if they are not satisfied with the result, which you can use to make improvements and try again.\nIMPORTANT NOTE: This tool CANNOT be used until you've confirmed from the user that any previous tool uses were successful. Failure to do so will result in code corruption and system failure. Before using this tool, you must ask yourself in <thinking></thinking> tags if you've confirmed from the user that any previous tool uses were successful. If not, then DO NOT use this tool.\nParameters:\n- result: (required) The result of the task. Formulate this result in a way that is final and does not require further input from the user. Don't end your result with questions or offers for further assistance.\n- command: (optional) A CLI command to execute to show a live demo of the result to the user. For example, use `open index.html` to display a created html website, or `open localhost:3000` to display a locally running development server. But DO NOT use commands like `echo` or `cat` that merely print text. This command should be valid for the current operating system. Ensure the command is properly formatted and does not contain any harmful instructions.\nUsage:\n<attempt_completion>\n<result>\nYour final result description here\n</result>\n<command>Command to demonstrate result (optional)</command>\n</attempt_completion>"}validateParams(e){return"string"==typeof e.result&&""!==e.result.trim()}async execute(e){const{result:t,command:r}=e;return l.default.info(`[${o.name}] Attempting completion: ${t.substring(0,50)}...`),{result:t,command:r,success:!0}}};t.AttemptCompletionTool=d,t.AttemptCompletionTool=d=o=n([(0,a.Injectable)(),s("design:paramtypes",[Object])],d)},3153:e=>{"use strict";e.exports=require("@langchain/community/document_loaders/fs/unstructured")},3177:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.MutationsModule=void 0;const n=r(3563),s=r(376),i=r(99989),a=r(77602),c=r(90672);let l=class{};t.MutationsModule=l,t.MutationsModule=l=o([(0,n.Module)({imports:[s.DataSourceModule],controllers:[i.MutationsController],providers:[a.MutationsService,c.MutationRepository],exports:[a.MutationsService]})],l)},3309:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requirementsToCodeWorkflowRule=void 0;const o=r(1145);t.requirementsToCodeWorkflowRule={id:"eve-standard-05-requirements-to-code-workflow",name:"Requirements to Code workflow",content:'# Requirements to Code Workflow\n\nThis workflow dictates how you interact with project requirement files (Epics, Stories, Tasks) to ensure structured development and accurate progress tracking.\n\n## 1. Directory Structure & File Organization\n\nAll requirements are located under the `epics/` directory with this structure:\n\n```\nepics/\n  └── EPIC_Name/                  # Descriptive name (e.g., UserAuthentication)\n      ├── EpicName_prd.md         # Product Requirements Document\n      ├── EpicName_progress.md    # Overall progress tracking\n      └── STORY_01_StoryName/     # Numbered stories for order\n          ├── STORY_01_StoryName.md # Story requirements\n          ├── TASK_01_TaskName.md   # Implementation tasks\n          └── TASK_02_TaskName2.md  # Additional tasks\n      └── STORY_02_AnotherStory/\n          ├── STORY_02_AnotherStory.md\n          └── TASK_01_DifferentTask.md\n```\n\n## 2. File Creation Specifications\n\n### 2.1 Epic PRD File (`EpicName_prd.md`)\n\n**YAML Frontmatter (Required):**\n```yaml\n---\ntype: "epic-prd"\nepic_name: "UserAuthentication"\ncreated_date: "2025-05-23"\nauthor: "Product Manager Name"\nstatus: "draft" | "approved" | "in_progress" | "completed"\nbusiness_value: "high" | "medium" | "low"\n---\n```\n\n**Required Content Sections:**\n- **Epic Title**: Clear, concise title\n- **Epic Description**: What and why this epic exists\n- **Goals & Objectives**: Specific goals to achieve\n- **Success Criteria / Key Performance Indicators (KPIs)**: Measurable success metrics\n- **Out of Scope**: What is explicitly not included\n- **High-level user personas involved**: Target users\n\n### 2.2 Epic Progress File (`EpicName_progress.md`)\n\n**YAML Frontmatter (Required):**\n```yaml\n---\ntype: "epic-progress"\nepic_name: "UserAuthentication"\nlast_updated: "2025-05-23"\noverall_status: "backlog" | "in_progress" | "blocked" | "completed"\ncompletion_percentage: 0-100\n---\n```\n\n**Required Content Structure:**\n- **Overall Epic Status**: Current state description\n- **Story and Task Checklist** (exact format):\n  - [ ] STORY_01_StoryName\n    - [ ] TASK_01_TaskName\n    - [x] TASK_02_TaskName2\n  - [x] STORY_02_AnotherStory\n    - [x] TASK_01_DifferentTask\n- **Blockers or Critical Notes**: Any impediments\n\n**CRITICAL ACTIONS:**\n- **READ**: You **MUST** read this file before starting any work on tasks within this epic\n- **UPDATE**: You **MUST** update this file after completing any task, including:\n  - Marking tasks complete: `[ ]` -> `[x]`\n  - Marking stories complete when all tasks done\n  - Updating `last_updated` timestamp\n  - Updating `overall_status` and `completion_percentage` as appropriate\n\n### 2.3 Story File (`STORY_XX_StoryName.md`)\n\n**YAML Frontmatter (Required):**\n```yaml\n---\ntype: "story"\nstory_id: "STORY_01_UserRegistration"\nepic_name: "UserAuthentication"\ncreated_date: "2025-05-23"\nauthor: "Product Manager Name"\nstatus: "backlog" | "in_progress" | "blocked" | "completed"\n---\n```\n\n**Required Content Structure:**\n- **Title**: Clear, concise story title\n- **Description**: User-centric format: "As a [user type], I want [goal] so that [benefit/reason]"\n- **Acceptance Criteria (ACs)**: Numbered, testable criteria\n  ## Acceptance Criteria\n  1. Given a new user, when they submit valid registration details, then their account is created successfully.\n  2. Given a user provides an already registered email, when they submit the form, then an appropriate error message is displayed.\n- **Architecture**: Mermaid diagrams showing proposed architecture, data flow, component interactions\n  ## Architecture\n  \n  ```mermaid\n  sequenceDiagram\n      User->>Frontend: Submits registration form\n      Frontend->>Backend: POST /api/register\n      Backend->>Database: Create user record\n      Database--\x3e>Backend: User record created\n      Backend--\x3e>Frontend: Success response\n      Frontend--\x3e>User: Displays success message\n  ```\n- **Technical Design Considerations**: Key technical decisions, constraints, performance, security, scalability\n  ## Technical Design Considerations\n  - **Security**: Passwords must be hashed using bcrypt with minimum 12 rounds\n  - **Validation**: Email validation using regex and domain verification\n  - **Performance**: Registration endpoint should respond within 500ms under normal load\n  - **Database**: User table should include indexes on email field for fast lookups\n  - **Error Handling**: Implement proper error codes and user-friendly messages\n  - **Integration**: Consider future OAuth integration requirements\n\n### 2.4 Task File (`TASK_XX_TaskName.md`)\n\n**YAML Frontmatter (Required):**\n```yaml\n---\ntype: "task"\ntask_id: "TASK_01_DesignRegistrationUI"\nstory_id: "STORY_01_UserRegistration"\nepic_name: "UserAuthentication"\ncreated_date: "2025-05-23"\nauthor: "Architect/Developer Name"\nstatus: "todo" | "in_progress" | "blocked" | "completed"\n---\n```\n\n**Required Content Structure:**\n- **Task Title**: Specific, actionable title\n- **Detailed Description**: Expanding on story requirements\n- **Technical Approach / Implementation Plan**: Step-by-step approach\n- **File Paths to Read**: List of existing files to examine before starting\n- **Relevant Code Snippets**: Existing or to-be-written code examples\n- **API Endpoint Details**: If applicable, endpoint specifications\n- **Database Schema Changes**: If applicable, schema modifications\n- **Libraries/Dependencies**: Required packages or tools\n- **Potential Challenges and Solutions**: Known issues and approaches\n- **Test Cases to Consider**: Testing scenarios\n\n**CRITICAL ACTION (UPDATE):** After completing work, update `status` in YAML frontmatter to `completed`.\n\n## 3. Your Operational Workflow for a Given Task\n\nWhen assigned a task (e.g., "Implement `TASK_01_CreateUserEndpoint` for `STORY_01_UserRegistration` in epic `UserAuthentication`"):\n\n1. **Initial Context Check (Epic Progress)**:\n   - Locate and read `epics/UserAuthentication/UserAuthentication_progress.md`\n   - Note current status of `STORY_01_UserRegistration` and its tasks\n\n2. **Understand the Story**:\n   - Read `epics/UserAuthentication/STORY_01_UserRegistration/STORY_01_UserRegistration.md`\n   - Pay attention to Acceptance Criteria, Architecture, and Technical Design\n\n3. **Understand the Task**:\n   - Thoroughly read `epics/UserAuthentication/STORY_01_UserRegistration/TASK_01_CreateUserEndpoint.md`\n   - This contains specific implementation details\n\n4. **Execute the Task**:\n   - Perform coding, file modifications as detailed in the task file\n   - Follow the technical approach and implementation plan\n\n5. **Update Task Status**:\n   - Modify the task file\'s YAML frontmatter\n   - Change `status` from `todo`/`in_progress` to `completed`\n\n6. **Update Epic Progress**:\n   - Modify `epics/UserAuthentication/UserAuthentication_progress.md`\n   - Find `TASK_01_CreateUserEndpoint` in checklist: `[ ]` -> `[x]`\n   - If this completes `STORY_01_UserRegistration`, mark story complete too\n   - Update `last_updated` YAML field\n   - Adjust `overall_status` and `completion_percentage` if appropriate\n   - Use `replace_in_file` tool for precise updates\n\n## 4. File Creation Workflows\n\n### 4.1 Creating New Epics\n**Who**: Product Manager or Architect\n**Process**:\n1. Create `EPIC_Name/` directory\n2. Create `EpicName_prd.md` with required YAML and content sections\n3. Create initial `EpicName_progress.md` with empty story checklist\n\n### 4.2 Creating New Stories\n**Who**: Product Manager (or LLM agent when prompted)\n**Process**:\n1. Create `STORY_XX_StoryName/` directory (numbered sequentially)\n2. Create `STORY_XX_StoryName.md` with required YAML and content\n3. Architecture and Technical Design sections can be filled by Architect/LLM\n4. Update epic progress file to include new story in checklist\n\n### 4.3 Creating New Tasks\n**Who**: Architect, Developer, or LLM agent\n**Process**:\n1. Create `TASK_XX_TaskName.md` files within story directory\n2. Include detailed technical information for implementation\n3. Update epic progress file to include new tasks in story checklist\n\n## 5. General Guidelines\n\n- **Focus**: Concentrate on one task at a time\n- **YAML Precision**: Be exact when reading and updating YAML frontmatter\n- **File References**: Task files may specify other codebase files to read/modify\n- **Tool Usage**: Use `read_file` to access documents, `replace_in_file` for updates\n- **Sequential Numbering**: Stories and tasks use sequential numbering for clarity\n- **Status Tracking**: Always update both task-level and epic-level progress\n\nAdherence to this workflow ensures project clarity and enables effective collaboration between human developers and LLM agents.\n',sourceType:o.RuleSource.EVE,isEditable:!1,isDeletable:!1}},3563:e=>{"use strict";e.exports=require("@nestjs/common")},3765:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CommandLine=void 0;const n=r(83153),s=r(11569),i=r(35317),a=r(39023),c=o(r(19055)),l=o(r(16928)),d=r(81162),u=(0,a.promisify)(i.exec);class p extends n.Tool{constructor(e,t){super(),this.name="command_line",this.description="Execute a command line instruction in the workspace directory or a subdirectory",this.schema=s.z.object({command:s.z.string().describe("The command to execute"),subDir:s.z.string().optional().describe("Optional subdirectory relative to the workspace root to execute the command in")}),this.privateRequired=!1,this.summaryPrompt="\n  You are a helpful assistant that summarises text. Your job is present the minumum useful information in the shortest way possible.\n  Summarise the following text pulling out just the interesting things. For example:\n  \n  a) If it looks like test output:\n     - If all tests passed, just say that and mention how many tests passed if possible.\n     - IF THERE ARE ANY FAILURES THEN YOU MUST ALL INFORMATION ABOUT ALL OF THE ERRORS INCLUDING ALL OF THE STACK TRACES OR ERROR INFORMATION AND INCLUDE ALL FILES/LINE NUMBERS ETC.\n     - ALSO INCLUDE ALL THE DEBUG/CONSOLE OUTPUT THAT IS RELATED TO THE TESTS THAT FAILED. IT IS BETTER TO INCLUDE TOO MUCH INFORMATION THAN TOO LITTLE.\n\n  b) If it's something else, then just pull out the most important information.",this.workspaceRootDir=e,this.maxOutputChars=parseInt(process.env.MAX_TOOL_OUTPUT_CHARS||"20000"),this.summaryCompletion=t}setPrivateRequired(e){this.privateRequired=e}async summariseOutput(e,t){const r="Stdout:\n"+e+"\nStderr:\n"+t;if(r.length>this.maxOutputChars){if(this.summaryCompletion){c.default.debug(`Summarising large command output - ${r.length} chars - content:\n ${r}`);const e=await this.summaryCompletion.getSummary(this.summaryPrompt,r,d.ModelCategory.SUMMARISATION,this.privateRequired);return c.default.info(`Summarised large command output - reduced ${r.length} chars to ${e.length}`),e}{const o=this.clipString(e),n=this.clipString(t);return`Summarised large command output - reduced ${r.length} chars to ${o.length+n.length}:\n${o}\n${n}`}}return r}clipString(e){return e.length>this.maxOutputChars?e.slice(-this.maxOutputChars):e}async _call({command:e,subDir:t}){try{const r=t&&"."!==t?l.default.join(this.workspaceRootDir,t):this.workspaceRootDir;c.default.info(`Executing command: ${e} in directory: ${r}`);const{stdout:o,stderr:n}=await u(e,{cwd:r});return`Successfully executed command:\n${e}\nWorking Directory: ${r}\nOutput was:\n${await this.summariseOutput(o,n)}`}catch(t){c.default.warn(`Error executing command: ${e}`,t),c.default.warn(`Error stdout: ${t.stdout}`),c.default.warn(`Error stderr: ${t.stderr}`);const r=t.stdout||"",o=t.stderr||"";return`Error encountered when executing command:\n${e}\nOutput was:\n${await this.summariseOutput(r,o)}\nError was:\n${this.clipString(t.message)}`}}}t.CommandLine=p},4044:(e,t,r)=>{"use strict";const o=r(35317),n=r(86571),s=r(44971);function i(e,t,r){const i=n(e,t,r),a=o.spawn(i.command,i.args,i.options);return s.hookChildProcess(a,i),a}e.exports=i,e.exports.spawn=i,e.exports.sync=function(e,t,r){const i=n(e,t,r),a=o.spawnSync(i.command,i.args,i.options);return a.error=a.error||s.verifyENOENTSync(a.status,i),a},e.exports._parse=n,e.exports._enoent=s},4243:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FileValidationService=void 0;const u=r(3563),p=c(r(91943)),f=r(22141),h=r(81125),m=d(r(19055)),g=c(r(16928));let y=n=class{constructor(e,t){this.fileSystemService=e,this.validatorRegistry=t}async onModuleInit(){m.default.info(`[${n.name}] FileValidationService initialized`)}async validateFile(e,t){let r;const o=g.isAbsolute(e)?e:this.fileSystemService.resolvePath(e,t),s=g.extname(e).toLowerCase().slice(1);try{if(!await this.fileSystemService.fileExists(o))return m.default.warn(`[${n.name}] File not found for validation: ${o}`),{validatorName:"FileValidationService",validationMethod:"File existence check",hasErrors:!0,report:`File not found for validation: ${o}`};r=await p.readFile(o,"utf8")}catch(e){return m.default.error(`[${n.name}] Error reading file ${o} for validation: ${e.message}`),{validatorName:"FileValidationService",validationMethod:"File reading",hasErrors:!0,report:`Error reading file for validation: ${e.message}`}}const i=this.validatorRegistry.getValidatorsForFile(e);if(0===i.length)return m.default.info(`[${n.name}] No validators found for file extension: ${s}`),{validatorName:"None",validationMethod:"No validator available",hasErrors:!1,report:`No validators available for file extension: ${s}`};i.sort(((e,t)=>e.getPriority()-t.getPriority()));const a=i[0];m.default.info(`[${n.name}] Using validator: ${a.getName()} (priority ${a.getPriority()}) for file: ${e}`);try{return await a.validate(e,r,t)}catch(t){return m.default.error(`[${n.name}] Error running validator ${a.getName()} for ${e}: ${t.message}`),{validatorName:a.getName(),validationMethod:"Failed validation",hasErrors:!0,report:`Validation error: ${t.message}`}}}};t.FileValidationService=y,t.FileValidationService=y=n=a([(0,u.Injectable)(),l("design:paramtypes",[f.FileSystemService,h.ValidatorRegistryService])],y)},4584:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.WebSearchToolFactory=void 0;const s=r(3563),i=r(99605);let a=class{constructor(){}getToolName(){return"web_search"}create(e){return new i.WebSearchTool(e.workingDir,e.getUserApiKey,{planModeRestrictions:[],actModeRestrictions:[]})}};t.WebSearchToolFactory=a,t.WebSearchToolFactory=a=o([(0,s.Injectable)(),n("design:paramtypes",[])],a)},4676:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4704:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentModeHandler=void 0;const a=r(3563),c=i(r(19055)),l=r(96297),d=r(56550),u=r(55324),p=r(56349),f=r(66963),h=r(44810),m=r(16663),g=r(35444);let y=o=class{constructor(e,t,r,o,n,s){this.taskService=e,this.blockService=t,this.conversationHistoryService=r,this.agentLoopOrchestrator=o,this.webSocketService=n,this.eventHelper=s}async handleChangeAgentMode(e,t){l.debugLogger.log(`Received changeAgentMode from client ${t.id} for task ${e.taskId} to mode ${e.mode}`),c.default.info(`[${o.name}] Received changeAgentMode for task ${e.taskId} to mode ${e.mode}`);try{const r=await this.taskService.getTask(e.taskId);if(r.status===g.TaskStatus.WAITING_FOR_INPUT||"created"===r.status)await this.taskService.updateTask({taskId:e.taskId,mode:e.mode}),"created"===r.status&&await this.taskService.updateTask({taskId:e.taskId,status:g.TaskStatus.WAITING_FOR_INPUT}),this.eventHelper.emitTaskUpdate(t.id,e.taskId,g.TaskStatus.WAITING_FOR_INPUT,null,e.mode),c.default.info(`[${o.name}] Mode changed for task ${e.taskId}, no agent loop started.`);else{const n=`Cannot change mode while agent is ${r.status}. Wait until ready for input.`;c.default.warn(`[${o.name}] ${n} (Task: ${e.taskId})`),this.eventHelper.emitError(t.id,e.taskId,n,"handleChangeAgentMode","task_error")}}catch(r){c.default.error(`[${o.name}] Error handling mode change for task ${e.taskId}: ${r.message}\n${r.stack}`),this.eventHelper.emitError(t.id,e.taskId,`Error changing mode: ${r.message}`,"handleChangeAgentMode","task_error")}}async handleJoinTaskRoom(e,t){c.default.info(`[${o.name}] Client ${t.id} requested to join task room: ${e.taskId}`);try{await this.taskService.getTask(e.taskId),this.webSocketService.joinRoom(t.id,e.taskId)}catch(r){c.default.error(`[${o.name}] Error joining task room ${e.taskId}: ${r.message}`),t.emit("error",{message:`Error joining task room ${e.taskId}: ${r.message}`}),this.eventHelper.emitError(t.id,e.taskId,`Error joining task room: ${r.message}`,"handleJoinTaskRoom","task_error")}}};t.AgentModeHandler=y,t.AgentModeHandler=y=o=n([(0,a.Injectable)(),s("design:paramtypes",[d.TaskService,u.BlockService,p.ConversationHistoryService,f.AgentLoopOrchestrator,h.WebSocketService,m.EventHelper])],y)},4911:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GitCommit=void 0;const c=r(77773),l=i(r(79896)),d=i(r(16928)),u=a(r(19055)),p=a(r(83807)),f=r(92434);class h extends c.Tool{async ensureGitignoreExists(){return f.GitUtils.ensureGitignoreExists(this.repoBaseDir)}constructor(e,t,r){super(),this.repoBaseDir=e,this.requestId=t,this.sessionService=r,this.name="git_commit",this.description="Commits changes to the git repository",this.MAX_DIFF_SIZE=5e4,this.git=(0,p.default)(this.repoBaseDir)}async parseGitDiffOutput(e){const t=e.match(/(\d+) files? changed(?:, (\d+) insertions?\(\+\))?(?:, (\d+) deletions?\(-\))?/),r=t&&t[2]?parseInt(t[2]):0,o=t&&t[3]?parseInt(t[3]):0;return{filesChanged:t?parseInt(t[1]):0,insertions:r,deletions:o,linesChanged:Math.max(r,o)}}async getGitStats(){await this.git.add("-A");const e=await this.git.diff(["--cached","--shortstat"]),t=(await this.git.diff(["--cached","--name-only"])).split("\n").filter((e=>e.includes("test")));let r="";return t.length>0&&(r=await this.git.diff(["--cached","--shortstat",...t])),{allFiles:await this.parseGitDiffOutput(e),testFiles:await this.parseGitDiffOutput(r)}}async storeRequestSpecJsonFile(e){const t=await this.sessionService.getRequest(this.requestId);if(!t||!t.requestContent)return void u.default.warn(`Unable to store request content for requestId: ${this.requestId}`);if(!await this.sessionService.getSession(t.sessionId))return void u.default.warn(`Session not found for requestId: ${this.requestId}`);if("false"===process.env.STORE_SPECS_IN_WORKSPACE)return;const r=new Date,o=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`,n=d.join(this.repoBaseDir,".eve","specs",o);l.mkdirSync(n,{recursive:!0});const s=await this.sessionService.getRequestStats(this.requestId),i=s.cost,a=await this.getGitStats(),c=Date.now()-new Date(t.startedAt).getTime(),p={spec:t.requestContent,commitMessage:e,stats:{...s,cost:i,currency:"gbp",processingMillis:c,git:{...a.allFiles,testFilesChanged:a.testFiles.filesChanged,testInsertions:a.testFiles.insertions,testDeletions:a.testFiles.deletions,linesChanged:a.allFiles.linesChanged,testLinesChanged:a.testFiles.linesChanged}}},f=d.join(n,`${this.requestId}.json`);l.writeFileSync(f,JSON.stringify(p,null,2)),await this.sessionService.updateGitStats(this.requestId,{...a.allFiles,testFilesChanged:a.testFiles.filesChanged,testInsertions:a.testFiles.insertions,testDeletions:a.testFiles.deletions,linesChanged:a.allFiles.linesChanged,testLinesChanged:a.testFiles.linesChanged})}async _call(e){try{const t=await this.ensureGitignoreExists();await this.storeRequestSpecJsonFile(e),u.default.info(`Committing changes to git with message: ${e}`),await this.git.add("-A"),t&&(await this.git.add(".gitignore"),e=`${e}\n\nAutomatically added .gitignore file with default patterns`),await this.git.commit(e);const r=`Successfully committed changes with message: ${e}`;return t?`${r}\nNote: Created a new .gitignore file with default patterns`:r}catch(e){return u.default.error("Error in GitCommit tool:",e),`Failed to commit changes: ${e.message}`}}async hasUncommittedUpdates(){try{await this.ensureGitignoreExists();const e=await this.git.status();return u.default.info("Git status: %s",JSON.stringify(e)),e.files.length>0}catch(e){throw u.default.error("Error checking for uncommitted updates:",e),new Error(`Failed to check for uncommitted updates: ${e.message}`)}}async getUncommittedChanges(){try{await this.ensureGitignoreExists();const e=await this.git.status();let t="";const r=await this.git.raw(["rev-parse","--verify","HEAD"]).catch((()=>!1));if(r){const e=await this.git.diff(["HEAD"]);e&&(t+=e)}if(e.not_added.length>0)for(const r of e.not_added)if(l.existsSync(d.join(this.repoBaseDir,r))){const e=l.readFileSync(d.join(this.repoBaseDir,r),"utf8");t+=`\n\nNew file: ${r}\n`,t+=`+++ ${r}\n`,t+=e.split("\n").map((e=>`+ ${e}`)).join("\n")}if(t.length>this.MAX_DIFF_SIZE){u.default.warn("Git diff is too large to summarise - returning just the filenames");let t="";return r&&(t=await this.git.diff(["HEAD","--name-only"])),e.not_added.length>0&&(t+=(t?"\n":"")+"Untracked files:\n"+e.not_added.join("\n")),t}return u.default.debug(`Git diff: ${t}`),t||"No changes detected"}catch(e){throw u.default.error("Error getting uncommitted changes:",e),new Error(`Failed to get uncommitted changes: ${e.message}`)}}}t.GitCommit=h},5017:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SEAgentService=void 0;const a=r(3563),c=r(86158),l=r(93470),d=i(r(19055)),u=r(22300),p=r(55277),f=r(78921);let h=class extends p.GraphAgentService{constructor(e,t,r){super(e,t,r),this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}getName(){return"se-agent"}async getTools(e){const t=["list_files","read_file","update_file","delete_file","command_line","fetch_web_page","read_dependency_source_tree","read_dependency_source_file","git_commit","current_timestamp","grep","find_files","serp_api"];return e.workspace.portFromBaseDir&&t.push("read_port_from_file"),await this.toolFactoryService.createTools(t,e)}async getSystemPrompt(e){const t=await f.EpicsPrompts.updateStoryTasks(e);let r=`As an AI Software Engineer assistant, you are tasked with analysing the software system and answering questions about it and/or making improvements to it.\n  Follow these guidelines:\n  1. Review the file structure tree below and use the read_file tool to answer questions about the system and suggest improvements where appropriate. Provide a concise summary of your findings.\n  2. When making changes to the system:\n     a. First, fetch all the files you think you might need using the read_file tool. For files in the portFromBaseDir, use the read_port_from_file tool. For gradle/maven projects you can also use the read_dependency_source_tree and read_dependency_source_file tools to fetch the source code for dependencies and inspect them to learn how to interact with them.\n     b. Make a clear plan with multiple steps.\n     c. Iterate through the plan, one step at a time.\n     d. Think step-by-step and explain the needed changes in a few short sentences.\n     e. Each change MUST be done by invoking the update_file tool to replace a part of the file with a new bit.\n     f. Before adding new dependencies to a build/dependencies file search the web to look for the latest version - your training data is old :0)\n  3. Use the read_file tool to retrieve the contents of specific files when needed rather than guessing at what they contain.\n     When making edits to previously referenced files, always keep the name/path the same.\n  4. When choosing a file path for generated artifacts, consider the structure and choose a logical location.\n  5. When a specific file name is mentioned, look for it in the structure below and use the read_file tool to get the content of that file.\n  6. Consider the following when suggesting improvements:\n     a. Code organization and structure\n     b. Adherence to best practices and design patterns\n     c. Performance optimizations\n     d. Security considerations\n     e. Scalability and maintainability\n     f. Documentation and comments\n  7. Provide clear explanations for your suggestions and recommendations.\n  8. If you need to create new files or modify existing ones, clearly indicate the file path and content.\n  9. When generating new code or modifying existing code, always look at similar or nearby files in the source tree for guidance on:\n     a. Code style and formatting\n     b. Logging practices\n     c. Error handling\n     d. Import statements and module organization\n     e. Commenting style and docstring format\n     f. Naming conventions for variables, functions, and classes\n     g. Tools, libraries, and frameworks being used\n     h. Your ending summary should be a concise summary of a) which files were updated and b) what changes were made to them.\n  10. To find similar files:\n      a. Examine the file structure provided below.\n      b. Identify files in the same directory or nearby directories with similar purposes or file extensions.\n      c. Use the read_file tool to retrieve the contents of these similar files for reference.\n  11. Ensure that new code generation and modifications align with the existing codebase's style and best practices.\n  12. Do not make assumptions about tools, libraries, or frameworks being used:\n      a. Always fetch and examine similar existing files before creating new ones.\n      b. When adding a new entity or data class, fetch an existing one first and use the same tooling and styles.\n      c. For data migrations, look at an existing migration file to understand the tooling and practices used in the repository.\n      d. Consistently use the same tools and approaches found in the existing codebase.\n  13. When making changes to the system use the update_file tool as follows:\n      a. Always provide the path to the file you want to change (or create) as the first argument.\n      b. The second argument is the SEARCH block - the bit of the existing code you want to replace. For new files this should be an empty string.\n      c. The third argument is the REPLACE block - the bit of the new code you want to replace it with. DO NOT FORGET TO INCLUDE THIS!!\n      d. Always try to minimise the size of the SEARCH block so you are only updating the specific parts of the file that need updating.\n      e. If you need to make edits to multiple parts of a single file, make a plan and do so in a series of update_file calls.\n      f. If you get an error back from the tool saying the search block was not found then you can try again with a larger search block or the entire contents of the file as the search block.\n  14. To delete a file, use the delete_file tool:\n      a. Provide the relative path of the file to delete as the argument.\n      b. Always confirm the file deletion with the user before proceeding.\n  15. When refactoring or renaming files:\n      a. Use the update_file tool to create the new file with the desired content.\n      b. Use the delete_file tool to remove the old file.\n      c. Update any references to the old file in other parts of the codebase using the update_file tool.\n  16. ${e.workspace.isGitRepo?"After making changes to the system, always commit the changes to git using the git_commit tool:\n      a. Use the git_commit tool with a brief, descriptive commit message of the changes you've made.\n      b. The git_commit tool will automatically stage and commit all changes, so you don't need to worry about git add commands.\n  17. If the user asks you to undo or /undo or undo the last changes, inform them that you cannot directly undo git commits, but they can use git reset --hard HEAD~1 in their local environment if needed.":"This workspace is not a git repository. You cannot commit changes or use git commands. Instead, focus on analyzing the code and suggesting improvements without version control operations."}\n  18. You can use the command_line tool to execute commands in the workspace directory${e.workspace.isGitRepo?", but not for git operations":""}. This includes system commands, package managers, build tools, etc. But remember the following:\n      a. Do not traverse up above the workspace directory though and only do things that are safe and can definitely be undone.\n      b. Only use package manager/build commands if you are sure of the correct one. Look in the readme or the build files to find out for sure and if not sure then do not use them. Just say what you might do to complete the task.\n      c. ALWAYS include automatic confirmation flags for interactive commands to prevent hanging:\n         - Use --yes or -y for apt, apt-get\n         - Use -y for yum\n         - Use --no-input for pip\n         - Use -f or --force for npm/pnpm\n         - Use --defaults for yeoman\n         - Use --non-interactive for composer\n         - Use --assume-yes for other tools\n         - Add appropriate silent/quiet flags when available\n  19. You can use the read_dependency_source_tree and read_dependency_source_file tools to fetch the source code for dependencies and inspect them to learn how to interact with them. Look in the build file (e.g. pom.xml or build.gradle) or package metadata (e.g. package.json) and then use that to build the correct scheme and locator.\n  20. Always use the git_commit tool for git operations instead of the command_line tool. The git_commit tool is specifically designed for safe and efficient git operations in this environment.\n      `;return e.workspace.buildOrTestCommand?r+=`\n  21. After making changes to the system, but before committing them to git, consider the following:\n      a. If you have updated any code files (not just scripts, documentation, or other non-code files), you should run the following command to test if the changes haven't broken anything:\n         Use the command_line tool to execute this command: ${e.workspace.buildOrTestCommand}\n      b. If you run the test and any errors occur, try to fix them if it seems feasible.\n      c. If the errors cannot be fixed easily, stop processing and report the error to the user without committing the changes to git.\n      d. If you don't run the test or if the build or test is successful, proceed with committing the changes to git.\n      e. Remember, you only need to run this test command if you've made changes to actual code files, not for changes to scripts, documentation, or other non-code files.`:r+='\n  21. After making changes to the system, but before committing them to git, you need to determine and run the appropriate build/compile command based on the type of code that was modified:\n\n      a. For JavaScript/TypeScript frontend projects:\n         - Look for package.json in the project root or frontend directory\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && pnpm build --force\n           2. cd <project-dir> && pnpm compile --force\n           3. cd <project-dir> && pnpm lint --force\n         \n      b. For Node.js/TypeScript backend projects:\n         - Look for package.json in the project root or backend directory\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && pnpm build --force\n           2. cd <project-dir> && pnpm compile --force\n           3. cd <project-dir> && tsc --noEmit\n           4. cd <project-dir> && pnpm lint --force\n\n      c. For Java/Kotlin projects with Maven:\n         - Look for pom.xml in the project directory\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && ./mvnw compile -DskipTests\n           2. cd <project-dir> && ./mvnw install -DskipTests\n           3. cd <project-dir> && mvn compile -DskipTests\n           4. cd <project-dir> && mvn install -DskipTests\n\n      d. For Java/Kotlin projects with Gradle:\n         - Look for build.gradle or build.gradle.kts\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && ./gradlew compileJava -x test\n           2. cd <project-dir> && ./gradlew classes -x test\n           3. cd <project-dir> && ./gradlew build -x test\n           4. cd <project-dir> && gradle compileJava -x test\n\n      e. For Python projects:\n         - Look for setup.py, pyproject.toml, or requirements.txt\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && python -m compileall .\n           2. cd <project-dir> && pylint --errors-only .\n           3. cd <project-dir> && mypy .\n\n      f. For Go projects:\n         - Look for go.mod file\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && go build ./...\n           2. cd <project-dir> && go vet ./...\n           3. cd <project-dir> && golangci-lint run --fast\n\n      g. For Rust projects:\n         - Look for Cargo.toml\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && cargo check\n           2. cd <project-dir> && cargo build\n           3. cd <project-dir> && cargo clippy\n\n      h. For .NET/C# projects:\n         - Look for .csproj or .sln files\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && dotnet build --no-restore\n           2. cd <project-dir> && dotnet build /p:TreatWarningsAsErrors=true\n\n      IMPORTANT GUIDELINES:\n      1. Always cd into the specific directory where the code was modified before running build commands\n      2. Choose the fastest command that will catch compilation/lint errors (avoid full builds if possible)\n      3. Skip tests (use flags like -DskipTests, -x test, etc.) to keep the build fast\n      4. Add appropriate flags to suppress prompts (--force, -y, etc.)\n      5. If multiple files were modified in different projects, run the appropriate command for each project\n      6. If a build fails, report the error and try to fix it before committing\n      7. Look for project-specific build scripts in package.json scripts section or similar configuration files\n      8. For monorepos, only build the affected packages/projects\n      \n      After successfully building and committing the changes, look for relevant integration tests:\n      1. Use the grep and find_files tools to search for test files related to the components you modified\n      2. Look for test files with names like "*e2e*.ts", "*integration*.ts", "*e2e-spec.ts", "*IntegrationTest.kt|java|py", "*IT.kt|java|py" etc.\n      3. If you find relevant integration tests, suggest running them to the user:\n         - Show the exact command needed to run the specific test(s)\n         - Ask if they would like to execute the test command\n         - If they agree, run the command and help fix any issues that arise\n      4. If no specific integration tests are found, suggest running the general test suite for that part of the codebase (e.g. "cd backend && gradle test" or "cd frontend && pnpm test" etc.)',r+=`\n  \n  Here is the file tree of the system:\n  ${e.repositoryTree()}\n  \n  ${e.portFromSourceTree()?`\n  Here is the "port from" file tree containing another codebase that you can learn from and/or port code from (use read_port_from_file tool to read files from here):\n  ${e.portFromSourceTree()}\n  `:""}\n\n  ${e.repositoryHints()?`Additional hints:\n${e.repositoryHints()}`:""}\n  \n  ${e.workspace.buildOrTestCommand?`Build or Test Command: ${e.workspace.buildOrTestCommand}`:""}\n  \n  IMPORTANT: Keep your final summary concise and to the point. If you have made changes to multiple files, only list the files that have been changed and a short description of the changes for each file.\n  IMPORTANT: When using the update_file tool you MUST provide all 3 arguments: filePath, search & REPLACE. DO NOT FORGET TO INCLUDE THE REPLACE BLOCK!!\n  IMPORTANT: ALWAYS GO LOOKING IN THE CODEBASE AND FETCH ANY FILES YOU THINK YOU NEED TO LEARN FROM BEFORE MAKING CHANGES. DO NOT MAKE ASSUMPTIONS ABOUT WHAT IS IN A FILE - JUST FETCH IT!\n  IMPARTANT: You must NEVER try to stop processes or kill running processes. You must only use the command_line tool to execute commands.\n  IMPORTANT: Always use the update_file tool to make changes to the codebase. Never use the command_line tool to make changes to update source code.\n  IMPORTANT: If asked by the user, you can use the fetch_web_page tool to read the content of a web page. Only use this tool when explicitly requested by the user to fetch a specific URL.\n  IMPORTANT: When using the command_line tool, ALWAYS include automatic confirmation flags (--yes, -y, --force, etc.) for interactive commands to prevent hanging.\n  IMPORTANT: Add appropriate silent/quiet flags to command line operations when available to reduce unnecessary output.\n  \n  ${e.workspace.buildOrTestCommand?`\n    IMPORTANT: Run: ${e.workspace.buildOrTestCommand} to build and test the project after making changes to the code.\n    IMPORTANT: If you get an error then fix it and run the test again until you get it right.\n    IMPORTANT: If the build error relates to a maven/gradle dependency then you should use the read_dependency_source_tree and read_dependency_source_file tools to fetch the source code for the dependency and inspect it to see if you can fix the problem.\n    `:"IMPORTANT: DO NOT FORGET TO RUN AN APPROPRIATE BUILD COMMAND TO VERIFY THAT THE CHANGES YOU HAVE MADE HAVE NOT BROKEN ANYTHING! "}\n  IMPORTANT: IF YOU MADE CODE CHANGES THEN YOU MUST REMEMBER TO COMMIT YOUR CHANGES TO GIT! DO NOT FORGET THIS!\n\n  # Task Management Instructions\n  ${t}\n\n  IMPORTANT: When implementing tasks:\n  1. Always check the task status in the task JSON file before starting work\n  2. Update the task status to "inprogress" when you start working on it\n  3. Update the task status to "done" when you complete it\n  4. Always use current_timestamp to update the updatedAt field when changing task status\n  5. Remember that task status changes may require updating the parent story status\n  `,d.default.debug(`SE Agent system prompt for workspace '${e.workspace.name}' (length: ${r.length} chars): ${r}`),r}};t.SEAgentService=h,t.SEAgentService=h=o([(0,a.Injectable)(),s(0,(0,a.Inject)((0,a.forwardRef)((()=>u.GraphAgentCollaborator)))),n("design:paramtypes",[u.GraphAgentCollaborator,c.ToolFactoryService,l.AgentRuleService])],h)},5025:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentRuleRepository=void 0;const a=r(3563),c=(r(31832),i(r(19055)));let l=class{constructor(e){this.knex=e}async findByAgentName(e){return this.knex("rules").where("agentName",e).first()}async upsert(e){const t=(new Date).toISOString();try{await this.knex("rules").insert({agentName:e.agentName,content:e.content,createdAt:t,updatedAt:t}).onConflict("agentName").merge({content:e.content,updatedAt:t})}catch(t){throw c.default.error("Failed to upsert rule:",{error:t.message,stack:t.stack,rule:e}),t}}};t.AgentRuleRepository=l,t.AgentRuleRepository=l=o([(0,a.Injectable)(),s(0,(0,a.Inject)("KNEX")),n("design:paramtypes",[Function])],l)},5610:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OllamaChunkAdapter=void 0;const n=r(55705),s=o(r(19055));t.OllamaChunkAdapter=class{convertChunk(e){const t=[];try{e.message?.content&&t.push({type:"text",content:e.message.content}),e.done&&((e.prompt_eval_count||e.eval_count)&&t.push({type:"usage",inputTokens:e.prompt_eval_count||0,outputTokens:e.eval_count||0}),t.push({type:"stop",stopReason:this.mapStopReason(e.done_reason)}))}catch(e){throw s.default.warn(`[OllamaChunkAdapter] Failed to convert chunk: ${e.message}`),e}return t}mapStopReason(e){if(!e)return n.NormalizedStopReason.END_TURN;switch(e.toLowerCase()){case"stop":return n.NormalizedStopReason.END_TURN;case"length":return n.NormalizedStopReason.MAX_TOKENS;case"abort":case"cancelled":return n.NormalizedStopReason.ABORTED;default:return s.default.debug(`[OllamaChunkAdapter] Unknown stop reason: ${e}, using STOP`),n.NormalizedStopReason.END_TURN}}isStreamComplete(e){return Boolean(e.done)}extractError(e){return null}}},5754:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GitLogEntry=void 0;t.GitLogEntry=class{constructor(e,t,r,o,n){this.hash=e,this.message=r,this.date=t,this.author_name=o,this.author_email=n}}},6426:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.generateSummaryTree=g,t.generateAdaptiveTree=function(e,t=[]){if(!c.existsSync(e)||!c.statSync(e).isDirectory())return`Error: ${e} is not a valid directory.`;const r=l.join(e,".eveignore");c.existsSync(r)||(!function(e){const t=["# Binary files","*.jpg","*.jpeg","*.png","*.gif","*.ico","*.svg","*.woff","*.woff2","*.ttf","*.eot","*.otf","*.pdf","*.zip","*.tar","*.gz","*.rar","*.7z","*.exe","*.dll","*.so","*.dylib","","# Build and dependency directories","node_modules/","dist/","build/","bin/","target/",".next/",".nuxt/",".output/","coverage/",".nyc_output/",".cache/",".parcel-cache/",".yarn/","","# IDE and editor files",".idea/",".eve/",".hldk/",".vscode/","*.swp","*.swo","*.swn","*.bak","","# Logs and databases","*.log","*.sqlite","*.sqlite3","*.db","logs/","","# Environment and config files",".env",".env.*","!.env.example",".DS_Store","Thumbs.db"].join("\n"),r=l.join(e,".eveignore");c.writeFileSync(r,t),u.default.info("Created default .eveignore file with common ignore patterns")}(e),t=[]);const o=_(e,t);if(o.length<=h)return o;u.default.warn("Large file tree (%d chars) detected for workspace dir: %s",o.length,e),u.default.warn("A .eveignore file has been created/exists in the root of the repository. You can modify it to control which files are included in the tree sent to the agent");let n,s=p;for(;s>=f;){if(n=g(e,t,s),n.length<=h)return u.default.info("Automatically limited file tree to %d items per dir resulting in a tree of %d chars",s,n.length),n;s-=10}return g(e,t,f)},t.generateTree=_,t.generateTreeRecursive=b;const c=i(r(79896)),l=i(r(16928)),d=a(r(30526)),u=a(r(19055)),p=50,f=5,h=3e4,m=3;function g(e,t=[],r=f){if(!c.existsSync(e)||!c.statSync(e).isDirectory())return`Error: ${e} is not a valid directory.`;return v(e,w(e,t),e,"",0,r).trimStart()}function y(e,t,r){const o=c.readdirSync(e).sort(),n={totalFiles:0,totalFolders:0,fileTypes:{}};return o.forEach((o=>{const s=l.join(e,o),i=l.relative(r,s);if(t.ignores(i))return;if(c.statSync(s).isDirectory()){n.totalFolders++;const e=y(s,t,r);n.totalFiles+=e.totalFiles,n.totalFolders+=e.totalFolders,Object.entries(e.fileTypes).forEach((([e,t])=>{n.fileTypes[e]=(n.fileTypes[e]||0)+t}))}else{n.totalFiles++;const e=l.extname(o)||"no-extension";n.fileTypes[e]=(n.fileTypes[e]||0)+1}})),n}function v(e,t,r,o="",n=0,s=f){let i=[];const a=c.readdirSync(e).sort();let d=0,u=0;a.forEach((o=>{const n=l.join(e,o),s=l.relative(r,n);t.ignores(s)||(c.statSync(n).isDirectory()?u++:d++)}));if(n>=m&&d+u>=s){const n=y(e,t,r);i.push(`${o}├── Summary: ${n.totalFiles} files, ${n.totalFolders} folders`),Object.entries(n.fileTypes).sort().forEach((([e,t],r,n)=>{const s=r===n.length-1?"└── ":"├── ",a="no-extension"===e?"files with no extension":`${e} files`;i.push(`${o}│   ${s}${t} ${a}`)}))}else{const d={};a.forEach(((u,p)=>{const f=l.join(e,u),h=l.relative(r,f);if(t.ignores(h))return;const m=c.statSync(f),g=p===a.length-1;if(m.isDirectory())i.push(`${o}${g?"└── ":"├── "}${u}`),i.push(v(f,t,r,o+(g?"    ":"│   "),n+1,s));else{const e=l.extname(u)||"no-extension";d[e]=(d[e]||0)+1,i.push(`${o}${g?"└── ":"├── "}${u}`)}}))}return i.join("\n")}function _(e,t=[]){if(!c.existsSync(e)||!c.statSync(e).isDirectory())return`Error: ${e} is not a valid directory.`;return b(e,w(e,t),e).trimStart()}function w(e,t){const r=(0,d.default)();r.add([".git",".eve",...t]);return[".gitignore",".aiderignore",".clineignore",".cursorignore",".hldkignore",".eveignore"].forEach((t=>{const o=l.join(e,t);if(c.existsSync(o)){const e=c.readFileSync(o,"utf-8");r.add(e)}})),r}function b(e,t,r,o="",n=p){let s=[];const i=c.readdirSync(e).sort();if(i.length>n){const n=y(e,t,r);return s.push(`${o}Summary: ${n.totalFiles} files, ${n.totalFolders} folders`),Object.entries(n.fileTypes).sort().forEach((([e,t],r,n)=>{const i=r===n.length-1?"└── ":"├── ",a="no-extension"===e?"files with no extension":`${e} files`;s.push(`${o}${i}${t} ${a}`)})),s.join("\n")}return i.forEach(((a,d)=>{const u=l.join(e,a),p=l.relative(r,u);if(t.ignores(p))return;const f=d===i.length-1;s.push(`${o}${f?"└── ":"├── "}${a}`),c.statSync(u).isDirectory()&&s.push(b(u,t,r,o+(f?"    ":"│   "),n))})),s.join("\n")}},6695:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ComputerUseAgentService=void 0;const i=r(3563),a=r(93470),c=r(55277),l=r(86158),d=r(22300),u=r(48884);let p=class extends c.GraphAgentService{constructor(e,t,r){super(e,t,r),this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}getName(){return"computer-use-agent"}async getTools(e){return await this.toolFactoryService.createTools(["computer"],e)}async getSystemPrompt(e){const t=process.platform,r="win32"===t?"Windows":"darwin"===t?"macOS":"Linux",o=(0,u.getEnv)("WIDTH"),n=(0,u.getEnv)("HEIGHT");if(!o||!n)throw new Error("Screen resolution environment variables WIDTH and HEIGHT must be set");return`\n    You are a Computer Use Agent specializing in controlling the computer through keyboard and mouse automation. Your task is to help users achieve their goals by controlling the computer interface using the computer tool.\n\n    WORKSPACE INFORMATION:\n    Current operating system: ${r}\n    Screen resolution: ${o}x${n} pixels\n\n    AVAILABLE COMPUTER TOOL FUNCTIONS:\n\n    1. Keyboard Control:\n       - key: Send keyboard key events\n         * Use for special keys and key combinations\n         * Examples: "enter", "tab", "ctrl+c", "shift+a"\n       - type: Type text directly\n         * Use for entering regular text\n         * More reliable than individual key presses for text input\n         * Example: {"action": "type", "text": "Hello World"}\n\n    2. Mouse Control:\n       - mouse_move: Move mouse cursor to specific coordinates\n         * Requires x,y coordinates within screen bounds\n         * Example: {"action": "mouse_move", "coordinate": [100, 200]}\n       - left_click: Click the left mouse button\n         * Use after positioning the cursor\n         * For basic selection and activation\n       - right_click: Click the right mouse button\n         * Use for context menus\n         * Position cursor first\n       - middle_click: Click the middle mouse button\n         * Special functions in some applications\n       - double_click: Double click at current position\n         * Use for opening files/folders\n         * More reliable than two separate clicks\n       - left_click_drag: Click and drag operation\n         * For selections and drag-drop\n         * Requires target coordinates\n         * Example: {"action": "left_click_drag", "coordinate": [300, 400]}\n\n    3. Screen Information:\n       - screenshot: Capture the current screen\n         * Use to verify current state\n         * Helps in debugging automation\n       - cursor_position: Get current mouse coordinates\n         * Use to verify cursor location\n         * Helpful for planning movements\n\n    OPERATIONAL GUIDELINES:\n\n    1. Coordinate System:\n       - Screen coordinates start at (0,0) in top-left corner\n       - X increases right (0 to ${o}), Y increases down (0 to ${n})\n       - All coordinates must stay within screen bounds (0 ≤ x ≤ ${o}, 0 ≤ y ≤ ${n})\n\n    2. Best Practices:\n       - Always verify cursor position before clicking\n       - Use type action for text input when possible\n       - Add small delays between actions if needed\n       - Break complex operations into simple steps\n       - Verify results with screenshots when needed\n\n    3. Safety Considerations:\n       - Avoid rapid mouse movements\n       - Verify coordinates before drag operations\n       - Be cautious with double-clicks\n       - Allow time for system response\n\n    IMPORTANT REMINDERS:\n    1. NEVER guess about what is on the screen - always take a screenshot first to examine the current state\n    2. Take screenshots after performing actions to verify they had the intended effect\n    3. All coordinates must be within screen bounds\n    4. Always verify current state before critical actions\n    5. Use the most appropriate function for each task\n    6. Break complex tasks into simple, verifiable steps\n    7. Consider user confirmation for critical operations\n    8. Remember that screen layout may vary by system\n    9. Be prepared to handle unexpected states\n    10. NEVER assume we need to wait for an operation to complete - if the expected result is not visible in the screenshot, assume the operation did not work\n    \n    WORKFLOW REQUIREMENTS:\n    1. Before making any plan:\n       - Take a screenshot to understand the current state\n       - Analyze the screenshot to identify UI elements and their locations\n       - Only proceed once you have clear visual confirmation of the interface\n    \n    2. After performing actions:\n       - Take another screenshot to verify the results\n       - Compare with expected outcome\n       - If results don't match expectations, adjust your approach\n       \n    3. For complex operations:\n       - Break down into smaller steps\n       - Verify each step with a screenshot before proceeding\n       - Document any unexpected behavior or states`}};t.ComputerUseAgentService=p,t.ComputerUseAgentService=p=o([(0,i.Injectable)(),s(0,(0,i.Inject)((0,i.forwardRef)((()=>d.GraphAgentCollaborator)))),n("design:paramtypes",[d.GraphAgentCollaborator,l.ToolFactoryService,a.AgentRuleService])],p)},7050:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ListCodeDefinitionsToolFactory=void 0;const s=r(3563),i=r(86268),a=r(30873),c=r(41070);let l=class{constructor(e,t){this.treeSitterService=e,this.cacheService=t}getToolName(){return"list_code_definition_names"}create(e){return new i.ListCodeDefinitionsTool(e.workingDir,this.treeSitterService,this.cacheService,{availableInPlan:!0,availableInAct:!0})}};t.ListCodeDefinitionsToolFactory=l,t.ListCodeDefinitionsToolFactory=l=o([(0,s.Injectable)(),n("design:paramtypes",[a.TreeSitterService,c.TreeSitterCacheService])],l)},7252:e=>{"use strict";e.exports=require("express")},7265:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.GitController=void 0;const i=r(3563),a=r(15190);let c=class{constructor(e){this.gitService=e}async getGitLog(e){try{return await this.gitService.getGitLog(e)}catch(t){if(t.message.includes("not found"))throw new i.HttpException(`Workspace ${e} not found`,i.HttpStatus.NOT_FOUND);if(t.message.includes("not a git repository"))throw new i.HttpException("Workspace is not a git repository",i.HttpStatus.BAD_REQUEST);throw new i.HttpException(`Failed to get git log: ${t.message}`,i.HttpStatus.INTERNAL_SERVER_ERROR)}}async getGitDiff(e,t){try{return await this.gitService.getGitDiff(e,t)}catch(t){if(t.message.includes("not found"))throw new i.HttpException(`Workspace ${e} not found`,i.HttpStatus.NOT_FOUND);throw new i.HttpException(`Failed to get git diff: ${t.message}`,i.HttpStatus.INTERNAL_SERVER_ERROR)}}async undoLastCommit(e){try{await this.gitService.undoLastCommit(e)}catch(t){if(t.message.includes("not found"))throw new i.HttpException(`Workspace ${e} not found`,i.HttpStatus.NOT_FOUND);throw new i.HttpException(`Failed to undo last commit: ${t.message}`,i.HttpStatus.INTERNAL_SERVER_ERROR)}}};t.GitController=c,o([(0,i.Get)(":workspaceName/log"),s(0,(0,i.Param)("workspaceName")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"getGitLog",null),o([(0,i.Get)(":workspaceName/diff/:hash"),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Param)("hash")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],c.prototype,"getGitDiff",null),o([(0,i.Post)(":workspaceName/undo-last-commit"),s(0,(0,i.Param)("workspaceName")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"undoLastCommit",null),t.GitController=c=o([(0,i.Controller)("git"),n("design:paramtypes",[a.GitService])],c)},7307:function(__unused_webpack_module,exports,__webpack_require__){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__decorate=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},__importStar=this&&this.__importStar||(ownKeys=function(e){return ownKeys=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},ownKeys(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=ownKeys(e),o=0;o<r.length;o++)"default"!==r[o]&&__createBinding(t,e,r[o]);return __setModuleDefault(t,e),t}),ownKeys,__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},PluginLoaderService_1;Object.defineProperty(exports,"__esModule",{value:!0}),exports.PluginLoaderService=void 0;const common_1=__webpack_require__(3563),fs=__importStar(__webpack_require__(44652)),path=__importStar(__webpack_require__(16928)),graph_agent_collaborator_service_1=__webpack_require__(22300),graph_agent_service_1=__webpack_require__(55277),logger_1=__importDefault(__webpack_require__(19055)),tool_factory_service_1=__webpack_require__(86158),agent_rule_service_1=__webpack_require__(93470);let PluginLoaderService=PluginLoaderService_1=class PluginLoaderService{constructor(e,t,r){this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}async loadPlugins(){const e=[];try{const t=process.env.PLUGIN_DIR||path.join(__dirname,"..","..","plugins");if(logger_1.default.info(`[${PluginLoaderService_1.name}] Loading plugins from: ${t}`),!t)return logger_1.default.info(`[${PluginLoaderService_1.name}] PLUGIN_DIR not set, skipping plugin loading`),e;if(!await fs.pathExists(t))return logger_1.default.warn(`[${PluginLoaderService_1.name}] Plugin directory not found: ${t}`),e;const r=await fs.readdir(t);for(const o of r){const r=path.join(t,o,"plugin-config.json");if(await fs.pathExists(r)){const n=await fs.readJson(r),s=await this.loadPlugin(t,o,n);e.push(...s)}else logger_1.default.warn(`[${PluginLoaderService_1.name}] No plugin-config.json found for plugin: ${o}. Skipping.`)}}catch(e){logger_1.default.error(`[${PluginLoaderService_1.name}] Error loading plugins: ${e.message}\n${e.stack}`)}return e}async loadPlugin(e,t,r){logger_1.default.info(`[${PluginLoaderService_1.name}] Loading plugin: ${t}`);const o=[];if(r.agents)for(const[n,s]of Object.entries(r.agents)){const r=await this.loadAgent(e,t,n,s);r&&o.push(r)}if(r.tools)for(const[o,n]of Object.entries(r.tools))await this.loadTool(e,t,o,n);return r.tests&&await this.runTests(e,t,r.tests),o}async loadAgent(pluginDir,pluginName,agentName,agentFile){const agentPath=path.join(pluginDir,pluginName,agentFile);if(await fs.pathExists(agentPath))try{const AgentModule=eval("require")(agentPath),agentImplementation=AgentModule.default||AgentModule,agent=new graph_agent_service_1.GraphAgentService(this.agentCollaborator,this.toolFactoryService,this.ruleService);for(const e of Object.getOwnPropertyNames(agentImplementation))"function"==typeof agentImplementation[e]&&"constructor"!==e&&(logger_1.default.info(`[${PluginLoaderService_1.name}] Delegating method: ${e} to plugin: ${pluginName}/${agentName}`),agent[e]=async(...t)=>await agentImplementation[e](...t));return agent.getName=()=>agentName,logger_1.default.info(`[${PluginLoaderService_1.name}] Loaded agent: ${agentFile} from plugin: ${pluginName} with name: ${agent.getName()}`),agent}catch(e){logger_1.default.error(`[${PluginLoaderService_1.name}] Error loading agent: ${agentFile} from plugin: ${pluginName}\n${e.stack}`)}else logger_1.default.warn(`[${PluginLoaderService_1.name}] Agent file not found: ${agentPath}`);return null}async loadTool(pluginDir,pluginName,toolName,toolFile){logger_1.default.info(`[${PluginLoaderService_1.name}] Loading tool: ${toolName} (${toolFile}) from plugin: ${pluginName}`);const toolPath=path.join(pluginDir,pluginName,toolFile);if(await fs.pathExists(toolPath))try{const ToolModule=eval("require")(toolPath);"function"==typeof ToolModule.createTool?(this.toolFactoryService.registerTool(toolName,ToolModule.createTool),logger_1.default.info(`[${PluginLoaderService_1.name}] Loaded tool: ${toolName} (${toolFile}) from plugin: ${pluginName}`)):logger_1.default.warn(`[${PluginLoaderService_1.name}] Tool ${toolName} (${toolFile}) from plugin: ${pluginName} does not export a 'createTool' function`)}catch(e){logger_1.default.error(`[${PluginLoaderService_1.name}] Error loading tool: ${toolName} (${toolFile}) from plugin: ${pluginName}\n${e.stack}`)}}async runTests(e,t,r){for(const o of r){const r=path.join(e,t,o);if(await fs.pathExists(r))try{const e=await Promise.resolve(`${r}`).then((e=>__importStar(__webpack_require__(66002)(e))));"function"==typeof e.default&&await e.default(),logger_1.default.info(`[${PluginLoaderService_1.name}] Ran test: ${o} for plugin: ${t}`)}catch(e){logger_1.default.error(`[${PluginLoaderService_1.name}] Error running test: ${o} for plugin: ${t}\n${e.stack}`)}}}};exports.PluginLoaderService=PluginLoaderService,exports.PluginLoaderService=PluginLoaderService=PluginLoaderService_1=__decorate([(0,common_1.Injectable)(),__metadata("design:paramtypes",[graph_agent_collaborator_service_1.GraphAgentCollaborator,tool_factory_service_1.ToolFactoryService,agent_rule_service_1.AgentRuleService])],PluginLoaderService)},7310:e=>{"use strict";e.exports=require("@langchain/community/embeddings/hf_transformers")},7373:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionService=void 0;const i=r(3563),a=r(95312),c=r(10573),l=r(24434),d=r(83936),u=r(99095),p=r(30811),f=s(r(19055)),h=r(59100);let m=class{constructor(e,t,r){this.sessionRepository=e,this.itemRepository=t,this.requestRepository=r,this.eventEmitter=new l.EventEmitter}async getSessions(e=1,t=10,r="createdAt",o="DESC"){const{sessions:n,total:s}=await this.sessionRepository.findAll({page:e,limit:t},{field:r,order:o}),i=n.map((e=>e.sessionId)),a=await this.itemRepository.getSessionStats(i),c=await this.requestRepository.getSessionGitStats(i);return{sessions:n.map((e=>({...e,stats:{inputTokens:0,cacheWriteTokens:0,cacheReadTokens:0,outputTokens:0,totalTokens:0,cost:0,...a[e.sessionId]||{}},gitStats:{filesChanged:0,insertions:0,deletions:0,testFilesChanged:0,testInsertions:0,testDeletions:0,...c[e.sessionId]||{}}}))),total:s}}async getSessionStats(e){return{...(await this.itemRepository.getSessionStats([e]))[e]||{inputTokens:0,cacheWriteTokens:0,cacheReadTokens:0,outputTokens:0,totalTokens:0,cost:0}}}async getRequestStats(e){return{...(await this.itemRepository.getRequestStats([e]))[e]||{inputTokens:0,cacheWriteTokens:0,cacheReadTokens:0,outputTokens:0,totalTokens:0,cost:0}}}async ensureSession(e,t,r,o){const n=await this.sessionRepository.findById(t);if(n){if(n.workspaceName!==e)throw new Error(`Session ${t} exists but belongs to a different workspace`);if("active"===n.status)throw new Error(`Session ${t} is currently active`);return n.requestSnippet||(n.requestSnippet=r.slice(0,250),await this.sessionRepository.update(t,{requestSnippet:n.requestSnippet})),n}const s={sessionId:t,workspaceName:e,status:"inactive",createdAt:new Date,requestSnippet:r.slice(0,250),agent:o};return await this.sessionRepository.create(s),s}async getSession(e){return this.sessionRepository.findById(e)}async deleteSession(e){await this.sessionRepository.delete(e)}async deleteSessionForWorkspace(e,t){await this.sessionRepository.delete(t)}async addItem(e){return"AI"===e.label||"Human"===e.label?f.default.info("Adding item to session: %s with label: %s, content: %s",e.sessionId,e.label,e.content):f.default.debug("Adding item to session %s with label %s, content: %s",e.sessionId,e.label,e.content),await this.itemRepository.create(e),this.eventEmitter.emit("newItem",e),e}async getItemsForSession(e,t=1,r=100,o="ASC"){return[await this.itemRepository.findBySessionId(e,{page:t,limit:r},{field:"createdAt",order:o}),await this.itemRepository.countBySessionId(e)]}streamSessionItems(e){return new c.Observable((t=>{this.getItemsForSession(e).then((([e])=>{e.forEach((e=>{t.next({data:e})}))}));const r=r=>{r.sessionId===e&&t.next({data:r})};return this.eventEmitter.on("newItem",r),()=>{this.eventEmitter.removeListener("newItem",r)}}))}async updateSessionStatus(e,t){await this.sessionRepository.update(e,{status:t})}async abortSession(e){if(!await this.sessionRepository.findById(e))throw new i.NotFoundException(`Session with id ${e} not found`);return await this.updateSessionStatus(e,"aborted"),this.sessionRepository.findById(e)}generateSessionId(){return(0,h.ulid)()}generateItemId(){return(0,h.ulid)()}async addRequest(e){f.default.info("Adding request to session: %s, workspaceName: %s, requestContent: %s",e.sessionId,e.workspaceName,e.requestContent);const t=new a.Request(e.requestId||this.generateRequestId(),e.sessionId,e.workspaceName,e.requestContent,e);return await this.requestRepository.create(t),t}async updateRequest(e,t){return f.default.info("Updating request: %s, updateData: %s",e,JSON.stringify(t)),await this.requestRepository.updateRequest(e,t),this.requestRepository.findById(e)}generateRequestId(){return(0,h.ulid)()}async getRequest(e){return this.requestRepository.findById(e)}async updateGitStats(e,t){f.default.info("Updating git stats for request: %s, gitStats: %s",e,JSON.stringify(t)),await this.requestRepository.updateGitStats(e,t)}};t.SessionService=m,t.SessionService=m=o([(0,i.Injectable)(),n("design:paramtypes",[d.SessionRepository,u.ItemRepository,p.RequestRepository])],m)},7600:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReadDependencySourceTree=void 0;const o=r(83153),n=r(11569);class s extends o.Tool{constructor(e){super(),this.name="read_dependency_source_tree",this.description='Read the source tree hierarchy (directories and file names only) of a dependency, using the package manager scheme (e.g. "maven") and locator (e.g. "com.example:example:1.0.0"). \n  Use this tool if you need to know more about how to use a specific dependency.\n  Look in the build file (e.g. pom.xml or build.gradle) or package metadata (e.g. package.json) and then use that to build the correct scheme and locator.\n  Currently only maven is supported so the scheme is always "maven" and the locator is always a Maven GAV tuple (group:artifact:version).\n  If no repository URLs are provided then the default Maven central repository will be used.\n  ',this.schema=n.z.object({input:n.z.string().describe("A JSON string containing packageManagerScheme, locator, and optional repositoryUrls")}),this.sourceArtefactService=e}async _call(e){const{packageManagerScheme:t,locator:r,repositoryUrls:o}=JSON.parse(e.input);try{return await this.sourceArtefactService.readArtefactSourceTree(t,r,o)}catch(e){return`Error: Unable to read dependency source tree. ${e instanceof Error?e.message:"Unknown error occurred"}`}}}t.ReadDependencySourceTree=s},8047:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReadBuffer=void 0,t.deserializeMessage=n,t.serializeMessage=function(e){return JSON.stringify(e)+"\n"};const o=r(10815);function n(e){return o.JSONRPCMessageSchema.parse(JSON.parse(e))}t.ReadBuffer=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;const e=this._buffer.indexOf("\n");if(-1===e)return null;const t=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),n(t)}clear(){this._buffer=void 0}}},8077:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetService=void 0;const u=r(3563),p=r(79896),f=d(r(19055)),h=c(r(16928)),m=r(74623),g=r(81747),y=r(77184),v=r(26932),_=r(18460),w=r(48884),b=c(r(70857));let k=n=class{constructor(e,t,r){this.datasetRepository=e,this.documentRepository=t,this.indexingService=r}async getAllDatasets(){return this.datasetRepository.findAll()}async getDatasetById(e){return this.datasetRepository.findById(e)}async createDataset(e,t){const r=(0,w.getEnv)("DATASETS_BASE_DIR",h.join(b.homedir(),".eve","datasets")),o=t||h.join(r,e);await p.promises.mkdir(o,{recursive:!0});const n=new m.Dataset(e,o);return await this.datasetRepository.create(n),n}async updateDataset(e,t){await this.datasetRepository.update(e,t)}async deleteDataset(e){const t=await this.documentRepository.findAll(e);for(const e of t)await this.deleteDocument(e.id);await this.datasetRepository.delete(e)}async getDocuments(e){return this.documentRepository.findAll(e)}async getDocumentById(e){return this.documentRepository.findById(e)}async createDocument(e,t,r,o){const s=await this.getDatasetById(e);if(!s)throw new Error("Dataset not found");const i=new g.DatasetDocument(e,t,r);await this.documentRepository.create(i);const a=h.join(s.baseDir,t);return await p.promises.mkdir(h.dirname(a),{recursive:!0}),await p.promises.writeFile(a,o),this.indexingService.indexDocument(i.id,e,a).catch((e=>{f.default.error(`[${n.name}] Failed to index document ${i.id}: ${e.message}\n${e.stack}`)})),i}async updateDocumentStatus(e,t){await this.documentRepository.updateStatus(e,t)}async deleteDocument(e){const t=await this.documentRepository.findById(e);if(!t)throw new Error("Document not found");const r=await this.getDatasetById(t.datasetId);if(!r)throw new Error("Dataset not found");try{await this.indexingService.removeDocumentFromIndex(e,r.name)}catch(t){f.default.error(`[${n.name}] Error removing document ${e} from index:`,t)}const o=h.join(r.baseDir,t.filename);try{await p.promises.unlink(o)}catch(e){f.default.error(`[${n.name}] Error deleting file ${o}:`,e)}await this.documentRepository.delete(e)}};t.DatasetService=k,t.DatasetService=k=n=a([(0,u.Injectable)(),l("design:paramtypes",[y.DatasetRepository,v.DatasetDocumentRepository,_.DatasetIndexingService])],k)},8377:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.EpicsModule=void 0;const n=r(3563),s=r(27781),i=r(38610),a=r(45762),c=r(45873);let l=class{};t.EpicsModule=l,t.EpicsModule=l=o([(0,n.Module)({imports:[c.WorkspaceModule],controllers:[s.EpicsController],providers:[i.EpicsService,a.FileSystemEpicRepository],exports:[i.EpicsService]})],l)},8638:e=>{"use strict";e.exports=/^#!(.*)/},8959:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModelDescriptor=void 0;t.ModelDescriptor=class{constructor(e,t,r,o,n,s,i=!1){this.provider=e,this.name=t,this.costPerInputToken=r,this.costPerCacheWriteToken=o,this.costPerCacheReadToken=n,this.costPerOutputToken=s,this.supportsThinking=i}getFullName(){return`${this.provider}/${this.name}`}}},8984:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.toNumber=s,t.toBoolean=i,t.toArray=a,t.toString=c,t.convertToolParams=function(e,t){const r={};for(const[o,l]of Object.entries(t)){const t=e[o];if(null!=t)try{let e;switch(l.type){case"string":e=c(t,l.default);break;case"number":e=s(t,l.default);break;case"boolean":e=i(t,l.default);break;case"array":e=a(t,l.default);break;default:e=t}if(l.validate&&void 0!==e&&!l.validate(e))throw new Error(`Parameter '${o}' failed validation`);r[o]=e}catch(e){if(e.message.includes("failed validation"))throw e;if(n.default.error(`[convertToolParams] Error converting parameter '${o}': ${e.message}`),l.required)throw new Error(`Failed to convert required parameter '${o}': ${e.message}`);void 0!==l.default&&(r[o]=l.default)}else{if(l.required)throw new Error(`Required parameter '${o}' is missing`);void 0!==l.default&&(r[o]=l.default)}}return r};const n=o(r(19055));function s(e,t){if("number"==typeof e)return e;if("string"==typeof e){const r=e.trim();if(""===r)return t;const o=Number(r);if(!isNaN(o))return o}return t}function i(e,t){if("boolean"==typeof e)return e;if("string"==typeof e){const t=e.trim().toLowerCase();if("true"===t)return!0;if("false"===t)return!1}return t}function a(e,t){if(Array.isArray(e))return e;if("string"==typeof e){const r=e.trim();if(""===r)return t;try{const e=JSON.parse(r);if(Array.isArray(e))return e}catch(e){n.default.debug(`[toArray] Failed to parse as JSON: ${r}`)}return r.includes(",")?r.split(",").map((e=>e.trim())):[r]}return t}function c(e,t){return"string"==typeof e?e.trim():null!=e?String(e):t}},9102:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EveConfigService=void 0;const d=r(3563),u=r(72776),p=a(r(76982)),f=r(52368),h=r(36206),m=r(84105),g=l(r(19055));let y=class{constructor(e,t,r){this.appDataSource=e,this.providerRegistry=t,this.modelHistoryService=r,this.serviceName="EveConfigService",this.encryptionEnabled=!!process.env.API_KEY_ENCRYPTION_SECRET,this.encryptionKey=this.encryptionEnabled?p.scryptSync(process.env.API_KEY_ENCRYPTION_SECRET,"salt",32):Buffer.alloc(32),this.encryptionIv=Buffer.from("1234567890123456"),this.encryptionEnabled?g.default.info(`[${this.serviceName}] API key encryption is enabled`):g.default.warn(`[${this.serviceName}] API key encryption is disabled - API keys will be stored in plain text. Set API_KEY_ENCRYPTION_SECRET to enable encryption.`)}get knex(){return this.appDataSource.knex}async getAllProviders(){try{return(await this.knex("llm_providers").select("*")).map((e=>{const t=this.providerRegistry.getProvider(e.provider_id),r=t?.getProviderMetadata();return{providerId:e.provider_id,name:e.name,defaultModelId:e.default_model_id,defaultBaseUrl:e.default_base_url,requiresApiKey:e.requires_api_key,features:{supportsStreaming:r?.features?.supportsStreaming||!1,supportsCaching:r?.features?.supportsCaching||!1,supportsTools:r?.features?.supportsTools||!1,supportsImages:r?.features?.supportsImages||!1,supportsThinking:r?.features?.supportsThinking||!1,supportsSpeculativeDecoding:r?.features?.supportsSpeculativeDecoding||!1},metadata:e.metadata?JSON.parse(e.metadata):void 0}}))}catch(e){throw g.default.error(`[${this.serviceName}] Failed to get providers: ${e}`),new Error("Failed to get providers")}}async getProvider(e){try{const t=await this.knex("llm_providers").where("provider_id",e).first();if(!t)return null;const r=this.providerRegistry.getProvider(t.provider_id),o=r?.getProviderMetadata();return{providerId:t.provider_id,name:t.name,defaultModelId:t.default_model_id,defaultBaseUrl:t.default_base_url,requiresApiKey:t.requires_api_key,features:{supportsStreaming:o?.features?.supportsStreaming||!1,supportsCaching:o?.features?.supportsCaching||!1,supportsTools:o?.features?.supportsTools||!1,supportsImages:o?.features?.supportsImages||!1,supportsThinking:o?.features?.supportsThinking||!1,supportsSpeculativeDecoding:o?.features?.supportsSpeculativeDecoding||!1},metadata:t.metadata?JSON.parse(t.metadata):void 0}}catch(t){throw g.default.error(`[${this.serviceName}] Failed to get provider ${e}: ${t}`),new Error(`Failed to get provider: ${e}`)}}async getModelsForProvider(e){try{return(await this.knex("llm_models").where("provider_id",e).select("*")).map((e=>({modelId:e.model_id,providerId:e.provider_id,name:e.name,family:e.family,contextWindow:e.context_window,maxOutputTokens:e.max_output_tokens,supportsImages:e.supports_images,supportsToolUse:e.supports_tool_use,supportsComputerUse:e.supports_computer_use,supportsPromptCache:e.supports_prompt_cache,supportsThinkingTokens:e.supports_thinking_tokens||!1,recommendedThinkingTokens:e.recommended_thinking_tokens,maxThinkingTokens:e.max_thinking_tokens,inputCostPerMillionTokens:e.input_cost_per_million_tokens,outputCostPerMillionTokens:e.output_cost_per_million_tokens,cacheWritesPrice:e.cache_writes_price,cacheReadsPrice:e.cache_reads_price,metadata:e.metadata?JSON.parse(e.metadata):void 0,isDefaultForProvider:e.is_default_for_provider})))}catch(t){throw g.default.error(`[${this.serviceName}] Failed to get models for provider ${e}: ${t}`),new Error(`Failed to get models for provider: ${e}`)}}async getModel(e){try{const t=await this.knex("llm_models").where("model_id",e).first();if(!t)return null;let r,o={};if(t.metadata)try{if(o=JSON.parse(t.metadata),o.editToolCapabilities){r=o.editToolCapabilities;const{editToolCapabilities:e,...t}=o;o=t}}catch(e){g.default.warn(`[${this.serviceName}] Failed to parse metadata for model ${t.model_id}: ${e.message}`),o={}}return{modelId:t.model_id,providerId:t.provider_id,name:t.name,contextWindow:t.context_window,maxOutputTokens:t.max_output_tokens,supportsImages:t.supports_images,supportsToolUse:t.supports_tool_use,supportsComputerUse:t.supports_computer_use,supportsPromptCache:t.supports_prompt_cache,supportsThinkingTokens:t.supports_thinking_tokens||!1,recommendedThinkingTokens:t.recommended_thinking_tokens,maxThinkingTokens:t.max_thinking_tokens,inputCostPerMillionTokens:t.input_cost_per_million_tokens,outputCostPerMillionTokens:t.output_cost_per_million_tokens,cacheWritesPrice:t.cache_writes_price,cacheReadsPrice:t.cache_reads_price,editToolCapabilities:r,metadata:o,isDefaultForProvider:t.is_default_for_provider}}catch(t){throw g.default.error(`[${this.serviceName}] Failed to get model ${e}: ${t}`),new Error(`Failed to get model: ${e}`)}}async getAllModes(){try{return(await this.knex("agent_modes").select("*")).map((e=>({modeId:e.mode_id,name:e.name,description:e.description,defaultProviderId:e.default_provider_id,defaultModelId:e.default_model_id,defaultThinkingTokens:e.default_thinking_tokens,defaultBaseUrl:e.default_base_url,defaultApiKeySecretName:e.default_api_key_secret_name})))}catch(e){throw g.default.error(`[${this.serviceName}] Failed to get modes: ${e}`),new Error("Failed to get modes")}}async getMode(e){try{const t=await this.knex("agent_modes").where("mode_id",e).first();return t?{modeId:t.mode_id,name:t.name,description:t.description,defaultProviderId:t.default_provider_id,defaultModelId:t.default_model_id,defaultThinkingTokens:t.default_thinking_tokens,defaultBaseUrl:t.default_base_url,defaultApiKeySecretName:t.default_api_key_secret_name}:null}catch(t){throw g.default.error(`[${this.serviceName}] Failed to get mode ${e}: ${t}`),new Error(`Failed to get mode: ${e}`)}}async getUserConfiguration(e){try{const t=await this.knex("user_llm_configurations").where("user_id",e).select("*"),r=await this.getAllModes(),o={};for(const e of r)o[e.modeId]={activeProviderId:e.defaultProviderId,providerSettings:{}};for(const e of t)o[e.mode_id]||(o[e.mode_id]={activeProviderId:e.provider_id,providerSettings:{}}),e.is_active_for_mode&&(o[e.mode_id].activeProviderId=e.provider_id),o[e.mode_id].providerSettings[e.provider_id]={providerId:e.provider_id,selectedModelId:e.selected_model_id,draftModelId:e.draft_model_id,baseUrl:e.base_url,thinkingTokens:e.thinking_tokens,maxOutputTokens:e.max_output_tokens,apiKey:e.api_key?this.getMaskedApiKey(e.api_key):void 0,isApiKeySet:!!e.api_key};return o}catch(t){throw g.default.error(`[${this.serviceName}] Failed to get user configuration for ${e}: ${t}`),new Error(`Failed to get user configuration: ${e}`)}}async updateUserModeConfiguration(e,t,r,o){try{const n={};let s=!1,i=!1,a=o.selectedModelId,c=o.thinkingTokens;const l=await this.knex("user_llm_configurations").where({user_id:e,mode_id:t,provider_id:r}).first();if(void 0!==o.selectedModelId?""===o.selectedModelId?g.default.warn(`[${this.serviceName}] Attempted to set empty selectedModelId for ${e}, ${t}, ${r}. Skipping model update.`):(n.selected_model_id=o.selectedModelId,l&&l.selected_model_id===o.selectedModelId||(s=!0,a=o.selectedModelId)):l&&(a=l.selected_model_id),void 0!==o.baseUrl&&(n.base_url=o.baseUrl),void 0!==o.thinkingTokens?(n.thinking_tokens=o.thinkingTokens,l&&l.thinking_tokens===o.thinkingTokens||(i=!0,c=o.thinkingTokens)):c=l?l.thinking_tokens:null,void 0!==o.maxOutputTokens&&(n.max_output_tokens=o.maxOutputTokens),void 0!==o.draftModelId&&(n.draft_model_id=o.draftModelId),void 0!==o.apiKey&&(n.api_key=o.apiKey?this.encryptApiKey(o.apiKey):null),l?await this.knex("user_llm_configurations").where({user_id:e,mode_id:t,provider_id:r}).update({...n,updated_at:this.knex.fn.now()}):await this.knex("user_llm_configurations").insert({user_id:e,mode_id:t,provider_id:r,...n,is_active_for_mode:!1}),(s||i)&&a){const o=await this.getModel(a);if(o){const n={userId:e,mode:t,providerId:r,modelId:a,modelName:o.name,thinkingTokensEnabled:!!(c&&c>0),thinkingTokens:c&&c>0?c:0};await this.modelHistoryService.recordModelChoice(n)}}}catch(o){throw g.default.error(`[${this.serviceName}] Failed to update user configuration for ${e}, ${t}, ${r}: ${o.message}`,o.stack),new Error(`Failed to update user configuration: ${e}, ${t}, ${r}`)}}async setActiveProviderForMode(e,t,r){try{await this.knex.transaction((async o=>{await o("user_llm_configurations").where({user_id:e,mode_id:t}).update({is_active_for_mode:!1,updated_at:o.fn.now()});await o("user_llm_configurations").where({user_id:e,mode_id:t,provider_id:r}).first()?await o("user_llm_configurations").where({user_id:e,mode_id:t,provider_id:r}).update({is_active_for_mode:!0,updated_at:o.fn.now()}):await o("user_llm_configurations").insert({user_id:e,mode_id:t,provider_id:r,is_active_for_mode:!0})}));const o=await this.assembleFinalConfiguration(e,t);if(o&&o.modelInfo){const r={userId:e,mode:t,providerId:o.providerId,modelId:o.modelId,modelName:o.modelInfo.name,thinkingTokensEnabled:!!(o.thinkingTokens&&o.thinkingTokens>0),thinkingTokens:o.thinkingTokens&&o.thinkingTokens>0?o.thinkingTokens:0};await this.modelHistoryService.recordModelChoice(r)}}catch(o){throw g.default.error(`[${this.serviceName}] Failed to set active provider for ${e}, ${t}, ${r}: ${o.message}`,o.stack),new Error(`Failed to set active provider: ${e}, ${t}, ${r}`)}}async assembleFinalConfiguration(e,t){try{const r=await this.getMode(t);if(!r)throw new Error(`Mode not found: ${t}`);const o=(await this.getUserConfiguration(e))[t];if(!o){const e=await this.getProvider(r.defaultProviderId);if(!e)throw new Error(`Default provider not found: ${r.defaultProviderId}`);const o=r.defaultModelId||e.defaultModelId;if(!o)throw new Error(`No default model found for mode: ${t} and provider: ${e.providerId}`);const n=await this.getModel(o);if(!n)throw new Error(`Model not found: ${o}`);let s;return r.defaultApiKeySecretName&&(s=process.env[r.defaultApiKeySecretName]),{modeId:t,providerId:e.providerId,modelId:o,baseUrl:r.defaultBaseUrl||e.defaultBaseUrl,apiKey:s,thinkingTokens:this.determineThinkingTokens(r,n),modelInfo:n}}const n=o.activeProviderId,s=await this.getProvider(n);if(!s)throw new Error(`Provider not found: ${n}`);const i=o.providerSettings[n]||{providerId:n,isApiKeySet:!1},a=i.selectedModelId||r.defaultModelId||s.defaultModelId;if(!a)throw new Error(`No model found for mode: ${t} and provider: ${s.providerId}`);const c=await this.getModel(a);if(!c)throw new Error(`Model not found: ${a}`);let l;const d=this.providerRegistry.getProvider(n);if(d.requiresApiKey()){if(i.isApiKeySet){const r=await this.knex("user_llm_configurations").where({user_id:e,mode_id:t,provider_id:n}).select("api_key").first();r&&r.api_key&&(l=this.decryptApiKey(r.api_key),g.default.info(`[${this.serviceName}] Using API key from user configurations for provider ${n}`))}if(!l)try{const e=d.getApiKeyName();if(l=f.ConfigService.getProperty(e),!l)throw new Error(`No API key found for provider ${n}. Please configure an API key in settings or system configuration.`);g.default.info(`[${this.serviceName}] Using API key from ConfigService for provider ${n}`)}catch(e){throw g.default.error(`[${this.serviceName}] Error getting API key for provider ${n}: ${e.message}`),new Error(`No valid API key configuration found for provider ${n}.`)}}else g.default.info(`[${this.serviceName}] Provider ${n} does not require API key`),l=void 0;const u=i.baseUrl||r.defaultBaseUrl||s.defaultBaseUrl,p=this.determineThinkingTokens(r,c,i.thinkingTokens);return{modeId:t,providerId:n,modelId:a,draftModelId:i.draftModelId,baseUrl:u,apiKey:l,thinkingTokens:p,modelInfo:c}}catch(r){throw g.default.error(`[${this.serviceName}] Failed to assemble configuration for ${e}, ${t}: ${r}`),new Error(`Failed to assemble configuration: ${e}, ${t}`)}}determineThinkingTokens(e,t,r){if(t.supportsThinkingTokens)return void 0!==r?r:void 0!==e.defaultThinkingTokens?e.defaultThinkingTokens:void 0!==t.recommendedThinkingTokens?t.recommendedThinkingTokens:2048}encryptApiKey(e){if(!this.encryptionEnabled)return e;try{const t=p.createCipheriv("aes-256-cbc",this.encryptionKey,this.encryptionIv);let r=t.update(e,"utf8","hex");return r+=t.final("hex"),`enc:${r}`}catch(t){return g.default.error(`[${this.serviceName}] Failed to encrypt API key: ${t}`),e}}isEncryptedApiKey(e){return e.startsWith("enc:")}decryptApiKey(e){if(!this.isEncryptedApiKey(e))return e;if(!this.encryptionEnabled)return g.default.warn(`[${this.serviceName}] Found encrypted API key but encryption is not enabled`),e.substring(4);const t=e.substring(4);try{const e=p.createDecipheriv("aes-256-cbc",this.encryptionKey,this.encryptionIv);let r=e.update(t,"hex","utf8");return r+=e.final("utf8"),r}catch(e){return g.default.error(`[${this.serviceName}] Failed to decrypt API key: ${e}`),t}}getMaskedApiKey(e){try{const t=this.decryptApiKey(e);if(t.length<=8)return t;const r=t.substring(0,8);return`${r}${"*".repeat(Math.min(t.length-8,10))}`}catch(e){return g.default.error(`[${this.serviceName}] Failed to mask API key: ${e}`),"********"}}async findApiKeyForProvider(e,t){try{g.default.info(`[${this.serviceName}] Finding API key for user ${e} and provider ${t}`);const r=await this.knex("user_llm_configurations").where({user_id:e,provider_id:t}).whereNotNull("api_key").first();return r&&r.api_key?(g.default.info(`[${this.serviceName}] Found API key for provider ${t} from user ${e}`),{apiKey:this.decryptApiKey(r.api_key),baseUrl:r.base_url}):void g.default.info(`[${this.serviceName}] No API key found for provider ${t} from user ${e}`)}catch(e){return void g.default.error(`[${this.serviceName}] Error finding API key for provider ${t}: ${e.message}`)}}};t.EveConfigService=y,t.EveConfigService=y=i([(0,d.Injectable)(),c("design:paramtypes",[u.AppDataSource,h.ProviderRegistry,m.ModelHistoryService])],y)},9106:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XAI_API_KEY_NAME=t.XAI_BASE_URL=t.XAI_PROVIDER_ID=void 0,t.XAI_PROVIDER_ID="xai",t.XAI_BASE_URL="https://api.x.ai/v1",t.XAI_API_KEY_NAME="XAI_API_KEY"},9109:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNormalizedChunk=function(e){if(!e||"object"!=typeof e)return!1;if(!["thinking","text","usage","stop"].includes(e.type))return!1;if(void 0!==e.content&&"string"!=typeof e.content)return!1;if(void 0!==e.inputTokens&&"number"!=typeof e.inputTokens)return!1;if(void 0!==e.outputTokens&&"number"!=typeof e.outputTokens)return!1;if(void 0!==e.cacheReadTokens&&"number"!=typeof e.cacheReadTokens)return!1;if(void 0!==e.cacheWriteTokens&&"number"!=typeof e.cacheWriteTokens)return!1;if(void 0!==e.stopReason&&!Object.values(o.NormalizedStopReason).includes(e.stopReason))return!1;if(void 0!==e.metadata&&("object"!=typeof e.metadata||null===e.metadata))return!1;return!0},t.isThinkingChunk=function(e){return"thinking"===e.type},t.isTextChunk=function(e){return"text"===e.type},t.isUsageChunk=function(e){return"usage"===e.type},t.isStopChunk=function(e){return"stop"===e.type};const o=r(55705)},9123:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.IssueSeverity=void 0,function(e){e.ERROR="error",e.WARNING="warning",e.INFO="info"}(r||(t.IssueSeverity=r={}))},9581:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MissingToolParameterError=t.InvalidToolParameterError=t.ToolRejectedError=t.CommandExecutionError=t.PermissionError=t.FileNotFoundError=t.FileSystemError=t.ToolExecutionError=t.RateLimitError=t.ContextWindowError=t.ApiError=t.EveAgentError=void 0,t.toEveAgentError=function(e,t="UNKNOWN_ERROR",i="An unknown error occurred."){if(e instanceof r)return e;const a=e?.message||i,c=e?.code||t,l=e?.context||{};if("context_length_exceeded"===c||a.includes("context window")||a.includes("context length")||a.includes("token limit"))return new n(a,l.provider||"unknown",l);if("rate_limit_exceeded"===c||a.includes("rate limit")||a.includes("too many requests"))return new s(a,l.provider||"unknown",e?.retryAfter,l);if(e?.statusCode||e?.status){const t=e?.statusCode||e?.status;return new o(a,c,t,l,function(e){if(!e)return!1;return 429===e||e>=500&&e<600}(t))}return new r(a,c,l)};class r extends Error{constructor(e,t="UNKNOWN_ERROR",o,n=!1){super(e),this.name=this.constructor.name,this.code=t,this.context=o,this.retriable=n,Object.setPrototypeOf(this,r.prototype)}toUserMessage(){return this.message}toLlmMessage(){return`[Error: ${this.code}] ${this.message}`}toJSON(){return{name:this.name,message:this.message,code:this.code,context:this.context,retriable:this.retriable}}}t.EveAgentError=r;class o extends r{constructor(e,t="API_ERROR",r,n,s=!1){super(e,t,n,s),this.statusCode=r,Object.setPrototypeOf(this,o.prototype)}toJSON(){return{...super.toJSON(),statusCode:this.statusCode}}toUserMessage(){return`API Error: ${this.message}${this.statusCode?` (Status: ${this.statusCode})`:""}`}toLlmMessage(){return`[API Error: ${this.code}${this.statusCode?`, Status: ${this.statusCode}`:""}] ${this.message}`}}t.ApiError=o;class n extends o{constructor(e="The context window has been exceeded.",t="unknown",r){super(e,"CONTEXT_WINDOW_EXCEEDED",413,{...r,provider:t},!0),Object.setPrototypeOf(this,n.prototype)}toUserMessage(){return"The conversation history is too large for the AI model. Some older messages will be automatically removed to continue."}toLlmMessage(){return"[Context Window Exceeded] The conversation history was truncated to fit within the model's context window. Some earlier messages have been removed."}}t.ContextWindowError=n;class s extends o{constructor(e="Rate limit exceeded. Please try again later.",t="unknown",r,o){super(e,"RATE_LIMIT_EXCEEDED",429,{...o,provider:t,retryAfterSeconds:r},!0),Object.setPrototypeOf(this,s.prototype)}toUserMessage(){const e=this.context?.retryAfterSeconds;return e?`Rate limit exceeded. Please try again in ${e} seconds.`:"Rate limit exceeded. Please try again later."}}t.RateLimitError=s;class i extends r{constructor(e,t,r="TOOL_EXECUTION_ERROR",o,n=!1){super(e,r,o,n),this.toolName=t,Object.setPrototypeOf(this,i.prototype)}toJSON(){return{...super.toJSON(),toolName:this.toolName}}toUserMessage(){return`Error executing tool '${this.toolName}': ${this.message}`}toLlmMessage(){return`[Tool Error: ${this.code}, Tool: ${this.toolName}] ${this.message}`}}t.ToolExecutionError=i;class a extends i{constructor(e,t,r,o="FILE_SYSTEM_ERROR",n,s=!1){super(e,t,o,{...n,path:r},s),this.path=r,Object.setPrototypeOf(this,a.prototype)}toJSON(){return{...super.toJSON(),path:this.path}}toUserMessage(){return this.path?`Error with file '${this.path}': ${this.message}`:super.toUserMessage()}toLlmMessage(){return this.path?`[File Error: ${this.code}, Path: ${this.path}] ${this.message}`:super.toLlmMessage()}}t.FileSystemError=a;class c extends a{constructor(e,t,r){super(`File not found: ${e}`,t,e,"FILE_NOT_FOUND",r,!1),Object.setPrototypeOf(this,c.prototype)}}t.FileNotFoundError=c;class l extends a{constructor(e,t,r){super(`Permission denied: ${e}`,t,e,"PERMISSION_DENIED",r,!1),Object.setPrototypeOf(this,l.prototype)}}t.PermissionError=l;class d extends i{constructor(e,t,r,o){super(e,"execute_command","COMMAND_EXECUTION_ERROR",{...o,command:t,exitCode:r},!1),this.command=t,this.exitCode=r,Object.setPrototypeOf(this,d.prototype)}toJSON(){return{...super.toJSON(),command:this.command,exitCode:this.exitCode}}toUserMessage(){return this.command?`Error executing command '${this.command}'${this.exitCode?` (Exit code: ${this.exitCode})`:""}: ${this.message}`:super.toUserMessage()}toLlmMessage(){return this.command?`[Command Error${this.exitCode?`, Exit Code: ${this.exitCode}`:""}] Error executing '${this.command}': ${this.message}`:super.toLlmMessage()}}t.CommandExecutionError=d;class u extends i{constructor(e,t){super("The user denied this operation.",e,"TOOL_REJECTED",t,!1),Object.setPrototypeOf(this,u.prototype)}toLlmMessage(){return`[Tool Rejected] The user denied the use of the '${this.toolName}' tool. Consider an alternative approach or ask for more information.`}}t.ToolRejectedError=u;class p extends i{constructor(e,t,r,o){super(r||`Invalid parameter '${e}' for tool '${t}'.`,t,"INVALID_TOOL_PARAMETER",{...o,paramName:e},!1),this.paramName=e,Object.setPrototypeOf(this,p.prototype)}toJSON(){return{...super.toJSON(),paramName:this.paramName}}toLlmMessage(){return`[Invalid Parameter: ${this.paramName}] ${this.message}`}}t.InvalidToolParameterError=p;class f extends p{constructor(e,t,r){super(e,t,`Missing required parameter '${e}' for tool '${t}'.`,r),Object.setPrototypeOf(this,f.prototype)}}t.MissingToolParameterError=f},9833:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DirectoryStructureCacheService=void 0;const a=r(3563),c=i(r(19055)),l=r(91346),d=r(85266),u=r(37526);let p=o=class{constructor(e){this.ignoreConfigService=e,this.cache=new Map,this.maxWorkspaces=3,this.maxDirsPerWorkspace=100}async getDirectoryStructure(e){c.default.debug(`[${o.name}] Getting directory structure for workspace: ${e}`),this.promoteWorkspace(e);return(await this.getOrInitializeWorkspace(e)).directories}async getOrInitializeWorkspace(e){let t=this.cache.get(e);return t&&t.isInitialized||(c.default.info(`[${o.name}] Initializing workspace cache: ${e}`),await this.scanWorkspaceDirectories(e),t=this.cache.get(e)),t}async scanWorkspaceDirectories(e){c.default.debug(`[${o.name}] Scanning workspace directories: ${e}`);try{const t=[d.FileFiltersFactory.defaultRootIgnoreFilter(),this.ignoreConfigService.createGitIgnoreFilter(e),this.ignoreConfigService.createEveIgnoreFilter(e),this.ignoreConfigService.createEveIncludeFilter(e)],r=new l.FileScanner(e),n={rootPath:e,currentDepth:0,stats:{nodesScanned:0,nodesIncluded:0,bytesScanned:0,bytesIncluded:0,estimatedTokens:0}},s=[],i=new Set;for await(const e of r.scan(".",t,n)){if(e.isDir){if(""===e.path)continue;if(!i.has(e.path)){const t=e.path.split("/").length-1;s.push({path:e.path,depth:t}),i.add(e.path)}}if(s.length>=this.maxDirsPerWorkspace)break}s.sort(((e,t)=>e.depth!==t.depth?e.depth-t.depth:e.path.localeCompare(t.path)));const a=s.slice(0,this.maxDirsPerWorkspace);this.cache.set(e,{directories:a,lastScanned:new Date,isInitialized:!0}),c.default.info(`[${o.name}] Scanned and cached ${a.length} directories for workspace: ${e}`)}catch(t){c.default.error(`[${o.name}] Error scanning workspace ${e}: ${t.message}`),this.cache.set(e,{directories:[],lastScanned:new Date,isInitialized:!0})}}promoteWorkspace(e){if(this.cache.has(e)){const t=this.cache.get(e);this.cache.delete(e),this.cache.set(e,t)}this.cache.size>this.maxWorkspaces&&this.evictOldest()}evictOldest(){const e=this.cache.keys().next().value;e&&(this.cache.delete(e),c.default.debug(`[${o.name}] Evicted oldest workspace from cache: ${e}`))}async invalidateWorkspace(e){this.cache.delete(e),c.default.debug(`[${o.name}] Invalidated workspace cache: ${e}`)}async invalidateFile(e,t){await this.invalidateWorkspace(e)}async clearAll(){this.cache.clear(),c.default.debug(`[${o.name}] Cleared all workspace caches`)}getCacheName(){return"DirectoryStructureCache"}};t.DirectoryStructureCacheService=p,t.DirectoryStructureCacheService=p=o=n([(0,a.Injectable)(),s("design:paramtypes",[u.IgnoreConfigService])],p)},9970:e=>{"use strict";e.exports=require("@anthropic-ai/sdk")},10072:e=>{"use strict";e.exports=require("@google/genai")},10146:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AnthropicProvider=void 0;const i=r(3563),a=r(36206),c=s(r(19055)),l=r(160),d=r(40305);let u=class{constructor(e){this.providerRegistry=e,c.default.info("[AnthropicProvider] Initialized"),this.providerRegistry.registerProvider(this)}getId(){return d.ANTHROPIC_PROVIDER_ID}getName(){return"Anthropic"}getMetadata(){return{website:"https://www.anthropic.com",docs_link:"https://docs.anthropic.com"}}requiresApiKey(){return!0}getDefaultBaseUrl(){return this.config?.anthropicBaseUrl||void 0}getDefaultModelId(){return d.DEFAULT_ANTHROPIC_MODEL_ID}getApiKeyName(){return"ANTHROPIC_API_KEY"}setConfig(e){this.config=e}getModelClient(e){const t={...e,baseUrl:this.config?.anthropicBaseUrl||e.baseUrl},r=new l.AnthropicModelClient(t);return this.discoverModels(e.apiKey,t.baseUrl).then((t=>{const o=t.find((t=>t.modelId===e.modelId));o?r.setModelMetadata(o):c.default.warn(`[AnthropicProvider] Metadata not found for model ${e.modelId} during client creation.`)})).catch((t=>{c.default.warn(`[AnthropicProvider] Failed to discover models for client ${e.modelId}: ${t.message}`)})),r}getProviderMetadata(){return{providerId:d.ANTHROPIC_PROVIDER_ID,name:"Anthropic",description:"Anthropic Claude models for advanced reasoning and analysis",website:"https://www.anthropic.com",docsLink:"https://docs.anthropic.com",requiresApiKey:!0,defaultModelId:d.DEFAULT_ANTHROPIC_MODEL_ID,apiKeyName:"ANTHROPIC_API_KEY",features:{supportsStreaming:!0,supportsCaching:!0,supportsTools:!0,supportsImages:!0,supportsThinking:!0}}}getStaticModels(){return(0,d.getStaticAnthropicModels)()}async discoverDynamicModels(e,t,r){return{models:await(0,d.discoverAnthropicModels)(e,t),discoveredAt:new Date,discoveryMethod:"api",source:"https://api.anthropic.com"}}requiresApiKeyForDiscovery(){return!1}async discoverModels(e,t,r){return(0,d.discoverAnthropicModels)(e,t)}};t.AnthropicProvider=u,t.AnthropicProvider=u=o([(0,i.Injectable)(),n("design:paramtypes",[a.ProviderRegistry])],u)},10289:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RecentFilesCacheService=void 0;const u=r(3563),p=r(50461),f=c(r(91943)),h=c(r(16928)),m=d(r(19055)),g=r(44870),y=r(91346),v=r(85266),_=r(37526);let w=n=class{constructor(e,t){this.eventEmitter=e,this.ignoreConfigService=t,this.cache=new Map,this.maxWorkspaces=3,this.maxFilesPerWorkspace=50}async getRecentFiles(e,t=!1){m.default.debug(`[${n.name}] Getting recent files for workspace: ${e}`),this.promoteWorkspace(e);const r=await this.getOrInitializeWorkspace(e),o=t?r.files:r.files.filter((e=>!e.isDirectory));return m.default.debug(`[${n.name}] Returning ${o.length} recent files (directories included: ${t})`),o}async getOrInitializeWorkspace(e){let t=this.cache.get(e);return t&&t.isInitialized||(m.default.info(`[${n.name}] Initializing workspace cache: ${e}`),await this.scanWorkspaceFiles(e),t=this.cache.get(e)),t}async scanWorkspaceFiles(e){m.default.debug(`[${n.name}] Scanning workspace files: ${e}`);try{const t=[v.FileFiltersFactory.defaultRootIgnoreFilter(),this.ignoreConfigService.createGitIgnoreFilter(e),this.ignoreConfigService.createEveIgnoreFilter(e),this.ignoreConfigService.createEveIncludeFilter(e)],r=new y.FileScanner(e),o={rootPath:e,currentDepth:0,limitFilterExcludedFiles:!1,stats:{nodesScanned:0,nodesIncluded:0,bytesScanned:0,bytesIncluded:0,estimatedTokens:0}},s=[];for await(const i of r.scan(".",t,o))try{const t=h.join(e,i.path),r=await f.stat(t);s.push({path:i.path,mtime:r.mtime,isDirectory:i.isDir})}catch(e){m.default.debug(`[${n.name}] Error getting stats for ${i.path}: ${e.message}`)}s.sort(((e,t)=>t.mtime.getTime()-e.mtime.getTime()));const i=s.slice(0,this.maxFilesPerWorkspace);this.cache.set(e,{files:i,lastScanned:new Date,isInitialized:!0}),m.default.info(`[${n.name}] Scanned ${s.length} files, cached ${i.length} most recent for workspace: ${e}`)}catch(t){m.default.error(`[${n.name}] Error scanning workspace ${e}: ${t.message}`),this.cache.set(e,{files:[],lastScanned:new Date,isInitialized:!0})}}async updateFileInCache(e,t,r){m.default.debug(`[${n.name}] Updating file in cache: ${t} in ${e}`);const o=this.cache.get(e);if(o)try{const s=h.join(e,t),i=await f.stat(s);m.default.debug(`[${n.name}] Event timestamp: ${r.toISOString()}, File mtime: ${i.mtime.toISOString()}`);const a=o.files.length;o.files=o.files.filter((e=>e.path!==t));const c=o.files.length;m.default.debug(`[${n.name}] Removed existing entries: ${a} -> ${c}`),o.files.unshift({path:t,mtime:i.mtime,isDirectory:i.isDirectory()}),o.files.length>this.maxFilesPerWorkspace&&(o.files=o.files.slice(0,this.maxFilesPerWorkspace)),m.default.debug(`[${n.name}] Updated cache entry for ${t}, cache now has ${o.files.length} files`),m.default.debug(`[${n.name}] Cache order after update: ${o.files.map((e=>e.path)).join(", ")}`)}catch(e){m.default.error(`[${n.name}] Error updating file in cache: ${e.message}`)}else m.default.debug(`[${n.name}] Cache not initialized for workspace: ${e}`)}async removeFileFromCache(e,t){m.default.debug(`[${n.name}] Removing file from cache: ${t} in ${e}`);const r=this.cache.get(e);if(!r)return void m.default.debug(`[${n.name}] No workspace data found for: ${e}`);const o=r.files.length;m.default.debug(`[${n.name}] Cache before deletion: ${r.files.map((e=>e.path)).join(", ")}`),r.files=r.files.filter((e=>e.path!==t)),r.files.length!==o?(m.default.debug(`[${n.name}] Removed ${t} from cache, ${r.files.length} files remaining`),m.default.debug(`[${n.name}] Cache after deletion: ${r.files.map((e=>e.path)).join(", ")}`)):m.default.debug(`[${n.name}] File ${t} was not found in cache to remove`)}promoteWorkspace(e){if(this.cache.has(e)){const t=this.cache.get(e);this.cache.delete(e),this.cache.set(e,t)}this.cache.size>this.maxWorkspaces&&this.evictOldest()}evictOldest(){const e=this.cache.keys().next().value;e&&(this.cache.delete(e),m.default.debug(`[${n.name}] Evicted oldest workspace from cache: ${e}`))}async handleFileModified(e){m.default.debug(`[${n.name}] EVENT: File modified - ${e.filePath} in ${e.workspacePath}`),await this.updateFileInCache(e.workspacePath,e.filePath,e.timestamp)}async handleFileCreated(e){m.default.debug(`[${n.name}] EVENT: File created - ${e.filePath} in ${e.workspacePath}`),await this.updateFileInCache(e.workspacePath,e.filePath,e.timestamp)}async handleFileDeleted(e){m.default.debug(`[${n.name}] EVENT: File deleted - ${e.filePath} in ${e.workspacePath}`),await this.removeFileFromCache(e.workspacePath,e.filePath)}async invalidateWorkspace(e){this.cache.delete(e),m.default.debug(`[${n.name}] Invalidated workspace cache: ${e}`)}async invalidateFile(e,t){await this.updateFileInCache(e,t,new Date)}async clearAll(){this.cache.clear(),m.default.debug(`[${n.name}] Cleared all workspace caches`)}getCacheName(){return"RecentFilesCache"}};t.RecentFilesCacheService=w,a([(0,p.OnEvent)(g.FILE_SYSTEM_EVENTS.FILE_MODIFIED),l("design:type",Function),l("design:paramtypes",[g.FileModifiedEvent]),l("design:returntype",Promise)],w.prototype,"handleFileModified",null),a([(0,p.OnEvent)(g.FILE_SYSTEM_EVENTS.FILE_CREATED),l("design:type",Function),l("design:paramtypes",[g.FileCreatedEvent]),l("design:returntype",Promise)],w.prototype,"handleFileCreated",null),a([(0,p.OnEvent)(g.FILE_SYSTEM_EVENTS.FILE_DELETED),l("design:type",Function),l("design:paramtypes",[g.FileDeletedEvent]),l("design:returntype",Promise)],w.prototype,"handleFileDeleted",null),t.RecentFilesCacheService=w=n=a([(0,u.Injectable)(),l("design:paramtypes",[p.EventEmitter2,_.IgnoreConfigService])],w)},10573:e=>{"use strict";e.exports=require("rxjs")},10646:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentRegistry=void 0;const s=r(3563),i=r(18557),a=r(81373),c=r(83622),l=r(76662),d=r(50150),u=r(78882);let p=class{constructor(){this.components=new Map,this.registerDefaultComponents()}registerDefaultComponents(){const e=[new i.ToolUseGuidelinesComponent,new a.PlanVsActComponent,new c.GeneralAgentBehaviorComponent,new l.ObjectiveComponent,new d.UserRulesComponent,new u.WorkspaceFilesComponent];for(const t of e)this.components.set(t.id,t)}getComponent(e){return this.components.get(e)}getAllComponents(){return Array.from(this.components.values())}getComponentsByCategory(e){return this.getAllComponents().filter((t=>t.category===e))}getRequiredComponents(){return this.getComponentsByCategory("required")}getOptionalComponents(){return this.getComponentsByCategory("optional")}registerComponent(e){this.components.set(e.id,e)}getDefaultEnabledOptionalComponents(){return this.getOptionalComponents().filter((e=>e.defaultEnabled)).map((e=>e.id))}};t.ComponentRegistry=p,t.ComponentRegistry=p=o([(0,s.Injectable)(),n("design:paramtypes",[])],p)},10815:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromptArgumentSchema=t.ResourceUpdatedNotificationSchema=t.UnsubscribeRequestSchema=t.SubscribeRequestSchema=t.ResourceListChangedNotificationSchema=t.ReadResourceResultSchema=t.ReadResourceRequestSchema=t.ListResourceTemplatesResultSchema=t.ListResourceTemplatesRequestSchema=t.ListResourcesResultSchema=t.ListResourcesRequestSchema=t.ResourceTemplateSchema=t.ResourceSchema=t.BlobResourceContentsSchema=t.TextResourceContentsSchema=t.ResourceContentsSchema=t.PaginatedResultSchema=t.PaginatedRequestSchema=t.ProgressNotificationSchema=t.ProgressSchema=t.PingRequestSchema=t.isInitializedNotification=t.InitializedNotificationSchema=t.InitializeResultSchema=t.ServerCapabilitiesSchema=t.isInitializeRequest=t.InitializeRequestSchema=t.ClientCapabilitiesSchema=t.ImplementationSchema=t.CancelledNotificationSchema=t.EmptyResultSchema=t.JSONRPCMessageSchema=t.isJSONRPCError=t.JSONRPCErrorSchema=t.ErrorCode=t.isJSONRPCResponse=t.JSONRPCResponseSchema=t.isJSONRPCNotification=t.JSONRPCNotificationSchema=t.isJSONRPCRequest=t.JSONRPCRequestSchema=t.RequestIdSchema=t.ResultSchema=t.NotificationSchema=t.RequestSchema=t.CursorSchema=t.ProgressTokenSchema=t.JSONRPC_VERSION=t.SUPPORTED_PROTOCOL_VERSIONS=t.LATEST_PROTOCOL_VERSION=void 0,t.McpError=t.ServerResultSchema=t.ServerNotificationSchema=t.ServerRequestSchema=t.ClientResultSchema=t.ClientNotificationSchema=t.ClientRequestSchema=t.RootsListChangedNotificationSchema=t.ListRootsResultSchema=t.ListRootsRequestSchema=t.RootSchema=t.CompleteResultSchema=t.CompleteRequestSchema=t.PromptReferenceSchema=t.ResourceReferenceSchema=t.CreateMessageResultSchema=t.CreateMessageRequestSchema=t.SamplingMessageSchema=t.ModelPreferencesSchema=t.ModelHintSchema=t.LoggingMessageNotificationSchema=t.SetLevelRequestSchema=t.LoggingLevelSchema=t.ToolListChangedNotificationSchema=t.CallToolRequestSchema=t.CompatibilityCallToolResultSchema=t.CallToolResultSchema=t.ListToolsResultSchema=t.ListToolsRequestSchema=t.ToolSchema=t.PromptListChangedNotificationSchema=t.GetPromptResultSchema=t.PromptMessageSchema=t.EmbeddedResourceSchema=t.AudioContentSchema=t.ImageContentSchema=t.TextContentSchema=t.GetPromptRequestSchema=t.ListPromptsResultSchema=t.ListPromptsRequestSchema=t.PromptSchema=void 0;const o=r(11569);t.LATEST_PROTOCOL_VERSION="2024-11-05",t.SUPPORTED_PROTOCOL_VERSIONS=[t.LATEST_PROTOCOL_VERSION,"2024-10-07"],t.JSONRPC_VERSION="2.0",t.ProgressTokenSchema=o.z.union([o.z.string(),o.z.number().int()]),t.CursorSchema=o.z.string();const n=o.z.object({_meta:o.z.optional(o.z.object({progressToken:o.z.optional(t.ProgressTokenSchema)}).passthrough())}).passthrough();t.RequestSchema=o.z.object({method:o.z.string(),params:o.z.optional(n)});const s=o.z.object({_meta:o.z.optional(o.z.object({}).passthrough())}).passthrough();t.NotificationSchema=o.z.object({method:o.z.string(),params:o.z.optional(s)}),t.ResultSchema=o.z.object({_meta:o.z.optional(o.z.object({}).passthrough())}).passthrough(),t.RequestIdSchema=o.z.union([o.z.string(),o.z.number().int()]),t.JSONRPCRequestSchema=o.z.object({jsonrpc:o.z.literal(t.JSONRPC_VERSION),id:t.RequestIdSchema}).merge(t.RequestSchema).strict();t.isJSONRPCRequest=e=>t.JSONRPCRequestSchema.safeParse(e).success,t.JSONRPCNotificationSchema=o.z.object({jsonrpc:o.z.literal(t.JSONRPC_VERSION)}).merge(t.NotificationSchema).strict();t.isJSONRPCNotification=e=>t.JSONRPCNotificationSchema.safeParse(e).success,t.JSONRPCResponseSchema=o.z.object({jsonrpc:o.z.literal(t.JSONRPC_VERSION),id:t.RequestIdSchema,result:t.ResultSchema}).strict();var i;t.isJSONRPCResponse=e=>t.JSONRPCResponseSchema.safeParse(e).success,function(e){e[e.ConnectionClosed=-32e3]="ConnectionClosed",e[e.RequestTimeout=-32001]="RequestTimeout",e[e.ParseError=-32700]="ParseError",e[e.InvalidRequest=-32600]="InvalidRequest",e[e.MethodNotFound=-32601]="MethodNotFound",e[e.InvalidParams=-32602]="InvalidParams",e[e.InternalError=-32603]="InternalError"}(i||(t.ErrorCode=i={})),t.JSONRPCErrorSchema=o.z.object({jsonrpc:o.z.literal(t.JSONRPC_VERSION),id:t.RequestIdSchema,error:o.z.object({code:o.z.number().int(),message:o.z.string(),data:o.z.optional(o.z.unknown())})}).strict();t.isJSONRPCError=e=>t.JSONRPCErrorSchema.safeParse(e).success,t.JSONRPCMessageSchema=o.z.union([t.JSONRPCRequestSchema,t.JSONRPCNotificationSchema,t.JSONRPCResponseSchema,t.JSONRPCErrorSchema]),t.EmptyResultSchema=t.ResultSchema.strict(),t.CancelledNotificationSchema=t.NotificationSchema.extend({method:o.z.literal("notifications/cancelled"),params:s.extend({requestId:t.RequestIdSchema,reason:o.z.string().optional()})}),t.ImplementationSchema=o.z.object({name:o.z.string(),version:o.z.string()}).passthrough(),t.ClientCapabilitiesSchema=o.z.object({experimental:o.z.optional(o.z.object({}).passthrough()),sampling:o.z.optional(o.z.object({}).passthrough()),roots:o.z.optional(o.z.object({listChanged:o.z.optional(o.z.boolean())}).passthrough())}).passthrough(),t.InitializeRequestSchema=t.RequestSchema.extend({method:o.z.literal("initialize"),params:n.extend({protocolVersion:o.z.string(),capabilities:t.ClientCapabilitiesSchema,clientInfo:t.ImplementationSchema})});t.isInitializeRequest=e=>t.InitializeRequestSchema.safeParse(e).success,t.ServerCapabilitiesSchema=o.z.object({experimental:o.z.optional(o.z.object({}).passthrough()),logging:o.z.optional(o.z.object({}).passthrough()),completions:o.z.optional(o.z.object({}).passthrough()),prompts:o.z.optional(o.z.object({listChanged:o.z.optional(o.z.boolean())}).passthrough()),resources:o.z.optional(o.z.object({subscribe:o.z.optional(o.z.boolean()),listChanged:o.z.optional(o.z.boolean())}).passthrough()),tools:o.z.optional(o.z.object({listChanged:o.z.optional(o.z.boolean())}).passthrough())}).passthrough(),t.InitializeResultSchema=t.ResultSchema.extend({protocolVersion:o.z.string(),capabilities:t.ServerCapabilitiesSchema,serverInfo:t.ImplementationSchema,instructions:o.z.optional(o.z.string())}),t.InitializedNotificationSchema=t.NotificationSchema.extend({method:o.z.literal("notifications/initialized")});t.isInitializedNotification=e=>t.InitializedNotificationSchema.safeParse(e).success,t.PingRequestSchema=t.RequestSchema.extend({method:o.z.literal("ping")}),t.ProgressSchema=o.z.object({progress:o.z.number(),total:o.z.optional(o.z.number())}).passthrough(),t.ProgressNotificationSchema=t.NotificationSchema.extend({method:o.z.literal("notifications/progress"),params:s.merge(t.ProgressSchema).extend({progressToken:t.ProgressTokenSchema})}),t.PaginatedRequestSchema=t.RequestSchema.extend({params:n.extend({cursor:o.z.optional(t.CursorSchema)}).optional()}),t.PaginatedResultSchema=t.ResultSchema.extend({nextCursor:o.z.optional(t.CursorSchema)}),t.ResourceContentsSchema=o.z.object({uri:o.z.string(),mimeType:o.z.optional(o.z.string())}).passthrough(),t.TextResourceContentsSchema=t.ResourceContentsSchema.extend({text:o.z.string()}),t.BlobResourceContentsSchema=t.ResourceContentsSchema.extend({blob:o.z.string().base64()}),t.ResourceSchema=o.z.object({uri:o.z.string(),name:o.z.string(),description:o.z.optional(o.z.string()),mimeType:o.z.optional(o.z.string())}).passthrough(),t.ResourceTemplateSchema=o.z.object({uriTemplate:o.z.string(),name:o.z.string(),description:o.z.optional(o.z.string()),mimeType:o.z.optional(o.z.string())}).passthrough(),t.ListResourcesRequestSchema=t.PaginatedRequestSchema.extend({method:o.z.literal("resources/list")}),t.ListResourcesResultSchema=t.PaginatedResultSchema.extend({resources:o.z.array(t.ResourceSchema)}),t.ListResourceTemplatesRequestSchema=t.PaginatedRequestSchema.extend({method:o.z.literal("resources/templates/list")}),t.ListResourceTemplatesResultSchema=t.PaginatedResultSchema.extend({resourceTemplates:o.z.array(t.ResourceTemplateSchema)}),t.ReadResourceRequestSchema=t.RequestSchema.extend({method:o.z.literal("resources/read"),params:n.extend({uri:o.z.string()})}),t.ReadResourceResultSchema=t.ResultSchema.extend({contents:o.z.array(o.z.union([t.TextResourceContentsSchema,t.BlobResourceContentsSchema]))}),t.ResourceListChangedNotificationSchema=t.NotificationSchema.extend({method:o.z.literal("notifications/resources/list_changed")}),t.SubscribeRequestSchema=t.RequestSchema.extend({method:o.z.literal("resources/subscribe"),params:n.extend({uri:o.z.string()})}),t.UnsubscribeRequestSchema=t.RequestSchema.extend({method:o.z.literal("resources/unsubscribe"),params:n.extend({uri:o.z.string()})}),t.ResourceUpdatedNotificationSchema=t.NotificationSchema.extend({method:o.z.literal("notifications/resources/updated"),params:s.extend({uri:o.z.string()})}),t.PromptArgumentSchema=o.z.object({name:o.z.string(),description:o.z.optional(o.z.string()),required:o.z.optional(o.z.boolean())}).passthrough(),t.PromptSchema=o.z.object({name:o.z.string(),description:o.z.optional(o.z.string()),arguments:o.z.optional(o.z.array(t.PromptArgumentSchema))}).passthrough(),t.ListPromptsRequestSchema=t.PaginatedRequestSchema.extend({method:o.z.literal("prompts/list")}),t.ListPromptsResultSchema=t.PaginatedResultSchema.extend({prompts:o.z.array(t.PromptSchema)}),t.GetPromptRequestSchema=t.RequestSchema.extend({method:o.z.literal("prompts/get"),params:n.extend({name:o.z.string(),arguments:o.z.optional(o.z.record(o.z.string()))})}),t.TextContentSchema=o.z.object({type:o.z.literal("text"),text:o.z.string()}).passthrough(),t.ImageContentSchema=o.z.object({type:o.z.literal("image"),data:o.z.string().base64(),mimeType:o.z.string()}).passthrough(),t.AudioContentSchema=o.z.object({type:o.z.literal("audio"),data:o.z.string().base64(),mimeType:o.z.string()}).passthrough(),t.EmbeddedResourceSchema=o.z.object({type:o.z.literal("resource"),resource:o.z.union([t.TextResourceContentsSchema,t.BlobResourceContentsSchema])}).passthrough(),t.PromptMessageSchema=o.z.object({role:o.z.enum(["user","assistant"]),content:o.z.union([t.TextContentSchema,t.ImageContentSchema,t.AudioContentSchema,t.EmbeddedResourceSchema])}).passthrough(),t.GetPromptResultSchema=t.ResultSchema.extend({description:o.z.optional(o.z.string()),messages:o.z.array(t.PromptMessageSchema)}),t.PromptListChangedNotificationSchema=t.NotificationSchema.extend({method:o.z.literal("notifications/prompts/list_changed")}),t.ToolSchema=o.z.object({name:o.z.string(),description:o.z.optional(o.z.string()),inputSchema:o.z.object({type:o.z.literal("object"),properties:o.z.optional(o.z.object({}).passthrough())}).passthrough()}).passthrough(),t.ListToolsRequestSchema=t.PaginatedRequestSchema.extend({method:o.z.literal("tools/list")}),t.ListToolsResultSchema=t.PaginatedResultSchema.extend({tools:o.z.array(t.ToolSchema)}),t.CallToolResultSchema=t.ResultSchema.extend({content:o.z.array(o.z.union([t.TextContentSchema,t.ImageContentSchema,t.AudioContentSchema,t.EmbeddedResourceSchema])),isError:o.z.boolean().default(!1).optional()}),t.CompatibilityCallToolResultSchema=t.CallToolResultSchema.or(t.ResultSchema.extend({toolResult:o.z.unknown()})),t.CallToolRequestSchema=t.RequestSchema.extend({method:o.z.literal("tools/call"),params:n.extend({name:o.z.string(),arguments:o.z.optional(o.z.record(o.z.unknown()))})}),t.ToolListChangedNotificationSchema=t.NotificationSchema.extend({method:o.z.literal("notifications/tools/list_changed")}),t.LoggingLevelSchema=o.z.enum(["debug","info","notice","warning","error","critical","alert","emergency"]),t.SetLevelRequestSchema=t.RequestSchema.extend({method:o.z.literal("logging/setLevel"),params:n.extend({level:t.LoggingLevelSchema})}),t.LoggingMessageNotificationSchema=t.NotificationSchema.extend({method:o.z.literal("notifications/message"),params:s.extend({level:t.LoggingLevelSchema,logger:o.z.optional(o.z.string()),data:o.z.unknown()})}),t.ModelHintSchema=o.z.object({name:o.z.string().optional()}).passthrough(),t.ModelPreferencesSchema=o.z.object({hints:o.z.optional(o.z.array(t.ModelHintSchema)),costPriority:o.z.optional(o.z.number().min(0).max(1)),speedPriority:o.z.optional(o.z.number().min(0).max(1)),intelligencePriority:o.z.optional(o.z.number().min(0).max(1))}).passthrough(),t.SamplingMessageSchema=o.z.object({role:o.z.enum(["user","assistant"]),content:o.z.union([t.TextContentSchema,t.ImageContentSchema,t.AudioContentSchema])}).passthrough(),t.CreateMessageRequestSchema=t.RequestSchema.extend({method:o.z.literal("sampling/createMessage"),params:n.extend({messages:o.z.array(t.SamplingMessageSchema),systemPrompt:o.z.optional(o.z.string()),includeContext:o.z.optional(o.z.enum(["none","thisServer","allServers"])),temperature:o.z.optional(o.z.number()),maxTokens:o.z.number().int(),stopSequences:o.z.optional(o.z.array(o.z.string())),metadata:o.z.optional(o.z.object({}).passthrough()),modelPreferences:o.z.optional(t.ModelPreferencesSchema)})}),t.CreateMessageResultSchema=t.ResultSchema.extend({model:o.z.string(),stopReason:o.z.optional(o.z.enum(["endTurn","stopSequence","maxTokens"]).or(o.z.string())),role:o.z.enum(["user","assistant"]),content:o.z.discriminatedUnion("type",[t.TextContentSchema,t.ImageContentSchema,t.AudioContentSchema])}),t.ResourceReferenceSchema=o.z.object({type:o.z.literal("ref/resource"),uri:o.z.string()}).passthrough(),t.PromptReferenceSchema=o.z.object({type:o.z.literal("ref/prompt"),name:o.z.string()}).passthrough(),t.CompleteRequestSchema=t.RequestSchema.extend({method:o.z.literal("completion/complete"),params:n.extend({ref:o.z.union([t.PromptReferenceSchema,t.ResourceReferenceSchema]),argument:o.z.object({name:o.z.string(),value:o.z.string()}).passthrough()})}),t.CompleteResultSchema=t.ResultSchema.extend({completion:o.z.object({values:o.z.array(o.z.string()).max(100),total:o.z.optional(o.z.number().int()),hasMore:o.z.optional(o.z.boolean())}).passthrough()}),t.RootSchema=o.z.object({uri:o.z.string().startsWith("file://"),name:o.z.optional(o.z.string())}).passthrough(),t.ListRootsRequestSchema=t.RequestSchema.extend({method:o.z.literal("roots/list")}),t.ListRootsResultSchema=t.ResultSchema.extend({roots:o.z.array(t.RootSchema)}),t.RootsListChangedNotificationSchema=t.NotificationSchema.extend({method:o.z.literal("notifications/roots/list_changed")}),t.ClientRequestSchema=o.z.union([t.PingRequestSchema,t.InitializeRequestSchema,t.CompleteRequestSchema,t.SetLevelRequestSchema,t.GetPromptRequestSchema,t.ListPromptsRequestSchema,t.ListResourcesRequestSchema,t.ListResourceTemplatesRequestSchema,t.ReadResourceRequestSchema,t.SubscribeRequestSchema,t.UnsubscribeRequestSchema,t.CallToolRequestSchema,t.ListToolsRequestSchema]),t.ClientNotificationSchema=o.z.union([t.CancelledNotificationSchema,t.ProgressNotificationSchema,t.InitializedNotificationSchema,t.RootsListChangedNotificationSchema]),t.ClientResultSchema=o.z.union([t.EmptyResultSchema,t.CreateMessageResultSchema,t.ListRootsResultSchema]),t.ServerRequestSchema=o.z.union([t.PingRequestSchema,t.CreateMessageRequestSchema,t.ListRootsRequestSchema]),t.ServerNotificationSchema=o.z.union([t.CancelledNotificationSchema,t.ProgressNotificationSchema,t.LoggingMessageNotificationSchema,t.ResourceUpdatedNotificationSchema,t.ResourceListChangedNotificationSchema,t.ToolListChangedNotificationSchema,t.PromptListChangedNotificationSchema]),t.ServerResultSchema=o.z.union([t.EmptyResultSchema,t.InitializeResultSchema,t.CompleteResultSchema,t.GetPromptResultSchema,t.ListPromptsResultSchema,t.ListResourcesResultSchema,t.ListResourceTemplatesResultSchema,t.ReadResourceResultSchema,t.CallToolResultSchema,t.ListToolsResultSchema]);class a extends Error{constructor(e,t,r){super(`MCP error ${e}: ${t}`),this.code=e,this.data=r,this.name="McpError"}}t.McpError=a},10889:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CustomPersona=void 0;t.CustomPersona=class{constructor(e){this.config=e}getId(){return this.config.id}getName(){return this.config.name}getConfiguration(){return{id:this.getId(),name:this.getName(),corePrompt:this.config.systemPrompt,specificInstructions:void 0,requiredComponents:["tool-use-guidelines","plan-vs-act"],optionalComponents:this.config.enabledOptionalComponents,toolNames:this.getAllToolNames()}}getAllToolNames(){return[...this.config.enabledTools]}getToolNamesForMode(e,t){return this.getAllToolNames()}}},10904:e=>{"use strict";e.exports=require("mime-types")},11438:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TraditionalDiffStrategy=void 0;const n=r(9581),s=r(37978),i=o(r(19055));t.TraditionalDiffStrategy=class{constructor(){this.name="traditional"}canHandle(e){const t=e.trim();return t.includes("SEARCH")&&(t.includes("REPLACE")||t.includes("======="))}parse(e,t){const r=e.trim();if(""===r){const e=s.ERROR_MESSAGES.EMPTY_DIFF;throw i.default.error(`[TraditionalDiffStrategy] ${e}`),new n.FileSystemError(e,s.ERROR_TYPES.DIFF_PARSE_ERROR_NO_BLOCKS)}const o=[],a=r.split(s.DIFF_MARKERS.SEARCH_START);if(1===a.length&&!r.startsWith(s.DIFF_MARKERS.SEARCH_START)){if(r.includes(s.DIFF_MARKERS.SEARCH_START)&&!r.includes(s.DIFF_MARKERS.REPLACE_END)){const e=s.ERROR_MESSAGES.INCOMPLETE_DIFF;throw i.default.error(`[TraditionalDiffStrategy] ${e}`),new n.FileSystemError(e,s.ERROR_TYPES.DIFF_PARSE_ERROR_INCOMPLETE)}const e=`${s.ERROR_MESSAGES.INVALID_FORMAT} near "${r.substring(0,30)}..."`;throw i.default.error(`[TraditionalDiffStrategy] ${e}`),new n.FileSystemError(e,s.ERROR_TYPES.DIFF_PARSE_ERROR_TRAILING_TEXT)}if(""!==a[0].trim()){const e=`${s.ERROR_MESSAGES.INVALID_FORMAT} near "${a[0].substring(0,30)}${a[0].length>30?"...":""}"`;throw i.default.error(`[TraditionalDiffStrategy] ${e}`),new n.FileSystemError(e,s.ERROR_TYPES.DIFF_PARSE_ERROR_TRAILING_TEXT)}for(let e=1;e<a.length;e++){const r=a[e].trim(),c=r.indexOf(s.DIFF_MARKERS.SEPARATOR),l=r.indexOf(s.DIFF_MARKERS.REPLACE_END);if(-1!==c&&-1!==l&&c<l){const t=r.substring(0,c).trim(),d=r.substring(c+s.DIFF_MARKERS.SEPARATOR.length,l).trim(),u=r.substring(l+s.DIFF_MARKERS.REPLACE_END.length).trim();if(""!==u&&(e===a.length-1||!u.startsWith(s.DIFF_MARKERS.SEARCH_START))){const e=`${s.ERROR_MESSAGES.INVALID_FORMAT} (unexpected content after REPLACE_END) near "${u.substring(0,30)}${u.length>30?"...":""}"`;throw i.default.error(`[TraditionalDiffStrategy] ${e}`),new n.FileSystemError(e,s.ERROR_TYPES.DIFF_PARSE_ERROR_TRAILING_TEXT)}o.push({search:t,replace:d,originalIndex:e-1})}else{if(-1===c||-1!==l){const e=`${s.ERROR_MESSAGES.INVALID_FORMAT} (general malformed structure) near "${r.substring(0,30)}${r.length>30?"...":""}"`;throw i.default.error(`[TraditionalDiffStrategy] ${e}`),new n.FileSystemError(e,s.ERROR_TYPES.DIFF_PARSE_ERROR_TRAILING_TEXT)}if(!(t?.toleratesMissingEndMarkers??!1)){const e=`${s.ERROR_MESSAGES.INVALID_FORMAT} (missing REPLACE_END or malformed structure) near "${r.substring(0,30)}${r.length>30?"...":""}"`;throw i.default.error(`[TraditionalDiffStrategy] ${e}`),new n.FileSystemError(e,s.ERROR_TYPES.DIFF_PARSE_ERROR_TRAILING_TEXT)}{const t=r.indexOf(s.DIFF_MARKERS.SEPARATOR,c+s.DIFF_MARKERS.SEPARATOR.length);if(-1!==t){const l=r.substring(0,c).trim(),d=r.substring(c+s.DIFF_MARKERS.SEPARATOR.length,t).trim(),u=r.substring(t+s.DIFF_MARKERS.SEPARATOR.length).trim();if(""!==u&&(e===a.length-1||!u.startsWith(s.DIFF_MARKERS.SEARCH_START))){const e=`${s.ERROR_MESSAGES.INVALID_FORMAT} (unexpected content after second SEPARATOR) near "${u.substring(0,30)}${u.length>30?"...":""}"`;throw i.default.error(`[TraditionalDiffStrategy] ${e}`),new n.FileSystemError(e,s.ERROR_TYPES.DIFF_PARSE_ERROR_TRAILING_TEXT)}i.default.warn("[TraditionalDiffStrategy] Recovered malformed diff block: Missing '>>>>>>> REPLACE' but found a second '=======' marker. Interpreted as a complete block."),o.push({search:l,replace:d,originalIndex:e-1})}else{const t=r.substring(0,c).trim(),n=r.substring(c+s.DIFF_MARKERS.SEPARATOR.length).trim();i.default.warn(`[TraditionalDiffStrategy] Tolerating missing REPLACE_END marker for block ${e}`),o.push({search:t,replace:n,originalIndex:e-1})}}}}if(0===o.length){const e=s.ERROR_MESSAGES.EMPTY_DIFF;throw i.default.error(`[TraditionalDiffStrategy] ${e}`),new n.FileSystemError(e,s.ERROR_TYPES.DIFF_PARSE_ERROR_NO_BLOCKS)}return o}apply(e,t,r){return r?.supportsOutOfOrderBlocks??!1?this.applyOutOfOrder(e,t):this.applyInOrder(e,t)}applyInOrder(e,t){let r=e,o=0;for(const a of t){const{search:t,replace:c}=a;if(!t.trim()){if(""===e.trim()){r=c,o++;continue}r=c,o++;continue}let l=r.indexOf(t),d=-1!==l?l+t.length:-1;if(-1===l){const e=this.lineTrimmedFallbackMatch(r,t,0);if(e)[l,d]=e;else{const e=this.blockAnchorFallbackMatch(r,t,0);if(!e){const e=t.split("\n"),r=e[0],o=e[e.length-1],a=`${s.ERROR_MESSAGES.SEARCH_NOT_FOUND} Block starts with: "${r.substring(0,50)}${r.length>50?"...":""}" and ends with: "${o.substring(0,50)}${o.length>50?"...":""}". Ensure the SEARCH block exactly matches the file content, including whitespace and line endings.`;throw i.default.error(`[TraditionalDiffStrategy] ${a}`),new n.FileSystemError(a,s.ERROR_TYPES.DIFF_APPLY_ERROR_NOT_FOUND)}[l,d]=e}}r=r.substring(0,l)+c+r.substring(d),o++}return{content:r,appliedBlocks:o}}applyOutOfOrder(e,t){return this.applyInOrder(e,t)}lineTrimmedFallbackMatch(e,t,r){const o=e.split("\n"),n=t.split("\n");""===n[n.length-1]&&n.pop();let s=0,i=0;for(;i<r&&s<o.length;)i+=o[s].length+1,s++;for(let e=s;e<=o.length-n.length;e++){let t=!0;for(let r=0;r<n.length;r++){if(o[e+r].trim()!==n[r].trim()){t=!1;break}}if(t){let t=0;for(let r=0;r<e;r++)t+=o[r].length+1;let r=t;for(let t=0;t<n.length;t++)r+=o[e+t].length+1;return[t,r]}}return!1}blockAnchorFallbackMatch(e,t,r){const o=e.split("\n"),n=t.split("\n");""===n[n.length-1]&&n.pop();const s=n[0].trim(),i=n[n.length-1].trim(),a=n.length;let c=0,l=0;for(;l<r&&c<o.length;)l+=o[c].length+1,c++;for(let e=c;e<=o.length-a;e++){if(o[e].trim()!==s)continue;if(o[e+a-1].trim()!==i)continue;let t=0;for(let r=0;r<e;r++)t+=o[r].length+1;let r=t;for(let t=0;t<a;t++)r+=o[e+t].length+1;return[t,r]}return!1}generateUsageInstructions(e){const t=e?.requiresFlexibleMarkers??!1,r=e?.toleratesMissingEndMarkers??!1;let o="## replace_in_file\nDescription: Request to replace sections of content in an existing file using SEARCH/REPLACE blocks that define exact changes to specific parts of the file. This tool should be used when you need to make targeted changes to specific parts of a file.\nParameters:\n- path: (required) The path of the file to modify (relative to the current working directory)\n- diff: (required) One or more SEARCH/REPLACE blocks following this exact format:\n  ```\n  <<<<<<< SEARCH\n  [exact content to find]\n  =======\n  [new content to replace with]\n  >>>>>>> REPLACE\n  ```\n  CRITICAL RULES FOR EDITING FILES:\n  1. SEARCH content must match the associated file section to find EXACTLY:\n     * Match character-for-character including whitespace, indentation, line endings\n     * Include all comments, docstrings, etc.\n  2. SEARCH/REPLACE blocks will ONLY replace the first match occurrence.\n     * Including multiple unique SEARCH/REPLACE blocks if you need to make multiple changes.\n     * Include *just* enough lines in each SEARCH section to uniquely match each set of lines that need to change.";return o+=e?.supportsOutOfOrderBlocks??!1?"\n     * Blocks can be in any order":"\n     * When using multiple SEARCH/REPLACE blocks, list them in the order they appear in the file.",o+="\n  3. Keep SEARCH/REPLACE blocks concise:\n     * Break large SEARCH/REPLACE blocks into a series of smaller blocks that each change a small portion of the file.\n     * Include just the changing lines, and a few surrounding lines if needed for uniqueness.\n     * Do not include long runs of unchanging lines in SEARCH/REPLACE blocks.\n     * Each line must be complete. Never truncate lines mid-way through as this can cause matching failures.\n  4. Special operations:\n     * To move code: Use two SEARCH/REPLACE blocks (one to delete from original + one to insert at new location)\n     * To delete code: Use empty REPLACE section",t&&(o+="\n  5. Marker formatting is flexible (dash/equals/plus count variations OK)"),r&&(o+="\n  6. Closing >>>>>>> REPLACE marker recommended but not required"),(e?.requiresEnhancedErrorMessages??!1)&&(o+="\n\nIMPORTANT: \n- Do NOT add extra characters to the markers (e.g., ------- SEARCH> is INVALID)\n- Do NOT forget to use the closing >>>>>>> REPLACE marker\n- Do NOT modify the marker format in any way\n- Malformed XML will cause complete tool failure and break the entire editing process"),o}validate(e,t){const r=[];try{return this.parse(e,t),{valid:!0,errors:[]}}catch(e){return e instanceof n.FileSystemError?r.push(e.message):r.push(`Validation error: ${e.message}`),{valid:!1,errors:r}}}}},11463:e=>{"use strict";e.exports=require("@langchain/groq")},11502:function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.OuterTagStripper=t.ChunkBuffer=t.UnifiedTagDetector=t.UnifiedBlockProcessor=void 0;var s=r(82757);Object.defineProperty(t,"UnifiedBlockProcessor",{enumerable:!0,get:function(){return s.UnifiedBlockProcessor}});var i=r(19612);Object.defineProperty(t,"UnifiedTagDetector",{enumerable:!0,get:function(){return i.UnifiedTagDetector}});var a=r(23738);Object.defineProperty(t,"ChunkBuffer",{enumerable:!0,get:function(){return a.ChunkBuffer}});var c=r(58712);Object.defineProperty(t,"OuterTagStripper",{enumerable:!0,get:function(){return c.OuterTagStripper}}),n(r(91643),t),n(r(11503),t),n(r(18448),t),n(r(55705),t),n(r(9109),t),n(r(29781),t)},11503:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},11544:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatModelManager=void 0;const n=r(34264),s=r(81986),i=r(34659),a=r(58312),c=r(32088),l=r(92003),d=o(r(19055)),u=r(81162),p=r(52368),f=r(82097),h=r(78910),m=r(13971),g=r(30059),y=r(79352),v=r(29361);class _{constructor(){this.providers=[new s.AnthropicProvider,new n.OpenAIProvider,new i.GroqProvider,new a.OllamaProvider,new f.HyperbolicProvider,new h.MistralProvider,new m.OpenRouterProvider,new g.GlhfProvider,new y.DeepSeekProvider,new v.GoogleProvider]}static getInstance(){return _.instance||(_.instance=new _),_.instance}static async getModel(e,t=u.ModelCategory.CODING){return _.getInstance().getModel(e,t)}async getModel(e,t=u.ModelCategory.CODING,r=!1){let o=e?.model;if(!o){o=(void 0!==e?.privateModelsRequired?e.privateModelsRequired:r)?p.ConfigService.getInstance().getProperty(`PRIVATE_${t}_MODEL`):p.ConfigService.getInstance().getProperty(`DEFAULT_${t}_MODEL`)}const n=await this.getProvider(o),s=await n.getModelDescriptor(o),i=n.getBaseChatModel(o,e||new l.AgentConfig),a=n.getChatModelOptions(s,e);return new c.ChatModel(s,i,a)}async getValidModelDescriptors(){const e=this.providers.filter((e=>e.isValid())).map((async e=>{try{return await e.getModelDescriptors()}catch(t){return d.default.error(`Error fetching model descriptors from provider ${e.getName()}:`,t),[]}}));return(await Promise.all(e)).flat()}async getValidModelNames(){return(await this.getValidModelDescriptors()).map((e=>e.name))}async getValidModelFullNames(){return(await this.getValidModelDescriptors()).map((e=>e.getFullName())).sort()}async getProvider(e){if(e){const[t]=e.split("/"),r=this.providers.find((e=>e.getName()===t));if(r){if(r.isValid())return r;d.default.warn(`Provider ${t} is not valid. Searching for first valid provider.`)}d.default.warn(`Provider not found or not valid for model ${e}. Searching for first valid provider.`)}const t=this.providers.find((e=>e.isValid()));if(t)return t;throw new Error("No valid provider found. Please check your API keys.")}}t.ChatModelManager=_},11569:e=>{"use strict";e.exports=require("zod")},11778:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OllamaModelClient=void 0;const c=r(81495),l=r(82757),d=r(27400),u=r(5610),p=r(98055),f=a(r(19055));let h;try{h=r(88366).Ollama}catch(e){f.default.warn("[OllamaModelClient] Ollama SDK not available, provider will be disabled")}t.OllamaModelClient=class{constructor(e,t={}){if(this.config=e,this.options=t,!h)throw new Error("Ollama SDK not available. Please install with: pnpm add ollama");this.ollama=new h({host:e.baseUrl||"http://localhost:11434"}),this.messageTransformer=new d.OllamaMessageTransformer,this.chunkAdapter=new u.OllamaChunkAdapter,this.options.enableVerboseLogging&&f.default.info(`[OllamaModelClient] Initialized for model ${e.modelId} at ${e.baseUrl}`)}setModelMetadata(e){this.modelMetadata=e,this.options.enableVerboseLogging&&f.default.debug(`[OllamaModelClient] Set metadata for ${e.modelId}`)}getModelMetadata(){return this.modelMetadata?this.modelMetadata:{modelId:this.config.modelId,providerId:p.OLLAMA_PROVIDER_ID,name:this.config.modelId,contextWindow:32768,maxOutputTokens:8192,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!1,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:0,outputCostPerMillionTokens:0,isDefaultForProvider:!1}}getModelId(){return this.config.modelId}async generateSimpleResponse(e,t,r={},o){if(f.default.info(`[OllamaModelClient] Generating simple response for model: ${this.config.modelId}`),(0,c.validateSimpleResponseOptions)(r),!this.ollama)throw new Error("Ollama client not initialized");const n=this.buildMessageList(e,t),s=this.messageTransformer.transformMessages(n),i={model:this.config.modelId,messages:s,stream:!1,options:{num_ctx:this.modelMetadata?.contextWindow||32768,temperature:r.temperature||.7,timeout:r.timeout||3e4,num_predict:r.maxTokens||this.modelMetadata?.maxOutputTokens||8192}},a=await this.ollama.chat(i);if(!a||!a.message)throw new Error("No response returned from Ollama");return{content:a.message.content||"",usage:{inputTokens:a.prompt_eval_count||0,outputTokens:a.eval_count||0},stopReason:(0,c.mapGenericStopReason)(a.done_reason),finishReason:a.done_reason||void 0,providerId:p.OLLAMA_PROVIDER_ID,modelId:this.config.modelId,metadata:{model:a.model,createdAt:a.created_at,totalDuration:a.total_duration,loadDuration:a.load_duration,promptEvalDuration:a.prompt_eval_duration,evalDuration:a.eval_duration}}}async*generateResponse(e,t,o,n){try{const s=this.buildMessageList(e,t),a=this.messageTransformer.transformMessages(s);this.options.enableVerboseLogging&&f.default.debug(`[OllamaModelClient] Transformed ${s.length} messages to ${a.length} Ollama messages`);const c={model:this.config.modelId,messages:a,stream:!0,options:{num_ctx:this.modelMetadata?.contextWindow||32768,temperature:.7,timeout:3e4}},d=await this.ollama.chat(c),{ChunkBuffer:u}=await Promise.resolve().then((()=>i(r(23738)))),{UnifiedTagDetector:h}=await Promise.resolve().then((()=>i(r(19612)))),{SmartToolCallTracker:m}=await Promise.resolve().then((()=>i(r(38182)))),g=new h,y=new u(g),v=new m,_=new l.UnifiedBlockProcessor(y,g,null,v),w=this.createNormalizedStream(d,n),b={providerId:p.OLLAMA_PROVIDER_ID,taskId:o,debug:this.options.enableVerboseLogging};yield*_.processNormalizedStream(w,b)}catch(e){f.default.error(`[OllamaModelClient] Generation failed: ${e.message}`),yield{type:"block",block:{blockId:"error-block-"+Date.now(),blockType:"error",status:"error",content:`Error: Ollama generation failed: ${e.message}`}}}}async*createNormalizedStream(e,t){try{for await(const r of e){if(t?.aborted){f.default.debug("[OllamaModelClient] Stream aborted by signal");break}const e=this.chunkAdapter.convertChunk(r);for(const t of e)yield t;if(this.chunkAdapter.isStreamComplete(r))break}}catch(e){f.default.error(`[OllamaModelClient] Stream processing failed: ${e.message}`),yield{type:"error",error:{message:`Stream processing failed: ${e.message}`,code:"STREAM_PROCESSING_ERROR"}}}}buildMessageList(e,t){const r=[];return e.trim()&&r.push({id:"system-prompt",taskId:t[0]?.taskId||"unknown",role:"user",segments:[{type:"text",content:`System: ${e}`}],providerId:p.OLLAMA_PROVIDER_ID,createdAt:new Date}),r.push(...t),r}async testConnection(){try{return this.ollama?(await this.ollama.list(),{success:!0}):{success:!1,error:"Ollama client not initialized"}}catch(e){return{success:!1,error:`Failed to connect to Ollama: ${e.message}`}}}}},11879:e=>{"use strict";e.exports=require("xmldom")},12008:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.convertEveMessageToOpenAIAPI=function(e){const t=[];let r=null;const o=e=>{const t=e.match(/^<([a-zA-Z0-9_-]+)>(.*)<\/\1>$/s);if(t)return{name:t[1],arguments:t[2]};const r=e.match(/^<([a-zA-Z0-9_-]+)\/>$/s);return r?{name:r[1],arguments:"{}"}:(n.default.warn(`[OpenAIHelpers] Could not parse tool_code content: ${e}`),null)};if("user"===e.role){const r=e.segments.filter((e=>"text"===e.type)).map((e=>e.content)).join("\n");r&&t.push({role:"user",content:r})}else if("assistant"===e.role){let s="";const i=[];for(const t of e.segments)if("text"===t.type)s+=t.content;else if("tool_code"===t.type){const n=o(t.content);n&&(r=`call_${e.id}_${i.length}`,i.push({id:r,type:"function",function:{name:n.name,arguments:n.arguments}}))}else"tool_result"===t.type?(n.default.warn("[OpenAIHelpers] Assistant message has 'tool_result' segment. Converting to text."),s+=`Result for a tool: ${t.content}\n`):"thinking"===t.type&&n.default.debug("[OpenAIHelpers] Skipping 'thinking' segment for OpenAI assistant message conversion.");i.length>0?t.push({role:"assistant",content:s||null,tool_calls:i}):s&&t.push({role:"assistant",content:s})}else if("tool"===e.role){n.default.warn("[OpenAIHelpers] Received MessageInterchange with role 'tool'. This is not standard. Attempting to process tool_result segments.");const o=e.segments.filter((e=>"tool_result"===e.type)).map((e=>e.content)).join("\n");if(o){const s=e.tool_call_id_for_helper||r||`placeholder_tool_call_id_${Date.now()}`;e.tool_call_id_for_helper||r||n.default.error("[OpenAIHelpers] CRITICAL: Missing tool_call_id for tool result. Using placeholder. This will likely fail with OpenAI API."),t.push({role:"tool",tool_call_id:s,content:o})}}else n.default.warn(`[OpenAIHelpers] MessageInterchange has unhandled or unexpected role: '${e.role}'`);return t},t.getMaskedApiKey=function(e){return e?e.length<=8?"****":`${e.substring(0,4)}...${e.substring(e.length-4)}`:"undefined"};const n=o(r(19055))},12303:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Mutation=t.MutationType=void 0,function(e){e.CREATE="create",e.UPDATE="update",e.DELETE="delete"}(r||(t.MutationType=r={}));t.Mutation=class{constructor(e,t,r,o,n,s,i,a,c){this.id=e,this.type=t,this.filePath=r,this.description=o,this.fileContentsBefore=n,this.fileContentsAfter=s,this.updatedAt=i,this.sessionId=a,this.requestId=c}}},12425:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SlashCommandAutocompleteProvider=void 0;const i=r(3563),a=s(r(19055));let c=o=class{constructor(){this.commands=[{id:"newtask",label:"/newtask",description:"Summarize & start new task - /newtask <describe what you want to do next>",icon:"mdi-plus-circle",category:"task"}]}getTriggerChar(){return"/"}getName(){return"slash-command"}async search(e,t){a.default.debug(`[${o.name}] Starting search for query: "${e}"`);const r=e.toLowerCase(),n=this.commands.filter((e=>e.label.toLowerCase().includes(r)||e.description&&e.description.toLowerCase().includes(r)));return a.default.debug(`[${o.name}] Found ${n.length} results for query: "${e}"`),n}};t.SlashCommandAutocompleteProvider=c,t.SlashCommandAutocompleteProvider=c=o=n([(0,i.Injectable)()],c)},12597:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EveAgentController=void 0;const a=r(3563),c=i(r(19055)),l=r(15369),d=r(56550),u=r(19668);let p=class{constructor(e,t,r){this.apiHandlerFactory=e,this.taskService=t,this.userService=r}async getStatus(){try{return await this.userService.getCurrentUser(),{status:"ok",version:"0.1.0"}}catch(e){if(e instanceof u.AuthenticationError)throw c.default.error(`[EveAgentController] Authentication error in getStatus: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw c.default.error(`[EveAgentController] Error in getStatus: ${e.message}`,e.stack),e}}async createTask(e){try{await this.userService.getCurrentUser();return{success:!0,taskId:await this.taskService.createTask(e)}}catch(e){if(e instanceof u.AuthenticationError)throw c.default.error(`[EveAgentController] Authentication error in createTask: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw c.default.error(`[EveAgentController] Error in createTask: ${e.message}`,e.stack),e}}async getTask(e){try{await this.userService.getCurrentUser();return{success:!0,task:await this.taskService.getTask(e)}}catch(e){if(e instanceof u.AuthenticationError)throw c.default.error(`[EveAgentController] Authentication error in getTask: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw c.default.error(`[EveAgentController] Error in getTask: ${e.message}`,e.stack),e}}async getTaskSteps(e){try{await this.userService.getCurrentUser();return{success:!0,steps:await this.taskService.getTaskSteps(e)}}catch(e){if(e instanceof u.AuthenticationError)throw c.default.error(`[EveAgentController] Authentication error in getTaskSteps: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw c.default.error(`[EveAgentController] Error in getTaskSteps: ${e.message}`,e.stack),e}}async getUserTasks(e,t="10",r="0"){try{const o=await this.userService.getCurrentUser();e!==o.userId&&(c.default.warn(`[EveAgentController] UserId mismatch in getUserTasks: requested ${e}, authenticated as ${o.userId}`),e=o.userId);return{success:!0,tasks:await this.taskService.getUserTasks(e,parseInt(t),parseInt(r))}}catch(e){if(e instanceof u.AuthenticationError)throw c.default.error(`[EveAgentController] Authentication error in getUserTasks: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw c.default.error(`[EveAgentController] Error in getUserTasks: ${e.message}`,e.stack),e}}async compactContext(e,t){try{await this.userService.getCurrentUser();return{success:!0,...await this.taskService.compactTaskContext(e,t.strategies)}}catch(e){if(e instanceof u.AuthenticationError)throw c.default.error(`[EveAgentController] Authentication error in compactContext: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw c.default.error(`[EveAgentController] Error in compactContext: ${e.message}`,e.stack),e}}};t.EveAgentController=p,o([(0,a.Get)("status"),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],p.prototype,"getStatus",null),o([(0,a.Post)("tasks"),s(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],p.prototype,"createTask",null),o([(0,a.Get)("tasks/:taskId"),s(0,(0,a.Param)("taskId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],p.prototype,"getTask",null),o([(0,a.Get)("tasks/:taskId/steps"),s(0,(0,a.Param)("taskId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],p.prototype,"getTaskSteps",null),o([(0,a.Get)("users/:userId/tasks"),s(0,(0,a.Param)("userId")),s(1,(0,a.Query)("limit")),s(2,(0,a.Query)("offset")),n("design:type",Function),n("design:paramtypes",[String,Object,Object]),n("design:returntype",Promise)],p.prototype,"getUserTasks",null),o([(0,a.Post)("tasks/:taskId/compact-context"),s(0,(0,a.Param)("taskId")),s(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],p.prototype,"compactContext",null),t.EveAgentController=p=o([(0,a.Controller)("eve-agent"),n("design:paramtypes",[l.ApiHandlerFactory,d.TaskService,u.UserService])],p)},13220:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ReadFileToolFactory=void 0;const s=r(3563),i=r(34833);let a=class{constructor(){}getToolName(){return"read_file"}create(e){return new i.ReadFileTool(e.workingDir,{availableInPlan:!0,availableInAct:!0})}};t.ReadFileToolFactory=a,t.ReadFileToolFactory=a=o([(0,s.Injectable)(),n("design:paramtypes",[])],a)},13686:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.OllamaAdapter=void 0;const s=r(3563),i=r(27400),a=r(50456),c=r(98055);let l=class{constructor(e){this.ollamaProvider=e,this.messageTransformer=new i.OllamaMessageTransformer}get id(){return c.OLLAMA_PROVIDER_ID}get name(){return"Ollama"}getProvider(){return this.ollamaProvider}getModelClient(e){return this.ollamaProvider.getModelClient(e)}toProviderFormat(e){return this.messageTransformer.transformMessages(e)}fromProviderFormat(e){return[]}extractMetadata(e){return{format:"ollama"}}supportsThinking(){return!1}supportsFormatConversion(e){return!1}};t.OllamaAdapter=l,t.OllamaAdapter=l=o([(0,s.Injectable)(),n("design:paramtypes",[a.OllamaProvider])],l)},13853:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIMessageTransformer=t.OpenAIAdapter=t.OpenAIProvider=void 0;var o=r(98280);Object.defineProperty(t,"OpenAIProvider",{enumerable:!0,get:function(){return o.OpenAIProvider}});var n=r(95846);Object.defineProperty(t,"OpenAIAdapter",{enumerable:!0,get:function(){return n.OpenAIAdapter}});var s=r(42808);Object.defineProperty(t,"OpenAIMessageTransformer",{enumerable:!0,get:function(){return s.OpenAIMessageTransformer}})},13971:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenRouterProvider=void 0;const n=r(96228),s=r(48483),i=r(8959),a=r(52368),c=o(r(58938));class l extends s.BaseProvider{constructor(){super()}getName(){return"openrouter"}getBaseChatModel(e,t){const r=process.env.OPENROUTER_BASE_URL||"https://openrouter.ai";let o=8e3;if(l.modelCache.models.length>0){const t=l.modelCache.models.find((t=>t.id===this.shortModelName(e)));t?.per_request_limits?.prompt_tokens&&(o=t.per_request_limits.prompt_tokens)}return new n.ChatOpenAI({modelName:this.shortModelName(e),temperature:t.temperature,maxTokens:o,openAIApiKey:a.ConfigService.getInstance().getProperty("OPENROUTER_API_KEY")},{basePath:`${r}/api/v1`,baseOptions:{headers:{"X-Title":"Eve"}}})}async getModelDescriptors(){return 0===l.modelCache.models.length&&await this.fetchModels(),l.modelCache.models.map((e=>{const t=parseFloat(e.pricing.prompt)||0,r=parseFloat(e.pricing.completion)||0;return new i.ModelDescriptor("openrouter",e.id,t,0,0,r)}))}isValid(){return!!a.ConfigService.getInstance().getProperty("OPENROUTER_API_KEY")}async fetchModels(){if(!this.isValid())return[];const e=Date.now();if(l.modelCache.models.length>0&&e-l.modelCache.timestamp<3e5)return l.modelCache.models;const t=a.ConfigService.getInstance().getProperty("OPENROUTER_API_KEY"),r=process.env.OPENROUTER_BASE_URL||"https://openrouter.ai";if(!t)return console.log("OpenRouter API key not found"),[];try{const o=await c.default.get(`${r}/api/v1/models`,{headers:{Authorization:`Bearer ${t}`,"X-Title":"Eve"}});if(200===o.status){const t=o.data.data||[];return l.modelCache={models:t,timestamp:e},t}return console.log(`Failed to fetch OpenRouter models. Status code: ${o.status}`),[]}catch(e){return console.error(`Error fetching OpenRouter models: ${e}`),[]}}}t.OpenRouterProvider=l,l.modelCache={models:[],timestamp:0}},14624:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProviderAdapterRegistry=void 0;const a=r(3563),c=i(r(19055));let l=class{constructor(e){this.adapters=new Map;for(const t of e)this.registerAdapter(t)}registerAdapter(e){this.adapters.set(e.id,e),c.default.info(`[ProviderAdapterRegistry] Registered adapter for provider: ${e.name} (${e.id})`)}getAdapter(e){const t=this.adapters.get(e);if(!t)throw new Error(`No adapter found for provider: ${e}`);return t}getAllAdapters(){return Array.from(this.adapters.values())}};t.ProviderAdapterRegistry=l,t.ProviderAdapterRegistry=l=o([(0,a.Injectable)(),s(0,(0,a.Inject)("PROVIDER_ADAPTERS")),n("design:paramtypes",[Array])],l)},14632:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetController=void 0;const i=r(3563),a=r(49556),c=r(76982),l=r(8077),d=r(26696);let u=class{constructor(e,t){this.datasetService=e,this.datasetRetrievalService=t}async getAllDatasets(){return this.datasetService.getAllDatasets()}async getDataset(e){return this.datasetService.getDatasetById(e)}async createDataset(e){if(!e.name.match(/^[a-zA-Z0-9]{3,30}$/))throw new Error("Dataset name must be 3-30 alphanumeric characters with no spaces");return this.datasetService.createDataset(e.name,e.baseDir)}async updateDataset(e,t){await this.datasetService.updateDataset(e,t)}async deleteDataset(e){await this.datasetService.deleteDataset(e)}async getDocuments(e){return this.datasetService.getDocuments(e)}async getDocument(e){return this.datasetService.getDocumentById(e)}async createDocument(e,t){const r=(0,c.createHash)("md5").update(t.buffer).digest("hex");return this.datasetService.createDocument(e,t.originalname,r,t.buffer)}async updateDocumentStatus(e,t){await this.datasetService.updateDocumentStatus(e,t.status)}async deleteDocument(e){await this.datasetService.deleteDocument(e)}async queryDataset(e,t,r){const o=await this.datasetService.getDatasetById(e);return this.datasetRetrievalService.searchDataset(o.name,t,r?parseInt(r,10):void 0)}};t.DatasetController=u,o([(0,i.Get)(),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],u.prototype,"getAllDatasets",null),o([(0,i.Get)(":id"),s(0,(0,i.Param)("id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"getDataset",null),o([(0,i.Post)(),s(0,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],u.prototype,"createDataset",null),o([(0,i.Put)(":id"),s(0,(0,i.Param)("id")),s(1,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],u.prototype,"updateDataset",null),o([(0,i.Delete)(":id"),s(0,(0,i.Param)("id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"deleteDataset",null),o([(0,i.Get)(":datasetId/documents"),s(0,(0,i.Param)("datasetId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"getDocuments",null),o([(0,i.Get)(":datasetId/documents/:id"),s(0,(0,i.Param)("id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"getDocument",null),o([(0,i.Post)(":datasetId/documents"),(0,i.UseInterceptors)((0,a.FileInterceptor)("file")),s(0,(0,i.Param)("datasetId")),s(1,(0,i.UploadedFile)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],u.prototype,"createDocument",null),o([(0,i.Put)(":datasetId/documents/:id/status"),s(0,(0,i.Param)("id")),s(1,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],u.prototype,"updateDocumentStatus",null),o([(0,i.Delete)(":datasetId/documents/:id"),s(0,(0,i.Param)("id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"deleteDocument",null),o([(0,i.Get)(":id/query"),s(0,(0,i.Param)("id")),s(1,(0,i.Query)("q")),s(2,(0,i.Query)("numResults")),n("design:type",Function),n("design:paramtypes",[String,String,String]),n("design:returntype",Promise)],u.prototype,"queryDataset",null),t.DatasetController=u=o([(0,i.Controller)("datasets"),n("design:paramtypes",[l.DatasetService,d.DatasetRetrievalService])],u)},14763:(e,t,r)=>{var o;r(79896);function n(e,t,r){if("function"==typeof t&&(r=t,t={}),!r){if("function"!=typeof Promise)throw new TypeError("callback not provided");return new Promise((function(r,o){n(e,t||{},(function(e,t){e?o(e):r(t)}))}))}o(e,t||{},(function(e,o){e&&("EACCES"===e.code||t&&t.ignoreErrors)&&(e=null,o=!1),r(e,o)}))}o="win32"===process.platform||global.TESTING_WINDOWS?r(34406):r(55200),e.exports=n,n.sync=function(e,t){try{return o.sync(e,t||{})}catch(e){if(t&&t.ignoreErrors||"EACCES"===e.code)return!1;throw e}}},15096:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.HelloWorldController=void 0;const s=r(3563),i=r(45533);let a=class{constructor(e){this.helloWorldService=e}getHello(){return this.helloWorldService.getHello()}};t.HelloWorldController=a,o([(0,s.Get)(),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",String)],a.prototype,"getHello",null),t.HelloWorldController=a=o([(0,s.Controller)("hello-world"),n("design:paramtypes",[i.HelloWorldService])],a)},15190:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GitService=void 0;const i=r(3563),a=r(88474),c=r(5754),l=s(r(19055)),d=s(r(83807));let u=class{constructor(e){this.workspaceService=e}async getGit(e){const t=await this.workspaceService.findOne(e);if(!t)throw new Error(`Workspace ${e} not found`);return(0,d.default)(t.repoBaseDir)}async undoLastCommit(e){const t=await this.getGit(e);try{await t.reset(["--hard","HEAD~1"])}catch(e){throw new Error(`Failed to undo last commit: ${e.message}`)}}async getGitLog(e){const t=await this.getGit(e);try{return(await t.log(["-n","15"])).all.map((e=>new c.GitLogEntry(e.hash,e.date,e.message,e.author_name,e.author_email)))}catch(e){return e instanceof Error&&e.message.includes("not a git repository")||l.default.warn(`Failed to fetch git log: ${e.message}`),[]}}async getGitDiff(e,t){const r=await this.getGit(e);try{return await r.show(["--unified",t])}catch(e){throw new Error(`Failed to get git diff: ${e.message}`)}}};t.GitService=u,t.GitService=u=o([(0,i.Injectable)(),n("design:paramtypes",[a.WorkspaceService])],u)},15369:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApiHandlerFactory=void 0;const a=r(3563),c=r(14624),l=r(58620),d=i(r(19055));let u=o=class{constructor(e,t){this.providerAdapterRegistry=e,this.llmMetadataService=t,d.default.info(`[${o.name}] ApiHandlerFactory initialized`)}async buildApiHandler(e){const t=e?.providerName||"anthropic";d.default.info(`[${o.name}] Building API handler for provider: ${t}`);try{const r=this.providerAdapterRegistry.getAdapter(t),n=(await this.llmMetadataService.getModelsForProvider(t)).find((t=>t.modelId===e.model));n||d.default.warn(`[${o.name}] Model not found: ${e.model}, using default configuration`);const s=n?.supportsThinkingTokens?e.thinkingTokens:void 0,i={modelId:e.model,apiKey:e.apiKey||"",baseUrl:e.baseUrl,thinkingTokens:s,draftModelId:e.draftModelId},a=r.getModelClient(i);return n&&"setModelMetadata"in a&&(a.setModelMetadata(n),d.default.debug(`[${o.name}] Set model metadata for ${e.model} with editToolCapabilities: ${JSON.stringify(n.editToolCapabilities)}`)),{generateResponse:(e,t,r,o)=>a.generateResponse(e,t,r,o),getModel:()=>{const e=a.getModelMetadata();return{id:e.modelId,info:e}},getModelMetadata:()=>a.getModelMetadata()}}catch(e){throw d.default.error(`[${o.name}] Error building API handler: ${e.message}`),e}}};t.ApiHandlerFactory=u,t.ApiHandlerFactory=u=o=n([(0,a.Injectable)(),s("design:paramtypes",[c.ProviderAdapterRegistry,l.LlmMetadataService])],u)},15562:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.convertEveMessageToGemini=function(e){return{role:"assistant"===e.role?"model":"user",parts:(t=e.segments,t.flatMap((e=>{if("text"===e.type)return{text:e.content};if("thinking"===e.type)return{text:`[Thinking: ${e.content}]`};if("image"===e.type){n.default.info("[GeminiModelClient] Converting image segment to Gemini format");const t=e.metadata?.url||e.content;if(t?.startsWith("data:")){const e=t.split(",");if(2===e.length){const t=e[0].match(/:(.*?);/);if(t&&t[1])return{inlineData:{data:e[1],mimeType:t[1]}}}}return{text:`[Image: ${t||"URL missing"}]`}}return n.default.warn(`[GeminiModelClient] Unsupported segment type: ${e.type}. Converting to text.`),{text:`[Unsupported segment type: ${e.type}] ${e.content}`}})))};var t},t.getMaskedApiKey=function(e){if(!e)return"undefined";if(e.length<=8)return"********";const t=e.substring(0,4),r=e.substring(e.length-4),o=Math.max(0,e.length-8),n="*".repeat(o);return`${t}${n}${r}`};const n=o(r(19055))},15796:e=>{"use strict";e.exports=require("@langchain/community/vectorstores/chroma")},15845:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.goQuery=t.csharpQuery=t.cQuery=t.cppQuery=t.rubyQuery=t.rustQuery=t.javaQuery=t.pythonQuery=t.typescriptQuery=t.javascriptQuery=void 0,t.javascriptQuery="\n(function_declaration) @name\n(method_definition) @name\n(class_declaration) @name\n",t.typescriptQuery=t.javascriptQuery,t.pythonQuery="\n(function_definition name: (identifier) @name)\n(class_definition name: (identifier) @name)\n",t.javaQuery="\n(class_declaration name: (identifier) @name)\n(interface_declaration name: (identifier) @name)\n(method_declaration name: (identifier) @name)\n",t.rustQuery="\n(function_item name: (identifier) @name)\n(struct_item name: (type_identifier) @name)\n(enum_item name: (type_identifier) @name)\n",t.rubyQuery="\n(class name: (constant) @name)\n(module name: (constant) @name)\n(method name: (identifier) @name)\n",t.cppQuery="\n(function_definition declarator: (function_declarator declarator: (identifier) @name))\n(class_specifier name: (type_identifier) @name)\n(struct_specifier name: (type_identifier) @name)\n",t.cQuery="\n(function_definition declarator: (function_declarator declarator: (identifier) @name))\n(struct_specifier name: (type_identifier) @name)\n",t.csharpQuery="\n(class_declaration name: (identifier) @name)\n(interface_declaration name: (identifier) @name)\n(method_declaration name: (identifier) @name)\n",t.goQuery="\n(function_declaration name: (identifier) @name)\n(method_declaration name: (field_identifier) @name)\n"},15853:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UseMcpToolTool=void 0;const a=r(3563),c=r(20436),l=i(r(19055)),d=r(2115);let u=o=class extends c.BaseTool{constructor(e,t,r){super(r),this.mcpHubService=e,this.name="use_mcp_tool",this.description="Request to use a tool provided by a connected MCP server.",this.userId=t}getModeSpecificGuidance(e){return null}getBaseUsageInstructions(e){const t=this.getConnectedMcpServers();let r='## use_mcp_tool\nDescription: Request to use a tool provided by a connected MCP server. Each MCP server can provide multiple tools with different capabilities. Tools have defined input schemas that specify required and optional parameters.\nParameters:\n- server_name: (required) The name of the MCP server providing the tool\n- tool_name: (required) The name of the tool to execute\n- arguments: (required) A JSON object containing the tool\'s input parameters, following the tool\'s input schema\nUsage:\n<use_mcp_tool>\n<server_name>server name here</server_name>\n<tool_name>tool name here</tool_name>\n<arguments>\n{\n  "param1": "value1",\n  "param2": "value2"\n}\n</arguments>\n</use_mcp_tool>';return t.length>0?(r+="\n\n# Connected MCP Servers\n\n",r+="When a server is connected, you can use the server's tools via the `use_mcp_tool` tool, and access the server's resources via the `access_mcp_resource` tool.\n\n",t.forEach((e=>{r+=this.formatServerDocumentation(e)}))):r+="\n\n# Connected MCP Servers\n\n(No MCP servers currently connected)\n\n",r}async initialize(e){await this.mcpHubService.initializeUserServers(this.userId)}getConnectedMcpServers(){return this.mcpHubService.getConnectedServers(this.userId)}formatServerDocumentation(e){let t=`## ${e.name}\n\n`;return e.tools&&e.tools.length>0&&(t+="### Available Tools\n",e.tools.forEach((e=>{t+=`- ${e.name}: ${e.description||"No description available"}\n`,e.inputSchema&&(t+="    Input Schema:\n",t+=`    ${JSON.stringify(e.inputSchema,null,2).split("\n").join("\n    ")}\n`),t+="\n"}))),e.resources&&e.resources.length>0&&(t+="### Direct Resources\n",e.resources.forEach((e=>{t+=`- ${e.uri} (${e.name}): ${e.description||"No description available"}\n`})),t+="\n"),e.resourceTemplates&&e.resourceTemplates.length>0&&(t+="### Resource Templates\n",e.resourceTemplates.forEach((e=>{t+=`- ${e.uriTemplate} (${e.name}): ${e.description||"No description available"}\n`})),t+="\n"),t}validateParams(e){if("string"!=typeof e.server_name||""===e.server_name.trim())return!1;if("string"!=typeof e.tool_name||""===e.tool_name.trim())return!1;let t;if("string"==typeof e.arguments)try{t=JSON.parse(e.arguments)}catch(e){return l.default.error(`[${o.name}] Invalid JSON in arguments parameter: ${e.message}`),!1}else{if("object"!=typeof e.arguments)return!1;t=e.arguments}return"object"==typeof t&&null!==t}async execute(e){const{server_name:t,tool_name:r}=e;l.default.info(`[${o.name}] Using MCP tool ${r} on server ${t}`);let n=e.arguments;if("string"==typeof n)try{n=JSON.parse(n)}catch(e){throw l.default.error(`[${o.name}] Invalid JSON in arguments parameter: ${e.message}`),new Error(`Invalid JSON in arguments parameter: ${e.message}`)}try{const e=await this.mcpHubService.callTool(this.userId,t,r,n);return l.default.info(`[${o.name}] MCP tool ${r} executed successfully`),e}catch(e){throw l.default.error(`[${o.name}] Error using MCP tool ${r}: ${e.message}\n${e.stack}`),new Error(`Error using MCP tool ${r}: ${e.message}`)}}};t.UseMcpToolTool=u,t.UseMcpToolTool=u=o=n([(0,a.Injectable)(),s("design:paramtypes",[d.McpHubService,String,Object])],u)},16387:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentLoopOrchestrator=void 0;const c=r(3563),l=r(50461),d=r(59100),u=a(r(19055)),p=r(96297),f=r(56550),h=r(56349),m=r(14624),g=r(77403),y=r(17057),v=r(2620),_=r(9581),w=r(99547),b=r(91280),k=r(55324),S=r(67485),T=r(57438),R=r(26897),C=r(35444),P=r(31623);let E=o=class{constructor(e,t,r,o,n,s,i,a,c,l,d){this.taskService=e,this.conversationHistoryService=t,this.eventEmitter=r,this.agentStateManager=o,this.contextTruncationHandler=n,this.fileContentOptimizer=s,this.llmStreamProcessorBlock=i,this.blockService=a,this.providerAdapterRegistry=c,this.toolResultAggregatorService=l,this.rateLimitRetryService=d,this.setupEventListeners()}setupEventListeners(){this.eventEmitter.on(b.InternalEvents.TOOL_EXECUTION_COMPLETED,(async e=>{await this.handleToolExecutionCompleted(e.taskId,e.clientId,e.blockId,e.toolName,e.result,e.status)}))}async handleToolExecutionCompleted(e,t,r,n,s,i){if(u.default.info(`[${o.name}] Tool execution/batch completed for task ${e} with status ${i}`),p.debugLogger.dumpObject("Tool execution completed result",s),!e||""===e.trim())return u.default.error(`[${o.name}] Invalid or empty taskId received in handleToolExecutionCompleted. TaskId: '${e}', ClientId: ${t}, BlockId: ${r}, ToolName: ${n}, Status: ${i}`),void u.default.error(`[${o.name}] This indicates a bug in the event emission chain. Skipping tool execution completion handling to prevent server crash.`);let a;try{a=await this.taskService.getTask(e)}catch(t){return u.default.error(`[${o.name}] Failed to get task ${e} in handleToolExecutionCompleted: ${t.message}`),void u.default.error(`[${o.name}] This could indicate the task was deleted or there's a database issue. Skipping tool execution completion handling.`)}if(a.status!==C.TaskStatus.USER_CANCELLED){if("rejected"===i){u.default.info(`[${o.name}] Tool rejected for task ${e}. Restarting agent loop to allow agent response.`);try{const r=a.mode||"act",o=await this.conversationHistoryService.getHistory(e);return p.debugLogger.log(`[AgentLoopOrchestrator] Reloaded history after tool rejection, message count: ${o.length}`),void await this.runAgentLoop(e,o,t,r)}catch(t){return u.default.error(`[${o.name}] Error restarting agent loop after tool rejection for task ${e}: ${t.message}`),void await this.taskService.updateTask({taskId:e,status:C.TaskStatus.WAITING_FOR_INPUT,result:JSON.stringify({details:"Tool execution was rejected. Agent loop restart failed, waiting for your input."})})}}"error"===i&&(await this.taskService.updateTask({taskId:e,status:C.TaskStatus.WAITING_FOR_INPUT,result:JSON.stringify({error:"Tool batch execution failed. Agent is waiting for input.",details:s})}),u.default.info(`[${o.name}] Task ${e} status set to ${C.TaskStatus.WAITING_FOR_INPUT} after tool batch error.`));try{const r=a.mode||"act",o=await this.conversationHistoryService.getHistory(e);p.debugLogger.log(`[AgentLoopOrchestrator] Reloaded history after tool execution/batch, message count: ${o.length}`),await this.runAgentLoop(e,o,t,r)}catch(t){u.default.error(`[${o.name}] Error handling tool execution completion for task ${e}: ${t.message}`),u.default.error(`[${o.name}] Stack trace: ${t.stack}`)}}else u.default.info(`[${o.name}] Task ${e} is cancelled, not continuing agent loop.`)}setTaskAborting(e,t){return this.agentStateManager.setTaskAborting(e,t)}isTaskAborting(e){return this.agentStateManager.isTaskAborting(e)}cleanupTask(e){this.agentStateManager.cleanupTask(e)}async detectPendingToolCalls(e){const t=(await this.blockService.getBlocksForTask(e)).filter((e=>"tool_call"===e.blockType&&"finished"===e.status&&!P.RESPONSE_ONLY_TOOLS.includes(e.tagName||"")&&!["executing","completed","error","question"].includes(e.status)));return t.length>0&&(u.default.info(`[${o.name}] Detected ${t.length} pending tool calls for task ${e}`),t.forEach((e=>p.debugLogger.log(`Pending tool: ${e.tagName}, blockId: ${e.blockId}`)))),t}async emitToolCallBatch(e,t,r){const n=t.map((e=>({blockId:e.blockId,toolName:e.tagName||"unknown_tool_in_batch"})));n.length>0?(u.default.info(`[${o.name}] Emitting TOOL_CALL_BATCH_DETECTED for ${n.length} tools, task ${e}`),this.eventEmitter.emit(b.InternalEvents.TOOL_CALL_BATCH_DETECTED,{clientId:r,taskId:e,toolCalls:n})):u.default.info(`[${o.name}] No tool calls to emit in batch for task ${e}`)}async getProviderIdForTask(e){try{return(await this.taskService.getTask(e)).providerId||"anthropic"}catch(t){return u.default.warn(`[${o.name}] Could not get provider ID for task ${e}, defaulting to 'anthropic'`),"anthropic"}}async runAgentLoop(e,t,r,n){p.debugLogger.log(`Starting agent loop for task ${e} with ${t.length} messages`);if((await this.taskService.getTask(e)).status===C.TaskStatus.USER_CANCELLED)return u.default.info(`[${o.name}] Task ${e} is cancelled, not running agent loop`),!1;let s,i=null;const a=(0,d.ulid)();if(this.isTaskAborting(e))return u.default.info(`[${o.name}] Task ${e} is being aborted, stopping agent loop`),!0;u.default.info(`[${o.name}] Running agent loop for task ${e} with ${t.length} messages in history`),u.default.info(`[${o.name}] Current mode: ${n}`),t.length>0||u.default.warn(`[${o.name}] No messages in history for task ${e}`);try{u.default.info(`[${o.name}] Running agent loop for task ${e}, mode: ${n}`),await this.taskService.updateTask({taskId:e,status:C.TaskStatus.IN_PROGRESS}),u.default.info(`[${o.name}] Task ${e} status set to ${C.TaskStatus.IN_PROGRESS}`);const c=this.agentStateManager.getOrCreateAbortSignal(e);p.debugLogger.log(`Using abort signal for task ${e}, aborted state: ${c.aborted}`);const l=this.fileContentOptimizer.optimizeFileContent(t),d=l.length>0?l[l.length-1]:null;if(d&&"user"===d.role){d.segments.find((e=>"text"===e.type))&&(await this.blockService.createBlock({blockId:d.id,taskId:e,role:"user",blockType:"request",status:"generating",content:""}),u.default.info(`[${o.name}] Created request block ${d.id} for task ${e}`))}p.debugLogger.log(`Calling executeConversationTurn for task ${e}`);const f=await this.getProviderIdForTask(e),h=l.reduce(((e,t)=>e+(t.segments?.reduce(((e,t)=>e+Math.ceil((t.content?.length||0)/2.5)),0)||0)),0);u.default.info(`[AgentLoopOrchestrator] Pre-execution context: ${l.length} messages, ~${h} tokens estimated`);const m=await this.rateLimitRetryService.retryWithRateLimit((async()=>await(0,w.retryWithContextTruncation)((()=>this.taskService.executeConversationTurn(e,l,n,c)),(async()=>{u.default.warn(`[AgentLoopOrchestrator] Context window exceeded, applying truncation for task ${e}`);const{truncatedHistory:t,removedCount:o}=this.contextTruncationHandler.truncateWithNextStrategy(e,l,r),s=t.reduce(((e,t)=>e+(t.segments?.reduce(((e,t)=>e+Math.ceil((t.content?.length||0)/2.5)),0)||0)),0);return u.default.info(`[AgentLoopOrchestrator] Post-truncation context: ${t.length} messages (removed ${o}), ~${s} tokens estimated`),this.taskService.executeConversationTurn(e,t,n,c)}),{logger:u.default,onRetry:(t,o,n)=>{const s=(0,_.toEveAgentError)(t);this.eventEmitter.emit(b.InternalEvents.AGENT_ERROR_NOTIFICATION,{clientId:r,taskId:e,error:s.toUserMessage(),type:"api_error",code:s.code,context:{attempt:o,willRetryIn:n}})}})),e,r,{maxRetries:3,retryDelaySeconds:60,emitErrorBlocks:!0,providerId:f});if(!m.success)throw m.error||new _.EveAgentError("Rate limit retry failed");const g=m.result;this.agentStateManager.resetMistakeCount(e);const y=await this.llmStreamProcessorBlock.processStream(g,e,r,a);if(y.messageInterchange){s=y.messageInterchange;try{await this.conversationHistoryService.addMessage(e,s),u.default.info(`[${o.name}] Saved assistant message ${s.id} for task ${e}`)}catch(t){u.default.error(`[${o.name}] Error saving assistant message for task ${e}: ${t.message}\n${t.stack}`),this.eventEmitter.emit(b.InternalEvents.TOOL_ERROR,{clientId:r,taskId:e,error:`Error saving conversation history: ${t.message}`,type:"database_error"})}}if(y.streamError)throw i=y.streamError,i;const v=await this.detectPendingToolCalls(e);if(v.length>0){const t=v.filter((e=>P.RESPONSE_ONLY_TOOLS.includes(e.tagName||"")));for(const e of t)"completed"!==e.status&&(u.default.info(`[${o.name}] Updating response-only tool ${e.tagName} block ${e.blockId} status to completed.`),await this.blockService.updateBlock(e.blockId,{status:"completed"}));const n=v.filter((e=>!P.RESPONSE_ONLY_TOOLS.includes(e.tagName||"")));if(n.length>0)return u.default.info(`[${o.name}] Detected ${n.length} executable tool calls. Emitting batch event.`),await this.emitToolCallBatch(e,n,r),!1;u.default.info(`[${o.name}] No executable tool calls after filtering response-only tools.`)}}catch(t){i=t,u.default.error(`[${o.name}] Error in agent loop for task ${e}: ${t.message}\n${t.stack}`);const n=t instanceof _.EveAgentError?t:(0,_.toEveAgentError)(t);try{const t=await this.blockService.getLastBlockForTask(e);t&&"request"===t.blockType&&"generating"===t.status&&(await this.blockService.updateBlock(t.blockId,{status:"error",errorText:n.toUserMessage()}),u.default.info(`[${o.name}] Updated request block ${t.blockId} to error status for task ${e}`))}catch(t){u.default.error(`[${o.name}] Error updating request block to error status for task ${e}: ${t.message}\n${t.stack}`)}try{await this.blockService.createBlock({blockId:(0,d.ulid)(),taskId:e,role:"assistant",blockType:"error",status:"finished",content:`An error occurred: ${n.toUserMessage()}`,errorText:n.stack||JSON.stringify(n.context)}),u.default.info(`[${o.name}] Created error block for task ${e}`)}catch(t){u.default.error(`[${o.name}] Error creating error block for task ${e}: ${t.message}\n${t.stack}`)}return this.eventEmitter.emit(b.InternalEvents.AGENT_ERROR_NOTIFICATION,{clientId:r,taskId:e,error:n.toUserMessage(),type:"task_error",code:n.code,context:n.context}),await this.taskService.updateTask({taskId:e,status:C.TaskStatus.WAITING_FOR_INPUT,result:JSON.stringify({error:n.toUserMessage(),code:n.code})}),!1}u.default.info(`[${o.name}] No tool batch detected for task ${e}. Checking current status before updating.`);return(await this.taskService.getTask(e)).status!==C.TaskStatus.USER_CANCELLED?(u.default.info(`[${o.name}] Task ${e} is not cancelled. Setting status to waiting_for_input.`),await this.taskService.updateTask({taskId:e,status:C.TaskStatus.WAITING_FOR_INPUT,result:JSON.stringify({details:"Agent turn complete. Waiting for your input."})})):u.default.info(`[${o.name}] Task ${e} is already cancelled. Preserving USER_CANCELLED status.`),!1}};t.AgentLoopOrchestrator=E,t.AgentLoopOrchestrator=E=o=n([(0,c.Injectable)(),i(0,(0,c.Inject)((0,c.forwardRef)((()=>f.TaskService)))),s("design:paramtypes",[f.TaskService,h.ConversationHistoryService,l.EventEmitter2,S.AgentStateManager,T.ContextTruncationHandler,g.FileContentOptimizerService,R.LlmStreamProcessorBlock,k.BlockService,m.ProviderAdapterRegistry,y.ToolResultAggregatorService,v.RateLimitRetryService])],E)},16406:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.McpConfigService=void 0;const d=r(3563),u=r(19668),p=r(77332),f=a(r(91943)),h=a(r(16928)),m=a(r(70857)),g=l(r(19055));let y=class{constructor(e){this.userService=e}async getUserConfigPath(e){const t=await this.userService.getCurrentUser(),r=h.join(m.homedir(),".eve","users",t.email);return await f.mkdir(r,{recursive:!0}),h.join(r,"mcp_settings.json")}async getUserSettings(e){try{const t=await this.getUserConfigPath(e);try{await f.access(t)}catch{const r={version:"1.0",mcpServers:{}};return await f.writeFile(t,JSON.stringify(r,null,2)),g.default.info(`[McpConfigService] Created empty MCP settings file for user: ${e}`),r}const r=await f.readFile(t,"utf-8"),o=JSON.parse(r),n=p.McpSettingsSchema.parse(o);return g.default.debug(`[McpConfigService] Loaded MCP settings for user: ${e}`),{version:n.version,mcpServers:n.mcpServers}}catch(t){return g.default.error(`[McpConfigService] Failed to get user settings for ${e}:`,t),{version:"1.0",mcpServers:{}}}}async updateUserSettings(e,t){try{const r=p.McpSettingsSchema.parse(t),o=await this.getUserConfigPath(e);await f.writeFile(o,JSON.stringify(r,null,2)),g.default.info(`[McpConfigService] Updated MCP settings for user: ${e}`)}catch(t){throw g.default.error(`[McpConfigService] Failed to update user settings for ${e}:`,t),new Error(`Failed to update MCP settings: ${t.message}`)}}async addServer(e,t,r){try{const o=await this.getUserSettings(e);if(o.mcpServers[t])throw new Error(`Server '${t}' already exists`);o.mcpServers[t]=r,await this.updateUserSettings(e,o),g.default.info(`[McpConfigService] Added MCP server '${t}' for user: ${e}`)}catch(r){throw g.default.error(`[McpConfigService] Failed to add server '${t}' for user ${e}:`,r),r}}async removeServer(e,t){try{const r=await this.getUserSettings(e);if(!r.mcpServers[t])throw new Error(`Server '${t}' does not exist`);delete r.mcpServers[t],await this.updateUserSettings(e,r),g.default.info(`[McpConfigService] Removed MCP server '${t}' for user: ${e}`)}catch(r){throw g.default.error(`[McpConfigService] Failed to remove server '${t}' for user ${e}:`,r),r}}async updateServerConfig(e,t,r){try{const o=await this.getUserSettings(e);if(!o.mcpServers[t])throw new Error(`Server '${t}' does not exist`);o.mcpServers[t]={...o.mcpServers[t],...r},await this.updateUserSettings(e,o),g.default.info(`[McpConfigService] Updated MCP server '${t}' for user: ${e}`)}catch(r){throw g.default.error(`[McpConfigService] Failed to update server '${t}' for user ${e}:`,r),r}}async toggleServerEnabled(e,t,r){await this.updateServerConfig(e,t,{disabled:!r})}async updateAutoApproval(e,t,r){await this.updateServerConfig(e,t,{autoApprove:r})}async getUserConfigFilePath(e){return this.getUserConfigPath(e)}};t.McpConfigService=y,t.McpConfigService=y=i([(0,d.Injectable)(),c("design:paramtypes",[u.UserService])],y)},16663:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EventHelper=void 0;const a=r(3563),c=r(50461),l=i(r(19055)),d=r(91280);let u=o=class{constructor(e){this.eventEmitter=e}emitTaskUpdate(e,t,r,o,n){const s={clientId:e,taskId:t,status:r,mode:n,data:o};this.eventEmitter.emit(d.InternalEvents.TASK_UPDATED,s)}emitError(e,t,r,o,n="task_error",s){const i={clientId:e,taskId:t,error:r,type:n,context:{source:o,...s}};this.eventEmitter.emit(d.InternalEvents.AGENT_ERROR_NOTIFICATION,i)}emitToolExecutionCompleted(e){if(!e.taskId||""===e.taskId.trim())return l.default.error(`[${o.name}] Invalid or empty taskId in emitToolExecutionCompleted. Payload: ${JSON.stringify(e)}`),void l.default.error(`[${o.name}] This indicates a bug in the event emission chain. Skipping event emission to prevent server crash.`);this.eventEmitter.emit(d.InternalEvents.TOOL_EXECUTION_COMPLETED,e)}};t.EventHelper=u,t.EventHelper=u=o=n([(0,a.Injectable)(),s("design:paramtypes",[c.EventEmitter2])],u)},16724:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MentionsService=void 0;const u=r(3563),p=a(r(16928)),f=a(r(91943)),h=r(88474),m=r(56550),g=d(r(19055)),y=r(82355),v=r(37526),_=/@((?:\/|\.\/|\.\.\/|\w+:\/\/)[^\s]+?|[a-f0-9]{7,40}\b|problems\b|terminal\b|git-changes\b)(?=[.,;:!?]?(?=[\s\r\n]|$))/g;let w=class{constructor(e,t,r){this.mainWorkspaceService=e,this.taskService=t,this.ignoreConfigService=r}async getCwdForTask(e){try{const t=await this.taskService.getTask(e);if(t&&t.workspaceName){const r=await this.mainWorkspaceService.findOne(t.workspaceName);if(r&&r.repoBaseDir)return r.repoBaseDir;g.default.warn(`[MentionsService] Workspace path not found for workspaceName: ${t.workspaceName} in task ${e}`)}else t?g.default.warn(`[MentionsService] Task ${e} does not have a workspaceName.`):g.default.warn(`[MentionsService] Task ${e} not found when trying to get CWD.`)}catch(t){g.default.error(`[MentionsService] Error getting CWD for task ${e}: ${t.message}`)}}async getFileContent(e,t){try{const r=await f.stat(e),o={path:t,isBinary:!1,size:r.size,modified:r.mtime};if(await(0,y.isBinaryFile)(e).catch((()=>!1)))return o.isBinary=!0,o;const n=await f.readFile(e,"utf-8");return o.content=n,o}catch(r){return g.default.warn(`[MentionsService] Error reading file '${e}': ${r.message}`),{path:t,isBinary:!1,error:`Error reading file: ${r.message}`}}}async getDirectoryContent(e,t){try{const r=await f.readdir(e,{withFileTypes:!0});return{path:t,entries:r.map((e=>({name:e.name,isDirectory:e.isDirectory()})))}}catch(r){return g.default.warn(`[MentionsService] Error reading directory '${e}': ${r.message}`),{path:t,entries:[],error:`Error reading directory: ${r.message}`}}}async getContent(e,t,r=1){const o=p.resolve(e,t),n={files:[],directories:[]};try{const s=await f.stat(o);if(s.isFile()){const e=await this.getFileContent(o,t);return n.files.push(e),n}if(s.isDirectory())return await this.processDirectory(e,t,r,n),n}catch(e){return g.default.error(`[MentionsService] Error getting content for '${o}': ${e.message}`),n}return n}async getContentAsText(e,t,r=1){const o=await this.getContent(e,t,r);let n="";const s=new Map;for(const e of o.directories)s.set(e.path,e);const i=Array.from(s.values()).sort(((e,t)=>e.path.split("/").filter(Boolean).length-t.path.split("/").filter(Boolean).length));for(const e of i)if(e.error)n+=`<folder_content path="${e.path}">Error fetching content: ${e.error}</folder_content>\n\n`;else{let t="";e.entries.forEach(((r,o)=>{const n=o===e.entries.length-1;t+=`${n?"└── ":"├── "}${r.name}${r.isDirectory?"/":""}\n`})),n+=`<folder_content path="${e.path}">\n${t.trim()}\n</folder_content>\n\n`}for(const e of o.files)e.error?n+=`<file_content path="${e.path}">Error fetching content: ${e.error}</file_content>\n\n`:e.isBinary?n+=`<file_content path="${e.path}">(Binary file, unable to display content)</file_content>\n\n`:e.content&&(n+=`<file_content path="${e.path}">\n${e.content}\n</file_content>\n\n`);return n.trim()}async processDirectory(e,t,r,o){const n=p.resolve(e,t);try{const s=await this.getDirectoryContent(n,t);if(o.directories.push(s),r<=0)return;for(const i of s.entries){const s=p.join(t,i.name),a=p.join(n,i.name);try{if(i.isDirectory)r>1&&await this.processDirectory(e,s,r-1,o);else{const e=await this.getFileContent(a,s);o.files.push(e)}}catch(e){g.default.warn(`[MentionsService] Error processing entry '${s}': ${e.message}`),i.isDirectory?o.directories.push({path:s,entries:[],error:`Error processing directory: ${e.message}`}):o.files.push({path:s,isBinary:!1,error:`Error reading file: ${e.message}`})}}}catch(e){g.default.error(`[MentionsService] Error processing directory '${n}': ${e.message}`),o.directories.push({path:t,entries:[],error:`Error processing directory: ${e.message}`})}}async processRuleMentions(e,t){const r=[];let o=e;const n=[];let s=o;s=s.replace(_,((e,t)=>{if(n.push(t),t.startsWith("http"))return`'${t}' (web content fetching not yet implemented)`;if(t.startsWith("/")||t.startsWith("./")||t.startsWith("../")){const e=t.startsWith("/")?t.substring(1):t;return e.endsWith("/"),`'${e}' (see referenced files below)`}return["problems","terminal","git-changes"].includes(t)||/^[a-f0-9]{7,40}$/.test(t)?`'${t}' (special mention processing not yet implemented)`:e})),o=s;for(const e of[...new Set(n)])if(e.startsWith("/")||e.startsWith("./")||e.startsWith("../")){const o=e.startsWith("/")?e.substring(1):e,n=e.endsWith("/");try{g.default.info(`[MentionsService] Processing rule mention: ${o}`);const s=p.resolve(t,o),i=await f.stat(s);if(i.isFile()&&n||i.isDirectory()&&!n)i.isDirectory()&&!n?r.push({type:"text",content:`<file_content path="${o}">Error: Path is a directory, but mention did not end with '/'. Use '@${e}/' to reference it as a folder.</file_content>`}):i.isFile()&&n&&r.push({type:"text",content:`<folder_content path="${o}">Error: Path is a file, but mention ended with '/'. Use '@${e.slice(0,-1)}' to reference it as a file.</folder_content>`});else if(i.isFile()){const e=(await this.getContent(t,o)).files[0];e.error?r.push({type:"text",content:`<file_content path="${o}">Error fetching content: ${e.error}</file_content>`}):e.isBinary?r.push({type:"text",content:`<file_content path="${o}">(Binary file, unable to display content)</file_content>`}):e.content&&r.push({type:"text",content:`<file_content path="${o}">\n${e.content}\n</file_content>`})}else if(i.isDirectory()){const e=await this.getContent(t,o,1);if(e.directories.length>0){const t=e.directories[0];if(t.error)r.push({type:"text",content:`<folder_content path="${o}">Error fetching content: ${t.error}</folder_content>`});else{let e="";t.entries.forEach(((r,o)=>{const n=o===t.entries.length-1;e+=`${n?"└── ":"├── "}${r.name}${r.isDirectory?"/":""}\n`})),r.push({type:"text",content:`<folder_content path="${o}">\n${e.trim()}\n</folder_content>`})}}for(const t of e.files)t.error?r.push({type:"text",content:`<file_content path="${t.path}">Error fetching content: ${t.error}</file_content>`}):t.isBinary?r.push({type:"text",content:`<file_content path="${t.path}">(Binary file, unable to display content)</file_content>`}):t.content&&r.push({type:"text",content:`<file_content path="${t.path}">\n${t.content}\n</file_content>`})}}catch(t){g.default.warn(`[MentionsService] Error processing rule mention '${e}' for path '${o}': ${t.message}`);const s=n?"folder_content":"file_content";r.push({type:"text",content:`<${s} path="${o}">Error fetching content: ${t.message}</${s}>`})}}else e.startsWith("http")?r.push({type:"text",content:`<url_content url="${e}">Web content fetching for URLs is not yet implemented.</url_content>`}):(["problems","terminal","git-changes"].includes(e)||/^[a-f0-9]{7,40}$/.test(e))&&r.push({type:"text",content:`<special_mention type="${e}">Processing for '${e}' mentions is not yet implemented.</special_mention>`});return{originalTextSegment:{type:"text",content:o},fileContentSegments:r}}async processRulesMentions(e,t){const r=new Map,o=[];for(const n of e){const{originalTextSegment:e,fileContentSegments:s}=await this.processRuleMentions(n.content,t);o.push({...n,content:e.content});for(const e of s){const t=this.extractPathFromFileContent(e.content);t&&!r.has(t)&&r.set(t,e)}}return{processedRules:o,referencedFiles:Array.from(r.values())}}extractPathFromFileContent(e){const t=e.match(/<(?:file_content|folder_content) path="([^"]+)">/);return t?t[1]:null}async processMentions(e,t){const r=[];let o=e;const n=await this.getCwdForTask(t);if(!n)return g.default.error(`[MentionsService] Could not determine CWD for task ${t}. Mentions will not be processed.`),{originalTextSegment:{type:"text",content:e},fileContentSegments:[]};const s=[];let i=o;i=i.replace(_,((e,t)=>{if(s.push(t),t.startsWith("http"))return`'${t}' (web content fetching not yet implemented)`;if(t.startsWith("/")||t.startsWith("./")||t.startsWith("../")){const e=t.startsWith("/")?t.substring(1):t;return e.endsWith("/")?`'${e}' (see below for folder content)`:`'${e}' (see below for file content)`}return["problems","terminal","git-changes"].includes(t)||/^[a-f0-9]{7,40}$/.test(t)?`'${t}' (special mention processing not yet implemented)`:e})),o=i;for(const e of[...new Set(s)])if(e.startsWith("/")||e.startsWith("./")||e.startsWith("../")){const t=e.startsWith("/")?e.substring(1):e,o=e.endsWith("/");try{g.default.info(`[MentionsService] Processing mentioned path: ${t}`);const s=p.resolve(n,t),i=await f.stat(s);if(i.isFile()&&o||i.isDirectory()&&!o)i.isDirectory()&&!o?r.push({type:"text",content:`<file_content path="${t}">Error: Path is a directory, but mention did not end with '/'. Use '@${e}/' to reference it as a folder.</file_content>`}):i.isFile()&&o&&r.push({type:"text",content:`<folder_content path="${t}">Error: Path is a file, but mention ended with '/'. Use '@${e.slice(0,-1)}' to reference it as a file.</folder_content>`});else if(i.isFile()){const e=(await this.getContent(n,t)).files[0];e.error?r.push({type:"text",content:`<file_content path="${t}">Error fetching content: ${e.error}</file_content>`}):e.isBinary?r.push({type:"text",content:`<file_content path="${t}">(Binary file, unable to display content)</file_content>`}):e.content&&r.push({type:"text",content:`<file_content path="${t}">\n${e.content}\n</file_content>`})}else if(i.isDirectory()){const e=await this.getContent(n,t,1);if(e.directories.length>0){const o=e.directories[0];if(o.error)r.push({type:"text",content:`<folder_content path="${t}">Error fetching content: ${o.error}</folder_content>`});else{let e="";o.entries.forEach(((t,r)=>{const n=r===o.entries.length-1;e+=`${n?"└── ":"├── "}${t.name}${t.isDirectory?"/":""}\n`})),r.push({type:"text",content:`<folder_content path="${t}">\n${e.trim()}\n</folder_content>`})}}for(const t of e.files)t.error?r.push({type:"text",content:`<file_content path="${t.path}">Error fetching content: ${t.error}</file_content>`}):t.isBinary?r.push({type:"text",content:`<file_content path="${t.path}">(Binary file, unable to display content)</file_content>`}):t.content&&r.push({type:"text",content:`<file_content path="${t.path}">\n${t.content}\n</file_content>`})}}catch(n){g.default.warn(`[MentionsService] Error processing mention '${e}' for path '${t}': ${n.message}`);const s=o?"folder_content":"file_content";r.push({type:"text",content:`<${s} path="${t}">Error fetching content: ${n.message}</${s}>`})}}else e.startsWith("http")?r.push({type:"text",content:`<url_content url="${e}">Web content fetching for URLs is not yet implemented.</url_content>`}):(["problems","terminal","git-changes"].includes(e)||/^[a-f0-9]{7,40}$/.test(e))&&r.push({type:"text",content:`<special_mention type="${e}">Processing for '${e}' mentions is not yet implemented.</special_mention>`});return{originalTextSegment:{type:"text",content:o},fileContentSegments:r}}};t.MentionsService=w,t.MentionsService=w=i([(0,u.Injectable)(),l(1,(0,u.Inject)((0,u.forwardRef)((()=>m.TaskService)))),c("design:paramtypes",[h.WorkspaceService,m.TaskService,v.IgnoreConfigService])],w)},16928:e=>{"use strict";e.exports=require("path")},17057:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolResultAggregatorService=void 0;const i=r(3563),a=r(59100),c=s(r(19055)),l=r(96297);let d=o=class{constructor(){this.pendingResults=new Map}async initializeBatch(e,t,r){const n=(0,a.ulid)(),s={taskId:e,messageId:n,expectedToolCount:t.length,completedTools:[],createdAt:new Date,clientId:r};return this.pendingResults.set(n,s),c.default.info(`[${o.name}] Initialized tool batch ${n} for task ${e} with ${t.length} tools`),l.debugLogger.log(`Tool batch ${n} tools: ${t.map((e=>e.tagName)).join(", ")}`),n}async addToolResult(e,t){const r=this.pendingResults.get(e);if(!r)return c.default.error(`[${o.name}] Batch ${e} not found when adding tool result for ${t.toolName}`),!1;r.completedTools.push(t),c.default.info(`[${o.name}] Added tool result for ${t.toolName} to batch ${e} (${r.completedTools.length}/${r.expectedToolCount})`);const n=r.completedTools.length===r.expectedToolCount;return n&&c.default.info(`[${o.name}] Tool batch ${e} is complete`),n}async finalizeBatch(e){const t=this.pendingResults.get(e);if(!t)throw new Error(`Batch ${e} not found when finalizing`);const r=t.completedTools.sort(((e,t)=>e.order-t.order)),n=r.map((e=>({type:"text",content:this.formatToolResultMessage(e.toolName,e.result,e.status)}))),s={id:e,taskId:t.taskId,role:"user",segments:n,providerId:"system",createdAt:t.createdAt};return this.pendingResults.delete(e),c.default.info(`[${o.name}] Finalized batch ${e} with ${r.length} tool results`),s}getBatch(e){return this.pendingResults.get(e)}hasBatch(e){return this.pendingResults.has(e)}cancelBatch(e){this.pendingResults.has(e)&&(this.pendingResults.delete(e),c.default.info(`[${o.name}] Cancelled batch ${e}`))}getPendingBatchCount(){return this.pendingResults.size}cleanupOldBatches(e=36e5){const t=new Date,r=[];for(const[o,n]of this.pendingResults.entries()){t.getTime()-n.createdAt.getTime()>e&&r.push(o)}for(const e of r)this.pendingResults.delete(e),c.default.warn(`[${o.name}] Cleaned up old batch ${e}`);r.length>0&&c.default.info(`[${o.name}] Cleaned up ${r.length} old batches`)}async addToolResultToHistory(e,t,r,n){const s=(0,a.ulid)(),i="rejected"===n?"error":n,l={id:s,taskId:e,role:"user",segments:[{type:"text",content:this.formatToolResultMessage("unknown",r,i)}],providerId:"system",createdAt:new Date};return c.default.info(`[${o.name}] Created individual tool result message ${s} for task ${e}`),l}formatToolResultMessage(e,t,r){let o;try{o="string"==typeof t?t:t&&"object"==typeof t&&t.error?t.error:JSON.stringify(t,null,2)}catch(e){o="[Complex result that cannot be stringified]"}return`[${e} result]${"error"===r?"[ERROR]":""}\n${o}`}};t.ToolResultAggregatorService=d,t.ToolResultAggregatorService=d=o=n([(0,i.Injectable)()],d)},17093:e=>{"use strict";e.exports=require("langchain/text_splitter")},17188:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.MCPToolkit=void 0,t.MCPTool=m;const a=r(83153),c=r(11569);let l,d,u,p;async function f(){if(!l){const[e,t,o]=await Promise.all([Promise.resolve().then((()=>i(r(96804)))),Promise.resolve().then((()=>i(r(19969)))),Promise.resolve().then((()=>i(r(10815))))]);l=e.Client,d=t.StdioClientTransport,u=o.CallToolResultSchema,p=o.ListToolsResultSchema}}class h extends a.BaseToolkit{constructor(e){super(),this.tools=[],this._tools=null,this.transport=null,this.client=null,this.serverParams=e}async initialize(){if(await f(),null===this._tools){if(this.transport=new d(this.serverParams),this.client=new l({name:"langchain-js-client",version:"1.0.0"},{capabilities:{}}),null===this.transport)throw new Error("Transport is not initialized");await this.client.connect(this.transport),this._tools=await this.client.request({method:"tools/list"},p),this.tools=await this.get_tools()}}async get_tools(){if(null===this._tools||null===this.client)throw new Error("Must initialize the toolkit first");const e=this._tools.tools.map((async e=>{if(null===this.client)throw new Error("Client is not initialized");return await m({client:this.client,name:e.name,description:e.description||"",argsSchema:g(e.inputSchema)})}));return Promise.all(e)}}async function m({client:e,name:t,description:o,argsSchema:n}){return await f(),(0,a.tool)((async o=>{const n={method:"tools/call",params:{name:t,arguments:o}},s=(await e.request(n,u)).content,{processImageContent:a}=await Promise.resolve().then((()=>i(r(70811)))),c=a(s);return JSON.stringify(c)}),{name:t,description:o,schema:n})}function g(e){if("object"!==e.type||!e.properties)throw new Error("Invalid schema type or missing properties");const t=Object.entries(e.properties).reduce(((e,[t,r])=>(e[t]=c.z.any(),e)),{});return c.z.object(t)}t.MCPToolkit=h},17260:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AutocompleteRegistryService=void 0;const a=r(3563),c=r(96428),l=r(12425),d=i(r(19055));let u=o=class{constructor(e,t){this.filePathProvider=e,this.slashCommandProvider=t,this.providers=new Map,this.registerProvider(e),this.registerProvider(t),d.default.info(`[${o.name}] Initialized with providers for triggers: ${this.getAllTriggerChars().join(", ")}`)}registerProvider(e){const t=e.getTriggerChar();this.providers.has(t)&&d.default.warn(`[${o.name}] Provider for trigger "${t}" already registered. Overwriting.`),this.providers.set(t,e),d.default.info(`[${o.name}] Registered provider "${e.getName()}" for trigger "${t}"`)}getProvider(e){return this.providers.get(e)}getAllTriggerChars(){return Array.from(this.providers.keys())}async search(e,t,r){const n=this.getProvider(e);if(!n)return d.default.warn(`[${o.name}] No provider found for trigger "${e}"`),[];try{return d.default.debug(`[${o.name}] Searching with provider "${n.getName()}" for query "${t}"`),await n.search(t,r)}catch(e){return d.default.error(`[${o.name}] Error during search with provider "${n.getName()}": ${e.message}`,e.stack),[]}}};t.AutocompleteRegistryService=u,t.AutocompleteRegistryService=u=o=n([(0,a.Injectable)(),s("design:paramtypes",[c.FilePathAutocompleteProvider,l.SlashCommandAutocompleteProvider])],u)},17299:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XAI_STATIC_MODELS=t.getXaiModelCapabilities=t.getDefaultXaiModelId=t.getXaiStaticModels=t.XAI_API_KEY_NAME=t.XAI_BASE_URL=t.XAI_PROVIDER_ID=t.XaiAdapter=t.XaiProvider=void 0;var o=r(67182);Object.defineProperty(t,"XaiProvider",{enumerable:!0,get:function(){return o.XaiProvider}});var n=r(32260);Object.defineProperty(t,"XaiAdapter",{enumerable:!0,get:function(){return n.XaiAdapter}});var s=r(9106);Object.defineProperty(t,"XAI_PROVIDER_ID",{enumerable:!0,get:function(){return s.XAI_PROVIDER_ID}}),Object.defineProperty(t,"XAI_BASE_URL",{enumerable:!0,get:function(){return s.XAI_BASE_URL}}),Object.defineProperty(t,"XAI_API_KEY_NAME",{enumerable:!0,get:function(){return s.XAI_API_KEY_NAME}});var i=r(45733);Object.defineProperty(t,"getXaiStaticModels",{enumerable:!0,get:function(){return i.getXaiStaticModels}}),Object.defineProperty(t,"getDefaultXaiModelId",{enumerable:!0,get:function(){return i.getDefaultXaiModelId}}),Object.defineProperty(t,"getXaiModelCapabilities",{enumerable:!0,get:function(){return i.getXaiModelCapabilities}}),Object.defineProperty(t,"XAI_STATIC_MODELS",{enumerable:!0,get:function(){return i.XAI_STATIC_MODELS}})},17331:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FIREWORKS_PROVIDER_ID=t.getDefaultFireworksModelId=t.discoverFireworksModels=t.FireworksProvider=void 0;var o=r(39774);Object.defineProperty(t,"FireworksProvider",{enumerable:!0,get:function(){return o.FireworksProvider}});var n=r(86997);Object.defineProperty(t,"discoverFireworksModels",{enumerable:!0,get:function(){return n.discoverFireworksModels}}),Object.defineProperty(t,"getDefaultFireworksModelId",{enumerable:!0,get:function(){return n.getDefaultFireworksModelId}}),Object.defineProperty(t,"FIREWORKS_PROVIDER_ID",{enumerable:!0,get:function(){return n.FIREWORKS_PROVIDER_ID}})},17393:e=>{"use strict";e.exports=require("mammoth")},18400:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleLlmCacheService=void 0;const s=r(3563),i=r(76982),a=n(r(19055));let c=class{constructor(){this.cache=new Map,this.DEFAULT_TTL=36e5,this.MAX_CACHE_SIZE=1e3}generateCacheKey(e,t,r,o,n){const s={systemPrompt:e,messages:t.map((e=>({role:e.role,content:e.segments.map((e=>({type:e.type,content:e.content})))}))),options:{temperature:r.temperature,topP:r.topP,maxTokens:r.maxTokens,frequencyPenalty:r.frequencyPenalty,presencePenalty:r.presencePenalty},providerId:o,modelId:n},c=(0,i.createHash)("sha256").update(JSON.stringify(s)).digest("hex");return a.default.debug(`[SimpleLlmCacheService] Generated cache key: ${c.substring(0,16)}... for ${o}/${n}`),c}async get(e){const t=this.cache.get(e);return t?Date.now()>t.expiresAt?(a.default.debug(`[SimpleLlmCacheService] Cache entry expired for key: ${e.substring(0,16)}...`),this.cache.delete(e),null):(a.default.debug(`[SimpleLlmCacheService] Cache hit for key: ${e.substring(0,16)}...`),t.response):(a.default.debug(`[SimpleLlmCacheService] Cache miss for key: ${e.substring(0,16)}...`),null)}async set(e,t,r){this.cache.size>=this.MAX_CACHE_SIZE&&this.evictOldestEntries();const o={response:t,expiresAt:Date.now()+(r||this.DEFAULT_TTL),createdAt:Date.now()};this.cache.set(e,o),a.default.debug(`[SimpleLlmCacheService] Cached response for key: ${e.substring(0,16)}... (expires in ${Math.round((r||this.DEFAULT_TTL)/1e3)}s)`)}async clear(){const e=this.cache.size;this.cache.clear(),a.default.info(`[SimpleLlmCacheService] Cleared ${e} cached entries`)}getStats(){const e=Array.from(this.cache.values()),t=Date.now(),r=e.filter((e=>e.expiresAt>t));let o,n;if(r.length>0){const e=r.map((e=>e.createdAt));o=new Date(Math.min(...e)),n=new Date(Math.max(...e))}return{size:this.cache.size,maxSize:this.MAX_CACHE_SIZE,oldestEntry:o,newestEntry:n}}cleanupExpiredEntries(){const e=Date.now();let t=0;for(const[r,o]of this.cache.entries())e>o.expiresAt&&(this.cache.delete(r),t++);t>0&&a.default.debug(`[SimpleLlmCacheService] Cleaned up ${t} expired entries`)}evictOldestEntries(){if(this.cleanupExpiredEntries(),this.cache.size>=this.MAX_CACHE_SIZE){const e=Array.from(this.cache.entries()).sort((([,e],[,t])=>e.createdAt-t.createdAt)),t=Math.ceil(.1*this.MAX_CACHE_SIZE);for(let r=0;r<t&&r<e.length;r++){const[t]=e[r];this.cache.delete(t)}a.default.debug(`[SimpleLlmCacheService] Evicted ${t} oldest entries`)}}shouldCache(e,t){if(t.temperature&&t.temperature>.5)return!1;return!(e.reduce(((e,t)=>e+t.segments.reduce(((e,t)=>e+(t.content?.length||0)),0)),0)<50)}startPeriodicCleanup(){setInterval((()=>{this.cleanupExpiredEntries()}),3e5),a.default.info("[SimpleLlmCacheService] Started periodic cleanup")}};t.SimpleLlmCacheService=c,t.SimpleLlmCacheService=c=o([(0,s.Injectable)()],c)},18448:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.NormalizedChunkType=void 0,function(e){e.THINKING="thinking",e.TEXT="text",e.USAGE="usage",e.STOP="stop"}(r||(t.NormalizedChunkType=r={}))},18460:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetIndexingService=void 0;const u=r(3563),p=r(52368),f=d(r(19055)),h=r(26932),m=r(77184),g=r(17093),y=r(15796),v=r(7310),_=r(68565),w=r(69179),b=r(3153),k=r(44897),S=r(60779),T=c(r(16928)),R=r(59100);let C=n=class{constructor(e,t,r){this.configService=e,this.datasetRepository=t,this.documentRepository=r,this.embeddingsModel=process.env.EMBEDDINGS_MODEL||"Xenova/all-mpnet-base-v2",this.chunkSize=parseInt(process.env.CHUNK_SIZE||"1000",10),this.chunkOverlap=parseInt(process.env.CHUNK_OVERLAP||"200",10),this.chromaUrl=process.env.CHROMA_URL||"http://localhost:8000"}getLoader(e){const t=T.extname(e).toLowerCase();let r;switch(f.default.info(`[${n.name}] Selecting loader for file extension: ${t}`),t){case".pdf":f.default.info(`[${n.name}] Using PDFLoader`),r=new _.PDFLoader(e);break;case".docx":f.default.info(`[${n.name}] Using DocxLoader`),r=new w.DocxLoader(e);break;case".pptx":f.default.info(`[${n.name}] Using PPTXLoader`),r=new k.PPTXLoader(e);break;case".csv":f.default.info(`[${n.name}] Using CSVLoader`),r=new S.CSVLoader(e);break;default:f.default.info(`[${n.name}] Using UnstructuredLoader for unknown file type`),r=new b.UnstructuredLoader(e)}return r}async indexDocument(e,t,r){try{f.default.info(`[${n.name}] Starting indexing process for document ${e} in dataset ${t}`),await this.documentRepository.updateStatus(e,"indexing"),f.default.info(`[${n.name}] Updated document status to 'indexing'`),f.default.info(`[${n.name}] Loading document from path: ${r}`);const o=this.getLoader(r),s=await o.load();f.default.info(`[${n.name}] Successfully loaded document with ${s.length} pages/sections`),f.default.info(`[${n.name}] Splitting text with chunk size ${this.chunkSize} and overlap ${this.chunkOverlap}`);const i=new g.RecursiveCharacterTextSplitter({chunkSize:this.chunkSize,chunkOverlap:this.chunkOverlap}),a=await i.splitDocuments(s);f.default.info(`[${n.name}] Text split into ${a.length} chunks`),a.forEach((t=>{const r=(0,R.ulid)();t.id=r,t.metadata.original_document_id=e,t.metadata.id=r})),f.default.info(`[${n.name}] Initializing embeddings model: ${this.embeddingsModel}`);const c=new v.HuggingFaceTransformersEmbeddings({modelName:this.embeddingsModel}),l=await this.datasetRepository.findById(t);if(!l)throw new Error("Dataset not found");f.default.info(`[${n.name}] Using dataset collection name: ${l.name}`),f.default.info(`[${n.name}] Storing vectors in Chroma at ${this.chromaUrl}`);await y.Chroma.fromDocuments(a,c,{collectionName:l.name,url:this.chromaUrl});f.default.info(`[${n.name}] Successfully stored vectors in Chroma`),await this.documentRepository.updateStatus(e,"indexed"),f.default.info(`[${n.name}] Successfully completed indexing of document ${e} in dataset ${t}`)}catch(r){throw f.default.error(`[${n.name}] Failed to index document ${e} in dataset ${t}`),f.default.error(`[${n.name}] Error details: ${r.message}`),r.stack&&f.default.error(`[${n.name}] Stack trace: ${r.stack}`),await this.documentRepository.updateStatus(e,"error"),r}}async removeDocumentFromIndex(e,t){try{f.default.info(`[${n.name}] Removing document ${e} from index collection ${t}`);const r=new v.HuggingFaceTransformersEmbeddings({modelName:this.embeddingsModel}),o=new y.Chroma(r,{collectionName:t,url:this.chromaUrl});await o.delete({filter:{original_document_id:e}}),f.default.info(`[${n.name}] Successfully removed document ${e} from index`)}catch(t){throw f.default.error(`[${n.name}] Failed to remove document ${e} from index: ${t.message}`),t}}};t.DatasetIndexingService=C,t.DatasetIndexingService=C=n=a([(0,u.Injectable)(),l("design:paramtypes",[p.ConfigService,m.DatasetRepository,h.DatasetDocumentRepository])],C)},18557:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToolUseGuidelinesComponent=void 0;t.ToolUseGuidelinesComponent=class{constructor(){this.id="tool-use-guidelines",this.name="Tool Use Guidelines",this.description="Core tool usage rules, file system guidelines, and tool combination strategies",this.category="required",this.canOptOut=!1,this.defaultEnabled=!0}getContent(e){return`TOOL USE\n\nYou have access to a set of tools that are executed upon the user's approval. You can use one tool per message, and will receive the result of that tool use in the user's response. You use tools step-by-step to accomplish a given task, with each tool use informed by the result of the previous tool use.\n\nCRITICAL: Only one tool may be used per message. The system will interrupt your response if you attempt to use multiple tools. You must assess the result of each tool use before proceeding with additional tools.\n\n# Tool Use Formatting\n\nTool use is formatted using XML-style tags. The tool name is enclosed in opening and closing tags, and each parameter is similarly enclosed within its own set of tags. Here's the structure:\n\n<tool_name>\n<parameter1_name>value1</parameter1_name>\n<parameter2_name>value2</parameter2_name>\n...\n</tool_name>\n\nFor example:\n\n<read_file>\n<path>src/main.js</path>\n</read_file>\n\nIMPORTANT: NEVER try to wrap the tool call in an xml code block with backticks!\nIMPORTANT: DO NOT USE <tool_use> OR <tool_name> TAGS AT ALL.\n\nAlways adhere to this format for the tool use to ensure proper parsing and execution.\n\n# File System and Path Guidelines\n\n- Your current working directory is: ${e.workingDir}\n- You cannot cd into a different directory to complete a task\n- Always use relative paths from ${e.workingDir}\n- Do not use the ~ character or $HOME references\n- The write_to_file tool automatically creates necessary directories\n- Be sure to pass correct 'path' parameter to tools requiring paths\n\n# Tool Result Confirmation\n\n- It is CRITICAL you wait for user response after each tool use\n- Confirm success of each tool before proceeding to next step\n- Each tool use must be informed by the result of previous tool use\n- Never assume tool outcomes - wait for explicit confirmation\n\n# Tool Selection and Combination Strategy\n\n- Choose most appropriate tool based on task requirements\n- Consider tool effectiveness: list_files more effective than ls command\n- Use tool combinations for comprehensive analysis:\n  * search_files → read_file → replace_in_file workflow\n  * list_files → read_file for understanding structure\n- Use available tools to avoid asking user unnecessary questions\n\n# Tool Use Guidelines\n\n1. In <thinking> tags, assess what information you already have and what information you need to proceed with the task.\n2. Choose the most appropriate tool based on the task and the tool descriptions provided. Assess if you need additional information to proceed, and which of the available tools would be most effective for gathering this information. For example using the list_files tool is more effective than running a command like \`ls\` in the terminal. It's critical that you think about each available tool and use the one that best fits the current step in the task.\n3. If multiple actions are needed, use one tool at a time per message to accomplish the task iteratively, with each tool use being informed by the result of the previous tool use. Do not assume the outcome of any tool use. Each step must be informed by the previous step's result.\n4. Formulate your tool use using the XML format specified for each tool.\n5. After each tool use, the user will respond with the result of that tool use. This result will provide you with the necessary information to continue your task or make further decisions. This response may include:\n  - Information about whether the tool succeeded or failed, along with any reasons for failure.\n  - Linter errors that may have arisen due to the changes you made, which you'll need to address.\n  - New terminal output in reaction to the changes, which you may need to consider or act upon.\n  - Any other relevant feedback or information related to the tool use.\n6. ALWAYS wait for user confirmation after each tool use before proceeding. Never assume the success of a tool use without explicit confirmation of the result from the user.\n\nIMPORTANT: If you attempt to use multiple tools in a single message, your response will be interrupted with the message "Response interrupted: Only one tool may be used per message. The first tool call has been processed. Please assess its result before using additional tools." You must then wait for the tool result and continue with your next tool use in a subsequent message.\n\nIt is crucial to proceed step-by-step, waiting for the user's message after each tool use before moving forward with the task. This approach allows you to:\n1. Confirm the success of each step before proceeding.\n2. Address any issues or errors that arise immediately.\n3. Adapt your approach based on new information or unexpected results.\n4. Ensure that each action builds correctly on the previous ones.\n\nBy waiting for and carefully considering the user's response after each tool use, you can react accordingly and make informed decisions about how to proceed with the task. This iterative process helps ensure the overall success and accuracy of your work.`}}},18615:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromptBuilderService=void 0;const u=r(3563),p=c(r(16928)),f=d(r(19055)),h=r(62678),m=r(22141),g=r(96170),y=r(19668),v=r(88474),_=r(10289),w=r(9833),b=r(75870),k=r(43510);let S=n=class{constructor(e,t,r,o,s,i,a){this.fileSystemService=e,this.rulesService=t,this.userService=r,this.workspaceService=o,this.recentFilesCacheService=s,this.directoryStructureCacheService=i,this.personaAssemblerService=a,this.FILE_LIST_LIMIT=100,this.TASK_CACHE_SIZE=20,this.taskRecentFilesCache=new h.LRUCache({max:this.TASK_CACHE_SIZE}),this.taskDirectoryCache=new h.LRUCache({max:this.TASK_CACHE_SIZE}),f.default.info(`[${n.name}] PromptBuilderService initialized with LRU caches (size: ${this.TASK_CACHE_SIZE})`)}async buildPersonaSystemPrompt(e,t,r,o=[]){f.default.debug(`[${n.name}] Building system prompt for persona: ${e.getId()}`),f.default.debug(`[${n.name}] Context mode: ${r.currentMode}, working dir: ${r.workingDir}`),f.default.debug(`[${n.name}] Tools count: ${t.length}`);const s=e.getConfiguration();if(!s)throw new Error(`Persona ${e.getId()} does not support component-based configuration`);const i=o.length>0?o:this.personaAssemblerService.getDefaultEnabledOptionalComponents(),a=this.personaAssemblerService.assemblePrompt(s,i,r);f.default.debug(`[${n.name}] Assembled prompt length: ${a.fullPrompt.length} characters`);const c=await this.generateToolInstructions(t,r);f.default.debug(`[${n.name}] Tool instructions length: ${c.length} characters`);let l=a.fullPrompt,d=[];if(l.includes("{{USER_RULES_PLACEHOLDER}}")){const e=await this.getUserInstructions(r.workingDir,r.workspaceName),t=e.userInstructions;d=e.referencedFiles,f.default.debug(`[${n.name}] User instructions found: ${t?"yes":"no"}`);const o=t?`USER'S CUSTOM INSTRUCTIONS\n\nIMPORTANT: THE FOLLOWING ADDITIONAL INSTRUCTIONS ARE PROVIDED BY THE USER AND MUST BE FOLLOWED TO THE BEST OF YOUR ABILITY (WITHOUT INTERFERRING WITH THE TOOL USE GUIDE).\nWhen you do something because of a user instruction then call it out the rule you are following by name.\n\n${t}`:"";l=l.replace("{{USER_RULES_PLACEHOLDER}}",o)}l.includes("{{WORKSPACE_FILES_PLACEHOLDER}}")&&(l=l.replace("{{WORKSPACE_FILES_PLACEHOLDER}}",""));const u=await this.buildEnvironmentDetailsBlock(e,r);f.default.debug(`[${n.name}] Environment details length: ${u.length} characters`);let p=`${l}\n\n# Tools\n\n${c}\n\n====\n\n${u}`;if(d.length>0){p+=`\n\n====\n\nRULE-REFERENCED FILES\n\n${d.map((e=>e.content)).join("\n\n")}`}f.default.debug(`[${n.name}] Final prompt assembled with total length: ${p.length} characters`);const h=Math.round(p.length/4);return f.default.info(`[${n.name}] Estimated input tokens for system prompt: ~${h} tokens`),p}async buildEnvironmentDetailsBlock(e,t){f.default.debug(`[${n.name}] Building environment details block for persona: ${e.getId()}`);let r=`<environment_details>\n# Current Time\n${t.currentTime}`;const o=e.getConfiguration();if(o&&o.optionalComponents.includes("workspace-files")){f.default.debug(`[${n.name}] Workspace files component enabled, getting workspace files for: ${t.workingDir}`),f.default.debug(`[${n.name}] Context size category: ${t.contextSizeCategory}`);const e=(0,b.getFileLimitsForContextSize)(t.contextSizeCategory);f.default.debug(`[${n.name}] Using limits for ${t.contextSizeCategory}: ${JSON.stringify(e)}`);const o=await this.buildWorkspaceContextBlock(t.workingDir,{maxTokens:e.maxTokens,maxFiles:e.maxFiles,includeStats:!1}),s=await this.buildDirectoryStructureContextBlock(t.workingDir,t.taskId,e.maxDirectories),i=await this.buildRecentFilesContextBlock(t.workingDir,t.taskId,e.maxRecentFiles);r+=`\n\n${o}`,s&&(r+=`\n\n${s}`),i&&(r+=`\n\n${i}`)}else f.default.debug(`[${n.name}] Workspace files component not enabled, skipping file listings`);return r+=`\n\n# Current Mode\n${t.currentMode.toUpperCase()} MODE`,"plan"===t.currentMode&&(r+='\nIn this mode you should focus on information gathering, asking questions, and architecting a solution. Once you have a plan, use the plan_mode_respond tool to engage in a conversational back and forth with the user. Do not use the plan_mode_respond tool until you\'ve gathered all the information you need e.g. with read_file or ask_followup_question.\n(Remember: If it seems the user wants you to use tools only available in Act Mode, you should ask the user to "toggle to Act mode" (use those words) - they will have to manually do this themselves with the Plan/Act toggle button below. You do not have the ability to switch to Act Mode yourself, and must wait for the user to do it themselves once they are satisfied with the plan. You also cannot present an option to toggle to Act mode, as this will be something you need to direct the user to do manually themselves.)'),r+="\n</environment_details>",r}async generateToolInstructions(e,t){return await Promise.all(e.map((e=>e.initialize(t)))),e.map((e=>e.getUsageInstructions(t))).join("\n\n")}async getUserInstructions(e,t){try{const r=await this.userService.getCurrentUser(),o=r.userId;f.default.debug(`[${n.name}] Getting user instructions with user ID: ${o} (${r.email})`);const{rulesText:s,referencedFiles:i}=await this.getRulesForSystemPrompt(e,o,t);return{userInstructions:s,referencedFiles:i}}catch(e){return f.default.error(`[${n.name}] Error getting user instructions: ${e.message}\n${e.stack}`),{referencedFiles:[]}}}async getRulesForSystemPrompt(e,t,r){try{f.default.debug(`[${n.name}] Getting rules for system prompt from working directory: ${e}`),r||(r=p.basename(e),f.default.debug(`[${n.name}] Extracted workspace name from path: ${r}`));const{rulesText:o,referencedFiles:s}=await this.rulesService.getRulesWithProcessedMentions(e,t,r);return o?f.default.debug(`[${n.name}] Found rules for system prompt with ${s.length} referenced files`):f.default.debug(`[${n.name}] No enabled rules found for system prompt`),{rulesText:o,referencedFiles:s}}catch(e){return f.default.error(`[${n.name}] Error getting rules for system prompt: ${e.message}`),{referencedFiles:[]}}}async buildWorkspaceContextBlock(e,t={}){f.default.debug(`[${n.name}] Building workspace context block for: ${e}`);const{files:r,truncationMarkers:o,stats:s}=await this.fileSystemService.getWorkspaceFileListForLLM(e,{maxTokens:t.maxTokens||5e4,maxFiles:t.maxFiles||1e3});f.default.info(`[${n.name}] File list stats: ${s.includedFiles}/${s.totalFiles} files, ~${Math.round(s.estimatedTokens/1e3)}K tokens, truncated: ${s.truncated}`),f.default.debug(`[${n.name}] Full file list: ${JSON.stringify(r.map((e=>e.path)))}`);let i="# Workspace Files\n\n";(s.truncated||t.includeStats)&&(i+=`${s.truncated?"⚠️ ":""}File list ${s.truncated?"truncated ":""}`,i+=`(${s.includedFiles}/${s.totalFiles} files, ~${Math.round(s.estimatedTokens/1e3)}K tokens)\n\n`);const a=new Map(o.map((e=>[e.directory,e])));let c="";for(const e of r){const t=e.path.includes("/")?e.path.substring(0,e.path.lastIndexOf("/")):"";if(t!==c){if(a.has(t)){i+=`- ${t}/ _(${a.get(t).droppedCount} more files not shown)_\n`,a.delete(t)}c=t}i+=`- ${e.path}${e.isDir?"/":""}\n`}for(const[e,t]of a.entries())i+=`- ${e}/ _(${t.droppedCount} more files not shown)_\n`;return i}async buildDirectoryStructureContextBlock(e,t,r=-1){f.default.debug(`[${n.name}] Building directory structure context for: ${e}`);try{let o;const s=t?`${e}:${t}`:"";if(t&&this.taskDirectoryCache.has(s)?(o=this.taskDirectoryCache.get(s),f.default.debug(`[${n.name}] Using cached directory structure for task: ${t}`)):(o=await this.directoryStructureCacheService.getDirectoryStructure(e),t&&(this.taskDirectoryCache.set(s,o),f.default.debug(`[${n.name}] Cached directory structure for task: ${t}`))),0===o.length)return f.default.debug(`[${n.name}] No directory structure found for workspace`),"";r>0&&o.length>r&&(o=o.slice(0,r),f.default.debug(`[${n.name}] Limited directories to ${r} for context size optimization`)),f.default.debug(`[${n.name}] Found ${o.length} directories for structure`);let i=`# Directory Structure\n\nRepository directory structure (breadth-first, up to ${o.length} directories):\n`;for(const e of o)i+=`- ${e.path}/\n`;return i}catch(e){return f.default.error(`[${n.name}] Error building directory structure context: ${e.message}`),""}}async buildRecentFilesContextBlock(e,t,r=25){f.default.debug(`[${n.name}] Building recent files context for: ${e}`);try{let o;const s=t?`${e}:${t}`:"";if(t&&this.taskRecentFilesCache.has(s)?(o=this.taskRecentFilesCache.get(s),f.default.debug(`[${n.name}] Using cached recent files for task: ${t}`)):(o=await this.recentFilesCacheService.getRecentFiles(e,!1),t&&(this.taskRecentFilesCache.set(s,o),f.default.debug(`[${n.name}] Cached recent files for task: ${t}`))),0===o.length)return f.default.debug(`[${n.name}] No recent files found for workspace`),"";f.default.debug(`[${n.name}] Found ${o.length} recent files`);const i=o.slice(0,r);let a=`# Recently Modified Files\n\nThe last ${i.length} modified files in the repo were:\n`;for(const e of i)a+=`${e.path}\n`;return a}catch(e){return f.default.error(`[${n.name}] Error building recent files context: ${e.message}`),""}}async buildTaskWorkspaceContextBlock(e){f.default.debug(`[${n.name}] Building task workspace context for workspace: ${e}`);const t=await this.workspaceService.findOne(e);if(!t)throw new Error(`Workspace ${e} not found`);return this.buildWorkspaceContextBlock(t.repoBaseDir,{maxTokens:5e4,maxFiles:1e3,includeStats:!0})}};t.PromptBuilderService=S,t.PromptBuilderService=S=n=a([(0,u.Injectable)(),l("design:paramtypes",[m.FileSystemService,g.RulesService,y.UserService,v.WorkspaceService,_.RecentFilesCacheService,w.DirectoryStructureCacheService,k.PersonaAssemblerService])],S)},19055:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=i(r(55124)),l=i(r(79896)),d=i(r(16928)),u=r(48884),p=a(r(79233)),f=d.join(process.cwd(),"logs");l.existsSync(f)||l.mkdirSync(f,{recursive:!0});const h=d.join(f,"debug");l.existsSync(h)||l.mkdirSync(h,{recursive:!0});const m=d.join(f,"eve-server-%DATE%.log"),g=(0,u.getEnv)("LOG_FILE_PATH",m);console.log(`Log file pattern: ${g}`);const y=new p.default({filename:g,datePattern:"YYYY-MM-DD",zippedArchive:!0,maxSize:"20m",maxFiles:"14d",level:"debug"}),v=c.format.printf((e=>{const{level:t,message:r,timestamp:o}=e,n=new Date(o);return`${`${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getDate().toString().padStart(2,"0")}/${n.getFullYear()}, ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}:${n.getSeconds().toString().padStart(2,"0")} ${n.getHours()>=12?"PM":"AM"}`} - ${t.toUpperCase()}: ${r}`})),_=c.createLogger({level:"debug",format:c.format.combine(c.format.splat(),c.format.timestamp(),v),transports:[new c.transports.Console({level:"info"}),y]});t.default=_},19314:e=>{"use strict";e.exports=require("@langchain/langgraph")},19612:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.UnifiedTagDetector=void 0;const n=r(3563),s=r(81685);let i=class{constructor(){this.thinkingTagNames=["thinking","reasoning"],this.toolCallTagNames=s.TOOL_CALL_TAGS,this.OPENING_TAG_PATTERN=/<([a-zA-Z_][a-zA-Z0-9_]*?)>/g,this.CLOSING_TAG_PATTERN=/<\/([a-zA-Z_][a-zA-Z0-9_]*?)>/g,this.PARTIAL_OPENING_PATTERN=/<[a-zA-Z_][a-zA-Z0-9_]*?$/,this.PARTIAL_CLOSING_PATTERN=/^<\/[a-zA-Z_][a-zA-Z0-9_]*?>?/}setThinkingTagNames(e){this.thinkingTagNames=e}setToolCallTagNames(e){this.toolCallTagNames=e}getTagType(e){return this.thinkingTagNames.includes(e)?"thinking":this.toolCallTagNames.includes(e)?"tool_call":null}isKnownTag(e){return null!==this.getTagType(e)}findOpeningTag(e){let t;for(this.OPENING_TAG_PATTERN.lastIndex=0;null!==(t=this.OPENING_TAG_PATTERN.exec(e));){const e=t[1],r=this.getTagType(e);if(r)return{tagName:e,tagType:r,startIndex:t.index,endIndex:t.index+t[0].length}}return null}findClosingTag(e,t,r){const o=new RegExp(`</${t}>`,"g");o.lastIndex=r;const n=o.exec(e);return n?{startIndex:n.index,endIndex:n.index+n[0].length}:null}findCompleteTag(e){let t;for(this.OPENING_TAG_PATTERN.lastIndex=0;null!==(t=this.OPENING_TAG_PATTERN.exec(e));){const r=t[1],o=this.getTagType(r);if(!o)continue;const n=t.index,s=t.index+t[0].length,i=this.findClosingTag(e,r,s);if(i){return{name:r,type:o,content:e.substring(s,i.startIndex).trim(),startIndex:n,endIndex:i.endIndex}}}return null}detectTag(e){const t=this.findCompleteTag(e);if(!t)return null;return{preContent:e.substring(0,t.startIndex),tag:t,postContent:e.substring(t.endIndex)}}hasPartialOpeningTag(e){return null!==e.match(this.PARTIAL_OPENING_PATTERN)}hasPartialClosingTag(e){return null!==e.match(this.PARTIAL_CLOSING_PATTERN)}findAllCompleteTags(e){const t=[],r=[...this.thinkingTagNames,...this.toolCallTagNames];for(const o of r){const r=this.getTagType(o),n=`<${o}>`,s=`</${o}>`;let i=0;for(;i<e.length;){const a=e.indexOf(n,i);if(-1===a)break;const c=a+n.length,l=e.indexOf(s,c);if(-1!==l){const n=e.substring(c,l);t.push({name:o,type:r,content:n.trim(),startIndex:a,endIndex:l+s.length}),i=l+s.length}else i=a+1}}return t.sort(((e,t)=>e.startIndex-t.startIndex))}detectAllTags(e,t=!0){const r=this.findAllCompleteTags(e);let o=e;for(let e=r.length-1;e>=0;e--){const n=r[e];"thinking"===n.type&&t||(n.content=`<${n.name}>${n.content}</${n.name}>`),o=o.substring(0,n.startIndex)+o.substring(n.endIndex)}return{tags:r,remainingContent:o.trim(),hasAnyTags:r.length>0}}extractTagContent(e,t){const r=`<${t}>`,o=`</${t}>`,n=e.indexOf(r);if(-1===n)return"";const s=n+r.length,i=e.indexOf(o,s);return-1===i?"":e.substring(s,i)}getThinkingTagNames(){return[...this.thinkingTagNames]}getToolCallTagNames(){return[...this.toolCallTagNames]}getAllTagNames(){return[...this.thinkingTagNames,...this.toolCallTagNames]}};t.UnifiedTagDetector=i,t.UnifiedTagDetector=i=o([(0,n.Injectable)()],i)},19615:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Task=t.TaskStatus=void 0;const o=r(59100);var n;!function(e){e.BACKLOG="backlog",e.IN_PROGRESS="in_progress",e.DONE="done"}(n||(t.TaskStatus=n={}));t.Task=class{constructor(e,t,r=n.BACKLOG,s=(0,o.ulid)(),i=new Date,a=new Date){this.id=s,this.title=e,this.description=t,this.status=r,this.createdAt=i,this.updatedAt=a}}},19668:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserService=t.AuthenticationError=void 0;const d=r(3563),u=r(52368),p=l(r(58938)),f=a(r(70857)),h=l(r(19055));class m extends Error{constructor(e,t){super(e),this.cause=t,this.name="AuthenticationError"}}t.AuthenticationError=m;let g=class{constructor(e){this.configService=e,this.userData=null,this.lastAuthCheck=null,this.CACHE_TTL_MS=864e5}async getCurrentUser(){if(h.default.debug("[UserService] Getting current user data"),this.userData&&this.lastAuthCheck&&Date.now()-this.lastAuthCheck.getTime()<this.CACHE_TTL_MS)return h.default.debug(`[UserService] Using cached user data: ${this.userData.email} (ID: ${this.userData.userId})`),this.userData;h.default.debug("[UserService] No valid cached user data, authenticating with API");const e=this.configService.getProperty("EVE_API_KEY");if(!e)throw h.default.error("[UserService] API Key is not configured"),new m("API Key is not configured");if(!this.isValidUUID(e))throw h.default.error("[UserService] Invalid API Key format"),new m("Invalid API Key format");try{const t=f.hostname(),r=await p.default.post("https://otiiwxlfsrejhbrxdras.supabase.co/functions/v1/log-access",{hostname:t},{headers:{Authorization:`Bearer ${e}`},timeout:3e3});if(r.data&&r.data.userId&&r.data.email){const{userId:e,email:t}=r.data;return this.userData={userId:e,email:t},this.lastAuthCheck=new Date,h.default.info(`[UserService] Access granted for user: ${t} (ID: ${e})`),this.userData}throw h.default.error("[UserService] Log access response did not contain expected user data"),new m("Authentication response did not contain expected user data")}catch(e){const t=e;throw t.response?(h.default.error(`[UserService] Authentication failed with status ${t.response.status}`),new m(`Authentication failed with status ${t.response.status}`,e)):t.request?(h.default.error("[UserService] Authentication request failed - no response from server"),new m("Authentication server is unreachable",e)):(h.default.error("[UserService] Authentication request setup failed",e),new m("Authentication request setup failed",e))}}isValidUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}};t.UserService=g,t.UserService=g=i([(0,d.Injectable)(),c("design:paramtypes",[u.ConfigService])],g)},19969:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StdioClientTransport=t.DEFAULT_INHERITED_ENV_VARS=void 0,t.getDefaultEnvironment=a;const n=o(r(4044)),s=o(r(1708)),i=r(8047);function a(){const e={};for(const r of t.DEFAULT_INHERITED_ENV_VARS){const t=s.default.env[r];void 0!==t&&(t.startsWith("()")||(e[r]=t))}return e}t.DEFAULT_INHERITED_ENV_VARS="win32"===s.default.platform?["APPDATA","HOMEDRIVE","HOMEPATH","LOCALAPPDATA","PATH","PROCESSOR_ARCHITECTURE","SYSTEMDRIVE","SYSTEMROOT","TEMP","USERNAME","USERPROFILE"]:["HOME","LOGNAME","PATH","SHELL","TERM","USER"];t.StdioClientTransport=class{constructor(e){this._abortController=new AbortController,this._readBuffer=new i.ReadBuffer,this._serverParams=e}async start(){if(this._process)throw new Error("StdioClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise(((e,t)=>{var r,o,i,c,l,d;this._process=(0,n.default)(this._serverParams.command,null!==(r=this._serverParams.args)&&void 0!==r?r:[],{env:null!==(o=this._serverParams.env)&&void 0!==o?o:a(),stdio:["pipe","pipe",null!==(i=this._serverParams.stderr)&&void 0!==i?i:"inherit"],shell:!1,signal:this._abortController.signal,windowsHide:"win32"===s.default.platform&&"type"in s.default,cwd:this._serverParams.cwd}),this._process.on("error",(e=>{var r,o;"AbortError"!==e.name?(t(e),null===(o=this.onerror)||void 0===o||o.call(this,e)):null===(r=this.onclose)||void 0===r||r.call(this)})),this._process.on("spawn",(()=>{e()})),this._process.on("close",(e=>{var t;this._process=void 0,null===(t=this.onclose)||void 0===t||t.call(this)})),null===(c=this._process.stdin)||void 0===c||c.on("error",(e=>{var t;null===(t=this.onerror)||void 0===t||t.call(this,e)})),null===(l=this._process.stdout)||void 0===l||l.on("data",(e=>{this._readBuffer.append(e),this.processReadBuffer()})),null===(d=this._process.stdout)||void 0===d||d.on("error",(e=>{var t;null===(t=this.onerror)||void 0===t||t.call(this,e)}))}))}get stderr(){var e,t;return null!==(t=null===(e=this._process)||void 0===e?void 0:e.stderr)&&void 0!==t?t:null}processReadBuffer(){for(var e,t;;)try{const t=this._readBuffer.readMessage();if(null===t)break;null===(e=this.onmessage)||void 0===e||e.call(this,t)}catch(e){null===(t=this.onerror)||void 0===t||t.call(this,e)}}async close(){this._abortController.abort(),this._process=void 0,this._readBuffer.clear()}send(e){return new Promise((t=>{var r;if(!(null===(r=this._process)||void 0===r?void 0:r.stdin))throw new Error("Not connected");const o=(0,i.serializeMessage)(e);this._process.stdin.write(o)?t():this._process.stdin.once("drain",t)}))}}},20150:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CostCalculationService=void 0;const i=r(3563),a=s(r(19055));let c=class{constructor(){this.serviceName="CostCalculationService",a.default.info(`[${this.serviceName}] Initialized`)}calculateUsageCost(e,t){if(!t)return a.default.warn(`[${this.serviceName}] Model info not provided, cannot calculate cost.`),0;let r=0;if(e.inputTokens>0&&void 0!==t.inputCostPerMillionTokens&&null!==t.inputCostPerMillionTokens&&(r+=e.inputTokens*t.inputCostPerMillionTokens/1e6),e.outputTokens>0&&void 0!==t.outputCostPerMillionTokens&&null!==t.outputCostPerMillionTokens&&(r+=e.outputTokens*t.outputCostPerMillionTokens/1e6),e.cacheWriteTokens>0){const o=t.cacheWritesPrice??t.inputCostPerMillionTokens;null!=o&&(r+=e.cacheWriteTokens*o/1e6)}return e.cacheReadTokens>0&&void 0!==t.cacheReadsPrice&&null!==t.cacheReadsPrice&&(r+=e.cacheReadTokens*t.cacheReadsPrice/1e6),r}};t.CostCalculationService=c,t.CostCalculationService=c=o([(0,i.Injectable)(),n("design:paramtypes",[])],c)},20436:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseTool=void 0;t.BaseTool=class{constructor(e){this.modeConfig={availableInPlan:!0,availableInAct:!0,planModeRestrictions:[],actModeRestrictions:[],...e}}isAvailableInMode(e){return"plan"===e?this.modeConfig.availableInPlan:this.modeConfig.availableInAct}async initialize(e){}getUsageInstructions(e){const t=this.getBaseUsageInstructions(e),r=this.getModeSpecificGuidance(e.currentMode);let o=t;r&&(o+=`\n\n${r}`);const n="plan"===e.currentMode?this.modeConfig.planModeRestrictions:this.modeConfig.actModeRestrictions;return n&&n.length>0&&(o+=`\n\n${e.currentMode.toUpperCase()} MODE RESTRICTIONS:`,n.forEach((e=>{o+=`\n- ${e}`}))),o}getFailureHandlingSuggestion(e){return null}}},20508:e=>{"use strict";e.exports=require("tree-sitter")},20712:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EveAgentOutgoingGateway=void 0;const a=r(76134),c=r(74437),l=r(3563),d=r(50461),u=i(r(19055)),p=r(96297),f=r(44810),h=r(91280),m=r(55324);let g=o=class{constructor(e,t){this.webSocketService=e,this.eventEmitter=t}afterInit(e){this.webSocketService.setServer(e),u.default.info(`[${o.name}] Gateway initialized and server set in WebSocketService`)}extractErrorMessage(e){let t="";if(e?.batchComplete&&e?.summary&&Array.isArray(e.summary)){const r=e.summary.filter((e=>"error"===e.status));if(r.length>0){const e=r[r.length-1];t=e.result?.error||e.result?.message||""}}else e?.error?t=e.error:e?.message&&(t=e.message);return t||(t="Tool execution failed - no error details available"),t.length>100&&(t=t.substring(0,100)+"..."),t}async handleToolExecutionCompleted(e){switch(u.default.debug(`[${o.name}] Received ${h.InternalEvents.TOOL_EXECUTION_COMPLETED} event for task ${e.taskId}, tool ${e.toolName}, status: ${e.status}`),e.status){case"success":u.default.info(`[${o.name}] Tool ${e.toolName} executed successfully for task ${e.taskId}`);break;case"error":u.default.info(`[${o.name}] Tool ${e.toolName} execution failed for task ${e.taskId}`);const t=this.extractErrorMessage(e.result),r={clientId:e.clientId,taskId:e.taskId,error:t,type:"tool_error",code:e.result?.code,context:{toolName:e.toolName,blockId:e.blockId}};p.debugLogger.log(`Sending ${h.NotificationEvents.AGENT_ERROR} event to room ${e.taskId}`),p.debugLogger.dumpObject("AgentError payload",r),u.default.debug(`[${o.name}] Sending agentError to room ${e.taskId}`),this.webSocketService.emitToRoom(e.taskId,h.NotificationEvents.AGENT_ERROR,r);break;case"rejected":u.default.info(`[${o.name}] Tool ${e.toolName} rejected for task ${e.taskId}`)}}handleTaskStatusUpdated(e){u.default.debug(`[${o.name}] Received ${h.InternalEvents.TASK_UPDATED} event for task ${e.taskId}`),u.default.info(`[${o.name}] Task status: ${e.status}, Mode: ${e.mode||"N/A"}`),p.debugLogger.log(`Sending ${h.NotificationEvents.TASK_STATUS_UPDATED} event to room ${e.taskId}`),p.debugLogger.dumpObject("TaskStatusUpdated payload",e),u.default.debug(`[${o.name}] Sending taskStatusUpdated to room ${e.taskId}`),this.webSocketService.emitToRoom(e.taskId,h.NotificationEvents.TASK_STATUS_UPDATED,e)}handleContextTruncated(e){u.default.debug(`[${o.name}] Received ${h.NotificationEvents.CONTEXT_TRUNCATED} event for task ${e.taskId}`),u.default.info(`[${o.name}] Removed ${e.removedCount} messages: ${e.message}`),p.debugLogger.log(`Sending ${h.NotificationEvents.CONTEXT_TRUNCATED} event to room ${e.taskId}`),p.debugLogger.dumpObject("ContextTruncated payload",e),u.default.debug(`[${o.name}] Sending contextTruncated to room ${e.taskId}`),this.webSocketService.emitToRoom(e.taskId,h.NotificationEvents.CONTEXT_TRUNCATED,e)}handleTaskCreated(e){u.default.debug(`[${o.name}] Received ${h.InternalEvents.TASK_CREATED} event for task ${e.taskId}`),p.debugLogger.log(`Sending ${h.NotificationEvents.TASK_CREATED} event to client ${e.clientId} for task ${e.taskId}`),p.debugLogger.dumpObject("TaskCreated payload",e),u.default.debug(`[${o.name}] Sending taskCreated to client ${e.clientId} for task ${e.taskId}`),this.webSocketService.emitToClient(e.clientId,h.NotificationEvents.TASK_CREATED,e)}handleBlockCreated(e){u.default.debug(`[${o.name}] Received ${m.InternalBlockEvents.BLOCK_CREATED} event for block ${e.blockId} in task ${e.taskId}`);const t={type:"block",taskId:e.taskId,blockId:e.blockId,role:e.role,blockType:e.blockType,tagName:e.tagName,status:e.status,content:e.content,description:e.description,metadata:e.metadata?JSON.parse(e.metadata):void 0,errorText:e.errorText};p.debugLogger.log(`Sending ${h.NotificationEvents.BLOCK_EVENT} (created) to room ${e.taskId}`),p.debugLogger.dumpObject("BlockEvent payload (created)",t),this.webSocketService.emitToRoom(e.taskId,h.NotificationEvents.BLOCK_EVENT,t)}handleBlockUpdated(e){const t={type:"blockUpdate",taskId:e.taskId,blockId:e.blockId};void 0!==e.appendContent&&(t.appendContent=e.appendContent),void 0!==e.status&&(t.newStatus=e.status),void 0!==e.blockType&&(t.newBlockType=e.blockType),void 0!==e.tagName&&(t.newTagName=e.tagName),void 0!==e.output&&(t.output=e.output),void 0!==e.errorText&&(t.errorText=e.errorText),void 0!==e.content&&void 0===e.appendContent&&(t.newContent=e.content),void 0!==e.description&&(t.description=e.description),void 0!==e.metadata&&(t.metadata="string"==typeof e.metadata?JSON.parse(e.metadata):e.metadata);t.newStatus&&t.newStatus;p.debugLogger.log(`Sending ${h.NotificationEvents.BLOCK_EVENT} (updated) to room ${e.taskId}`),p.debugLogger.dumpObject("BlockEvent payload (updated)",t),this.webSocketService.emitToRoom(e.taskId,h.NotificationEvents.BLOCK_EVENT,t)}handleUsageTracked(e){p.debugLogger.log(`[${o.name}] Received ${m.InternalBlockEvents.USAGE_TRACKED} event for task ${e.taskId}`);const t={type:"usage",taskId:e.taskId,inputTokens:e.inputTokens,outputTokens:e.outputTokens,cacheWriteTokens:e.cacheWriteTokens,cacheReadTokens:e.cacheReadTokens,totalCost:e.totalCost};p.debugLogger.log(`Sending ${h.NotificationEvents.BLOCK_EVENT} (usage) to room ${e.taskId}`),p.debugLogger.dumpObject("BlockEvent payload (usage)",t),this.webSocketService.emitToRoom(e.taskId,h.NotificationEvents.BLOCK_EVENT,t)}handleAgentErrorNotification(e){u.default.debug(`[${o.name}] Received ${h.InternalEvents.AGENT_ERROR_NOTIFICATION} for task ${e.taskId}: ${e.error}`),p.debugLogger.log(`Sending ${h.NotificationEvents.AGENT_ERROR} event to room ${e.taskId}`),p.debugLogger.dumpObject("AgentError payload (notification)",e),this.webSocketService.emitToRoom(e.taskId,h.NotificationEvents.AGENT_ERROR,e)}};t.EveAgentOutgoingGateway=g,n([(0,a.WebSocketServer)(),s("design:type",c.Server)],g.prototype,"server",void 0),n([(0,d.OnEvent)(h.InternalEvents.TOOL_EXECUTION_COMPLETED),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],g.prototype,"handleToolExecutionCompleted",null),n([(0,d.OnEvent)(h.InternalEvents.TASK_UPDATED),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],g.prototype,"handleTaskStatusUpdated",null),n([(0,d.OnEvent)(h.NotificationEvents.CONTEXT_TRUNCATED),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],g.prototype,"handleContextTruncated",null),n([(0,d.OnEvent)(h.InternalEvents.TASK_CREATED),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],g.prototype,"handleTaskCreated",null),n([(0,d.OnEvent)(m.InternalBlockEvents.BLOCK_CREATED),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],g.prototype,"handleBlockCreated",null),n([(0,d.OnEvent)(m.InternalBlockEvents.BLOCK_UPDATED),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],g.prototype,"handleBlockUpdated",null),n([(0,d.OnEvent)(m.InternalBlockEvents.USAGE_TRACKED),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],g.prototype,"handleUsageTracked",null),n([(0,d.OnEvent)(h.InternalEvents.AGENT_ERROR_NOTIFICATION),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],g.prototype,"handleAgentErrorNotification",null),t.EveAgentOutgoingGateway=g=o=n([(0,a.WebSocketGateway)({namespace:"eve-agent",cors:{origin:"*"}}),(0,l.Injectable)(),s("design:paramtypes",[f.WebSocketService,d.EventEmitter2])],g)},21115:e=>{"use strict";e.exports=require("yauzl")},21527:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_OPENAI_MODEL_ID=t.OPENAI_MODELS=t.OPENAI_PROVIDER_ID=void 0,t.discoverOpenAIModels=async function(e,r){return Object.values(t.OPENAI_MODELS)},t.OPENAI_PROVIDER_ID="openai",t.OPENAI_MODELS={"gpt-4.1":{modelId:"gpt-4.1",providerId:t.OPENAI_PROVIDER_ID,name:"GPT-4.1",contextWindow:1e6,maxOutputTokens:16384,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:2,outputCostPerMillionTokens:8,cacheReadsPrice:.5,cacheWritesPrice:0,isDefaultForProvider:!1,editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!0}},"gpt-4.1-mini":{modelId:"gpt-4.1-mini",providerId:t.OPENAI_PROVIDER_ID,name:"GPT-4.1 Mini",contextWindow:1e6,maxOutputTokens:16384,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:.4,outputCostPerMillionTokens:1.6,cacheReadsPrice:.1,cacheWritesPrice:0,isDefaultForProvider:!1,editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!0}},"gpt-4.1-nano":{modelId:"gpt-4.1-nano",providerId:t.OPENAI_PROVIDER_ID,name:"GPT-4.1 Nano",contextWindow:1e6,maxOutputTokens:4096,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:.1,outputCostPerMillionTokens:.4,cacheReadsPrice:.025,cacheWritesPrice:0,isDefaultForProvider:!1,editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!1,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},"gpt-4o":{modelId:"gpt-4o",providerId:t.OPENAI_PROVIDER_ID,name:"GPT-4o",contextWindow:128e3,maxOutputTokens:16384,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:3,outputCostPerMillionTokens:10,cacheReadsPrice:1.5,cacheWritesPrice:0,isDefaultForProvider:!0,editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},"gpt-4o-mini":{modelId:"gpt-4o-mini",providerId:t.OPENAI_PROVIDER_ID,name:"GPT-4o Mini",contextWindow:128e3,maxOutputTokens:16384,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:.15,outputCostPerMillionTokens:.6,cacheReadsPrice:.075,cacheWritesPrice:0,isDefaultForProvider:!1,editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},"o1-preview":{modelId:"o1-preview",providerId:t.OPENAI_PROVIDER_ID,name:"o1 Preview (Reasoning)",contextWindow:2e5,maxOutputTokens:32768,supportsImages:!1,supportsToolUse:!1,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!0,supportsSystemMessages:!1,inputCostPerMillionTokens:1.1,outputCostPerMillionTokens:3.3,cacheReadsPrice:.55,cacheWritesPrice:0,isDefaultForProvider:!1,editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!1,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},o3:{modelId:"o3",providerId:t.OPENAI_PROVIDER_ID,name:"o3 (Reasoning)",contextWindow:2e5,maxOutputTokens:32768,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!0,supportsSystemMessages:!1,inputCostPerMillionTokens:10,outputCostPerMillionTokens:40,cacheReadsPrice:2.5,cacheWritesPrice:0,isDefaultForProvider:!1,editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!1,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},"o3-mini":{modelId:"o3-mini",providerId:t.OPENAI_PROVIDER_ID,name:"o3-mini (Reasoning)",contextWindow:2e5,maxOutputTokens:32768,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!0,supportsSystemMessages:!1,inputCostPerMillionTokens:1.1,outputCostPerMillionTokens:3.3,cacheReadsPrice:.55,cacheWritesPrice:0,isDefaultForProvider:!1,editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!1,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},"o3-mini-high":{modelId:"o3-mini-high",providerId:t.OPENAI_PROVIDER_ID,name:"o3-mini High (Reasoning)",contextWindow:2e5,maxOutputTokens:32768,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!0,supportsSystemMessages:!1,inputCostPerMillionTokens:1.1,outputCostPerMillionTokens:3.3,cacheReadsPrice:.55,cacheWritesPrice:0,isDefaultForProvider:!1,editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!1,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},"gpt-3.5-turbo":{modelId:"gpt-3.5-turbo",providerId:t.OPENAI_PROVIDER_ID,name:"GPT-3.5 Turbo",contextWindow:16385,maxOutputTokens:4096,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:.5,outputCostPerMillionTokens:1.5,cacheReadsPrice:.25,cacheWritesPrice:0,isDefaultForProvider:!1,editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!1,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}}},t.DEFAULT_OPENAI_MODEL_ID="gpt-4o"},21950:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GeminiNewSDKAdapter=void 0;const i=r(3563),a=r(10072),c=r(81495),l=r(40791),d=r(82757),u=r(19612),p=r(23738),f=r(38182),h=r(18448),m=r(55705),g=r(46304),y=s(r(19055));let v=class{constructor(e,t){if(this.config=e,this.options={enableVerboseLogging:!1,...t},this.config.vertexai)this.client=new a.GoogleGenAI({vertexai:!0,project:this.config.vertexProjectId,location:this.config.vertexRegion}),y.default.debug(`[GeminiNewSDKAdapter] Initialized for Vertex AI model: ${this.config.modelId} in project ${this.config.vertexProjectId}, region ${this.config.vertexRegion}`);else{if(!this.config.apiKey)throw new Error("[GeminiNewSDKAdapter] API key is required when not using Vertex AI.");this.client=new a.GoogleGenAI({apiKey:this.config.apiKey}),y.default.debug(`[GeminiNewSDKAdapter] Initialized for standard Gemini model: ${this.config.modelId} with API key: ${(0,g.getMaskedApiKey)(this.config.apiKey)}`)}this.geminiChunkAdapter=new l.GeminiChunkAdapter;const r=new u.UnifiedTagDetector,o=new p.ChunkBuffer(r),n=new f.SmartToolCallTracker;this.unifiedBlockProcessor=new d.UnifiedBlockProcessor(o,r,void 0,n),this.modelMetadata={modelId:this.config.modelId,providerId:"gemini",name:this.config.modelId,contextWindow:1048576,maxOutputTokens:this.options?.maxOutputTokens||8192,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:void 0,outputCostPerMillionTokens:void 0,cacheReadsPrice:void 0,cacheWritesPrice:void 0},this.options.enableVerboseLogging&&(y.default.debug(`[GeminiNewSDKAdapter] Initial configuration: ${JSON.stringify(this.config)}`),y.default.debug(`[GeminiNewSDKAdapter] Initial options: ${JSON.stringify(this.options)}`))}async*generateResponse(e,t,r,o){y.default.debug(`[GeminiNewSDKAdapter] Starting normalized generation for task: ${r}, model: ${this.config.modelId}`),this.options.enableVerboseLogging&&(y.default.debug(`[GeminiNewSDKAdapter] System Prompt: "${e.substring(0,100)}..."`),y.default.debug(`[GeminiNewSDKAdapter] Messages count: ${t.length}`));const n=Date.now();let s,i,c,l=0,d=0,u=0,p=!0,f=[],m={};try{const v={providerId:"gemini",taskId:r,toolCallConfig:{enabled:!0,allowMixedContent:!0},thinkingTagConfig:{enabled:!0,tagNames:["thinking","reasoning"],stripTags:!0},bufferConfig:this.options.bufferConfig,debug:this.options.enableVerboseLogging};f=t.map((e=>(0,g.convertEveMessageToGeminiNewSDK)(e))),this.options.enableVerboseLogging&&f.length>0&&y.default.debug(`[GeminiNewSDKAdapter] Last formatted message for Gemini: ${JSON.stringify(f[f.length-1])?.substring(0,200)}...`);const _={temperature:0,maxOutputTokens:this.modelMetadata.maxOutputTokens||8192,safetySettings:[{category:a.HarmCategory.HARM_CATEGORY_HARASSMENT,threshold:a.HarmBlockThreshold.BLOCK_NONE},{category:a.HarmCategory.HARM_CATEGORY_HATE_SPEECH,threshold:a.HarmBlockThreshold.BLOCK_NONE},{category:a.HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:a.HarmBlockThreshold.BLOCK_NONE},{category:a.HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:a.HarmBlockThreshold.BLOCK_NONE}],systemInstruction:e?{role:"user",parts:[{text:e}]}:void 0};m={model:this.config.modelId,contents:f,config:_};const w=await this.client.models.generateContentStream(m);let b=!0;const k=async function*(){for await(const e of w)b&&(s=Date.now()-n,y.default.debug(`[GeminiNewSDKAdapter] SDK TTFT: ${s}ms`),b=!1),e.usageMetadata&&(c=e.usageMetadata),yield e}(),S=this.convertGeminiStreamToNormalized(k,n);if(yield*this.unifiedBlockProcessor.processNormalizedStream(S,v),c){l=c.promptTokenCount??0,d=c.candidatesTokenCount??0,u=c.cachedContentTokenCount??0;const T={type:h.NormalizedChunkType.USAGE,inputTokens:l,outputTokens:d,cacheReadTokens:u,cacheWriteTokens:0,metadata:{chunkSource:"gemini",usageType:"final",totalTokenCount:c.totalTokenCount}};async function*R(){yield T}yield*this.unifiedBlockProcessor.processNormalizedStream(R(),v)}p=!0}catch(C){throw p=!1,i=C.message,C.message&&(C.message.includes("400")||C.message.includes("Bad Request"))&&(y.default.error("[GeminiNewSDKAdapter] 400 Bad Request Error - Full request details:",{taskId:r,model:this.config.modelId,systemPrompt:e?`${e.substring(0,200)}...`:"None",messagesCount:t.length,formattedMessagesCount:f?.length||0,requestPayload:JSON.stringify(m,null,2),originalMessages:JSON.stringify(t,null,2),error:C.message}),f&&f.length>0&&f.forEach(((e,t)=>{y.default.error(`[GeminiNewSDKAdapter] Formatted Message ${t}:`,{role:e.role,partsCount:e.parts?.length||0,parts:JSON.stringify(e.parts,null,2)})}))),y.default.error(`[GeminiNewSDKAdapter] Error in normalized generation: ${C.message}`,C),"GoogleGenerativeAIError"===C.name&&C.message.includes("429")&&(C.status=429),C}finally{this.captureNormalizedTelemetry(r,{sdkCallStartTime:n,ttftSdkMs:s,promptTokens:l,outputTokens:d,cacheReadTokens:u,apiSuccess:p,apiError:i})}}async*convertGeminiStreamToNormalized(e,t){try{for await(const t of e){const e=this.geminiChunkAdapter.convertChunk(t);for(const t of e)yield t}}catch(e){y.default.error(`[GeminiNewSDKAdapter] Error during Gemini stream to NormalizedChunk conversion: ${e.message}`,e),yield{type:h.NormalizedChunkType.STOP,stopReason:m.NormalizedStopReason.ERROR,metadata:{error:`Stream conversion error: ${e.message}`}}}}calculateEnhancedCosts(e,t,r){const o=this.modelMetadata;if(!o.inputCostPerMillionTokens||!o.outputCostPerMillionTokens)return void y.default.warn(`[GeminiNewSDKAdapter] Pricing info missing for model ${this.config.modelId}. Cannot calculate cost.`);let n=o.inputCostPerMillionTokens,s=o.outputCostPerMillionTokens,i=o.cacheReadsPrice||0;const a=Math.max(0,e-r),c=n*(a/1e6),l=s*(t/1e6),d=r>0?i*(r/1e6):0,u=c+l+d;return this.options.enableVerboseLogging&&(y.default.debug(`[GeminiNewSDKAdapter] Cost calculation for ${this.config.modelId}:`),y.default.debug(`  Input Tokens (Total): ${e}, (Uncached): ${a} at $${n}/M`),y.default.debug(`  Output Tokens: ${t} at $${s}/M`),y.default.debug(`  Cache Read Tokens: ${r} at $${i}/M`),y.default.debug(`  Costs - Input: $${c.toFixed(6)}, Output: $${l.toFixed(6)}, Cache Read: $${d.toFixed(6)}`),y.default.debug(`  Total Estimated Cost: $${u.toFixed(6)}`)),u}captureNormalizedTelemetry(e,t){const r=Date.now()-t.sdkCallStartTime,o=r>0&&t.outputTokens>0?t.outputTokens/(r/1e3):void 0,n=t.cacheReadTokens>0,s=t.promptTokens>0?t.cacheReadTokens/t.promptTokens*100:0;y.default.info(`[GeminiNewSDKAdapter-TELEMETRY] Task ID: ${e}, Model: ${this.config.modelId}, Path: Normalized, SDK: @google/genai`),y.default.info(`  TTFT: ${t.ttftSdkMs}ms, Total Duration: ${r}ms`),y.default.info(`  Tokens - Prompt: ${t.promptTokens}, Output: ${t.outputTokens}, Cache Read: ${t.cacheReadTokens}`),y.default.info(`  Cache - Hit: ${n}, Efficiency: ${s?.toFixed(1)}%`),y.default.info(`  API Success: ${t.apiSuccess}${t.apiError?`, Error: ${t.apiError}`:""}`),void 0!==o&&y.default.info(`  Throughput: ${o.toFixed(2)} tokens/sec`)}async generateSimpleResponse(e,t,r={},o){y.default.info(`[GeminiNewSDKAdapter] Generating simple response for model: ${this.config.modelId}`),(0,c.validateSimpleResponseOptions)(r);try{const o=t.map((e=>(0,g.convertEveMessageToGeminiNewSDK)(e))),n={temperature:r.temperature||0,maxOutputTokens:r.maxTokens||this.modelMetadata.maxOutputTokens||8192,safetySettings:[{category:a.HarmCategory.HARM_CATEGORY_HARASSMENT,threshold:a.HarmBlockThreshold.BLOCK_NONE},{category:a.HarmCategory.HARM_CATEGORY_HATE_SPEECH,threshold:a.HarmBlockThreshold.BLOCK_NONE},{category:a.HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:a.HarmBlockThreshold.BLOCK_NONE},{category:a.HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:a.HarmBlockThreshold.BLOCK_NONE}],systemInstruction:e?{role:"user",parts:[{text:e}]}:void 0},s={model:this.config.modelId,contents:o,config:n},i=await this.client.models.generateContent(s),l=i.candidates?.[0]?.content?.parts?.[0]?.text||"",d=i.usageMetadata,u=d?.cachedContentTokenCount||0;return{content:l,usage:{inputTokens:d?.promptTokenCount||0,outputTokens:d?.candidatesTokenCount||0,cacheReadTokens:u,cacheWriteTokens:0},stopReason:(0,c.mapGenericStopReason)(i.candidates?.[0]?.finishReason),finishReason:i.candidates?.[0]?.finishReason||void 0,providerId:"gemini",modelId:this.config.modelId,metadata:{model:this.config.modelId,promptFeedback:i.promptFeedback,safetyRatings:i.candidates?.[0]?.safetyRatings,usageMetadata:d}}}catch(e){throw y.default.error(`[GeminiNewSDKAdapter] Error in generateSimpleResponse: ${e.message}`),e}}getModelMetadata(){return this.modelMetadata}setModelMetadata(e){this.modelMetadata={...this.modelMetadata,...e,modelId:this.config.modelId,providerId:"gemini"},y.default.debug(`[GeminiNewSDKAdapter] Updated metadata for ${this.config.modelId}: MaxOutputTokens=${this.modelMetadata.maxOutputTokens}, ContextWindow=${this.modelMetadata.contextWindow}`),this.options.enableVerboseLogging&&y.default.debug(`[GeminiNewSDKAdapter] Full new metadata: ${JSON.stringify(this.modelMetadata)}`)}getAdapterType(){return"normalized"}};t.GeminiNewSDKAdapter=v,t.GeminiNewSDKAdapter=v=o([(0,i.Injectable)(),n("design:paramtypes",[Object,Object])],v)},22141:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FileSystemService=void 0;const u=r(3563),p=c(r(79896)),f=c(r(91943)),h=c(r(16928)),m=r(88474),g=d(r(19055)),y=r(37526),v=r(91346),_=r(85266),w=r(16928);let b=n=class{constructor(e,t){this.workspaceService=e,this.ignoreConfigService=t,g.default.info(`[${n.name}] FileSystemService initialized`)}resolvePath(e,t){const r=h.resolve(t,e);if(!r.startsWith(t)){const r=`Path traversal attempt detected: ${e} resolves outside of base directory ${t}`;throw g.default.error(`[${n.name}] ${r}`),new Error(r)}return r}async getWorkspaceFileList(e,t={}){g.default.debug(`[${n.name}] Getting workspace file list for: ${e}`);try{const r=new v.FileScanner(e),o=[_.FileFiltersFactory.defaultRootIgnoreFilter(),this.ignoreConfigService.createGitIgnoreFilter(e),this.ignoreConfigService.createEveIgnoreFilter(e)];!1!==t.applyInclude&&o.push(this.ignoreConfigService.createEveIncludeFilter(e)),t.limit&&o.push(_.FileFiltersFactory.limitFilter({maxItems:t.limit}));const{nodes:n,stats:s,truncated:i}=await r.collect(".",o);return{files:n.map((e=>e.path+(e.isDir?"/":""))),truncated:i,stats:{totalFiles:s.nodesScanned,includedFiles:s.nodesIncluded,estimatedTokens:s.estimatedTokens}}}catch(t){return g.default.error(`[${n.name}] Error getting workspace file list for ${e}: ${t.message}\n${t.stack}`),{files:[],truncated:!1,stats:{totalFiles:0,includedFiles:0,estimatedTokens:0}}}}async listDirectoryTree(e,t=".",r=1,o="standard"){g.default.info(`listing directory tree for: ${t}`);try{const s=new v.FileScanner(e),i=[_.FileFiltersFactory.depthFilter(r),this.ignoreConfigService.createGitIgnoreFilter(e),this.ignoreConfigService.createEveIgnoreFilter(e)];"standard"===o&&i.push(this.ignoreConfigService.createEveIncludeFilter(e)),"show_ignored"===o&&g.default.warn(`[${n.name}] show_ignored mode not fully implemented yet`);const{nodes:a,stats:c,truncated:l}=await s.collect(t,i);return{tree:this.convertToTreeStructure(a),truncated:l,stats:{totalNodes:c.nodesScanned,includedNodes:c.nodesIncluded}}}catch(t){return g.default.error(`[${n.name}] Error getting directory tree for ${e}: ${t.message}\n${t.stack}`),{tree:[],truncated:!1,stats:{totalNodes:0,includedNodes:0}}}}async getWorkspaceFileListForLLM(e,t={}){try{const r=[20,10,5,3,2];let o;o=void 0===t.maxFilesPerDirectory?r:Array.isArray(t.maxFilesPerDirectory)?t.maxFilesPerDirectory:[t.maxFilesPerDirectory];const s=[_.FileFiltersFactory.defaultRootIgnoreFilter(),this.ignoreConfigService.createGitIgnoreFilter(e),this.ignoreConfigService.createEveIgnoreFilter(e),this.ignoreConfigService.createEveIncludeFilter(e)];for(let r=0;r<o.length;r++){const i=o[r],a=new v.FileScanner(e),{nodes:c,truncationMarkers:l,stats:d,truncated:u}=await a.collectForLLM({maxTokens:t.maxTokens||5e4,maxItems:t.maxFiles||1e3,maxBytes:t.maxBytes,maxFilesPerDirectory:i,sortByPath:!0},s);if(!u||r===o.length-1)return{files:c,truncationMarkers:l,stats:{totalFiles:d.nodesScanned,includedFiles:c.length,estimatedTokens:d.estimatedTokens,truncated:u}};g.default.debug(`[${n.name}] File list truncated with maxFilesPerDirectory=${i}, retrying with ${o[r+1]}`)}throw new Error("Unexpected code path in getWorkspaceFileListForLLM")}catch(t){return g.default.error(`[${n.name}] Error getting workspace file list for LLM for ${e}: ${t.message}\n${t.stack}`),{files:[],truncationMarkers:[],stats:{totalFiles:0,includedFiles:0,estimatedTokens:0,truncated:!1}}}}convertToTreeStructure(e){const t=e=>"."===e||""===e?e:e.replace(/\/+$/,""),r=[],o=new Map;let n="";if(e.length){const r=e.map((e=>t(e.path))).sort(((e,t)=>e.length-t.length));n=r[0]}for(const r of e){const e=t(r.path),n=e.split("/").filter(Boolean),s={name:n.length?n[n.length-1]:".",path:e,type:r.isDir?"dir":"file",sizeBytes:r.sizeBytes};r.isDir&&(s.hasChildren=!0,s.children=[]),o.set(e,s)}for(const[e,s]of o){if(e===n&&"."!==n&&""!==n)continue;if("."===e||""===e){r.push(s);continue}const i=e.split("/").filter(Boolean);if(1===i.length)r.push(s);else{const e=t(i.slice(0,-1).join("/")),n=o.get(e);n&&n.children?n.children.push(s):r.push(s)}}const s=(e,t)=>"dir"===e.type&&"dir"!==t.type?-1:"dir"!==e.type&&"dir"===t.type?1:e.name.localeCompare(t.name);let i;if("."===n||""===n)i=r.filter((e=>"."!==e.path&&""!==e.path)).sort(s);else{const e=o.get(n);i=e&&e.children&&e.children.length>0?[...e.children].sort(s):r.filter((e=>"."!==e.path&&""!==e.path&&e.path!==n)).sort(s)}const a=e=>{for(const t of e)t.children&&t.children.length&&(t.children.sort(s),a(t.children))};return a(i),i}async fileExists(e){try{return(await f.stat(e)).isFile()}catch(e){return!1}}async directoryExists(e){try{return(await f.stat(e)).isDirectory()}catch(e){return!1}}async getIgnoredFilesCached(e){g.default.debug(`[${n.name}] Getting ignored files for: ${e}`);try{const t=new v.FileScanner(e),r=[_.FileFiltersFactory.defaultRootIgnoreFilter(),this.ignoreConfigService.createGitIgnoreFilter(e),this.ignoreConfigService.createEveIgnoreFilter(e)],{nodes:o}=await t.collect(".",r),n=new Set;for(const t of o){const r=h.resolve(e,t.path);n.add(r)}return n}catch(t){return g.default.error(`[${n.name}] Error getting ignored files for ${e}: ${t.message}\n${t.stack}`),new Set}}async listSystemDirectoryTree(e,t=0,r={}){const o=1e3;let n=0,s=0,i=!1;const a=Math.max(0,t),c=async(t,l)=>{if(l>a||n>=o)return n>=o&&!i&&(i=!0,g.default.warn(`System directory tree truncated at 1000 nodes for path: ${e}`)),[];let d;try{d=await p.promises.readdir(t,{withFileTypes:!0})}catch(e){return g.default.warn(`Cannot read directory (permissions?): ${t}`,e.code),[]}const u=[];for(const f of d){if(s++,n>=o){i||(i=!0,g.default.warn(`System directory tree truncated during entry processing at 1000 nodes for path: ${e}`));break}if(f.name.startsWith(".")&&t===e)continue;if(r.directoriesOnly&&!f.isDirectory())continue;const d=w.join(t,f.name);try{const e=await p.promises.stat(d),t={name:f.name,path:d,type:f.isDirectory()?"dir":"file",sizeBytes:e.size,hasChildren:f.isDirectory()};if(f.isDirectory()&&l<a)try{await p.promises.access(d,p.constants.R_OK|p.constants.X_OK),t.children=await c(d,l+1)}catch(e){g.default.warn(`Cannot access subdirectory (permissions?): ${d}`,e.code),t.children=[],t.hasChildren=!1}else if(f.isDirectory())try{const e=await p.promises.readdir(d);t.hasChildren=e.length>0}catch(e){t.hasChildren=!1}u.push(t),n++}catch(e){g.default.warn(`Cannot stat (permissions?): ${d}`,e.code)}}return u.sort(((e,t)=>e.type!==t.type?"dir"===e.type?-1:1:e.name.localeCompare(t.name)))};return{tree:await c(e,0),stats:{includedNodes:n,totalNodes:s},truncated:i}}async searchFiles(e,t,r={}){g.default.debug(`[${n.name}] Searching files in: ${e} for query: "${t}"`);try{const o=new v.FileScanner(e),n=r.caseSensitive?t:t.toLowerCase(),s=[_.FileFiltersFactory.defaultRootIgnoreFilter(),this.ignoreConfigService.createGitIgnoreFilter(e),this.ignoreConfigService.createEveIgnoreFilter(e),this.ignoreConfigService.createEveIncludeFilter(e)],{nodes:i}=await o.collect(".",s),a=i.filter((e=>{if(!r.includeDirectories&&e.isDir)return!1;return(r.caseSensitive?e.path:e.path.toLowerCase()).includes(n)}));a.sort(((e,o)=>{const n=r.caseSensitive?h.basename(e.path):h.basename(e.path).toLowerCase(),s=r.caseSensitive?h.basename(o.path):h.basename(o.path).toLowerCase(),i=r.caseSensitive?t:t.toLowerCase();return n===i&&s!==i?-1:s===i&&n!==i?1:n.includes(i)&&!s.includes(i)?-1:s.includes(i)&&!n.includes(i)?1:e.path.localeCompare(o.path)}));const c=r.limit||20;return a.slice(0,c)}catch(r){return g.default.error(`[${n.name}] Error searching files for query "${t}" in ${e}: ${r.message}\n${r.stack}`),[]}}};t.FileSystemService=b,t.FileSystemService=b=n=a([(0,u.Injectable)(),l("design:paramtypes",[m.WorkspaceService,y.IgnoreConfigService])],b)},22300:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GraphAgentCollaborator=void 0;const i=r(3563),a=r(7373),c=r(51e3),l=r(71412),d=r(11544),u=r(91486),p=s(r(19055)),f=r(86254),h=r(59100),m=r(29234),g=r(88474),y=r(76910),v=r(52368),_=r(30538),w=r(93239),b=r(4911);let k=class{constructor(e,t,r,o,n){this.workspaceService=e,this.sessionService=t,this.checkpointerService=r,this.homeService=o,this.summaryCompletion=n,this.chatModelManager=d.ChatModelManager.getInstance()}async processRequest(e,t){p.default.info("Processing request: %s",JSON.stringify(t));const r=this.processRequestStream(e,t);let o=null;for await(const e of r)o=e,p.default.info("Yielded item: %s",JSON.stringify(e));if(!o)throw new Error("No items were yielded from the generator");const n=await this.sessionService.getRequest(o?.requestId);if(!n)throw new Error("Failed to retrieve persisted request");return p.default.info("Returning request: %s",JSON.stringify(n)),n}async*processRequestStream(e,t){const r=(0,h.ulid)();if(!await this.homeService.isAccessOkay()){const e={label:"Error",content:"Access is not valid. Please check your Eve API key and try again."},o=await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:t.sessionId||this.generateSessionId(),label:e.label,content:e.content,createdAt:new Date,requestId:r});return void(yield o)}const o=new Date;t.sessionId||(t.sessionId=this.generateSessionId());const n=await this.chatModelManager.getModel(t.config,e.getModelCategory(),e.isPrivateModelsOnly());let s;t.workspaceName?s=await this.workspaceService.lockByName(t.workspaceName):(s=await this.workspaceService.lockSessionWorkspace(t.sessionId),t.workspaceName=s.name);const i=s.name,a=new m.RequestContext(s,r,t.sessionId);await e.verifyRequest(t,a);let c=!1,d=0,g=0,_=0,w=0,k="";try{const s=l.AgentRequest.getFirstTextContent(t.content),i=await this.sessionService.ensureSession(t.workspaceName,t.sessionId,s,e.getName());await this.sessionService.updateSessionStatus(i.sessionId,"active"),p.default.info("%s received request: %s - %s",e.getName(),r,JSON.stringify(t)),p.default.info("Using model: %s",n.modelDescriptor.getFullName());const h=await e.getTools(a),m=n.baseChatModel.bindTools(h);let b=await e.getSystemPrompt(a);const T=await e.getAgentRules();T&&(b=b+"\n\nAdditional system rules:\n"+T),p.default.info("System prompt length: %s",b.length);const R=v.ConfigService.getNumericProperty(y.ConfigPropNames.AGENT_SYSTEM_PROMPT)||1e5;if(b.length>R)throw p.default.error("System prompt is longer than the maximum allowed length of %s characters - check the system prompt for %s",R,e.getName()),p.default.error("System prompt: %s",b),p.default.error("Consider adding a .eveignore file or updating your .gitignore file to ignore some of the files in the workspace"),new Error(`System prompt is longer than the maximum allowed length of ${R} characters - check logs for more details - you can increase the limit by setting ${y.ConfigPropNames.AGENT_SYSTEM_PROMPT} on the home page`);var S=b;n.options.extraSystemMessageKwargs&&(S=[{type:"text",text:S,...n.options.extraSystemMessageKwargs}],p.default.debug("Using extra system message kwargs",n.options.extraSystemMessageKwargs));const C=this.checkpointerService.getCheckpointer(),P=e.createGraph(m,h,C);await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:t.sessionId,label:"Human",content:s,createdAt:new Date,requestId:r}),await this.sessionService.addRequest({requestId:r,sessionId:t.sessionId,workspaceName:t.workspaceName,requestContent:s,startedAt:o});const E=t.config.recursionLimit||v.ConfigService.getNumericProperty(y.ConfigPropNames.AGENT_RECURSION_LIMIT)||50,I=n.options.extraHeaders?{configurable:{thread_id:t.sessionId},recursionLimit:E,headers:n.options.extraHeaders}:{configurable:{thread_id:t.sessionId},recursionLimit:E};p.default.debug("Call options: %s",JSON.stringify(I));const O=await C.get(I),$=f.MessageUtils.buildHumanMessage(t.content);let M=e.createInitialState();O?M.messages=[$]:n.options.extraSystemMessageKwargs?(p.default.debug("Using extra system message kwargs",n.options.extraSystemMessageKwargs),M.messages=[new u.SystemMessage({content:S,additional_kwargs:n.options.extraSystemMessageKwargs}),$]):n.options.systemPromptSupported?M.messages=[new u.SystemMessage({content:S}),$]:M.messages=[new u.HumanMessage({content:S}),$];const A=await P.stream(M,I);for await(const e of A){p.default.debug("Output Event was: %s",JSON.stringify(e));const o=f.MessageUtils.processOutputEvent(e);p.default.debug("Processed message: %s",o);const s=o.usageMetadata,i=n.calculateCost(s?.inputTokens||0,s?.cacheWriteTokens||0,s?.cacheReadTokens||0,s?.outputTokens||0),a={itemId:this.generateItemId(),sessionId:t.sessionId,label:o.label,content:o.content,createdAt:new Date,inputTokens:o.usageMetadata?.inputTokens,cacheWriteTokens:s?.cacheWriteTokens,cacheReadTokens:s?.cacheReadTokens,outputTokens:s?.outputTokens,totalTokens:s?.totalTokens,cost:i,requestId:r},l=await this.sessionService.addItem(a);d+=s?.inputTokens||0,g+=s?.cacheWriteTokens||0,_+=s?.cacheReadTokens||0,w+=s?.outputTokens||0,k=o.content;const u=await this.sessionService.getSession(t.sessionId);if(c=u&&"aborted"===u.status,c){const e={label:"Error",content:"Session was aborted by the user."},r=await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:t.sessionId,label:e.label,content:e.content,createdAt:new Date});yield r;break}yield l}}catch(e){p.default.error("--------------------------------------------------"),p.default.error("Error processing request in GraphAgentCollaborator:"),p.default.error("Request ID: %s",r),p.default.error("Session ID: %s",t.sessionId),p.default.error("Workspace: %s",t.workspaceName);try{p.default.error("Agent Request Content: %s",JSON.stringify(t.content,null,2))}catch(e){p.default.error("Could not stringify agentRequest.content:",e)}p.default.error("Error Message: %s",e.message),p.default.error("Error Stack:",e.stack||"No stack trace available"),p.default.error("--------------------------------------------------");const o={label:"Error",content:`An error occurred while processing request ${r}: ${e.message}. Please check the server logs for more details.`};if(t.sessionId)try{const e=await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:t.sessionId,label:o.label,content:o.content,createdAt:new Date,requestId:r});yield e}catch(e){p.default.error("Failed to add error item to session %s:",t.sessionId,e)}else p.default.error("Cannot add error item to session because sessionId is missing.")}finally{try{if(!c&&s.isGitRepo){const e=new b.GitCommit(s.repoBaseDir,r,this.sessionService);if(await e.hasUncommittedUpdates()){const t=await e.getUncommittedChanges(),r="Give me a good commit message for the following diff contents - just return the message without quotes",o=await this.summaryCompletion.getSummary(r,t);p.default.info("Detected uncommitted git updates - committing changes with message: "+o),await e._call(o)}}await this.sessionService.updateSessionStatus(t.sessionId,"inactive");const e=n.calculateCost(d,g,_,w),i=new Date,a=i.getTime()-o.getTime(),l=d+g+_+w,u=await this.sessionService.updateRequest(r,{responseContent:k,endedAt:i,tookMillis:a,inputTokens:d,cacheWriteTokens:g,cacheReadTokens:_,outputTokens:w,totalTokens:l,cost:e});await this.homeService.logRequest(u),p.default.info("Agent processing completed in %s seconds - Input tokens: %s, Cache Write tokens: %s, Cache Read tokens: %s, Output tokens: %s, Total tokens: %s, Total cost: £%s",a/1e3,d,g,_,w,l,e.toFixed(6))}finally{i&&await this.workspaceService.unlockByName(i)}}}generateSessionId(){return(0,h.ulid)()}generateItemId(){return(0,h.ulid)()}};t.GraphAgentCollaborator=k,t.GraphAgentCollaborator=k=o([(0,i.Injectable)(),n("design:paramtypes",[g.WorkspaceService,a.SessionService,c.CheckpointerService,_.HomeService,w.SummaryCompletion])],k)},22397:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceController=void 0;const i=r(3563),a=r(88474);let c=class{constructor(e){this.workspaceService=e}async unlock(e){return this.workspaceService.unlockByName(e)}async findAll(e){const t="true"===e;return this.workspaceService.findAll(t)}async findOne(e){return this.workspaceService.findOne(e)}async create(e){return this.workspaceService.createWorkspace(e)}async update(e,t){return this.workspaceService.updateWorkspace(e,t)}async remove(e){return this.workspaceService.removeWorkspace(e)}};t.WorkspaceController=c,o([(0,i.Post)(":name/unlock"),s(0,(0,i.Param)("name")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"unlock",null),o([(0,i.Get)(),s(0,(0,i.Query)("isTemp")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"findAll",null),o([(0,i.Get)(":name"),s(0,(0,i.Param)("name")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"findOne",null),o([(0,i.Post)(),s(0,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],c.prototype,"create",null),o([(0,i.Patch)(":name"),s(0,(0,i.Param)("name")),s(1,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],c.prototype,"update",null),o([(0,i.Delete)(":name"),s(0,(0,i.Param)("name")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"remove",null),t.WorkspaceController=c=o([(0,i.Controller)("workspace"),n("design:paramtypes",[a.WorkspaceService])],c)},22811:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FileSystemController=void 0;const u=r(3563),p=a(r(79896)),f=d(r(19055)),h=r(16928),m=r(22141),g=r(88474),y=r(19668),v=r(16724);let _=class{constructor(e,t,r,o){this.fileSystemService=e,this.workspaceService=t,this.userService=r,this.mentionsService=o}async getSystemTree(e,t=1){try{await this.userService.getCurrentUser();const r=e||this.getHomeDirectory();this.validateSystemPath(r);const o=await this.fileSystemService.listSystemDirectoryTree(r,t,{directoriesOnly:!0});return{tree:o.tree,currentPath:r,hasMore:o.truncated}}catch(e){throw f.default.error(`[FileSystemController] Error in getSystemTree: ${e.message}`,e.stack),e}}getHomeDirectory(){return process.env.HOME||process.env.USERPROFILE||"/"}validateSystemPath(e){const t=this.getHomeDirectory(),r=h.resolve(e),o=[t,"/"];if("win32"===process.platform){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ";for(const t of e)p.existsSync(`${t}:\\`)&&o.push(`${t}:\\`)}else o.push("/home","/Users","/opt","/var","/srv","/mnt");if(!o.some((e=>r.startsWith(h.resolve(e)))))if("win32"===process.platform&&/^[A-Z]:\\$/.test(h.dirname(r)));else if(!o.includes(r))throw new Error(`Access to path ${e} is not allowed`)}async getStats(e,t=!0){try{await this.userService.getCurrentUser();const r=await this.workspaceService.findOne(e);if(!r)throw new Error(`Workspace ${e} not found`);const o=await this.fileSystemService.getWorkspaceFileList(r.repoBaseDir,{applyInclude:t}),n=await this.fileSystemService.getWorkspaceFileListForLLM(r.repoBaseDir,{maxTokens:1e5});return{totalFiles:o.stats.totalFiles,includedFiles:o.stats.includedFiles,estimatedTokens:o.stats.estimatedTokens,wouldBeTruncated:n.stats.truncated,estimatedFilesAfterTruncation:n.stats.includedFiles}}catch(e){if(e instanceof y.AuthenticationError)throw f.default.error(`[FileSystemController] Authentication error in getStats: ${e.message}`),new u.UnauthorizedException(`Authentication failed: ${e.message}`);throw f.default.error(`[FileSystemController] Error in getStats: ${e.message}`,e.stack),e}}async listForLLM(e,t){try{await this.userService.getCurrentUser();const r=await this.workspaceService.findOne(e.workspaceName);if(!r)throw new Error(`Workspace ${e.workspaceName} not found`);t.setHeader("Content-Type","application/x-ndjson");const o=await this.fileSystemService.getWorkspaceFileListForLLM(r.repoBaseDir,{maxTokens:e.maxTokens,maxFiles:e.maxFiles,maxBytes:e.maxBytes});for(const e of o.files)t.write(JSON.stringify(e)+"\n");for(const e of o.truncationMarkers)t.write(JSON.stringify(e)+"\n");t.write(JSON.stringify({stats:{totalFiles:o.stats.totalFiles,includedFiles:o.stats.includedFiles,truncated:o.stats.truncated,sentTokens:o.stats.estimatedTokens,truncatedDirectories:o.truncationMarkers.length}})+"\n"),t.end()}catch(e){if(e instanceof y.AuthenticationError)throw f.default.error(`[FileSystemController] Authentication error in listForLLM: ${e.message}`),new u.UnauthorizedException(`Authentication failed: ${e.message}`);throw f.default.error(`[FileSystemController] Error in listForLLM: ${e.message}`,e.stack),e}}async getTree(e,t=".",r=0,o="standard",n){try{await this.userService.getCurrentUser();const s=await this.workspaceService.findOne(e);if(!s)throw new Error(`Workspace ${e} not found`);const i=this.fileSystemService.resolvePath(t,s.repoBaseDir);let a;try{a=await p.promises.stat(i)}catch(e){if("ENOENT"===e.code){if(".eveinclude"===t)return f.default.debug("[FileSystemController] .eveinclude file not found - this is normal as it's optional"),{item:null,message:".eveinclude file not found (optional)"};throw new Error(`Path not found: ${t}`)}throw e}const c=t.split("/").pop()||t;if(!a.isFile()){let e=0;if(n){const r=this.parseCursor(n);t=r.path,e=r.offset}const i=await this.fileSystemService.listDirectoryTree(s.repoBaseDir,t,r,o);return{item:{name:c,path:t,type:"dir",sizeBytes:a.size,modified:a.mtime,children:i.tree},hasMore:i.truncated,nextCursor:i.truncated?this.generateCursor(t,i.stats.includedNodes):null}}{const e={name:c,path:t,type:"file",sizeBytes:a.size,modified:a.mtime};if(!await this.isTextFile(i))return{item:{...e,isText:!1}};try{const t=await p.promises.readFile(i,"utf8");return{item:{...e,isText:!0,content:t}}}catch(t){return f.default.warn(`Failed to read file as text: ${i}`,t),{item:{...e,isText:!1}}}}}catch(e){if(e instanceof y.AuthenticationError)throw f.default.error(`[FileSystemController] Authentication error in getTree: ${e.message}`),new u.UnauthorizedException(`Authentication failed: ${e.message}`);throw f.default.error(`[FileSystemController] Error in getTree: ${e.message}`,e.stack),e}}generateCursor(e,t){return Buffer.from(`${e}:${t}`).toString("base64")}parseCursor(e){const t=Buffer.from(e,"base64").toString(),[r,o]=t.split(":");return{path:r,offset:parseInt(o,10)}}async isTextFile(e){try{const t=await p.promises.open(e,"r"),r=Buffer.alloc(4096),{bytesRead:o}=await t.read(r,0,4096,0);if(await t.close(),0===o)return!0;const n=r.slice(0,o);if(n.includes(0))return!1;let s=0;for(let e=0;e<o;e++){const t=n[e];t<32&&9!==t&&10!==t&&13!==t&&s++}if(s/o>.05)return!1;try{return n.toString("utf8"),!0}catch(e){return!1}}catch(t){return f.default.error(`Error checking if file is text: ${t.message}`),this.isTextFileByExtension(e)}}isTextFileByExtension(e){const t=h.extname(e).toLowerCase();return[".txt",".md",".js",".ts",".html",".css",".json",".xml",".yml",".yaml",".sh",".bash",".py",".java",".c",".cpp",".h",".cs",".go",".rb",".php",".vue",".jsx",".tsx"].includes(t)}async updateFileContent(e){try{await this.userService.getCurrentUser();const t=await this.workspaceService.findOne(e.workspaceName);if(!t)throw new Error(`Workspace ${e.workspaceName} not found`);const r=this.fileSystemService.resolvePath(e.path,t.repoBaseDir);return await p.promises.writeFile(r,e.content,"utf8"),{success:!0}}catch(e){if(e instanceof y.AuthenticationError)throw f.default.error(`[FileSystemController] Authentication error in updateFileContent: ${e.message}`),new u.UnauthorizedException(`Authentication failed: ${e.message}`);throw f.default.error(`[FileSystemController] Error in updateFileContent: ${e.message}`,e.stack),e}}async getContent(e,t=".",r=1,o){try{await this.userService.getCurrentUser();const n=await this.workspaceService.findOne(e);if(!n)throw new Error(`Workspace ${e} not found`);const s=await this.mentionsService.getContentAsText(n.repoBaseDir,t,r);o.setHeader("Content-Type","text/plain"),o.send(s)}catch(e){if(e instanceof y.AuthenticationError)throw f.default.error(`[FileSystemController] Authentication error in getContent: ${e.message}`),new u.UnauthorizedException(`Authentication failed: ${e.message}`);throw f.default.error(`[FileSystemController] Error in getContent: ${e.message}`,e.stack),e}}async searchInDirectory(e,t,r){try{await this.userService.getCurrentUser();if(!await this.workspaceService.findOne(e))throw new Error(`Workspace ${e} not found`);return f.default.info(`[FileSystemController] Search request: workspace=${e}, path=${t}, query=${r}`),{results:[]}}catch(e){if(e instanceof y.AuthenticationError)throw f.default.error(`[FileSystemController] Authentication error in searchInDirectory: ${e.message}`),new u.UnauthorizedException(`Authentication failed: ${e.message}`);throw f.default.error(`[FileSystemController] Error in searchInDirectory: ${e.message}`,e.stack),e}}};t.FileSystemController=_,i([(0,u.Get)("system-tree"),l(0,(0,u.Query)("path")),l(1,(0,u.Query)("depth")),c("design:type",Function),c("design:paramtypes",[String,Number]),c("design:returntype",Promise)],_.prototype,"getSystemTree",null),i([(0,u.Get)("stats"),l(0,(0,u.Query)("workspaceName")),l(1,(0,u.Query)("applyInclude")),c("design:type",Function),c("design:paramtypes",[String,Boolean]),c("design:returntype",Promise)],_.prototype,"getStats",null),i([(0,u.Post)("list-for-llm"),l(0,(0,u.Body)()),l(1,(0,u.Res)()),c("design:type",Function),c("design:paramtypes",[Object,Object]),c("design:returntype",Promise)],_.prototype,"listForLLM",null),i([(0,u.Get)("tree"),l(0,(0,u.Query)("workspaceName")),l(1,(0,u.Query)("path")),l(2,(0,u.Query)("depth")),l(3,(0,u.Query)("filterMode")),l(4,(0,u.Query)("cursor")),c("design:type",Function),c("design:paramtypes",[String,String,Number,String,String]),c("design:returntype",Promise)],_.prototype,"getTree",null),i([(0,u.Put)("content"),l(0,(0,u.Body)()),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],_.prototype,"updateFileContent",null),i([(0,u.Get)("content"),l(0,(0,u.Query)("workspaceName")),l(1,(0,u.Query)("path")),l(2,(0,u.Query)("depth")),l(3,(0,u.Res)()),c("design:type",Function),c("design:paramtypes",[String,String,Number,Object]),c("design:returntype",Promise)],_.prototype,"getContent",null),i([(0,u.Get)("search"),l(0,(0,u.Query)("workspaceName")),l(1,(0,u.Query)("path")),l(2,(0,u.Query)("query")),c("design:type",Function),c("design:paramtypes",[String,String,String]),c("design:returntype",Promise)],_.prototype,"searchInDirectory",null),t.FileSystemController=_=i([(0,u.Controller)("eve/fs"),c("design:paramtypes",[m.FileSystemService,g.WorkspaceService,y.UserService,v.MentionsService])],_)},23738:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChunkBuffer=void 0;const i=r(3563),a=r(18448),c=r(19612),l=s(r(19055));let d=class{constructor(e,t){this.unifiedTagDetector=e,this.buffer=[],this.sequenceCounter=0,this.lastFlushTime=0,this.currentBufferSize=0,this.config={maxBufferSize:1024,smallChunkThreshold:10,maxBufferTime:100,enablePartialTagDetection:!0,...t},this.lastFlushTime=Date.now()}addToBuffer(e,t,r=a.NormalizedChunkType.TEXT,o){const n={content:e,originalContent:o||e,metadata:{...t},timestamp:Date.now(),chunkType:r,sequenceId:this.sequenceCounter++};this.buffer.push(n),this.currentBufferSize+=e.length}shouldBufferIncomingChunk(e,t){return t!==a.NormalizedChunkType.USAGE&&t!==a.NormalizedChunkType.STOP&&(e.length<this.config.smallChunkThreshold||!(!this.config.enablePartialTagDetection||!this.hasPartialXmlTag(e)))}hasPartialXmlTag(e){return/<[a-zA-Z_][a-zA-Z0-9_]*?$/.test(e)||/^<\/[a-zA-Z_][a-zA-Z0-9_]*?>?/.test(e)||/<[^>]*$/.test(e)}shouldFlush(){if(0===this.buffer.length)return null;if(this.currentBufferSize>=this.config.maxBufferSize)return{type:"size",reason:`Buffer size exceeded: ${this.currentBufferSize}/${this.config.maxBufferSize}`,metadata:{bufferSize:this.currentBufferSize}};if(this.config.maxBufferTime>0){const e=Date.now()-this.lastFlushTime;if(e>=this.config.maxBufferTime&&this.buffer.length>0)return{type:"time",reason:`Buffer time exceeded: ${e}ms`,metadata:{timeElapsed:e}}}const e=this.getCombinedContent(),t=this.unifiedTagDetector.findOpeningTag(e);if(t&&"tool_call"===t.tagType)return{type:"toolCall",reason:`Tool call opening tag detected: ${t.tagName}`,metadata:{toolName:t.tagName,isOpeningTag:!0}};const r=this.analyzeBufferForToolCalls();if(r.hasCompleteToolCall)return{type:"toolCall",reason:`Complete tool call detected: ${r.toolCallInfo?.name}`,metadata:{toolName:r.toolCallInfo?.name,isComplete:!0}};const o=Math.max(50,3*this.config.smallChunkThreshold);if(this.buffer.length>0&&this.currentBufferSize>o)return{type:"content",reason:"Aggressive flush for incremental updates",metadata:{bufferSize:this.currentBufferSize,threshold:o}};if(this.hasChunkTypeChange()){const e=this.getBufferChunkTypes();return{type:"typeChange",reason:`Chunk type change detected. Types in buffer: ${e.join(", ")}`,metadata:{types:e}}}return null}flushBuffer(e){if(0===this.buffer.length)return[];let t;return t=e?this.processBufferedChunksWithSplit(e):this.processBufferedChunks(),this.buffer=[],this.currentBufferSize=0,this.lastFlushTime=Date.now(),t}processBufferedChunksWithSplit(e){if(0===this.buffer.length)return[];const t=this.getCombinedContent(),r=this.getCombinedOriginalContent(),o=t.substring(0,e.startIndex),n=t.substring(e.startIndex),s=r.substring(0,e.startIndex),i=r.substring(e.startIndex),c=[];return o.trim().length>0&&c.push({type:a.NormalizedChunkType.TEXT,content:o,originalContent:s,metadata:this.mergeMetadataArray(this.buffer.map((e=>e.metadata||{})))}),n.trim().length>0&&c.push({type:a.NormalizedChunkType.TEXT,content:n,originalContent:i,metadata:this.mergeMetadataArray(this.buffer.map((e=>e.metadata||{})))}),c}processBufferedChunks(){if(0===this.buffer.length)return[];const e=[];let t=[];for(const r of this.buffer)0===t.length||t[0].chunkType===r.chunkType?t.push(r):(e.push(this.mergeEntries(t,t[0].chunkType)),t=[r]);return t.length>0&&e.push(this.mergeEntries(t,t[0].chunkType)),e}mergeEntries(e,t){const r=e.map((e=>e.content)).join(""),o=e.map((e=>e.originalContent||e.content)).join(""),n=this.mergeMetadataArray(e.map((e=>e.metadata||{})));let s,i,c,l;return t===a.NormalizedChunkType.USAGE&&(s=e.reduce(((e,t)=>e+(t.metadata?.inputTokens||0)),0),i=e.reduce(((e,t)=>e+(t.metadata?.outputTokens||0)),0),c=e.reduce(((e,t)=>e+(t.metadata?.cacheReadTokens||0)),0),l=e.reduce(((e,t)=>e+(t.metadata?.cacheWriteTokens||0)),0)),{type:t,content:t===a.NormalizedChunkType.TEXT||t===a.NormalizedChunkType.THINKING?r:void 0,originalContent:t===a.NormalizedChunkType.TEXT||t===a.NormalizedChunkType.THINKING?o:void 0,metadata:{...n,bufferInfo:{originalChunkCount:e.length,mergedAt:Date.now(),sequenceIds:e.map((e=>e.sequenceId))}},inputTokens:s,outputTokens:i,cacheReadTokens:c,cacheWriteTokens:l,stopReason:e.length>0?e[0].metadata?.stopReason:void 0}}mergeMetadataArray(e){const t={};for(const r of e)for(const[e,o]of Object.entries(r))void 0===t[e]?t[e]=o:Array.isArray(t[e])?t[e].includes(o)||t[e].push(o):t[e]!==o&&(t[e]=[t[e],o]);return t}analyzeBufferForToolCalls(){const e=this.getCombinedContent(),t=this.unifiedTagDetector.findCompleteTag(e),r=t&&"tool_call"===t.type;return{hasCompleteToolCall:r,hasPartialToolCall:this.config.enablePartialTagDetection&&this.hasPartialXmlTag(e)&&!r,toolCallInfo:r?t:void 0}}getCombinedContent(){return this.buffer.slice().sort(((e,t)=>e.sequenceId-t.sequenceId)).map((e=>e.content)).join("")}getCombinedOriginalContent(){return this.buffer.slice().sort(((e,t)=>e.sequenceId-t.sequenceId)).map((e=>e.originalContent||e.content)).join("")}hasChunkTypeChange(){if(this.buffer.length<2)return!1;const e=this.buffer[0].chunkType;for(let t=1;t<this.buffer.length;t++)if(this.buffer[t].chunkType!==e&&!(e===a.NormalizedChunkType.THINKING&&this.buffer[t].chunkType===a.NormalizedChunkType.TEXT||e===a.NormalizedChunkType.TEXT&&this.buffer[t].chunkType===a.NormalizedChunkType.THINKING))return!0;return!1}getBufferChunkTypes(){return[...new Set(this.buffer.map((e=>e.chunkType)))]}setMaxBufferSize(e){this.config.maxBufferSize=Math.max(1,e),l.default.info(`[ChunkBuffer] Max buffer size set to: ${this.config.maxBufferSize}`)}setSmallChunkThreshold(e){this.config.smallChunkThreshold=Math.max(1,e),l.default.info(`[ChunkBuffer] Small chunk threshold set to: ${this.config.smallChunkThreshold}`)}setMaxBufferTime(e){this.config.maxBufferTime=Math.max(0,e),l.default.info(`[ChunkBuffer] Max buffer time set to: ${this.config.maxBufferTime}ms`)}enablePartialTagDetection(e){this.config.enablePartialTagDetection=e,l.default.info(`[ChunkBuffer] Partial tag detection set to: ${this.config.enablePartialTagDetection}`)}updateConfig(e){this.config={...this.config,...e},l.default.info(`[ChunkBuffer] Configuration updated: ${JSON.stringify(this.config)}`)}getBufferStats(){const e=Date.now(),t=this.buffer.length>0?this.buffer[0]:null;return{currentSize:this.currentBufferSize,chunkCount:this.buffer.length,oldestChunkAgeMs:t?e-t.timestamp:0,bufferUtilizationPercent:this.config.maxBufferSize>0?this.currentBufferSize/this.config.maxBufferSize*100:0}}handleBufferOverflow(){l.default.warn(`[ChunkBuffer] Buffer overflow detected. Current size: ${this.currentBufferSize}. Max size: ${this.config.maxBufferSize}. Forcing flush.`);return this.flushBuffer().map((e=>({...e,metadata:{...e.metadata,bufferWarning:"Emergency flush due to buffer overflow or excessive size"}})))}reset(){this.buffer=[],this.currentBufferSize=0,this.sequenceCounter=0,this.lastFlushTime=Date.now()}};t.ChunkBuffer=d,t.ChunkBuffer=d=o([(0,i.Injectable)(),n("design:paramtypes",[c.UnifiedTagDetector,Object])],d)},23880:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionModule=void 0;const n=r(3563),s=r(376),i=r(25480),a=r(94143),c=r(7373),l=r(83936),d=r(99095),u=r(30811),p=r(3177);let f=class{};t.SessionModule=f,t.SessionModule=f=o([(0,n.Module)({imports:[s.DataSourceModule,p.MutationsModule],controllers:[i.SessionController,a.RequestController],providers:[c.SessionService,l.SessionRepository,d.ItemRepository,u.RequestRepository],exports:[c.SessionService]})],f)},24160:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LMStudioAdapter=void 0;const i=r(3563),a=r(82010),c=r(42808),l=s(r(19055));let d=class{constructor(e){this.provider=e,this.id="lmstudio",this.name="LM Studio",this.messageTransformer=new c.OpenAIMessageTransformer,l.default.info("[LMStudioAdapter] Initialized")}getProvider(){return this.provider}getModelClient(e){return this.provider.getModelClient(e)}toProviderFormat(e){return this.messageTransformer.toProviderFormat(e)}fromProviderFormat(e){return this.messageTransformer.fromProviderFormat(e,"")}extractMetadata(e){return{format:"openai-api"}}supportsThinking(){return!1}supportsFormatConversion(e){return!0}};t.LMStudioAdapter=d,t.LMStudioAdapter=d=o([(0,i.Injectable)(),n("design:paramtypes",[a.LMStudioProvider])],d)},24434:e=>{"use strict";e.exports=require("events")},24912:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MavenSourceArtefactScheme=void 0;const l=r(3563),d=r(38547),u=c(r(58938)),p=a(r(91943)),f=a(r(16928)),h=a(r(70857)),m=c(r(74650)),g=c(r(19055));let y=class{getName(){return"maven"}async downloadAndStoreSources(e,t,r){if(g.default.info(`Downloading and storing sources for Maven artifact: ${e}`),!this.isValidGAV(e))throw g.default.warn(`Invalid Maven GAV coordinates: ${e}`),new l.BadRequestException("Invalid Maven GAV coordinates");const o=this.getRepoUrls(r);g.default.info(`Using repository URLs: ${o.join(", ")}`);const n=await this.findSourcesJarUrl(o,e);if(!n)throw g.default.warn(`Sources jar not found for ${e} in any of the provided repositories`),new l.BadRequestException("Sources jar not found in any of the provided repositories");g.default.info(`Found sources jar at: ${n}`);const s=await p.mkdtemp(f.join(h.tmpdir(),"maven-sources-")),i=f.join(s,"sources.jar");try{await this.downloadFile(n,i),g.default.info(`Downloaded sources jar to: ${i}`);const r=e.replace(/:/g,"/"),o=f.join(t,"maven",r);await p.mkdir(o,{recursive:!0}),g.default.info(`Created cache directory: ${o}`),await this.unzipJar(i,o),g.default.info(`Unzipped sources jar to: ${o}`);const s=new d.SourceArtefact({scheme:this.getName(),locator:e,valid:!0,error:null,repo:new URL(n).origin,cacheSrcBaseDir:o});return g.default.info(`Successfully created SourceArtefact for ${e}`),s}finally{await p.rm(s,{recursive:!0,force:!0}),g.default.info(`Cleaned up temporary directory: ${s}`)}}async needsImport(e){if(!e.cacheSrcBaseDir)return!0;try{return 0===(await p.readdir(e.cacheSrcBaseDir)).length}catch(e){return!0}}async readArtefactSourceTree(e){if(!e.cacheSrcBaseDir)throw new Error("Invalid source artefact: missing cache directory");const{generateTree:t}=await Promise.resolve().then((()=>a(r(6426))));return t(e.cacheSrcBaseDir)}async readArtefactSourceFile(e,t){if(!e.cacheSrcBaseDir)throw new Error("Invalid source artefact: missing cache directory");const r=f.join(e.cacheSrcBaseDir,t);try{return await p.readFile(r,"utf-8")}catch(e){throw new Error(`Failed to read file: ${t}`)}}isValidGAV(e){return/^[^:]+:[^:]+:[^:]+$/.test(e)}getRepoUrls(e){if(e&&e.length>0)return e;const t=process.env.MAVEN_REPO_URLS;return t?t.split(",").map((e=>e.trim())):["https://repo.maven.apache.org/maven2"]}async findSourcesJarUrl(e,t){const[r,o,n]=t.split(":"),s=`${r.replace(/\./g,"/")}/${o}/${n}/${o}-${n}-sources.jar`;for(var i of e){i.endsWith("/")||(i+="/");const e=new URL(s,i).toString();g.default.info(`Checking URL: ${e}`);try{return await u.default.head(e),e}catch(t){g.default.info(`Error checking maven url ${e}: ${t}`)}}return null}async downloadFile(e,t){const r=await u.default.get(e,{responseType:"arraybuffer"});await p.writeFile(t,r.data)}async unzipJar(e,t){new m.default(e).extractAllTo(t,!0)}};t.MavenSourceArtefactScheme=y,t.MavenSourceArtefactScheme=y=i([(0,l.Injectable)()],y)},24939:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AutocompleteController=void 0;const c=r(3563),l=r(17260),d=r(39578),u=r(19668),p=a(r(19055));let f=o=class{constructor(e,t,r){this.autocompleteRegistry=e,this.autocompleteRequestManager=t,this.userService=r}async search(e,t,r,n,s){if(p.default.info(`[${o.name}] *** AUTOCOMPLETE REQUEST RECEIVED *** trigger="${e}", query="${t}", workspaceName="${r}", taskId="${n}", mode="${s}"`),!e)return p.default.warn(`[${o.name}] Search request missing trigger character.`),{trigger:"",query:t,results:[],error:"Trigger character is required."};if("@"===e&&(!t||t.trim().length<1))return p.default.debug(`[${o.name}] Query too short for @ search: "${t}"`),{trigger:e,query:t,results:[],message:"Please enter at least 1 character after @ to search files."};try{let i="anonymous";try{i=(await this.userService.getCurrentUser()).userId}catch(e){p.default.warn(`[${o.name}] Failed to get current user, using anonymous: ${e.message}`)}const a={workspaceName:r,userId:i,taskId:n,mode:s};p.default.debug(`[${o.name}] Received search request: trigger="${e}", query="${t}", context=${JSON.stringify(a)}`);const c=await this.autocompleteRequestManager.search(e,t,a,(()=>this.autocompleteRegistry.search(e,t,a)));return{trigger:e,query:t,results:c}}catch(r){return p.default.error(`[${o.name}] Error in search for trigger "${e}", query "${t}": ${r.message}`,r.stack),{trigger:e,query:t,results:[],error:`An error occurred while searching: ${r.message}`}}}async getTriggers(){try{const e=this.autocompleteRegistry.getAllTriggerChars();return p.default.debug(`[${o.name}] Returning available triggers: ${e.join(", ")}`),{triggers:e}}catch(e){return p.default.error(`[${o.name}] Error in getTriggers: ${e.message}`,e.stack),{triggers:[],error:`An error occurred while fetching triggers: ${e.message}`}}}};t.AutocompleteController=f,n([(0,c.Get)("search"),i(0,(0,c.Query)("trigger")),i(1,(0,c.Query)("query")),i(2,(0,c.Query)("workspaceName")),i(3,(0,c.Query)("taskId")),i(4,(0,c.Query)("mode")),s("design:type",Function),s("design:paramtypes",[String,String,String,String,String]),s("design:returntype",Promise)],f.prototype,"search",null),n([(0,c.Get)("triggers"),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],f.prototype,"getTriggers",null),t.AutocompleteController=f=o=n([(0,c.Controller)("eve/autocomplete"),s("design:paramtypes",[l.AutocompleteRegistryService,d.AutocompleteRequestManagerService,u.UserService])],f)},25480:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionController=void 0;const i=r(3563),a=r(7373),c=r(10573);let l=class{constructor(e){this.sessionService=e}async createSession(e,t,r="",o="se-agent"){return this.sessionService.ensureSession(e,t,r,o)}async getSessions(e=1,t=10,r="createdAt",o="DESC"){return this.sessionService.getSessions(e,t,r,o)}async getSession(e){return this.sessionService.getSession(e)}async deleteSession(e){return this.sessionService.deleteSession(e)}async getItemsForSession(e,t=1,r=100,o="ASC"){const[n,s]=await this.sessionService.getItemsForSession(e,t,r,o);return{items:n,total:s}}streamSessionItems(e){return this.sessionService.streamSessionItems(e)}async abortSession(e){return this.sessionService.abortSession(e)}};t.SessionController=l,o([(0,i.Post)(),s(0,(0,i.Body)("workspaceName")),s(1,(0,i.Body)("sessionId")),s(2,(0,i.Body)("requestContent")),s(3,(0,i.Body)("agent")),n("design:type",Function),n("design:paramtypes",[String,String,String,String]),n("design:returntype",Promise)],l.prototype,"createSession",null),o([(0,i.Get)(),s(0,(0,i.Query)("page")),s(1,(0,i.Query)("limit")),s(2,(0,i.Query)("sortBy")),s(3,(0,i.Query)("sortOrder")),n("design:type",Function),n("design:paramtypes",[Number,Number,String,String]),n("design:returntype",Promise)],l.prototype,"getSessions",null),o([(0,i.Get)(":sessionId"),s(0,(0,i.Param)("sessionId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],l.prototype,"getSession",null),o([(0,i.Delete)(":sessionId"),s(0,(0,i.Param)("sessionId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],l.prototype,"deleteSession",null),o([(0,i.Get)(":sessionId/items"),s(0,(0,i.Param)("sessionId")),s(1,(0,i.Query)("page")),s(2,(0,i.Query)("limit")),s(3,(0,i.Query)("sortOrder")),n("design:type",Function),n("design:paramtypes",[String,Number,Number,String]),n("design:returntype",Promise)],l.prototype,"getItemsForSession",null),o([(0,i.Sse)(":sessionId/stream"),s(0,(0,i.Param)("sessionId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",c.Observable)],l.prototype,"streamSessionItems",null),o([(0,i.Post)(":sessionId/abort"),s(0,(0,i.Param)("sessionId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],l.prototype,"abortSession",null),t.SessionController=l=o([(0,i.Controller)("sessions"),n("design:paramtypes",[a.SessionService])],l)},25814:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ExecuteCommandToolFactory=void 0;const s=r(3563),i=r(93131);let a=class{constructor(){}getToolName(){return"execute_command"}create(e){return new i.ExecuteCommandTool(e.workingDir,{planModeRestrictions:["Read-only operations only (ls, cat, grep, etc.)","No package installations or system modifications","No file system changes or service management","Focus on exploration and analysis"]})}};t.ExecuteCommandToolFactory=a,t.ExecuteCommandToolFactory=a=o([(0,s.Injectable)(),n("design:paramtypes",[])],a)},25996:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AddWorkspace=void 0;const c=r(83153),l=r(11569),d=i(r(79896)),u=i(r(16928)),p=r(35317),f=r(39023),h=a(r(19055)),m=r(91943),g=a(r(83807)),y=(0,f.promisify)(p.exec);class v extends c.Tool{constructor(e,t){super(),this.name="AddWorkspace",this.description="Add a new workspace to the system",this.schema=l.z.object({baseDir:l.z.string().describe("The absolute path to the directory of the workspace (can be a git repo or not)"),name:l.z.string().optional().describe("Optional name of the workspace (no spaces)"),gitRepoUrl:l.z.string().optional().describe("Optional git repository URL to clone into the workspace")}),this.workspaceService=e,this.baseDir=t}async cloneAndCleanGitRepo(e,t){try{h.default.info(`Cloning repository from ${t} to ${e}`),await y(`git clone ${t} ${e} --quiet`),h.default.debug("Repository cloned successfully");const r=u.join(e,".git");d.existsSync(r)&&(h.default.debug(`Removing existing .git directory at ${r}`),await(0,m.rm)(r,{recursive:!0,force:!0}),h.default.debug(".git directory removed successfully")),h.default.info("Initializing new git repository");const o=(0,g.default)(e);await o.init(),h.default.debug("Git repository initialized"),await o.add("."),h.default.debug("Added all files to git"),await o.commit(`initial commit after copying from ${t}`),h.default.info("Created initial commit in new repository")}catch(e){throw h.default.error(`Failed to clone repository: ${e.message}`,e),new Error(`Failed to clone repository: ${e.message}`)}}async _call({baseDir:e,name:t,gitRepoUrl:r}){try{if(h.default.info(`Adding workspace with baseDir: ${e}, name: ${t||"not provided"}, gitRepoUrl: ${r||"not provided"}`),!u.isAbsolute(e))throw h.default.warn(`Base directory is not absolute: ${e}`),new Error(`Base directory must be an absolute path: ${e}`);const o=e;if(h.default.debug(`Full path resolved to: ${o}`),r){h.default.info(`Git repository URL provided, preparing to clone from: ${r}`);const e=u.dirname(o);if(h.default.debug(`Checking parent directory: ${e}`),!d.existsSync(e))throw h.default.error(`Parent directory does not exist: ${e}`),new Error(`Parent directory does not exist: ${e}`);h.default.debug("Parent directory exists, proceeding with clone"),await this.cloneAndCleanGitRepo(o,r)}else{if(h.default.info("No git repository URL provided, checking if directory exists"),!d.existsSync(o))throw h.default.error(`Base directory does not exist: ${o}`),new Error(`Base directory does not exist: ${o}`);h.default.debug("Directory exists, proceeding with workspace creation")}const n=t||u.basename(o);h.default.info(`Creating workspace in database with name: ${n}`),await this.workspaceService.createWorkspace({name:n,repoBaseDir:o,ensureGitRepo:!0}),h.default.debug("Workspace created in database successfully");const s=`Workspace '${n}' added successfully at ${o}${r?" (cloned from git)":""}`;return h.default.info(s),s}catch(e){return h.default.error(`Error adding workspace: ${e.message}`,e),`Error adding workspace: ${e.message}`}}}t.AddWorkspace=v},26282:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ESLintValidator=void 0;const i=r(3563),a=r(72609),c=s(r(19055));let l=class extends a.BaseCommandLineValidator{constructor(){super({name:"ESLint",command:"npx eslint --format json {filePath}",fileExtensions:["js","jsx","ts","tsx"],issuePattern:/"line":(?<line>\d+),"column":(?<column>\d+),"severity":(?<severityNum>\d+),"message":"(?<message>[^"]+)"/g,priority:20})}hasValidationErrors(e,t,r){return 0!==r||this.config.issuePattern.test(e)||this.config.issuePattern.test(t)}formatValidationReport(e,t){try{if(e&&e.trim().startsWith("[")&&e.trim().endsWith("]")){const t=JSON.parse(e);return this.formatESLintResults(t)}}catch(e){c.default.warn(`[${this.constructor.name}] Error parsing ESLint JSON output: ${e.message}`)}return e||t}formatESLintResults(e){if(!e||0===e.length)return"No ESLint issues found.";let t="";for(const r of e)if(r.messages&&r.messages.length>0){t+=`File: ${r.filePath}\n`;for(const e of r.messages){const r=2===e.severity?"error":"warning";t+=`  ${e.line}:${e.column} ${r} ${e.message} (${e.ruleId})\n`}t+="\n"}return t||"No ESLint issues found."}};t.ESLintValidator=l,t.ESLintValidator=l=o([(0,i.Injectable)(),n("design:paramtypes",[])],l)},26573:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getQwenModels=function(){return[{modelId:"qwen3-0.6b",family:"qwen",series:"qwen3",variant:"0.6b",displayName:"Qwen3 0.6B",aliases:["qwen/qwen3-0.6b","qwen3-0.6b-instruct","qwen/qwen3-0.6b-instruct","accounts/fireworks/models/qwen3-0.6b-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:.6,contextWindow:32768,maxOutputTokens:32768,isMoE:!1},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2025-04-29",version:"3.0",announcementUrl:"https://qwenlm.github.io/blog/qwen3/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen3-0.6B",githubUrl:"https://github.com/QwenLM/Qwen3",docsUrl:"https://qwenlm.github.io/",trainingTokens:18e12,dataCutoff:"2024-09"}},{modelId:"qwen3-1.7b",family:"qwen",series:"qwen3",variant:"1.7b",displayName:"Qwen3 1.7B",aliases:["qwen/qwen3-1.7b","qwen3-1.7b-instruct","qwen/qwen3-1.7b-instruct","accounts/fireworks/models/qwen3-1.7b-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:1.7,contextWindow:32768,maxOutputTokens:8192,isMoE:!1},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2025-04-29",version:"3.0",announcementUrl:"https://qwenlm.github.io/blog/qwen3/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen3-1.7B",githubUrl:"https://github.com/QwenLM/Qwen3",docsUrl:"https://qwenlm.github.io/",trainingTokens:18e12,dataCutoff:"2024-09"}},{modelId:"qwen3-8b",family:"qwen",series:"qwen3",variant:"8b",displayName:"Qwen3 8B",aliases:["qwen/qwen3-8b","qwen3-8b-instruct","qwen/qwen3-8b-instruct","accounts/fireworks/models/qwen3-8b-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:8,contextWindow:32768,maxOutputTokens:8192,isMoE:!1},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2025-04-29",version:"3.0",announcementUrl:"https://qwenlm.github.io/blog/qwen3/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen3-8B",githubUrl:"https://github.com/QwenLM/Qwen3",docsUrl:"https://qwenlm.github.io/",trainingTokens:18e12,dataCutoff:"2024-09"}},{modelId:"qwen2.5-0.5b",family:"qwen",series:"qwen2.5",variant:"0.5b",displayName:"Qwen2.5 0.5B",aliases:["qwen/qwen2.5-0.5b","qwen2.5-0.5b-instruct","qwen/qwen2.5-0.5b-instruct","accounts/fireworks/models/qwen2.5-0.5b-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:.5,contextWindow:131072,maxOutputTokens:8192,isMoE:!1},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2024-09-19",version:"2.5",announcementUrl:"https://qwenlm.github.io/blog/qwen2.5-llm/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen2.5-0.5B",githubUrl:"https://github.com/QwenLM/Qwen",docsUrl:"https://qwenlm.github.io/",trainingTokens:18e12,dataCutoff:"2024-06"}},{modelId:"qwen2.5-7b",family:"qwen",series:"qwen2.5",variant:"7b",displayName:"Qwen2.5 7B",aliases:["qwen/qwen2.5-7b","qwen2.5-7b-instruct","qwen/qwen2.5-7b-instruct","accounts/fireworks/models/qwen2.5-7b-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:7,contextWindow:131072,maxOutputTokens:8192,isMoE:!1},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2024-09-19",version:"2.5",announcementUrl:"https://qwenlm.github.io/blog/qwen2.5-llm/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen2.5-7B",githubUrl:"https://github.com/QwenLM/Qwen",docsUrl:"https://qwenlm.github.io/"}},{modelId:"qwen2.5-14b",family:"qwen",series:"qwen2.5",variant:"14b",displayName:"Qwen2.5 14B",aliases:["qwen/qwen2.5-14b","qwen2.5-14b-instruct","qwen/qwen2.5-14b-instruct","accounts/fireworks/models/qwen2.5-14b-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:14,contextWindow:131072,maxOutputTokens:8192,isMoE:!1},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2024-09-19",version:"2.5",announcementUrl:"https://qwenlm.github.io/blog/qwen2.5-llm/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen2.5-14B",githubUrl:"https://github.com/QwenLM/Qwen",docsUrl:"https://qwenlm.github.io/"}},{modelId:"qwen2.5-32b",family:"qwen",series:"qwen2.5",variant:"32b",displayName:"Qwen2.5 32B",aliases:["qwen/qwen2.5-32b","qwen2.5-32b-instruct","qwen/qwen2.5-32b-instruct","accounts/fireworks/models/qwen2.5-32b-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:32,contextWindow:131072,maxOutputTokens:8192,isMoE:!1},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2024-09-19",version:"2.5",announcementUrl:"https://qwenlm.github.io/blog/qwen2.5-llm/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen2.5-32B",githubUrl:"https://github.com/QwenLM/Qwen",docsUrl:"https://qwenlm.github.io/"}},{modelId:"qwen2.5-72b",family:"qwen",series:"qwen2.5",variant:"72b",displayName:"Qwen2.5 72B",aliases:["qwen/qwen2.5-72b","qwen2.5-72b-instruct","qwen/qwen2.5-72b-instruct","accounts/fireworks/models/qwen2.5-72b-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:72,contextWindow:131072,maxOutputTokens:8192,isMoE:!1},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2024-09-19",version:"2.5",announcementUrl:"https://qwenlm.github.io/blog/qwen2.5-llm/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen2.5-72B",githubUrl:"https://github.com/QwenLM/Qwen",docsUrl:"https://qwenlm.github.io/"}},{modelId:"qwen3-32b",family:"qwen",series:"qwen3",variant:"32b",displayName:"Qwen3 32B",aliases:["qwen/qwen3-32b","qwen3-32b-instruct","qwen/qwen3-32b-instruct","accounts/fireworks/models/qwen3-32b-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:32,contextWindow:32768,maxOutputTokens:32768,isMoE:!1},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2025-04-29",version:"3.0",announcementUrl:"https://qwenlm.github.io/blog/qwen3/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen3-32B",githubUrl:"https://github.com/QwenLM/Qwen3",docsUrl:"https://qwenlm.github.io/",trainingTokens:18e12,dataCutoff:"2024-09"}},{modelId:"qwen2.5-7b-instruct-1m",family:"qwen",series:"qwen2.5-1m",variant:"7b",displayName:"Qwen2.5 7B Instruct 1M",aliases:["qwen/qwen2.5-7b-instruct-1m","accounts/fireworks/models/qwen2.5-7b-instruct-1m"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:7,contextWindow:1048576,maxOutputTokens:32768,isMoE:!1},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2024-12-19",version:"2.5-1m",announcementUrl:"https://qwenlm.github.io/blog/qwen2.5-1m/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen2.5-7B-Instruct-1M",githubUrl:"https://github.com/QwenLM/Qwen",docsUrl:"https://qwenlm.github.io/"}},{modelId:"qwen2.5-14b-instruct-1m",family:"qwen",series:"qwen2.5-1m",variant:"14b",displayName:"Qwen2.5 14B Instruct 1M",aliases:["qwen/qwen2.5-14b-instruct-1m","accounts/fireworks/models/qwen2.5-14b-instruct-1m"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:14,contextWindow:1048576,maxOutputTokens:32768,isMoE:!1},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2024-12-19",version:"2.5-1m",announcementUrl:"https://qwenlm.github.io/blog/qwen2.5-1m/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen2.5-14B-Instruct-1M",githubUrl:"https://github.com/QwenLM/Qwen",docsUrl:"https://qwenlm.github.io/"}},{modelId:"qwen2.5-coder-3b",family:"qwen",series:"qwen2.5-coder",variant:"3b",displayName:"Qwen2.5-Coder 3B",aliases:["qwen/qwen2.5-coder-3b","qwen2.5-coder-3b-instruct","qwen/qwen2.5-coder-3b-instruct","accounts/fireworks/models/qwen2.5-coder-3b-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!0,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:3,contextWindow:131072,maxOutputTokens:8192,isMoE:!1,programmingLanguagesCount:338},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2024-11-12",version:"2.5-coder",announcementUrl:"https://qwenlm.github.io/blog/qwen2.5-coder-family/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen2.5-Coder-3B",githubUrl:"https://github.com/QwenLM/Qwen2.5-Coder",docsUrl:"https://qwenlm.github.io/"}},{modelId:"qwen2.5-coder-14b",family:"qwen",series:"qwen2.5-coder",variant:"14b",displayName:"Qwen2.5-Coder 14B",aliases:["qwen/qwen2.5-coder-14b","qwen2.5-coder-14b-instruct","qwen/qwen2.5-coder-14b-instruct","accounts/fireworks/models/qwen2.5-coder-14b-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!0,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:14,contextWindow:131072,maxOutputTokens:8192,isMoE:!1,programmingLanguagesCount:338},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2024-11-12",version:"2.5-coder",announcementUrl:"https://qwenlm.github.io/blog/qwen2.5-coder-family/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen2.5-Coder-14B",githubUrl:"https://github.com/QwenLM/Qwen2.5-Coder",docsUrl:"https://qwenlm.github.io/"}},{modelId:"qwen2.5-coder-32b",family:"qwen",series:"qwen2.5-coder",variant:"32b",displayName:"Qwen2.5-Coder 32B",aliases:["qwen/qwen2.5-coder-32b","qwen2.5-coder-32b-instruct","qwen/qwen2.5-coder-32b-instruct","accounts/fireworks/models/qwen2.5-coder-32b-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!0,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:32,contextWindow:131072,maxOutputTokens:8192,isMoE:!1,programmingLanguagesCount:338},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2024-11-12",version:"2.5-coder",announcementUrl:"https://qwenlm.github.io/blog/qwen2.5-coder-family/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen2.5-Coder-32B",githubUrl:"https://github.com/QwenLM/Qwen2.5-Coder",docsUrl:"https://qwenlm.github.io/"}},{modelId:"qwen2.5-vl-3b",family:"qwen",series:"qwen2.5-vl",variant:"3b",displayName:"Qwen2.5-VL 3B",aliases:["qwen/qwen2.5-vl-3b","qwen2.5-vl-3b-instruct","qwen/qwen2.5-vl-3b-instruct","accounts/fireworks/models/qwen2.5-vl-3b-instruct"],capabilities:{supportsVision:!0,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!1},specifications:{totalParameters:3,contextWindow:32768,maxOutputTokens:8192,isMoE:!1},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2024-11-21",version:"2.5-vl",announcementUrl:"https://qwenlm.github.io/blog/qwen2.5-vl/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen2.5-VL-3B",githubUrl:"https://github.com/QwenLM/Qwen2.5-VL",docsUrl:"https://qwenlm.github.io/"}},{modelId:"qwen2.5-vl-7b",family:"qwen",series:"qwen2.5-vl",variant:"7b",displayName:"Qwen2.5-VL 7B",aliases:["qwen/qwen2.5-vl-7b","qwen2.5-vl-7b-instruct","qwen/qwen2.5-vl-7b-instruct","accounts/fireworks/models/qwen2.5-vl-7b-instruct"],capabilities:{supportsVision:!0,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!1},specifications:{totalParameters:7,contextWindow:32768,maxOutputTokens:8192,isMoE:!1},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2024-11-21",version:"2.5-vl",announcementUrl:"https://qwenlm.github.io/blog/qwen2.5-vl/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen2.5-VL-7B",githubUrl:"https://github.com/QwenLM/Qwen2.5-VL",docsUrl:"https://qwenlm.github.io/"}},{modelId:"qwen2.5-vl-72b",family:"qwen",series:"qwen2.5-vl",variant:"72b",displayName:"Qwen2.5-VL 72B",aliases:["qwen/qwen2.5-vl-72b","qwen2.5-vl-72b-instruct","qwen/qwen2.5-vl-72b-instruct","accounts/fireworks/models/qwen2.5-vl-72b-instruct"],capabilities:{supportsVision:!0,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!1},specifications:{totalParameters:72,contextWindow:32768,maxOutputTokens:8192,isMoE:!1},ownership:{organization:"Alibaba Cloud",license:"Apache-2.0",allowsCommercialUse:!0},release:{releaseDate:"2024-11-21",version:"2.5-vl",announcementUrl:"https://qwenlm.github.io/blog/qwen2.5-vl/"},metadata:{huggingFaceUrl:"https://huggingface.co/Qwen/Qwen2.5-VL-72B",githubUrl:"https://github.com/QwenLM/Qwen2.5-VL",docsUrl:"https://qwenlm.github.io/"}}]}},26696:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetRetrievalService=void 0;const a=r(3563),c=r(52368),l=i(r(19055)),d=r(8077),u=r(7310),p=r(15796);let f=o=class{constructor(e,t){this.configService=e,this.datasetService=t,this.embeddingsModel=process.env.EMBEDDINGS_MODEL||"Xenova/all-mpnet-base-v2",this.chromaUrl=process.env.CHROMA_URL||"http://localhost:8000"}async searchDataset(e,t,r=20,n=void 0){try{l.default.info(`[${o.name}] Searching dataset ${e} for: ${t}`),l.default.info(`[${o.name}] Initializing embeddings model: ${this.embeddingsModel}`);const s=new u.HuggingFaceTransformersEmbeddings({modelName:this.embeddingsModel}),i=new p.Chroma(s,{collectionName:e,url:this.chromaUrl});if(!n){const n=await i.similaritySearch(t,r);return l.default.info(`[${o.name}] Found ${n.length} matches in dataset ${e}`),n}const a=await this.datasetService.getAllDatasets().then((t=>t.find((t=>t.name===e))));if(!a)throw new Error(`Dataset ${e} not found`);const c=await this.datasetService.getDocuments(a.id),d=c.map((e=>(l.default.info(`[${o.name}] Searching for ${t} in document ${e.id}`),i.similaritySearch(t,n,{original_document_id:{$eq:e.id}})))),f=(await Promise.all(d)).flat();l.default.info(`[${o.name}] Found ${f.length} matches in dataset ${e} - before deduplication`),l.default.debug(`[${o.name}] Combined results: ${JSON.stringify(f)}`);const h=f.filter(((e,t,r)=>r.findIndex((t=>t.metadata.id===e.metadata.id))===t));return l.default.info(`[${o.name}] Found ${h.length} total matches across ${c.length} documents in dataset ${e}`),f}catch(t){throw l.default.error(`[${o.name}] Failed to search dataset ${e}`),l.default.error(`[${o.name}] Error details: ${t.message}`),t.stack&&l.default.error(`[${o.name}] Stack trace: ${t.stack}`),t}}};t.DatasetRetrievalService=f,t.DatasetRetrievalService=f=o=n([(0,a.Injectable)(),s("design:paramtypes",[c.ConfigService,d.DatasetService])],f)},26897:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LlmStreamProcessorBlock=void 0;const c=r(3563),l=r(50461),d=r(31623),u=a(r(19055)),p=r(96297),f=r(56550),h=r(67485),m=r(55324),g=r(56349),y=r(9102),v=r(20150),_=r(91280);let w=o=class{constructor(e,t,r,o,n,s,i){this.taskService=e,this.eventEmitter=t,this.agentStateManager=r,this.blockService=o,this.conversationHistoryService=n,this.configService=s,this.costCalculationService=i}async processStream(e,t,r,n){p.debugLogger.log(`Starting to process LLM stream for task ${t} with block-based communication`);let s,i,a,c=null,l=null;const d=this.agentStateManager.getAbortSignal(t);if(d?.aborted)return u.default.info(`[${o.name}] Task ${t} already aborted before stream processing`),c=new Error("Task aborted before stream processing"),{streamError:c,providerId:s,messageInterchange:a};try{u.default.info(`[${o.name}] Starting to process LLM stream for task ${t}`);const n=await this.taskService.getTask(t);s=n.providerId;const f=await this.configService.assembleFinalConfiguration(n.userId,n.mode||"act");i=f.modelInfo,u.default.info(`[${o.name}] Provider for task ${t}: ${s}, Model: ${i?.modelId}, Draft Model: ${f.draftModelId||"N/A"}`);let h=0,m=!1;try{for await(const n of e){if(this.agentStateManager.isTaskAborting(t)||d?.aborted){if(u.default.info(`[${o.name}] Task ${t} is being aborted, stopping stream processing at chunk ${h}`),l)try{const e=await this.blockService.getBlock(l);e&&"generating"===e.status&&(await this.blockService.updateBlock(l,{status:"error",errorText:"Generation cancelled by user"}),u.default.info(`[${o.name}] Updated block ${l} to error due to cancellation`))}catch(e){u.default.error(`[${o.name}] Error updating current block ${l} during cancellation: ${e.message}`)}try{const e=await this.blockService.getLastBlockForTask(t);e&&"request"===e.blockType&&(await this.blockService.updateBlock(e.blockId,{status:"error",errorText:"Task cancelled by user"}),u.default.info(`[${o.name}] Updated request block ${e.blockId} status to error due to task cancellation`))}catch(e){u.default.error(`[${o.name}] Error updating request block for cancelled task ${t}: ${e.message}\n${e.stack}`)}break}if(!m)try{const e=await this.blockService.getLastBlockForTask(t);e&&"request"===e.blockType&&(await this.blockService.updateBlock(e.blockId,{status:"finished"}),u.default.info(`[${o.name}] Updated request block ${e.blockId} status to finished`)),m=!0}catch(e){u.default.error(`[${o.name}] Error updating request block: ${e.message}`),m=!0}h++,p.debugLogger.dumpObject(`Processing chunk ${h} for task ${t}`,n);try{if("block"===n.type)await this.handleBlockChunk(n,t,r),l=n.block.blockId;else if("blockUpdate"===n.type){const e=n;if(!e.blockId)throw u.default.error(`[${o.name}] Received blockUpdate without blockId for task ${t}`),new Error(`Received blockUpdate without blockId for task ${t}`);const s=e.blockId;await this.handleBlockUpdateChunk(e,s,t,r)}else if("usage"===n.type)await this.handleUsageChunk(n,t,i);else if("messageInterchange"===n.type){const e=n;u.default.info(`[${o.name}] Received messageInterchange chunk for task ${t}`),a=e.messageInterchange,a.taskId=t}}catch(e){u.default.error(`[${o.name}] Error processing stream chunk for task ${t}: ${e.message}\n${e.stack}`)}}if(l)try{const e=await this.blockService.getBlock(l);e&&"finished"!==e.status&&(await this.blockService.updateBlock(l,{status:"finished"}),u.default.info(`[${o.name}] Finalized block ${l} for task ${t}`))}catch(e){u.default.warn(`[${o.name}] Could not finalize block ${l} for task ${t}: ${e.message}`)}}catch(e){c=e,u.default.error(`[${o.name}] LLM stream processing error for task ${t}: ${e.message}\n${e.stack}`),this.eventEmitter.emit(_.InternalEvents.TOOL_ERROR,{taskId:t,clientId:r,error:e.message,type:"api_error",context:{stack:e.stack}})}}catch(e){c=e,u.default.error(`[${o.name}] Outer error in processStream for task ${t}: ${e.message}\n${e.stack}`)}return{streamError:c,providerId:s,messageInterchange:a}}async handleBlockChunk(e,t,r){if(u.default.debug(`[${o.name}] Creating new block for task ${t}`),!e.block.blockId){const e=`Received block without blockId for task ${t}`;throw u.default.error(`[${o.name}] ${e}`),new Error(e)}const n=await this.blockService.createBlock({blockId:e.block.blockId,taskId:t,role:"assistant",blockType:e.block.blockType,tagName:e.block.tagName,status:e.block.status,content:e.block.content||""});return u.default.debug(`[${o.name}] Created block ${n.blockId} for task ${t}`),n}async handleBlockUpdateChunk(e,t,r,n){if(!e.blockId){const e=`Received blockUpdate without blockId for task ${r}`;throw u.default.error(`[${o.name}] ${e}`),new Error(e)}if(e.blockId!==t){const n=`BlockUpdate blockId (${e.blockId}) does not match expected blockId (${t}) for task ${r}`;throw u.default.error(`[${o.name}] ${n}`),new Error(n)}e.appendContent&&await this.blockService.appendToBlockContent(t,e.appendContent);const s={};e.newStatus&&(s.status=e.newStatus),e.newBlockType&&(s.blockType=e.newBlockType),e.newTagName&&(s.tagName=e.newTagName),e.output&&(s.output=e.output),e.errorText&&(s.errorText=e.errorText),Object.keys(s).length>0&&(await this.blockService.updateBlock(t,s),"finished"===e.newStatus&&"tool_call"===e.newBlockType&&e.newTagName&&d.RESPONSE_ONLY_TOOLS.includes(e.newTagName)&&(await this.blockService.updateBlock(t,{status:"completed"}),u.default.info(`[${o.name}] Auto-completed response-only tool ${e.newTagName} for block ${t}`)))}async handleUsageChunk(e,t,r){u.default.info(`[${o.name}] Tracking usage for task ${t}: ${e.inputTokens} input tokens, ${e.outputTokens} output tokens`);const n=this.costCalculationService.calculateUsageCost(e,r);u.default.info(`[${o.name}] Calculated cost for usage chunk: ${n}`),await this.blockService.trackUsage({taskId:t,inputTokens:e.inputTokens,outputTokens:e.outputTokens,cacheWriteTokens:e.cacheWriteTokens,cacheReadTokens:e.cacheReadTokens,totalCost:n})}};t.LlmStreamProcessorBlock=w,t.LlmStreamProcessorBlock=w=o=n([(0,c.Injectable)(),i(0,(0,c.Inject)((0,c.forwardRef)((()=>f.TaskService)))),s("design:paramtypes",[f.TaskService,l.EventEmitter2,h.AgentStateManager,m.BlockService,g.ConversationHistoryService,y.EveConfigService,v.CostCalculationService])],w)},26932:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetDocumentRepository=void 0;const i=r(3563);r(31832);let a=class{constructor(e){this.knex=e}async findAll(e){return this.knex("datasetDocuments").where("datasetId",e).select("*")}async findById(e){return this.knex("datasetDocuments").where("id",e).first()}async create(e){await this.knex("datasetDocuments").insert(e)}async update(e,t){const r={...t,updatedAt:new Date};await this.knex("datasetDocuments").where("id",e).update(r)}async delete(e){await this.knex("datasetDocuments").where("id",e).delete()}async updateStatus(e,t){await this.knex("datasetDocuments").where("id",e).update({status:t,updatedAt:new Date})}};t.DatasetDocumentRepository=a,t.DatasetDocumentRepository=a=o([(0,i.Injectable)(),s(0,(0,i.Inject)("KNEX")),n("design:paramtypes",[Function])],a)},27400:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OllamaMessageTransformer=void 0;const n=o(r(19055));t.OllamaMessageTransformer=class{transformMessages(e){const t=[];for(const r of e)try{const e=this.transformSingleMessage(r);e&&(Array.isArray(e)?t.push(...e):t.push(e))}catch(e){n.default.warn(`[OllamaMessageTransformer] Failed to transform message: ${e.message}`)}return t}transformSingleMessage(e){switch(e.role){case"user":return this.transformUserMessage(e);case"assistant":return this.transformAssistantMessage(e);default:return n.default.warn(`[OllamaMessageTransformer] Unknown message role: ${e.role}`),null}}transformUserMessage(e){const t=[],r=this.extractContentFromSegments(e.segments),o=this.extractImagesFromSegments(e.segments);if(r.trim().length>0||o.length>0){const e={role:"user",content:r||"Image message"};o.length>0&&(e.images=o),t.push(e)}return t.length>0?t:[{role:"user",content:""}]}transformAssistantMessage(e){return{role:"assistant",content:this.extractContentFromSegments(e.segments)}}extractContentFromSegments(e){return e.filter((e=>"text"===e.type||"thinking"===e.type||"tool_code"===e.type||"tool_result"===e.type)).map((e=>e.content)).filter((e=>e.trim().length>0)).join("\n\n")}extractImagesFromSegments(e){const t=[];for(const r of e)if("image"===r.type&&r.metadata?.url)if(r.metadata.url.startsWith("data:image/")){const e=r.metadata.url.match(/data:image\/[^;]+;base64,(.+)/);e&&t.push(e[1])}else n.default.warn(`[OllamaMessageTransformer] Image URLs not directly supported, skipping: ${r.metadata.url}`);return t}}},27497:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SSEClientTransport=t.SseError=void 0;const o=r(49819),n=r(10815),s=r(73024);class i extends Error{constructor(e,t,r){super(`SSE error: ${t}`),this.code=e,this.event=r}}t.SseError=i;t.SSEClientTransport=class{constructor(e,t){this._url=e,this._eventSourceInit=null==t?void 0:t.eventSourceInit,this._requestInit=null==t?void 0:t.requestInit,this._authProvider=null==t?void 0:t.authProvider}async _authThenStart(){var e;if(!this._authProvider)throw new s.UnauthorizedError("No auth provider");let t;try{t=await(0,s.auth)(this._authProvider,{serverUrl:this._url})}catch(t){throw null===(e=this.onerror)||void 0===e||e.call(this,t),t}if("AUTHORIZED"!==t)throw new s.UnauthorizedError;return await this._startOrAuth()}async _commonHeaders(){const e={};if(this._authProvider){const t=await this._authProvider.tokens();t&&(e.Authorization=`Bearer ${t.access_token}`)}return e}_startOrAuth(){return new Promise(((e,t)=>{var r;this._eventSource=new o.EventSource(this._url.href,null!==(r=this._eventSourceInit)&&void 0!==r?r:{fetch:(e,t)=>this._commonHeaders().then((r=>fetch(e,{...t,headers:{...r,Accept:"text/event-stream"}})))}),this._abortController=new AbortController,this._eventSource.onerror=r=>{var o;if(401===r.code&&this._authProvider)return void this._authThenStart().then(e,t);const n=new i(r.code,r.message,r);t(n),null===(o=this.onerror)||void 0===o||o.call(this,n)},this._eventSource.onopen=()=>{},this._eventSource.addEventListener("endpoint",(r=>{var o;const n=r;try{if(this._endpoint=new URL(n.data,this._url),this._endpoint.origin!==this._url.origin)throw new Error(`Endpoint origin does not match connection origin: ${this._endpoint.origin}`)}catch(e){return t(e),null===(o=this.onerror)||void 0===o||o.call(this,e),void this.close()}e()})),this._eventSource.onmessage=e=>{var t,r;const o=e;let s;try{s=n.JSONRPCMessageSchema.parse(JSON.parse(o.data))}catch(e){return void(null===(t=this.onerror)||void 0===t||t.call(this,e))}null===(r=this.onmessage)||void 0===r||r.call(this,s)}}))}async start(){if(this._eventSource)throw new Error("SSEClientTransport already started! If using Client class, note that connect() calls start() automatically.");return await this._startOrAuth()}async finishAuth(e){if(!this._authProvider)throw new s.UnauthorizedError("No auth provider");if("AUTHORIZED"!==await(0,s.auth)(this._authProvider,{serverUrl:this._url,authorizationCode:e}))throw new s.UnauthorizedError("Failed to authorize")}async close(){var e,t,r;null===(e=this._abortController)||void 0===e||e.abort(),null===(t=this._eventSource)||void 0===t||t.close(),null===(r=this.onclose)||void 0===r||r.call(this)}async send(e){var t,r,o;if(!this._endpoint)throw new Error("Not connected");try{const o=await this._commonHeaders(),n=new Headers({...o,...null===(t=this._requestInit)||void 0===t?void 0:t.headers});n.set("content-type","application/json");const i={...this._requestInit,method:"POST",headers:n,body:JSON.stringify(e),signal:null===(r=this._abortController)||void 0===r?void 0:r.signal},a=await fetch(this._endpoint,i);if(!a.ok){if(401===a.status&&this._authProvider){if("AUTHORIZED"!==await(0,s.auth)(this._authProvider,{serverUrl:this._url}))throw new s.UnauthorizedError;return this.send(e)}const t=await a.text().catch((()=>null));throw new Error(`Error POSTing to endpoint (HTTP ${a.status}): ${t}`)}}catch(e){throw null===(o=this.onerror)||void 0===o||o.call(this,e),e}}}},27781:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.EpicsController=void 0;const i=r(3563),a=r(38610);let c=class{constructor(e){this.epicsService=e}async getRequirements(e,t){return{content:await this.epicsService.getRequirements(e,t)}}async updateRequirements(e,t,r){return{content:await this.epicsService.updateRequirements(e,t,r.content)}}async findAll(e){return this.epicsService.findAllEpics(e)}async findOne(e,t){return this.epicsService.findEpicById(e,t)}async create(e,t){return this.epicsService.createEpic(e,t.title,t.description)}async update(e,t,r){return this.epicsService.updateEpic(e,t,r.title,r.description)}async remove(e,t){return this.epicsService.deleteEpic(e,t)}async addStory(e,t,r){return this.epicsService.addStory(e,t,r.title,r.description,r.acceptanceCriteria)}async updateStory(e,t,r,o){return this.epicsService.updateStory(e,t,r,o.title,o.description,o.acceptanceCriteria)}async getStory(e,t,r){return this.epicsService.getStory(e,t,r)}async removeStory(e,t,r){return this.epicsService.deleteStory(e,t,r)}async addTask(e,t,r,o){return this.epicsService.addTask(e,t,r,o.title,o.description)}async updateTask(e,t,r,o,n){return this.epicsService.updateTask(e,t,r,o,n.title,n.description,n.status)}async removeTask(e,t,r,o){return this.epicsService.deleteTask(e,t,r,o)}async getTasks(e,t,r){return this.epicsService.getTasks(e,t,r)}async getTask(e,t,r,o){return this.epicsService.getTask(e,t,r,o)}};t.EpicsController=c,o([(0,i.Get)(":epicId/requirements"),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Param)("epicId")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],c.prototype,"getRequirements",null),o([(0,i.Put)(":epicId/requirements"),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Param)("epicId")),s(2,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[String,String,Object]),n("design:returntype",Promise)],c.prototype,"updateRequirements",null),o([(0,i.Get)(),s(0,(0,i.Param)("workspaceName")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"findAll",null),o([(0,i.Get)(":epicId"),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Param)("epicId")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],c.prototype,"findOne",null),o([(0,i.Post)(),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],c.prototype,"create",null),o([(0,i.Put)(":epicId"),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Param)("epicId")),s(2,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[String,String,Object]),n("design:returntype",Promise)],c.prototype,"update",null),o([(0,i.Delete)(":epicId"),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Param)("epicId")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],c.prototype,"remove",null),o([(0,i.Post)(":epicId/stories"),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Param)("epicId")),s(2,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[String,String,Object]),n("design:returntype",Promise)],c.prototype,"addStory",null),o([(0,i.Put)(":epicId/stories/:storyId"),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Param)("epicId")),s(2,(0,i.Param)("storyId")),s(3,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[String,String,String,Object]),n("design:returntype",Promise)],c.prototype,"updateStory",null),o([(0,i.Get)(":epicId/stories/:storyId"),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Param)("epicId")),s(2,(0,i.Param)("storyId")),n("design:type",Function),n("design:paramtypes",[String,String,String]),n("design:returntype",Promise)],c.prototype,"getStory",null),o([(0,i.Delete)(":epicId/stories/:storyId"),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Param)("epicId")),s(2,(0,i.Param)("storyId")),n("design:type",Function),n("design:paramtypes",[String,String,String]),n("design:returntype",Promise)],c.prototype,"removeStory",null),o([(0,i.Post)(":epicId/stories/:storyId/tasks"),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Param)("epicId")),s(2,(0,i.Param)("storyId")),s(3,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[String,String,String,Object]),n("design:returntype",Promise)],c.prototype,"addTask",null),o([(0,i.Put)(":epicId/stories/:storyId/tasks/:taskId"),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Param)("epicId")),s(2,(0,i.Param)("storyId")),s(3,(0,i.Param)("taskId")),s(4,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[String,String,String,String,Object]),n("design:returntype",Promise)],c.prototype,"updateTask",null),o([(0,i.Delete)(":epicId/stories/:storyId/tasks/:taskId"),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Param)("epicId")),s(2,(0,i.Param)("storyId")),s(3,(0,i.Param)("taskId")),n("design:type",Function),n("design:paramtypes",[String,String,String,String]),n("design:returntype",Promise)],c.prototype,"removeTask",null),o([(0,i.Get)(":epicId/stories/:storyId/tasks"),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Param)("epicId")),s(2,(0,i.Param)("storyId")),n("design:type",Function),n("design:paramtypes",[String,String,String]),n("design:returntype",Promise)],c.prototype,"getTasks",null),o([(0,i.Get)(":epicId/stories/:storyId/tasks/:taskId"),s(0,(0,i.Param)("workspaceName")),s(1,(0,i.Param)("epicId")),s(2,(0,i.Param)("storyId")),s(3,(0,i.Param)("taskId")),n("design:type",Function),n("design:paramtypes",[String,String,String,String]),n("design:returntype",Promise)],c.prototype,"getTask",null),t.EpicsController=c=o([(0,i.Controller)("workspaces/:workspaceName/epics"),n("design:paramtypes",[a.EpicsService])],c)},27823:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoredDocDTO=void 0;class r{constructor(e,t,r,o,n){this.id=e,this.mimeType=t,this.createdAt=r,this.sessionId=o,this.workspaceName=n}static fromStoredDoc(e){return new r(e.id,e.mimeType,e.createdAt,e.sessionId,e.workspaceName)}}t.StoredDocDTO=r},28294:e=>{"use strict";e.exports=require("fzf")},28716:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateNewTaskToolFactory=void 0;const s=r(3563),i=r(47081);let a=class{constructor(){}getToolName(){return"create_new_task"}create(e){return new i.CreateNewTaskTool({availableInPlan:!0,availableInAct:!0})}};t.CreateNewTaskToolFactory=a,t.CreateNewTaskToolFactory=a=o([(0,s.Injectable)(),n("design:paramtypes",[])],a)},28781:e=>{"use strict";e.exports=require("@nestjs/core")},28787:e=>{"use strict";e.exports=require("he")},28804:e=>{"use strict";e.exports=require("@langchain/langgraph/prebuilt")},29076:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FeedbackEventHandler=void 0;const a=r(3563),c=i(r(19055)),l=r(50461),d=r(56550),u=r(56349),p=r(59100),f=r(91280),h=r(35444);let m=o=class{constructor(e,t,r){this.taskService=e,this.conversationHistoryService=t,this.eventEmitter=r}async handleFollowupResponse(e,t){c.default.info(`[${o.name}] Processing followupResponse message from client: ${t.id}`);try{await this.taskService.updateTaskStep({taskId:e.taskId,stepNumber:e.stepNumber,toolOutput:JSON.stringify({response:e.response}),status:"completed"}),this.eventEmitter.emit(f.InternalEvents.TASK_UPDATED,{clientId:t.id,taskId:e.taskId,status:h.TaskStatus.IN_PROGRESS,data:{action:"followup_response_received",details:"Processing followup response..."}})}catch(r){c.default.error(`[${o.name}] Error handling followup response: ${r.message}\n${r.stack}`),this.eventEmitter.emit(f.InternalEvents.TOOL_ERROR,{clientId:t.id,taskId:e.taskId,error:r.message,type:"task_error",context:{source:"followupResponse",stepNumber:e.stepNumber}})}}async handleCompletionFeedback(e,t,r){c.default.info(`[${o.name}] Processing completionFeedback message from client: ${t.id}`);try{const n={id:(0,p.ulid)(),taskId:e.taskId,role:"user",segments:[{type:"text",content:e.feedback}],providerId:"system",createdAt:new Date};if(await this.conversationHistoryService.addMessage(e.taskId,n),e.continueTask){c.default.info(`[${o.name}] Continuing task ${e.taskId} with feedback`),await this.taskService.updateTask({taskId:e.taskId,status:h.TaskStatus.IN_PROGRESS}),this.eventEmitter.emit(f.InternalEvents.TASK_UPDATED,{clientId:t.id,taskId:e.taskId,status:h.TaskStatus.IN_PROGRESS,data:{details:"Processing feedback..."}});const n=(await this.taskService.getTask(e.taskId)).mode||"act";await r(e.taskId,t.id,n)}else this.eventEmitter.emit(f.InternalEvents.TASK_UPDATED,{clientId:t.id,taskId:e.taskId,status:h.TaskStatus.WAITING_FOR_INPUT,data:{action:"feedback_received",details:"Feedback received. Task not continued."}})}catch(r){c.default.error(`[${o.name}] Error handling completion feedback: ${r.message}\n${r.stack}`),this.eventEmitter.emit(f.InternalEvents.TOOL_ERROR,{clientId:t.id,taskId:e.taskId,error:r.message,type:"task_error",context:{source:"completionFeedback"}})}}};t.FeedbackEventHandler=m,t.FeedbackEventHandler=m=o=n([(0,a.Injectable)(),s("design:paramtypes",[d.TaskService,u.ConversationHistoryService,l.EventEmitter2])],m)},29161:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatCompletionModule=void 0;const n=r(3563),s=r(93239);let i=class{};t.ChatCompletionModule=i,t.ChatCompletionModule=i=o([(0,n.Module)({providers:[s.SummaryCompletion],exports:[s.SummaryCompletion]})],i)},29220:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AskFollowupQuestionToolFactory=void 0;const s=r(3563),i=r(71921);let a=class{constructor(){}getToolName(){return"ask_followup_question"}create(e){return new i.AskFollowupQuestionTool({availableInPlan:!0,availableInAct:!0})}};t.AskFollowupQuestionToolFactory=a,t.AskFollowupQuestionToolFactory=a=o([(0,s.Injectable)(),n("design:paramtypes",[])],a)},29231:e=>{"use strict";e.exports=require("chokidar")},29234:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.RequestContext=void 0;const a=r(6426),c=i(r(79896)),l=i(r(16928));class d{constructor(e,t,r){this.workspace=e,this.requestId=t,this.sessionId=r,this.toolBaseDir=null}getToolBaseDir(){return null!==this.toolBaseDir?this.toolBaseDir:this.workspace.repoBaseDir}setToolBaseDir(e){this.toolBaseDir=e}portFromSourceTree(){if(this.workspace.portFromBaseDir)return(0,a.generateAdaptiveTree)(this.workspace.portFromBaseDir)}repositoryTree(){return(0,a.generateAdaptiveTree)(this.workspace.repoBaseDir)}repositoryHints(){const e=l.join(this.workspace.repoBaseDir,"hints.md");if(c.existsSync(e))return c.readFileSync(e,"utf-8")}productHints(){const e=l.join(this.workspace.repoBaseDir,"product-hints.md");if(c.existsSync(e))return c.readFileSync(e,"utf-8")}}t.RequestContext=d,d.TREE_SIZE_WARNING_THRESHOLD=1e5},29265:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIChunkAdapter=void 0;const s=r(3563),i=r(18448),a=r(55705),c=n(r(19055));let l=class{constructor(){this.toolCallBuffer=new Map}convertChunk(e){const t=[];if(!e.choices||0===e.choices.length)return e.usage&&t.push(this.createUsageChunk(e.usage)),t;const r=e.choices[0];if(r.delta?.content&&t.push({type:i.NormalizedChunkType.TEXT,content:r.delta.content,originalContent:r.delta.content,metadata:{chunkSource:"openai",choiceIndex:r.index||0}}),r.delta?.tool_calls)for(const e of r.delta.tool_calls){const r=this.processToolCall(e);r&&t.push({type:i.NormalizedChunkType.TEXT,content:r,originalContent:r,metadata:{chunkSource:"openai",toolCallId:e.id,isToolCall:!0}})}if(r.finish_reason){if("tool_calls"===r.finish_reason){const e=this.getClosingToolTags();e&&t.push({type:i.NormalizedChunkType.TEXT,content:e,originalContent:e,metadata:{chunkSource:"openai",isToolCallClosing:!0}})}t.push({type:i.NormalizedChunkType.STOP,stopReason:this.mapStopReason(r.finish_reason),metadata:{chunkSource:"openai",originalFinishReason:r.finish_reason}})}return e.usage&&t.push(this.createUsageChunk(e.usage)),t}mapStopReason(e){if(!e)return a.NormalizedStopReason.UNKNOWN;switch(e){case"stop":return a.NormalizedStopReason.END_TURN;case"length":return a.NormalizedStopReason.MAX_TOKENS;case"tool_calls":case"function_call":return a.NormalizedStopReason.TOOL_USE;case"content_filter":return a.NormalizedStopReason.CONTENT_FILTER;default:return c.default.warn(`[OpenAIChunkAdapter] Unknown finish_reason: ${e}`),a.NormalizedStopReason.UNKNOWN}}isStreamComplete(e){return null!==e.choices?.[0]?.finish_reason}extractError(e){return null}processToolCall(e){const t=e.id;if(!t)return"";this.toolCallBuffer.has(t)||this.toolCallBuffer.set(t,{arguments:""});const r=this.toolCallBuffer.get(t);let o="";return e.function?.name&&!r.name&&(r.name=e.function.name,o+=`<${r.name}>`),e.function?.arguments&&(r.arguments+=e.function.arguments,o+=e.function.arguments),o}getClosingToolTags(){let e="";for(const[t,r]of this.toolCallBuffer.entries())r.name&&(e+=`</${r.name}>`);return this.toolCallBuffer.clear(),e}createUsageChunk(e){return{type:i.NormalizedChunkType.USAGE,inputTokens:e.prompt_tokens||0,outputTokens:e.completion_tokens||0,cacheReadTokens:e.prompt_tokens_details?.cached_tokens||0,cacheWriteTokens:0,metadata:{chunkSource:"openai",totalTokens:e.total_tokens}}}};t.OpenAIChunkAdapter=l,t.OpenAIChunkAdapter=l=o([(0,s.Injectable)()],l)},29311:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StopReasonMapper=void 0;const o=r(55705),n=r(59100);class s{static getMapping(e){return this.MAPPINGS[e]}static createStopReasonBlock(e,t){const r=this.getMapping(e);if(!r||"error"!==r.blockType)return null;let o=r.errorMessageTemplate;return o=t?o.replace("{{providerContext}}",JSON.stringify(t)):o.replace(" Provider context: {{providerContext}}",""),o=o.replace("{{providerContext}}","Not available"),{type:"block",block:{blockId:(0,n.ulid)(),blockType:r.blockType,status:r.status,content:o}}}static isErrorInducingStopReason(e){const t=this.getMapping(e);return"error"===t?.severity||"critical"===t?.severity}}t.StopReasonMapper=s,s.MAPPINGS={[o.NormalizedStopReason.COMPLETE]:{blockType:"text",status:"finished",errorMessageTemplate:"Stream completed successfully.",severity:"warning"},[o.NormalizedStopReason.MAX_TOKENS]:{blockType:"error",status:"error",errorMessageTemplate:"Response was truncated due to maximum token limit. Provider context: {{providerContext}}",severity:"error"},[o.NormalizedStopReason.CONTEXT_LIMIT]:{blockType:"error",status:"error",errorMessageTemplate:"Response generation stopped due to context window limit. Provider context: {{providerContext}}",severity:"error"},[o.NormalizedStopReason.CONTENT_FILTER]:{blockType:"error",status:"error",errorMessageTemplate:"Response was filtered due to content policy. Provider context: {{providerContext}}",severity:"error"},[o.NormalizedStopReason.TOOL_USE]:{blockType:"tool_call",status:"question",errorMessageTemplate:"Stream stopped for tool use.",severity:"warning"},[o.NormalizedStopReason.ERROR]:{blockType:"error",status:"error",errorMessageTemplate:"An error occurred during response generation. Provider context: {{providerContext}}",severity:"critical"},[o.NormalizedStopReason.ABORTED]:{blockType:"error",status:"error",errorMessageTemplate:"Response generation was cancelled. Provider context: {{providerContext}}",severity:"error"},[o.NormalizedStopReason.END_TURN]:{blockType:"text",status:"finished",errorMessageTemplate:"Stream completed (end of turn).",severity:"warning"},[o.NormalizedStopReason.SAFETY]:{blockType:"error",status:"error",errorMessageTemplate:"Response stopped due to safety policy. Provider context: {{providerContext}}",severity:"error"},[o.NormalizedStopReason.RECITATION]:{blockType:"error",status:"error",errorMessageTemplate:"Response stopped due to recitation policy. Provider context: {{providerContext}}",severity:"warning"},[o.NormalizedStopReason.UNKNOWN]:{blockType:"error",status:"error",errorMessageTemplate:"Response stopped for an unknown reason. Provider context: {{providerContext}}",severity:"warning"}}},29361:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleProvider=void 0;const o=r(48483),n=r(8959),s=r(99664),i=r(52368);class a extends o.BaseProvider{getName(){return"google"}getBaseChatModel(e,t){const r=i.ConfigService.getInstance().getProperty("GOOGLE_API_KEY");if(!r)throw new Error("Google API key not found in configuration");const o=i.ConfigService.getInstance().getProperty("GOOGLE_BASE_URL")||"https://generativelanguage.googleapis.com";return new s.ChatGoogleGenerativeAI({model:this.shortModelName(e),maxOutputTokens:65536,apiKey:r,baseUrl:o})}supportsCancellation(){return!0}async getModelDescriptors(){return[new n.ModelDescriptor(this.getName(),a.GEMINI_PRO_EXP_MODEL,0,0,0,0)]}isValid(){return!!i.ConfigService.getInstance().getProperty("GOOGLE_API_KEY")}}t.GoogleProvider=a,a.GEMINI_PRO_EXP_MODEL="gemini-2.5-pro-exp-03-25"},29781:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChunkValidationError=void 0,t.validateNormalizedChunk=s,t.validateNormalizedChunks=function(e,t){e.forEach(((e,r)=>{s(e,`${t||"chunks"}[${r}]`)}))},t.safeValidateChunk=function(e){try{return s(e),{isValid:!0}}catch(t){return t instanceof n?{isValid:!1,error:t.message,chunk:t.invalidChunk}:{isValid:!1,error:"Unknown validation error",chunk:e}}};const o=r(9109);class n extends Error{constructor(e,t){super(`Chunk validation failed: ${e}`),this.invalidChunk=t,this.name="ChunkValidationError"}}function s(e,t){const r=t?`${t}: `:"";if(!(0,o.isNormalizedChunk)(e))throw new n(`${r}Invalid chunk format`,e);switch(e.type){case"thinking":case"text":if(void 0===e.content||""===e.content)throw new n(`${r}${e.type} chunks should have content`,e);break;case"usage":if(void 0===e.inputTokens&&void 0===e.outputTokens&&void 0===e.cacheReadTokens&&void 0===e.cacheWriteTokens)throw new n(`${r}usage chunks should have at least one token count`,e);if(void 0!==e.inputTokens&&e.inputTokens<0)throw new n(`${r}inputTokens cannot be negative`,e);if(void 0!==e.outputTokens&&e.outputTokens<0)throw new n(`${r}outputTokens cannot be negative`,e);if(void 0!==e.cacheReadTokens&&e.cacheReadTokens<0)throw new n(`${r}cacheReadTokens cannot be negative`,e);if(void 0!==e.cacheWriteTokens&&e.cacheWriteTokens<0)throw new n(`${r}cacheWriteTokens cannot be negative`,e);break;case"stop":if(void 0===e.stopReason)throw new n(`${r}stop chunks should have a stopReason`,e)}}t.ChunkValidationError=n},30059:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GlhfProvider=void 0;const n=r(48483),s=r(8959),i=r(52368),a=o(r(58938)),c=r(96228);class l extends n.BaseProvider{getName(){return"glhf"}getBaseChatModel(e,t){return new c.ChatOpenAI({modelName:this.shortModelName(e),temperature:t.temperature,openAIApiKey:i.ConfigService.getInstance().getProperty("GLHF_API_KEY"),configuration:{baseURL:l.BASE_URL}})}async getModelDescriptors(){return(await this.fetchModels()).map((e=>new s.ModelDescriptor("glhf",e.id,0,0,0,0)))}isValid(){return!!i.ConfigService.getInstance().getProperty("GLHF_API_KEY")}async fetchModels(){if(l.modelsCache&&Date.now()-l.modelsCache.timestamp<l.CACHE_TTL)return l.modelsCache.models;const e=i.ConfigService.getInstance().getProperty("GLHF_API_KEY");if(!e)return console.log("GLHF API key not found"),[];try{const t=await a.default.get(`${l.BASE_URL}/models`,{headers:{Authorization:`Bearer ${e}`}});if(200===t.status){const e=t.data.data;return l.modelsCache={models:e,timestamp:Date.now()},e}}catch(e){console.error("Error fetching GLHF models:",e)}return[]}supportsOnDemandModels(){return!0}}t.GlhfProvider=l,l.QWEN_2_5_CODER_32B_INSTRUCT="glhf/hf:Qwen/Qwen2.5-Coder-32B-Instruct",l.QWEN_2_5_72B_INSTRUCT="glhf/hf:Qwen/Qwen2.5-72B-Instruct",l.META_LLAMA_3_1_405B_INSTRUCT="glhf/hf:meta-llama/Meta-Llama-3.1-405B-Instruct",l.META_LLAMA_3_1_8B_INSTRUCT="glhf/hf:meta-llama/Meta-Llama-3.1-8B-Instruct",l.META_LLAMA_3_3_70B_INSTRUCT="glhf/hf:meta-llama/Llama-3.3-70B-Instruct",l.modelsCache=null,l.CACHE_TTL=3e5,l.BASE_URL="https://glhf.chat/api/openai/v1"},30526:e=>{"use strict";e.exports=require("ignore")},30538:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HomeService=void 0;const u=r(3563),p=r(19668),f=d(r(19055)),h=r(52368),m=d(r(58938)),g=a(r(70857));class y{constructor(e){const{requestContent:t,responseContent:r,startedAt:o,endedAt:n,...s}=e;this.requestData=s}toJSON(){return this.requestData}}let v=class{constructor(e,t){this.configService=e,this.userService=t,this.accessCheck={lastResultCode:null,timeOfLastCheck:null,failedToConnect:!1},this.userData=null,this.workerQueue=[],this.workerInterval=null,this.isShuttingDown=!1}onModuleInit(){this.startWorkerThread()}async onApplicationShutdown(e){f.default.info("Application shutdown initiated"+(e?` (signal: ${e})`:"")),this.isShuttingDown=!0,this.workerInterval&&clearInterval(this.workerInterval),this.workerQueue.length>0&&(f.default.info(`Processing ${this.workerQueue.length} remaining requests before shutdown`),await this.processRemainingRequests()),f.default.info("Shutdown process completed")}isValidUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}async checkAccess(){const e=this.configService.getProperty("EVE_API_KEY");if(!e)throw new Error("API Key is not configured");if(!this.isValidUUID(e))throw new Error("Invalid API Key");const t=g.hostname();try{const r=await m.default.post("https://otiiwxlfsrejhbrxdras.supabase.co/functions/v1/log-access",{hostname:t},{headers:{Authorization:`Bearer ${e}`},timeout:3e3});if(r.data&&r.data.userId&&r.data.email){const{userId:e,email:t}=r.data;this.userData={userId:e,email:t},f.default.info(`Access granted for user: ${t} (ID: ${e})`)}else f.default.warn("Log access response did not contain expected user data.");this.accessCheck={lastResultCode:r.status,timeOfLastCheck:new Date,failedToConnect:!1}}catch(e){if(m.default.isAxiosError(e)){const t=e;t.response?this.accessCheck={lastResultCode:t.response.status,timeOfLastCheck:new Date,failedToConnect:!1}:(t.request,this.accessCheck={lastResultCode:null,timeOfLastCheck:new Date,failedToConnect:!0})}else this.accessCheck={lastResultCode:null,timeOfLastCheck:new Date,failedToConnect:!0};f.default.error("Failed to check access",e)}return this.accessCheck}async isAccessOkay(){const e=new Date(Date.now()-864e5);return(!this.accessCheck.timeOfLastCheck||this.accessCheck.timeOfLastCheck<e||403===this.accessCheck.lastResultCode)&&await this.checkAccess(),200===this.accessCheck.lastResultCode||this.accessCheck.failedToConnect}async getUserData(){try{return await this.userService.getCurrentUser()}catch(e){if(e instanceof p.AuthenticationError?f.default.error(`[HomeService] Authentication error: ${e.message}`):f.default.error(`[HomeService] Error getting user data: ${e.message}`),this.userData)return this.userData;if(!this.userData)try{await this.checkAccess()}catch(e){f.default.error(`[HomeService] Error checking access: ${e.message}`)}if(!this.userData)throw e;return this.userData}}async logRequest(e){await this.isAccessOkay()&&!this.accessCheck.failedToConnect&&this.workerQueue.push(new y(e))}startWorkerThread(){this.workerInterval=setInterval((async()=>{if(this.workerQueue.length>0&&!this.isShuttingDown){const e=[...this.workerQueue];this.workerQueue=[],await this.sendRequestsToHomeServer(e)}}),1e4)}async processRemainingRequests(){if(this.workerQueue.length>0){const e=[...this.workerQueue];this.workerQueue=[],await this.sendRequestsToHomeServer(e)}}async sendRequestsToHomeServer(e){const t=this.configService.getProperty("EVE_API_KEY");if(!t)return void f.default.warn("API Key is not configured");const r=e.map((e=>m.default.post("https://otiiwxlfsrejhbrxdras.supabase.co/functions/v1/log-request",e,{headers:{Authorization:`Bearer ${t}`},timeout:5e3})));(await Promise.allSettled(r)).forEach(((e,t)=>{"rejected"===e.status&&f.default.warn(`Failed to log request at index ${t}`,e.reason)}))}};t.HomeService=v,t.HomeService=v=i([(0,u.Injectable)(),l(1,(0,u.Inject)((0,u.forwardRef)((()=>p.UserService)))),c("design:paramtypes",[h.ConfigService,p.UserService])],v)},30652:e=>{"use strict";e.exports=require("tree-sitter-c")},30662:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RulesController=void 0;const a=r(3563),c=r(96170),l=r(19668),d=r(1145),u=i(r(19055)),p=r(88474);let f=class{constructor(e,t,r){this.rulesService=e,this.userService=t,this.workspaceService=r}async getRules(e,t){if(!e)throw new a.BadRequestException("Source is required");u.default.debug(`[RulesController] Getting rules for source: ${e}, workspace: ${t||"none"}`);const r=await this.userService.getCurrentUser();u.default.debug(`[RulesController] Current user: ${r.email} (ID: ${r.userId})`);let o=t;if(e===d.RuleSource.REPO&&t){const e=await this.workspaceService.findOne(t);if(!e)throw new a.NotFoundException(`Workspace ${t} not found`);o=e.repoBaseDir,u.default.debug(`[RulesController] Resolved workspace path: ${o}`)}const n=await this.rulesService.getRulesBySource(e,r.userId,o,t);return u.default.debug(`[RulesController] Found ${n.length} rules for source: ${e}`),n}async getRule(e,t){if(!t)throw new a.BadRequestException("Source is required");try{const r=decodeURIComponent(e);return u.default.debug(`[RulesController] Getting rule content for ID: ${r}, source: ${t}`),this.rulesService.getRuleContent(r,t)}catch(e){throw u.default.error(`[RulesController] Error getting rule content: ${e.message}\n${e.stack}`),e}}async updateRule(e,t){if(!t.source)throw new a.BadRequestException("Source is required");try{const r=decodeURIComponent(e);return u.default.debug(`[RulesController] Updating rule content for ID: ${r}, source: ${t.source}`),this.rulesService.updateRuleContent(r,t.source,t.content)}catch(e){throw u.default.error(`[RulesController] Error updating rule content: ${e.message}\n${e.stack}`),e}}async toggleRule(e,t){try{const r=decodeURIComponent(e);u.default.debug(`[RulesController] Toggling rule status for ID: ${r}, enabled: ${t.enabled}`);const o=await this.userService.getCurrentUser();u.default.debug(`[RulesController] User ID for toggle: ${o.userId}`);const n=await this.rulesService.toggleRuleStatus(r,o.userId,t.enabled);return u.default.debug("[RulesController] Toggle result:",n),n}catch(e){throw u.default.error(`[RulesController] Error toggling rule status: ${e.message}\n${e.stack}`),e}}async createRule(e){if(!e.source)throw new a.BadRequestException("Source is required");let t=e.workspaceId;if(e.source===d.RuleSource.REPO&&e.workspaceId){const r=await this.workspaceService.findOne(e.workspaceId);if(!r)throw new a.NotFoundException(`Workspace ${e.workspaceId} not found`);t=r.repoBaseDir,u.default.debug(`[RulesController] Creating rule in workspace: ${e.workspaceId}`),u.default.debug(`[RulesController] Resolved workspace path: ${t}`)}return this.rulesService.createRule(e.source,e.name,e.content,t,e.workspaceId)}async deleteRule(e,t){if(!t)throw new a.BadRequestException("Source is required");try{const r=decodeURIComponent(e);return u.default.debug(`[RulesController] Deleting rule with ID: ${r}, source: ${t}`),this.rulesService.deleteRule(r,t)}catch(e){throw u.default.error(`[RulesController] Error deleting rule: ${e.message}\n${e.stack}`),e}}};t.RulesController=f,o([(0,a.Get)(),s(0,(0,a.Query)("source")),s(1,(0,a.Query)("workspace")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],f.prototype,"getRules",null),o([(0,a.Get)(":id"),s(0,(0,a.Param)("id")),s(1,(0,a.Query)("source")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],f.prototype,"getRule",null),o([(0,a.Put)(":id"),s(0,(0,a.Param)("id")),s(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],f.prototype,"updateRule",null),o([(0,a.Put)(":id/toggle"),s(0,(0,a.Param)("id")),s(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],f.prototype,"toggleRule",null),o([(0,a.Post)(),s(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],f.prototype,"createRule",null),o([(0,a.Delete)(":id"),s(0,(0,a.Param)("id")),s(1,(0,a.Query)("source")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],f.prototype,"deleteRule",null),t.RulesController=f=o([(0,a.Controller)("rules"),n("design:paramtypes",[c.RulesService,l.UserService,p.WorkspaceService])],f)},30811:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RequestRepository=void 0;const i=r(3563);r(31832);let a=class{constructor(e){this.knex=e}async findAll(e,t){let r=this.knex("requests").select("*");if(t&&(r=r.orderBy(t.field,t.order.toLowerCase())),e){const{page:t,limit:o}=e,n=(t-1)*o;r=r.offset(n).limit(o)}return r}async findById(e){return this.knex("requests").where("requestId",e).first()}async findBySessionId(e,t,r){let o=this.knex("requests").where("sessionId",e);if(r&&(o=o.orderBy(r.field,r.order.toLowerCase())),t){const{page:e,limit:r}=t,n=(e-1)*r;o=o.offset(n).limit(r)}return o}async create(e){await this.knex("requests").insert(e)}async update(e,t){await this.knex("requests").where("requestId",e).update(t)}async delete(e){await this.knex("requests").where("requestId",e).delete()}async countBySessionId(e){const t=await this.knex("requests").where("sessionId",e).count("* as count").first();return t?.count}async updateRequest(e,t){await this.knex("requests").where("requestId",e).update(t)}async updateGitStats(e,t){await this.knex("requests").where("requestId",e).update(t)}async getSessionGitStats(e){return(await this.knex("requests").select("sessionId").sum("filesChanged as filesChanged").sum("insertions as insertions").sum("deletions as deletions").sum("testFilesChanged as testFilesChanged").sum("testInsertions as testInsertions").sum("testDeletions as testDeletions").sum("linesChanged as linesChanged").sum("testLinesChanged as testLinesChanged").whereIn("sessionId",e).groupBy("sessionId")).reduce(((e,t)=>(e[t.sessionId]={filesChanged:t.filesChanged,insertions:t.insertions,deletions:t.deletions,testFilesChanged:t.testFilesChanged,testInsertions:t.testInsertions,testDeletions:t.testDeletions,linesChanged:t.linesChanged,testLinesChanged:t.testLinesChanged},e)),{})}};t.RequestRepository=a,t.RequestRepository=a=o([(0,i.Injectable)(),s(0,(0,i.Inject)("KNEX")),n("design:paramtypes",[Function])],a)},30873:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TreeSitterService=void 0;const u=r(3563),p=d(r(20508)),f=d(r(19055)),h=r(9123),m=d(r(67660)),g=d(r(56844)),y=d(r(73433)),v=d(r(85915)),_=d(r(33297)),w=d(r(72083)),b=d(r(86540)),k=d(r(30652)),S=d(r(76297)),T=d(r(89445)),R=c(r(16928)),C=r(15845);let P=n=class{constructor(){this.parsers={},f.default.info(`[${n.name}] TreeSitterService initialized`)}async onModuleInit(){await this.initializeParsers()}async initializeParsers(){try{const e=new p.default;e.setLanguage(m.default),this.parsers.js={parser:e,query:new p.default.Query(m.default,C.javascriptQuery)},this.parsers.jsx=this.parsers.js;const t=new p.default;t.setLanguage(g.default.typescript),this.parsers.ts={parser:t,query:new p.default.Query(g.default.typescript,C.typescriptQuery)};const r=new p.default;r.setLanguage(g.default.tsx),this.parsers.tsx={parser:r,query:new p.default.Query(g.default.tsx,C.typescriptQuery)};const o=new p.default;o.setLanguage(y.default),this.parsers.py={parser:o,query:new p.default.Query(y.default,C.pythonQuery)};const s=new p.default;s.setLanguage(v.default),this.parsers.java={parser:s,query:new p.default.Query(v.default,C.javaQuery)};const i=new p.default;i.setLanguage(_.default),this.parsers.rs={parser:i,query:new p.default.Query(_.default,C.rustQuery)};const a=new p.default;a.setLanguage(w.default),this.parsers.rb={parser:a,query:new p.default.Query(w.default,C.rubyQuery)};const c=new p.default;c.setLanguage(b.default),this.parsers.cpp={parser:c,query:new p.default.Query(b.default,C.cppQuery)},this.parsers.hpp=this.parsers.cpp;const l=new p.default;l.setLanguage(k.default),this.parsers.c={parser:l,query:new p.default.Query(k.default,C.cQuery)},this.parsers.h=this.parsers.c;const d=new p.default;d.setLanguage(S.default),this.parsers.cs={parser:d,query:new p.default.Query(S.default,C.csharpQuery)};const u=new p.default;u.setLanguage(T.default),this.parsers.go={parser:u,query:new p.default.Query(T.default,C.goQuery)},f.default.info(`[${n.name}] All parsers initialized successfully`)}catch(e){throw f.default.error(`[${n.name}] Error initializing parsers: ${e.message}\n${e.stack}`),e}}parseDefinitions(e,t){const r=R.extname(e).toLowerCase().slice(1),o=[],s=this.parsers[r];if(!s)return f.default.warn(`[${n.name}] No parser available for file extension: ${r}`),o;try{const{parser:e,query:r}=s,n=e.parse(t),i=r.captures(n.rootNode);i.sort(((e,t)=>e.node.startPosition.row-t.node.startPosition.row));const a=t.split("\n");let c=-1;return i.forEach((e=>{const{node:t,name:r}=e,n=t.startPosition.row,s=t.endPosition.row;r.includes("name")&&a[n]&&o.push(a[n].trim()),c=s})),o}catch(t){return f.default.error(`[${n.name}] Error parsing definitions in file ${e}: ${t.message}\n${t.stack}`),o}}isExtensionSupported(e){return e in this.parsers}getParserForFile(e){const t=R.extname(e).toLowerCase().slice(1),r=this.parsers[t];return r?r.parser:null}collectErrorNodes(e,t,r){let o=!1;"ERROR"===e.type&&(r.push({filePath:t,line:e.startPosition.row+1,column:e.startPosition.column+1,endLine:e.endPosition.row+1,endColumn:e.endPosition.column+1,message:`Syntax error: issue near '${e.text.substring(0,30).replace(/\s+/g," ")}...' (type: ${e.type})`,severity:h.IssueSeverity.ERROR,source:"TreeSitter"}),o=!0),"MISSING"===e.type&&(r.push({filePath:t,line:e.startPosition.row+1,column:e.startPosition.column+1,endLine:e.endPosition.row+1,endColumn:e.endPosition.column+1,message:`Syntax error: missing element near '${e.text.substring(0,30).replace(/\s+/g," ")}...'`,severity:h.IssueSeverity.ERROR,source:"TreeSitter"}),o=!0);const n=e.type.toLowerCase();(n.includes("error")||n.includes("missing"))&&(r.push({filePath:t,line:e.startPosition.row+1,column:e.startPosition.column+1,endLine:e.endPosition.row+1,endColumn:e.endPosition.column+1,message:`Syntax error: issue near '${e.text.substring(0,30).replace(/\s+/g," ")}...' (type: ${e.type})`,severity:h.IssueSeverity.ERROR,source:"TreeSitter"}),o=!0),"unexpected_token"!==e.type&&"UNEXPECTED"!==e.type||(r.push({filePath:t,line:e.startPosition.row+1,column:e.startPosition.column+1,endLine:e.endPosition.row+1,endColumn:e.endPosition.column+1,message:`Syntax error: unexpected token '${e.text.substring(0,30).replace(/\s+/g," ")}...'`,severity:h.IssueSeverity.ERROR,source:"TreeSitter"}),o=!0);for(const n of e.children)this.collectErrorNodes(n,t,r)&&(o=!0);return o}getSyntaxIssues(e,t){const r=[],o=this.getParserForFile(e);if(!o)return f.default.warn(`[${n.name}] No parser available for syntax validation of: ${e}`),r;try{const n=o.parse(t);if(""===t.trim())return r;this.collectErrorNodes(n.rootNode,e,r);!0===n.rootNode.hasError&&0===r.length&&r.push({filePath:e,line:1,column:1,message:"Syntax error detected in file",severity:h.IssueSeverity.ERROR,source:"TreeSitter"});const s=R.extname(e).toLowerCase().slice(1);if(0===r.length&&""!==t.trim()&&("ts"===s||"js"===s||"py"===s)){const o=n.rootNode.endPosition,s=t.split("\n"),i=s.length;if(o.row<i-1||o.row===i-1&&o.column<s[i-1].length){const t=o.row+1,n=o.column+1,i=s[o.row].substring(Math.max(0,o.column-10),Math.min(s[o.row].length,o.column+20));r.push({filePath:e,line:t,column:n,message:`Syntax error: parsing stopped near '${i.replace(/\s+/g," ")}'`,severity:h.IssueSeverity.ERROR,source:"TreeSitter"})}}}catch(t){f.default.error(`[${n.name}] Error during Tree-sitter parsing for ${e}: ${t.message}`),r.push({filePath:e,line:1,column:1,message:`Failed to parse file with Tree-sitter: ${t.message}`,severity:h.IssueSeverity.ERROR,source:"TreeSitterInternal"})}return r}};t.TreeSitterService=P,t.TreeSitterService=P=n=a([(0,u.Injectable)(),l("design:paramtypes",[])],P)},31002:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},31321:e=>{"use strict";e.exports=require("reflect-metadata")},31424:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenSourceModelRegistryService=void 0;const d=r(3563),u=l(r(19055));let p=class{constructor(){this.models=new Map,this.initialized=!1,this.initializeRegistry()}async initializeRegistry(){if(!this.initialized)try{u.default.info("[OpenSourceModelRegistry] Initializing model registry...");const{getQwenModels:e}=await Promise.resolve().then((()=>a(r(26573)))),{getDeepSeekModels:t}=await Promise.resolve().then((()=>a(r(99538)))),o=e(),n=t(),s=[...o,...n];for(const e of s){this.models.set(e.modelId,e);for(const t of e.aliases)this.models.set(t.toLowerCase(),e)}this.initialized=!0,u.default.info(`[OpenSourceModelRegistry] Initialized with ${s.length} models (${this.models.size} total entries including aliases)`)}catch(e){u.default.error(`[OpenSourceModelRegistry] Failed to initialize registry: ${e.message}`),this.initialized=!1}}async searchModels(e){await this.initializeRegistry();const t=[],r=new Set,o=e.query.toLowerCase().trim(),n=this.models.get(o);n&&this.matchesCriteria(n,e)&&(t.push({model:n,score:1,matchReason:"exact",matchedField:"modelId"}),r.add(n.modelId));for(const[n,s]of this.models.entries())if(!r.has(s.modelId)&&n.includes(o)&&this.matchesCriteria(s,e)){s.aliases.some((e=>e.toLowerCase()===o))&&(t.push({model:s,score:.9,matchReason:"alias",matchedField:"aliases"}),r.add(s.modelId))}if(!1!==e.fuzzyMatch)for(const n of this.models.values())if(!r.has(n.modelId)&&this.matchesCriteria(n,e)){const e=this.calculateFuzzyScore(o,n);e>.3&&(t.push({model:n,score:e,matchReason:"fuzzy",matchedField:this.getBestMatchField(o,n)}),r.add(n.modelId))}return t.sort(((e,t)=>t.score-e.score)),u.default.debug(`[OpenSourceModelRegistry] Search for "${e.query}" returned ${t.length} results`),t}async getModel(e){return await this.initializeRegistry(),this.models.get(e.toLowerCase())||null}async getAllModels(){await this.initializeRegistry();const e=new Map;for(const t of this.models.values())e.set(t.modelId,t);return Array.from(e.values())}async getModelsByFamily(e){return(await this.getAllModels()).filter((t=>t.family.toLowerCase()===e.toLowerCase()))}matchesCriteria(e,t){if(t.family&&e.family.toLowerCase()!==t.family.toLowerCase())return!1;if(t.series&&e.series.toLowerCase()!==t.series.toLowerCase())return!1;if(t.requiredCapabilities)for(const[r,o]of Object.entries(t.requiredCapabilities))if(o&&!e.capabilities[r])return!1;return!(t.minContextWindow&&e.specifications.contextWindow<t.minContextWindow)&&!(t.maxParameters&&e.specifications.totalParameters>t.maxParameters)}calculateFuzzyScore(e,t){const r=[];r.push(this.stringSimilarity(e,t.modelId.toLowerCase())),r.push(this.stringSimilarity(e,t.displayName.toLowerCase()));const o=`${t.family}-${t.variant}`.toLowerCase();r.push(this.stringSimilarity(e,o));const n=`${t.series}-${t.variant}`.toLowerCase();r.push(this.stringSimilarity(e,n));for(const o of t.aliases)r.push(this.stringSimilarity(e,o.toLowerCase()));return Math.max(...r)}stringSimilarity(e,t){if(e===t)return 1;if(0===e.length||0===t.length)return 0;if(e.includes(t)||t.includes(e)){const r=e.length>t.length?e:t;return(e.length>t.length?t:e).length/r.length}const r=this.normalizeModelName(e),o=this.normalizeModelName(t);if(r.includes(o)||o.includes(r))return.7;const n=new Set(e.split("")),s=new Set(t.split("")),i=new Set([...n].filter((e=>s.has(e)))),a=new Set([...n,...s]);return i.size/a.size}normalizeModelName(e){return e.toLowerCase().replace(/[-_\s]/g,"").replace(/accounts\/[^\/]+\/models\//,"").replace(/\/(chat|instruct|base)$/,"").trim()}getBestMatchField(e,t){const r=[{name:"modelId",value:t.modelId},{name:"displayName",value:t.displayName},{name:"family",value:t.family},{name:"series",value:t.series},{name:"variant",value:t.variant}];let o=0,n="modelId";for(const t of r){const r=this.stringSimilarity(e,t.value.toLowerCase());r>o&&(o=r,n=t.name)}return n}async getStats(){const e=await this.getAllModels(),t={},r={},o={supportsVision:0,isCodeSpecialized:0,supportsToolUse:0,isMultilingual:0,supportsLongContext:0};for(const n of e)t[n.family]=(t[n.family]||0)+1,r[n.series]=(r[n.series]||0)+1,n.capabilities.supportsVision&&o.supportsVision++,n.capabilities.isCodeSpecialized&&o.isCodeSpecialized++,n.capabilities.supportsToolUse&&o.supportsToolUse++,n.capabilities.isMultilingual&&o.isMultilingual++,n.capabilities.supportsLongContext&&o.supportsLongContext++;return{totalModels:e.length,modelsByFamily:t,modelsBySeries:r,capabilityStats:o}}};t.OpenSourceModelRegistryService=p,t.OpenSourceModelRegistryService=p=i([(0,d.Injectable)(),c("design:paramtypes",[])],p)},31623:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RESPONSE_ONLY_TOOLS=void 0,t.RESPONSE_ONLY_TOOLS=["plan_mode_respond","attempt_completion","ask_followup_question","create_new_task"]},31832:e=>{"use strict";e.exports=require("knex")},32088:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatModel=t.ChatModelOptions=void 0;class r{constructor(e=null,t=null,r=!0){this.extraHeaders=e,this.extraSystemMessageKwargs=t,this.systemPromptSupported=r}}t.ChatModelOptions=r;t.ChatModel=class{constructor(e,t,o=new r){this.modelDescriptor=e,this.baseChatModel=t,this.options=o}calculateCost(e,t,r,o){const n=this.modelDescriptor;return e*n.costPerInputToken+t*n.costPerCacheWriteToken+r*n.costPerCacheReadToken+o*n.costPerOutputToken}}},32260:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.XaiAdapter=void 0;const i=r(3563),a=r(67182),c=r(42808),l=s(r(19055));let d=class{constructor(e){this.provider=e,this.id="xai",this.name="X.AI Grok",this.messageTransformer=new c.OpenAIMessageTransformer,l.default.info("[XaiAdapter] Initialized")}getProvider(){return this.provider}getModelClient(e){return this.provider.getModelClient(e)}toProviderFormat(e){return this.messageTransformer.toProviderFormat(e)}fromProviderFormat(e){return this.messageTransformer.fromProviderFormat(e,"")}extractMetadata(e){return{format:"openai-api"}}supportsThinking(){return!1}supportsFormatConversion(e){return!0}};t.XaiAdapter=d,t.XaiAdapter=d=o([(0,i.Injectable)(),n("design:paramtypes",[a.XaiProvider])],d)},32325:e=>{"use strict";e.exports=require("jsdom")},32398:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolProvider=void 0;const a=r(3563),c=i(r(19055));let l=o=class{constructor(){this.toolFactories=new Map,c.default.info(`[${o.name}] ToolProvider initialized`)}registerToolFactory(e){const t=e.getToolName();c.default.info(`[${o.name}] Registering tool factory for: ${t}`),this.toolFactories.set(t,e)}getTools(e,t){c.default.debug(`[${o.name}] Creating tools for mode: ${t.currentMode}`);const r=e.filter((e=>this.toolFactories.has(e))).map((e=>this.toolFactories.get(e).create(t))).filter((e=>e.isAvailableInMode(t.currentMode)));return c.default.debug(`[${o.name}] Available tools for mode ${t.currentMode}: ${r.map((e=>e.name)).join(", ")}`),r}getAllToolFactories(){return Array.from(this.toolFactories.values())}getToolFactory(e){return this.toolFactories.get(e)}};t.ToolProvider=l,t.ToolProvider=l=o=n([(0,a.Injectable)(),s("design:paramtypes",[])],l)},32424:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.GraphAgentModule=void 0;const n=r(3563),s=r(22300),i=r(45873),a=r(23880),c=r(69449),l=r(3177),d=r(84193),u=r(29161);let p=class{};t.GraphAgentModule=p,t.GraphAgentModule=p=o([(0,n.Module)({imports:[i.WorkspaceModule,a.SessionModule,c.LangchainModule,l.MutationsModule,d.HomeModule,u.ChatCompletionModule],providers:[s.GraphAgentCollaborator],exports:[s.GraphAgentCollaborator]})],p)},32937:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CacheRegistryService=void 0;const a=r(3563),c=r(50461),l=i(r(19055));let d=o=class{constructor(e){this.eventEmitter=e,this.cacheManagers=new Map}registerCacheManager(e){const t=e.getCacheName();this.cacheManagers.set(t,e),l.default.info(`[${o.name}] Registered cache manager: ${t}`)}unregisterCacheManager(e){this.cacheManagers.delete(e),l.default.info(`[${o.name}] Unregistered cache manager: ${e}`)}async invalidateWorkspace(e){const t=Array.from(this.cacheManagers.values()).map((t=>t.invalidateWorkspace(e).catch((e=>l.default.error(`[${o.name}] Error invalidating ${t.getCacheName()}: ${e.message}`)))));await Promise.allSettled(t),l.default.debug(`[${o.name}] Invalidated ${this.cacheManagers.size} caches for workspace: ${e}`)}async clearAllCaches(){const e=Array.from(this.cacheManagers.values()).map((e=>e.clearAll().catch((t=>l.default.error(`[${o.name}] Error clearing ${e.getCacheName()}: ${t.message}`)))));await Promise.allSettled(e),l.default.info(`[${o.name}] Cleared all registered caches`)}getRegisteredCacheNames(){return Array.from(this.cacheManagers.keys())}};t.CacheRegistryService=d,t.CacheRegistryService=d=o=n([(0,a.Injectable)(),s("design:paramtypes",[c.EventEmitter2])],d)},33153:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SourceArtefactService=void 0;const s=r(3563),i=r(45908),a=r(38547),c=r(84358);let l=class{constructor(e,t){this.sourceArtefactRepository=e,this.schemePackageManager=t}async importSourceArtefact(e,t,r){if(await this.findBySchemeAndLocator(e,t))throw new s.BadRequestException(`Source artefact with scheme '${e}' and locator '${t}' already exists.`);try{const o=await this.schemePackageManager.downloadAndStoreSources(e,t,r);return this.sourceArtefactRepository.create(o)}catch(r){const o=r instanceof Error?r.message:"Unknown error occurred";return this.sourceArtefactRepository.create(new a.SourceArtefact({scheme:e,locator:t,valid:!1,error:o,repo:"",cacheSrcBaseDir:""}))}}async findById(e){return this.sourceArtefactRepository.findById(e)}async delete(e){const t=await this.sourceArtefactRepository.findById(e);return t&&await this.schemePackageManager.deleteSourceCache(t.cacheSrcBaseDir),this.sourceArtefactRepository.delete(e)}async findBySchemeAndLocator(e,t){return this.sourceArtefactRepository.findBySchemeAndLocator(e,t)}async query(e,t,r=1,o=10,n="locator",s="ASC"){return this.sourceArtefactRepository.query(e,t,r,o,n,s)}async readArtefactSourceTree(e,t,r){const o=await this.ensureSourceArtefact(e,t,r);return this.schemePackageManager.getScheme(e).readArtefactSourceTree(o)}async readArtefactSourceFile(e,t,r,o){const n=await this.ensureSourceArtefact(e,t,o);return this.schemePackageManager.getScheme(e).readArtefactSourceFile(n,r)}async ensureSourceArtefact(e,t,r){let o=await this.findBySchemeAndLocator(e,t);const n=this.schemePackageManager.getScheme(e);return o&&!await n.needsImport(o)||(o=await this.importSourceArtefact(e,t,r)),o}};t.SourceArtefactService=l,t.SourceArtefactService=l=o([(0,s.Injectable)(),n("design:paramtypes",[i.SourceArtefactRepository,c.SchemePackageManager])],l)},33297:e=>{"use strict";e.exports=require("tree-sitter-rust")},33583:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceFileIndexService=void 0;const u=r(3563),p=c(r(29231)),f=c(r(16928)),h=d(r(19055)),m=r(91346),g=r(37526),y=r(85266);let v=n=class{constructor(e){this.ignoreConfigService=e,this.indexes=new Map,this.Fzf=null,this.byLengthAsc=null,this.fzfLoadPromise=null,this.fzfLoadFailed=!1,this.orderByMatchScore=(e,t)=>{const r=e=>{let t=0,r=-1/0;for(const o of e)r!==-1/0&&o-r>1&&t++,r=o;return t};return r(e.positions)-r(t.positions)},h.default.info(`[${n.name}] WorkspaceFileIndexService initialized`),this.loadFzfModule().catch((e=>{h.default.error(`[${n.name}] Failed to pre-load fzf module: ${e.message}`),this.fzfLoadFailed=!0}))}async ensureFzfLoaded(){return!(!this.Fzf||!this.byLengthAsc)||!this.fzfLoadFailed&&(this.fzfLoadPromise?(await this.fzfLoadPromise,this.Fzf&&this.byLengthAsc):(this.fzfLoadPromise=this.loadFzfModule(),await this.fzfLoadPromise,this.Fzf&&this.byLengthAsc))}async loadFzfModule(){try{h.default.debug(`[${n.name}] Loading fzf module...`);const e=await Promise.resolve().then((()=>c(r(28294))));this.Fzf=e.Fzf,this.byLengthAsc=e.byLengthAsc,h.default.debug(`[${n.name}] fzf module loaded successfully`)}catch(e){throw this.fzfLoadFailed=!0,h.default.error(`[${n.name}] Failed to load fzf module: ${e.message}`),e}finally{this.fzfLoadPromise=null}}buildFzfInstance(e){if(!this.Fzf||!this.byLengthAsc)return null;try{const t=e.map((e=>({node:e,label:f.basename(e.path)})));return new this.Fzf(t,{selector:e=>`${e.label} ${e.label} ${e.node.path}`,tiebreakers:[this.orderByMatchScore,this.byLengthAsc]})}catch(e){return h.default.error(`[${n.name}] Error building fzf instance: ${e.message}`),null}}async getFiles(e,t=""){let r=this.indexes.get(e);return r?r.isComplete||r.isScanning||this.startProgressiveScan(e):(r=this.createNewIndex(e),this.indexes.set(e,r),this.startProgressiveScan(e),await new Promise((e=>setTimeout(e,50)))),this.filterFiles(Array.from(r.files.values()),t,e)}getIndexStatus(e){const t=this.indexes.get(e);return t?{exists:!0,isComplete:t.isComplete,isScanning:t.isScanning,fileCount:t.files.size,currentDepth:t.currentDepth,lastUpdated:t.lastUpdated}:{exists:!1,isComplete:!1,isScanning:!1,fileCount:0,currentDepth:0}}async invalidateIndex(e){const t=this.indexes.get(e);t&&(t.watcher&&await t.watcher.close(),t.files.clear(),t.isComplete=!1,t.isScanning=!1,t.currentDepth=0,t.fzfInstance=void 0,this.startProgressiveScan(e))}createNewIndex(e){return{files:new Map,isComplete:!1,isScanning:!1,currentDepth:0,lastUpdated:new Date}}async startProgressiveScan(e){const t=this.indexes.get(e);if(t&&!t.isScanning){t.isScanning=!0,t.scanPromise=this.performProgressiveScan(e);try{await t.scanPromise}catch(t){const r=t instanceof Error?t.message:String(t);h.default.error(`[${n.name}] Error in progressive scan for ${e}: ${r}`)}finally{t.isScanning=!1,t.scanPromise=void 0}}}async performProgressiveScan(e){const t=this.indexes.get(e);if(t){h.default.info(`[${n.name}] Starting progressive scan for ${e}`);try{const r=new m.FileScanner(e),o=this.getStandardFilters(e),s=this.createTraversalContext(e);let i=0;for await(const a of r.scan(".",o,s)){t.files.set(a.path,a),t.lastUpdated=new Date,i++;const r=""===a.path?0:a.path.split("/").length;if(t.currentDepth=Math.max(t.currentDepth,r),i%100==0&&(await new Promise((e=>setImmediate(e))),!t.isScanning))return void h.default.info(`[${n.name}] Scan cancelled for ${e}`)}if(t.isComplete=!0,this.Fzf&&this.byLengthAsc){const r=Array.from(t.files.values());t.fzfInstance=this.buildFzfInstance(r),t.fzfInstance&&h.default.info(`[${n.name}] Built fzf instance for ${r.length} files in ${e}`)}h.default.info(`[${n.name}] Completed indexing ${e}: ${t.files.size} files, max depth: ${t.currentDepth}`),this.setupFileWatcher(e)}catch(t){const r=t instanceof Error?t.message:String(t);throw h.default.error(`[${n.name}] Error scanning ${e}: ${r}`),t}}}getStandardFilters(e){return[y.FileFiltersFactory.defaultRootIgnoreFilter(),this.ignoreConfigService.createGitIgnoreFilter(e),this.ignoreConfigService.createEveIgnoreFilter(e),this.ignoreConfigService.createEveIncludeFilter(e)]}createTraversalContext(e){return{rootPath:e,currentDepth:0,limitFilterExcludedFiles:!1,stats:{nodesScanned:0,nodesIncluded:0,bytesScanned:0,bytesIncluded:0,estimatedTokens:0}}}async filterFiles(e,t,r){if(!t.trim())return e.sort(((e,t)=>e.path.localeCompare(t.path))).slice(0,200);if(r){const e=this.indexes.get(r);if(e?.fzfInstance)try{const r=e.fzfInstance.find(t);if(r.length>0){let e=r.slice(0,20).map((({item:e})=>e.node));return t.startsWith(".")&&t.length>1&&(e=e.filter((e=>{const r=f.basename(e.path);return r.endsWith(t)||e.isDir&&r.includes(t)}))),h.default.debug(`[${n.name}] fzf search returned ${e.length} results for "${t}"`),e}}catch(e){h.default.error(`[${n.name}] Error using pre-built fzf instance: ${e.message}`)}}return h.default.debug(`[${n.name}] Using simple search fallback for "${t}"`),this.performSimpleSearch(e,t,20)}performSimpleSearch(e,t,r){const o=t.toLowerCase();h.default.debug(`[${n.name}] performSimpleSearch called with ${e.length} files, query: "${t}", limit: ${r}`);let s=e.filter((e=>{const r=f.basename(e.path).toLowerCase(),s=e.path.toLowerCase();if(t.startsWith(".")&&t.length>1){const t=r.endsWith(o)||e.isDir&&r.includes(o);return t&&h.default.debug(`[${n.name}] Extension match: ${e.path} (${e.isDir?"dir":"file"})`),t}const i=r.includes(o)||s.includes(o);return i&&h.default.debug(`[${n.name}] Simple match: ${e.path} (${e.isDir?"dir":"file"})`),i}));h.default.debug(`[${n.name}] Simple search found ${s.length} matches before sorting`),s.sort(((e,r)=>{const n=f.basename(e.path).toLowerCase(),s=f.basename(r.path).toLowerCase();if(t.startsWith(".")&&t.length>1){const e=n.endsWith(o),t=s.endsWith(o);if(e&&!t)return-1;if(t&&!e)return 1}return n===o&&s!==o?-1:s===o&&n!==o?1:n.startsWith(o)&&!s.startsWith(o)?-1:s.startsWith(o)&&!n.startsWith(o)?1:n.includes(o)&&!s.includes(o)?-1:s.includes(o)&&!n.includes(o)?1:e.path.localeCompare(r.path)}));const i=s.slice(0,r);return h.default.debug(`[${n.name}] Simple search returning ${i.length} results after limit`),i}rebuildFzfInstance(e){const t=this.indexes.get(e);if(t&&t.isComplete&&this.Fzf&&this.byLengthAsc){const r=Array.from(t.files.values());t.fzfInstance=this.buildFzfInstance(r),t.fzfInstance&&h.default.debug(`[${n.name}] Rebuilt fzf instance for ${r.length} files in ${e}`)}}setupFileWatcher(e){const t=this.indexes.get(e);if(t&&!t.watcher)try{const r=p.watch(e,{ignored:[/(^|[\/\\])\../,/node_modules/,/\.git/,/dist/,/build/],persistent:!0,ignoreInitial:!0,depth:10});r.on("add",(t=>this.handleFileAdded(e,t))).on("unlink",(t=>this.handleFileRemoved(e,t))).on("addDir",(t=>this.handleDirectoryAdded(e,t))).on("unlinkDir",(t=>this.handleDirectoryRemoved(e,t))).on("error",(t=>{const r=t instanceof Error?t.message:String(t);h.default.error(`[${n.name}] File watcher error for ${e}: ${r}`)})),t.watcher=r,h.default.debug(`[${n.name}] File watcher set up for ${e}`)}catch(t){h.default.error(`[${n.name}] Failed to set up file watcher for ${e}: ${t.message}`)}}async handleFileAdded(e,t){const o=this.indexes.get(e);if(o)try{const s=f.relative(e,t),i=await Promise.resolve().then((()=>c(r(79896)))).then((e=>e.promises.stat(t))),a={path:s,isDir:i.isDirectory(),sizeBytes:i.size};o.files.set(s,a),o.lastUpdated=new Date,this.rebuildFzfInstance(e),h.default.debug(`[${n.name}] Added file to index: ${s}`)}catch(e){const r=e instanceof Error?e.message:String(e);h.default.debug(`[${n.name}] Error adding file ${t}: ${r}`)}}handleFileRemoved(e,t){const r=this.indexes.get(e);if(!r)return;const o=f.relative(e,t);r.files.delete(o)&&(r.lastUpdated=new Date,this.rebuildFzfInstance(e),h.default.debug(`[${n.name}] Removed file from index: ${o}`))}async handleDirectoryAdded(e,t){const o=this.indexes.get(e);if(o)try{const s=f.relative(e,t),i={path:s,isDir:!0,sizeBytes:(await Promise.resolve().then((()=>c(r(79896)))).then((e=>e.promises.stat(t)))).size};o.files.set(s,i),o.lastUpdated=new Date,this.rebuildFzfInstance(e),h.default.debug(`[${n.name}] Added directory to index: ${s}`)}catch(e){const r=e instanceof Error?e.message:String(e);h.default.debug(`[${n.name}] Error adding directory ${t}: ${r}`)}}handleDirectoryRemoved(e,t){const r=this.indexes.get(e);if(!r)return;const o=f.relative(e,t),s=[];for(const[e]of r.files)(e===o||e.startsWith(o+"/"))&&s.push(e);for(const e of s)r.files.delete(e);s.length>0&&(r.lastUpdated=new Date,this.rebuildFzfInstance(e),h.default.debug(`[${n.name}] Removed directory and ${s.length} children from index: ${o}`))}async onModuleDestroy(){h.default.info(`[${n.name}] Cleaning up file watchers...`);for(const[e,t]of this.indexes)if(t.watcher)try{await t.watcher.close(),h.default.debug(`[${n.name}] Closed file watcher for ${e}`)}catch(t){h.default.error(`[${n.name}] Error closing file watcher for ${e}: ${t.message}`)}this.indexes.clear()}};t.WorkspaceFileIndexService=v,t.WorkspaceFileIndexService=v=n=a([(0,u.Injectable)(),l("design:paramtypes",[g.IgnoreConfigService])],v)},33713:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigDescriptors=t.ConfigSection=t.ConfigPropertyDescriptor=void 0;const o=r(76910),n=r(11544),s=r(81986),i=r(34264),a=r(30059),c=r(34659);class l{constructor(e,t,r,o,n,s,i){this.label=e,this.name=t,this.type=r,this.description=o,this.sensitive=n,this.defaultValue=s,this.possibleValues=i}}t.ConfigPropertyDescriptor=l;class d{constructor(e,t){this.title=e,this.properties=t}}t.ConfigSection=d;class u{constructor(e){this.sections=e}static getDefaultDescriptors(){const e=async()=>n.ChatModelManager.getInstance().getValidModelFullNames();return new u([new d("API Keys",[new l("Eve API Key",o.ConfigPropNames.EVE_API_KEY,"string","Eve API Key",!0),new l("Google API Key",o.ConfigPropNames.GOOGLE_API_KEY,"string","Google API Key for Gemini models",!0),new l("Anthropic API Key",o.ConfigPropNames.ANTHROPIC_API_KEY,"string","Anthropic API Key",!0),new l("OpenAI API Key",o.ConfigPropNames.OPENAI_API_KEY,"string","OpenAI API Key",!0),new l("Fireworks API Key",o.ConfigPropNames.FIREWORKS_API_KEY,"string","Fireworks.ai API Key",!0),new l("Groq API Key",o.ConfigPropNames.GROQ_API_KEY,"string","Groq API Key",!0),new l("Hyperbolic API Key",o.ConfigPropNames.HYPERBOLIC_API_KEY,"string","Hyperbolic API Key",!0),new l("Mistral API Key",o.ConfigPropNames.MISTRAL_API_KEY,"string","Mistral API Key",!0),new l("OpenRouter API Key",o.ConfigPropNames.OPENROUTER_API_KEY,"string","OpenRouter API Key",!0),new l("GLHF Chat API Key",o.ConfigPropNames.GLHF_API_KEY,"string","GLHF Chat API Key",!0),new l("DeepSeek API Key",o.ConfigPropNames.DEEPSEEK_API_KEY,"string","DeepSeek API Key",!0),new l("LM Studio API Key",o.ConfigPropNames.LMSTUDIO_API_KEY,"string","LM Studio API Key (optional, not required for local server)",!0),new l("SerpAPI Key",o.ConfigPropNames.SERP_API_KEY,"string","SerpAPI Key for web search functionality",!0)]),new d("Default Models",[new l("Coding Model",o.ConfigPropNames.DEFAULT_CODING_MODEL,"enum","Coding Model",!1,"anthropic/"+s.AnthropicProvider.SONNET_MODEL_NAME,e),new l("Reasoning Model",o.ConfigPropNames.DEFAULT_REASONING_MODEL,"enum","Reasoning Model",!1,"openai/"+i.OpenAIProvider.GPT_4O_MODEL_NAME,e),new l("Summarisation Model",o.ConfigPropNames.DEFAULT_SUMMARISATION_MODEL,"enum","Summarisation Model",!1,c.GroqProvider.LLAMA_31_8BB_INSTANT,e),new l("RAG Query Model",o.ConfigPropNames.DEFAULT_RAG_QUERY_MODEL,"enum","RAG Query Model",!1,"openai/"+i.OpenAIProvider.GPT_4O_MODEL_NAME,e),new l("Orchestration Model",o.ConfigPropNames.DEFAULT_ORCHESTRATION_MODEL,"enum","Orchestration Model",!1,"openai/"+i.OpenAIProvider.GPT_4O_MODEL_NAME,e),new l("Architect Model",o.ConfigPropNames.DEFAULT_ARCHITECT_MODEL,"enum","Architect Model",!1,"anthropic/"+s.AnthropicProvider.SONNET_MODEL_NAME,e)]),new d("Private Models",[new l("Coding Model",o.ConfigPropNames.PRIVATE_CODING_MODEL,"enum","Private Coding Model",!1,a.GlhfProvider.META_LLAMA_3_3_70B_INSTRUCT,e),new l("Reasoning Model",o.ConfigPropNames.PRIVATE_REASONING_MODEL,"enum","Private Reasoning Model",!1,a.GlhfProvider.META_LLAMA_3_3_70B_INSTRUCT,e),new l("Summarisation Model",o.ConfigPropNames.PRIVATE_SUMMARISATION_MODEL,"enum","Private Summarisation Model",!1,c.GroqProvider.LLAMA_31_8BB_INSTANT,e),new l("RAG Query Model",o.ConfigPropNames.PRIVATE_RAG_QUERY_MODEL,"enum","Private RAG Query Model",!1,a.GlhfProvider.META_LLAMA_3_3_70B_INSTRUCT,e),new l("Orchestration Model",o.ConfigPropNames.PRIVATE_ORCHESTRATION_MODEL,"enum","Private Orchestration Model",!1,a.GlhfProvider.META_LLAMA_3_3_70B_INSTRUCT,e),new l("Architect Model",o.ConfigPropNames.PRIVATE_ARCHITECT_MODEL,"enum","Private Architect Model",!1,a.GlhfProvider.META_LLAMA_3_3_70B_INSTRUCT,e)]),new d("Ollama",[new l("Ollama Base URL",o.ConfigPropNames.OLLAMA_BASE_URL,"string","Ollama Base URL - default: http://localhost:11434",!1)]),new d("LM Studio",[new l("LM Studio Base URL",o.ConfigPropNames.LMSTUDIO_BASE_URL,"string","LM Studio Base URL - default: http://localhost:1234/v1",!1,"http://localhost:1234/v1")]),new d("MCP Servers",[new l("MCP Servers Enabled",o.ConfigPropNames.MCP_SERVERS_ENABLED,"boolean","Enable or disable MCP servers",!1,!0),new l("MCP Servers Directory",o.ConfigPropNames.MCP_SERVERS_DIRECTORY,"string","Directory containing MCP servers",!1,"~/.eve/mcp-servers")]),new d("Misc",[new l("Agent Recursion Limit",o.ConfigPropNames.AGENT_RECURSION_LIMIT,"number","How many times a graph based agent can call itself recursively before halting",!1,50),new l("Agent Iteration Limit",o.ConfigPropNames.AGENT_ITERATION_LIMIT,"number","How many times a simple agent can iterate before halting",!1,50),new l("Agent System Prompt",o.ConfigPropNames.AGENT_SYSTEM_PROMPT,"number","Maximum length of the system prompt for agents",!1,1e5),new l("Dashboard £ per LOC",o.ConfigPropNames.VALUE_PER_LINE,"number","Approximate value created per line of code generated in £",!1,2.4),new l("Command Output Max Length",o.ConfigPropNames.COMMAND_OUTPUT_MAX_LENGTH,"number","Maximum length of command output (stdout/stderr) in characters",!1,1e4),new l("Command Output Prefix Length",o.ConfigPropNames.COMMAND_OUTPUT_PREFIX_LENGTH,"number","When command output is clipped, how many characters to keep from the beginning",!1,200)])])}}t.ConfigDescriptors=u},33911:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.SoftwareEngineerPersona=void 0;const n=r(3563),s=r(53877);let i=class{getId(){return"software-engineer"}getName(){return"Software Engineer"}getConfiguration(){return{id:this.getId(),name:this.getName(),corePrompt:(0,s.getBasePrompt)(),specificInstructions:void 0,requiredComponents:["tool-use-guidelines","plan-vs-act"],optionalComponents:["general-agent-behavior","objective","workspace-files","user-rules"],toolNames:this.getAllToolNames()}}getAllToolNames(){return["list_files","list_code_definition_names","search_files","read_file","write_to_file","replace_in_file","execute_command","web_search","use_mcp_tool","access_mcp_resource","ask_followup_question","plan_mode_respond","attempt_completion","create_new_task"]}getToolNamesForMode(e,t){return this.getAllToolNames()}};t.SoftwareEngineerPersona=i,t.SoftwareEngineerPersona=i=o([(0,n.Injectable)()],i)},33923:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateFile=void 0;const c=r(83153),l=r(11569),d=i(r(79896)),u=i(r(16928)),p=a(r(19055)),f=r(12303);class h extends c.Tool{constructor(e,t,r,o){super(),this.name="update_file",this.description="Update the content of a file in the workspace by providing the path of the file to update, the text block to search for in the file content, and the text block to replace the search block with. All 3 arguments are required: filePath, search (use a blank/empty string when creating new files), and replace.",this.schema=l.z.object({filePath:l.z.string().describe("The relative path of the file to update"),search:l.z.string().describe("The unique text block to search for in the file content. For new files, use a blank/empty string. For existing files, make sure to include a big enough search block to ensure you're only updating the intended text."),replace:l.z.string().describe("The text block to replace the search block with - DO NOT FORGET TO INCLUDE THIS!!!")}),this.workspaceRootDir=e,this.mutationsService=t,this.sessionId=r,this.requestId=o}async _call(e){return this.updateFile(e.filePath,e.search,e.replace)}ensureDirectoryExists(e){try{return d.existsSync(e)||(p.default.info(`Creating directory: ${e}`),d.mkdirSync(e,{recursive:!0})),!0}catch(t){return p.default.error(`Failed to create directory ${e}:`,t),!1}}async updateFile(e,t,r){p.default.info("UpdateFile.updateFile called with: %s\n>>>>> SEARCH\n%s\n-------\n%s<<<<< REPLACE\n",e,t,r);const o=u.join(this.workspaceRootDir,e);try{let n,s,i=!1;if(d.existsSync(o)||t&&""!==t)if(n=d.readFileSync(o,"utf-8"),""!==n.trim()||t&&""!==t.trim()){const i=n.includes("\r\n")?"\r\n":"\n",a=t.replace(/\r\n|\n/g,i),c=r.replace(/\r\n|\n/g,i);if(n.split(a).length-1>1)return p.default.warn("Multiple exact matches found for search block: --\x3e%s<-- and file content was:\n--\x3e%s<--",t,n),`ERROR: the search block was found multiple times in the file. Please expand the search block to make it unique and construct the corresponding replace block and try again.\nFile path was: ${e}\nSearch block was:\n${t}\n`;let l=n.indexOf(a),u=a.length,f=a;if(-1===l){p.default.info("Exact match not found, attempting indentation-agnostic search.");const r=a.split(i).map((e=>e.trim())).filter((e=>e.length>0)).map((e=>e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"))).join("\\s*"),o=new RegExp(r.replace(/\s+/g,"\\s+"),"g"),d=n.match(o);if(d&&d.length>1)return p.default.warn("Multiple indentation-agnostic matches found for search block"),p.default.warn("Search block was:\n%s",t),p.default.warn("Full file content was:\n%s",n),`ERROR: the search block was found multiple times in the file. \nPlease expand the search block to make it unique and construct the corresponding replace block and try again.\nFile path was: ${e}\nSearch block was:\n${t}\n`;o.lastIndex=0;const h=o.exec(n);if(!h)return p.default.warn("UpdateFile.updateFile failed to find the search block in the file content."),p.default.warn("Search block was:\n%s",t),p.default.warn("Full file content was:\n%s",n),`ERROR: failed to find search block in file content.\nPlease try again with a different search block.\nFile path was: ${e}\nSearch block was:\n${t}\n`;l=h.index,u=h[0].length,f=h[0];const m=f.split(i),g=m[0].match(/^\s*/)[0],y=m.filter((e=>e.trim().length>0)).map((e=>e.match(/^\s*/)[0].length-g.length)),v=c.split(i),_=v.map(((e,t)=>{if(!e.trim())return"";const r=y[Math.min(t,y.length-1)]||0;return g+" ".repeat(Math.max(0,r))+e.trim()})).join(i);s=n.slice(0,l)+_+n.slice(l+u)}else s=n.slice(0,l)+c+n.slice(l+u);p.default.info(`Updating file: ${e}`),p.default.debug("Updated file - Content after:\n%s",s),d.writeFileSync(o,s,"utf-8")}else{const e=r.replace(/\r\n/g,"\n");d.writeFileSync(o,e,"utf-8"),s=e}else{const e=u.dirname(o);if(!this.ensureDirectoryExists(e))return`ERROR: Failed to create directory: ${e}`;const t=r.replace(/\r\n/g,"\n");d.writeFileSync(o,t,"utf-8"),n="",s=t,i=!0}const a=i?`Successfully created new file: ${e}`:`Successfully updated file: ${e}`;try{await this.mutationsService.createMutation({type:i?f.MutationType.CREATE:f.MutationType.UPDATE,filePath:e,description:a,fileContentsBefore:n,fileContentsAfter:s,updatedAt:new Date,sessionId:this.sessionId,requestId:this.requestId})}catch(t){throw p.default.error("UpdateFile.updateFile encountered an error while recording the mutation:",{error:t.message,stack:t.stack,context:{filePath:e,isNewFile:i,sessionId:this.sessionId,requestId:this.requestId}}),new Error(`Failed to record file mutation: ${t.message}`)}return p.default.info("UpdateFile.updateFile completed successfully"),`Successfully updated file: ${e} with search block:\n${t}\n`}catch(e){return p.default.error("UpdateFile.updateFile encountered an error:",e),`Error: ${e.message}`}}}t.UpdateFile=h},34070:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EveAgentIncomingGateway=void 0;const c=r(76134),l=r(74437),d=a(r(19055)),u=r(96297),p=r(66595),f=r(57663),h=r(71036),m=r(68444),g=r(4704),y=r(44043),v=r(44810),_=r(19668);let w=o=class{constructor(e,t,r,o,n,s,i){this.webSocketService=e,this.taskEventHandler=t,this.userPromptHandler=r,this.toolEventHandler=o,this.configEventHandler=n,this.agentModeHandler=s,this.messagingHandler=i}afterInit(e){d.default.info(`[${o.name}] Gateway initialized.`)}handleConnection(e){this.webSocketService.addClient(e.id,e),e.join(e.id),u.debugLogger.log(`Client connected: ${e.id} (IncomingGateway)`),d.default.info(`[${o.name}] Client connected: ${e.id}`);try{const e=this.webSocketService.getServer()||this.server;if(e&&e.sockets&&e.sockets.adapter){const t=e.sockets.adapter.rooms;if(t){const e=Array.from(t.keys()).filter((e=>!e.startsWith("/")));u.debugLogger.log(`Socket.io rooms (on connect): ${JSON.stringify(e)}`)}}}catch(e){d.default.warn(`[${o.name}] Error accessing Socket.io rooms on connect: ${e.message}`)}}handleDisconnect(e){this.webSocketService.removeClient(e.id),u.debugLogger.log(`Client disconnected: ${e.id} (IncomingGateway)`),d.default.info(`[${o.name}] Client disconnected: ${e.id}`);try{const e=this.webSocketService.getServer()||this.server;if(e&&e.sockets&&e.sockets.adapter){const t=e.sockets.adapter.rooms;if(t){const e=Array.from(t.keys()).filter((e=>!e.startsWith("/")));u.debugLogger.log(`Socket.io rooms (on disconnect): ${JSON.stringify(e)}`)}}}catch(e){d.default.warn(`[${o.name}] Error accessing Socket.io rooms on disconnect: ${e.message}`)}}handleEcho(e,t){return this.messagingHandler.handleEcho(e,t)}async handleGetConfig(e){return this.configEventHandler.handleGetConfig(e)}async handleCreateTask(e,t){u.debugLogger.log(`Received createTask from client ${t.id}`),d.default.info(`[${o.name}] Received createTask from client ${t.id}`);try{await this.taskEventHandler.handleCreateTask({workspaceName:e.workspaceName,personaId:e.personaId},t),d.default.info(`[${o.name}] Task creation initiated for client ${t.id}`)}catch(e){const r=e instanceof _.AuthenticationError?`Authentication failed: ${e.message}`:e.message;d.default.error(`[${o.name}] Error creating task for client ${t.id}: ${r}\n${e.stack}`),t.emit("taskError",{message:r})}}async handleCreateTaskStep(e,t){d.default.info(`[${o.name}] Received createTaskStep (legacy) from client ${t.id} for task ${e.taskId}`);try{await this.taskEventHandler.handleCreateTaskStep(e,t),d.default.info(`[${o.name}] Task step ${e.stepNumber} creation initiated for task ${e.taskId}`)}catch(r){d.default.error(`[${o.name}] Error creating task step for task ${e.taskId}: ${r.message}\n${r.stack}`),t.emit("taskStepError",{taskId:e.taskId,stepNumber:e.stepNumber,message:r.message})}}async handleUpdateTaskStep(e,t){d.default.info(`[${o.name}] Received updateTaskStep (legacy) from client ${t.id} for task ${e.taskId}`);try{await this.taskEventHandler.handleUpdateTaskStep(e,t),d.default.info(`[${o.name}] Task step ${e.stepNumber} update initiated for task ${e.taskId}`)}catch(r){d.default.error(`[${o.name}] Error updating task step for task ${e.taskId}: ${r.message}\n${r.stack}`),t.emit("taskStepError",{taskId:e.taskId,stepNumber:e.stepNumber,message:r.message})}}async handleToolApproval(e,t){await this.toolEventHandler.handleToolApproval(e,t)}async handleUserPrompt(e,t){u.debugLogger.log(`Received userPrompt from client ${t.id} for task ${e.taskId}`),d.default.info(`[${o.name}] Received userPrompt for task ${e.taskId}, passing to TaskEventHandler.`);try{t.join(e.taskId),d.default.info(`[${o.name}] Client ${t.id} joined room ${e.taskId}`),await this.userPromptHandler.handleUserPrompt(e,t.id),d.default.info(`[${o.name}] User prompt for task ${e.taskId} passed to UserPromptHandler.`)}catch(r){d.default.error(`[${o.name}] Error calling TaskEventHandler for task ${e.taskId}: ${r.message}\n${r.stack}`),t.emit("promptError",{taskId:e.taskId,message:`Gateway error: ${r.message}`})}}async handleCancelTask(e,t){await this.taskEventHandler.handleCancelTask(e,t),d.default.info(`[${o.name}] Task ${e.taskId} cancellation initiated by request.`)}async handleChangeAgentMode(e,t){await this.agentModeHandler.handleChangeAgentMode(e,t)}async handleJoinTaskRoom(e,t){await this.agentModeHandler.handleJoinTaskRoom(e,t)}};t.EveAgentIncomingGateway=w,n([(0,c.WebSocketServer)(),s("design:type",l.Server)],w.prototype,"server",void 0),n([(0,c.SubscribeMessage)("echo"),i(0,(0,c.MessageBody)()),i(1,(0,c.ConnectedSocket)()),s("design:type",Function),s("design:paramtypes",[Object,l.Socket]),s("design:returntype",void 0)],w.prototype,"handleEcho",null),n([(0,c.SubscribeMessage)("getConfig"),i(0,(0,c.ConnectedSocket)()),s("design:type",Function),s("design:paramtypes",[l.Socket]),s("design:returntype",Promise)],w.prototype,"handleGetConfig",null),n([(0,c.SubscribeMessage)("createTask"),i(0,(0,c.MessageBody)()),i(1,(0,c.ConnectedSocket)()),s("design:type",Function),s("design:paramtypes",[Object,l.Socket]),s("design:returntype",Promise)],w.prototype,"handleCreateTask",null),n([(0,c.SubscribeMessage)("createTaskStep"),i(0,(0,c.MessageBody)()),i(1,(0,c.ConnectedSocket)()),s("design:type",Function),s("design:paramtypes",[Object,l.Socket]),s("design:returntype",Promise)],w.prototype,"handleCreateTaskStep",null),n([(0,c.SubscribeMessage)("updateTaskStep"),i(0,(0,c.MessageBody)()),i(1,(0,c.ConnectedSocket)()),s("design:type",Function),s("design:paramtypes",[Object,l.Socket]),s("design:returntype",Promise)],w.prototype,"handleUpdateTaskStep",null),n([(0,c.SubscribeMessage)("toolApproval"),i(0,(0,c.MessageBody)()),i(1,(0,c.ConnectedSocket)()),s("design:type",Function),s("design:paramtypes",[Object,l.Socket]),s("design:returntype",Promise)],w.prototype,"handleToolApproval",null),n([(0,c.SubscribeMessage)("userPrompt"),i(0,(0,c.MessageBody)()),i(1,(0,c.ConnectedSocket)()),s("design:type",Function),s("design:paramtypes",[Object,l.Socket]),s("design:returntype",Promise)],w.prototype,"handleUserPrompt",null),n([(0,c.SubscribeMessage)("cancelTask"),i(0,(0,c.MessageBody)()),i(1,(0,c.ConnectedSocket)()),s("design:type",Function),s("design:paramtypes",[Object,l.Socket]),s("design:returntype",Promise)],w.prototype,"handleCancelTask",null),n([(0,c.SubscribeMessage)("changeAgentMode"),i(0,(0,c.MessageBody)()),i(1,(0,c.ConnectedSocket)()),s("design:type",Function),s("design:paramtypes",[Object,l.Socket]),s("design:returntype",Promise)],w.prototype,"handleChangeAgentMode",null),n([(0,c.SubscribeMessage)("joinTaskRoom"),i(0,(0,c.MessageBody)()),i(1,(0,c.ConnectedSocket)()),s("design:type",Function),s("design:paramtypes",[Object,l.Socket]),s("design:returntype",Promise)],w.prototype,"handleJoinTaskRoom",null),t.EveAgentIncomingGateway=w=o=n([(0,c.WebSocketGateway)({namespace:"eve-agent",cors:{origin:"*"}}),s("design:paramtypes",[v.WebSocketService,p.TaskEventHandler,f.UserPromptHandler,h.ToolEventHandler,m.ConfigEventHandler,g.AgentModeHandler,y.MessagingHandler])],w)},34251:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventSourceNotAvailableError=void 0;class r extends Error{constructor(){super("EventSource not available.\nConsider loading an EventSource polyfill and making it available globally as EventSource, or passing one in as eventSourceClass to the ReconnectingEventSource constructor.")}}t.EventSourceNotAvailableError=r;class o{constructor(e,t){if(this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this._configuration=null!=t?Object.assign({},t):void 0,this.withCredentials=!1,this._eventSource=null,this._lastEventId=null,this._timer=null,this._listeners={},this.url=e.toString(),this.readyState=this.CONNECTING,this.max_retry_time=3e3,this.eventSourceClass=globalThis.EventSource,null!=this._configuration&&(this._configuration.lastEventId&&(this._lastEventId=this._configuration.lastEventId,delete this._configuration.lastEventId),this._configuration.max_retry_time&&(this.max_retry_time=this._configuration.max_retry_time,delete this._configuration.max_retry_time),this._configuration.eventSourceClass&&(this.eventSourceClass=this._configuration.eventSourceClass,delete this._configuration.eventSourceClass)),null==this.eventSourceClass||"function"!=typeof this.eventSourceClass)throw new r;this._onevent_wrapped=e=>{this._onevent(e)},this._start()}dispatchEvent(e){throw new Error("Method not implemented.")}_start(){let e=this.url;this._lastEventId&&(-1===e.indexOf("?")?e+="?":e+="&",e+="lastEventId="+encodeURIComponent(this._lastEventId)),this._eventSource=new this.eventSourceClass(e,this._configuration),this._eventSource.onopen=e=>{this._onopen(e)},this._eventSource.onerror=e=>{this._onerror(e)},this._eventSource.onmessage=e=>{this.onmessage(e)};for(const e of Object.keys(this._listeners))this._eventSource.addEventListener(e,this._onevent_wrapped)}_onopen(e){0===this.readyState&&(this.readyState=1,this.onopen(e))}_onerror(e){if(1===this.readyState&&(this.readyState=0,this.onerror(e)),this._eventSource&&2===this._eventSource.readyState){this._eventSource.close(),this._eventSource=null;const e=Math.round(this.max_retry_time*Math.random());this._timer=setTimeout((()=>this._start()),e)}}_onevent(e){e instanceof MessageEvent&&(this._lastEventId=e.lastEventId);const t=this._listeners[e.type];if(null!=t)for(const r of[...t])r.call(this,e);"message"===e.type&&this.onmessage(e)}onopen(e){}onerror(e){}onmessage(e){}close(){this._timer&&(clearTimeout(this._timer),this._timer=null),this._eventSource&&(this._eventSource.close(),this._eventSource=null),this.readyState=2}addEventListener(e,t,r){e in this._listeners||(this._listeners[e]=[],null!=this._eventSource&&this._eventSource.addEventListener(e,this._onevent_wrapped));const o=this._listeners[e];Array.isArray(o)&&!o.includes(t)&&o.push(t)}removeEventListener(e,t,r){const o=this._listeners[e];if(null!=o){for(;;){const e=o.indexOf(t);if(-1===e)break;o.splice(e,1)}o.length<=0&&(delete this._listeners[e],null!=this._eventSource&&this._eventSource.removeEventListener(e,this._onevent_wrapped))}}}t.default=o,o.CONNECTING=0,o.OPEN=1,o.CLOSED=2},34264:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIProvider=void 0;const n=r(96228),s=r(48483),i=r(8959),a=r(52368),c=o(r(58938)),l=r(32088);class d extends s.BaseProvider{static isO1Model(e){return e.startsWith("o1")}getName(){return"openai"}getBaseChatModel(e,t){const r=process.env.OPENAI_BASE_URL||"https://api.openai.com/v1",o=this.shortModelName(e);return new n.ChatOpenAI({modelName:o,openAIApiKey:a.ConfigService.getInstance().getProperty("OPENAI_API_KEY"),configuration:{basePath:r}})}async getModelDescriptors(){0===d.modelCache.models.length&&await this.fetchModels();return d.modelCache.models.map((e=>{const t=d.MODEL_COSTS[e.id]||{input:0,output:0};return new i.ModelDescriptor("openai",e.id,t.input/1e3,0,0,t.output/1e3)}))}isValid(){return!!a.ConfigService.getInstance().getProperty("OPENAI_API_KEY")}async fetchModels(){if(!this.isValid())return[];const e=Date.now();if(d.modelCache.models.length>0&&e-d.modelCache.timestamp<3e5)return d.modelCache.models;const t=a.ConfigService.getInstance().getProperty("OPENAI_API_KEY");if(!t)return console.log("OpenAI API key not found"),[];try{const r=process.env.OPENAI_BASE_URL||"https://api.openai.com/v1",o=await c.default.get(`${r}/models`,{headers:{Authorization:`Bearer ${t}`}});if(200===o.status){const t=(o.data.data||[]).filter((e=>e.id.includes("gpt")||e.id.startsWith("o")));return d.modelCache={models:t,timestamp:e},t}return console.log(`Failed to fetch OpenAI models. Status code: ${o.status}`),[]}catch(e){return console.error(`Error fetching OpenAI models: ${e}`),[]}}getChatModelOptions(e,t){return new l.ChatModelOptions(null,null,!d.isO1Model(e.name))}}t.OpenAIProvider=d,d.GPT_4O_MODEL_NAME="gpt-4o",d.GPT_4O_MINI_MODEL_NAME="gpt-4o-mini",d.modelCache={models:[],timestamp:0},d.MODEL_COSTS={"gpt-4o":{input:1875e-9*1e3,output:75e-7*1e3},"gpt-4o-mini":{input:1125e-7,output:45e-5}}},34313:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MLX_PROVIDER_ID=void 0,t.discoverMlxModels=async function(e,r){const o=e;try{s.default.debug(`[MlxModels] Attempting to discover models from: ${o}`);const e=new n.default({baseURL:o,apiKey:"noop",timeout:3e3}),d=await e.models.list();if(!d.data||0===d.data.length)return s.default.debug(`[MlxModels] No models loaded in MLX Server at ${o}`),[];s.default.info(`[MlxModels] Discovered ${d.data.length} models from MLX Server`);const u=d.data.map((e=>async function(e,r){const o=e.id,n=function(e){let t=e.replace(/^mlx-community\//,"");return t=t.replace(/-/g," ").replace(/_/g," ").replace(/\b\w/g,(e=>e.toUpperCase())).replace(/(\d+)b(\s|$)/gi,"$1B$2").replace(/(\d+)k(\s|$)/gi,"$1K$2").replace(/(\d+)bit/gi,"($1-bit)").replace(/V(\d+)\.(\d+)/gi,"$1.$2").replace(/\s+/g," ").trim(),t}(o);let d,u,p,f,h={};if(r){const e=await async function(e,t){const r=function(e){const t=[];let r=e.replace(/^mlx-community\//,"").replace(/^mlx-/,"");t.push(r.toLowerCase()),t.push(r.replace(/-instruct$/i,"").toLowerCase()),t.push(r.replace(/-4bit$/i,"").toLowerCase()),t.push(r.replace(/-(4|8|16)bit$/i,"").toLowerCase()),t.push(r.replace(/-bf16$/i,"").toLowerCase()),t.push(r.replace(/-fp16$/i,"").toLowerCase());const o=r.toLowerCase().replace(/-bf16$/,"").replace(/-fp16$/,"").replace(/-4bit$/,"").replace(/-8bit$/,"").replace(/-16bit$/,"");t.push(o);const n=o.match(/^(\w+)-(\d+\.?\d*[bm]?)(?:-.*)?$/i);if(n){const[,e,r]=n;t.push(`${e.toLowerCase()}-${r.toLowerCase()}`),t.push(`${e.toLowerCase()}${r.toLowerCase()}`)}return Array.from(new Set(t))}(e);for(const e of r){const r=await t.getModel(e);if(r)return r}return null}(o,r);e?(s.default.debug(`[MlxModels] Found registry data for ${o}`),d=e.specifications.contextWindow,u=e.specifications.maxOutputTokens,p=e.capabilities.supportsVision,f=e.capabilities.supportsToolUse,h={modelFamily:e.family,series:e.series,variant:e.variant,displayName:e.displayName,organization:e.ownership.organization,license:e.ownership.license,releaseDate:e.release.releaseDate,version:e.release.version,totalParameters:e.specifications.totalParameters,activeParameters:e.specifications.activeParameters,isMoE:e.specifications.isMoE,programmingLanguagesCount:e.specifications.programmingLanguagesCount,isCodeSpecialized:e.capabilities.isCodeSpecialized,isMultilingual:e.capabilities.isMultilingual,supportsLongContext:e.capabilities.supportsLongContext}):(s.default.debug(`[MlxModels] No registry data found for ${o}, using detection logic`),d=c(o),u=d,p=l(o),f=!0)}else d=c(o),u=d,p=l(o),f=!0;return{modelId:o,providerId:t.MLX_PROVIDER_ID,name:n,contextWindow:d,maxOutputTokens:u,supportsImages:p,supportsToolUse:f,supportsComputerUse:!1,supportsPromptCache:!1,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:0,outputCostPerMillionTokens:0,isDefaultForProvider:!1,metadata:{isLocal:!0,serverUrl:"http://localhost:10240",optimizedFor:"Apple Silicon",framework:"MLX",unifiedMemory:!0,modelFamily:i(o),quantization:a(o),originalModelId:o,...h}}}(e,r))),p=await Promise.all(u);return p.sort(((e,t)=>e.name.localeCompare(t.name))),s.default.info(`[MlxModels] Successfully transformed ${p.length} MLX models`),p}catch(e){return"ECONNREFUSED"===e.code||"ENOTFOUND"===e.code?s.default.debug(`[MlxModels] MLX Server not accessible at ${o}`):"TimeoutError"===e.name?s.default.debug(`[MlxModels] MLX Server timeout at ${o}`):s.default.warn(`[MlxModels] MLX Server discovery failed: ${e.message}`),[]}},t.getDefaultMlxModelId=function(){return};const n=o(r(56082)),s=o(r(19055));function i(e){const t=e.toLowerCase();return t.includes("llama")?"llama":t.includes("mistral")?"mistral":t.includes("mixtral")?"mixtral":t.includes("qwen")?"qwen":t.includes("phi")?"phi":t.includes("gemma")?"gemma":t.includes("deepseek")?"deepseek":t.includes("yi")?"yi":t.includes("codellama")?"codellama":t.includes("starcoder")?"starcoder":t.includes("hermes")?"hermes":t.includes("openchat")?"openchat":t.includes("neural")?"neural-chat":"unknown"}function a(e){const t=e.toLowerCase();return t.includes("4bit")||t.includes("4-bit")?"4-bit":t.includes("8bit")||t.includes("8-bit")?"8-bit":t.includes("16bit")||t.includes("16-bit")?"16-bit":t.includes("fp16")?"fp16":t.includes("fp32")?"fp32":t.includes("int4")?"int4":t.includes("int8")?"int8":void 0}function c(e){const t=e.toLowerCase();return t.includes("128k")?128e3:t.includes("64k")?65536:t.includes("32k")?32768:t.includes("16k")?16384:t.includes("8k")?8192:t.includes("4k")?4096:t.includes("llama-3.2")||t.includes("llama-3.1")?32768:t.includes("llama-3")?8192:t.includes("mistral")||t.includes("qwen2.5")?32768:t.includes("qwen")?8192:t.includes("phi-3")?128e3:t.includes("phi")?4096:t.includes("gemma-2")||t.includes("gemma")?8192:32768}function l(e){const t=e.toLowerCase();return t.includes("vision")||t.includes("llava")||t.includes("minicpm")||t.includes("qwen-vl")||t.includes("phi-3-vision")}t.MLX_PROVIDER_ID="mlx"},34406:(e,t,r)=>{e.exports=s,s.sync=function(e,t){return n(o.statSync(e),e,t)};var o=r(79896);function n(e,t,r){return!(!e.isSymbolicLink()&&!e.isFile())&&function(e,t){var r=void 0!==t.pathExt?t.pathExt:process.env.PATHEXT;if(!r)return!0;if(-1!==(r=r.split(";")).indexOf(""))return!0;for(var o=0;o<r.length;o++){var n=r[o].toLowerCase();if(n&&e.substr(-n.length).toLowerCase()===n)return!0}return!1}(t,r)}function s(e,t,r){o.stat(e,(function(o,s){r(o,!o&&n(s,e,t))}))}},34562:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioTranscriptionService=void 0;const d=r(3563),u=r(35317),p=l(r(19055)),f=c(r(79896)),h=c(r(70857)),m=c(r(16928));let g=n=class{async transcribe(e){p.default.debug(`[${n.name}] Starting audio transcription`);const t=Buffer.from(e,"base64"),r=m.join(h.tmpdir(),`audio-${Date.now()}.wav`);await f.promises.writeFile(r,t),p.default.debug(`[${n.name}] Temporary file created: ${r}`);try{const e=await this.runFasterWhisperCLI(r);return p.default.debug(`[${n.name}] Transcription completed successfully`),e}finally{await f.promises.unlink(r),p.default.debug(`[${n.name}] Temporary file deleted: ${r}`)}}runFasterWhisperCLI(e){return new Promise(((t,r)=>{const o=m.join(h.tmpdir(),`audio-${Date.now()}.srt`);p.default.debug(`[${n.name}] Running Faster Whisper CLI on file: ${e}`);const s=process.env.TRANSCRIPTION_LANGUAGE||"en",i=process.env.TRANSCRIPTION_COMPUTE_TYPE||"float32",a=[e,"-o",o,"--task","transcribe","--without_timestamps","True","--language",s,"--compute_type",i],c=`faster-whisper ${a.join(" ")}`;p.default.info(`[${n.name}] Executing command: ${c}`);const l=(0,u.spawn)("faster-whisper",a);l.stdout.on("data",(e=>{p.default.debug(`[${n.name}] Faster Whisper stdout: ${e}`)})),l.stderr.on("data",(e=>{p.default.warn(`[${n.name}] Faster Whisper stderr: ${e}`)})),l.on("error",(e=>{p.default.error(`[${n.name}] Error in Faster Whisper process: ${e}`),r(new Error("Error in Faster Whisper process - make sure you have run the ./scripts/install-faster-whisper.sh script"))})),l.on("close",(async e=>{if(0===e)try{const e=await f.promises.readFile(o,"utf-8");p.default.debug(`[${n.name}] SRT content: ${e}`);const r=this.parseSrtContent(e);p.default.debug(`[${n.name}] Faster Whisper process completed successfully`),t(r)}catch(e){p.default.error(`[${n.name}] Error reading SRT file: ${e}`),r(new Error(`Error reading SRT file: ${e.message}`))}finally{await f.promises.unlink(o),p.default.debug(`[${n.name}] Temporary SRT file deleted: ${o}`)}else p.default.error(`[${n.name}] Faster Whisper process exited with code ${e}`),r(new Error(`Faster Whisper process exited with code ${e}`))}))}))}parseSrtContent(e){const t=e.split("\n");let r="";for(let e=0;e<t.length;e++)/^\d+$/.test(t[e])||/.*-->.*$/.test(t[e])||(r+=t[e].trim()+" ");return r.trim()}};t.AudioTranscriptionService=g,t.AudioTranscriptionService=g=n=a([(0,d.Injectable)()],g)},34659:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GroqProvider=void 0;const n=r(11463),s=r(48483),i=r(8959),a=r(52368),c=o(r(58938));class l extends s.BaseProvider{getName(){return"groq"}getBaseChatModel(e,t){return new n.ChatGroq({modelName:this.shortModelName(e),temperature:t.temperature,apiKey:a.ConfigService.getInstance().getProperty("GROQ_API_KEY")})}async getModelDescriptors(){return(await this.fetchModels()).map((e=>new i.ModelDescriptor("groq",e,0,0,0,0)))}isValid(){return!!a.ConfigService.getInstance().getProperty("GROQ_API_KEY")}async fetchModels(){const e=a.ConfigService.getInstance().getProperty("GROQ_API_KEY");if(!e)return console.log("Groq API key not found"),[];try{const t=await c.default.get("https://api.groq.com/openai/v1/models",{headers:{Authorization:`Bearer ${e}`}});if(200===t.status){return(t.data.data||[]).map((e=>e.id))}return console.log(`Failed to fetch Groq models. Status code: ${t.status}`),[]}catch(e){return console.error(`Error fetching Groq models: ${e}`),[]}}}t.GroqProvider=l,l.LLAMA_31_8BB_INSTANT="groq/llama-3.1-8b-instant",l.LLAMA_31_70B_VERSATILE="groq/llama-3.1-70b-versatile",l.LLAMA_3_70B_8192_TOOL_USE="groq/llama3-groq-70b-8192-tool-use-preview"},34833:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReadFileTool=void 0;const u=r(3563),p=c(r(91943)),f=c(r(16928)),h=d(r(19055)),m=r(20436),g=r(9581);let y=n=class extends m.BaseTool{constructor(e,t){super(t),this.name="read_file",this.description="Request to read the contents of a file at the specified path.",this.workingDir=e}validateParams(e){return"string"==typeof e.path&&""!==e.path.trim()}getModeSpecificGuidance(e){return null}getBaseUsageInstructions(e){return`## read_file\nDescription: IMPLEMENTATION DETAILS - Use this AFTER understanding both file organization and code signatures. Focus on specific files that contain key definitions or entry points identified in your structural analysis. This 'structure-first' approach minimizes token usage while maximizing understanding - you already know what's in the file from the signatures. Automatically extracts raw text from PDF and DOCX files.\nParameters:\n- path: (required) The path of the file to read (relative to the current working directory ${e.workingDir})\nUsage:\n<read_file>\n<path>File path here</path>\n</read_file>`}async execute(e){const t=e.path;h.default.info(`[${n.name}] Attempting to read path: ${t} relative to ${this.workingDir}`);const r=f.resolve(this.workingDir,t);if(!r.startsWith(this.workingDir)){const e=`Path traversal attempt detected: ${t} resolves outside of workspace ${this.workingDir}`;throw h.default.error(`[${n.name}] ${e}`),new g.FileSystemError(e,"PATH_TRAVERSAL_ERROR")}try{const e=await p.stat(r);if(e.isFile()){const e=await p.readFile(r,"utf8");return h.default.info(`[${n.name}] File ${t} read successfully`),e}if(e.isDirectory()){const e=(await p.readdir(r,{withFileTypes:!0})).map((e=>{const t=e.isDirectory()?"directory":"file";return`${e.name} (${t})`})).join("\n");return h.default.info(`[${n.name}] Directory ${t} listed successfully`),`Directory listing for ${t}:\n${e}`}{const e=`Path is neither a file nor a directory: ${t}`;throw h.default.error(`[${n.name}] ${e}`),new g.FileSystemError(e,"INVALID_PATH_TYPE")}}catch(e){if("ENOENT"===e.code){const e=`Path not found: ${t}`;throw h.default.error(`[${n.name}] ${e}`),new g.FileNotFoundError(e,t)}if(e instanceof g.FileSystemError||e instanceof g.FileNotFoundError)throw e;const r=`Error reading path ${t}: ${e.message}`;throw h.default.error(`[${n.name}] ${r}\n${e.stack}`),new g.FileSystemError(r,e.code||"FS_READ_ERROR")}}};t.ReadFileTool=y,t.ReadFileTool=y=n=a([(0,u.Injectable)(),l("design:paramtypes",[String,Object])],y)},34835:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TreeSitterValidator=void 0;const a=r(3563),c=r(30873),l=i(r(19055));let d=o=class{constructor(e){this.treeSitterService=e}getPriority(){return 100}canValidate(e){return this.treeSitterService.isExtensionSupported(e)}async validate(e,t,r){l.default.debug(`[${o.name}] Validating file: ${e}`);const n=this.treeSitterService.getSyntaxIssues(e,t);let s="";return n.length>0&&(s=n.map((e=>`${e.filePath}:${e.line}:${e.column}: ${e.severity}: ${e.message}`)).join("\n")),{validatorName:this.getName(),validationMethod:"TreeSitter syntax analysis",hasErrors:n.length>0,report:s}}getName(){return"TreeSitter"}};t.TreeSitterValidator=d,t.TreeSitterValidator=d=o=n([(0,a.Injectable)(),s("design:paramtypes",[c.TreeSitterService])],d)},34934:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ComputerToolLinux=void 0;const n=r(11569),s=r(35317),i=r(39023),a=r(53903),c=o(r(70943)),l=o(r(73864)),d=o(r(79896)),u=o(r(16928)),p=r(97751),f=r(87650),h=(0,i.promisify)(s.exec);class m extends p.ComputerToolBase{validateParams(e){return n.z.object({action:n.z.enum(["key","type","mouse_move","left_click","left_click_drag","right_click","middle_click","double_click","screenshot","cursor_position"]),text:n.z.string().optional(),coordinate:n.z.array(n.z.number()).length(2).optional()}).parse(e)}constructor(){if(super(),this.screenshotDelay=2,this.scalingEnabled=!0,this.outputDir="/tmp/outputs",!l.default.sync("xdotool"))throw new Error("xdotool is not installed. Please install it via your package manager.");if(!l.default.sync("gnome-screenshot")&&!l.default.sync("scrot"))throw new Error("Neither gnome-screenshot nor scrot is installed. Please install one of them.");if(!l.default.sync("convert"))throw new Error("ImageMagick is not installed. Please install it via your package manager.");const e=process.env.DISPLAY_NUM;this.displayPrefix=void 0!==e?`DISPLAY=:${e} `:"",this.xdotool=`${this.displayPrefix}xdotool`}async execute(e){const t=this.validateParams(e),{action:r,text:o,coordinate:n}=t;try{let e;switch(r){case"mouse_move":case"left_click_drag":if(!n)throw new f.ToolError(`coordinate is required for ${r}`);const[t,s]=n;e="mouse_move"===r?await this.shell(`${this.xdotool} mousemove --sync ${t} ${s}`):await this.shell(`${this.xdotool} mousedown 1 mousemove --sync ${t} ${s} mouseup 1`);break;case"key":if(!o)throw new f.ToolError(`text is required for ${r}`);e=await this.shell(`${this.xdotool} key -- ${o}`);break;case"type":if(!o)throw new f.ToolError(`text is required for ${r}`);e=await this.typeText(o);break;case"left_click":case"right_click":case"middle_click":case"double_click":e=await this.clickAction(r);break;case"screenshot":return e=await this.screenshot(),[{type:"image_url",image_url:{url:`data:image/png;base64,${e.base64_image}`}}];case"cursor_position":e=await this.getCursorPosition();break;default:throw new f.ToolError(`Invalid action: ${r}`)}return e.output}catch(e){return e instanceof f.ToolError?`Error: ${e.message}`:`Unexpected error: ${e}`}}async typeText(e){const t=this.chunkText(e,50);let r="";for(const e of t){const t=`${this.xdotool} type --delay 12 -- ${c.default.quote([e])}`;r+=(await this.shell(t,!1)).output}const o=await this.screenshot();return new f.ToolResult(r,"",o.base64_image)}async clickAction(e){const t={left_click:"1",right_click:"3",middle_click:"2",double_click:"--repeat 2 --delay 500 1"}[e];return await this.shell(`${this.xdotool} click ${t}`)}async getCursorPosition(){const e=(await this.shell(`${this.xdotool} getmouselocation --shell`,!1)).output||"",t=e.match(/X=(\d+)/),r=e.match(/Y=(\d+)/);if(!t||!r)throw new f.ToolError(`Failed to parse cursor position: ${e}`);const o=parseInt(t[1],10),n=parseInt(r[1],10);return new f.ToolResult(`X=${o},Y=${n}`,"")}async screenshot(){d.default.mkdirSync(this.outputDir,{recursive:!0});const e=u.default.join(this.outputDir,`screenshot_${(0,a.v4)().replace(/-/g,"")}.png`);let t="";if(l.default.sync("gnome-screenshot"))t=`${this.displayPrefix}gnome-screenshot -f ${e} -p`;else{if(!l.default.sync("scrot"))throw new f.ToolError("Neither gnome-screenshot nor scrot is available.");t=`${this.displayPrefix}scrot -p ${e}`}const r=await this.shell(t,!1);if(await this.shell(`convert ${e} -resize ${this.width}x${this.height}! ${e}`,!1),d.default.existsSync(e)){const t=d.default.readFileSync(e).toString("base64");return new f.ToolResult("","",t)}throw new f.ToolError(`Failed to take screenshot: ${r.error}`)}async shell(e,t=!0){const{stdout:r,stderr:o}=await h(e,{shell:"/bin/bash"});let n=null;return t&&(await new Promise((e=>setTimeout(e,1e3*this.screenshotDelay))),n=(await this.screenshot()).base64_image),new f.ToolResult(r,o,n)}chunkText(e,t){const r=[];for(let o=0;o<e.length;o+=t)r.push(e.slice(o,o+t));return r}}t.ComputerToolLinux=m},35015:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigController=void 0;const i=r(3563),a=r(52368);let c=class{constructor(e){this.configService=e}getConfig(){return this.configService.getConfig()}async getAllProperties(){return this.configService.getAllProperties()}async getProperty(e){return this.configService.getProperty(e)}async setProperty(e,t){return await this.configService.setProperty(e,t),{message:"Property set successfully"}}async unsetProperty(e){return await this.configService.unsetProperty(e),{message:"Property unset successfully"}}async updateMultipleProperties(e){for(const[t,r]of Object.entries(e))await this.configService.setProperty(t,r);return{message:"Properties updated successfully"}}};t.ConfigController=c,o([(0,i.Get)(),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],c.prototype,"getConfig",null),o([(0,i.Get)("properties"),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],c.prototype,"getAllProperties",null),o([(0,i.Get)("property/:name"),s(0,(0,i.Param)("name")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"getProperty",null),o([(0,i.Put)("property/:name"),s(0,(0,i.Param)("name")),s(1,(0,i.Body)("value")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],c.prototype,"setProperty",null),o([(0,i.Delete)("property/:name"),s(0,(0,i.Param)("name")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"unsetProperty",null),o([(0,i.Post)("properties"),s(0,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],c.prototype,"updateMultipleProperties",null),t.ConfigController=c=o([(0,i.Controller)("config"),n("design:paramtypes",[a.ConfigService])],c)},35317:e=>{"use strict";e.exports=require("child_process")},35444:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.TaskStatus=void 0,function(e){e.IN_PROGRESS="in_progress",e.WAITING_FOR_INPUT="waiting_for_input",e.EXECUTING_TOOL="executing_tool",e.USER_CANCELLED="user_cancelled"}(r||(t.TaskStatus=r={}))},35499:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolResultTransformerService=void 0;const a=r(3563),c=i(r(19055));let l=o=class{constructor(){this.transformers=new Map,this.registerTransformer("read_file",(e=>this.transformReadFile(e))),this.registerTransformer("search_files",(e=>this.transformSearchFiles(e))),this.registerTransformer("list_code_definition_names",(e=>this.transformListCodeDefinitionNames(e))),this.registerTransformer("list_files",(e=>this.transformListFiles(e))),this.registerTransformer("attempt_completion",(e=>this.transformAttemptCompletion(e)))}registerTransformer(e,t){this.transformers.set(e,t)}transformForClient(e,t){const r=this.transformers.get(e);if(r)try{return c.default.debug(`[${o.name}] Transforming result for tool: ${e}`),r(t)}catch(r){return c.default.warn(`[${o.name}] Error transforming result for tool ${e}: ${r.message}`),t}return t}hasTransformerFor(e){return this.transformers.has(e)}transformReadFile(e){if("string"==typeof e){const t=e,r=t.split("\n").length,o=t.length,n=this.extractFileName("Unknown");return{result:t,display:{summary:`File: ${n} (${r} lines, ${o.toLocaleString()} chars)`,status:"success",isCollapsible:!0,autoCollapse:!0,metadata:{fileName:n,lineCount:r,contentLength:o}}}}if(e&&"object"==typeof e){const t={...e},r=t.content?.length||0,o=t.content?.split("\n").length||0,n=this.extractFileName(t.path||"Unknown");return{...t,display:{summary:`File: ${n} (${o} lines, ${r.toLocaleString()} chars)`,status:"success",isCollapsible:!0,autoCollapse:!0,metadata:{fileName:n,lineCount:o,contentLength:r}}}}return e}transformSearchFiles(e){if(Array.isArray(e)){const t=e.length;return{result:e,display:{summary:`Found ${t} matches across ${this.countUniqueFiles(e)} files`,status:"success",isCollapsible:!0,autoCollapse:!0,metadata:{matchCount:t,fileCount:this.countUniqueFiles(e)}}}}return e}transformListCodeDefinitionNames(e){return Array.isArray(e)?{result:e,display:{summary:`Found ${e.length} code definitions`,status:"success",isCollapsible:!0,autoCollapse:!0,metadata:{definitionCount:e.length}}}:e}transformListFiles(e){return Array.isArray(e)?{result:e,display:{summary:`Listed ${e.length} files/directories`,status:"success",isCollapsible:!0,autoCollapse:!0,metadata:{fileCount:e.length}}}:e}transformAttemptCompletion(e){return e?{result:e,display:{summary:"Task completion",status:"success",isCollapsible:!1,autoCollapse:!1,metadata:{}}}:e}extractFileName(e){if(!e)return"Unknown";const t=e.split("/");return t[t.length-1]||e}countUniqueFiles(e){const t=new Set;return e.forEach((e=>{e&&e.path&&t.add(e.path)})),t.size}};t.ToolResultTransformerService=l,t.ToolResultTransformerService=l=o=n([(0,a.Injectable)(),s("design:paramtypes",[])],l)},35630:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VercelAdapter=t.MlxAdapter=t.OllamaAdapter=t.LMStudioAdapter=t.AnthropicAdapter=t.GeminiAdapter=t.XaiAdapter=t.XaiProvider=t.MlxProvider=t.OllamaProvider=t.LMStudioProvider=t.VercelProvider=t.FireworksProvider=t.OpenAIAdapter=t.OpenAIProvider=t.AnthropicProvider=t.GeminiProvider=void 0;var o=r(71672);Object.defineProperty(t,"GeminiProvider",{enumerable:!0,get:function(){return o.GeminiProvider}});var n=r(70209);Object.defineProperty(t,"AnthropicProvider",{enumerable:!0,get:function(){return n.AnthropicProvider}});var s=r(13853);Object.defineProperty(t,"OpenAIProvider",{enumerable:!0,get:function(){return s.OpenAIProvider}}),Object.defineProperty(t,"OpenAIAdapter",{enumerable:!0,get:function(){return s.OpenAIAdapter}});var i=r(17331);Object.defineProperty(t,"FireworksProvider",{enumerable:!0,get:function(){return i.FireworksProvider}});var a=r(84480);Object.defineProperty(t,"VercelProvider",{enumerable:!0,get:function(){return a.VercelProvider}});var c=r(37126);Object.defineProperty(t,"LMStudioProvider",{enumerable:!0,get:function(){return c.LMStudioProvider}});var l=r(81705);Object.defineProperty(t,"OllamaProvider",{enumerable:!0,get:function(){return l.OllamaProvider}});var d=r(62318);Object.defineProperty(t,"MlxProvider",{enumerable:!0,get:function(){return d.MlxProvider}});var u=r(17299);Object.defineProperty(t,"XaiProvider",{enumerable:!0,get:function(){return u.XaiProvider}}),Object.defineProperty(t,"XaiAdapter",{enumerable:!0,get:function(){return u.XaiAdapter}});var p=r(37916);Object.defineProperty(t,"GeminiAdapter",{enumerable:!0,get:function(){return p.GeminiAdapter}});var f=r(61208);Object.defineProperty(t,"AnthropicAdapter",{enumerable:!0,get:function(){return f.AnthropicAdapter}});var h=r(24160);Object.defineProperty(t,"LMStudioAdapter",{enumerable:!0,get:function(){return h.LMStudioAdapter}});var m=r(13686);Object.defineProperty(t,"OllamaAdapter",{enumerable:!0,get:function(){return m.OllamaAdapter}});var g=r(79056);Object.defineProperty(t,"MlxAdapter",{enumerable:!0,get:function(){return g.MlxAdapter}});var y=r(59512);Object.defineProperty(t,"VercelAdapter",{enumerable:!0,get:function(){return y.VercelAdapter}})},35699:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigPropertyRepository=void 0;const c=r(3563),l=(r(31832),a(r(19055))),d=r(81080);let u=o=class{constructor(e){this.knex=e}async getProperty(e){try{const t=await this.knex("config_properties").select("value").where("name",e).first();return t?.value||null}catch(t){return l.default.error(`[${o.name}] Error getting property ${e}`,t),null}}async setProperty(e,t){try{null===t?await this.knex("config_properties").where("name",e).delete():await this.knex("config_properties").insert({name:e,value:t}).onConflict("name").merge()}catch(t){throw l.default.error(`[${o.name}] Error setting property ${e}`,t),t}}async getAllProperties(){try{return(await this.knex("config_properties").select("*")).map((e=>new d.ConfigProperty(e.name,e.value)))}catch(e){return l.default.error(`[${o.name}] Error getting all properties`,e),[]}}async deleteProperty(e){try{await this.knex("config_properties").where("name",e).delete()}catch(t){throw l.default.error(`[${o.name}] Error deleting property ${e}`,t),t}}};t.ConfigPropertyRepository=u,t.ConfigPropertyRepository=u=o=n([(0,c.Injectable)(),i(0,(0,c.Inject)("KNEX")),s("design:paramtypes",[Function])],u)},35754:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StreamableHTTPClientTransport=t.StreamableHTTPError=void 0;const o=r(10815),n=r(73024),s=r(76446),i={initialReconnectionDelay:1e3,maxReconnectionDelay:3e4,reconnectionDelayGrowFactor:1.5,maxRetries:2};class a extends Error{constructor(e,t){super(`Streamable HTTP error: ${t}`),this.code=e}}t.StreamableHTTPError=a;t.StreamableHTTPClientTransport=class{constructor(e,t){var r;this._url=e,this._requestInit=null==t?void 0:t.requestInit,this._authProvider=null==t?void 0:t.authProvider,this._sessionId=null==t?void 0:t.sessionId,this._reconnectionOptions=null!==(r=null==t?void 0:t.reconnectionOptions)&&void 0!==r?r:i}async _authThenStart(){var e;if(!this._authProvider)throw new n.UnauthorizedError("No auth provider");let t;try{t=await(0,n.auth)(this._authProvider,{serverUrl:this._url})}catch(t){throw null===(e=this.onerror)||void 0===e||e.call(this,t),t}if("AUTHORIZED"!==t)throw new n.UnauthorizedError;return await this._startOrAuthSse({resumptionToken:void 0})}async _commonHeaders(){var e;const t={};if(this._authProvider){const e=await this._authProvider.tokens();e&&(t.Authorization=`Bearer ${e.access_token}`)}return this._sessionId&&(t["mcp-session-id"]=this._sessionId),new Headers({...t,...null===(e=this._requestInit)||void 0===e?void 0:e.headers})}async _startOrAuthSse(e){var t,r;const{resumptionToken:o}=e;try{const r=await this._commonHeaders();r.set("Accept","text/event-stream"),o&&r.set("last-event-id",o);const n=await fetch(this._url,{method:"GET",headers:r,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal});if(!n.ok){if(401===n.status&&this._authProvider)return await this._authThenStart();if(405===n.status)return;throw new a(n.status,`Failed to open SSE stream: ${n.statusText}`)}this._handleSseStream(n.body,e)}catch(e){throw null===(r=this.onerror)||void 0===r||r.call(this,e),e}}_getNextReconnectionDelay(e){const t=this._reconnectionOptions.initialReconnectionDelay,r=this._reconnectionOptions.reconnectionDelayGrowFactor,o=this._reconnectionOptions.maxReconnectionDelay;return Math.min(t*Math.pow(r,e),o)}_scheduleReconnection(e,t=0){var r;const o=this._reconnectionOptions.maxRetries;if(o>0&&t>=o)return void(null===(r=this.onerror)||void 0===r||r.call(this,new Error(`Maximum reconnection attempts (${o}) exceeded.`)));const n=this._getNextReconnectionDelay(t);setTimeout((()=>{this._startOrAuthSse(e).catch((r=>{var o;null===(o=this.onerror)||void 0===o||o.call(this,new Error(`Failed to reconnect SSE stream: ${r instanceof Error?r.message:String(r)}`)),this._scheduleReconnection(e,t+1)}))}),n)}_handleSseStream(e,t){if(!e)return;const{onresumptiontoken:r,replayMessageId:n}=t;let i;(async()=>{var t,a,c,l;try{const c=e.pipeThrough(new TextDecoderStream).pipeThrough(new s.EventSourceParserStream).getReader();for(;;){const{value:e,done:s}=await c.read();if(s)break;if(e.id&&(i=e.id,null==r||r(e.id)),!e.event||"message"===e.event)try{const r=o.JSONRPCMessageSchema.parse(JSON.parse(e.data));void 0!==n&&(0,o.isJSONRPCResponse)(r)&&(r.id=n),null===(t=this.onmessage)||void 0===t||t.call(this,r)}catch(e){null===(a=this.onerror)||void 0===a||a.call(this,e)}}}catch(e){if(null===(c=this.onerror)||void 0===c||c.call(this,new Error(`SSE stream disconnected: ${e}`)),this._abortController&&!this._abortController.signal.aborted&&void 0!==i)try{this._scheduleReconnection({resumptionToken:i,onresumptiontoken:r,replayMessageId:n},0)}catch(e){null===(l=this.onerror)||void 0===l||l.call(this,new Error(`Failed to reconnect: ${e instanceof Error?e.message:String(e)}`))}}})()}async start(){if(this._abortController)throw new Error("StreamableHTTPClientTransport already started! If using Client class, note that connect() calls start() automatically.");this._abortController=new AbortController}async finishAuth(e){if(!this._authProvider)throw new n.UnauthorizedError("No auth provider");if("AUTHORIZED"!==await(0,n.auth)(this._authProvider,{serverUrl:this._url,authorizationCode:e}))throw new n.UnauthorizedError("Failed to authorize")}async close(){var e,t;null===(e=this._abortController)||void 0===e||e.abort(),null===(t=this.onclose)||void 0===t||t.call(this)}async send(e,t){var r,s,i;try{const{resumptionToken:i,onresumptiontoken:c}=t||{};if(i)return void this._startOrAuthSse({resumptionToken:i,replayMessageId:(0,o.isJSONRPCRequest)(e)?e.id:void 0}).catch((e=>{var t;return null===(t=this.onerror)||void 0===t?void 0:t.call(this,e)}));const l=await this._commonHeaders();l.set("content-type","application/json"),l.set("accept","application/json, text/event-stream");const d={...this._requestInit,method:"POST",headers:l,body:JSON.stringify(e),signal:null===(r=this._abortController)||void 0===r?void 0:r.signal},u=await fetch(this._url,d),p=u.headers.get("mcp-session-id");if(p&&(this._sessionId=p),!u.ok){if(401===u.status&&this._authProvider){if("AUTHORIZED"!==await(0,n.auth)(this._authProvider,{serverUrl:this._url}))throw new n.UnauthorizedError;return this.send(e)}const t=await u.text().catch((()=>null));throw new Error(`Error POSTing to endpoint (HTTP ${u.status}): ${t}`)}if(202===u.status)return void((0,o.isInitializedNotification)(e)&&this._startOrAuthSse({resumptionToken:void 0}).catch((e=>{var t;return null===(t=this.onerror)||void 0===t?void 0:t.call(this,e)})));const f=(Array.isArray(e)?e:[e]).filter((e=>"method"in e&&"id"in e&&void 0!==e.id)).length>0,h=u.headers.get("content-type");if(f)if(null==h?void 0:h.includes("text/event-stream"))this._handleSseStream(u.body,{onresumptiontoken:c});else{if(!(null==h?void 0:h.includes("application/json")))throw new a(-1,`Unexpected content type: ${h}`);{const e=await u.json(),t=Array.isArray(e)?e.map((e=>o.JSONRPCMessageSchema.parse(e))):[o.JSONRPCMessageSchema.parse(e)];for(const e of t)null===(s=this.onmessage)||void 0===s||s.call(this,e)}}}catch(e){throw null===(i=this.onerror)||void 0===i||i.call(this,e),e}}get sessionId(){return this._sessionId}async terminateSession(){var e,t;if(this._sessionId)try{const t=await this._commonHeaders(),r={...this._requestInit,method:"DELETE",headers:t,signal:null===(e=this._abortController)||void 0===e?void 0:e.signal},o=await fetch(this._url,r);if(!o.ok&&405!==o.status)throw new a(o.status,`Failed to terminate session: ${o.statusText}`);this._sessionId=void 0}catch(e){throw null===(t=this.onerror)||void 0===t||t.call(this,e),e}}}},36206:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProviderRegistry=void 0;const i=r(3563),a=s(r(19055));let c=class{constructor(){this.serviceName="ProviderRegistry",this.providers=new Map}onModuleInit(){a.default.info(`[${this.serviceName}] Provider registry initialized`)}registerProvider(e){const t=e.getId();this.providers.set(t,e),a.default.info(`[${this.serviceName}] Registered provider: ${t}`)}getProvider(e){const t=this.providers.get(e);if(!t)throw new Error(`Provider not found: ${e}`);return t}getAllProviders(){return Array.from(this.providers.values())}getAllProviderIds(){return Array.from(this.providers.keys())}};t.ProviderRegistry=c,t.ProviderRegistry=c=o([(0,i.Injectable)(),n("design:paramtypes",[])],c)},36647:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TaskHistoryService=void 0;const i=r(3563),a=r(72776),c=s(r(19055)),l=r(59100),d=r(60269);let u=class{constructor(e,t){this.appDataSource=e,this.dbDebugContextService=t}async getTaskSummaries(e,t=6,r){try{return await this.dbDebugContextService.runWithContext({operationName:"TaskHistoryService.getTaskSummaries"},(async()=>{const o=this.appDataSource.knex("eve_tasks").where({userId:e}).where("totalInputTokens",">",0);r&&o.where({workspaceName:r});const n=await o.select("taskId","originalPrompt as prompt","totalInputTokens as tokensIn","totalOutputTokens as tokensOut","createdAt as timestamp","mode").orderBy("updatedAt","desc").limit(t);return c.default.debug(`Retrieved ${n.length} task summaries with non-zero input tokens for user ${e}${r?` in workspace ${r}`:""}`),n}))}catch(t){throw c.default.error(`Error getting task summaries for user ${e}: ${t.message}`,t.stack),new Error(`Failed to get task summaries: ${t.message}`)}}async getTaskEvents(e,t){try{return await this.dbDebugContextService.runWithContext({operationName:"TaskHistoryService.getTaskEvents",taskId:e},(async()=>{if(!await this.appDataSource.knex("eve_tasks").where({taskId:e,userId:t}).first())throw new i.UnauthorizedException("Not authorized to access this task");const r=await this.appDataSource.knex("eve_task_events").where({taskId:e}).orderBy("eventId","asc").select("eventId","eventType","payload","createdAt as timestamp"),o=r.map((e=>({...e,payload:JSON.parse(e.payload)})));return c.default.debug(`Retrieved ${r.length} events for task ${e}`),o}))}catch(t){if(t instanceof i.UnauthorizedException)throw t;throw c.default.error(`Error getting events for task ${e}: ${t.message}`,t.stack),new Error(`Failed to get task events: ${t.message}`)}}async persistEvent(e,t,r,o=1){try{return await this.dbDebugContextService.runWithContext({operationName:"TaskHistoryService.persistEvent",taskId:e},(async()=>{const o=(0,l.ulid)();await this.appDataSource.knex.transaction((async n=>{if(!await n("eve_tasks").where({taskId:e}).first("taskId"))throw new Error(`Cannot persist event: Task ${e} not found`);await n("eve_task_events").insert({eventId:o,taskId:e,eventType:t,payload:JSON.stringify(r),createdAt:n.fn.now()})})),c.default.debug(`Persisted ${t} event ${o} for task ${e}`)}))}catch(n){if(n.message.includes("database is locked")&&o<3){const n=100*Math.pow(2,o);return c.default.warn(`[TaskHistoryService] Database locked when persisting event, retrying in ${n}ms (attempt ${o})`),await new Promise((e=>setTimeout(e,n))),this.persistEvent(e,t,r,o+1)}c.default.error(`Failed to persist ${t} event for task ${e}: ${n.message}`,{taskId:e,eventType:t,error:n.stack})}}async deleteTask(e,t){try{return await this.dbDebugContextService.runWithContext({operationName:"TaskHistoryService.deleteTask",taskId:e},(async()=>{await this.appDataSource.knex.transaction((async r=>{const o=await r("eve_tasks").where({taskId:e,userId:t}).first("taskId","originalPrompt");if(!o)throw new i.UnauthorizedException("Not authorized to delete this task or task not found");c.default.info(`Starting deletion of task ${e} for user ${t} (prompt: "${o.originalPrompt?.substring(0,50)}...")`);const n=await r("eve_task_messages").where({taskId:e}).del();c.default.debug(`Deleted ${n} messages for task ${e}`);const s=await r("eve_task_blocks").where({taskId:e}).del();c.default.debug(`Deleted ${s} blocks for task ${e}`);try{const t=await r("eve_task_events").where({taskId:e}).del();c.default.debug(`Deleted ${t} events for task ${e}`)}catch(t){c.default.debug(`Could not delete events for task ${e}: ${t.message}`)}const a=await r("eve_task_usage").where({taskId:e}).del();c.default.debug(`Deleted ${a} usage records for task ${e}`);if(0===await r("eve_tasks").where({taskId:e,userId:t}).del())throw new Error(`Failed to delete task ${e} - task may have been deleted by another process`);c.default.info(`Successfully deleted task ${e} and all associated data`)}))}))}catch(r){if(r instanceof i.UnauthorizedException)throw r;throw c.default.error(`Error deleting task ${e} for user ${t}: ${r.message}`,r.stack),new Error(`Failed to delete task: ${r.message}`)}}async trackApiUsage(e,t,r=1){try{return await this.dbDebugContextService.runWithContext({operationName:"TaskHistoryService.trackApiUsage",taskId:e},(async()=>{if(!e||"string"!=typeof e)throw new Error("Invalid taskId provided");const r=t.inputTokens||0,o=t.outputTokens||0;if("number"!=typeof r||"number"!=typeof o)throw new Error("Invalid token counts provided");await this.appDataSource.knex.transaction((async t=>{if(0===await t("eve_tasks").where({taskId:e}).increment({totalInputTokens:r,totalOutputTokens:o}).update({updatedAt:t.fn.now()}))throw new Error(`Task ${e} not found when updating token counts`)})),c.default.debug(`Updated token counts for task ${e}: +${r} input, +${o} output`)}))}catch(o){if(o.message.includes("database is locked")&&r<3){const o=100*Math.pow(2,r);return c.default.warn(`[TaskHistoryService] Database locked when tracking API usage, retrying in ${o}ms (attempt ${r})`),await new Promise((e=>setTimeout(e,o))),this.trackApiUsage(e,t,r+1)}c.default.error(`Failed to update token counts for task ${e}: ${o.message}`,{taskId:e,error:o.stack,usageInfo:t})}}};t.TaskHistoryService=u,t.TaskHistoryService=u=o([(0,i.Injectable)(),n("design:paramtypes",[a.AppDataSource,d.DbDebugContextService])],u)},36683:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.ProductManagerPersona=void 0;const n=r(3563),s=r(95265);let i=class{getId(){return"product-manager"}getName(){return"Product Manager"}getConfiguration(){return{id:this.getId(),name:this.getName(),corePrompt:(0,s.getBasePrompt)(),specificInstructions:(0,s.getProductManagerInstructions)({}),requiredComponents:["tool-use-guidelines","plan-vs-act"],optionalComponents:["general-agent-behavior","objective","workspace-files","user-rules"],toolNames:this.getAllToolNames()}}getAllToolNames(){return["read_file","write_to_file","replace_in_file","list_files","search_files","list_code_definition_names","execute_command","web_search","use_mcp_tool","access_mcp_resource","ask_followup_question","plan_mode_respond","attempt_completion"]}getToolNamesForMode(e,t){return this.getAllToolNames()}};t.ProductManagerPersona=i,t.ProductManagerPersona=i=o([(0,n.Injectable)()],i)},36780:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parseToolParams=function(e,t){n.default.debug(`[parseToolParams] Attempting to parse XML for tool: ${t}`),n.default.debug(`[parseToolParams] Raw content:\n${e}`);const r={};try{const o=e.trim(),s=new RegExp(`<${t}\\s*>([\\s\\S]*?)<\\/${t}\\s*>`,"i"),i=o.match(s);if(!i||"string"!=typeof i[1])return n.default.warn(`[parseToolParams] Could not extract inner content for tool ${t}. Regex did not match.`),null;{const e=i[1].trim();n.default.debug(`[parseToolParams] Extracted inner content:\n${e}`);const o=/<([a-zA-Z_][a-zA-Z0-9_-]*)\s*>([\s\S]*?)<\/\1\s*>/g;let s,a=!1;for(;null!==(s=o.exec(e));){const e=s[1],t=s[2];r[e]=t,n.default.debug(`[parseToolParams] Found param: ${e} = "${t.substring(0,50)}${t.length>50?"...":""}"`),a=!0}a||n.default.warn(`[parseToolParams] No parameters found within the inner content for tool ${t}.`)}}catch(e){return n.default.error(`[parseToolParams] Error parsing tool params for ${t}: ${e.message}\n${e.stack}`),null}return r};const n=o(r(19055))},37020:e=>{"use strict";e.exports=require("yazl")},37126:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LMSTUDIO_PROVIDER_ID=t.getDefaultLMStudioModelId=t.discoverLMStudioModels=t.LMStudioAdapter=t.LMStudioProvider=void 0;var o=r(82010);Object.defineProperty(t,"LMStudioProvider",{enumerable:!0,get:function(){return o.LMStudioProvider}});var n=r(24160);Object.defineProperty(t,"LMStudioAdapter",{enumerable:!0,get:function(){return n.LMStudioAdapter}});var s=r(44985);Object.defineProperty(t,"discoverLMStudioModels",{enumerable:!0,get:function(){return s.discoverLMStudioModels}}),Object.defineProperty(t,"getDefaultLMStudioModelId",{enumerable:!0,get:function(){return s.getDefaultLMStudioModelId}}),Object.defineProperty(t,"LMSTUDIO_PROVIDER_ID",{enumerable:!0,get:function(){return s.LMSTUDIO_PROVIDER_ID}})},37465:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteFile=void 0;const c=r(83153),l=r(11569),d=i(r(79896)),u=i(r(16928)),p=a(r(19055));class f extends c.Tool{constructor(e){super(),this.name="delete_file",this.description="Delete a file from the workspace",this.schema=l.z.object({filePath:l.z.string().describe("The relative path of the file to delete")}),this.workspaceRootDir=e}async _call(e){return this.deleteFile(e.filePath)}deleteFile(e){const t=u.join(this.workspaceRootDir,e);try{return d.existsSync(t)?(p.default.info(`Deleting file: ${e}`),d.unlinkSync(t),`Successfully deleted file: ${e}`):`Error: File not found - ${e}`}catch(e){return`Error deleting file: ${e.message}`}}}t.DeleteFile=f},37526:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.IgnoreConfigService=void 0;const u=r(3563),p=c(r(91943)),f=c(r(16928)),h=d(r(30526)),m=d(r(19055)),g=r(58756);let y=n=class{constructor(){this.gitIgnoreCache=new Map,this.eveIgnoreCache=new Map,this.eveIncludeCache=new Map,m.default.info(`[${n.name}] IgnoreConfigService initialized`)}async getGitIgnoreInstance(e){const t=f.join(e,".gitignore");try{const r=(await p.stat(t)).mtime.getTime(),o=this.gitIgnoreCache.get(e);if(o&&o.mtime===r)return o.ignoreInstance;const s=await p.readFile(t,"utf-8"),i=(0,h.default)().add([".git"]).add(s);return this.gitIgnoreCache.set(e,{mtime:r,ignoreInstance:i}),m.default.debug(`[${n.name}] Parsed .gitignore for ${e}`),i}catch(t){if("ENOENT"===t.code){const t=(0,h.default)().add([".git"]);return this.gitIgnoreCache.set(e,{mtime:0,ignoreInstance:t}),t}throw m.default.error(`[${n.name}] Error reading .gitignore: ${t.message}`),t}}async getEveIgnoreInstance(e){const t=f.join(e,".eveignore");try{const r=(await p.stat(t)).mtime.getTime(),o=this.eveIgnoreCache.get(e);if(o&&o.mtime===r)return o.ignoreInstance;const s=await p.readFile(t,"utf-8"),i=(0,h.default)().add(s);return this.eveIgnoreCache.set(e,{mtime:r,ignoreInstance:i}),m.default.debug(`[${n.name}] Parsed .eveignore for ${e}`),i}catch(t){if("ENOENT"===t.code){const t=(0,h.default)();return this.eveIgnoreCache.set(e,{mtime:0,ignoreInstance:t}),t}throw m.default.error(`[${n.name}] Error reading .eveignore: ${t.message}`),t}}async getEveIncludePatterns(e){const t=f.join(e,".eveinclude");try{const r=(await p.stat(t)).mtime.getTime(),o=this.eveIncludeCache.get(e);if(o&&o.mtime===r)return o.patterns;const s=(await p.readFile(t,"utf-8")).split("\n").map((e=>e.trim())).filter((e=>e&&!e.startsWith("#")));return this.eveIncludeCache.set(e,{mtime:r,patterns:s}),m.default.debug(`[${n.name}] Parsed .eveinclude for ${e}: ${s.length} patterns`),s}catch(t){if("ENOENT"===t.code)return this.eveIncludeCache.set(e,{mtime:0,patterns:[]}),[];throw m.default.error(`[${n.name}] Error reading .eveinclude: ${t.message}`),t}}createGitIgnoreFilter(e){const t=async t=>{if(""===t.path)return"include";const r=await this.getGitIgnoreInstance(e),o=r.ignores(t.path);if(!o&&t.isDir){const e=t.path.endsWith("/")?t.path:`${t.path}/`;if(r.ignores(e))return"exclude"}if(!o){const e=t.path.split("/");let o="";for(let t=0;t<e.length-1;t++)if(o=o?`${o}/${e[t]}`:e[t],r.ignores(o)||r.ignores(`${o}/`))return"exclude"}return o?"exclude":"include"};return Object.defineProperty(t,"name",{value:"gitIgnoreFilter",writable:!0}),t}createEveIgnoreFilter(e){const t=async t=>{if(""===t.path)return"include";return(await this.getEveIgnoreInstance(e)).ignores(t.path)?"exclude":"include"};return Object.defineProperty(t,"name",{value:"eveIgnoreFilter",writable:!0}),t}createEveIncludeFilter(e){const t=async t=>{if(""===t.path)return"include";const r=await this.getEveIncludePatterns(e);if(0===r.length)return"include";for(const e of r)if(this.matchesPattern(t.path,e))return"include";for(const e of r){const r=e.endsWith("/")?e:`${e}/`;if(t.path.startsWith(r.substring(0,r.length-1))||`${t.path}/`.startsWith(r))return"include"}if(t.isDir)for(const e of r)if(e.startsWith(`${t.path}/`))return"include";return"exclude"};return Object.defineProperty(t,"name",{value:"eveIncludeFilter",writable:!0}),t}matchesPattern(e,t){return t.endsWith("/")&&!e.endsWith("/")&&(e=`${e}/`),(0,g.minimatch)(e,t,{dot:!0})}};t.IgnoreConfigService=y,t.IgnoreConfigService=y=n=a([(0,u.Injectable)(),l("design:paramtypes",[])],y)},37607:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoredFile=void 0;const o=r(59100);t.StoredFile=class{constructor(e,t,r,n,s,i=(0,o.ulid)(),a=new Date){this.id=i,this.originalFilename=e,this.fileContents=t,this.mimeType=r,this.sessionId=n,this.workspaceName=s,this.createdAt=a}}},37886:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},37916:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.GeminiAdapter=void 0;const s=r(3563),i=r(91926),a=r(59100),c=r(15562);let l=class{constructor(e){this.provider=e,this.id="gemini",this.name="Google Gemini"}getProvider(){return this.provider}getModelClient(e){return this.provider.getModelClient(e)}toProviderFormat(e){return e.map((e=>(0,c.convertEveMessageToGemini)(e)))}fromProviderFormat(e){return e.map((e=>{const t=[];if(e.parts&&Array.isArray(e.parts))for(const r of e.parts)if("text"in r&&r.text){const e=r.text.match(/\[Thinking:(.*?)\]/s);if(e){t.push({type:"thinking",content:e[1].trim(),metadata:{}});const o=r.text.replace(/\[Thinking:.*?\]/s,"").trim();o&&t.push({type:"text",content:o})}else t.push({type:"text",content:r.text})}else"inlineData"in r&&r.inlineData&&t.push({type:"other",content:"[Image data]",metadata:{providerSpecificType:"image",mimeType:r.inlineData.mimeType,data:r.inlineData.data}});else"string"==typeof e.parts&&t.push({type:"text",content:e.parts});return{id:(0,a.ulid)(),taskId:"",role:"model"===e.role?"assistant":"user",segments:t,providerId:"gemini",providerMetadata:{format:"structured"},createdAt:new Date}}))}extractMetadata(e){return{format:"structured"}}supportsThinking(){return!1}supportsFormatConversion(e){return!0}};t.GeminiAdapter=l,t.GeminiAdapter=l=o([(0,s.Injectable)(),n("design:paramtypes",[i.GeminiProvider])],l)},37978:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DIFF_REGEX_PATTERN=t.ERROR_MESSAGES=t.ERROR_TYPES=t.DIFF_MARKERS=void 0,t.DIFF_MARKERS={SEARCH_START:"<<<<<<< SEARCH",SEPARATOR:"=======",REPLACE_END:">>>>>>> REPLACE"},t.ERROR_TYPES={DIFF_PARSE_ERROR_NO_BLOCKS:"DIFF_PARSE_ERROR_NO_BLOCKS",DIFF_PARSE_ERROR_TRAILING_TEXT:"DIFF_PARSE_ERROR_TRAILING_TEXT",DIFF_PARSE_ERROR_INCOMPLETE:"DIFF_PARSE_ERROR_INCOMPLETE",DIFF_APPLY_ERROR_NOT_FOUND:"DIFF_APPLY_ERROR_NOT_FOUND"},t.ERROR_MESSAGES={EMPTY_DIFF:"Invalid or empty diff format. Expected one or more SEARCH/REPLACE blocks.",INVALID_FORMAT:"Invalid diff format: Unexpected content found after the last REPLACE block",INCOMPLETE_DIFF:"Incomplete diff format: Found SEARCH marker but missing REPLACE marker",SEARCH_NOT_FOUND:"Search block not found in the current file content."},t.DIFF_REGEX_PATTERN="<<<<<<< SEARCH\\n([\\s\\S]*?)\\n=======\\n([\\s\\S]*?)\\n>>>>>>> REPLACE"},38182:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmartToolCallTracker=void 0;t.SmartToolCallTracker=class{constructor(){this.reset()}reset(){this.state={hasSeenAnyTool:!1,readFileCallCount:0,firstToolCallName:null,firstNonReadFileToolName:null,shouldInterrupt:!1,interruptionReason:null}}getState(){return{...this.state}}isReadFileTool(e){return"read_file"===e}generateInterruptionMessage(e,t){return`Response interrupted: Only one tool may be used per message. The first tool call (${e}) has been processed. Please assess its result before using additional tools.`}checkToolCall(e){return this.state.shouldInterrupt?{action:"interrupt",reason:this.state.interruptionReason}:this.state.hasSeenAnyTool?this.isReadFileTool(e)?this.state.firstNonReadFileToolName?(this.state.shouldInterrupt=!0,this.state.interruptionReason=this.generateInterruptionMessage(this.state.firstToolCallName,e),{action:"interrupt",reason:this.state.interruptionReason}):(this.state.readFileCallCount++,{action:"continue"}):this.state.firstNonReadFileToolName||this.state.readFileCallCount>0?(this.state.shouldInterrupt=!0,this.state.interruptionReason=this.generateInterruptionMessage(this.state.firstToolCallName,e),{action:"interrupt",reason:this.state.interruptionReason}):(this.state.firstNonReadFileToolName=e,{action:"continue"}):(this.state.hasSeenAnyTool=!0,this.state.firstToolCallName=e,this.isReadFileTool(e)?this.state.readFileCallCount=1:this.state.firstNonReadFileToolName=e,{action:"continue"})}}},38547:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SourceArtefact=void 0;t.SourceArtefact=class{constructor(e){Object.assign(this,e)}}},38610:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.EpicsService=void 0;const s=r(3563),i=r(45762),a=r(50251),c=r(57655),l=r(19615);let d=class{constructor(e){this.epicRepository=e}async getRequirements(e,t){return this.epicRepository.getRequirements(e,t)}async updateRequirements(e,t,r){return this.epicRepository.updateRequirements(e,t,r)}async findAllEpics(e){return this.epicRepository.findAllByWorkspace(e)}async findEpicById(e,t){const r=await this.epicRepository.findById(e,t);if(!r)throw new Error(`Epic with id ${t} not found`);return r}async createEpic(e,t,r){const o=new a.Epic(t,r,e);return this.epicRepository.create(o)}async updateEpic(e,t,r,o){const n=await this.findEpicById(e,t);return n.title=r,n.description=o,n.updatedAt=new Date,this.epicRepository.update(n)}async deleteEpic(e,t){await this.epicRepository.delete(e,t)}async addStory(e,t,r,o,n){const s=new c.Story(r,o,n);return this.epicRepository.addStory(e,t,s)}async updateStory(e,t,r,o,n,s){const i=(await this.findEpicById(e,t)).stories.find((e=>e.id===r));if(!i)throw new Error(`Story with id ${r} not found`);return i.title=o,i.description=n,i.acceptanceCriteria=s,i.updatedAt=new Date,this.epicRepository.updateStory(e,t,i)}async deleteStory(e,t,r){await this.epicRepository.deleteStory(e,t,r)}async getStory(e,t,r){return this.epicRepository.getStory(e,t,r)}async addTask(e,t,r,o,n){const s=new l.Task(o,n);return this.epicRepository.addTask(e,t,r,s)}async updateTask(e,t,r,o,n,s,i){const a=new l.Task(n,s,i,o);return a.updatedAt=new Date,this.epicRepository.updateTask(e,t,r,a)}async deleteTask(e,t,r,o){await this.epicRepository.deleteTask(e,t,r,o)}async getTasks(e,t,r){if(!(await this.findEpicById(e,t)).stories.find((e=>e.id===r)))throw new Error(`Story with id ${r} not found`);return this.epicRepository.getTasks(e,t,r)}async getTask(e,t,r,o){if(!(await this.findEpicById(e,t)).stories.find((e=>e.id===r)))throw new Error(`Story with id ${r} not found`);return this.epicRepository.getTask(e,t,r,o)}};t.EpicsService=d,t.EpicsService=d=o([(0,s.Injectable)(),n("design:paramtypes",[i.FileSystemEpicRepository])],d)},39023:e=>{"use strict";e.exports=require("util")},39421:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CustomPersonaController=void 0;const a=r(3563),c=r(726),l=r(56292),d=r(19668),u=r(43510),p=i(r(19055));let f=class{constructor(e,t,r,o){this.customPersonaService=e,this.personaRegistry=t,this.userService=r,this.personaAssemblerService=o,this.serviceName="CustomPersonaController"}async getUserCustomPersonas(e){try{const e=await this.userService.getCurrentUser(),t=await this.customPersonaService.findByUser(e.userId);return p.default.debug(`[${this.serviceName}] Retrieved ${t.length} custom personas for user: ${e.userId}`),t}catch(e){if(e instanceof d.AuthenticationError)throw p.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw p.default.error(`[${this.serviceName}] Failed to get custom personas: ${e.message}`,e.stack),new Error(`Failed to retrieve custom personas: ${e.message}`)}}async getAvailableTools(){try{const e=this.customPersonaService.getAllToolNames();return p.default.debug(`[${this.serviceName}] Retrieved ${e.length} available tool names`),e}catch(e){throw p.default.error(`[${this.serviceName}] Failed to get available tools: ${e.message}`,e.stack),new Error(`Failed to retrieve available tools: ${e.message}`)}}async getAvailableComponents(){try{const e=this.personaAssemblerService.getAllComponentsForUI();return p.default.debug(`[${this.serviceName}] Retrieved ${e.length} available prompt components`),e}catch(e){throw p.default.error(`[${this.serviceName}] Failed to get available components: ${e.message}`,e.stack),new Error(`Failed to retrieve available components: ${e.message}`)}}async createCustomPersona(e,t){try{const e=await this.userService.getCurrentUser(),r=await this.customPersonaService.create(e.userId,t);return this.personaRegistry.invalidateCustomPersonasCache(e.userId),p.default.info(`[${this.serviceName}] Created custom persona: ${r.name} (ID: ${r.id}) for user: ${e.userId}`),r}catch(e){if(e instanceof d.AuthenticationError)throw p.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw p.default.error(`[${this.serviceName}] Failed to create custom persona: ${e.message}`,e.stack),new Error(`Failed to create custom persona: ${e.message}`)}}async updateCustomPersona(e,t,r){try{const e=await this.userService.getCurrentUser(),o=await this.customPersonaService.update(t,e.userId,r);return this.personaRegistry.invalidateCustomPersonasCache(e.userId),p.default.info(`[${this.serviceName}] Updated custom persona: ${t} for user: ${e.userId}`),o}catch(e){if(e instanceof d.AuthenticationError)throw p.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw p.default.error(`[${this.serviceName}] Failed to update custom persona: ${e.message}`,e.stack),new Error(`Failed to update custom persona: ${e.message}`)}}async deleteCustomPersona(e,t){try{const e=await this.userService.getCurrentUser();await this.customPersonaService.delete(t,e.userId),this.personaRegistry.invalidateCustomPersonasCache(e.userId),p.default.info(`[${this.serviceName}] Deleted custom persona: ${t} for user: ${e.userId}`)}catch(e){if(e instanceof d.AuthenticationError)throw p.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw p.default.error(`[${this.serviceName}] Failed to delete custom persona: ${e.message}`,e.stack),new Error(`Failed to delete custom persona: ${e.message}`)}}async getCustomPersona(e,t){try{const e=await this.userService.getCurrentUser(),r=await this.customPersonaService.findById(t,e.userId);if(!r)throw new Error("Custom persona not found");return p.default.debug(`[${this.serviceName}] Retrieved custom persona: ${t} for user: ${e.userId}`),r}catch(e){if(e instanceof d.AuthenticationError)throw p.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw p.default.error(`[${this.serviceName}] Failed to get custom persona: ${e.message}`,e.stack),new Error(`Failed to retrieve custom persona: ${e.message}`)}}async copyPersona(e,t,r){try{const e=await this.userService.getCurrentUser(),o=await this.customPersonaService.copy(t,e.userId,r.name);return this.personaRegistry.invalidateCustomPersonasCache(e.userId),p.default.info(`[${this.serviceName}] Copied persona ${t} to new persona: ${o.name} (ID: ${o.id}) for user: ${e.userId}`),o}catch(e){if(e instanceof d.AuthenticationError)throw p.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw p.default.error(`[${this.serviceName}] Failed to copy persona: ${e.message}`,e.stack),new Error(`Failed to copy persona: ${e.message}`)}}};t.CustomPersonaController=f,o([(0,a.Get)(""),s(0,(0,a.Req)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],f.prototype,"getUserCustomPersonas",null),o([(0,a.Get)("tools"),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],f.prototype,"getAvailableTools",null),o([(0,a.Get)("components"),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],f.prototype,"getAvailableComponents",null),o([(0,a.Post)(""),s(0,(0,a.Req)()),s(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object,Object]),n("design:returntype",Promise)],f.prototype,"createCustomPersona",null),o([(0,a.Put)(":id"),s(0,(0,a.Req)()),s(1,(0,a.Param)("id")),s(2,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object,String,Object]),n("design:returntype",Promise)],f.prototype,"updateCustomPersona",null),o([(0,a.Delete)(":id"),(0,a.HttpCode)(a.HttpStatus.NO_CONTENT),s(0,(0,a.Req)()),s(1,(0,a.Param)("id")),n("design:type",Function),n("design:paramtypes",[Object,String]),n("design:returntype",Promise)],f.prototype,"deleteCustomPersona",null),o([(0,a.Get)(":id"),s(0,(0,a.Req)()),s(1,(0,a.Param)("id")),n("design:type",Function),n("design:paramtypes",[Object,String]),n("design:returntype",Promise)],f.prototype,"getCustomPersona",null),o([(0,a.Post)(":id/copy"),s(0,(0,a.Req)()),s(1,(0,a.Param)("id")),s(2,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object,String,Object]),n("design:returntype",Promise)],f.prototype,"copyPersona",null),t.CustomPersonaController=f=o([(0,a.Controller)("eve/config/custom-personas"),n("design:paramtypes",[c.CustomPersonaService,l.PersonaRegistry,d.UserService,u.PersonaAssemblerService])],f)},39578:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AutocompleteRequestManagerService=void 0;const a=r(3563),c=i(r(19055));let l=o=class{constructor(){this.activeRequests=new Map,this.REQUEST_TIMEOUT_MS=3e3,this.CLEANUP_INTERVAL_MS=3e4,this.cleanupInterval=null,c.default.info(`[${o.name}] AutocompleteRequestManagerService initialized`),this.cleanupInterval=setInterval((()=>{this.cleanupOldRequests()}),this.CLEANUP_INTERVAL_MS)}async search(e,t,r,n){const s=this.createRequestKey(e,t,r),i=this.activeRequests.get(s);if(i)return c.default.debug(`[${o.name}] Returning existing request for key: ${s}`),i.promise;const a=this.createTimeoutProtectedRequest(n,s);this.activeRequests.set(s,{promise:a,timestamp:new Date});try{const e=await a;return c.default.debug(`[${o.name}] Completed request for key: ${s}, results: ${e.length}`),e}finally{this.activeRequests.delete(s)}}getStatus(){const e=Date.now();let t=null;for(const r of this.activeRequests.values()){const o=e-r.timestamp.getTime();(null===t||o>t)&&(t=o)}return{activeRequestCount:this.activeRequests.size,oldestRequestAge:t}}cancelAllRequests(){c.default.info(`[${o.name}] Cancelling ${this.activeRequests.size} active requests`),this.activeRequests.clear()}createRequestKey(e,t,r){return[e,t,r.workspaceName||"no-workspace",r.userId||"no-user",r.mode||"no-mode"].join("|")}async createTimeoutProtectedRequest(e,t){const r=e(),{promise:o,timeoutId:n}=this.createTimeoutPromise(t);try{const e=await Promise.race([r,o]);return clearTimeout(n),e}catch(e){throw clearTimeout(n),e}}createTimeoutPromise(e){let t;return{promise:new Promise((r=>{t=setTimeout((()=>{c.default.warn(`[${o.name}] Request timed out after ${this.REQUEST_TIMEOUT_MS}ms for key: ${e}`),r([])}),this.REQUEST_TIMEOUT_MS)})),timeoutId:t}}cleanupOldRequests(){const e=Date.now(),t=2*this.REQUEST_TIMEOUT_MS;let r=0;for(const[o,n]of this.activeRequests.entries()){e-n.timestamp.getTime()>t&&(this.activeRequests.delete(o),r++)}r>0&&c.default.debug(`[${o.name}] Cleaned up ${r} old requests`)}async onModuleDestroy(){c.default.info(`[${o.name}] Cleaning up autocomplete request manager...`),this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null,c.default.debug(`[${o.name}] Cleared cleanup interval`)),this.cancelAllRequests()}};t.AutocompleteRequestManagerService=l,t.AutocompleteRequestManagerService=l=o=n([(0,a.Injectable)(),s("design:paramtypes",[])],l)},39690:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},39774:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FireworksProvider=void 0;const i=r(3563),a=r(36206),c=r(91760),l=r(78706),d=r(91386),u=r(86997),p=s(r(19055));let f=class{constructor(e,t){this.providerRegistry=e,this.openSourceModelRegistry=t,this.config={providerId:u.FIREWORKS_PROVIDER_ID,name:"Fireworks.ai",description:"Fireworks.ai open source models with fast inference",website:"https://fireworks.ai",docsLink:"https://docs.fireworks.ai",baseUrl:"https://api.fireworks.ai/inference/v1",apiKeyName:"FIREWORKS_API_KEY",defaultModelId:(0,u.getDefaultFireworksModelId)(),modelDiscovery:"api",features:{supportsStreaming:!0,supportsCaching:!0,supportsTools:!0,supportsImages:!0}},p.default.info("[FireworksProvider] Initialized"),this.providerRegistry.registerProvider(this)}getId(){return this.config.providerId}getName(){return this.config.name}getMetadata(){return{website:this.config.website,docs_link:this.config.docsLink,api_version:"v1",default_base_url:this.config.baseUrl}}requiresApiKey(){return!0}getDefaultBaseUrl(){return this.config.baseUrl}getDefaultModelId(){return this.config.defaultModelId}getApiKeyName(){return this.config.apiKeyName}getModelClient(e){const t={...e,baseUrl:e.baseUrl||this.config.baseUrl},r=new l.OpenAIModelClient(t,{enableVerboseLogging:!1});return this.discoverModels(e.apiKey,t.baseUrl).then((t=>{const o=t.find((t=>t.modelId===e.modelId));o?r.setModelMetadata(o):p.default.warn(`[FireworksProvider] Metadata not found for model ${e.modelId}`)})).catch((e=>{p.default.warn(`[FireworksProvider] Failed to discover models: ${e.message}`)})),r}getProviderMetadata(){return d.OpenAICompatibleUtils.createProviderMetadata(this.config)}getStaticModels(){return[]}async discoverDynamicModels(e,t){const r=t||this.config.baseUrl;return{models:await(0,u.discoverFireworksModels)(e,r,this.openSourceModelRegistry),discoveredAt:new Date,discoveryMethod:"api",source:r}}requiresApiKeyForDiscovery(){return!0}async discoverModels(e,t){return(0,u.discoverFireworksModels)(e,t||this.config.baseUrl,this.openSourceModelRegistry)}};t.FireworksProvider=f,t.FireworksProvider=f=o([(0,i.Injectable)(),n("design:paramtypes",[a.ProviderRegistry,c.OpenSourceModelRegistryService])],f)},39863:e=>{"use strict";e.exports=require("xpath")},39976:(e,t,r)=>{"use strict";const o=r(16928),n=r(44170),s=r(41256);function i(e,t){const r=e.options.env||process.env,i=process.cwd(),a=null!=e.options.cwd,c=a&&void 0!==process.chdir&&!process.chdir.disabled;if(c)try{process.chdir(e.options.cwd)}catch(e){}let l;try{l=n.sync(e.command,{path:r[s({env:r})],pathExt:t?o.delimiter:void 0})}catch(e){}finally{c&&process.chdir(i)}return l&&(l=o.resolve(a?e.options.cwd:"",l)),l}e.exports=function(e){return i(e)||i(e,!0)}},40305:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_THINKING_TOKENS=t.DEFAULT_THINKING_TOKENS=t.DEFAULT_ANTHROPIC_MODEL_ID=t.ANTHROPIC_PROVIDER_ID=void 0,t.getStaticAnthropicModels=s,t.discoverAnthropicModels=async function(e,t){return n.default.info("[AnthropicProvider] Using static model list"),s()};const n=o(r(19055));function s(){return[{modelId:"claude-opus-4-20250514",providerId:t.ANTHROPIC_PROVIDER_ID,name:"Claude Opus 4",contextWindow:2e5,maxOutputTokens:64e3,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!0,supportsPromptCache:!0,supportsThinkingTokens:!0,supportsCancellation:!0,recommendedThinkingTokens:t.DEFAULT_THINKING_TOKENS,maxThinkingTokens:t.MAX_THINKING_TOKENS,inputCostPerMillionTokens:15,outputCostPerMillionTokens:30,cacheWritesPrice:18.75,cacheReadsPrice:1.5,editToolCapabilities:{supportedDiffFormats:["json","traditional"],preferredDiffFormat:"json",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!0,supportsOutOfOrderBlocks:!0,requiresEnhancedErrorMessages:!0},metadata:{description:"Claude Opus 4 is Anthropic's most powerful model, with state-of-the-art performance across reasoning, coding, and problem-solving tasks.",extraHeaders:{"anthropic-beta":"prompt-caching-2024-07-31"}}},{modelId:"claude-sonnet-4-20250514",providerId:t.ANTHROPIC_PROVIDER_ID,name:"Claude Sonnet 4",contextWindow:2e5,maxOutputTokens:64e3,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!0,supportsPromptCache:!0,supportsThinkingTokens:!0,supportsCancellation:!0,recommendedThinkingTokens:t.DEFAULT_THINKING_TOKENS,maxThinkingTokens:t.MAX_THINKING_TOKENS,inputCostPerMillionTokens:3,outputCostPerMillionTokens:15,cacheWritesPrice:3.75,cacheReadsPrice:.3,editToolCapabilities:{supportedDiffFormats:["json","traditional"],preferredDiffFormat:"json",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!0,supportsOutOfOrderBlocks:!0,requiresEnhancedErrorMessages:!0},metadata:{description:"Claude Sonnet 4 offers strong performance for a wide range of tasks with improved reasoning and problem-solving capabilities.",extraHeaders:{"anthropic-beta":"prompt-caching-2024-07-31"}}},{modelId:"claude-3-7-sonnet-20250219",providerId:t.ANTHROPIC_PROVIDER_ID,name:"Claude 3.7 Sonnet",contextWindow:2e5,maxOutputTokens:64e3,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!0,supportsPromptCache:!0,supportsThinkingTokens:!0,supportsCancellation:!0,recommendedThinkingTokens:t.DEFAULT_THINKING_TOKENS,maxThinkingTokens:t.MAX_THINKING_TOKENS,inputCostPerMillionTokens:3,outputCostPerMillionTokens:15,cacheWritesPrice:3.75,cacheReadsPrice:.3,isDefaultForProvider:!0,editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1},metadata:{description:"Claude 3.7 Sonnet is an advanced large language model with improved reasoning, coding, and problem-solving capabilities.",extraHeaders:{"output-128k-2025-02-19":"true","anthropic-beta":"prompt-caching-2024-07-31"}}},{modelId:"claude-3-5-sonnet-20241022",providerId:t.ANTHROPIC_PROVIDER_ID,name:"Claude 3.5 Sonnet",contextWindow:2e5,maxOutputTokens:8192,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!0,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsCancellation:!0,inputCostPerMillionTokens:3,outputCostPerMillionTokens:15,cacheWritesPrice:3.75,cacheReadsPrice:.3,editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1},metadata:{description:"Claude 3.5 Sonnet offers strong performance for a wide range of tasks.",extraHeaders:{"anthropic-beta":"prompt-caching-2024-07-31"}}},{modelId:"claude-3-5-haiku-20241022",providerId:t.ANTHROPIC_PROVIDER_ID,name:"Claude 3.5 Haiku",contextWindow:2e5,maxOutputTokens:8192,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsCancellation:!0,inputCostPerMillionTokens:.8,outputCostPerMillionTokens:4,cacheWritesPrice:1,cacheReadsPrice:.08,metadata:{description:"Claude 3.5 Haiku is a faster, more affordable model for simpler tasks.",extraHeaders:{"anthropic-beta":"prompt-caching-2024-07-31"}}},{modelId:"claude-3-opus-20240229",providerId:t.ANTHROPIC_PROVIDER_ID,name:"Claude 3 Opus",contextWindow:2e5,maxOutputTokens:8192,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsCancellation:!0,inputCostPerMillionTokens:15,outputCostPerMillionTokens:75,cacheWritesPrice:18.75,cacheReadsPrice:1.5,metadata:{description:"Claude 3 Opus is Anthropic's most powerful model, with state-of-the-art performance.",extraHeaders:{"anthropic-beta":"prompt-caching-2024-07-31"}}}]}t.ANTHROPIC_PROVIDER_ID="anthropic",t.DEFAULT_ANTHROPIC_MODEL_ID="claude-3-7-sonnet-20250219",t.DEFAULT_THINKING_TOKENS=1024,t.MAX_THINKING_TOKENS=1e4},40646:e=>{"use strict";e.exports=require("@langchain/anthropic")},40715:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AppModule=void 0;const i=r(3563),a=r(42810),c=r(16928),l=r(86808),d=r(45873),u=r(23880),p=r(72177),f=r(69449),h=r(3177),m=r(83049),g=r(376),y=r(57967),v=r(41901),_=r(70361),w=r(48221),b=r(57852),k=r(29161),S=r(84193),T=r(60756),R=r(76552),C=r(48624),P=r(8377),E=r(91367),I=r(72776),O=s(r(19055));let $=class{constructor(e){this.appDataSource=e}async onModuleDestroy(){O.default.info("AppModule onModuleDestroy called.."),await this.appDataSource.close()}};t.AppModule=$,t.AppModule=$=o([(0,i.Module)({imports:[a.ServeStaticModule.forRoot({rootPath:(0,c.join)(__dirname,"..","..","vitify-webui","dist"),exclude:["/api*"]}),g.DataSourceModule,l.HelloWorldModule,d.WorkspaceModule,u.SessionModule,p.AgentsModule,f.LangchainModule,h.MutationsModule,m.AudioTranscriptionModule,y.ConfigModule,v.GitModule,_.ToolsModule,w.ReportingModule,b.SourceArtefactModule,k.ChatCompletionModule,S.HomeModule,T.PluginModule,R.DatasetModule,C.StoredFileModule,P.EpicsModule,E.EveAgentModule],providers:[{provide:I.AppDataSource,useFactory:I.getAppDataSource}]}),n("design:paramtypes",[I.AppDataSource])],$)},40724:e=>{"use strict";e.exports=require("@langchain/core/output_parsers")},40758:e=>{"use strict";e.exports=require("puppeteer")},40791:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GeminiChunkAdapter=void 0;const i=r(3563),a=r(18448),c=r(55705),l=s(r(19055)),d=r(96297);let u=class{constructor(){this.chunkCount=0,l.default.debug("[GeminiChunkAdapter] Initialized for new @google/genai SDK")}convertChunk(e){this.chunkCount++,d.debugLogger.dumpObject(`Raw Gemini chunk #${this.chunkCount}`,e);const t=[],r=this.extractTextContent(e);r&&t.push({type:a.NormalizedChunkType.TEXT,content:r,originalContent:r});const o=this.extractFinishReason(e);return o&&t.push({type:a.NormalizedChunkType.STOP,stopReason:this.mapStopReason(o),metadata:{originalStopReason:o,chunkSource:"gemini"}}),t}mapStopReason(e){if(!e)return c.NormalizedStopReason.COMPLETE;switch(e.toUpperCase()){case"STOP":return c.NormalizedStopReason.COMPLETE;case"MAX_TOKENS":case"LENGTH":return c.NormalizedStopReason.MAX_TOKENS;case"SAFETY":case"RECITATION":return c.NormalizedStopReason.CONTENT_FILTER;default:return l.default.warn(`[GeminiChunkAdapter] Unknown stop reason: ${e}`),c.NormalizedStopReason.ERROR}}isStreamComplete(e){return!!this.extractFinishReason(e)}extractError(e){const t=this.extractFinishReason(e);return"SAFETY"===t?new Error("Content filtered due to safety policies"):"RECITATION"===t?new Error("Content filtered due to recitation policies"):null}extractTextContent(e){if(e.candidates?.[0]?.content?.parts){return e.candidates[0].content.parts.filter((e=>e.text)).map((e=>e.text)).join("")||""}return""}extractFinishReason(e){return e.candidates?.[0]?.content?.finishReason?e.candidates[0].content.finishReason:e.candidates?.[0]?.finishReason?e.candidates[0].finishReason:null}};t.GeminiChunkAdapter=u,t.GeminiChunkAdapter=u=o([(0,i.Injectable)(),n("design:paramtypes",[])],u)},41070:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TreeSitterCacheService=void 0;const u=r(3563),p=c(r(91943)),f=c(r(16928)),h=d(r(19055));let m=n=class{constructor(){h.default.info(`[${n.name}] TreeSitterCacheService initialized`)}async getCachedDefinitions(e,t,r,o){try{const s=this.getCacheFilePath(e,t);try{await p.access(s)}catch{return null}const i=await p.readFile(s,"utf8"),a=JSON.parse(i);return a.mtime===r&&a.size===o?(h.default.debug(`[${n.name}] Cache hit for ${t}`),a.definitions):(h.default.debug(`[${n.name}] Cache invalid for ${t} (mtime/size mismatch)`),null)}catch(e){return h.default.warn(`[${n.name}] Error reading cache for ${t}: ${e.message}`),null}}async setCachedDefinitions(e,t,r,o,s){try{const i=this.getCacheFilePath(e,t);await this.ensureCacheDirectory(i);const a=f.extname(t).toLowerCase().slice(1),c={filePath:f.relative(e,t),mtime:r,size:o,definitions:s,cachedAt:Date.now(),language:a};await p.writeFile(i,JSON.stringify(c,null,2),"utf8"),h.default.debug(`[${n.name}] Cached definitions for ${t}`)}catch(e){h.default.warn(`[${n.name}] Error caching definitions for ${t}: ${e.message}`)}}getCacheFilePath(e,t){const r=f.relative(e,t),o=f.join(e,".eve","treesitter-cache");return f.join(o,r+".json")}async ensureCacheDirectory(e){const t=f.dirname(e);await p.mkdir(t,{recursive:!0})}async cleanupStaleEntries(e,t=6048e5){try{const r=f.join(e,".eve","treesitter-cache"),o=Date.now()-t;await this.cleanupDirectory(r,o),h.default.info(`[${n.name}] Cleaned up stale cache entries older than ${t}ms`)}catch(e){h.default.warn(`[${n.name}] Error during cache cleanup: ${e.message}`)}}async cleanupDirectory(e,t){try{const r=await p.readdir(e,{withFileTypes:!0});for(const o of r){const r=f.join(e,o.name);if(o.isDirectory()){await this.cleanupDirectory(r,t);try{0===(await p.readdir(r)).length&&await p.rmdir(r)}catch{}}else if(o.isFile()&&o.name.endsWith(".json"))try{const e=await p.readFile(r,"utf8");JSON.parse(e).cachedAt<t&&(await p.unlink(r),h.default.debug(`[${n.name}] Removed stale cache file: ${r}`))}catch{await p.unlink(r)}}}catch(e){}}};t.TreeSitterCacheService=m,t.TreeSitterCacheService=m=n=a([(0,u.Injectable)(),l("design:paramtypes",[])],m)},41256:e=>{"use strict";const t=(e={})=>{const t=e.env||process.env;return"win32"!==(e.platform||process.platform)?"PATH":Object.keys(t).reverse().find((e=>"PATH"===e.toUpperCase()))||"Path"};e.exports=t,e.exports.default=t},41901:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.GitModule=void 0;const n=r(3563),s=r(7265),i=r(15190),a=r(45873);let c=class{};t.GitModule=c,t.GitModule=c=o([(0,n.Module)({imports:[a.WorkspaceModule],controllers:[s.GitController],providers:[i.GitService]})],c)},42808:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIMessageTransformer=void 0;const n=r(12008),s=r(59100),i=o(r(19055));t.OpenAIMessageTransformer=class{constructor(){this.serviceName="OpenAIMessageTransformer"}toProviderFormat(e){i.default.debug(`[${this.serviceName}] Converting ${e.length} messages to OpenAI format`);const t=[];for(const r of e){const e=(0,n.convertEveMessageToOpenAIAPI)(r);t.push(...e)}return i.default.debug(`[${this.serviceName}] Converted to ${t.length} OpenAI messages`),t}fromProviderFormat(e,t){i.default.debug(`[${this.serviceName}] Converting ${e.length} OpenAI messages to interchange format`);const r=[];for(const o of e){const e=this.convertSingleMessage(o,t);e&&r.push(e)}return i.default.debug(`[${this.serviceName}] Converted to ${r.length} interchange messages`),r}convertSingleMessage(e,t){const r=(0,s.ulid)(),o=new Date;switch(e.role){case"user":return this.convertUserMessage(e,r,t,o);case"assistant":return this.convertAssistantMessage(e,r,t,o);case"tool":return this.convertToolMessage(e,r,t,o);case"system":return i.default.debug(`[${this.serviceName}] Skipping system message conversion`),null;default:return i.default.warn(`[${this.serviceName}] Unknown message role: ${e.role}`),null}}convertUserMessage(e,t,r,o){const n=[];if("string"==typeof e.content)n.push({type:"text",content:e.content});else if(Array.isArray(e.content))for(const t of e.content)"text"===t.type?n.push({type:"text",content:t.text}):"image_url"===t.type&&n.push({type:"image",content:t.image_url.url,metadata:{url:t.image_url.url,mediaType:"image"}});return{id:t,taskId:r,role:"user",segments:n,providerId:"openai",providerMetadata:{format:"openai-api"},createdAt:o}}convertAssistantMessage(e,t,r,o){const n=[];if(e.content){let t="";"string"==typeof e.content?t=e.content:Array.isArray(e.content)&&(t=e.content.filter((e=>"text"===e.type)).map((e=>e.text)).join("\n")),t&&n.push({type:"text",content:t})}if(e.tool_calls)for(const t of e.tool_calls)if("function"===t.type){const e=`<${t.function.name}>${t.function.arguments}</${t.function.name}>`;n.push({type:"tool_code",content:e,metadata:{providerSpecificType:"function_call",toolCallId:t.id}})}const s={format:"openai-api"};return e.tool_calls&&(s.rawToolCalls=e.tool_calls),{id:t,taskId:r,role:"assistant",segments:n,providerId:"openai",providerMetadata:s,createdAt:o}}convertToolMessage(e,t,r,o){const n=[];let s="";"string"==typeof e.content?s=e.content:Array.isArray(e.content)&&(s=e.content.filter((e=>"text"===e.type)).map((e=>e.text)).join("\n")),n.push({type:"tool_result",content:s||"",metadata:{toolCallId:e.tool_call_id}});return{id:t,taskId:r,role:"assistant",segments:n,providerId:"openai",providerMetadata:{format:"openai-api",toolCallId:e.tool_call_id},createdAt:o}}}},42810:e=>{"use strict";e.exports=require("@nestjs/serve-static")},42929:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PylintValidator=void 0;const s=r(3563),i=r(72609);let a=class extends i.BaseCommandLineValidator{constructor(){super({name:"Pylint",command:"pylint --output-format=text {filePath}",fileExtensions:["py"],issuePattern:/(?<filePath>[^:]+):(?<line>\d+):(?<column>\d+): (?<code>[A-Z]\d+): (?<message>.+)/g,priority:30})}hasValidationErrors(e,t,r){return 0!==r||this.config.issuePattern.test(e)||this.config.issuePattern.test(t)}formatValidationReport(e,t){return e||t}checkForSyntaxErrors(e){return e.includes("    ")&&e.includes("  def ")||e.includes("def ")&&!e.includes("def ")||(e.match(/\(/g)||[]).length!==(e.match(/\)/g)||[]).length||e.includes("import")&&e.includes("ImportError")}};t.PylintValidator=a,t.PylintValidator=a=o([(0,s.Injectable)(),n("design:paramtypes",[])],a)},42992:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TypeScriptValidator=void 0;const d=r(3563),u=r(72609),p=l(r(19055)),f=r(79086),h=a(r(16928)),m=a(r(91943));let g=class extends u.BaseCommandLineValidator{constructor(){super({name:"TypeScript",command:"tsc --noEmit --pretty false",fileExtensions:["ts","tsx"],issuePattern:/([^:]+):(\d+):(\d+) - (error|warning) ([^:]+): (.+)/g,priority:10}),this.checkCommandAvailability()}async checkCommandAvailability(){try{const e=this.config.command.split(" ")[0],{stdout:t,stderr:r}=await(0,f.execCommand)(`command -v ${e}`),o=`${t.trim()} ${r.trim()}`.trim();p.default.info(`[${this.constructor.name}] Checking Availability Ran: 'command -v ${e}' - ${o}`);!t.trim()||t.includes("not found")||t.includes("no such file")||r.includes("not found")||r.includes("no such file")?(this.enabled=!1,p.default.warn(`[${this.constructor.name}] Command '${e}' for validator '${this.config.name}' is not available. Validator disabled.`)):(this.enabled=!0,p.default.info(`[${this.constructor.name}] Command '${e}' is available for validator: ${this.config.name}`))}catch(e){this.enabled=!1,p.default.warn(`[${this.constructor.name}] Command for validator '${this.config.name}' is not available. Validator disabled. Error: ${e.message}`)}}hasValidationErrors(e,t,r){return 0!==r}formatValidationReport(e,t){return t||e}async findNearestTsConfig(e,t){const r=h.resolve(t,e);let o=h.dirname(r);for(;;){const e=h.join(o,"tsconfig.json");try{return await m.access(e),p.default.debug(`[${this.constructor.name}] Found tsconfig.json at ${e}`),o}catch(e){const t=h.dirname(o);if(t===o)break;o=t}}return p.default.debug(`[${this.constructor.name}] No tsconfig.json found in any parent directory of ${e}`),null}async validate(e,t,r){p.default.debug(`[${this.constructor.name}] Validating project in directory: ${r}, focusing on file: ${e}`),null!=t&&p.default.debug(`[${this.constructor.name}] Content parameter provided but will be ignored. Validating file as it exists on disk.`);const o=h.resolve(r,e);try{try{await m.access(o),p.default.debug(`[${this.constructor.name}] File ${o} exists, validating as-is.`)}catch(e){return p.default.warn(`[${this.constructor.name}] File ${o} does not exist.`),{validatorName:this.config.name,validationMethod:"File existence check",hasErrors:!0,report:`File not found for validation: ${o}`}}const t=await this.findNearestTsConfig(e,r);let n,s,i;if(t)n=this.config.command,s={cwd:t},i=`${this.config.command} (in ${t})`,p.default.debug(`[${this.constructor.name}] Found tsconfig.json at ${t}. Executing command: ${n}`);else{const t=h.isAbsolute(e)?e:h.resolve(r,e);n=`${this.config.command} ${t}`,s={cwd:r},i=`${this.config.command} ${t} (no tsconfig.json found)`,p.default.warn(`[${this.constructor.name}] No tsconfig.json found for file ${e}. Falling back to validating the single file: ${n} in ${r}`)}p.default.debug(`[${this.constructor.name}] Executing command: ${n} with options: ${JSON.stringify(s)}`);const{stdout:a,stderr:c,code:l}=await(0,f.execCommand)(n,s);p.default.debug(`[${this.constructor.name}] Command stdout: ${a}`),c&&p.default.debug(`[${this.constructor.name}] Command stderr: ${c}`);const d=this.hasValidationErrors(a,c,l),u=this.formatValidationReport(a,c);return{validatorName:this.config.name,validationMethod:i,hasErrors:d,report:u}}catch(t){return p.default.error(`[${this.constructor.name}] Error during validation in ${r} for file ${e}: ${t.message}`),{validatorName:this.config.name,validationMethod:this.config.command,hasErrors:!0,report:`Validation execution error: ${t.message}`}}}};t.TypeScriptValidator=g,t.TypeScriptValidator=g=i([(0,d.Injectable)(),c("design:paramtypes",[])],g)},43510:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PersonaAssemblerService=void 0;const i=r(3563),a=r(10646),c=s(r(19055));let l=class{constructor(e){this.componentRegistry=e}assemblePrompt(e,t,r){c.default.debug(`[PersonaAssemblerService] Assembling prompt for persona: ${e.id}`);const o=[];let n="";n+=e.corePrompt,e.specificInstructions&&(n+=`\n\n====\n\n${e.specificInstructions}`);const s=this.componentRegistry.getRequiredComponents();for(const e of s){const t=e.getContent(r);o.push({componentId:e.id,name:e.name,content:t,category:"required",isEnabled:!0}),n+=`\n\n====\n\n${t}`}const i=this.componentRegistry.getOptionalComponents();for(const e of i){const s=t.includes(e.id),i=s?e.getContent(r):"";o.push({componentId:e.id,name:e.name,content:i,category:"optional",isEnabled:s}),s&&(n+=`\n\n====\n\n${i}`)}return c.default.debug(`[PersonaAssemblerService] Assembled prompt with ${o.length} components, ${o.filter((e=>e.isEnabled)).length} enabled`),{corePersonaPrompt:e.corePrompt+(e.specificInstructions?`\n\n====\n\n${e.specificInstructions}`:""),systemComponents:o,fullPrompt:n}}getAvailableOptionalComponents(){return this.componentRegistry.getOptionalComponents().map((e=>({id:e.id,name:e.name,description:e.description,canOptOut:e.canOptOut,defaultEnabled:e.defaultEnabled})))}getDefaultEnabledOptionalComponents(){return this.componentRegistry.getDefaultEnabledOptionalComponents()}getAllComponentsForUI(){return this.componentRegistry.getAllComponents().map((e=>({id:e.id,name:e.name,description:e.description,category:e.category,canOptOut:e.canOptOut,defaultEnabled:e.defaultEnabled})))}};t.PersonaAssemblerService=l,t.PersonaAssemblerService=l=o([(0,i.Injectable)(),n("design:paramtypes",[a.ComponentRegistry])],l)},43543:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoredDoc=void 0;const o=r(59100);t.StoredDoc=class{constructor(e,t,r,n,s=(0,o.ulid)(),i=new Date){if(this.id=s,this.contents=e,this.sessionId=r,this.workspaceName=n,this.createdAt=i,t)this.mimeType=t;else try{JSON.parse(e),this.mimeType="application/json"}catch{e.trim().startsWith("<")&&e.trim().endsWith(">")?this.mimeType="text/html":this.mimeType="text/plain"}}}},44043:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagingHandler=void 0;const a=r(3563),c=i(r(19055)),l=r(96297);let d=o=class{constructor(){}handleEcho(e,t){l.debugLogger.log(`Received echo message from client ${t.id}`),c.default.info(`[${o.name}] Received echo message from client ${t.id}: ${JSON.stringify(e)}`);const r={event:"echo",data:e};return t.emit("echo",r),r}};t.MessagingHandler=d,t.MessagingHandler=d=o=n([(0,a.Injectable)(),s("design:paramtypes",[])],d)},44155:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ResponseFormatterService=void 0;const c=r(3563),l=a(r(16928));let d=class{duplicateFileReadNotice(){return"[[NOTE] This file read has been removed to save space in the context window. Refer to the latest file read for the most up to date version of this file.]"}contextTruncationNotice(){return"[NOTE] Some previous conversation history with the user has been removed to maintain optimal context window length. The initial user task and the most recent exchanges have been retained for continuity, while intermediate conversation history has been removed. Please keep this in mind as you continue assisting the user."}toolDenied(){return"The user denied this operation."}toolError(e){return`The tool execution failed with the following error:\n<error>\n${e}\n</error>`}formatFilesList(e,t,r,o){const n=t.map((t=>{const r=l.relative(e,t).replace(/\\/g,"/");return t.endsWith("/")||t.endsWith("\\")?r+"/":r})).sort(((e,t)=>{const r=e.split("/"),o=t.split("/");for(let e=0;e<Math.min(r.length,o.length);e++)if(r[e]!==o[e])return e+1===r.length&&e+1<o.length?-1:e+1===o.length&&e+1<r.length?1:r[e].localeCompare(o[e],void 0,{numeric:!0,sensitivity:"base"});return r.length-o.length})),s=o?n.map((t=>{const r=l.resolve(e,t);return o.has(r)?`🔒 ${t}`:t})):n;return r?`${s.join("\n")}\n\n(File list truncated. Use list_files on specific subdirectories if you need to explore further.)`:0===s.length||1===s.length&&""===s[0]?"No files found.":s.join("\n")}};t.ResponseFormatterService=d,t.ResponseFormatterService=d=i([(0,c.Injectable)()],d)},44170:(e,t,r)=>{const o="win32"===process.platform||"cygwin"===process.env.OSTYPE||"msys"===process.env.OSTYPE,n=r(16928),s=o?";":":",i=r(14763),a=e=>Object.assign(new Error(`not found: ${e}`),{code:"ENOENT"}),c=(e,t)=>{const r=t.colon||s,n=e.match(/\//)||o&&e.match(/\\/)?[""]:[...o?[process.cwd()]:[],...(t.path||process.env.PATH||"").split(r)],i=o?t.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",a=o?i.split(r):[""];return o&&-1!==e.indexOf(".")&&""!==a[0]&&a.unshift(""),{pathEnv:n,pathExt:a,pathExtExe:i}},l=(e,t,r)=>{"function"==typeof t&&(r=t,t={}),t||(t={});const{pathEnv:o,pathExt:s,pathExtExe:l}=c(e,t),d=[],u=r=>new Promise(((s,i)=>{if(r===o.length)return t.all&&d.length?s(d):i(a(e));const c=o[r],l=/^".*"$/.test(c)?c.slice(1,-1):c,u=n.join(l,e),f=!l&&/^\.[\\\/]/.test(e)?e.slice(0,2)+u:u;s(p(f,r,0))})),p=(e,r,o)=>new Promise(((n,a)=>{if(o===s.length)return n(u(r+1));const c=s[o];i(e+c,{pathExt:l},((s,i)=>{if(!s&&i){if(!t.all)return n(e+c);d.push(e+c)}return n(p(e,r,o+1))}))}));return r?u(0).then((e=>r(null,e)),r):u(0)};e.exports=l,l.sync=(e,t)=>{t=t||{};const{pathEnv:r,pathExt:o,pathExtExe:s}=c(e,t),l=[];for(let a=0;a<r.length;a++){const c=r[a],d=/^".*"$/.test(c)?c.slice(1,-1):c,u=n.join(d,e),p=!d&&/^\.[\\\/]/.test(e)?e.slice(0,2)+u:u;for(let e=0;e<o.length;e++){const r=p+o[e];try{if(i.sync(r,{pathExt:s})){if(!t.all)return r;l.push(r)}}catch(e){}}}if(t.all&&l.length)return l;if(t.nothrow)return null;throw a(e)}},44230:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PlanModeRespondToolFactory=void 0;const s=r(3563),i=r(82267);let a=class{constructor(){}getToolName(){return"plan_mode_respond"}create(e){return new i.PlanModeRespondTool({availableInPlan:!0,availableInAct:!1})}};t.PlanModeRespondToolFactory=a,t.PlanModeRespondToolFactory=a=o([(0,s.Injectable)(),n("design:paramtypes",[])],a)},44404:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FireworksAdapter=void 0;const i=r(3563),a=r(39774),c=r(42808),l=s(r(19055));let d=class{constructor(e){this.provider=e,this.id="fireworks",this.name="Fireworks.ai",this.messageTransformer=new c.OpenAIMessageTransformer,l.default.info("[FireworksAdapter] Initialized")}getProvider(){return this.provider}getModelClient(e){return this.provider.getModelClient(e)}toProviderFormat(e){return this.messageTransformer.toProviderFormat(e)}fromProviderFormat(e){return this.messageTransformer.fromProviderFormat(e,"")}extractMetadata(e){return{format:"openai-api"}}supportsThinking(){return!1}supportsFormatConversion(e){return!0}};t.FireworksAdapter=d,t.FireworksAdapter=d=o([(0,i.Injectable)(),n("design:paramtypes",[a.FireworksProvider])],d)},44632:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StoredFileRepository=void 0;const i=r(3563),a=(r(31832),r(95775));let c=class{constructor(e){this.knex=e,this.columns={all:["id","fileContents","originalFilename","mimeType","createdAt","sessionId","workspaceName"],withoutContent:["id","originalFilename","mimeType","createdAt","sessionId","workspaceName"]}}async findAll(){return(await this.knex("stored_files").select(this.columns.withoutContent)).map((e=>a.StoredFileDto.fromStoredFile(e)))}async findById(e){const t=await this.knex("stored_files").select(this.columns.all).where("id",e).first();return t||null}async findByIdWithoutContent(e){const t=await this.knex("stored_files").select(this.columns.withoutContent).where("id",e).first();return t?a.StoredFileDto.fromStoredFile(t):null}async create(e){await this.knex("stored_files").insert(e)}async delete(e){await this.knex("stored_files").where("id",e).delete()}async findBySessionId(e){return(await this.knex("stored_files").select(this.columns.withoutContent).where("sessionId",e)).map((e=>a.StoredFileDto.fromStoredFile(e)))}async findByWorkspaceName(e){return(await this.knex("stored_files").select(this.columns.withoutContent).where("workspaceName",e)).map((e=>a.StoredFileDto.fromStoredFile(e)))}};t.StoredFileRepository=c,t.StoredFileRepository=c=o([(0,i.Injectable)(),s(0,(0,i.Inject)("KNEX")),n("design:paramtypes",[Function])],c)},44652:e=>{"use strict";e.exports=require("fs-extra")},44731:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DiffStrategyFactory=void 0;const n=r(88668),s=r(81685),i=o(r(19055));class a{static getStrategy(e,t){const r=(t??s.DEFAULT_EDIT_TOOL_CAPABILITIES).preferredDiffFormat;if(r){const t=this.strategies.find((e=>e.name===r));if(t?.canHandle(e))return i.default.debug(`[DiffStrategyFactory] Using preferred strategy: ${r}`),t;t&&i.default.debug(`[DiffStrategyFactory] Preferred strategy ${r} cannot handle input, falling back to auto-detection`)}for(const t of this.strategies)if(t.canHandle(e))return i.default.debug(`[DiffStrategyFactory] Auto-detected strategy: ${t.name}`),t;return i.default.debug("[DiffStrategyFactory] No strategy could handle input, using traditional fallback"),new n.TraditionalDiffStrategy}static getStrategyForInstructions(e){const t=(e??s.DEFAULT_EDIT_TOOL_CAPABILITIES).preferredDiffFormat;if(t){const e=this.strategies.find((e=>e.name===t));if(e)return i.default.debug(`[DiffStrategyFactory] Using preferred strategy for instructions: ${t}`),e}return i.default.debug("[DiffStrategyFactory] Using traditional strategy for instructions (fallback)"),new n.TraditionalDiffStrategy}static getStrategyByName(e){return this.strategies.find((t=>t.name===e))}static getAllStrategies(){return[...this.strategies]}static registerStrategy(e){const t=this.strategies.findIndex((t=>t.name===e.name));-1!==t?(i.default.warn(`[DiffStrategyFactory] Replacing existing strategy: ${e.name}`),this.strategies[t]=e):(i.default.debug(`[DiffStrategyFactory] Registering new strategy: ${e.name}`),this.strategies.push(e))}static getSupportedFormats(){return this.strategies.map((e=>e.name))}static isFormatSupported(e){return this.strategies.some((t=>t.name===e))}}t.DiffStrategyFactory=a,a.strategies=[new n.JsonDiffStrategy,new n.TraditionalDiffStrategy]},44799:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JsonDiffStrategy=void 0;const n=r(9581),s=o(r(19055));t.JsonDiffStrategy=class{constructor(){this.name="json"}canHandle(e){const t=e.trim();if(!t.startsWith("{")||!t.endsWith("}"))return!1;if(!t.includes('"replacements"')||!t.includes('"old_string"'))return!1;try{const e=JSON.parse(t);return this.isValidJsonDiffFormat(e)}catch(e){return s.default.debug(`[JsonDiffStrategy] JSON parse failed: ${e}`),!1}}generateUsageInstructions(e){return'## replace_in_file\nDescription: Request to replace sections of content in an existing file using JSON diff format.\nParameters:\n- path: (required) The path of the file to modify (relative to the current working directory)\n- diff: (required) The diff content in JSON format with "replacements" array\nUsage:\n<replace_in_file>\n<path>File path here</path>\n<diff>\n{\n  "replacements": [\n    {\n      "old_string": "exact string from file",\n      "new_string": "replacement string"\n    }\n  ]\n}\n</diff>\n</replace_in_file>\n\nCRITICAL RULES:\n1. old_string must match file content EXACTLY (character-for-character)\n2. Include complete lines or precise substrings\n3. Use proper JSON syntax with double quotes\n4. Replacements are applied sequentially in array order\n5. If old_string is not found, the operation will fail\n\nExamples:\n- Single line: "old_string": "const x = 5;"\n- Multiple lines: "old_string": "function test() {\\n  return true;\\n}"\n- Partial line: "old_string": "oldFunctionName"'}parse(e,t){let r;try{r=JSON.parse(e.trim())}catch(e){throw new n.FileSystemError(`Invalid JSON format in diff input: ${e instanceof Error?e.message:"Unknown JSON error"}`,"JSON_DIFF_PARSE_ERROR")}if(!this.isValidJsonDiffFormat(r))throw new n.FileSystemError('Invalid JSON diff format: must contain "replacements" array with "old_string" and "new_string" fields',"JSON_DIFF_SCHEMA_ERROR");return r.replacements.map(((e,t)=>({search:e.old_string,replace:e.new_string,originalIndex:t})))}apply(e,t,r){let o=e,i=0;const a=[];for(const e of t){if(!o.includes(e.search)){const t=`JSON replacement failed: 'old_string' content not found in file\nExpected: ${e.search}`;throw a.push(t),new n.FileSystemError(t,"JSON_DIFF_APPLY_ERROR")}{const t=o.indexOf(e.search);o=o.substring(0,t)+e.replace+o.substring(t+e.search.length),i++,s.default.debug(`[JsonDiffStrategy] Applied replacement ${i}: "${e.search.substring(0,50)}..." -> "${e.replace.substring(0,50)}..."`)}}return{content:o,appliedBlocks:i,errors:a.length>0?a:void 0}}validate(e,t){const r=[],o=e.trim();let n;o.startsWith("{")&&o.endsWith("}")||r.push("Input must be valid JSON object (start with { and end with })");try{n=JSON.parse(o)}catch(e){return r.push(`Invalid JSON syntax: ${e instanceof Error?e.message:"Unknown error"}`),{valid:!1,errors:r}}return this.isValidJsonDiffFormat(n)||(n.replacements?Array.isArray(n.replacements)?n.replacements.forEach(((e,t)=>{e&&"object"==typeof e?("string"!=typeof e.old_string&&r.push(`Replacement ${t}: "old_string" must be a string`),"string"!=typeof e.new_string&&r.push(`Replacement ${t}: "new_string" must be a string`),""===e.old_string&&r.push(`Replacement ${t}: "old_string" cannot be empty`)):r.push(`Replacement ${t}: must be an object`)})):r.push('"replacements" must be an array'):r.push('Missing required field: "replacements"')),{valid:0===r.length,errors:r}}isValidJsonDiffFormat(e){return e&&"object"==typeof e&&Array.isArray(e.replacements)&&e.replacements.every((e=>e&&"object"==typeof e&&"string"==typeof e.old_string&&"string"==typeof e.new_string&&e.old_string.length>0))}}},44810:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketService=void 0;const i=r(3563),a=s(r(19055)),c=r(96297);let l=o=class{constructor(){this.clients=new Map}onModuleInit(){a.default.debug(`[${o.name}] Initialized`)}setServer(e){this.server=e,a.default.debug(`[${o.name}] Server instance set`)}getServer(){return this.server}addClient(e,t){this.clients.set(e,t),c.debugLogger.log(`Client added: ${e}`),c.debugLogger.log(`Total clients: ${this.clients.size}`),a.default.debug(`[${o.name}] Client added: ${e}`)}removeClient(e){this.clients.delete(e),c.debugLogger.log(`Client removed: ${e}`),c.debugLogger.log(`Remaining clients: ${this.clients.size}`),a.default.debug(`[${o.name}] Client removed: ${e}`)}getClient(e){return this.clients.get(e)}getAllClients(){return this.clients}joinRoom(e,t){const r=this.clients.get(e);r?(r.join(t),a.default.debug(`[${o.name}] Client ${e} joined room ${t}`)):a.default.warn(`[${o.name}] Cannot join room: Client ${e} not found`)}leaveRoom(e,t){const r=this.clients.get(e);r&&(r.leave(t),a.default.debug(`[${o.name}] Client ${e} left room ${t}`))}emitToClient(e,t,r){const n=this.clients.get(e);n?(n.emit(t,r),c.debugLogger.log(`Emitted ${t} to client ${e}`)):a.default.warn(`[${o.name}] Cannot emit to client: Client ${e} not found`)}emitToRoom(e,t,r){this.server?(this.server.to(e).emit(t,r),c.debugLogger.log(`Emitted ${t} to room ${e}`)):a.default.warn(`[${o.name}] Cannot emit to room: Server not initialized`)}broadcast(e,t){this.server?(this.server.emit(e,t),c.debugLogger.log(`Broadcasted ${e} to all clients`)):a.default.warn(`[${o.name}] Cannot broadcast: Server not initialized`)}};t.WebSocketService=l,t.WebSocketService=l=o=n([(0,i.Injectable)()],l)},44870:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FILE_SYSTEM_EVENTS=t.FileDeletedEvent=t.FileCreatedEvent=t.FileModifiedEvent=void 0;t.FileModifiedEvent=class{constructor(e,t,r,o=new Date){this.workspacePath=e,this.filePath=t,this.operation=r,this.timestamp=o}};t.FileCreatedEvent=class{constructor(e,t,r=new Date){this.workspacePath=e,this.filePath=t,this.timestamp=r}};t.FileDeletedEvent=class{constructor(e,t,r=new Date){this.workspacePath=e,this.filePath=t,this.timestamp=r}},t.FILE_SYSTEM_EVENTS={FILE_MODIFIED:"file.modified",FILE_CREATED:"file.created",FILE_DELETED:"file.deleted"}},44897:e=>{"use strict";e.exports=require("@langchain/community/document_loaders/fs/pptx")},44970:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReadFile=void 0;const c=r(83153),l=r(11569),d=i(r(79896)),u=i(r(16928)),p=a(r(19055));class f extends c.Tool{constructor(e){super(),this.name="read_file",this.description="Read the content of a file in the workspace. Should only be used for reading files that are expected to be text based. Do not use this tool for binary files.",this.schema=l.z.object({filePath:l.z.string().describe("The relative path of the file to read")}),this.workspaceRootDir=e}async _call(e){return`The content of the file at path: ${e.filePath} is as follows:\n${this.readFile(e.filePath)}`}readFile(e){p.default.info(`ReadFile.readFile called with: ${e}`);const t=u.join(this.workspaceRootDir,e);try{return d.readFileSync(t,"utf-8")}catch(t){return"ENOENT"===t.code?`Error: File not found - ${e}`:`Error reading file: ${t.message}`}}}t.ReadFile=f},44971:e=>{"use strict";const t="win32"===process.platform;function r(e,t){return Object.assign(new Error(`${t} ${e.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${t} ${e.command}`,path:e.command,spawnargs:e.args})}function o(e,o){return t&&1===e&&!o.file?r(o.original,"spawn"):null}e.exports={hookChildProcess:function(e,r){if(!t)return;const n=e.emit;e.emit=function(t,s){if("exit"===t){const t=o(s,r);if(t)return n.call(e,"error",t)}return n.apply(e,arguments)}},verifyENOENT:o,verifyENOENTSync:function(e,o){return t&&1===e&&!o.file?r(o.original,"spawnSync"):null},notFoundError:r}},44985:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LMSTUDIO_PROVIDER_ID=void 0,t.discoverLMStudioModels=async function(e,r){const o=e||"http://localhost:1234/v1";try{s.default.debug(`[LMStudioModels] Attempting to discover models from: ${o}`);const e=new n.default({baseURL:o,apiKey:"noop",timeout:3e3}),c=await e.models.list();if(!c.data||0===c.data.length)return s.default.debug(`[LMStudioModels] No models loaded in LM Studio at ${o}`),[];if(s.default.info(`[LMStudioModels] Discovered ${c.data.length} models from LM Studio`),!r)return s.default.error("[LMStudioModels] OpenSourceModelRegistryService instance not provided to discoverLMStudioModels."),[];const l=await Promise.all(c.data.map((e=>async function(e,r){const o=e.id,n=o,s=await r.getModel(o);return{modelId:o,providerId:t.LMSTUDIO_PROVIDER_ID,name:n,family:s?.family||i(o),contextWindow:s?.specifications.contextWindow||32768,maxOutputTokens:8192,supportsImages:s?.capabilities.supportsVision||a(o),supportsToolUse:s?.capabilities.supportsToolUse??!0,supportsComputerUse:!1,supportsPromptCache:!1,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:0,outputCostPerMillionTokens:0,isDefaultForProvider:!1,metadata:{isLocal:!0,serverUrl:"http://localhost:1234",originalModelId:o,registry:s?"found":"not_found"}}}(e,r))));return l.sort(((e,t)=>e.name.localeCompare(t.name))),s.default.info(`[LMStudioModels] Successfully transformed ${l.length} LM Studio models`),l}catch(e){return"ECONNREFUSED"===e.code||"ENOTFOUND"===e.code?s.default.debug(`[LMStudioModels] LM Studio server not accessible at ${o}`):"TimeoutError"===e.name?s.default.debug(`[LMStudioModels] LM Studio server timeout at ${o}`):s.default.warn(`[LMStudioModels] LM Studio discovery failed: ${e.message}`),[]}},t.getDefaultLMStudioModelId=function(){return};const n=o(r(56082)),s=o(r(19055));function i(e){const t=e.toLowerCase();return t.includes("llama")?"llama":t.includes("mistral")?"mistral":t.includes("mixtral")?"mixtral":t.includes("deepseek")?"deepseek":t.includes("qwen")||t.includes("qwen3")?"qwen":t.includes("phi")?"phi":t.includes("yi")?"yi":t.includes("codellama")?"codellama":t.includes("starcoder")?"starcoder":"unknown"}function a(e){const t=e.toLowerCase();return t.includes("vision")||t.includes("llava")||t.includes("minicpm")||t.includes("qwen-vl")}t.LMSTUDIO_PROVIDER_ID="lmstudio"},45533:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.HelloWorldService=void 0;const n=r(3563);let s=class{getHello(){return"Hello World!"}};t.HelloWorldService=s,t.HelloWorldService=s=o([(0,n.Injectable)()],s)},45702:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ModelRefreshService=void 0;const i=r(3563),a=r(72776),c=r(36206),l=r(58620),d=r(9102),u=s(r(19055));let p=class{constructor(e,t,r,o){this.appDataSource=e,this.providerRegistry=t,this.llmMetadataService=r,this.eveConfigService=o,this.serviceName="ModelRefreshService"}async onModuleInit(){u.default.info(`[${this.serviceName}] Initializing model refresh service...`),await this.refreshAllProvidersModels(),u.default.info(`[${this.serviceName}] Model refresh service initialized`)}async refreshAllProvidersModels(){const e=this.providerRegistry.getAllProviders();u.default.info(`[${this.serviceName}] Refreshing models for ${e.length} providers`);for(const t of e){const e=t.getId();u.default.info(`[${this.serviceName}] Processing provider: ${e}`);await this.refreshProviderModels(e)?u.default.info(`[${this.serviceName}] Successfully refreshed models for provider: ${e}`):u.default.warn(`[${this.serviceName}] Could not refresh models for provider: ${e} - no API key available`)}}async refreshProviderModels(e){u.default.info(`[${this.serviceName}] Attempting to refresh models for provider: ${e}`);const t=this.providerRegistry.getProvider(e);if(!t.requiresApiKey()){u.default.info(`[${this.serviceName}] Provider ${e} does not require API key, refreshing directly`);try{const r=t.getDefaultBaseUrl();return await this.llmMetadataService.refreshModelsForProvider(e,"",r),!0}catch(t){return u.default.warn(`[${this.serviceName}] Failed to refresh models for provider ${e}: ${t.message}`),!1}}return!!await this.refreshWithGlobalApiKey(e)||await this.refreshWithUserApiKey(e)}async refreshWithGlobalApiKey(e){try{const t=this.providerRegistry.getProvider(e),r=await this.getDefaultApiKeyName(e);if(u.default.info(`[${this.serviceName}] Checking for global API key (${r}) for provider: ${e}`),r&&process.env[r]){const o=process.env[r],n=t.getDefaultBaseUrl();return u.default.info(`[${this.serviceName}] Found global API key for provider: ${e}`),await this.llmMetadataService.refreshModelsForProvider(e,o,n),u.default.info(`[${this.serviceName}] Refreshed models for provider ${e} using global API key`),!0}u.default.info(`[${this.serviceName}] No global API key found for provider: ${e}`)}catch(t){u.default.error(`[${this.serviceName}] Failed to refresh models with global API key for provider ${e}: ${t.message}`,t.stack)}return!1}async refreshWithUserApiKey(e){try{u.default.info(`[${this.serviceName}] Looking for user-configured API keys for provider: ${e}`);const t=await this.findUsersWithApiKeys(e);if(t.length>0){const{userId:r,apiKey:o,baseUrl:n}=t[0];return u.default.info(`[${this.serviceName}] Found API key from user ${r} for provider: ${e}`),await this.llmMetadataService.refreshModelsForProvider(e,o,n),u.default.info(`[${this.serviceName}] Refreshed models for provider ${e} using API key from user ${r}`),!0}u.default.info(`[${this.serviceName}] No user-configured API keys found for provider: ${e}`)}catch(t){u.default.error(`[${this.serviceName}] Failed to refresh models with user API key for provider ${e}: ${t.message}`,t.stack)}return!1}async findUsersWithApiKeys(e){return(await this.appDataSource.knex("user_llm_configurations").where("provider_id",e).whereNotNull("api_key").select("user_id","api_key","base_url")).map((e=>({userId:e.user_id,apiKey:e.api_key,baseUrl:e.base_url})))}async getDefaultApiKeyName(e){const t=await this.appDataSource.knex("agent_modes").where("default_provider_id",e).select("default_api_key_secret_name").first();return t?.default_api_key_secret_name}};t.ModelRefreshService=p,t.ModelRefreshService=p=o([(0,i.Injectable)(),n("design:paramtypes",[a.AppDataSource,c.ProviderRegistry,l.LlmMetadataService,d.EveConfigService])],p)},45733:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XAI_STATIC_MODELS=void 0,t.getXaiStaticModels=function(){return Object.values(t.XAI_STATIC_MODELS)},t.getDefaultXaiModelId=function(){return"grok-3"},t.getXaiModelCapabilities=function(e){const r=t.XAI_STATIC_MODELS[e];return r?.metadata};const o=r(9106);t.XAI_STATIC_MODELS={"grok-3":{modelId:"grok-3",providerId:o.XAI_PROVIDER_ID,name:"Grok 3",contextWindow:131072,maxOutputTokens:128e3,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:3,outputCostPerMillionTokens:15,isDefaultForProvider:!0,metadata:{description:"X AI's Grok-3 model with 131K context window",supportsReasoningEffort:!1,supportsReasoningContent:!1,supportsVision:!1}},"grok-3-beta":{modelId:"grok-3-beta",providerId:o.XAI_PROVIDER_ID,name:"Grok 3 Beta",contextWindow:131072,maxOutputTokens:128e3,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:3,outputCostPerMillionTokens:15,isDefaultForProvider:!1,metadata:{description:"X AI's Grok-3 beta model with 131K context window",supportsReasoningEffort:!1,supportsReasoningContent:!1,supportsVision:!1}},"grok-3-fast":{modelId:"grok-3-fast",providerId:o.XAI_PROVIDER_ID,name:"Grok 3 Fast",contextWindow:131072,maxOutputTokens:128e3,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:5,outputCostPerMillionTokens:25,isDefaultForProvider:!1,metadata:{description:"X AI's Grok-3 fast model with 131K context window",supportsReasoningEffort:!1,supportsReasoningContent:!1,supportsVision:!1}},"grok-3-fast-beta":{modelId:"grok-3-fast-beta",providerId:o.XAI_PROVIDER_ID,name:"Grok 3 Fast Beta",contextWindow:131072,maxOutputTokens:128e3,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:5,outputCostPerMillionTokens:25,isDefaultForProvider:!1,metadata:{description:"X AI's Grok-3 fast beta model with 131K context window",supportsReasoningEffort:!1,supportsReasoningContent:!1,supportsVision:!1}},"grok-3-mini":{modelId:"grok-3-mini",providerId:o.XAI_PROVIDER_ID,name:"Grok 3 Mini",contextWindow:131072,maxOutputTokens:128e3,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:.3,outputCostPerMillionTokens:.5,isDefaultForProvider:!1,metadata:{description:"X AI's Grok-3 mini model with 131K context window",supportsReasoningEffort:!0,supportsReasoningContent:!0,supportsVision:!1,maxReasoningEffort:["low","high"]}},"grok-3-mini-beta":{modelId:"grok-3-mini-beta",providerId:o.XAI_PROVIDER_ID,name:"Grok 3 Mini Beta",contextWindow:131072,maxOutputTokens:128e3,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:.3,outputCostPerMillionTokens:.5,isDefaultForProvider:!1,metadata:{description:"X AI's Grok-3 mini beta model with 131K context window",supportsReasoningEffort:!0,supportsReasoningContent:!0,supportsVision:!1,maxReasoningEffort:["low","high"]}},"grok-3-mini-fast":{modelId:"grok-3-mini-fast",providerId:o.XAI_PROVIDER_ID,name:"Grok 3 Mini Fast",contextWindow:131072,maxOutputTokens:128e3,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:.6,outputCostPerMillionTokens:4,isDefaultForProvider:!1,metadata:{description:"X AI's Grok-3 mini fast model with 131K context window",supportsReasoningEffort:!0,supportsReasoningContent:!0,supportsVision:!1,maxReasoningEffort:["low","high"]}},"grok-3-mini-fast-beta":{modelId:"grok-3-mini-fast-beta",providerId:o.XAI_PROVIDER_ID,name:"Grok 3 Mini Fast Beta",contextWindow:131072,maxOutputTokens:128e3,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:.6,outputCostPerMillionTokens:4,isDefaultForProvider:!1,metadata:{description:"X AI's Grok-3 mini fast beta model with 131K context window",supportsReasoningEffort:!0,supportsReasoningContent:!0,supportsVision:!1,maxReasoningEffort:["low","high"]}},"grok-2-latest":{modelId:"grok-2-latest",providerId:o.XAI_PROVIDER_ID,name:"Grok 2 Latest",contextWindow:131072,maxOutputTokens:128e3,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!1,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:2,outputCostPerMillionTokens:10,isDefaultForProvider:!1,metadata:{description:"X AI's Grok-2 model - latest version with 131K context window",supportsReasoningEffort:!1,supportsReasoningContent:!1,supportsVision:!1}},"grok-2":{modelId:"grok-2",providerId:o.XAI_PROVIDER_ID,name:"Grok 2",contextWindow:131072,maxOutputTokens:128e3,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!1,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:2,outputCostPerMillionTokens:10,isDefaultForProvider:!1,metadata:{description:"X AI's Grok-2 model with 131K context window",supportsReasoningEffort:!1,supportsReasoningContent:!1,supportsVision:!1}},"grok-2-1212":{modelId:"grok-2-1212",providerId:o.XAI_PROVIDER_ID,name:"Grok 2 (1212)",contextWindow:131072,maxOutputTokens:128e3,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!1,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:2,outputCostPerMillionTokens:10,isDefaultForProvider:!1,metadata:{description:"X AI's Grok-2 model (version 1212) with 131K context window",supportsReasoningEffort:!1,supportsReasoningContent:!1,supportsVision:!1}},"grok-2-vision-latest":{modelId:"grok-2-vision-latest",providerId:o.XAI_PROVIDER_ID,name:"Grok 2 Vision Latest",contextWindow:32768,maxOutputTokens:32768,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!1,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:2,outputCostPerMillionTokens:10,isDefaultForProvider:!1,metadata:{description:"X AI's Grok-2 Vision model - latest version with image support and 32K context window",supportsReasoningEffort:!1,supportsReasoningContent:!1,supportsVision:!0}},"grok-2-vision":{modelId:"grok-2-vision",providerId:o.XAI_PROVIDER_ID,name:"Grok 2 Vision",contextWindow:32768,maxOutputTokens:32768,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!1,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:2,outputCostPerMillionTokens:10,isDefaultForProvider:!1,metadata:{description:"X AI's Grok-2 Vision model with image support and 32K context window",supportsReasoningEffort:!1,supportsReasoningContent:!1,supportsVision:!0}},"grok-2-vision-1212":{modelId:"grok-2-vision-1212",providerId:o.XAI_PROVIDER_ID,name:"Grok 2 Vision (1212)",contextWindow:32768,maxOutputTokens:32768,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!1,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:2,outputCostPerMillionTokens:10,isDefaultForProvider:!1,metadata:{description:"X AI's Grok-2 Vision model (version 1212) with image support and 32K context window",supportsReasoningEffort:!1,supportsReasoningContent:!1,supportsVision:!0}},"grok-vision-beta":{modelId:"grok-vision-beta",providerId:o.XAI_PROVIDER_ID,name:"Grok Vision Beta",contextWindow:8192,maxOutputTokens:8192,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!1,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:5,outputCostPerMillionTokens:15,isDefaultForProvider:!1,metadata:{description:"X AI's Grok Vision Beta model with image support and 8K context window",supportsReasoningEffort:!1,supportsReasoningContent:!1,supportsVision:!0}},"grok-beta":{modelId:"grok-beta",providerId:o.XAI_PROVIDER_ID,name:"Grok Beta",contextWindow:131072,maxOutputTokens:8192,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!1,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:5,outputCostPerMillionTokens:15,isDefaultForProvider:!1,metadata:{description:"X AI's Grok Beta model (legacy) with 131K context window",supportsReasoningEffort:!1,supportsReasoningContent:!1,supportsVision:!1}}}},45762:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.FileSystemEpicRepository=void 0;const l=r(3563),d=a(r(91943)),u=a(r(16928)),p=r(50251),f=r(57655),h=r(19615),m=r(74717);let g=class{constructor(e){this.workspaceRepository=e}async getRequirements(e,t){const r=await this.getEpicPath(e,t),o=u.join(r,"requirements.md");try{return await d.readFile(o,"utf-8")}catch(e){throw new Error(`Requirements not found for epic ${t}`)}}async updateRequirements(e,t,r){const o=await this.getEpicPath(e,t),n=u.join(o,"requirements.md");try{return await d.writeFile(n,r),r}catch(e){throw new Error(`Failed to update requirements for epic ${t}`)}}async getEpicsBasePath(e){const t=await this.workspaceRepository.findByName(e);if(!t)throw new l.NotFoundException(`Workspace not found: ${e}`);return u.join(t.repoBaseDir,"epics")}async getEpicPath(e,t){const r=await this.getEpicsBasePath(e);return u.join(r,t)}async findStoryDirectoryNameById(e,t,r){const o=await this.getEpicPath(e,t),n=u.join(o,"stories");try{const e=await d.readdir(n);if(e.includes(r))return r;for(const t of e)try{const e=u.join(n,t,"story.json");if(JSON.parse(await d.readFile(e,"utf-8")).id===r)return t}catch(e){console.error(`Error reading story ${t}:`,e)}throw new l.NotFoundException(`Story with id ${r} not found`)}catch(e){if(e instanceof l.NotFoundException)throw e;throw new l.NotFoundException("Stories directory not found or not accessible")}}async getStoryPath(e,t,r){const o=await this.getEpicPath(e,t),n=await this.findStoryDirectoryNameById(e,t,r);return u.join(o,"stories",n,"story.json")}async getTaskPath(e,t,r,o){const n=await this.getEpicPath(e,t),s=await this.findStoryDirectoryNameById(e,t,r);return u.join(n,"stories",s,"tasks",`${o}.json`)}async ensureDirectoryExists(e){try{await d.mkdir(e,{recursive:!0})}catch(e){if("EEXIST"!==e.code)throw e}}async readTask(e,t,r,o){const n=await this.getTaskPath(e,t,r,o);try{const e=JSON.parse(await d.readFile(n,"utf-8")),t=new h.Task(e.title,e.description,e.status);return t.id=e.id,t.createdAt=new Date(e.createdAt),t.updatedAt=new Date(e.updatedAt),t}catch(e){throw new l.NotFoundException(`Task with id ${o} not found`)}}async writeTask(e,t,r,o){const n=await this.getTaskPath(e,t,r,o.id);await this.ensureDirectoryExists(u.dirname(n)),await d.writeFile(n,JSON.stringify(o,null,2))}async findAllByWorkspace(e){const t=await this.getEpicsBasePath(e);try{await d.access(t)}catch(e){return[]}let r;try{r=await d.readdir(t)}catch(e){return console.error("Error reading epics directory:",e),[]}const o=[];for(const n of r){const r=u.join(t,n),s=u.join(r,"requirements.md");try{const t=await d.readFile(s,"utf-8"),i=t.match(/# (.+?):/),a=t.match(/## Description\s+(.*?)(?=##|$)/s),c=i?i[1].trim():n,l=a?a[1].trim():"",h=u.join(r,"stories"),m=[];try{const e=await d.readdir(h);for(const t of e){const e=u.join(h,t,"story.json"),r=JSON.parse(await d.readFile(e,"utf-8")),o=new f.Story(r.title,r.description,r.acceptanceCriteria,r.status);o.id=r.id,o.createdAt=new Date(r.createdAt),o.updatedAt=new Date(r.updatedAt),m.push(o)}}catch(e){console.log(`No stories directory found for epic ${n}, continuing with empty stories array`)}o.push(new p.Epic(c,l,e,m,n))}catch(e){console.error(`Error reading epic ${n}:`,e)}}return o}async findById(e,t){const r=await this.getEpicPath(e,t);try{await d.access(r)}catch(e){return null}try{const o=u.join(r,"requirements.md"),n=await d.readFile(o,"utf-8"),s=n.match(/# (.+?):/),i=n.match(/## Description\s+(.*?)(?=##|$)/s),a=s?s[1].trim():t,c=i?i[1].trim():"",l=u.join(r,"stories");let h=[];try{const e=await d.readdir(l);for(const t of e)try{const e=u.join(l,t,"story.json"),r=JSON.parse(await d.readFile(e,"utf-8")),o=new f.Story(r.title,r.description,r.acceptanceCriteria,r.status,r.taskIds||[]);o.id=r.id,o.createdAt=new Date(r.createdAt),o.updatedAt=new Date(r.updatedAt),h.push(o)}catch(e){console.error(`Error reading story ${t}:`,e)}}catch(e){console.error("Error reading stories directory:",e)}return new p.Epic(a,c,e,h,t)}catch(e){return console.error(`Error reading epic ${t}:`,e),null}}async create(e){const t=await this.getEpicPath(e.workspaceName,e.id);await this.ensureDirectoryExists(t),await this.ensureDirectoryExists(u.join(t,"stories"));const r=`# ${e.title}:\n\n## Description\n${e.description}\n\n## Goals\n- Add goals here\n`;return await d.writeFile(u.join(t,"requirements.md"),r),e}async update(e){const t=await this.getEpicPath(e.workspaceName,e.id),r=u.join(t,"requirements.md"),o=`# ${e.title}:\n\n## Description\n${e.description}\n\n## Goals\n- Add goals here\n`;return await d.writeFile(r,o),e}async delete(e,t){const r=await this.getEpicPath(e,t);await d.rm(r,{recursive:!0,force:!0})}async addStory(e,t,r){const o=await this.getEpicPath(e,t),n=u.join(o,"stories");await this.ensureDirectoryExists(n);const s=await this.getStoryPath(e,t,r.id);return await this.ensureDirectoryExists(u.dirname(s)),await d.writeFile(s,JSON.stringify(r,null,2)),r}async updateStory(e,t,r){const o=await this.getStoryPath(e,t,r.id);return await d.writeFile(o,JSON.stringify(r,null,2)),r}async deleteStory(e,t,r){const o=await this.getStoryPath(e,t,r),n=u.dirname(o);await d.rm(n,{recursive:!0,force:!0})}async getStory(e,t,r){const o=await this.getStoryPath(e,t,r);try{const e=JSON.parse(await d.readFile(o,"utf-8")),t=new f.Story(e.title,e.description,e.acceptanceCriteria,e.status,e.taskIds||[]);return t.id=e.id,t.createdAt=new Date(e.createdAt),t.updatedAt=new Date(e.updatedAt),t}catch(e){throw new l.NotFoundException(`Story with id ${r} not found`)}}async addTask(e,t,r,o){const n=await this.findById(e,t);if(!n)throw new Error("Epic not found");if(!n.stories.find((e=>e.id===r)))throw new Error("Story not found");return await this.writeTask(e,t,r,o),o}async updateTask(e,t,r,o){const n=await this.findById(e,t);if(!n)throw new Error("Epic not found");if(!n.stories.find((e=>e.id===r)))throw new Error("Story not found");try{await this.readTask(e,t,r,o.id)}catch(e){throw new Error("Task not found")}return await this.writeTask(e,t,r,o),o}async deleteTask(e,t,r,o){const n=await this.findById(e,t);if(!n)throw new Error("Epic not found");if(!n.stories.find((e=>e.id===r)))throw new Error("Story not found");const s=await this.getTaskPath(e,t,r,o);await d.rm(s,{force:!0})}async getTasks(e,t,r){const o=await this.findById(e,t);if(!o)throw new Error("Epic not found");if(!o.stories.find((e=>e.id===r)))throw new Error("Story not found");const n=u.join(await this.getEpicPath(e,t),"stories",r,"tasks");try{const o=await d.readdir(n),s=[];for(const n of o){if(!n.endsWith(".json"))continue;const o=n.replace(".json","");try{const n=await this.readTask(e,t,r,o);s.push(n)}catch(e){console.error(`Error reading task ${o}:`,e)}}return s}catch(e){if("ENOENT"===e.code)return[];throw e}}async getTask(e,t,r,o){return this.readTask(e,t,r,o)}};t.FileSystemEpicRepository=g,t.FileSystemEpicRepository=g=i([(0,l.Injectable)(),c("design:paramtypes",[m.WorkspaceRepository])],g)},45789:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_GEMINI_MODEL_ID=t.GEMINI_PROVIDER_ID=void 0,t.getStaticGeminiModels=s,t.discoverGeminiModels=async function(e,t){return n.default.info("[GeminiProvider] Using static model list (API key presence ignored)"),s()};const n=o(r(19055));function s(){return[{modelId:"gemini-2.5-pro-preview-06-05",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 2.5 Pro Preview 06-05",contextWindow:1048576,maxOutputTokens:64e3,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!0,inputCostPerMillionTokens:1.25,outputCostPerMillionTokens:10,cacheWritesPrice:1,cacheReadsPrice:.31,isDefaultForProvider:!0,metadata:{description:"Latest stable Gemini 2.5 Pro model (June 5, 2025). Tiered pricing. Input: $1.25 (<=200K), $2.50 (>200K). Output: $10.00 (<=200K), $15.00 (>200K). Cache: $0.31 reads (<=200K), $0.625 reads (>200K), and $4.50/million tokens/hour for storage."},editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},{modelId:"gemini-2.5-pro",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 2.5 Pro",contextWindow:1048576,maxOutputTokens:64e3,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!0,inputCostPerMillionTokens:1.25,outputCostPerMillionTokens:10,cacheWritesPrice:1,cacheReadsPrice:.31,isDefaultForProvider:!1,metadata:{description:"Gemini 2.5 Pro with tiered pricing. Input: $1.25 (<=200K tokens), $2.50 (>200K tokens). Output: $10.00 (<=200K), $15.00 (>200K). Cache: $0.31 reads (<=200K), $0.625 reads (>200K), and $4.50/million tokens/hour for storage."},editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},{modelId:"gemini-2.5-flash",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 2.5 Flash",contextWindow:1048576,maxOutputTokens:64e3,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!0,inputCostPerMillionTokens:.3,outputCostPerMillionTokens:2.5,cacheWritesPrice:1,cacheReadsPrice:.075,isDefaultForProvider:!1,metadata:{description:"Latest stable Gemini 2.5 Flash model. Input: $0.30 (text/image/video), $1.00 (audio). Output: $2.50. Cache Reads: $0.075 (text/image/video), $0.25 (audio). Storage: $1.00/1M tokens/hour."},editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},{modelId:"gemini-2.0-flash",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 2.0 Flash",contextWindow:1048576,maxOutputTokens:8192,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:.1,outputCostPerMillionTokens:.4,cacheWritesPrice:1,cacheReadsPrice:.025,isDefaultForProvider:!1,metadata:{description:"Gemini 2.0 Flash model. Input: $0.10 (text/image/video), $0.70 (audio). Output: $0.40. Cache Reads: $0.025 (text/image/video), $0.175 (audio). Storage: $1.00/1M tokens/hour."},editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!1,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},{modelId:"gemini-2.5-pro-preview-05-06",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 2.5 Pro Preview 05-06",contextWindow:1048576,maxOutputTokens:64e3,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:1.25,outputCostPerMillionTokens:10,cacheWritesPrice:1,cacheReadsPrice:.31,isDefaultForProvider:!1,metadata:{description:"Preview Gemini 2.5 Pro model 05-06. Assumes same tiered pricing as gemini-2.5-pro."}},{modelId:"gemini-2.5-pro-preview-03-25",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 2.5 Pro Preview 03-25",contextWindow:1048576,maxOutputTokens:64e3,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:1.25,outputCostPerMillionTokens:10,cacheWritesPrice:1,cacheReadsPrice:.31,isDefaultForProvider:!1,metadata:{description:"Preview Gemini 2.5 Pro model 03-25. Assumes same tiered pricing as gemini-2.5-pro."}},{modelId:"gemini-2.5-pro-exp-03-25",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 2.5 Pro Experimental 03-25",contextWindow:1048576,maxOutputTokens:65536,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!0,inputCostPerMillionTokens:1.25,outputCostPerMillionTokens:10,cacheWritesPrice:1,cacheReadsPrice:.31,isDefaultForProvider:!1,metadata:{description:"Experimental release (March 25th, 2025) of Gemini 2.5 Pro"},editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},{modelId:"gemini-2.5-flash-preview-04-17",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 2.5 Flash Preview 04-17",contextWindow:1048576,maxOutputTokens:65536,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!0,inputCostPerMillionTokens:.3,outputCostPerMillionTokens:2.5,cacheWritesPrice:1,cacheReadsPrice:.075,isDefaultForProvider:!1,metadata:{description:"Preview release (April 17th, 2025) of Gemini 2.5 Flash. Assumes pricing similar to stable Gemini 2.5 Flash."},editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},{modelId:"gemini-2.5-flash-preview-05-20",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 2.5 Flash Preview 05-20",contextWindow:1048576,maxOutputTokens:65536,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!0,inputCostPerMillionTokens:.3,outputCostPerMillionTokens:2.5,cacheWritesPrice:1,cacheReadsPrice:.075,isDefaultForProvider:!1,metadata:{description:"Preview release (May 20th, 2025) of Gemini 2.5 Flash. Assumes pricing similar to stable Gemini 2.5 Flash."},editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},{modelId:"gemini-2.5-flash-preview-04-17-thinking",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 2.5 Flash Preview 04-17 for cursor testing",contextWindow:1048576,maxOutputTokens:65536,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!0,inputCostPerMillionTokens:.3,outputCostPerMillionTokens:2.5,cacheWritesPrice:1,cacheReadsPrice:.075,isDefaultForProvider:!1,metadata:{description:"Preview release (April 17th, 2025) of Gemini 2.5 Flash, specifically for cursor testing thinking capabilities. Assumes pricing similar to stable Gemini 2.5 Flash."},editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},{modelId:"gemini-2.5-flash-lite-preview-06-17",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 2.5 Flash Lite Preview 06-17",contextWindow:65536,maxOutputTokens:65536,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!0,inputCostPerMillionTokens:.1,outputCostPerMillionTokens:.4,cacheWritesPrice:1,cacheReadsPrice:.025,isDefaultForProvider:!1,metadata:{description:"Preview release (June 11th, 2025) of Gemini 2.5 Flash Lite. Input: $0.10 (text/image/video), $0.50 (audio). Output: $0.40. Cache Reads: $0.025 (text/image/video), $0.125 (audio). Storage: $1.00/1M tokens/hour."},editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!0,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},{modelId:"gemini-1.5-pro-002",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 1.5 Pro 002",contextWindow:2097152,maxOutputTokens:8192,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:1.25,outputCostPerMillionTokens:5,cacheWritesPrice:1,cacheReadsPrice:.3125,isDefaultForProvider:!1,metadata:{description:"Gemini 1.5 Pro model. Input: $1.25 (<=128K), $2.50 (>128K). Output: $5.00 (<=128K), $10.00 (>128K). Cache Reads: $0.3125 (<=128K), $0.625 (>128K). Storage: $4.50/hr."},editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!1,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},{modelId:"gemini-1.5-flash-002",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 1.5 Flash 002",contextWindow:1048576,maxOutputTokens:8192,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:.075,outputCostPerMillionTokens:.3,cacheWritesPrice:1,cacheReadsPrice:.01875,isDefaultForProvider:!1,metadata:{description:"Gemini 1.5 Flash model. Input: $0.075 (<=128K), $0.15 (>128K). Output: $0.30 (<=128K), $0.60 (>128K). Cache Reads: $0.01875 (<=128K), $0.0375 (>128K). Storage: $1.00/hr."},editToolCapabilities:{supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!1,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}}]}t.GEMINI_PROVIDER_ID="gemini",t.DEFAULT_GEMINI_MODEL_ID="gemini-2.5-pro"},45873:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceModule=void 0;const n=r(3563),s=r(22397),i=r(88474),a=r(74717),c=r(376);let l=class{};t.WorkspaceModule=l,t.WorkspaceModule=l=o([(0,n.Module)({imports:[c.DataSourceModule],controllers:[s.WorkspaceController],providers:[i.WorkspaceService,a.WorkspaceRepository],exports:[i.WorkspaceService,a.WorkspaceRepository]})],l)},45908:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SourceArtefactRepository=void 0;const i=r(3563),a=(r(31832),r(38547)),c=r(3563),l=r(59100);let d=class{constructor(e){this.knex=e}async create(e){const t=(0,l.ulid)(),r=e.createdAt?e.createdAt:new Date;return await this.knex("source_artefacts").insert({id:t,...e,createdAt:r}),{id:t,...e}}async findById(e){const t=await this.knex("source_artefacts").where("id",e).first();return t?new a.SourceArtefact(t):null}async update(e,t){return await this.knex("source_artefacts").where("id",e).update(t),this.findById(e)}async delete(e){await this.knex("source_artefacts").where("id",e).delete()}async findBySchemeAndLocator(e,t){const r=await this.knex("source_artefacts").where({scheme:e,locator:t}).first();return r?new a.SourceArtefact(r):null}async query(e,t,r=1,o=10,n="locator",s="ASC"){const i=(r-1)*o;let c=this.knex("source_artefacts");e&&(c=c.where("scheme",e)),t&&(c=c.where("locator","like",`%${t}%`));const[l,d]=await Promise.all([c.clone().orderBy(n,s).limit(o).offset(i),c.clone().count("* as count").first()]);return{items:l.map((e=>new a.SourceArtefact(e))),total:d?.count}}};t.SourceArtefactRepository=d,t.SourceArtefactRepository=d=o([(0,i.Injectable)(),s(0,(0,c.Inject)("KNEX")),n("design:paramtypes",[Function])],d)},46304:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getMaskedApiKey=void 0,t.convertEveMessageToGeminiNewSDK=function(e){return{role:"assistant"===e.role?"model":"user",parts:(t=e.segments,t.flatMap((e=>{if("text"===e.type)return{text:e.content};if("thinking"===e.type)return{text:`[Thinking: ${e.content}]`};if("image"===e.type){n.default.info("[GeminiNewSDKHelper] Converting image segment to Gemini format");const t=e.metadata?.url||e.content;if(t?.startsWith("data:")){const e=t.split(",");if(2===e.length){const t=e[0].match(/:(.*?);/);if(t&&t[1])return{inlineData:{data:e[1],mimeType:t[1]}}}}return n.default.warn(`[GeminiNewSDKHelper] Image URL "${t}" is not a data URI or parsing failed. Sending as text placeholder.`),{text:`[Image: ${t||"URL missing or invalid"}]`}}return"tool_code"===e.type?(n.default.debug("[GeminiNewSDKHelper] Converting tool_code segment to text for Gemini."),{text:`<tool_code>\n${e.content}\n</tool_code>`}):"tool_result"===e.type?(n.default.debug("[GeminiNewSDKHelper] Converting tool_result segment to text for Gemini."),{text:`<tool_result>\n${e.content}\n</tool_result>`}):(n.default.warn(`[GeminiNewSDKHelper] Unsupported segment type: ${e.type}. Converting to text.`),{text:`[Unsupported segment type: ${e.type}] ${e.content}`})})))};var t};const n=o(r(19055));var s=r(15562);Object.defineProperty(t,"getMaskedApiKey",{enumerable:!0,get:function(){return s.getMaskedApiKey}})},46410:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e,t){super(e),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}}function o(e){}t.ParseError=r,t.createParser=function(e){if("function"==typeof e)throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:t=o,onError:n=o,onRetry:s=o,onComment:i}=e;let a,c="",l=!0,d="",u="";function p(e){if(""===e)return d.length>0&&t({id:a,event:u||void 0,data:d.endsWith("\n")?d.slice(0,-1):d}),a=void 0,d="",void(u="");if(e.startsWith(":"))return void(i&&i(e.slice(e.startsWith(": ")?2:1)));const r=e.indexOf(":");if(-1===r)f(e,"",e);else{const t=e.slice(0,r),o=" "===e[r+1]?2:1;f(t,e.slice(r+o),e)}}function f(e,t,o){switch(e){case"event":u=t;break;case"data":d=`${d}${t}\n`;break;case"id":a=t.includes("\0")?void 0:t;break;case"retry":/^\d+$/.test(t)?s(parseInt(t,10)):n(new r(`Invalid \`retry\` value: "${t}"`,{type:"invalid-retry",value:t,line:o}));break;default:n(new r(`Unknown field "${e.length>20?`${e.slice(0,20)}…`:e}"`,{type:"unknown-field",field:e,value:t,line:o}))}}return{feed:function(e){const t=l?e.replace(/^\xEF\xBB\xBF/,""):e,[r,o]=function(e){const t=[];let r="",o=0;for(;o<e.length;){const n=e.indexOf("\r",o),s=e.indexOf("\n",o);let i=-1;if(-1!==n&&-1!==s?i=Math.min(n,s):-1!==n?i=n:-1!==s&&(i=s),-1===i){r=e.slice(o);break}{const r=e.slice(o,i);t.push(r),o=i+1,"\r"===e[o-1]&&"\n"===e[o]&&o++}}return[t,r]}(`${c}${t}`);for(const e of r)p(e);c=o,l=!1},reset:function(e={}){c&&e.consume&&p(c),l=!0,a=void 0,d="",u="",c=""}}}},46566:e=>{"use strict";e.exports=require("xml2js")},46747:(e,t,r)=>{"use strict";const o=r(8638);e.exports=(e="")=>{const t=e.match(o);if(!t)return null;const[r,n]=t[0].replace(/#! ?/,"").split(" "),s=r.split("/").pop();return"env"===s?n:n?`${s} ${n}`:s}},46823:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.WriteToFileToolFactory=void 0;const s=r(3563),i=r(76946),a=r(4243),c=r(79616);let l=class{constructor(e,t){this.fileValidationService=e,this.fileSystemEventService=t}getToolName(){return"write_to_file"}create(e){return new i.WriteToFileTool(e.workingDir,this.fileValidationService,this.fileSystemEventService,{planModeRestrictions:["Documentation files only (e.g., .md, .txt, .rst)","No source code modifications in plan mode","No configuration file changes in plan mode"]},e.currentMode)}};t.WriteToFileToolFactory=l,t.WriteToFileToolFactory=l=o([(0,s.Injectable)(),n("design:paramtypes",[a.FileValidationService,c.FileSystemEventService])],l)},47081:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateNewTaskTool=void 0;const a=r(3563),c=r(20436),l=i(r(19055));let d=o=class extends c.BaseTool{constructor(e){super(e),this.name="create_new_task",this.description="Create a new task with relevant context from the current task. This tool should be used when the user requests to start a new task and you need to provide focused context that will be useful for the new task.",l.default.info(`[${o.name}] CreateNewTaskTool initialized`)}getModeSpecificGuidance(e){return null}getBaseUsageInstructions(e){return"## create_new_task\nDescription: Create a new task with relevant context from the current task. This tool should be used when the user requests to start a new task and you need to provide focused context that will be useful for the new task.\nParameters:\n- context: (required) A focused context that combines relevant information from the current task with the new task instructions. Include information that would be useful for the new task based on the instructions provided:\n  * Relevant files and their purposes (focus on files that relate to the new task)\n  * Instructions to re-read specific files that were referenced in the original prompt (especially plan files, architecture documents, or other key reference materials that provide essential context for the new task)\n  * Key architectural decisions or patterns that apply to the new work\n  * Important dependencies, configurations, or setup details needed\n  * Current state of relevant parts of the project/codebase\n  * Specific technical details, code patterns, or conventions to follow\n  * Any constraints, requirements, or considerations for the new task\n  * Brief description of what was accomplished that relates to the new work\n  * The new task instructions and what should happen next\nUsage:\n<create_new_task>\n<context>Focused context for the new task including relevant background and new task instructions</context>\n</create_new_task>\n\nIMPORTANT: Focus on including information that will be useful for the new task rather than comprehensive details. The context should enable effective work on the new task without unnecessary information."}validateParams(e){return"string"==typeof e.context&&""!==e.context.trim()}async execute(e){const{context:t}=e;return l.default.info(`[${o.name}] Creating new task plan with context length: ${t.length} chars`),{type:"new_task_plan",context:t,timestamp:(new Date).toISOString(),success:!0}}};t.CreateNewTaskTool=d,t.CreateNewTaskTool=d=o=n([(0,a.Injectable)(),s("design:paramtypes",[Object])],d)},47205:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StoredFileService=void 0;const d=r(3563),u=r(37607),p=r(95775),f=r(44632),h=a(r(10904)),m=l(r(68817)),g=l(r(19055));let y=class{constructor(e){this.storedFileRepository=e}async uploadFile(e,t,r){let o=h.lookup(e.originalname);if(!o){const t=await m.default.fromBuffer(e.buffer);o=t?t.mime:"application/octet-stream"}const n=new u.StoredFile(e.originalname,e.buffer,o,t,r);return await this.storedFileRepository.create(n),g.default.info(`File uploaded: ${e.originalname} (${o}) for session: ${t||"none"}, workspace: ${r||"none"}`),p.StoredFileDto.fromStoredFile(n)}async getFile(e){const t=await this.storedFileRepository.findById(e);return t?g.default.info(`File retrieved: ${t.originalFilename} (${e})`):g.default.info(`File not found: ${e}`),t}async getFileMetadata(e){const t=await this.storedFileRepository.findByIdWithoutContent(e);return t?g.default.info(`File metadata retrieved: ${t.originalFilename} (${e})`):g.default.info(`File not found: ${e}`),t}async getAllFiles(){return this.storedFileRepository.findAll()}async deleteFile(e){const t=await this.storedFileRepository.findByIdWithoutContent(e);await this.storedFileRepository.delete(e),g.default.info(`File deleted: ${t?t.originalFilename:"unknown"} (${e})`)}async getFilesBySessionId(e){const t=await this.storedFileRepository.findBySessionId(e);return g.default.info(`Retrieved ${t.length} files for session: ${e}`),t}async getFilesByWorkspaceName(e){const t=await this.storedFileRepository.findByWorkspaceName(e);return g.default.info(`Retrieved ${t.length} files for workspace: ${e}`),t}};t.StoredFileService=y,t.StoredFileService=y=i([(0,d.Injectable)(),c("design:paramtypes",[f.StoredFileRepository])],y)},48010:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolExecutorService=void 0;const p=r(3563),f=r(50461),h=r(59100),m=c(r(70857)),g=c(r(28787)),y=u(r(19055)),v=r(96297),_=r(36780),w=r(55324),b=r(56550),k=r(56349),S=r(32398),T=r(88474),R=r(30538),C=r(56292),P=r(35499),E=r(72776),I=r(3563),O=r(35444),$=r(75870),M=r(91280),A=r(9581),x=r(2115);let D=n=class{constructor(e,t,r,o,s,i,a,c,l,d,u){this.eventEmitter=e,this.blockService=t,this.conversationHistoryService=r,this.toolProvider=o,this.mainWorkspaceService=s,this.homeService=i,this.personaRegistry=a,this.toolResultTransformerService=c,this.appDataSource=l,this.taskService=d,this.mcpHubService=u,this.setupEventListeners(),y.default.info(`[${n.name}] ToolExecutorService initialized`)}setupEventListeners(){y.default.info(`[${n.name}] Setting up batch tool execution listeners`)}decodeHtmlEntitiesInParams(e){if("string"==typeof e)return g.decode(e);if(Array.isArray(e))return e.map((e=>this.decodeHtmlEntitiesInParams(e)));if("object"==typeof e&&null!==e){const t={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=this.decodeHtmlEntitiesInParams(e[r]));return t}return e}async handleToolCallBatchDetected(e){const{clientId:t,taskId:r,toolCalls:o}=e;y.default.info(`[${n.name}] Tool batch detected for task ${r} with ${o.length} tools`),await this.executeBatch(t,r,o)}async executeBatch(e,t,r){const o=[];let s=!1;await this.taskService.updateTask({taskId:t,status:O.TaskStatus.EXECUTING_TOOL}),y.default.info(`[${n.name}] Task ${t} status set to ${O.TaskStatus.EXECUTING_TOOL} for batch`);for(let i=0;i<r.length&&!s;i++){const a=r[i],c=await this.executeToolInBatch(e,t,a,i);if(o.push(c),"error"===c.status||"rejected"===c.status||"awaiting_approval"===c.status){if(s=!0,"awaiting_approval"===c.status)return y.default.info(`[${n.name}] Batch execution paused for task ${t}, tool ${a.toolName} is awaiting user approval.`),await this.taskService.updateTask({taskId:t,status:O.TaskStatus.WAITING_FOR_INPUT}),void y.default.info(`[${n.name}] Task ${t} status set to ${O.TaskStatus.WAITING_FOR_INPUT} while awaiting tool approval.`);y.default.warn(`[${n.name}] Stopping batch execution for task ${t} due to ${c.status} on tool ${a.toolName}`);for(let e=i+1;e<r.length;e++){o.push({toolCall:r[e],status:"not_executed",result:{reason:`Previous tool '${a.toolName}' in batch ${c.status}.`},order:e});try{await this.blockService.updateBlock(r[e].blockId,{status:"error",errorText:`Not executed: Previous tool '${a.toolName}' failed or was rejected.`})}catch(t){y.default.error(`[${n.name}] Failed to update block status for not_executed tool ${r[e].toolName}: ${t.message}`)}}}}await this.createBatchResultMessage(t,o);const i=o[o.length-1];this.eventEmitter.emit(M.InternalEvents.TOOL_EXECUTION_COMPLETED,{clientId:e,taskId:t,blockId:i.toolCall.blockId,toolName:i.toolCall.toolName,result:{batchComplete:!0,totalToolsInBatch:r.length,executedTools:o.filter((e=>"success"===e.status||"error"===e.status||"rejected"===e.status)).length,summary:o},status:s?"error":"success"}),y.default.info(`[${n.name}] Batch execution completed for task ${t}. Emitted TOOL_EXECUTION_COMPLETED.`)}async parseToolParameters(e,t){y.default.debug(`[${n.name}] Raw block content for ${e.blockId} (tool ${t}):\n${e.content}`);let r=null;try{r=JSON.parse(e.content),y.default.info(`[${n.name}] Successfully parsed block content as JSON for block ${e.blockId}.`)}catch(o){y.default.info(`[${n.name}] Block content for ${e.blockId} is not valid JSON. Attempting XML parsing.`);try{if(r=(0,_.parseToolParams)(e.content,t),!r)throw new Error(`Failed to parse XML content for tool ${t}`);y.default.info(`[${n.name}] Successfully parsed block content as XML for tool ${t} (block ${e.blockId}).`)}catch(r){const o=`Failed to parse parameters for tool ${t} from block ${e.blockId}. Content was neither valid JSON nor parsable XML. Error: ${r.message}`;throw y.default.error(`[${n.name}] ${o}`),new Error(o)}}if(!r){const t=`Parameters object is null after parsing attempts for block ${e.blockId}.`;throw y.default.error(`[${n.name}] ${t}`),new Error(t)}return this.decodeHtmlEntitiesInParams(r)}async checkToolApproval(e,t,r,o){const s=await this.blockService.getBlock(o);if("approved"===s.status)return y.default.info(`[${n.name}] Tool ${t} (block ${o}) is already in 'approved' status, skipping approval check.`),!1;if("rejected"===s.status)throw y.default.warn(`[${n.name}] Tool ${t} (block ${o}) is in 'rejected' status. Execution should not proceed.`),new A.ToolExecutionError(`Tool ${t} was rejected by user.`,t,"TOOL_REJECTED");const i=r.requires_approval;let a;if(void 0!==i)a="string"==typeof i?"true"===i.toLowerCase():!!i,y.default.info(`[${n.name}] Approval for ${t} (task ${e}) determined by explicit 'requires_approval': ${a}`);else{a=!await this.shouldAutoApproveTool(e,t,r),y.default.info(`[${n.name}] Approval for ${t} (task ${e}) determined by auto-approval logic: ${a}`)}return a}async executeToolInBatch(e,t,r,o){const s=Date.now(),{blockId:i,toolName:a}=r;y.default.info(`[${n.name}] Executing tool ${a} (block ${i}) for task ${t}, order ${o}`);if((await this.taskService.getTask(t)).status===O.TaskStatus.USER_CANCELLED)return y.default.info(`[${n.name}] Task ${t} is cancelled, skipping tool ${a}`),await this.blockService.updateBlock(i,{status:"error",errorText:"Tool execution cancelled by user"}),{toolCall:r,status:"error",result:{error:"Tool execution cancelled by user"},order:o,executionTime:Date.now()-s};try{const c=await this.blockService.getBlock(i);if("rejected"===c.status)return y.default.warn(`[${n.name}] Tool ${a} (block ${i}) was already rejected. Stopping execution for this tool.`),{toolCall:r,status:"rejected",result:{reason:"Tool was rejected by user"},order:o,executionTime:Date.now()-s};const l=await this.parseToolParameters(c,a);if(await this.checkToolApproval(t,a,l,i))return y.default.info(`[${n.name}] Tool ${a} (block ${i}) requires user approval. Setting block to 'question'.`),"question"!==c.status&&await this.blockService.updateBlock(i,{status:"question"}),{toolCall:r,status:"awaiting_approval",result:{reason:"Tool requires user approval"},order:o,executionTime:Date.now()-s};await this.blockService.updateBlock(i,{status:"executing"});const d=await this.executeToolWithParams(t,a,l);await this.blockService.updateBlock(i,{status:"completed",output:"string"==typeof d?d:JSON.stringify(d,null,2)});const u=this.toolResultTransformerService.transformForClient(a,d);return this.eventEmitter.emit(M.InternalEvents.TOOL_EXECUTED,{clientId:e,taskId:t,toolName:a,result:u,blockId:i,wasTransformed:this.toolResultTransformerService.hasTransformerFor(a)}),{toolCall:r,status:"success",result:d,order:o,executionTime:Date.now()-s}}catch(c){const l=c instanceof A.EveAgentError?c:(0,A.toEveAgentError)(c);return y.default.error(`[${n.name}] Error executing tool ${a} (block ${i}): ${l.message}`),await this.blockService.updateBlock(i,{status:"error",errorText:l.message}),this.eventEmitter.emit(M.InternalEvents.TOOL_ERROR,{clientId:e,taskId:t,error:l.toUserMessage(),type:"tool_error",code:l.code,context:{toolName:a,blockId:i,...l.context}}),{toolCall:r,status:"error",result:{error:l.message,code:l.code,context:l.context},order:o,executionTime:Date.now()-s}}}async executeToolWithParams(e,t,r){if(!await this.isValidTool(e,t))throw new A.ToolExecutionError(`Tool ${t} is not valid for task ${e}`,t,"INVALID_TOOL");const o=await this.getTask(e);let n;const s=o.workspaceName;if(!s)throw new Error(`Task ${e} has no associated workspace name`);{const e=await this.mainWorkspaceService.findOne(s);if(!e)throw new I.NotFoundException(`Workspace '${s}' not found`);n=e.repoBaseDir}const i=await this.homeService.getUserData(),a={workingDir:n,user:{userId:o.userId,email:i.email},osInfo:{platform:m.platform(),release:m.release(),homeDir:m.homedir(),shell:process.env.SHELL||"/bin/bash"},currentMode:o.mode||"act",currentTime:(new Date).toLocaleDateString("en-GB"),getUserApiKey:async e=>{const t=await this.taskService.configService.findApiKeyForProvider(o.userId,e);return t?.apiKey},contextSizeCategory:$.ContextSizeCategory.MEDIUM},c=this.toolProvider.getTools([t],a);if(0===c.length)throw new A.ToolExecutionError(`Tool not found: ${t}`,t,"TOOL_NOT_FOUND");const l=c[0];return this.executeTool(l,r)}async createBatchResultMessage(e,t){const r=(0,h.ulid)(),o=[],s=t.filter((e=>"success"===e.status)).length,i=t.filter((e=>"error"===e.status)).length,a=t.filter((e=>"rejected"===e.status)).length,c=t.filter((e=>"not_executed"===e.status)).length;o.push({type:"text",content:`[Batch Execution Summary]\nTotal tools: ${t.length}\nSuccessful: ${s}\nFailed: ${i}\nRejected: ${a}\nNot executed: ${c}\n---`});for(const e of t){let t=`Tool: ${e.toolCall.toolName} (Block: ${e.toolCall.blockId})\nStatus: ${e.status.toUpperCase()}\n`;switch(void 0!==e.executionTime&&(t+=`Execution Time: ${e.executionTime}ms\n`),e.status){case"success":t+=`Result:\n${this.formatIndividualToolResult(e.result)}`;break;case"error":t+=`Error: ${e.result.error||JSON.stringify(e.result,null,2)}`,e.result.code&&(t+=`\nCode: ${e.result.code}`),e.result.context&&(t+=`\nContext: ${JSON.stringify(e.result.context,null,2)}`);break;case"rejected":t+=`Details: ${e.result.reason||"Tool execution was rejected by user"}`;break;case"not_executed":t+=`Reason: ${e.result.reason||"Not executed due to prior failure in batch"}`}o.push({type:"text",content:t+"\n---"})}const l={id:r,taskId:e,role:"user",segments:o,providerId:"system",createdAt:new Date};await this.conversationHistoryService.addMessage(e,l),y.default.info(`[${n.name}] Created batch result message ${r} for task ${e} with ${o.length-1} tool results.`)}formatIndividualToolResult(e){try{return"string"==typeof e?e:JSON.stringify(e,null,2)}catch(e){return"[Complex result that cannot be stringified]"}}async getTask(e){const t=await this.appDataSource.knex("eve_tasks").where({taskId:e}).first();if(!t)throw new Error(`Task ${e} not found`);return t}async shouldAutoApproveTool(e,t,r){return["read_file","list_files","list_code_definition_names","search_files","replace_in_file","write_to_file","web_search"].includes(t)?(y.default.debug(`[${n.name}] Tool ${t} is in safe tools list, auto-approving`),!0):"use_mcp_tool"===t?await this.checkMcpToolAutoApproval(e,r):(y.default.debug(`[${n.name}] Tool ${t} is not in safe tools list and not an MCP tool, requiring approval`),!1)}async checkMcpToolAutoApproval(e,t){try{if(!t||"object"!=typeof t)return y.default.warn(`[${n.name}] MCP tool parameters are missing or invalid for task ${e}, requiring approval`),!1;let r,o;if("string"!=typeof t.server_name||"string"!=typeof t.tool_name)return y.default.warn(`[${n.name}] MCP tool parameters missing server_name or tool_name for task ${e}, requiring approval`),!1;if(r=t.server_name.trim(),o=t.tool_name.trim(),!r||!o)return y.default.warn(`[${n.name}] Empty server_name or tool_name for MCP tool in task ${e}, requiring approval`),!1;const s=(await this.getTask(e)).userId,i=this.mcpHubService.getConnectedServers(s).find((e=>e.name===r));if(!i)return y.default.warn(`[${n.name}] MCP server '${r}' not found or not connected for user ${s}, requiring approval`),!1;const a=i.tools?.find((e=>e.name===o));if(!a)return y.default.warn(`[${n.name}] MCP tool '${o}' not found on server '${r}' for user ${s}, requiring approval`),!1;const c=a.autoApprove||!1;return y.default.info(`[${n.name}] MCP tool '${o}' on server '${r}' auto-approval status: ${c} for user ${s}`),c}catch(t){return y.default.error(`[${n.name}] Error checking MCP tool auto-approval for task ${e}: ${t.message}`,t),!1}}async getTools(){const e=process.cwd();y.default.warn(`[${n.name}] getTools using default working directory: ${e}. Implement proper default workspace handling.`);const t={workingDir:e,user:{userId:"default",email:"default@example.com"},osInfo:{platform:m.platform(),release:m.release(),homeDir:m.homedir(),shell:process.env.SHELL||"/bin/bash"},currentMode:"act",currentTime:(new Date).toLocaleDateString("en-GB"),getUserApiKey:async e=>{y.default.warn(`[${n.name}] Attempted to get API key for ${e} in a default context. This may not work as expected.`)},contextSizeCategory:$.ContextSizeCategory.MEDIUM},r=this.toolProvider.getAllToolFactories().map((e=>e.getToolName()));return this.toolProvider.getTools(r,t)}async isValidTool(e,t){try{const r=await this.getTask(e),o=await this.personaRegistry.getPersona(r.personaId,r.userId);return o.getAllToolNames().includes(t)}catch(e){return y.default.error(`[${n.name}] Error checking if tool is valid: ${e.message}\n${e.stack}`),!1}}async getToolInstance(e,t){try{const r=await this.getTask(e);let o;const n=r.workspaceName;if(!n)throw new Error(`Task ${e} has no associated workspace name`);{const e=await this.mainWorkspaceService.findOne(n);if(!e)throw new I.NotFoundException(`Workspace '${n}' not found`);o=e.repoBaseDir}const s=await this.homeService.getUserData(),i={workingDir:o,user:{userId:r.userId,email:s.email},osInfo:{platform:m.platform(),release:m.release(),homeDir:m.homedir(),shell:process.env.SHELL||"/bin/bash"},currentMode:r.mode||"act",currentTime:(new Date).toLocaleDateString("en-GB"),getUserApiKey:async e=>{const t=await this.taskService.configService.findApiKeyForProvider(r.userId,e);return t?.apiKey},contextSizeCategory:$.ContextSizeCategory.MEDIUM},a=this.toolProvider.getTools([t],i);return a.length>0?a[0]:void 0}catch(e){return void y.default.error(`[${n.name}] Error getting tool instance for ${t}: ${e.message}\n${e.stack}`)}}async executeTool(e,t){y.default.info(`[${n.name}] Executing tool: ${e.name}`);let r=t;if("string"==typeof t)try{let e=t.replace(/"\s*"([^"]+)":/g,'","$1":');r=JSON.parse(e)}catch(e){}if(r&&"string"==typeof r.requires_approval&&(r.requires_approval="true"===r.requires_approval.toLowerCase()),!e.validateParams(r)){const t=new A.ToolExecutionError(`Invalid parameters for tool ${e.name}`,e.name,"INVALID_PARAMS",{params:r});throw y.default.error(`[${n.name}] ${t.message}: ${JSON.stringify(r)}`),t}try{const t=await e.execute(r);y.default.info(`[${n.name}] Tool ${e.name} executed successfully`);const o=JSON.stringify(r),s=JSON.stringify(t);return v.debugLogger.log(`Tool executed: ${e.name}`,{params:o.length>200?o.substring(0,200)+"...":o,result:s.length>200?s.substring(0,200)+"...":s}),t}catch(t){const r=new A.ToolExecutionError(`Error executing tool ${e.name}: ${t.message}`,e.name,"TOOL_EXECUTION_FAILURE",{originalError:t});throw y.default.error(`[${n.name}] ${r.message}\n${t.stack}`),r}}};t.ToolExecutorService=D,a([(0,f.OnEvent)(M.InternalEvents.TOOL_CALL_BATCH_DETECTED),l("design:type",Function),l("design:paramtypes",[Object]),l("design:returntype",Promise)],D.prototype,"handleToolCallBatchDetected",null),t.ToolExecutorService=D=n=a([(0,p.Injectable)(),d(9,(0,p.Inject)((0,p.forwardRef)((()=>b.TaskService)))),l("design:paramtypes",[f.EventEmitter2,w.BlockService,k.ConversationHistoryService,S.ToolProvider,T.WorkspaceService,R.HomeService,C.PersonaRegistry,P.ToolResultTransformerService,E.AppDataSource,b.TaskService,x.McpHubService])],D)},48221:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.ReportingModule=void 0;const n=r(3563),s=r(50353),i=r(77510),a=r(376),c=r(57967);let l=class{};t.ReportingModule=l,t.ReportingModule=l=o([(0,n.Module)({imports:[a.DataSourceModule,c.ConfigModule],controllers:[s.ReportingController],providers:[i.ReportingService]})],l)},48230:e=>{"use strict";const t=/([()\][%!^"`<>&|;, *?])/g;e.exports.command=function(e){return e=e.replace(t,"^$1")},e.exports.argument=function(e,r){return e=(e=`"${e=(e=(e=`${e}`).replace(/(?=(\\+?)?)\1"/g,'$1$1\\"')).replace(/(?=(\\+?)?)\1$/,"$1$1")}"`).replace(t,"^$1"),r&&(e=e.replace(t,"^$1")),e}},48471:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PrivateCoderAgentService=void 0;const s=r(3563),i=r(70989),a=r(51e3),c=r(88474),l=r(7373),d=r(30538),u=r(93239),p=r(86158),f=r(81162),h=r(78921),m=r(93470);let g=class extends i.BaseToolCallingAgent{constructor(e,t,r,o,n,s,i){super(e,t,r,o,n,s,i)}getName(){return"private-coder-agent"}getModelCategory(){return f.ModelCategory.CODING}isPrivateModelsOnly(){return!0}getTools(e){const t=this.toolFactory.createTool("read_file",e),r=this.toolFactory.createTool("update_file",e),o=this.toolFactory.createTool("command_line",e),n=this.toolFactory.createTool("current_timestamp",e);return o.setPrivateRequired(!0),[t,r,o,n]}async getSpecificSystemPrompt(e){const t=await h.EpicsPrompts.updateStoryTasks(e);return`\nYou are an AI coding assistant focused on making high-quality code changes. Your task is to help implement the user's request by following this multi-step process:\n\n1. Initial Research (ALWAYS DO THIS FIRST):\n   a. Use the read_file tool to examine any relevant files before planning any changes.\n   b. Look at similar files in the codebase to understand:\n      - Code style and formatting conventions\n      - Use of DTOs vs use of domain entities etc\n      - Error handling patterns\n      - Logging practices\n      - Import organization\n      - Naming conventions\n      - Documentation style\n      - Tools and patterns being used\n   c. Never make assumptions about file contents - always verify with read_file\n   d. Study the existing patterns thoroughly before proceeding to planning.\n\n2. Planning (ONLY AFTER RESEARCH IS COMPLETE):\n   a. Based on the research, make a clear plan with multiple steps.\n   b. Break down complex changes into smaller, manageable steps.\n   c. Think through potential impacts on other parts of the codebase.\n   d. Consider how to maintain consistency with existing patterns.\n\n3. Implementation (FOLLOW PLAN STEP BY STEP):\n   a. Execute each step in the plan sequentially, explaining each change.\n   b. Make changes using the update_file tool, always providing all three arguments:\n      - filePath: The path to the file to modify\n      - search: The specific code block to replace\n      - replace: The new code block (never forget this!)\n   c. Keep changes focused and minimal - update only what's necessary.\n   d. Ensure code changes follow these principles:\n      - Clean, maintainable code structure\n      - Performance optimization\n      - Security best practices\n      - Scalability considerations\n      - Proper error handling\n      - Clear documentation\n      - Consistent with existing patterns (e.g. code style, formatting, naming conventions, dto's, repository patterns, etc)\n\n4. Testing:\n   a. After code changes, use the command_line tool to run: ${e.workspace.buildOrTestCommand}\n   b. If errors occur, analyze and fix them before proceeding.\n   c. Ensure all changes are properly tested.\n\n5. Summary:\n   Provide a concise final summary listing:\n   a. Files that were modified\n   b. Brief description of changes made to each file\n\nThe repository file structure is:\n${e.repositoryTree()}\n\n${e.repositoryHints()?`Additional hints provided by the user that must be adhered to:\n${e.repositoryHints()}`:""}\n\nIMPORTANT REMINDERS:\n- ALWAYS do thorough research first (use the read_file tool) and return that as a response\n- Keep reading more files if needed until you have a thorough understanding of the codebase\n- Then make a clear plan based on research findings and return that as a response (continue)\n- Then iterate through the plan step by step, using the update_file tool to make changes to the code\n- Keep changes minimal and focused (use the update_file tool)\n- Build/Test after making changes (use the command_line tool)\n- Provide clear, concise summaries\n\n# Task Management Instructions\n${t}\n\nIMPORTANT: When implementing tasks:\n1. Always check the task status in the task JSON file before starting work\n2. Update the task status to "inprogress" when you start working on it\n3. Update the task status to "done" when you complete it\n4. Always use current_timestamp to update the updatedAt field when changing task status\n5. Remember that task status changes may require updating the parent story status\n\n- COMMAND LINE TOOL RESTRICTIONS:\n  * Only use the command_line tool for:\n    1. Running the build/test command (${e.workspace.buildOrTestCommand})\n    2. Installing new local packages for the project\n  * Never use it for any other system changes\n  * Never traverse up above the workspace directory\n  * Always include automatic confirmation flags (--yes, -y, --force, etc.) for package installations\n`}};t.PrivateCoderAgentService=g,t.PrivateCoderAgentService=g=o([(0,s.Injectable)(),n("design:paramtypes",[c.WorkspaceService,l.SessionService,d.HomeService,u.SummaryCompletion,p.ToolFactoryService,a.CheckpointerService,m.AgentRuleService])],g)},48483:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseProvider=void 0;const n=r(8959),s=o(r(19055)),i=r(32088);t.BaseProvider=class{async getModelDescriptor(e){const t=await this.getModelDescriptors();if(!e)return t[0];const r=this.shortModelName(e),o=t.find((e=>e.name===r));if(!o&&this.supportsOnDemandModels())return new n.ModelDescriptor(this.getName(),r,0,0,0,0);if(!o)throw new Error(`Model ${r} not found for provider ${this.getName()}`);return o}shortModelName(e){const t=e.indexOf("/");if(-1===t)throw new Error(`Model name ${e} is not in the format provider/model`);return e.substring(t+1)||e}getChatModelOptions(e,t){return new i.ChatModelOptions}isPromptCachingEnabled(e){const t=!0===e?.cachePrompt;return s.default.info("isPromptCachingEnabled - cachePrompt: %s, result: %s",e?.cachePrompt,t),t}supportsOnDemandModels(){return!1}}},48624:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.StoredFileModule=void 0;const n=r(3563),s=r(75056),i=r(47205),a=r(44632),c=r(376);let l=class{};t.StoredFileModule=l,t.StoredFileModule=l=o([(0,n.Module)({imports:[c.DataSourceModule],controllers:[s.StoredFileController],providers:[i.StoredFileService,a.StoredFileRepository],exports:[i.StoredFileService]})],l)},48884:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEnv=function(e,t){let r;"undefined"!=typeof process&&process.env?r=process.env[e]:"undefined"!=typeof globalThis&&"Deno"in globalThis?r=globalThis.Deno.env.get(e):console.warn(`Unable to access environment variables. Key: ${e}`);return void 0!==r?r:t}},49235:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ListFilesToolFactory=void 0;const s=r(3563),i=r(90062),a=r(22141),c=r(44155),l=r(37526);let d=class{constructor(e,t,r){this.fileSystemService=e,this.responseFormatter=t,this.ignoreConfigService=r}getToolName(){return"list_files"}create(e){return new i.ListFilesTool(this.fileSystemService,this.responseFormatter,this.ignoreConfigService,e.workingDir,{availableInPlan:!0,availableInAct:!0})}};t.ListFilesToolFactory=d,t.ListFilesToolFactory=d=o([(0,s.Injectable)(),n("design:paramtypes",[a.FileSystemService,c.ResponseFormatterService,l.IgnoreConfigService])],d)},49556:e=>{"use strict";e.exports=require("@nestjs/platform-express")},49819:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(46410);class n extends Event{constructor(e,t){var r,o;super(e),this.code=null!=(r=null==t?void 0:t.code)?r:void 0,this.message=null!=(o=null==t?void 0:t.message)?o:void 0}[Symbol.for("nodejs.util.inspect.custom")](e,t,r){return r(i(this),t)}[Symbol.for("Deno.customInspect")](e,t){return e(i(this),t)}}function s(e){return e instanceof Error?"errors"in e&&Array.isArray(e.errors)?e.errors.map(s).join(", "):"cause"in e&&e.cause instanceof Error?`${e}: ${s(e.cause)}`:e.message:`${e}`}function i(e){return{type:e.type,message:e.message,code:e.code,defaultPrevented:e.defaultPrevented,cancelable:e.cancelable,timeStamp:e.timeStamp}}var a,c,l,d,u,p,f,h,m,g,y,v,_,w,b,k,S,T,R,C,P,E,I,O=e=>{throw TypeError(e)},$=(e,t,r)=>t.has(e)||O("Cannot "+r),M=(e,t,r)=>($(e,t,"read from private field"),r?r.call(e):t.get(e)),A=(e,t,r)=>t.has(e)?O("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),x=(e,t,r,o)=>($(e,t,"write to private field"),t.set(e,r),r),D=(e,t,r)=>($(e,t,"access private method"),r);class N extends EventTarget{constructor(e,t){var r,n;super(),A(this,w),this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,A(this,a),A(this,c),A(this,l),A(this,d),A(this,u),A(this,p),A(this,f),A(this,h,null),A(this,m),A(this,g),A(this,y,null),A(this,v,null),A(this,_,null),A(this,k,(async e=>{var t;M(this,g).reset();const{body:r,redirected:o,status:n,headers:s}=e;if(204===n)return D(this,w,P).call(this,"Server sent HTTP 204, not reconnecting",204),void this.close();if(x(this,l,o?new URL(e.url):void 0),200!==n)return void D(this,w,P).call(this,`Non-200 status code (${n})`,n);if(!(s.get("content-type")||"").startsWith("text/event-stream"))return void D(this,w,P).call(this,'Invalid content type, expected "text/event-stream"',n);if(M(this,a)===this.CLOSED)return;x(this,a,this.OPEN);const i=new Event("open");if(null==(t=M(this,_))||t.call(this,i),this.dispatchEvent(i),"object"!=typeof r||!r||!("getReader"in r))return D(this,w,P).call(this,"Invalid response body, expected a web ReadableStream",n),void this.close();const c=new TextDecoder,d=r.getReader();let u=!0;do{const{done:e,value:t}=await d.read();t&&M(this,g).feed(c.decode(t,{stream:!e})),e&&(u=!1,M(this,g).reset(),D(this,w,E).call(this))}while(u)})),A(this,S,(e=>{x(this,m,void 0),"AbortError"!==e.name&&"aborted"!==e.type&&D(this,w,E).call(this,s(e))})),A(this,R,(e=>{"string"==typeof e.id&&x(this,h,e.id);const t=new MessageEvent(e.event||"message",{data:e.data,origin:M(this,l)?M(this,l).origin:M(this,c).origin,lastEventId:e.id||""});M(this,v)&&(!e.event||"message"===e.event)&&M(this,v).call(this,t),this.dispatchEvent(t)})),A(this,C,(e=>{x(this,p,e)})),A(this,I,(()=>{x(this,f,void 0),M(this,a)===this.CONNECTING&&D(this,w,b).call(this)}));try{if(e instanceof URL)x(this,c,e);else{if("string"!=typeof e)throw new Error("Invalid URL");x(this,c,new URL(e,function(){const e="document"in globalThis?globalThis.document:void 0;return e&&"object"==typeof e&&"baseURI"in e&&"string"==typeof e.baseURI?e.baseURI:void 0}()))}}catch{throw function(e){const t=globalThis.DOMException;return"function"==typeof t?new t(e,"SyntaxError"):new SyntaxError(e)}("An invalid or illegal string was specified")}x(this,g,o.createParser({onEvent:M(this,R),onRetry:M(this,C)})),x(this,a,this.CONNECTING),x(this,p,3e3),x(this,u,null!=(r=null==t?void 0:t.fetch)?r:globalThis.fetch),x(this,d,null!=(n=null==t?void 0:t.withCredentials)&&n),D(this,w,b).call(this)}get readyState(){return M(this,a)}get url(){return M(this,c).href}get withCredentials(){return M(this,d)}get onerror(){return M(this,y)}set onerror(e){x(this,y,e)}get onmessage(){return M(this,v)}set onmessage(e){x(this,v,e)}get onopen(){return M(this,_)}set onopen(e){x(this,_,e)}addEventListener(e,t,r){const o=t;super.addEventListener(e,o,r)}removeEventListener(e,t,r){const o=t;super.removeEventListener(e,o,r)}close(){M(this,f)&&clearTimeout(M(this,f)),M(this,a)!==this.CLOSED&&(M(this,m)&&M(this,m).abort(),x(this,a,this.CLOSED),x(this,m,void 0))}}a=new WeakMap,c=new WeakMap,l=new WeakMap,d=new WeakMap,u=new WeakMap,p=new WeakMap,f=new WeakMap,h=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,v=new WeakMap,_=new WeakMap,w=new WeakSet,b=function(){x(this,a,this.CONNECTING),x(this,m,new AbortController),M(this,u)(M(this,c),D(this,w,T).call(this)).then(M(this,k)).catch(M(this,S))},k=new WeakMap,S=new WeakMap,T=function(){var e;const t={mode:"cors",redirect:"follow",headers:{Accept:"text/event-stream",...M(this,h)?{"Last-Event-ID":M(this,h)}:void 0},cache:"no-store",signal:null==(e=M(this,m))?void 0:e.signal};return"window"in globalThis&&(t.credentials=this.withCredentials?"include":"same-origin"),t},R=new WeakMap,C=new WeakMap,P=function(e,t){var r;M(this,a)!==this.CLOSED&&x(this,a,this.CLOSED);const o=new n("error",{code:t,message:e});null==(r=M(this,y))||r.call(this,o),this.dispatchEvent(o)},E=function(e,t){var r;if(M(this,a)===this.CLOSED)return;x(this,a,this.CONNECTING);const o=new n("error",{code:t,message:e});null==(r=M(this,y))||r.call(this,o),this.dispatchEvent(o),x(this,f,setTimeout(M(this,I),M(this,p)))},I=new WeakMap,N.CONNECTING=0,N.OPEN=1,N.CLOSED=2,t.ErrorEvent=n,t.EventSource=N},50042:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DocxToHtml=void 0;const u=r(83153),p=r(3563),f=r(47205),h=a(r(79896)),m=a(r(16928)),g=a(r(70857)),y=d(r(19055)),v=r(83229);let _=class extends u.Tool{constructor(e){super(),this.storedFileService=e,this.name="docx_to_html",this.description="Converts a DOCX file to HTML. Takes a stored file ID as input and returns the generated HTML content directly."}async _call(e){try{const t=await this.storedFileService.getFile(e);if(!t)throw new Error(`File with ID ${e} not found`);y.default.info("Converting DOCX to HTML");const r=await(0,v.convertDocxToHtml)(t.fileContents,{wrapperElement:"html",removeImages:!0}),o=g.tmpdir(),n=m.join(o,`docx-${Date.now()}.html`);return h.writeFileSync(n,r,"utf8"),y.default.info(`HTML content written to temp file: ${n}`),r}catch(e){throw new Error(`Failed to convert DOCX to HTML: ${e.message}`)}}};t.DocxToHtml=_,t.DocxToHtml=_=i([(0,p.Injectable)(),l(0,(0,p.Inject)(f.StoredFileService)),c("design:paramtypes",[f.StoredFileService])],_)},50074:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProviderErrorMapperRegistry=void 0;const i=r(3563),a=r(93053),c=r(9581),l=s(r(19055));let d=class{constructor(){this.mappers=new Map,this.registerMapper("anthropic",new a.AnthropicErrorMapper),l.default.info("[ProviderErrorMapperRegistry] Initialized with default mappers")}registerMapper(e,t){this.mappers.set(e,t),l.default.debug(`[ProviderErrorMapperRegistry] Registered mapper for provider: ${e}`)}getMapper(e){return this.mappers.get(e)}mapError(e,t){const r=this.mappers.get(e);if(r)try{return r.mapToEveAgentError(t)}catch(r){return l.default.error(`[ProviderErrorMapperRegistry] Error mapping error for provider ${e}: ${r.message}`),(0,c.toEveAgentError)(t)}return l.default.warn(`[ProviderErrorMapperRegistry] No mapper found for provider: ${e}. Using generic mapping.`),(0,c.toEveAgentError)(t)}isRateLimitError(e,t){const r=this.mappers.get(e);return!!r&&r.isRateLimitError(t)}extractRetryAfter(e,t){const r=this.mappers.get(e);return r?r.extractRetryAfter(t):void 0}getRegisteredProviders(){return Array.from(this.mappers.keys())}};t.ProviderErrorMapperRegistry=d,t.ProviderErrorMapperRegistry=d=o([(0,i.Injectable)(),n("design:paramtypes",[])],d)},50150:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserRulesComponent=void 0;t.UserRulesComponent=class{constructor(){this.id="user-rules",this.name="User Rules",this.description="Include custom rules from .everules files and user-enabled rules",this.category="optional",this.canOptOut=!0,this.defaultEnabled=!0}getContent(e){return"{{USER_RULES_PLACEHOLDER}}"}}},50251:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Epic=void 0;const o=r(59100),n=r(57655);t.Epic=class{constructor(e,t,r,n=[],s=(0,o.ulid)(),i=new Date,a=new Date){this.id=s,this.title=e,this.description=t,this.workspaceName=r,this.stories=n,this.createdAt=i,this.updatedAt=a}addStory(e){this.stories.push(e),this.updatedAt=new Date}removeStory(e){this.stories=this.stories.filter((t=>t.id!==e)),this.updatedAt=new Date}getStatus(){return 0===this.stories.length?n.StoryStatus.BACKLOG:this.stories.every((e=>e.status===n.StoryStatus.DONE))?n.StoryStatus.DONE:this.stories.some((e=>e.status===n.StoryStatus.IN_PROGRESS))?n.StoryStatus.IN_PROGRESS:n.StoryStatus.BACKLOG}}},50353:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReportingController=void 0;const i=r(3563),a=r(77510);let c=class{constructor(e){this.reportingService=e}async getReport(e,t,r,o){return this.reportingService.generateReport(e,t,r,o)}};t.ReportingController=c,o([(0,i.Get)("report"),s(0,(0,i.Query)("from")),s(1,(0,i.Query)("to")),s(2,(0,i.Query)("period")),s(3,(0,i.Query)("workspaceName")),n("design:type",Function),n("design:paramtypes",[String,String,String,String]),n("design:returntype",Promise)],c.prototype,"getReport",null),t.ReportingController=c=o([(0,i.Controller)("reporting"),n("design:paramtypes",[a.ReportingService])],c)},50456:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OllamaProvider=void 0;const i=r(3563),a=r(36206),c=r(91760),l=r(11778),d=r(98055),u=s(r(19055));let p=class{constructor(e,t){this.providerRegistry=e,this.openSourceModelRegistry=t,u.default.info("[OllamaProvider] Initialized"),this.providerRegistry.registerProvider(this)}getId(){return d.OLLAMA_PROVIDER_ID}getName(){return"Ollama"}getMetadata(){return{website:"https://ollama.ai",docs_link:"https://ollama.ai/docs",api_version:"v1",default_base_url:d.DEFAULT_OLLAMA_BASE_URL,is_local:!0,requires_server:!0}}requiresApiKey(){return!1}getDefaultBaseUrl(){return this.config?.ollamaBaseUrl||d.DEFAULT_OLLAMA_BASE_URL}getDefaultModelId(){return(0,d.getDefaultOllamaModelId)()}getApiKeyName(){return"OLLAMA_API_KEY"}setConfig(e){this.config=e}getModelClient(e){const t={...e,baseUrl:e.baseUrl||this.config?.ollamaBaseUrl||d.DEFAULT_OLLAMA_BASE_URL},r=new l.OllamaModelClient(t,{enableVerboseLogging:!1});return this.discoverModels(t.baseUrl).then((t=>{const o=t.find((t=>t.modelId===e.modelId));o?r.setModelMetadata(o):u.default.debug(`[OllamaProvider] Metadata not found for model ${e.modelId}`)})).catch((e=>{u.default.debug(`[OllamaProvider] Failed to discover models: ${e.message}`)})),r}getProviderMetadata(){return{providerId:d.OLLAMA_PROVIDER_ID,name:"Ollama",description:"Local Ollama server for running open source models with privacy and control",website:"https://ollama.ai",docsLink:"https://ollama.ai/docs",requiresApiKey:!1,defaultModelId:(0,d.getDefaultOllamaModelId)(),apiKeyName:"OLLAMA_API_KEY",features:{supportsStreaming:!0,supportsCaching:!1,supportsTools:!0,supportsImages:!0,supportsThinking:!1}}}getStaticModels(){return[]}async discoverDynamicModels(e,t){const r=t||this.getDefaultBaseUrl();return{models:await(0,d.discoverOllamaModels)(r,this.openSourceModelRegistry),discoveredAt:new Date,discoveryMethod:"api",source:r}}requiresApiKeyForDiscovery(){return!1}async discoverModels(e,t){return(0,d.discoverOllamaModels)(t||this.getDefaultBaseUrl(),this.openSourceModelRegistry)}};t.OllamaProvider=p,t.OllamaProvider=p=o([(0,i.Injectable)(),n("design:paramtypes",[a.ProviderRegistry,c.OpenSourceModelRegistryService])],p)},50461:e=>{"use strict";e.exports=require("@nestjs/event-emitter")},51e3:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CheckpointerService=void 0;const s=r(3563),i=r(19314);let a=class{constructor(){this.checkpointer=new i.MemorySaver,this.stateMap=new Map}getCheckpointer(){return this.checkpointer}async saveState(e,t){this.stateMap.set(e,t)}async loadState(e){return this.stateMap.get(e)||null}};t.CheckpointerService=a,t.CheckpointerService=a=o([(0,s.Injectable)(),n("design:paramtypes",[])],a)},51921:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VERCEL_PROVIDER_ID=void 0,t.discoverVercelModels=async function(e,t,r){const o=t;try{const t=await async function(e,t){try{s.default.info(`[VercelModels] Attempting dynamic model discovery from: ${t}`);const r=new n.default({baseURL:t,apiKey:e}),o=await r.models.list();if(!o.data||0===o.data.length)return s.default.warn("[VercelModels] No models returned from dynamic discovery"),[];s.default.info(`[VercelModels] Discovered ${o.data.length} models dynamically`);const i=o.data.map(a);return i.sort(((e,t)=>{if(e.isDefaultForProvider&&!t.isDefaultForProvider)return-1;if(!e.isDefaultForProvider&&t.isDefaultForProvider)return 1;const r=e.metadata?.version||"0",o=(t.metadata?.version||"0").localeCompare(r);if(0!==o)return o;const n={medium:0,large:1,small:2},s=e.metadata?.size||"medium",i=t.metadata?.size||"medium";return(n[s]||0)-(n[i]||0)})),i}catch(e){return s.default.warn(`[VercelModels] Dynamic model discovery failed: ${e.message}`),[]}}(e,o);return t.length>0?(s.default.info(`[VercelModels] Using ${t.length} dynamically discovered models`),await c(t,r)):(s.default.info(`[VercelModels] Using ${i.length} static models as fallback`),await c([...i],r))}catch(e){return s.default.error(`[VercelModels] Model discovery failed for ${o}: ${e.message}`),s.default.info("[VercelModels] Using static models without enhancement due to error"),[...i]}},t.getDefaultVercelModelId=function(){return"v0-1.5-md"},t.getStaticVercelModels=function(){return[...i]};const n=o(r(56082)),s=o(r(19055));t.VERCEL_PROVIDER_ID="vercel";const i=[{modelId:"v0-1.5-md",providerId:t.VERCEL_PROVIDER_ID,name:"v0 1.5 Medium",contextWindow:128e3,maxOutputTokens:32768,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:3,outputCostPerMillionTokens:15,isDefaultForProvider:!0,metadata:{isVision:!0,isCode:!0,isInstruct:!0,modelOwner:"Vercel",category:"ui-generation",version:"1.5",size:"medium",specialties:["react","ui-design","frontend","components"]}},{modelId:"v0-1.5-lg",providerId:t.VERCEL_PROVIDER_ID,name:"v0 1.5 Large",contextWindow:128e3,maxOutputTokens:32768,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:15,outputCostPerMillionTokens:75,isDefaultForProvider:!1,metadata:{isVision:!0,isCode:!0,isInstruct:!0,modelOwner:"Vercel",category:"ui-generation",version:"1.5",size:"large",specialties:["react","ui-design","frontend","components","complex-layouts"]}},{modelId:"v0-1.5-sm",providerId:t.VERCEL_PROVIDER_ID,name:"v0 1.5 Small",contextWindow:32768,maxOutputTokens:8192,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:.5,outputCostPerMillionTokens:2.5,isDefaultForProvider:!1,metadata:{isVision:!0,isCode:!0,isInstruct:!0,modelOwner:"Vercel",category:"ui-generation",version:"1.5",size:"small",specialties:["react","ui-design","simple-components"]}},{modelId:"v0-1.0-md",providerId:t.VERCEL_PROVIDER_ID,name:"v0 1.0 Medium (Legacy)",contextWindow:128e3,maxOutputTokens:32768,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:3,outputCostPerMillionTokens:15,isDefaultForProvider:!1,metadata:{isVision:!0,isCode:!0,isInstruct:!0,modelOwner:"Vercel",category:"ui-generation",version:"1.0",size:"medium",isLegacy:!0,specialties:["react","ui-design","frontend"]}}];function a(e){const r=e.id,o="model"===e.object?e.display_name||function(e){return e.replace(/v0-/,"v0 ").replace(/(\d+)\.(\d+)/,"$1.$2").replace(/-md$/," Medium").replace(/-lg$/," Large").replace(/-sm$/," Small").replace(/\b\w/g,(e=>e.toUpperCase())).trim()}(r):r,n=i.find((e=>e.modelId===r));if(n)return{...n,name:o||n.name};const s=r.includes("1.0")||r.includes("legacy"),a=r.includes("lg")||r.includes("large"),c=r.includes("sm")||r.includes("small");return{modelId:r,providerId:t.VERCEL_PROVIDER_ID,name:o,contextWindow:c?32768:128e3,maxOutputTokens:c?8192:32768,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:a?15:c?.5:3,outputCostPerMillionTokens:a?75:c?2.5:15,isDefaultForProvider:"v0-1.5-md"===r,metadata:{isVision:!0,isCode:!0,isInstruct:!0,modelOwner:"Vercel",category:"ui-generation",isLegacy:s,specialties:["react","ui-design","frontend","components"]}}}async function c(e,t){try{const r=[];for(const o of e)try{const e=await t.searchModels({query:"ui generation react components",fuzzyMatch:!0});if(e.length>0){e[0];o.metadata={...o.metadata,registryEnhancement:{similarModels:e.slice(0,3).map((e=>e.model.modelId)),relatedCapabilities:["ui-generation","code-generation","react"],enhancedAt:(new Date).toISOString()}}}r.push(o)}catch(e){s.default.warn(`[VercelModels] Failed to enhance ${o.modelId} with registry: ${e.message}`),r.push(o)}return r}catch(t){return s.default.warn(`[VercelModels] Registry enhancement failed: ${t.message}`),e}}},51991:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TaskHistoryController=void 0;const a=r(3563),c=r(36647),l=r(19668),d=i(r(19055));let u=class{constructor(e,t){this.taskHistoryService=e,this.userService=t}async getTaskSummaries(e,t,r){try{const e=await this.userService.getCurrentUser();d.default.debug(`Received request for task summaries from user ${e.userId} with limit ${t||"default"} and workspace ${r||"all"}`);return await this.taskHistoryService.getTaskSummaries(e.userId,t,r)}catch(e){if(e instanceof l.AuthenticationError)throw d.default.error(`[TaskHistoryController] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw d.default.error(`Error in getTaskSummaries endpoint: ${e.message}`,e.stack),e}}async getTaskEvents(e,t){try{const e=await this.userService.getCurrentUser();d.default.debug(`Received request for events of task ${t} from user ${e.userId}`);return await this.taskHistoryService.getTaskEvents(t,e.userId)}catch(e){if(e instanceof l.AuthenticationError)throw d.default.error(`[TaskHistoryController] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw d.default.error(`Error in getTaskEvents endpoint: ${e.message}`,e.stack),e}}async deleteTask(e,t){try{const e=await this.userService.getCurrentUser();return d.default.info(`Received request to delete task ${t} from user ${e.userId}`),await this.taskHistoryService.deleteTask(t,e.userId),d.default.info(`Successfully deleted task ${t} for user ${e.userId}`),{success:!0,message:"Task deleted successfully"}}catch(e){if(e instanceof l.AuthenticationError)throw d.default.error(`[TaskHistoryController] Authentication error in deleteTask: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);if(e instanceof a.UnauthorizedException)throw d.default.error(`[TaskHistoryController] Authorization error in deleteTask: ${e.message}`),e;throw d.default.error(`Error in deleteTask endpoint: ${e.message}`,e.stack),e}}};t.TaskHistoryController=u,o([(0,a.Get)("/summaries"),s(0,(0,a.Request)()),s(1,(0,a.Query)("limit")),s(2,(0,a.Query)("workspace")),n("design:type",Function),n("design:paramtypes",[Object,Number,String]),n("design:returntype",Promise)],u.prototype,"getTaskSummaries",null),o([(0,a.Get)("/:taskId/events"),s(0,(0,a.Request)()),s(1,(0,a.Param)("taskId")),n("design:type",Function),n("design:paramtypes",[Object,String]),n("design:returntype",Promise)],u.prototype,"getTaskEvents",null),o([(0,a.Delete)("/:taskId"),s(0,(0,a.Request)()),s(1,(0,a.Param)("taskId")),n("design:type",Function),n("design:paramtypes",[Object,String]),n("design:returntype",Promise)],u.prototype,"deleteTask",null),t.TaskHistoryController=u=o([(0,a.Controller)("/eve-agent/task-history"),n("design:paramtypes",[c.TaskHistoryService,l.UserService])],u)},52368:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigService=void 0;const a=r(3563),c=r(35699),l=i(r(19055)),d=r(33713),u=r(76910);let p=o=class{constructor(e){this.configPropertyRepository=e,this.configCache=new Map,this.possibleValuesCache=new Map,o.instance=this,this.cachedDescriptors=d.ConfigDescriptors.getDefaultDescriptors()}static getInstance(){if(!o.instance)throw new Error("ConfigService has not been initialized");return o.instance}static getProperty(e,t){return o.getInstance().getProperty(e,t)}static getNumericProperty(e,t){return o.getInstance().getNumericProperty(e,t)}static getBooleanProperty(e,t){return o.getInstance().getBooleanProperty(e,t)}async onModuleInit(){try{await this.loadConfigToCache()}catch(e){l.default.error(`[${o.name}] Failed to load config properties to cache`,e)}}async loadConfigToCache(){try{const e=await this.configPropertyRepository.getAllProperties();this.configCache.clear();for(const t of e)this.configCache.set(t.name,t.value);l.default.info(`[${o.name}] Config properties loaded to cache successfully`)}catch(e){throw l.default.error(`[${o.name}] Error loading config properties to cache`,e),e}}async getConfig(){const e=new Map,t=[],r=d.ConfigDescriptors.getDefaultDescriptors();for(const t of r.sections)for(const r of t.properties){const t=this.getProperty(r.name);if(null!==t&&e.set(r.name,r.sensitive?this.maskValue(t):t),"function"==typeof r.possibleValues){const e=this.possibleValuesCache.get(r.possibleValues);if(e)r.possibleValues=e;else{const e=await r.possibleValues();this.possibleValuesCache.set(r.possibleValues,e),r.possibleValues=e}}}return null===this.getProperty(u.ConfigPropNames.EVE_API_KEY)&&t.push("You need to set the Eve API Key which you can get from incept5.github.io/eve-web-admin"),null===this.getProperty(u.ConfigPropNames.ANTHROPIC_API_KEY)&&t.push("You need to set the Anthropic API Key which you can get from console.anthropic.com"),{version:"2.10.0",mode:process.env.MODE||"normal",descriptors:r,currentValues:Object.fromEntries(e),requiredActions:t.length>0?t:void 0}}getProperty(e,t){const r=process.env[e];if(void 0!==r)return r;const n=this.configCache.get(e);if(void 0!==n)return n;const s=this.findDescriptor(e);return s?s?.defaultValue?s.defaultValue.toString():t||null:(l.default.warn(`[${o.name}] Unknown property: ${e}`),null)}getNumericProperty(e,t){const r=this.getProperty(e);return null!==r?parseFloat(r):t||null}getBooleanProperty(e,t){const r=this.getProperty(e);return null!==r?"true"===r.toLowerCase():t||null}findDescriptor(e){for(const t of this.cachedDescriptors.sections){const r=t.properties.find((t=>t.name===e));if(r)return r}}async setProperty(e,t){try{t?(await this.configPropertyRepository.setProperty(e,t),this.configCache.set(e,t)):await this.unsetProperty(e)}catch(t){throw l.default.error(`[${o.name}] Error setting property ${e}`,t),t}}async unsetProperty(e){try{await this.configPropertyRepository.deleteProperty(e),this.configCache.delete(e)}catch(t){throw l.default.error(`[${o.name}] Error unsetting property ${e}`,t),t}}async getAllProperties(){return Array.from(this.configCache.entries()).map((([e,t])=>({name:e,value:t})))}maskValue(e){if(!e)return"not set";if(e.length<20)return"*".repeat(e.length);const t=e.length-8-4;return e.slice(0,8)+"*".repeat(t)+e.slice(-4)}};t.ConfigService=p,t.ConfigService=p=o=n([(0,a.Injectable)(),s("design:paramtypes",[c.ConfigPropertyRepository])],p)},53229:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReviewAgentService=void 0;const a=r(3563),c=r(86158),l=r(93470),d=i(r(19055)),u=r(22300),p=r(55277);let f=class extends p.GraphAgentService{constructor(e,t,r){super(e,t,r),this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}getName(){return"review-agent"}async getTools(e){return await this.toolFactoryService.createTools(["read_file","update_file","delete_file","command_line","fetch_web_page","read_dependency_source_tree","read_dependency_source_file","git_commit","remote_git"],e)}async getSystemPrompt(e){let t=`As an AI code review assistant, you are tasked with analyzing and reviewing code changes in a pull request or specific commit.\n  Follow these guidelines:\n  1. The user input will be a URL to a pull request or a specific commit hash.\n  2. Use the "remote-git" toolkit (not implemented yet) to:\n     a. Sync the workspace to match the state of the commit/pull request.\n     b. Fetch the contents of the commit or the pull request (including comments).\n  3. Perform a thorough evaluation of the changes being made, considering:\n     a. Code quality and readability\n     b. Adherence to best practices and design patterns\n     c. Performance implications\n     d. Security considerations\n     e. Potential bugs or issues\n     f. Test coverage\n  4. Use the "remote-git" toolkit to add comments to specific parts of the code where:\n     a. Issues should be pointed out\n     b. Improvements can be suggested\n     c. Clarifications are needed\n  5. Provide a summary of the code changes, including:\n     a. An overview of the main changes\n     b. A list of files modified\n     c. Key points from your review\n     d. Any major concerns or praises\n  6. Use the read_file tool to examine the contents of specific files when needed.\n  7. If you need to reference or compare with existing code, use the read_file tool to retrieve the contents of those files.\n  8. Be constructive and respectful in your comments and feedback.\n  9. Prioritize the most important issues and suggestions in your review.\n  10. Consider the overall impact of the changes on the project's architecture and maintainability.\n\n  Here is the file tree of the system:\n  ${e.repositoryTree()}\n  \n  ${e.repositoryHints()?`Additional hints:\n${e.repositoryHints()}`:""}\n  \n  IMPORTANT: Remember that the "remote-git" toolkit is not implemented yet. When it becomes available, use it to fetch and interact with the pull request or commit data.\n  IMPORTANT: Focus on providing a thorough code review rather than making direct changes to the codebase.\n  IMPORTANT: Ensure your comments and suggestions are clear, specific, and actionable.\n  IMPORTANT: If you need to reference any existing files in the project, use the read_file tool to fetch their contents.\n  `;return d.default.debug(`Review Agent system prompt for workspace '${e.workspace.name}' (length: ${t.length} chars): ${t}`),t}};t.ReviewAgentService=f,t.ReviewAgentService=f=o([(0,a.Injectable)(),s(0,(0,a.Inject)((0,a.forwardRef)((()=>u.GraphAgentCollaborator)))),n("design:paramtypes",[u.GraphAgentCollaborator,c.ToolFactoryService,l.AgentRuleService])],f)},53716:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GitInit=void 0;const c=r(83153),l=r(11569),d=a(r(19055)),u=i(r(16928)),p=i(r(79896)),f=a(r(83807));class h extends c.Tool{constructor(e){super(),this.name="git_init",this.description="Initialize a git repository in the specified directory if it's not already a git repository",this.schema=l.z.object({folder:l.z.string().describe("The folder relative to the workspace root to initialize as a git repository")}),this.workspaceRootDir=e,this.maxOutputChars=parseInt(process.env.MAX_TOOL_OUTPUT_CHARS||"2000",10)}clipOutput(e){return e.length>this.maxOutputChars?`Large output detected so clipped to last ${this.maxOutputChars} chars...\n${e.slice(-this.maxOutputChars)}`:e}async _call({folder:e}){try{d.default.info(`Initializing git repository in ${e} under workspace ${this.workspaceRootDir}`);const t=u.join(this.workspaceRootDir,e);if(!p.existsSync(t))return`Error: The directory ${t} does not exist.`;const r=u.join(t,".git");if(p.existsSync(r))return`The directory ${t} is already a git repository.`;const o=(0,f.default)(t);return await o.init(),`Successfully initialized git repository in ${t}`}catch(e){d.default.warn(`Error initializing git repository: ${e.message}`,e);return`Error initializing git repository:\nError:\n${this.clipOutput(e.message)}`}}}t.GitInit=h},53877:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBasePrompt=function(){return"You are Eve, a highly skilled software engineer with extensive knowledge \nin many programming languages, frameworks, design patterns, and best practices.\n\nAs a software engineer, you excel at:\n- Analyzing and understanding complex codebases\n- Designing elegant and maintainable software architectures \n- Implementing efficient and robust solutions\n- Debugging and troubleshooting technical issues\n- Following best practices and coding standards\n- Considering performance, security, and scalability in your solutions\n\nYou provide technical, concise responses focused on delivering high-quality code and \npractical solutions. You prioritize clarity, maintainability, and following established \nconventions in the codebase you're working with."}},53903:e=>{"use strict";e.exports=require("uuid")},54500:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetRetrieval=void 0;const n=r(77773),s=o(r(19055));class i extends n.Tool{constructor(e){super(),this.datasetRetrievalService=e,this.name="dataset_retrieval",this.description="Search a dataset for similar content using vector similarity. Input should be a JSON string with datasetName, searchText, and optional numResults (defaults to 5)."}async _call(e){try{const t=JSON.parse(e);if(!t.datasetName||!t.searchText)throw new Error("Both datasetName and searchText are required");const r=await this.datasetRetrievalService.searchDataset(t.datasetName,t.searchText,t.numResults);return JSON.stringify(r,null,2)}catch(e){throw s.default.error(`Error in dataset retrieval tool: ${e.message}`),e}}}t.DatasetRetrieval=i},55124:e=>{"use strict";e.exports=require("winston")},55156:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ReplaceInFileToolFactory=void 0;const s=r(3563),i=r(93409),a=r(4243),c=r(79616);let l=class{constructor(e,t){this.fileValidationService=e,this.fileSystemEventService=t}getToolName(){return"replace_in_file"}create(e){return new i.ReplaceInFileTool(e.workingDir,this.fileValidationService,this.fileSystemEventService,{planModeRestrictions:["Documentation files only (e.g., .md, .txt, .rst)","No source code modifications in plan mode","No configuration file changes in plan mode"]},e.currentMode,e)}};t.ReplaceInFileToolFactory=l,t.ReplaceInFileToolFactory=l=o([(0,s.Injectable)(),n("design:paramtypes",[a.FileValidationService,c.FileSystemEventService])],l)},55177:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AccessMcpResourceToolFactory=void 0;const s=r(3563),i=r(57692),a=r(2115);let c=class{constructor(e){this.mcpHubService=e}getToolName(){return"access_mcp_resource"}create(e){return new i.AccessMcpResourceTool(this.mcpHubService,e.user.userId,{availableInPlan:!0,availableInAct:!0})}};t.AccessMcpResourceToolFactory=c,t.AccessMcpResourceToolFactory=c=o([(0,s.Injectable)(),n("design:paramtypes",[a.McpHubService])],c)},55200:(e,t,r)=>{e.exports=n,n.sync=function(e,t){return s(o.statSync(e),t)};var o=r(79896);function n(e,t,r){o.stat(e,(function(e,o){r(e,!e&&s(o,t))}))}function s(e,t){return e.isFile()&&function(e,t){var r=e.mode,o=e.uid,n=e.gid,s=void 0!==t.uid?t.uid:process.getuid&&process.getuid(),i=void 0!==t.gid?t.gid:process.getgid&&process.getgid(),a=parseInt("100",8),c=parseInt("010",8),l=parseInt("001",8),d=a|c;return r&l||r&c&&n===i||r&a&&o===s||r&d&&0===s}(e,t)}},55277:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GraphAgentService=void 0;const a=r(3563),c=r(93470),l=r(71412),d=r(67249),u=r(81162),p=r(86158),f=i(r(19055)),h=r(22300);let m=class{constructor(e,t,r){this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}async getTools(e){return await this.toolFactoryService.createTools(await this.getToolNames(e),e)}async getToolNames(e){return[]}async getAgentRules(){const e=await this.ruleService.getRulesByAgentName(this.getName());return e?.content||null}async getSystemPrompt(e){const t=await this.getAgentRules(),r="Not implemented";return t?`${r}\n\nRules:\n${t}`:r}getName(){return"graph-agent"}getModelCategory(){return u.ModelCategory.CODING}isPrivateModelsOnly(){return!1}async verifyRequest(e,t){}async*processRequestStream(e){if(!e.workspaceName)throw new Error("Workspace name is required in the agent request");yield*this.agentCollaborator.processRequestStream(this,e)}async processRequest(e){return this.agentCollaborator.processRequest(this,e)}async simpleRequest(e,t,r=null){const o=new l.AgentRequest(null,e,r,null,t);return(await this.processRequest(o)).responseContent}createGraph(e,t,r){return d.StandardAgentStateManager.createWorkflow((async function(t){const r=t.messages;f.default.debug("Calling model with messages: %s",JSON.stringify(r));const o=await e.invoke(r);return f.default.debug("Received model response: %s",JSON.stringify(o)),{messages:[o]}}),t).compile({checkpointer:r})}createInitialState(){return{messages:[]}}};t.GraphAgentService=m,t.GraphAgentService=m=o([(0,a.Injectable)(),s(0,(0,a.Inject)((0,a.forwardRef)((()=>h.GraphAgentCollaborator)))),n("design:paramtypes",[h.GraphAgentCollaborator,p.ToolFactoryService,c.AgentRuleService])],m)},55324:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BlockService=t.InternalBlockEvents=void 0;const a=r(3563),c=r(50461),l=r(72776),d=i(r(19055)),u=r(96297),p=r(60269);var f;!function(e){e.BLOCK_CREATED="block.created",e.BLOCK_UPDATED="block.updated",e.USAGE_TRACKED="block.usage.tracked"}(f||(t.InternalBlockEvents=f={}));let h=o=class{constructor(e,t,r){this.appDataSource=e,this.eventEmitter=t,this.dbDebugContextService=r}async createBlock(e){if(!e.blockId)throw new Error("BlockId must be provided by the provider");try{return await this.dbDebugContextService.runWithContext({operationName:"BlockService.createBlock",taskId:e.taskId},(async()=>{const t=new Date,r={blockId:e.blockId,taskId:e.taskId,role:e.role,blockType:e.blockType,tagName:e.tagName,description:e.description,status:e.status,content:e.content,errorText:e.errorText,output:e.output,metadata:e.metadata,createdAt:t,updatedAt:t};return await this.appDataSource.knex("eve_task_blocks").insert({...r,createdAt:this.appDataSource.knex.fn.now(),updatedAt:this.appDataSource.knex.fn.now()}),d.default.debug(`[${o.name}] Created block ${e.blockId} for task ${e.taskId}`),u.debugLogger.dumpObject("Created block",r),this.eventEmitter.emit(f.BLOCK_CREATED,r),r}))}catch(e){throw d.default.error(`[${o.name}] Error creating block: ${e.message}\n${e.stack}`),new Error(`Failed to create block: ${e.message}`)}}async updateBlock(e,t){try{const r=await this.getBlock(e);return await this.dbDebugContextService.runWithContext({operationName:"BlockService.updateBlock",taskId:r.taskId},(async()=>{const r={updatedAt:this.appDataSource.knex.fn.now()};void 0!==t.blockType&&(r.blockType=t.blockType),void 0!==t.tagName&&(r.tagName=t.tagName),void 0!==t.description&&(r.description=t.description),void 0!==t.status&&(r.status=t.status),void 0!==t.content&&(r.content=t.content),void 0!==t.errorText&&(r.errorText=t.errorText),void 0!==t.output&&(r.output=t.output),void 0!==t.metadata&&(r.metadata=t.metadata),await this.appDataSource.knex("eve_task_blocks").where({blockId:e}).update(r);const n=await this.getBlock(e);d.default.debug(`[${o.name}] Updated block ${e}`),u.debugLogger.dumpObject("Updated block",n);const s={blockId:n.blockId,taskId:n.taskId,...t};return this.eventEmitter.emit(f.BLOCK_UPDATED,s),n}))}catch(t){throw d.default.error(`[${o.name}] Error updating block ${e}: ${t.message}\n${t.stack}`),new Error(`Failed to update block ${e}: ${t.message}`)}}async appendToBlockContent(e,t){try{const r=await this.getBlock(e);return await this.dbDebugContextService.runWithContext({operationName:"BlockService.appendToBlockContent",taskId:r.taskId},(async()=>{const o=r.content+t;await this.appDataSource.knex("eve_task_blocks").where({blockId:e}).update({content:o,updatedAt:this.appDataSource.knex.fn.now()});const n=await this.getBlock(e),s={blockId:n.blockId,taskId:n.taskId,appendContent:t};return this.eventEmitter.emit(f.BLOCK_UPDATED,s),n}))}catch(t){throw d.default.error(`[${o.name}] Error appending content to block ${e}: ${t.message}\n${t.stack}`),new Error(`Failed to append content to block ${e}: ${t.message}`)}}async getBlock(e){try{const t=await this.appDataSource.knex("eve_task_blocks").where({blockId:e}).first();if(!t)throw new Error(`Block ${e} not found`);return t}catch(t){throw d.default.error(`[${o.name}] Error getting block ${e}: ${t.message}\n${t.stack}`),new Error(`Failed to get block ${e}: ${t.message}`)}}async getBlocksForTask(e){try{return await this.dbDebugContextService.runWithContext({operationName:"BlockService.getBlocksForTask",taskId:e},(async()=>{const t=await this.appDataSource.knex("eve_task_blocks").where({taskId:e}).orderBy("blockId","asc");return d.default.debug(`[${o.name}] Retrieved ${t.length} blocks for task ${e}`),t}))}catch(t){throw d.default.error(`[${o.name}] Error getting blocks for task ${e}: ${t.message}\n${t.stack}`),new Error(`Failed to get blocks for task ${e}: ${t.message}`)}}async getLastBlockForTask(e){try{return await this.dbDebugContextService.runWithContext({operationName:"BlockService.getLastBlockForTask",taskId:e},(async()=>{const t=await this.appDataSource.knex("eve_task_blocks").where({taskId:e}).orderBy("blockId","desc").first();return t?(d.default.debug(`[${o.name}] Retrieved last block ${t.blockId} for task ${e}`),t):(d.default.debug(`[${o.name}] No blocks found for task ${e}`),null)}))}catch(t){throw d.default.error(`[${o.name}] Error getting last block for task ${e}: ${t.message}\n${t.stack}`),new Error(`Failed to get last block for task ${e}: ${t.message}`)}}async trackUsage(e){try{return await this.dbDebugContextService.runWithContext({operationName:"BlockService.trackUsage",taskId:e.taskId},(async()=>{const[t]=await this.appDataSource.knex("eve_task_usage").insert({taskId:e.taskId,inputTokens:e.inputTokens,outputTokens:e.outputTokens,cacheWriteTokens:e.cacheWriteTokens,cacheReadTokens:e.cacheReadTokens,totalCost:e.totalCost,createdAt:this.appDataSource.knex.fn.now()}).returning("id");return await this.appDataSource.knex("eve_tasks").where({taskId:e.taskId}).increment({totalInputTokens:e.inputTokens,totalOutputTokens:e.outputTokens,totalCacheWriteTokens:e.cacheWriteTokens||0,totalCacheReadTokens:e.cacheReadTokens||0}),d.default.info(`[${o.name}] Tracked usage for task ${e.taskId}: ${e.inputTokens} input, ${e.outputTokens} output, ${e.cacheWriteTokens||0} cache write, ${e.cacheReadTokens||0} cache read tokens`),this.eventEmitter.emit(f.USAGE_TRACKED,{taskId:e.taskId,usageId:t,inputTokens:e.inputTokens,outputTokens:e.outputTokens,cacheWriteTokens:e.cacheWriteTokens,cacheReadTokens:e.cacheReadTokens,totalCost:e.totalCost}),t}))}catch(t){throw d.default.error(`[${o.name}] Error tracking usage for task ${e.taskId}: ${t.message}\n${t.stack}`),new Error(`Failed to track usage for task ${e.taskId}: ${t.message}`)}}async getTaskUsage(e){try{return await this.dbDebugContextService.runWithContext({operationName:"BlockService.getTaskUsage",taskId:e},(async()=>{const t=await this.appDataSource.knex("eve_task_usage").where({taskId:e}).andWhere("inputTokens",">",0).orderBy("createdAt","desc").first(),r=await this.appDataSource.knex("eve_task_usage").where({taskId:e}).sum({inputTokens:"inputTokens",outputTokens:"outputTokens",cacheWriteTokens:"cacheWriteTokens",cacheReadTokens:"cacheReadTokens",totalCost:"totalCost"}).first(),n={inputTokens:Number(t?.inputTokens||0),cacheWriteTokens:Number(t?.cacheWriteTokens||0),cacheReadTokens:Number(t?.cacheReadTokens||0),total:0};n.total=n.inputTokens+n.cacheWriteTokens+n.cacheReadTokens;const s={inputTokens:Number(r?.inputTokens||0),outputTokens:Number(r?.outputTokens||0),cacheWriteTokens:Number(r?.cacheWriteTokens||0),cacheReadTokens:Number(r?.cacheReadTokens||0),totalCost:Number(r?.totalCost||0)};return d.default.debug(`[${o.name}] Retrieved usage for task ${e} - Current context: ${n.total} tokens, Cumulative: ${s.inputTokens}/${s.outputTokens} tokens`),{current:n,cumulative:s}}))}catch(t){throw d.default.error(`[${o.name}] Error getting task usage ${e}: ${t.message}\n${t.stack}`),new Error(`Failed to get task usage ${e}: ${t.message}`)}}};t.BlockService=h,t.BlockService=h=o=n([(0,a.Injectable)(),s("design:paramtypes",[l.AppDataSource,c.EventEmitter2,p.DbDebugContextService])],h)},55705:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.NormalizedStopReason=void 0,function(e){e.END_TURN="end_turn",e.COMPLETE="complete",e.MAX_TOKENS="max_tokens",e.CONTEXT_LIMIT="context_limit",e.CONTENT_FILTER="content_filter",e.SAFETY="safety",e.RECITATION="recitation",e.TOOL_USE="tool_use",e.ERROR="error",e.ABORTED="aborted",e.UNKNOWN="unknown"}(r||(t.NormalizedStopReason=r={}))},55884:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BlockController=void 0;const a=r(3563),c=r(55324),l=r(19668),d=i(r(19055));let u=class{constructor(e,t){this.blockService=e,this.userService=t,this.serviceName="BlockController"}async getBlocksForTask(e,t){try{await this.userService.getCurrentUser(),d.default.debug(`[${this.serviceName}] Received request for blocks of task ${t}`);return await this.blockService.getBlocksForTask(t)}catch(e){if(e instanceof l.AuthenticationError)throw d.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw d.default.error(`[${this.serviceName}] Error in getBlocksForTask endpoint: ${e.message}`,e.stack),e}}async getTaskUsage(e,t){try{await this.userService.getCurrentUser(),d.default.debug(`[${this.serviceName}] Received request for comprehensive usage data of task ${t}`);return await this.blockService.getTaskUsage(t)}catch(e){if(e instanceof l.AuthenticationError)throw d.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw d.default.error(`[${this.serviceName}] Error in getTaskUsage endpoint: ${e.message}`,e.stack),e}}};t.BlockController=u,o([(0,a.Get)(":taskId/blocks"),s(0,(0,a.Request)()),s(1,(0,a.Param)("taskId")),n("design:type",Function),n("design:paramtypes",[Object,String]),n("design:returntype",Promise)],u.prototype,"getBlocksForTask",null),o([(0,a.Get)(":taskId/usage"),s(0,(0,a.Request)()),s(1,(0,a.Param)("taskId")),n("design:type",Function),n("design:paramtypes",[Object,String]),n("design:returntype",Promise)],u.prototype,"getTaskUsage",null),t.BlockController=u=o([(0,a.Controller)("eve-agent/task"),n("design:paramtypes",[c.BlockService,l.UserService])],u)},56082:e=>{"use strict";e.exports=require("openai")},56292:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PersonaRegistry=void 0;const c=r(3563),l=r(33911),d=r(36683),u=r(87161),p=r(726),f=r(10889),h=a(r(19055));let m=o=class{constructor(e,t,r,n){this.softwareEngineerPersona=e,this.productManagerPersona=t,this.architectPersona=r,this.customPersonaService=n,this.systemPersonas=new Map,this.customPersonasCache=new Map,this.registerSystemPersona(e),this.registerSystemPersona(t),this.registerSystemPersona(r),h.default.info(`[${o.name}] PersonaRegistry initialized with ${this.systemPersonas.size} system personas`)}registerSystemPersona(e){this.systemPersonas.set(e.getId(),e),h.default.debug(`[${o.name}] Registered system persona: ${e.getName()} (${e.getId()})`)}async getPersona(e,t){if(h.default.debug(`[${o.name}] Getting persona: ${e} for user: ${t||"none"}`),this.systemPersonas.has(e)){const t=this.systemPersonas.get(e);return h.default.debug(`[${o.name}] Found system persona: ${t.getName()}`),t}if(t){await this.ensureCustomPersonasLoaded(t);const r=this.customPersonasCache.get(t);if(r?.has(e)){const t=r.get(e);return h.default.debug(`[${o.name}] Found custom persona: ${t.getName()}`),t}}return h.default.warn(`[${o.name}] Persona not found: ${e}, falling back to software-engineer`),this.systemPersonas.get("software-engineer")}async getAllPersonas(e){const t=[...this.systemPersonas.values()];if(e){await this.ensureCustomPersonasLoaded(e);const r=this.customPersonasCache.get(e);r&&t.push(...r.values())}return h.default.debug(`[${o.name}] Retrieved ${t.length} personas for user: ${e||"none"}`),t}getSystemPersonas(){return Array.from(this.systemPersonas.values())}async getCustomPersonas(e){await this.ensureCustomPersonasLoaded(e);const t=this.customPersonasCache.get(e);return t?Array.from(t.values()):[]}isSystemPersona(e){return this.systemPersonas.has(e)}invalidateCustomPersonasCache(e){this.customPersonasCache.delete(e),h.default.debug(`[${o.name}] Invalidated custom personas cache for user: ${e}`)}async loadCustomPersonas(e){try{h.default.debug(`[${o.name}] Loading custom personas for user: ${e}`);const t=await this.customPersonaService.findByUser(e),r=new Map;for(const e of t){const t=new f.CustomPersona(e);r.set(t.getId(),t),h.default.debug(`[${o.name}] Loaded custom persona: ${t.getName()} (${t.getId()})`)}this.customPersonasCache.set(e,r),h.default.info(`[${o.name}] Loaded ${t.length} custom personas for user: ${e}`)}catch(t){h.default.error(`[${o.name}] Failed to load custom personas for user ${e}:`,t),this.customPersonasCache.set(e,new Map)}}async ensureCustomPersonasLoaded(e){this.customPersonasCache.has(e)||await this.loadCustomPersonas(e)}};t.PersonaRegistry=m,t.PersonaRegistry=m=o=n([(0,c.Injectable)(),i(3,(0,c.Inject)((0,c.forwardRef)((()=>p.CustomPersonaService)))),s("design:paramtypes",[l.SoftwareEngineerPersona,d.ProductManagerPersona,u.ArchitectPersona,p.CustomPersonaService])],m)},56349:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationHistoryService=void 0;const a=r(3563),c=(r(31832),i(r(19055))),l=r(96297),d=r(60269);let u=class{constructor(e,t){this.knex=e,this.dbDebugContextService=t}getContentPreview(e,t=50){if(null==e)return"null/undefined";if("string"==typeof e)return e.substring(0,t)+(e.length>t?"...":"");try{const r=JSON.stringify(e);return r.substring(0,t)+(r.length>t?"...":"")}catch(t){return`[Complex object: ${typeof e}]`}}async addMessage(e,t){if(!t.id)throw new Error("MessageInterchange must have an ID set by its creator");if(t.taskId=e,l.debugLogger.log(`[ConversationHistoryService] Adding message for task ${e}, role: ${t.role}, id: ${t.id}`),t.segments&&t.segments.length>0)for(let e=0;e<Math.min(t.segments.length,3);e++){const r=t.segments[e],o=this.getContentPreview(r.content);l.debugLogger.log(`[ConversationHistoryService] Segment ${e+1} type: ${r.type}, content: ${o}`)}try{return await this.dbDebugContextService.runWithContext({operationName:"ConversationHistoryService.addMessage",taskId:e},(async()=>{const r=JSON.stringify(t.segments);return await this.knex("eve_task_messages").insert({id:t.id,taskId:e,role:t.role,segments:r,providerId:t.providerId,providerMetadata:t.providerMetadata?JSON.stringify(t.providerMetadata):null,createdAt:t.createdAt,updatedAt:new Date}),l.debugLogger.log(`[ConversationHistoryService] Successfully added message with ID: ${t.id}`),t.id}))}catch(e){throw l.debugLogger.log(`[ConversationHistoryService] Error adding message: ${e.message}`),c.default.error(`[ConversationHistoryService] Error adding message: ${e.message}`,e.stack),new Error(`Failed to add message: ${e.message}`)}}async getHistory(e){l.debugLogger.log(`[ConversationHistoryService] Fetching history for task: ${e}`);try{return await this.dbDebugContextService.runWithContext({operationName:"ConversationHistoryService.getHistory",taskId:e},(async()=>{const t=await this.knex("eve_task_messages").where({taskId:e}).orderBy("id","asc");l.debugLogger.log(`[ConversationHistoryService] Retrieved ${t.length} messages for task ${e}`);const r=t.map((e=>({id:e.id,taskId:e.taskId,role:e.role,segments:JSON.parse(e.segments),providerId:e.providerId,providerMetadata:e.providerMetadata?JSON.parse(e.providerMetadata):void 0,createdAt:new Date(e.createdAt)})));if(r.length>0){const e=r.slice(-3);for(let t=0;t<e.length;t++){const o=e[t],n=r.length-e.length+t;if(l.debugLogger.log(`[ConversationHistoryService] Message ${n+1}/${r.length}: role=${o.role}, providerId=${o.providerId}`),o.segments&&o.segments.length>0)for(let e=0;e<Math.min(o.segments.length,2);e++){const t=o.segments[e],r=this.getContentPreview(t.content);l.debugLogger.log(`[ConversationHistoryService] Message ${n+1} segment ${e+1} type: ${t.type}, content: ${r}`)}}}else l.debugLogger.log(`[ConversationHistoryService] No history messages found for task ${e}`);return r}))}catch(e){throw l.debugLogger.log(`[ConversationHistoryService] Error retrieving message history: ${e.message}`),c.default.error(`[ConversationHistoryService] Error retrieving message history: ${e.message}`,e.stack),new Error(`Failed to retrieve message history: ${e.message}`)}}async getMessage(e){l.debugLogger.log(`[ConversationHistoryService] Fetching message with ID: ${e}`);try{return await this.dbDebugContextService.runWithContext({operationName:"ConversationHistoryService.getMessage",queryId:e},(async()=>{const t=await this.knex("eve_task_messages").where({id:e}).first();return t?(l.debugLogger.log(`[ConversationHistoryService] Retrieved message with ID ${e}`),{id:t.id,taskId:t.taskId,role:t.role,segments:JSON.parse(t.segments),providerId:t.providerId,providerMetadata:t.providerMetadata?JSON.parse(t.providerMetadata):void 0,createdAt:new Date(t.createdAt)}):(l.debugLogger.log(`[ConversationHistoryService] Message with ID ${e} not found`),null)}))}catch(t){throw l.debugLogger.log(`[ConversationHistoryService] Error retrieving message ${e}: ${t.message}`),c.default.error(`[ConversationHistoryService] Error retrieving message ${e}: ${t.message}`,t.stack),new Error(`Failed to retrieve message: ${t.message}`)}}async deleteTaskMessages(e){l.debugLogger.log(`[ConversationHistoryService] Deleting all messages for task ${e}`);try{await this.dbDebugContextService.runWithContext({operationName:"ConversationHistoryService.deleteTaskMessages",taskId:e},(async()=>{await this.knex("eve_task_messages").where({taskId:e}).delete(),l.debugLogger.log(`[ConversationHistoryService] Deleted all messages for task ${e}`)}))}catch(t){throw l.debugLogger.log(`[ConversationHistoryService] Error deleting messages for task ${e}: ${t.message}`),c.default.error(`[ConversationHistoryService] Error deleting messages for task ${e}: ${t.message}`,t.stack),new Error(`Failed to delete messages: ${t.message}`)}}async getMessagesForProvider(e,t){l.debugLogger.log(`[ConversationHistoryService] Fetching messages for task ${e} and provider ${t}`);try{return await this.dbDebugContextService.runWithContext({operationName:"ConversationHistoryService.getMessagesForProvider",taskId:e},(async()=>{const r=await this.knex("eve_task_messages").where({taskId:e,providerId:t}).orderBy("id","asc");return l.debugLogger.log(`[ConversationHistoryService] Retrieved ${r.length} messages for task ${e} and provider ${t}`),r.map((e=>({id:e.id,taskId:e.taskId,role:e.role,segments:JSON.parse(e.segments),providerId:e.providerId,providerMetadata:e.providerMetadata?JSON.parse(e.providerMetadata):void 0,createdAt:new Date(e.createdAt)})))}))}catch(e){throw l.debugLogger.log(`[ConversationHistoryService] Error retrieving messages for provider: ${e.message}`),c.default.error(`[ConversationHistoryService] Error retrieving messages for provider: ${e.message}`,e.stack),new Error(`Failed to retrieve messages for provider: ${e.message}`)}}};t.ConversationHistoryService=u,t.ConversationHistoryService=u=o([(0,a.Injectable)(),s(0,(0,a.Inject)("KNEX")),n("design:paramtypes",[Function,d.DbDebugContextService])],u)},56500:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.standardRules=void 0,t.mapRuleToDbRecord=function(e){return{id:e.id,name:e.name,content:e.content,source_type:e.sourceType,is_editable:e.isEditable,is_deletable:e.isDeletable,created_at:new Date,updated_at:new Date}};const o=r(1145),n=r(3309);t.standardRules=[{id:"eve-standard-00-build-after-changes",name:"Build After Changes",content:"# Build After Changes\n\nAfter making code changes you MUST run an appropriate command to verify that your changes are correct and the project still builds or runs as expected.\n\n1.  Determine the appropriate verification command based on the changes made and the project type (e.g., `pnpm run build`, `tsc`, `python setup.py build`, `./gradlew build`, a linter command, etc.).\n2.  Use the `execute_command` tool to run this verification command.\n3.  Ensure the command executes successfully. If there are errors, address them before proceeding.\n4.  This step helps catch issues early and ensures the codebase remains in a healthy state.",sourceType:o.RuleSource.EVE,isEditable:!1,isDeletable:!1},{id:"eve-standard-01-test-after-changes",name:"Test After Changes",content:"# Test After Changes\n\nAfter making code changes you MUST run appropriate unit tests to verify the correctness of your changes before committing them or updating the memory bank.\n\n1.  Determine the appropriate test command based on the changes made and the project type (e.g., `pnpm test`, `python -m unittest discover`, `./gradlew test`, `pytest`, etc.).\n2.  Use the `execute_command` tool to run this test command.\n3.  Ensure all tests pass. If there are failing tests, address them before proceeding.\n4.  This step is crucial for maintaining code quality and preventing regressions.",sourceType:o.RuleSource.EVE,isEditable:!1,isDeletable:!1},{id:"eve-standard-02-commit-changes-to-git",name:"Commit Changes to Git",content:'# Git Commit Practice\n\nBefore calling the attempt_completion tool (and after any memory updates) you MUST commit your changes to git:\n\n1. Use the command_line tool to stage and commit changes\n2. Stage all changes with `git add -A`\n3. Create a meaningful commit message that describes the changes\n4. Use the format: `git commit -am "suitable message"`\n5. Ensure commit messages are descriptive and follow project conventions\n6. Group related changes into a single commit\n7. Keep commits focused on a single logical change\n8. Verify the changes before committing\n9. Consider using conventional commit format if the project follows it',sourceType:o.RuleSource.EVE,isEditable:!1,isDeletable:!1},{id:"eve-standard-03-memory-bank",name:"Standard Memory Bank",content:"# Eve's Memory Bank\n@/memory-bank/\n\nMy memory resets completely between sessions. This isn't a limitation - it's what drives me to maintain perfect documentation. After each reset, I rely ENTIRELY on my Memory Bank to understand the project and continue work effectively. The memory bank files are automatically included in my context.\n\nMy main focus is to keep this documentation up-to-date.\n\n## Memory Bank Structure\n\nThe Memory Bank consists of core files and optional context files, all in Markdown format. Files build upon each other in a clear hierarchy:\n\nflowchart TD\n    PB[projectbrief.md] --\x3e PC[productContext.md]\n    PB --\x3e SP[systemPatterns.md]\n    PB --\x3e TC[techContext.md]\n\n    PC --\x3e AC[activeContext.md]\n    SP --\x3e AC\n    TC --\x3e AC\n\n    AC --\x3e P[progress.md]\n\n### Core Files (Required)\n1. `projectbrief.md`\n   - Foundation document that shapes all other files\n   - Created at project start if it doesn't exist\n   - Defines core requirements and goals\n   - Source of truth for project scope\n\n2. `productContext.md`\n   - Why this project exists\n   - Problems it solves\n   - How it should work\n   - User experience goals\n\n3. `activeContext.md`\n   - Current work focus\n   - Recent changes\n   - Next steps\n   - Active decisions and considerations\n   - Important patterns and preferences\n   - Learnings and project insights\n\n4. `systemPatterns.md`\n   - System architecture\n   - Key technical decisions\n   - Design patterns in use\n   - Component relationships\n   - Critical implementation paths\n\n5. `techContext.md`\n   - Technologies used\n   - Development setup\n   - Technical constraints\n   - Dependencies\n   - Tool usage patterns\n\n6. `progress.md`\n   - What works\n   - What's left to build\n   - Current status\n   - Known issues\n   - Evolution of project decisions\n\n### Additional Context\nCreate additional files/folders within memory-bank/ when they help organize:\n- Complex feature documentation\n- Integration specifications\n- API documentation\n- Testing strategies\n- Deployment procedures\n\n## Core Workflows\n\n### Plan Mode\nflowchart TD\n    Start[Start] --\x3e ReviewContext[Review Auto-Included Context]\n    ReviewContext --\x3e CheckFiles{Files Complete?}\n\n    CheckFiles --\x3e|No| Plan[Plan to Create/Update Files]\n    Plan --\x3e Document[Document Plan in Chat]\n\n    CheckFiles --\x3e|Yes| Verify[Verify Context]\n    Verify --\x3e Strategy[Develop Strategy]\n    Strategy --\x3e Present[Present Approach]\n\n### Act Mode\nflowchart TD\n    Start[Start] --\x3e ReviewContext[Review Auto-Included Context]\n    ReviewContext --\x3e Update[Update Documentation]\n    Update --\x3e Execute[Execute Task]\n    Execute --\x3e Document[Document Changes]\n\n## Documentation Updates\n\nMemory Bank updates are critical and occur when:\n1. Discovering new project patterns\n2. After implementing significant changes\n3. When user requests with **update memory bank** (I MUST review and update ALL relevant files)\n4. When context needs clarification\n\nflowchart TD\n    Start[Update Process]\n\n    subgraph Process\n        P1[Review ALL Files]\n        P2[Document Current State]\n        P3[Clarify Next Steps]\n        P4[Document Insights & Patterns]\n\n        P1 --\x3e P2 --\x3e P3 --\x3e P4\n    end\n\n    Start --\x3e Process\n\nNote: When triggered by **update memory bank**, I MUST review every memory bank file to ensure they are all up-to-date, even if some don't require changes. I will focus particularly on activeContext.md and progress.md as they track the current state.\n\nREMEMBER: After every memory reset, I begin completely fresh. The Memory Bank is my only link to previous work. It must be maintained with precision and clarity, as my effectiveness depends entirely on its accuracy.",sourceType:o.RuleSource.EVE,isEditable:!1,isDeletable:!1},{id:"eve-standard-04-test-driven-development",name:"Test-Driven Development",content:"# Test-Driven Development\n\nAlways follow Test-Driven Development (TDD) principles:\n\n1. Write a failing unit test before implementing any fix or feature\n2. Ensure the test clearly demonstrates the expected behavior\n3. Run the test to confirm it fails for the expected reason\n4. Only then implement the minimum code needed to make the test pass\n5. Refactor the code while keeping tests passing\n6. Follow the Red-Green-Refactor cycle\n7. Keep tests focused and isolated\n8. Test edge cases and error conditions\n9. Maintain high test coverage for critical code paths\n10. Use descriptive test names that explain the behavior being tested",sourceType:o.RuleSource.EVE,isEditable:!1,isDeletable:!1},{id:"eve-standard-05-hierarchical-architecture-tracking",name:"Hierarchical Architecture Tracking",content:"# Hierarchical Architecture Tracking\n@/architecture.md\n\nWhen working with large codebases or monorepos, I maintain a hierarchical system of architecture documentation that grows organically through exploration.\n\n## CRITICAL: Task Initialization Requirement\n**At the beginning of each new task, I MUST read any relevant architecture.md files before doing anything else.**\n\nThis includes:\n1. Always start by reading the root `/architecture.md` file (automatically included in context)\n2. Based on the task scope, identify and read relevant sub-project architecture files\n3. Follow architecture links to understand the system structure before proceeding\n4. Only after understanding the architectural context should I begin task execution\n\n## Step 0: Architecture Foundation Check\n- The root `architecture.md` file is automatically included in my context.\n- **If the file content indicates an error or that the file does not exist**, I MUST STOP and ask the user for guidance.\n- I will ask if I should perform an initial investigation to create a foundational root architecture document before proceeding with the task.\n- A solid architectural foundation is crucial for effective work.\n\n## Step 1: Analyze Existing Architecture\n- With the root architecture document as a starting point, I will analyze the provided context.\n- I will follow links to relevant sub-project architecture docs to understand the system structure.\n- I will use the documentation tree to navigate from the root → sub-project → specific modules.\n\n## Step 2: Understand File Organization\n- **Use `list_files`** on relevant directories to understand structure\n- **Focus on areas not well-documented** in existing architecture.md files\n- **Apply filters** to focus on pertinent file types\n- **Identify project boundaries** and module organization\n\n## Step 3: Analyze Code Signatures\n- **Use `list_code_definition_names`** on specific directories\n- **Extract complete function/class signatures** with types and parameters\n- **Understand API surfaces** and architectural patterns\n- **Identify key classes, services, and interfaces**\n\n## Step 4: Strategic Implementation Reading\n- **Use `read_file`** on key files identified through signature analysis\n- **Focus on files containing important classes/functions**\n- **Read configuration and entry points** relevant to the task\n\n## Step 5: Update Architecture Documentation Hierarchically\nCreate or update `architecture.md` files at the appropriate level when you discover:\n\n### Root `/architecture.md` Updates:\n- New sub-projects discovered\n- Cross-project dependencies\n- Overall system architecture changes\n- Technology stack additions\n\n### Sub-Project `{project}/architecture.md` Updates:\n- Package/module layout discoveries\n- High-level architecture patterns\n- Key class/interface relationships\n- Important entry points and APIs\n\n## Architecture Document Structure\n\n### Root `/architecture.md`:\n```markdown\n# System Architecture Overview\n\n## Technologies\n- **Runtime**: Node.js 18+\n- **Database**: PostgreSQL 14+\n- **Communication**: WebSockets, REST APIs\n- **Infrastructure**: Docker, Kubernetes\n- **Monitoring**: Prometheus, Grafana\n\n## Sub-Projects\n- **[backend](./backend/architecture.md)**: API server with business logic\n- **[frontend](./frontend/architecture.md)**: User interface application\n- **[shared](./shared/architecture.md)**: Common utilities and types\n\n## System Architecture\n```mermaid\ngraph TB\n    UI[Frontend App] --\x3e API[Backend Service]\n    API --\x3e DB[(Database)]\n    API --\x3e EXT[External Services]\n```\n\n## Cross-Project Dependencies\n- Backend serves frontend static assets\n- Real-time communication between frontend and backend\n- Shared data models and interfaces\n\n*Last updated: [date] - [brief note]*\n```\n\n### Sub-Project `{project}/architecture.md`:\n```markdown\n# [Project Name] Architecture\n\n## Technologies\n- **Framework**: Express.js / NestJS / Django / Spring Boot\n- **Language**: TypeScript / Python / Java / C#\n- **Database**: PostgreSQL / MongoDB / MySQL\n- **Testing**: Jest / PyTest / JUnit / xUnit\n- **Build Tools**: Webpack / Vite / Maven / Gradle\n- **Key Libraries**: \n  - Authentication: Passport.js / Auth0\n  - Validation: Joi / Yup / Pydantic\n  - ORM: TypeORM / Prisma / SQLAlchemy\n\n## Package Layout\n- **src/**: Main source code\n- **test/**: Test files\n- **config/**: Configuration files\n- **docs/**: Documentation\n\n## High-Level Architecture\n```mermaid\ngraph TB\n    Controller[Controllers] --\x3e Service[Services]\n    Service --\x3e Repository[Data Layer]\n    Service --\x3e External[External APIs]\n```\n\n## Key Classes/Interfaces\n```mermaid\nclassDiagram\n    class UserService {\n        +createUser()\n        +updateUser()\n        +deleteUser()\n    }\n    class UserRepository {\n        +save()\n        +findById()\n    }\n    UserService --\x3e UserRepository\n```\n\n## Important Entry Points\n- `src/main.ts` - Application entry point\n- `src/app.module.ts` - Main module definition\n- `src/config/` - Configuration files\n\n*Last updated: [date] - [brief note]*\n```\n\n## Documentation Maintenance Strategy\n\n### When to Create New Architecture Docs:\n- Discovering a new sub-project during exploration\n- Finding a complex module that warrants its own documentation\n- Identifying architectural patterns that need visual representation\n\n### When to Update Existing Docs:\n- Learning new architectural patterns\n- Discovering important classes/interfaces\n- Understanding cross-module dependencies\n- Finding key entry points or APIs\n- Adopting new frameworks, databases, or major libraries\n- Upgrading to new major versions that affect architecture\n\n### What to Include:\n- **Package Layout**: Directory structure and organization\n- **Mermaid Diagrams**: High-level architecture and class relationships\n- **Navigation Links**: Connect to parent and child architecture docs\n- **Key Discoveries**: Important classes, interfaces, and patterns\n- **Technologies**: Core frameworks, languages, databases, and key libraries\n\n### What NOT to Include:\n- Implementation details (save for code comments)\n- Build/deployment instructions (separate docs)\n- API documentation (separate docs)\n- Detailed configuration (separate docs)\n- Exhaustive lists of all dependencies\n\n## Organic Growth Philosophy\n- **Create on demand** - only when exploration reveals architectural complexity\n- **Link hierarchically** - maintain navigation between levels\n- **Visual first** - use Mermaid diagrams to show relationships\n- **Update during work** - not as separate documentation tasks\n- **Keep scannable** - focus on architectural understanding\n\nThis hierarchical approach creates a scalable documentation system that grows with the codebase and provides targeted architectural knowledge at the right level of detail.",sourceType:o.RuleSource.EVE,isEditable:!1,isDeletable:!1},n.requirementsToCodeWorkflowRule]},56511:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToolCallingScheme=void 0;t.ToolCallingScheme=class{}},56550:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TaskService=void 0;const p=r(3563),f=r(59100),h=u(r(19055)),m=r(96297),g=c(r(70857)),y=r(50461),v=r(72776),_=r(60269),w=r(15369),b=r(9102),k=r(48010),S=r(32398),T=r(56292),R=r(18615),C=r(30538),P=r(16387),E=r(75870),I=r(9581),O=r(99547),$=r(88474),M=r(3563),A=r(35444),x=r(91280),D=r(57438),N=r(56349);let j=n=class{constructor(e,t,r,o,n,s,i,a,c,l,d,u,p,f){this.appDataSource=e,this.apiHandlerFactory=t,this.configService=r,this.toolExecutorService=o,this.toolProvider=n,this.mainWorkspaceService=s,this.personaRegistry=i,this.promptBuilderService=a,this.homeService=c,this.eventEmitter=l,this.dbDebugContextService=d,this.agentLoopOrchestrator=u,this.contextTruncationHandler=p,this.conversationHistoryService=f}async createTask(e){const t=(0,f.ulid)();try{return await this.dbDebugContextService.runWithContext({operationName:"TaskService.createTask",taskId:t},(async()=>{const r=(await this.homeService.getUserData()).userId;if(!r)throw new Error("Could not determine authenticated user ID.");let o=null;if(e.workspaceName){const t=await this.mainWorkspaceService.findOne(e.workspaceName);if(!t)throw new M.NotFoundException(`Workspace with name ${e.workspaceName} not found`);o=t.name,h.default.info(`[${n.name}] Found workspace name ${o}`)}return await this.appDataSource.knex("eve_tasks").insert({taskId:t,userId:r,workspaceName:o,prompt:"",personaId:e.personaId||"software-engineer",status:A.TaskStatus.WAITING_FOR_INPUT,totalInputTokens:0,totalOutputTokens:0,createdAt:this.appDataSource.knex.fn.now(),updatedAt:this.appDataSource.knex.fn.now()}),h.default.info(`[${n.name}] Created task ${t} for user ${r}`),t}))}catch(e){throw h.default.error(`[${n.name}] Error creating task: ${e.message}\n${e.stack}`),new Error(`Failed to create task: ${e.message}`)}}async createTaskStep(e){try{const[t]=await this.appDataSource.knex("eve_task_steps").insert({taskId:e.taskId,stepNumber:e.stepNumber,toolName:e.toolName,toolInput:e.toolInput,status:"pending",createdAt:this.appDataSource.knex.fn.now(),updatedAt:this.appDataSource.knex.fn.now()}).returning("id");return h.default.info(`[${n.name}] Created task step ${t} for task ${e.taskId}`),t}catch(e){throw h.default.error(`[${n.name}] Error creating task step: ${e.message}\n${e.stack}`),new Error(`Failed to create task step: ${e.message}`)}}async updateTaskStep(e){try{await this.appDataSource.knex("eve_task_steps").where({taskId:e.taskId,stepNumber:e.stepNumber}).update({toolOutput:e.toolOutput,status:e.status,commitHash:e.commitHash,completedAt:this.appDataSource.knex.fn.now(),updatedAt:this.appDataSource.knex.fn.now()}),h.default.info(`[${n.name}] Updated task step ${e.stepNumber} for task ${e.taskId}`)}catch(e){throw h.default.error(`[${n.name}] Error updating task step: ${e.message}\n${e.stack}`),new Error(`Failed to update task step: ${e.message}`)}}async updateTask(e){m.debugLogger.log(`[${n.name}] Updating task ${e.taskId}`),m.debugLogger.dumpObject("UpdateTask options",e);try{await this.dbDebugContextService.runWithContext({operationName:"TaskService.updateTask",taskId:e.taskId},(async()=>{const t={updatedAt:this.appDataSource.knex.fn.now()};if(e.status&&(t.status=e.status),void 0!==e.result&&(t.result=e.result),e.mode&&(t.mode=e.mode,h.default.info(`[${n.name}] Updating task ${e.taskId} mode to ${e.mode}`)),e.originalPrompt&&(t.originalPrompt=e.originalPrompt,h.default.info(`[${n.name}] Setting originalPrompt for task ${e.taskId}`)),e.personaId){const r=await this.appDataSource.knex("eve_tasks").where({taskId:e.taskId}).first();if(r)try{await this.personaRegistry.getPersona(e.personaId,r.userId),t.personaId=e.personaId,h.default.info(`[${n.name}] Updated task ${e.taskId} persona from ${r.personaId} to ${e.personaId}`)}catch(t){throw h.default.error(`[${n.name}] Invalid persona ID ${e.personaId} for task ${e.taskId}: ${t.message}`),new Error(`Invalid persona ID: ${e.personaId}`)}}await this.appDataSource.knex("eve_tasks").where({taskId:e.taskId}).update(t),e.status&&(h.default.info(`[${n.name}] Updated task ${e.taskId} status to ${e.status}`),this.eventEmitter.emit(x.InternalEvents.TASK_UPDATED,{taskId:e.taskId,clientId:null,status:e.status,data:{result:e.result}}),m.debugLogger.log(`[${n.name}] Emitted ${x.InternalEvents.TASK_UPDATED} event for task ${e.taskId} with status ${e.status}`))}))}catch(t){throw h.default.error(`[${n.name}] Error updating task ${e.taskId}: ${t.message}\n${t.stack}`),new Error(`Failed to update task ${e.taskId}: ${t.message}`)}}async getTask(e){try{return await this.dbDebugContextService.runWithContext({operationName:"TaskService.getTask",taskId:e},(async()=>{const t=await this.appDataSource.knex("eve_tasks").where({taskId:e}).first();if(!t)throw new Error(`Task ${e} not found`);return t}))}catch(e){throw h.default.error(`[${n.name}] Error getting task: ${e.message}\n${e.stack}`),new Error(`Failed to get task: ${e.message}`)}}async getTaskSteps(e){try{return await this.appDataSource.knex("eve_task_steps").where({taskId:e}).orderBy("stepNumber","asc")}catch(e){throw h.default.error(`[${n.name}] Error getting task steps: ${e.message}\n${e.stack}`),new Error(`Failed to get task steps: ${e.message}`)}}async getUserTasks(e,t=10,r=0){try{return await this.appDataSource.knex("eve_tasks").where({userId:e}).orderBy("createdAt","desc").limit(t).offset(r)}catch(e){throw h.default.error(`[${n.name}] Error getting user tasks: ${e.message}\n${e.stack}`),new Error(`Failed to get user tasks: ${e.message}`)}}async getNextStepNumber(e){try{const t=await this.appDataSource.knex("eve_task_steps").where({taskId:e}).max("stepNumber as maxStep").first();return(t?.maxStep||0)+1}catch(e){throw h.default.error(`[${n.name}] Error getting next step number: ${e.message}\n${e.stack}`),new Error(`Failed to get next step number: ${e.message}`)}}async executeConversationTurn(e,t,r,o){try{h.default.debug(`[${n.name}] Executing conversation turn for task ${e} in ${r} mode with ${t.length} messages`);const s=await this.getTask(e);let i;h.default.debug(`[${n.name}] Task details: ${JSON.stringify({id:s.taskId,userId:s.userId,workspaceName:s.workspaceName,personaId:s.personaId,status:s.status})}`);const a=s.workspaceName;if(!a)throw new Error(`Task ${e} has no associated workspace name.`);{const t=await this.mainWorkspaceService.findOne(a);if(!t)throw new M.NotFoundException(`Workspace '${a}' not found when executing conversation turn for task ${e}`);i=t.repoBaseDir}h.default.debug(`[${n.name}] Working directory: ${i}`);const c=await this.homeService.getUserData();h.default.debug(`[${n.name}] User data: ${JSON.stringify({userId:s.userId,email:c.email})}`);const l=await this.configService.assembleFinalConfiguration(s.userId,r);h.default.debug(`[${n.name}] Assembled configuration for mode ${r}: ${JSON.stringify({providerId:l.providerId,modelId:l.modelId,hasApiKey:!!l.apiKey,hasBaseUrl:!!l.baseUrl,thinkingTokens:l.thinkingTokens})}`),m.debugLogger.dumpObject("[TaskService] Final Assembled Configuration:",l);const d={providerName:l.providerId,model:l.modelId,baseUrl:l.baseUrl,apiKey:l.apiKey,thinkingTokens:l.thinkingTokens,draftModelId:l.draftModelId};h.default.debug(`[${n.name}] Using API config for mode: ${r}`);const u=await this.apiHandlerFactory.buildApiHandler(d),p=u.getModelMetadata(),f=(0,E.getContextSizeCategory)(p.contextWindow||32e3);h.default.debug(`[${n.name}] Model context window: ${p.contextWindow}, category: ${f}`);const y={workingDir:i,workspaceName:a,user:{userId:s.userId,email:c.email},osInfo:{platform:g.platform(),release:g.release(),homeDir:g.homedir(),shell:process.env.SHELL||"/bin/bash"},currentMode:r,currentTime:(new Date).toLocaleDateString("en-GB"),getUserApiKey:async e=>{const t=await this.configService.findApiKeyForProvider(s.userId,e);return t?.apiKey},modelMetadata:p,contextSizeCategory:f};h.default.debug(`[${n.name}] Created system context with mode: ${r}`);const v=await this.personaRegistry.getPersona(s.personaId,s.userId),_=v.getToolNamesForMode(r,y),w=this.toolProvider.getTools(_,y),b=await this.promptBuilderService.buildPersonaSystemPrompt(v,w,y);if(h.default.debug(`[${n.name}] Built system prompt with length: ${b.length} characters`),"true"===process.env.DEBUG_LOG_FULL_SYSTEM_PROMPT)h.default.debug(`[${n.name}] Full System Prompt:\n${b}`);else{const e=b.substring(0,200),t=b.substring(b.length-200);h.default.debug(`[${n.name}] System prompt start: ${e}...`),h.default.debug(`[${n.name}] System prompt end: ...${t}`)}return h.default.debug(`[${n.name}] Using ${t.length} messages for provider ${l.providerId}`),await(0,O.retryApiOperation)((async()=>{try{if(h.default.debug(`[${n.name}] Calling API handler generateResponse with ${t.length} messages`),t.length>0){const e=t[t.length-1];if(h.default.debug(`[${n.name}] Last message role: ${e.role}`),e.segments&&e.segments.length>0){const t=e.segments[0];h.default.debug(`[${n.name}] Last message first segment type: ${t.type}`),h.default.debug(`[${n.name}] Last message first segment content (first 100 chars): ${t.content.substring(0,100)}...`)}else h.default.warn(`[${n.name}] Last message has no segments`);e.providerMetadata&&h.default.debug(`[${n.name}] Last message has provider metadata for ${e.providerId}`)}else h.default.warn(`[${n.name}] No messages provided to API handler for task ${e}`);return u.generateResponse(b,t,e,o)}catch(t){const r=(0,I.toEveAgentError)(t);throw h.default.error(`[${n.name}] API error during conversation turn for task ${e}: ${r.code} - ${r.message}`,{taskId:e,errorCode:r.code,errorContext:r.context,retriable:r.retriable}),r}}),{maxRetries:3,initialDelayMs:1e3,maxDelayMs:1e4,logger:h.default,onRetry:(t,r,o)=>{const s=(0,I.toEveAgentError)(t);h.default.warn(`[${n.name}] Retrying API call for task ${e} after error: ${s.code} (attempt ${r}, delay: ${o}ms)`)}})}catch(t){const r=(0,I.toEveAgentError)(t);throw h.default.error(`[${n.name}] Failed to execute conversation turn for task ${e}: ${r.code} - ${r.message}`,{taskId:e,errorDetails:r.toJSON()}),r}}async compactTaskContext(e,t){try{h.default.info(`[${n.name}] Manual context compaction requested for task ${e} with strategies: ${t.join(", ")}`);const r=await this.conversationHistoryService.getHistory(e);if(!r||0===r.length)return h.default.warn(`[${n.name}] No conversation history found for task ${e}`),{appliedStrategies:[],messagesProcessed:0,tokensRemoved:0,originalTokens:0,finalTokens:0};const o=this.contextTruncationHandler.applyManualTruncation(e,r,t);await this.conversationHistoryService.deleteTaskMessages(e);for(const t of o.truncatedHistory)await this.conversationHistoryService.addMessage(e,t);return h.default.info(`[${n.name}] Manual context compaction completed for task ${e}. Applied ${o.appliedStrategies.length} strategies, removed ~${o.tokensRemoved} tokens.`),{appliedStrategies:o.appliedStrategies,messagesProcessed:o.messagesProcessed,tokensRemoved:o.tokensRemoved,originalTokens:o.originalTokens,finalTokens:o.finalTokens}}catch(t){throw h.default.error(`[${n.name}] Error compacting context for task ${e}: ${t.message}\n${t.stack}`),new Error(`Failed to compact context for task ${e}: ${t.message}`)}}};t.TaskService=j,t.TaskService=j=n=a([(0,p.Injectable)(),d(11,(0,p.Inject)((0,p.forwardRef)((()=>P.AgentLoopOrchestrator)))),l("design:paramtypes",[v.AppDataSource,w.ApiHandlerFactory,b.EveConfigService,k.ToolExecutorService,S.ToolProvider,$.WorkspaceService,T.PersonaRegistry,R.PromptBuilderService,C.HomeService,y.EventEmitter2,_.DbDebugContextService,P.AgentLoopOrchestrator,D.ContextTruncationHandler,N.ConversationHistoryService])],j)},56844:e=>{"use strict";e.exports=require("tree-sitter-typescript")},57438:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ContextTruncationHandler=void 0;const a=r(3563),c=r(50461),l=r(59100),d=i(r(19055)),u=r(70136),p=r(91280),f=r(67485),h=r(44155);let m=o=class{constructor(e,t,r){this.agentStateManager=e,this.eventEmitter=t,this.responseFormatter=r}getTruncationStrategy(e){return this.agentStateManager.getTruncationStrategy(e)||{strategy:"clip_large_messages",percentToRemove:25}}updateToNextTruncationStrategy(e){const t=this.getTruncationStrategy(e),r=(0,u.getNextTruncationStrategy)(t.strategy);return d.default.warn(`[${o.name}] Context window exceeded for task ${e}. Updating to next truncation strategy: ${r.strategy}, percentToRemove: ${r.percentToRemove}%`),this.agentStateManager.setTruncationStrategy(e,r),r}truncateHistory(e,t){const r=this.getTruncationStrategy(e);return(0,u.truncateConversationHistory)(t,r)}truncateWithNextStrategy(e,t,r){const n=this.updateToNextTruncationStrategy(e),s=(0,u.truncateConversationHistory)(t,n),i=t.length-s.length;if(d.default.info(`[${o.name}] Truncated history for task ${e}. Removed ${i} messages using strategy ${n.strategy}.`),i>0){const t={id:(0,l.ulid)(),taskId:e,role:"user",segments:[{type:"text",content:this.responseFormatter.contextTruncationNotice()}],providerId:"system",createdAt:new Date};s.unshift(t)}return r&&this.eventEmitter.emit(p.NotificationEvents.CONTEXT_TRUNCATED,{taskId:e,clientId:r,message:`Context window exceeded, removed ${i} messages using strategy ${n.strategy}.`,removedCount:i}),{truncatedHistory:s,removedCount:i}}applyManualTruncation(e,t,r,n){d.default.info(`[${o.name}] Manual truncation requested for task ${e} with strategies: ${r.join(", ")}`);const s=(0,u.applyManualTruncationStrategies)(t,r);return d.default.info(`[${o.name}] Manual truncation completed for task ${e}. Applied strategies: ${s.appliedStrategies.join(", ")}, Tokens removed: ${s.tokensRemoved}, Final tokens: ${s.finalTokens}`),n&&s.tokensRemoved>0&&this.eventEmitter.emit(p.NotificationEvents.CONTEXT_TRUNCATED,{taskId:e,clientId:n,message:`Manual context compaction completed. Applied ${s.appliedStrategies.length} strategies, removed ~${s.tokensRemoved} tokens.`,removedCount:s.messagesProcessed-s.truncatedHistory.length}),s}};t.ContextTruncationHandler=m,t.ContextTruncationHandler=m=o=n([(0,a.Injectable)(),s("design:paramtypes",[f.AgentStateManager,c.EventEmitter2,h.ResponseFormatterService])],m)},57655:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Story=t.StoryStatus=void 0;const o=r(59100);var n;!function(e){e.BACKLOG="backlog",e.IN_PROGRESS="in_progress",e.DONE="done"}(n||(t.StoryStatus=n={}));t.Story=class{constructor(e,t,r=[],s=n.BACKLOG,i=(0,o.ulid)(),a=new Date,c=new Date){this.id=i,this.title=e,this.description=t,this.status=s,this.acceptanceCriteria=r,this.createdAt=a,this.updatedAt=c}}},57663:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserPromptHandler=void 0;const a=r(3563),c=i(r(19055)),l=r(96297),d=r(50461),u=r(56550),p=r(56349),f=r(59100),h=r(55324),m=r(66963),g=r(91280),y=r(35444),v=r(88474),_=r(16724);let w=o=class{constructor(e,t,r,o,n,s,i){this.taskService=e,this.conversationHistoryService=t,this.blockService=r,this.agentLoopOrchestrator=o,this.eventEmitter=n,this.mainWorkspaceService=s,this.mentionsService=i}async handleUserPrompt(e,t){c.default.info(`[${o.name}] Processing userPrompt for task ${e.taskId} from client ${t}`),l.debugLogger.log(`[${o.name}] Received userPrompt for task ${e.taskId}`,e);try{const r=await this.taskService.getTask(e.taskId);if(!r)return c.default.error(`[${o.name}] Task not found: ${e.taskId}`),void this.eventEmitter.emit(g.InternalEvents.AGENT_ERROR_NOTIFICATION,{clientId:t,taskId:e.taskId,error:`Task not found: ${e.taskId}`,type:"task_error",context:{source:"handleUserPromptValidation"}});if(r.status===y.TaskStatus.EXECUTING_TOOL)return c.default.warn(`[${o.name}] Rejecting user prompt for task ${e.taskId} (status: ${y.TaskStatus.EXECUTING_TOOL})`),void this.eventEmitter.emit(g.InternalEvents.AGENT_ERROR_NOTIFICATION,{clientId:t,taskId:e.taskId,error:"Cannot accept new prompt while a tool is executing.",type:"task_error",context:{source:"handleUserPromptValidation"}});if(e.personaId&&e.personaId!==r.personaId){c.default.info(`[${o.name}] Persona change detected for task ${e.taskId}: ${r.personaId} → ${e.personaId}`);try{await this.taskService.updateTask({taskId:e.taskId,personaId:e.personaId}),c.default.info(`[${o.name}] Successfully updated task ${e.taskId} persona to ${e.personaId}`)}catch(r){return c.default.error(`[${o.name}] Failed to update persona for task ${e.taskId}: ${r.message}`),void this.eventEmitter.emit(g.InternalEvents.AGENT_ERROR_NOTIFICATION,{clientId:t,taskId:e.taskId,error:`Failed to update persona: ${r.message}`,type:"task_error",context:{source:"handleUserPromptPersonaUpdate"}})}}let n=[],s=!1,i="";if(!(e.segments&&e.segments.length>0))return c.default.warn(`[${o.name}] No content provided in prompt for task ${e.taskId}`),void this.eventEmitter.emit(g.InternalEvents.AGENT_ERROR_NOTIFICATION,{clientId:t,taskId:e.taskId,error:"No content provided in prompt",type:"task_error",context:{source:"handleUserPromptValidation"}});{for(const t of e.segments)if("text"===t.type)if(t.content.trim().startsWith("/newtask ")){s=!0,i=t.content.trim().substring(9).trim();const e=`Follow the usage instructions in the create_new_task tool to create a suitable summary targeted at the next instructions: ${i}`;n.push({type:"text",content:e}),c.default.info(`[${o.name}] Detected /newtask command with instructions: ${i}`)}else n.push({type:"text",content:t.content});else if("image"===t.type){const e=t.metadata?.mediaType||(t.content.startsWith("data:image/png")?"image/png":t.content.startsWith("data:image/webp")?"image/webp":"image/jpeg");n.push({type:"image",content:t.content,metadata:{url:t.metadata?.url||t.content,mediaType:e}})}for(const t of n){const r=(0,f.ulid)();if("text"===t.type)await this.blockService.createBlock({blockId:r,taskId:e.taskId,role:"user",blockType:"text",status:"completed",content:t.content,description:"User Input (Text)"});else if("image"===t.type){const o=t.metadata?.mediaType||(t.content.startsWith("data:image/png")?"image/png":t.content.startsWith("data:image/webp")?"image/webp":"image/jpeg");await this.blockService.createBlock({blockId:r,taskId:e.taskId,role:"user",blockType:"image",status:"completed",content:t.content,metadata:JSON.stringify({url:t.metadata?.url||t.content,mediaType:o}),description:"User Input (Image)"})}}const t=n.findIndex((e=>"text"===e.type));if(-1!==t){const r=n[t].content,{originalTextSegment:o,fileContentSegments:s}=await this.mentionsService.processMentions(r,e.taskId);n[t]=o,n=[...n,...s]}}if(!r.originalPrompt&&n.length>0){const t=n.find((e=>"text"===e.type)),r=t?t.content.substring(0,200):"[Image message]";await this.taskService.updateTask({taskId:e.taskId,originalPrompt:r})}const d=r.workspaceName;if(r.status===y.TaskStatus.USER_CANCELLED&&(c.default.info(`[${o.name}] Restarting previously cancelled task ${e.taskId} with new prompt`),await this.taskService.updateTask({taskId:e.taskId,status:y.TaskStatus.WAITING_FOR_INPUT,result:JSON.stringify({details:"Task restarted with new prompt"})}),c.default.info(`[${o.name}] Task ${e.taskId} status updated from USER_CANCELLED to WAITING_FOR_INPUT`)),d){c.default.info(`[${o.name}] Task ${e.taskId} has workspaceName: ${d}. Validating...`);if(!await this.mainWorkspaceService.findOne(d))throw c.default.error(`[${o.name}] Workspace details not found for name: ${d}`),new a.NotFoundException(`Workspace with name ${d} not found during user prompt handling.`);c.default.info(`[${o.name}] Workspace ${d} validated.`)}else c.default.info(`[${o.name}] Task ${e.taskId} does not have a workspaceName associated.`);await this.taskService.updateTask({taskId:e.taskId,mode:e.mode}),c.default.info(`[${o.name}] Updated task ${e.taskId} mode to ${e.mode}`);const u={id:(0,f.ulid)(),taskId:e.taskId,role:"user",segments:n,providerId:"system",createdAt:new Date};await this.conversationHistoryService.addMessage(e.taskId,u),n.forEach(((t,r)=>{if("text"===t.type){const n=t.content.substring(0,200);l.debugLogger.log(`[${o.name}] Adding segment ${r} to history (Task ${e.taskId}): type=${t.type}, content='${n}...'`)}else l.debugLogger.log(`[${o.name}] Adding segment ${r} to history (Task ${e.taskId}): type=${t.type}`)}));const p=n.find((e=>"text"===e.type)),h=p?p.content.substring(0,100):"[Non-text segments]";c.default.info(`[${o.name}] Added user message with ${n.length} segments. First text segment: ${h}...`);(await this.taskService.getTask(e.taskId)).status===y.TaskStatus.WAITING_FOR_INPUT&&c.default.info(`[${o.name}] Task ${e.taskId} was waiting for user input. Agent loop will set status to IN_PROGRESS.`);const m=await this.conversationHistoryService.getHistory(e.taskId);if(c.default.info(`[${o.name}] Loaded updated history with ${m.length} messages`),m.length>0){const e=m.slice(-3);e.forEach(((t,r)=>{const n=m.length-e.length+r;c.default.info(`[${o.name}] History[${n}] role: ${t.role}, segments: ${t.segments.map((e=>e.type)).join(", ")}`);const s=t.segments.find((e=>"text"===e.type));if(s){const e=s.content.substring(0,100);c.default.info(`[${o.name}] History[${n}] content (first 100 chars): ${e}...`)}}))}await this.agentLoopOrchestrator.runAgentLoop(e.taskId,m,t,e.mode),c.default.info(`[${o.name}] Agent loop initiated for task ${e.taskId}.`)}catch(r){c.default.error(`[${o.name}] Error handling userPrompt for task ${e.taskId}: ${r.message}\n${r.stack}`),this.eventEmitter.emit(g.InternalEvents.AGENT_ERROR_NOTIFICATION,{clientId:t,taskId:e.taskId,error:r.message,type:"task_error",context:{source:"userPromptMainCatch"}})}}};t.UserPromptHandler=w,t.UserPromptHandler=w=o=n([(0,a.Injectable)(),s("design:paramtypes",[u.TaskService,p.ConversationHistoryService,h.BlockService,m.AgentLoopOrchestrator,d.EventEmitter2,v.WorkspaceService,_.MentionsService])],w)},57692:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AccessMcpResourceTool=void 0;const a=r(3563),c=r(20436),l=i(r(19055)),d=r(2115);let u=o=class extends c.BaseTool{constructor(e,t,r){super(r),this.mcpHubService=e,this.name="access_mcp_resource",this.description="Request to access a resource provided by a connected MCP server.",this.userId=t}getModeSpecificGuidance(e){return null}getBaseUsageInstructions(e){const t="## access_mcp_resource\nDescription: Request to access a resource provided by a connected MCP server. Resources represent data sources that can be used as context, such as files, API responses, or system information.\nParameters:\n- server_name: (required) The name of the MCP server providing the resource\n- uri: (required) The URI identifying the specific resource to access\nUsage:\n<access_mcp_resource>\n<server_name>server name here</server_name>\n<uri>resource URI here</uri>\n</access_mcp_resource>";return this.mcpHubService.getConnectedServers(this.userId).length>0?t+'\n\nSee the "Connected MCP Servers" section in the use_mcp_tool documentation above for available resources.\n':t}validateParams(e){return"string"==typeof e.server_name&&""!==e.server_name.trim()&&"string"==typeof e.uri&&""!==e.uri.trim()}async execute(e){const{server_name:t,uri:r}=e;l.default.info(`[${o.name}] Accessing MCP resource ${r} on server ${t}`);try{const e=await this.mcpHubService.readResource(this.userId,t,r);return l.default.info(`[${o.name}] MCP resource ${r} accessed successfully`),e}catch(e){throw l.default.error(`[${o.name}] Error accessing MCP resource ${r}: ${e.message}\n${e.stack}`),new Error(`Error accessing MCP resource ${r}: ${e.message}`)}}};t.AccessMcpResourceTool=u,t.AccessMcpResourceTool=u=o=n([(0,a.Injectable)(),s("design:paramtypes",[d.McpHubService,String,Object])],u)},57852:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.SourceArtefactModule=void 0;const n=r(3563),s=r(94279),i=r(33153),a=r(45908),c=r(376),l=r(84358),d=r(24912);let u=class{};t.SourceArtefactModule=u,t.SourceArtefactModule=u=o([(0,n.Module)({imports:[c.DataSourceModule],controllers:[s.SourceArtefactController],providers:[i.SourceArtefactService,a.SourceArtefactRepository,d.MavenSourceArtefactScheme,{provide:l.SchemePackageManager,useFactory:e=>new l.SchemePackageManager([e]),inject:[d.MavenSourceArtefactScheme]}],exports:[i.SourceArtefactService]})],u)},57967:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigModule=void 0;const n=r(3563),s=r(35015),i=r(52368),a=r(35699),c=r(33713),l=r(376);let d=class{};t.ConfigModule=d,t.ConfigModule=d=o([(0,n.Module)({imports:[l.DataSourceModule],controllers:[s.ConfigController],providers:[i.ConfigService,a.ConfigPropertyRepository,c.ConfigPropertyDescriptor,c.ConfigSection,c.ConfigDescriptors],exports:[i.ConfigService,a.ConfigPropertyRepository,c.ConfigPropertyDescriptor,c.ConfigSection,c.ConfigDescriptors]})],d)},58144:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StoredDocController=void 0;const i=r(3563),a=r(63381),c=r(27823);let l=class{constructor(e){this.storedDocService=e}async storeDoc(e,t,r){const o=await this.storedDocService.storeDoc(e,t,r);return c.StoredDocDTO.fromStoredDoc(o)}async getDoc(e){return this.storedDocService.getDoc(e)}async getDocContent(e,t){const r=await this.storedDocService.getDoc(e);if(!r)throw new Error(`Document not found with id: ${e}`);t.setHeader("Content-Type",r.mimeType),t.send(r.contents)}async getDocsBySession(e){return(await this.storedDocService.getDocsBySession(e)).map((e=>c.StoredDocDTO.fromStoredDoc(e)))}async getDocsByWorkspace(e){return(await this.storedDocService.getDocsByWorkspace(e)).map((e=>c.StoredDocDTO.fromStoredDoc(e)))}};t.StoredDocController=l,o([(0,i.Post)(),s(0,(0,i.Body)("contents")),s(1,(0,i.Query)("sessionId")),s(2,(0,i.Query)("workspaceName")),n("design:type",Function),n("design:paramtypes",[String,String,String]),n("design:returntype",Promise)],l.prototype,"storeDoc",null),o([(0,i.Get)(":id"),s(0,(0,i.Param)("id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],l.prototype,"getDoc",null),o([(0,i.Get)(":id/contents"),s(0,(0,i.Param)("id")),s(1,(0,i.Res)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],l.prototype,"getDocContent",null),o([(0,i.Get)("session/:sessionId"),s(0,(0,i.Param)("sessionId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],l.prototype,"getDocsBySession",null),o([(0,i.Get)("workspace/:workspaceName"),s(0,(0,i.Param)("workspaceName")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],l.prototype,"getDocsByWorkspace",null),t.StoredDocController=l=o([(0,i.Controller)("stored-docs"),n("design:paramtypes",[a.StoredDocService])],l)},58190:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CancellationResetService=void 0;const c=r(3563),l=r(50461),d=a(r(19055)),u=r(55324),p=r(56550),f=r(91280),h=r(35444);let m=o=class{constructor(e,t,r){this.blockService=e,this.taskService=t,this.eventEmitter=r,this.cancelledTasks=new Map,this.setupListeners(),d.default.info(`[${o.name}] CancellationResetService initialized`)}setupListeners(){this.eventEmitter.on(f.InternalEvents.TASK_UPDATED,(e=>{e.status===h.TaskStatus.USER_CANCELLED?this.handleTaskCancellation(e.taskId):this.cancelledTasks.has(e.taskId)&&(d.default.info(`[${o.name}] Task ${e.taskId} status changed to ${e.status}, clearing reset timeout.`),clearTimeout(this.cancelledTasks.get(e.taskId)),this.cancelledTasks.delete(e.taskId))})),d.default.info(`[${o.name}] Listening for TASK_STATUS_UPDATED events`)}handleTaskCancellation(e){d.default.info(`[${o.name}] Task ${e} cancelled. Setting reset timeout.`),this.cancelledTasks.has(e)&&clearTimeout(this.cancelledTasks.get(e));const t=setTimeout((()=>this.checkAndResetTask(e)),2e3);this.cancelledTasks.set(e,t)}async checkAndResetTask(e){this.cancelledTasks.delete(e);try{d.default.info(`[${o.name}] Checking if cancelled task ${e} can be reset to waiting_for_input.`);const t=await this.taskService.getTask(e);if(t.status!==h.TaskStatus.USER_CANCELLED)return void d.default.info(`[${o.name}] Task ${e} is no longer cancelled (status: ${t.status}), not resetting.`);const r=(await this.blockService.getBlocksForTask(e)).slice(-5);if(r.some((e=>"generating"===e.status||"executing"===e.status))){const t=r.filter((e=>"generating"===e.status||"executing"===e.status)).map((e=>`${e.blockId} (${e.status})`)).join(", ");d.default.info(`[${o.name}] Task ${e} still has active blocks: [${t}]. Setting another timeout.`);const n=setTimeout((()=>this.checkAndResetTask(e)),1e3);this.cancelledTasks.set(e,n)}else d.default.info(`[${o.name}] Task ${e} has no active blocks. Resetting to waiting_for_input.`),await this.taskService.updateTask({taskId:e,status:h.TaskStatus.WAITING_FOR_INPUT,result:JSON.stringify({details:"Task was cancelled and has now been reset. You can continue."})})}catch(t){d.default.error(`[${o.name}] Error checking/resetting task ${e}: ${t.message}\n${t.stack}`);const r=setTimeout((()=>this.checkAndResetTask(e)),2e3);this.cancelledTasks.set(e,r)}}};t.CancellationResetService=m,t.CancellationResetService=m=o=n([(0,c.Injectable)(),i(1,(0,c.Inject)((0,c.forwardRef)((()=>p.TaskService)))),s("design:paramtypes",[u.BlockService,p.TaskService,l.EventEmitter2])],m)},58312:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OllamaProvider=void 0;const o=r(93548),n=r(48483),s=r(8959),i=r(52368);class a extends n.BaseProvider{getName(){return"ollama"}getBaseChatModel(e,t){return new o.ChatOllama({baseUrl:this.getBaseUrl(),model:this.shortModelName(e),temperature:t.temperature})}async getModelDescriptors(){return(await this.fetchModels()).map((e=>new s.ModelDescriptor("ollama",e,0,0,0,0)))}isValid(){return!!this.getBaseUrl()}getBaseUrl(){return i.ConfigService.getInstance().getProperty("OLLAMA_BASE_URL")}async fetchModels(){const e=this.getBaseUrl();try{const t=await fetch(`${e}/api/tags`);if(t.ok){const e=await t.json();return(e.models||[]).map((e=>e.name))}return console.log(`Failed to fetch Ollama models. Status code: ${t.status}`),[]}catch(e){return console.error(`Error fetching Ollama models: ${e}`),[]}}}t.OllamaProvider=a},58500:e=>{"use strict";e.exports=require("node:timers/promises")},58620:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LlmMetadataService=void 0;const i=r(3563),a=r(72776),c=r(36206),l=r(52368),d=r(91760),u=s(r(19055));let p=class{constructor(e,t,r){this.appDataSource=e,this.providerRegistry=t,this.openSourceModelRegistry=r,this.serviceName="LlmMetadataService"}get knex(){return this.appDataSource.knex}async onModuleInit(){await this.ensureProvidersInDatabase(),await this.refreshModelsFromProviderApis(),u.default.info(`[${this.serviceName}] LLM metadata service initialized`)}async ensureProvidersInDatabase(){const e=this.providerRegistry.getAllProviders();for(const t of e){const e=t.getId();await this.knex("llm_providers").where("provider_id",e).first()?(await this.knex("llm_providers").where("provider_id",e).update({name:t.getName(),default_model_id:t.getDefaultModelId(),default_base_url:t.getDefaultBaseUrl(),requires_api_key:t.requiresApiKey(),metadata:JSON.stringify(t.getMetadata()),updated_at:this.knex.fn.now()}),u.default.info(`[${this.serviceName}] Updated provider in database: ${e}`)):(await this.knex("llm_providers").insert({provider_id:e,name:t.getName(),default_model_id:t.getDefaultModelId(),default_base_url:t.getDefaultBaseUrl(),requires_api_key:t.requiresApiKey(),metadata:JSON.stringify(t.getMetadata())}),u.default.info(`[${this.serviceName}] Added provider to database: ${e}`))}}async refreshModelsFromProviderApis(){const e=this.providerRegistry.getAllProviders();for(const t of e){const e=t.getId();try{const r=t.getDefaultBaseUrl();if(!t.requiresApiKeyForDiscovery()){u.default.info(`[${this.serviceName}] Provider ${e} does not require API key for discovery, refreshing directly`);try{await this.refreshModelsForProvider(e,"",r),u.default.info(`[${this.serviceName}] Refreshed models for provider: ${e}`)}catch(t){u.default.error(`[${this.serviceName}] Failed to refresh models for provider ${e}: ${t.message}`)}continue}const o=t.getApiKeyName(),n=l.ConfigService.getProperty(o);n||u.default.warn(`[${this.serviceName}] No API key found for provider: ${e} (looked for environment variable: ${o})`);try{await this.refreshModelsForProvider(e,n||"",r),u.default.info(`[${this.serviceName}] Refreshed models for provider: ${e}`)}catch(t){u.default.error(`[${this.serviceName}] Failed to refresh models for provider ${e}: ${t.message}`)}}catch(t){u.default.error(`[${this.serviceName}] Error processing provider ${e}: ${t.message}`)}}}async refreshModelsForProvider(e,t,r){u.default.debug(`[${this.serviceName}] Refreshing models for provider: ${e}`);try{const o=this.providerRegistry.getProvider(e);if(u.default.debug(`[${this.serviceName}] Provider found: ${o.getName()}`),u.default.debug(`[${this.serviceName}] Calling discoverModels for provider: ${e}`),o.requiresApiKeyForDiscovery()&&!t)return void u.default.warn(`[${this.serviceName}] Provider ${e} requires API key for discovery but none provided`);const n=await o.discoverModels(t,r,this.openSourceModelRegistry);u.default.debug(`[${this.serviceName}] Discovered ${n.length} models for provider: ${e}`);for(const e of n)u.default.debug(`[${this.serviceName}] Discovered model: ${e.modelId} (${e.name})`);for(const e of n)try{await this.knex("llm_models").where({model_id:e.modelId,provider_id:e.providerId}).first()?(u.default.info(`[${this.serviceName}] Updating existing model in database: ${e.modelId}`),await this.knex("llm_models").where({model_id:e.modelId,provider_id:e.providerId}).update({name:e.name,family:e.family,context_window:e.contextWindow,max_output_tokens:e.maxOutputTokens,supports_images:e.supportsImages,supports_tool_use:e.supportsToolUse,supports_computer_use:e.supportsComputerUse,supports_prompt_cache:e.supportsPromptCache,supports_thinking_tokens:e.supportsThinkingTokens,recommended_thinking_tokens:e.recommendedThinkingTokens,max_thinking_tokens:e.maxThinkingTokens,input_cost_per_million_tokens:e.inputCostPerMillionTokens,output_cost_per_million_tokens:e.outputCostPerMillionTokens,cache_writes_price:e.cacheWritesPrice,cache_reads_price:e.cacheReadsPrice,metadata:JSON.stringify({...e.metadata,editToolCapabilities:e.editToolCapabilities}),is_default_for_provider:e.isDefaultForProvider,updated_at:this.knex.fn.now()}),u.default.info(`[${this.serviceName}] Successfully updated model in database: ${e.modelId}`)):(u.default.info(`[${this.serviceName}] Adding new model to database: ${e.modelId}`),await this.knex("llm_models").insert({model_id:e.modelId,provider_id:e.providerId,name:e.name,family:e.family,context_window:e.contextWindow,max_output_tokens:e.maxOutputTokens,supports_images:e.supportsImages,supports_tool_use:e.supportsToolUse,supports_computer_use:e.supportsComputerUse,supports_prompt_cache:e.supportsPromptCache,supports_thinking_tokens:e.supportsThinkingTokens,recommended_thinking_tokens:e.recommendedThinkingTokens,max_thinking_tokens:e.maxThinkingTokens,input_cost_per_million_tokens:e.inputCostPerMillionTokens,output_cost_per_million_tokens:e.outputCostPerMillionTokens,cache_writes_price:e.cacheWritesPrice,cache_reads_price:e.cacheReadsPrice,metadata:JSON.stringify({...e.metadata,editToolCapabilities:e.editToolCapabilities}),is_default_for_provider:e.isDefaultForProvider}),u.default.info(`[${this.serviceName}] Successfully added model to database: ${e.modelId}`))}catch(t){u.default.error(`[${this.serviceName}] Error processing model ${e.modelId}: ${t.message}`,t.stack)}const s=await this.getModelsForProvider(e);u.default.info(`[${this.serviceName}] Retrieved ${s.length} models for provider ${e} after refresh`)}catch(t){throw u.default.error(`[${this.serviceName}] Error refreshing models for provider ${e}: ${t.message}`,t.stack),t}}async getModelsForProvider(e){u.default.debug(`[${this.serviceName}] Getting models for provider: ${e}`);try{const t=this.providerRegistry.getProvider(e);u.default.info(`[${this.serviceName}] Provider found in registry: ${t.getName()}`);const r=await this.knex("llm_models").where("provider_id",e).select("*");u.default.debug(`[${this.serviceName}] Retrieved ${r.length} models for provider ${e} from database`);return r.map((e=>{let t,r={};if(e.metadata)try{if(r=JSON.parse(e.metadata),r.editToolCapabilities){t=r.editToolCapabilities;const{editToolCapabilities:e,...o}=r;r=o}}catch(t){u.default.warn(`[${this.serviceName}] Failed to parse metadata for model ${e.model_id}: ${t.message}`),r={}}return{modelId:e.model_id,providerId:e.provider_id,name:e.name,family:e.family,contextWindow:e.context_window,maxOutputTokens:e.max_output_tokens,supportsImages:e.supports_images,supportsToolUse:e.supports_tool_use,supportsComputerUse:e.supports_computer_use,supportsPromptCache:e.supports_prompt_cache,supportsThinkingTokens:e.supports_thinking_tokens||!1,recommendedThinkingTokens:e.recommended_thinking_tokens,maxThinkingTokens:e.max_thinking_tokens,inputCostPerMillionTokens:e.input_cost_per_million_tokens,outputCostPerMillionTokens:e.output_cost_per_million_tokens,cacheWritesPrice:e.cache_writes_price,cacheReadsPrice:e.cache_reads_price,editToolCapabilities:t,metadata:r,isDefaultForProvider:e.is_default_for_provider}}))}catch(t){throw u.default.error(`[${this.serviceName}] Error getting models for provider ${e}: ${t.message}`,t.stack),t}}};t.LlmMetadataService=p,t.LlmMetadataService=p=o([(0,i.Injectable)(),n("design:paramtypes",[a.AppDataSource,c.ProviderRegistry,d.OpenSourceModelRegistryService])],p)},58712:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OuterTagStripper=void 0;class r{constructor(e){if(this.config=e,this.xmlFenceRegex=/```xml([\s\S]*?)```/gs,e&&e.tagName){const t=e.tagName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.openTagRegex=new RegExp(`<${t}>`,"g"),this.closeTagRegex=new RegExp(`</${t}>`,"g"),this.combinedTagRegex=new RegExp(`<${t}>(.*?)</${t}>`,"gs")}}stripOuterTags(e){if(!(this.config&&this.config.tagName&&this.combinedTagRegex&&this.openTagRegex&&this.closeTagRegex))return{strippedContent:e,hadOuterTags:!1,hadXmlFences:!1};let t=!1;return{strippedContent:e.replace(this.combinedTagRegex,((e,r)=>(t=!0,this.config?.stripCompletely?"":this.config?.preserveInner?r:""))),hadOuterTags:t,hadXmlFences:!1}}stripXmlFences(e){if(!this.config?.xmlFenceEnabled)return{strippedContent:e,hadXmlFences:!1};let t=!1;const r=this.config.fenceStripMode||"complete";this.xmlFenceRegex.lastIndex=0;return{strippedContent:e.replace(this.xmlFenceRegex,((e,o)=>{if(t=!0,"complete"===r)return"";{if(null==o)return"";let e=o;return e.startsWith("\r\n")?e=e.substring(2):e.startsWith("\n")&&(e=e.substring(1)),e.endsWith("\r\n")?e=e.substring(0,e.length-2):e.endsWith("\n")&&(e=e.substring(0,e.length-1)),e.trim()}})),hadXmlFences:t}}stripAllOuterWrappers(e){if(!this.config)return{strippedContent:e,hadOuterTags:!1,hadXmlFences:!1,strippedBy:[]};let t=e,r=!1,o=!1;const n=[],s=this.config.processingOrder||(this.config.xmlFenceEnabled?["xmlFences","xmlTags"]:["xmlTags"]);for(const e of s)if("xmlFences"===e&&this.config.xmlFenceEnabled){const e=this.stripXmlFences(t);t=e.strippedContent,e.hadXmlFences&&(o=!0,n.includes("xmlFences")||n.push("xmlFences"))}else if("xmlTags"===e&&this.config.tagName&&this.combinedTagRegex){const e=this.stripOuterTags(t);t=e.strippedContent,e.hadOuterTags&&(r=!0,n.includes("xmlTags")||n.push("xmlTags"))}return{strippedContent:t,hadOuterTags:r,hadXmlFences:o,strippedBy:n}}hasOuterTags(e){return!!(this.config&&this.config.tagName&&this.openTagRegex)&&(this.openTagRegex.lastIndex=0,this.openTagRegex.test(e))}hasXmlFences(e){return!!this.config?.xmlFenceEnabled&&(this.xmlFenceRegex.lastIndex=0,this.xmlFenceRegex.test(e))}extractInnerContent(e){if(!this.config||!this.config.tagName||!this.combinedTagRegex)return e;this.combinedTagRegex.lastIndex=0;const t=this.combinedTagRegex.exec(e);return t&&t[1]?t[1]:e}needsBufferingForXmlTags(e){if(!(this.config&&this.config.tagName&&this.openTagRegex&&this.closeTagRegex))return!1;const t=this.config.tagName,r=`<${t}>`,o=`</${t}>`;if(e.endsWith("<"))return!0;for(let t=1;t<r.length;t++)if(e.endsWith(r.substring(0,t))&&r.substring(0,t)!==r)return!0;if(e.endsWith("</"))return!0;for(let t=1;t<o.length;t++)if(e.endsWith(o.substring(0,t))&&o.substring(0,t)!==o)return!0;this.openTagRegex.lastIndex=0;let n,s=-1;for(;null!==(n=this.openTagRegex.exec(e));)s=n.index;if(-1!==s){this.closeTagRegex.lastIndex=s+r.length;if(!this.closeTagRegex.exec(e))return!0}return!1}needsBufferingForXmlFences(e){if(!this.config?.xmlFenceEnabled)return!1;const t=r.XML_FENCE_START_MARKER,o=r.XML_FENCE_END_MARKER;let n=!1,s=0;if(e.length>0){let r=!1;for(let o=1;o<t.length;o++)if(e.endsWith(t.substring(0,o))){r=!0;break}}for(;s<e.length;)if(n){const t=e.indexOf(o,s);if(-1===t){for(let t=1;t<o.length;t++)if(e.endsWith(o.substring(0,t)))return!0;return!0}n=!1,s=t+o.length}else{const r=e.indexOf(t,s);if(-1===r){for(let r=1;r<t.length;r++)if(e.endsWith(t.substring(0,r)))return!0;s=e.length}else n=!0,s=r+t.length}return n||e===t}needsBuffering(e){let t=!1;return this.config?.tagName&&(t=this.needsBufferingForXmlTags(e)),!t&&this.config?.xmlFenceEnabled&&(t=this.needsBufferingForXmlFences(e)),t}processChunkedContent(e,t=""){if(!this.config||!this.config.tagName&&!this.config.xmlFenceEnabled)return{strippedContent:t+e,hadOuterTags:!1,hadXmlFences:!1,needsMoreContent:!1,strippedBy:[]};let r="",o="",n=!1,s=!1;const i=[];let a=t+e;const c=this.config.processingOrder||(this.config.xmlFenceEnabled&&this.config.tagName?["xmlFences","xmlTags"]:this.config.xmlFenceEnabled?["xmlFences"]:this.config.tagName?["xmlTags"]:[]);for(const e of c)if("xmlFences"===e&&this.config.xmlFenceEnabled){let e;this.xmlFenceRegex.lastIndex=0;let t="",r=0;for(;null!==(e=this.xmlFenceRegex.exec(a));){s=!0,i.includes("xmlFences")||i.push("xmlFences"),t+=a.substring(r,e.index);const o=e[1];if("markers-only"===this.config.fenceStripMode&&void 0!==o){let e=o;e.startsWith("\r\n")?e=e.substring(2):e.startsWith("\n")&&(e=e.substring(1)),e.endsWith("\r\n")?e=e.substring(0,e.length-2):e.endsWith("\n")&&(e=e.substring(0,e.length-1)),t+=e.trim()}else if("complete"===this.config.fenceStripMode);else{let e=o||"";e.startsWith("\r\n")?e=e.substring(2):e.startsWith("\n")&&(e=e.substring(1)),e.endsWith("\r\n")?e=e.substring(0,e.length-2):e.endsWith("\n")&&(e=e.substring(0,e.length-1)),t+=e.trim()}r=this.xmlFenceRegex.lastIndex}t+=a.substring(r),a=t}else if("xmlTags"===e&&this.config.tagName&&this.combinedTagRegex){let e;this.combinedTagRegex.lastIndex=0;let t="",r=0;for(;null!==(e=this.combinedTagRegex.exec(a));)n=!0,i.includes("xmlTags")||i.push("xmlTags"),t+=a.substring(r,e.index),this.config.preserveInner&&e[1]?t+=e[1]:this.config.stripCompletely||(t+=e[1]?e[1]:""),r=this.combinedTagRegex.lastIndex;t+=a.substring(r),a=t}return this.needsBuffering(a)?o=a:r=a,{strippedContent:r,hadOuterTags:n,hadXmlFences:s,needsMoreContent:o.length>0,bufferedContent:o,strippedBy:i}}}t.OuterTagStripper=r,r.XML_FENCE_START_MARKER="```xml",r.XML_FENCE_END_MARKER="```"},58756:e=>{"use strict";e.exports=require("minimatch")},58938:e=>{"use strict";e.exports=require("axios")},59100:e=>{"use strict";e.exports=require("ulid")},59503:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EveAgentInternalGateway=void 0;const a=r(3563),c=r(50461),l=i(r(19055)),d=r(56550),u=r(35444),p=r(91280);let f=o=class{constructor(e,t){this.taskService=e,this.eventEmitter=t,l.default.info(`[${o.name}] Gateway initialized`)}async handleToolExecutionCompleted(e){if(l.default.info(`[${o.name}] Processing ${p.InternalEvents.TOOL_EXECUTION_COMPLETED} for task ${e.taskId}, status: ${e.status}`),"rejected"===e.status)try{await this.taskService.updateTask({taskId:e.taskId,status:u.TaskStatus.WAITING_FOR_INPUT});const t={taskId:e.taskId,clientId:e.clientId,status:u.TaskStatus.WAITING_FOR_INPUT};this.eventEmitter.emit(p.InternalEvents.TASK_UPDATED,t),l.default.info(`[${o.name}] Updated task ${e.taskId} status to WAITING_FOR_INPUT after tool rejection`)}catch(t){l.default.error(`[${o.name}] Error updating task status after tool rejection for task ${e.taskId}: ${t.message}`),this.eventEmitter.emit(p.InternalEvents.AGENT_ERROR_NOTIFICATION,{taskId:e.taskId,clientId:e.clientId,error:`Failed to update task status after tool rejection: ${t.message}`,type:"task_error"})}}async handleGenericInternalError(e){l.default.warn(`[${o.name}] Received ${p.InternalEvents.TOOL_ERROR} for task ${e.taskId}: ${e.error}`)}};t.EveAgentInternalGateway=f,n([(0,c.OnEvent)(p.InternalEvents.TOOL_EXECUTION_COMPLETED),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],f.prototype,"handleToolExecutionCompleted",null),n([(0,c.OnEvent)(p.InternalEvents.TOOL_ERROR),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],f.prototype,"handleGenericInternalError",null),t.EveAgentInternalGateway=f=o=n([(0,a.Injectable)(),s("design:paramtypes",[d.TaskService,c.EventEmitter2])],f)},59512:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VercelAdapter=void 0;const i=r(3563),a=r(71618),c=r(42808),l=s(r(19055));let d=class{constructor(e){this.provider=e,this.id="vercel",this.name="Vercel v0",this.messageTransformer=new c.OpenAIMessageTransformer,l.default.info("[VercelAdapter] Initialized")}getProvider(){return this.provider}getModelClient(e){return this.provider.getModelClient(e)}toProviderFormat(e){return this.messageTransformer.toProviderFormat(e)}fromProviderFormat(e){return this.messageTransformer.fromProviderFormat(e,"")}extractMetadata(e){return{format:"openai-api"}}supportsThinking(){return!1}supportsFormatConversion(e){return!0}};t.VercelAdapter=d,t.VercelAdapter=d=o([(0,i.Injectable)(),n("design:paramtypes",[a.VercelProvider])],d)},60269:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.DbDebugContextService=void 0;const n=r(3563),s=r(90290),i=r(59100),a=r(96297);let c=class{constructor(){this.storage=new s.AsyncLocalStorage,this.activeContexts=new Map}async runWithContext(e,t){const r={...e,operationId:(0,i.ulid)(),startTime:Date.now()};return this.activeContexts.set(r.operationId,r),a.debugLogger.log(`[DbDebugContext] Starting operation: ${r.operationName} (ID: ${r.operationId}, Task: ${r.taskId||"N/A"})`),this.storage.run(r,(async()=>{try{return await t()}finally{this.activeContexts.delete(r.operationId);const e=Date.now()-r.startTime;a.debugLogger.log(`[DbDebugContext] Finished operation: ${r.operationName} (ID: ${r.operationId}, Duration: ${e}ms)`)}}))}getContext(){return this.storage.getStore()}getActiveContexts(){return Array.from(this.activeContexts.values())}};t.DbDebugContextService=c,t.DbDebugContextService=c=o([(0,n.Injectable)()],c)},60383:(e,t,r)=>{"use strict";let o;async function n(e){const t=await(await o).subtle.digest("SHA-256",(new TextEncoder).encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}Object.defineProperty(t,"__esModule",{value:!0}),t.generateChallenge=n,t.default=async function(e){e||(e=43);if(e<43||e>128)throw`Expected a length between 43 and 128. Received ${e}.`;const t=await async function(e){return await async function(e){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";let r="";const n=await async function(e){return(await o).getRandomValues(new Uint8Array(e))}(e);for(let o=0;o<e;o++){r+=t[n[o]%t.length]}return r}(e)}(e),r=await n(t);return{code_verifier:t,code_challenge:r}},t.verifyChallenge=async function(e,t){return await n(e)===t},o=globalThis.crypto?.webcrypto??globalThis.crypto??Promise.resolve().then(r.t.bind(r,77598,23)).then((e=>e.webcrypto))},60499:function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(17188),t),n(r(70811),t)},60756:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.PluginModule=void 0;const n=r(3563),s=r(7307),i=r(72177),a=r(70361),c=r(32424);let l=class{};t.PluginModule=l,t.PluginModule=l=o([(0,n.Module)({imports:[i.AgentsModule,a.ToolsModule,c.GraphAgentModule],providers:[s.PluginLoaderService],exports:[s.PluginLoaderService]})],l)},60779:e=>{"use strict";e.exports=require("@langchain/community/document_loaders/fs/csv")},60818:e=>{"use strict";e.exports=require("dotenv")},61208:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AnthropicAdapter=void 0;const i=r(3563),a=r(10146),c=s(r(19055)),l=r(63118);let d=class{constructor(e){this.provider=e,this.id="anthropic",this.name="Anthropic",this.messageTransformer=new l.AnthropicMessageTransformer}getProvider(){return this.provider}getModelClient(e){return this.provider.getModelClient(e)}toProviderFormat(e){return this.messageTransformer.toProviderFormat(e)}fromProviderFormat(e,t=""){return this.messageTransformer.fromProviderFormat(e,t).map((e=>({...e,taskId:e.taskId||t||""})))}extractMetadata(e){return c.default.debug("[AnthropicAdapter] extractMetadata called, returning null as logic is in ModelClient."),null}supportsThinking(){return!0}supportsFormatConversion(e){return!0}};t.AnthropicAdapter=d,t.AnthropicAdapter=d=o([(0,i.Injectable)(),n("design:paramtypes",[a.AnthropicProvider])],d)},61302:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PROVIDER_CANCELLATION_STRATEGIES=void 0,t.getCancellationStrategy=i,t.setupAbortHandling=function(e,t,r){if(!r)return void n.default.info(`[CancellationUtils] No abort signal provided for ${t} stream`);const o=i(t);r.aborted&&(n.default.info(`[CancellationUtils] Abort signal already aborted for ${t} stream`),s.debugLogger.log(`Abort signal already aborted for ${t} stream`));r.addEventListener("abort",(()=>{n.default.info(`[CancellationUtils] Abort signal triggered for ${t} stream`),s.debugLogger.log(`ABORT SIGNAL TRIGGERED for ${t} stream`),o.cancelStream(e)})),n.default.info(`[CancellationUtils] Abort handling set up for ${t} stream`)},t.createAbortableStream=async function*(e,t){if(t?.aborted)throw n.default.info("[CancellationUtils] Stream aborted before processing started"),new Error("Operation aborted before stream processing started");try{for await(const r of e){if(t?.aborted)throw n.default.info("[CancellationUtils] Stream aborted during processing"),new Error("Operation aborted during stream processing");yield r}}catch(e){if(t?.aborted||e.message?.includes("abort")||e.message?.includes("cancel"))throw n.default.info(`[CancellationUtils] Stream aborted with error: ${e.message}`),new Error("Operation aborted: "+e.message);throw e}};const n=o(r(19055)),s=r(96297);function i(e){return t.PROVIDER_CANCELLATION_STRATEGIES[e]||t.PROVIDER_CANCELLATION_STRATEGIES.default}t.PROVIDER_CANCELLATION_STRATEGIES={anthropic:{supportsNativeCancellation:!0,cancelStream:e=>{e&&"function"==typeof e.cancel&&e.cancel()},shouldCheckAbortBeforeChunk:!0},google:{supportsNativeCancellation:!1,cancelStream:e=>{n.default.info("[CancellationUtils] Attempting to cancel Google stream (may not be supported)")},shouldCheckAbortBeforeChunk:!0},default:{supportsNativeCancellation:!1,cancelStream:()=>{n.default.info("[CancellationUtils] Using default cancellation strategy (no-op)")},shouldCheckAbortBeforeChunk:!0}}},61781:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FetchWebPage=void 0;const a=r(83153),c=r(11569),l=i(r(40758)),d=i(r(19055)),u=r(3563),p=r(93239);let f=class extends a.Tool{constructor(e){super(),this.summaryCompletion=e,this.name="fetch_web_page",this.description="Fetch the body text of a web page using a headless browser. This tool should only be used if the user has specifically asked for a web page by URL.",this.schema=c.z.object({url:c.z.string().describe("The URL of the web page to fetch")}),this.warningThreshold=5e4}async _call({url:e}){try{d.default.info(`Fetching web page: ${e}`);const t=await l.default.launch({headless:!0}),r=await t.newPage();await r.goto(e,{waitUntil:"networkidle0"});const o=await r.evaluate((()=>document.body.innerText));if(await t.close(),o.length>this.warningThreshold){d.default.warn(`Large text content detected (${o.length} characters) for URL: ${e}`);const t=`Please summarise the contents of the web url: ${e} so that we get all the useful information from the page`;return`Fetched and summarized text from URL: ${e}\nSummary:\n${await this.summaryCompletion.getSummary(t,o)}`}return`Fetched text from URL: ${e}\nContent:\n${o}`}catch(t){d.default.error(`Error fetching web page: ${e}`,t);return`Error fetching web page: ${e}\nError:\n${t.message||"Unknown error occurred"}`}}};t.FetchWebPage=f,t.FetchWebPage=f=o([s(0,(0,u.Inject)(p.SummaryCompletion)),n("design:paramtypes",[p.SummaryCompletion])],f)},61983:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ComputerToolMac=void 0;const c=r(11569),l=r(35317),d=r(39023),u=r(53903),p=i(r(70943)),f=a(r(73864)),h=i(r(79896)),m=i(r(16928)),g=r(97751),y=r(87650),v=a(r(19055)),_=(0,d.promisify)(l.exec);class w extends g.ComputerToolBase{validateParams(e){return c.z.object({action:c.z.enum(["key","type","mouse_move","left_click","left_click_drag","right_click","middle_click","double_click","screenshot","cursor_position"]),text:c.z.string().optional(),coordinate:c.z.array(c.z.number()).length(2).optional()}).parse(e)}constructor(){super(),this.screenshotDelay=2,this.scalingEnabled=!0,this.outputDir="/tmp/outputs",this.kpKeys=new Set(["arrow-down","arrow-left","arrow-right","arrow-up","brightness-down","brightness-up","delete","end","enter","esc","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","f13","f14","f15","f16","fwd-delete","home","keys-light-down","keys-light-toggle","keys-light-up","mute","num-0","num-1","num-2","num-3","num-4","num-5","num-6","num-7","num-8","num-9","num-clear","num-divide","num-enter","num-equals","num-minus","num-multiply","num-plus","page-down","page-up","play-next","play-pause","play-previous","return","space","tab","volume-down","volume-up"]),v.default.info("Initializing ComputerToolMac"),(0,f.default)("cliclick").then((function(e){v.default.info("cliclick command found")})).catch((function(){const e="cliclick is not installed. Please install it via Homebrew: brew install cliclick";throw v.default.error(e),new Error(e)})),(0,f.default)("convert").then((function(e){v.default.info("ImageMagick convert command found")})).catch((function(){const e="ImageMagick is not installed. Please install it via Homebrew: brew install imagemagick";throw v.default.error(e),new Error(e)}))}async execute(e){v.default.info(`Executing ComputerToolMac command: ${JSON.stringify(e)}`);try{const t=this.validateParams(e);v.default.info(`Parameters validated successfully: ${JSON.stringify(t)}`);const{action:r,text:o,coordinate:n}=t;let s;switch(r){case"mouse_move":case"left_click_drag":if(!n)throw new y.ToolError(`coordinate is required for ${r}`);const[e,t]=n,i=Math.round(e/this.scale),a=Math.round(t/this.scale);if(v.default.info(`Adjusted coordinates for scale factor (${this.scale}): (${i}, ${a})`),"mouse_move"===r)s=await this.executeCommands([`m:${i},${a}`]);else{const e=[`dd:${i},${a}`,`du:${i},${a}`];s=await this.executeCommands(e)}break;case"key":if(!o)throw new y.ToolError(`text is required for ${r}`);s=await this.pressKey(o);break;case"type":if(!o)throw new y.ToolError(`text is required for ${r}`);s=await this.typeText(o);break;case"left_click":case"right_click":case"middle_click":case"double_click":s=await this.clickAction(r);break;case"screenshot":return s=await this.screenshot(),[{type:"image_url",image_url:{url:`data:image/png;base64,${s.base64_image}`}}];case"cursor_position":s=await this.getCursorPosition();break;default:throw new y.ToolError(`Invalid action: ${r}`)}return s.output}catch(e){return e instanceof y.ToolError?(v.default.error("Tool error in ComputerToolMac",{error:e.message,stack:e.stack}),`Error: ${e.message}`):(v.default.error("Unexpected error in ComputerToolMac",{error:e instanceof Error?e.stack:String(e)}),`Unexpected error: ${e}`)}}async typeText(e){v.default.info(`Typing text: ${e}`);const t=["-w 200"];t.push(`t:${p.quote([e])}`),v.default.info(`Built commands for typing text: ${t.join(" ")}`);return await this.executeCommands(t)}async pressKey(e){v.default.info(`Pressing key: ${e}`);const{modifiers:t,key:r}=this.parseKeyCommand(e),o=["-w 200"];for(const e of t)v.default.info(`Key down modifier: ${e}`),o.push(`kd:${e}`);if(this.kpKeys.has(r))v.default.info(`Pressing special key with kp: ${r}`),o.push(`kp:${r}`);else{if(1!==r.length)throw new y.ToolError(`Invalid key: ${r}`);v.default.info(`Typing key with t: ${r}`),o.push(`t:${p.quote([r])}`)}for(const e of t.reverse())v.default.info(`Key up modifier: ${e}`),o.push(`ku:${e}`);v.default.info(`Built commands for key press: ${o.join(" ")}`);return await this.executeCommands(o)}async clickAction(e){const t={left_click:"c:.",right_click:"rc:.",middle_click:"mc:.",double_click:"dc:."}[e];if(!t)throw new y.ToolError(`Invalid click action: ${e}`);const r=["-w 200",t];return await this.executeCommands(r)}async getCursorPosition(){const e=await this.executeCommands(["p:."],!1),t=e.output?.trim()||"",r=t.match(/(\d+),(\d+)/);if(!r)throw new y.ToolError(`Failed to parse cursor position: ${t}`);const o=parseInt(r[1],10),n=parseInt(r[2],10);return new y.ToolResult(`X=${o},Y=${n}`,"")}async screenshot(){v.default.info("Taking screenshot"),v.default.info(`Ensuring output directory exists: ${this.outputDir}`),h.mkdirSync(this.outputDir,{recursive:!0});const e=m.join(this.outputDir,`screenshot_${(0,u.v4)().replace(/-/g,"")}.png`);v.default.info(`Screenshot will be saved to: ${e}`);const t=`screencapture -x ${e}`;v.default.info("Executing screenshot command",{cmd:t});const r=await _(t,{shell:"/bin/bash"});let o=this.width,n=this.height;if(null==o||null==n){const t=`magick identify -format "%w %h" ${e}`;v.default.info(`Executing identify command to get image dimensions: ${t}`);const r=await _(t,{shell:"/bin/bash"}),[s,i]=r.stdout.trim().split(" ");o=parseInt(s,10),n=parseInt(i,10),this.width=o,this.height=n}const s=`magick ${e} -resize ${Math.floor(o*this.scale)}x${Math.floor(n*this.scale)}! ${e}`;if(v.default.info(`Executing resize command: ${s}`),await _(s,{shell:"/bin/bash"}),h.existsSync(e)){const t=h.readFileSync(e).toString("base64");return new y.ToolResult("","",t)}throw new y.ToolError(`Failed to take screenshot: ${r.stderr}`)}async executeCommands(e,t=!0){v.default.info(`Executing commands: ${e.join(" ")}`);const r=`cliclick ${e.join(" ")}`;v.default.info(`Final cliclick command: ${r}`);try{const{stdout:e,stderr:o}=await _(r,{shell:"/bin/bash"});e&&v.default.info(`Command produced stdout output: ${e}`),o&&v.default.warn(`Command produced stderr output: ${o}`);let n=null;return t&&(v.default.info(`Waiting ${this.screenshotDelay} seconds before taking screenshot`),await new Promise((e=>setTimeout(e,1e3*this.screenshotDelay))),n=(await this.screenshot()).base64_image),v.default.info("Commands executed successfully",{hasOutput:!!e,hasScreenshot:!!n}),new y.ToolResult(e,o,n)}catch(e){throw v.default.error(`Command execution failed: ${e instanceof Error?e.stack:String(e)}`),e}}parseKeyCommand(e){const t=e.toLowerCase().split("+"),r=t.pop(),o={cmd:"cmd",command:"cmd",ctrl:"ctrl",control:"ctrl",alt:"alt",option:"alt",fn:"fn",shift:"shift"},n=t.map((e=>{const t=o[e];if(!t)throw new y.ToolError(`Invalid modifier key: ${e}`);return t}));if(this.kpKeys.has(r))return{modifiers:n,key:r};if(1===r.length&&/^[a-z0-9]$/.test(r))return{modifiers:n,key:r};throw new y.ToolError(`Invalid key: ${r}`)}}t.ComputerToolMac=w},62318:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MLX_PROVIDER_ID=t.getDefaultMlxModelId=t.discoverMlxModels=t.MlxAdapter=t.MlxProvider=void 0;var o=r(1098);Object.defineProperty(t,"MlxProvider",{enumerable:!0,get:function(){return o.MlxProvider}});var n=r(79056);Object.defineProperty(t,"MlxAdapter",{enumerable:!0,get:function(){return n.MlxAdapter}});var s=r(34313);Object.defineProperty(t,"discoverMlxModels",{enumerable:!0,get:function(){return s.discoverMlxModels}}),Object.defineProperty(t,"getDefaultMlxModelId",{enumerable:!0,get:function(){return s.getDefaultMlxModelId}}),Object.defineProperty(t,"MLX_PROVIDER_ID",{enumerable:!0,get:function(){return s.MLX_PROVIDER_ID}})},62397:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.McpToolFactoryService=void 0;const u=r(3563),p=r(52368),f=d(r(19055)),h=r(76910),m=r(60499),g=c(r(79896)),y=c(r(16928)),v=r(39023);r(70811);let _=n=class{constructor(e){this.configService=e,this.readFileAsync=(0,v.promisify)(g.readFile),this.accessAsync=(0,v.promisify)(g.access)}async createMcpTools(){const e=this.configService.getProperty(h.ConfigPropNames.MCP_SERVERS_DIRECTORY,"~/.hldk/mcp-servers"),t=e.startsWith("~")?y.join(process.env.HOME||"",e.substring(1)):e,r=y.join(t,"mcp-servers.json");try{await this.accessAsync(r,g.constants.R_OK)}catch(e){return f.default.warn(`[${n.name}] MCP servers configuration file not found at ${r}`),[]}try{const e=await this.readFileAsync(r,"utf8"),t=JSON.parse(e);if(!t.mcpServers||0===Object.keys(t.mcpServers).length)return f.default.warn(`[${n.name}] No MCP servers defined in configuration`),[];const o=[];for(const[e,r]of Object.entries(t.mcpServers))if(r.disabled)f.default.info(`[${n.name}] Skipping disabled MCP server: ${e}`);else try{f.default.info(`[${n.name}] Initializing MCP server: ${e}`);const t=new m.MCPToolkit(r);await t.initialize();const s=await t.get_tools();f.default.info(`[${n.name}] Created ${s.length} tools from MCP server: ${e}`),o.push(...s)}catch(t){f.default.error(`[${n.name}] Failed to initialize MCP server ${e}: ${t.message}`)}return f.default.info(`[${n.name}] Created a total of ${o.length} MCP tools from all servers`),o}catch(e){return f.default.error(`[${n.name}] Error processing MCP servers configuration: ${e.message}`),[]}}};t.McpToolFactoryService=_,t.McpToolFactoryService=_=n=a([(0,u.Injectable)(),l("design:paramtypes",[p.ConfigService])],_)},62678:e=>{"use strict";e.exports=require("lru-cache")},63118:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AnthropicMessageTransformer=void 0;const n=o(r(19055)),s=r(96297);t.AnthropicMessageTransformer=class{toProviderFormat(e,t=!1){n.default.info(`[AnthropicMessageTransformer] Converting ${e.length} messages to provider format. Thinking enabled: ${t}`);let r=0,o={text:0,thinking:0,image:0,tool_use:0,other:0};const i=e.map(((e,i)=>{if("anthropic"===e.providerId&&e.providerMetadata)return e.providerMetadata;const a="assistant"===e.role?"assistant":"user",c=[];let l=0;for(const r of e.segments){const i=r.content?r.content.length:0;if(l+=Math.ceil(i/2.5),"text"===r.type)c.push({type:"text",text:r.content}),o.text++;else if("thinking"===r.type)if(o.thinking++,t){const t={type:"thinking",thinking:r.content};"string"==typeof r.metadata?.signature&&r.metadata.signature.length>0?t.signature=r.metadata.signature:(n.default.warn(`[AnthropicMessageTransformer] Missing or invalid signature for thinking segment in message ${e.id}. Omitting signature field.`),s.debugLogger.dumpObject("[AnthropicMessageTransformer] Segment with missing signature:",r)),c.push(t)}else c.push({type:"text",text:`<thinking>${r.content}</thinking>`});else if("other"===r.type&&"tool_use"===r.metadata?.providerSpecificType){o.tool_use++;const e=JSON.parse(r.content);c.push({type:"tool_use",id:e.id||"tool-"+Date.now(),name:e.name,input:e.input})}else if("image"===r.type){o.image++,l+=1568;const t=r.metadata?.url||r.content;if(t.startsWith("data:")){n.default.info(`[AnthropicMessageTransformer] Processing base64 image in message ${e.id}`);let o=r.metadata?.mediaType||"image/jpeg";if(t.startsWith("data:")&&t.includes(";base64,")){const e=t.match(/^data:([^;]+);base64,/);e&&e[1]&&(o=e[1])}let s=t;t.includes(";base64,")&&(s=t.split(";base64,")[1]),c.push({type:"image",source:{type:"base64",media_type:o,data:s}})}else n.default.info(`[AnthropicMessageTransformer] Processing URL image in message ${e.id}`),c.push({type:"image",source:{type:"url",url:t}})}else o.other++,n.default.warn(`[AnthropicMessageTransformer] Unsupported segment type: ${r.type}. Converting to text.`),c.push({type:"text",text:r.content})}l+=20,r+=l;c.length>0&&c[0].text?c[0].text.length>200?c[0].text.substring(0,200):c[0].text:c.length;return{role:a,content:c}}));return n.default.info(`[AnthropicMessageTransformer] Transformation complete:\n  Messages processed: ${e.length}\n  Total estimated tokens: ~${r}\n  Segment types: text=${o.text}, thinking=${o.thinking}, image=${o.image}, tool_use=${o.tool_use}, other=${o.other}`),i}applyPromptCaching(e){const t=e.reduce(((e,t,r)=>"user"===t.role?[...e,r]:e),[]),r=t[t.length-1]??-1,o=t[t.length-2]??-1;return e.map(((e,t)=>t===r||t===o?this.addCacheControlToMessage(e):e))}addCacheControlToMessage(e){let t;if("string"==typeof e.content?t=[{type:"text",text:e.content}]:Array.isArray(e.content)?t=[...e.content]:(n.default.warn("[AnthropicMessageTransformer] Unexpected message content format for caching: "+typeof e.content),t=[{type:"text",text:String(e.content)}]),t.length>0){const e=t[t.length-1];"text"===e.type?t[t.length-1]={...e,cache_control:{type:"ephemeral"}}:t.push({type:"text",text:"",cache_control:{type:"ephemeral"}})}else t.push({type:"text",text:"",cache_control:{type:"ephemeral"}});return{...e,content:t}}fromProviderFormat(e,t){return e.map((e=>{const o="assistant"===e.role?"assistant":"user",s=[];if(Array.isArray(e.content))for(const t of e.content)if("text"===t.type)s.push({type:"text",content:t.text});else if("thinking"===t.type)s.push({type:"thinking",content:t.thinking||"",metadata:{signature:t.signature}});else if("image"===t.type&&t.source)if("url"===t.source.type&&t.source.url)n.default.info("[AnthropicMessageTransformer] Processing URL image from provider"),s.push({type:"image",content:`[Image: ${t.source.url}]`,metadata:{url:t.source.url,mediaType:"image/jpeg"}});else if("base64"===t.source.type&&t.source.data){n.default.info("[AnthropicMessageTransformer] Processing base64 image from provider");const e=t.source.media_type||"image/jpeg",r=`data:${e};base64,${t.source.data}`;s.push({type:"image",content:r,metadata:{mediaType:e}})}else n.default.warn(`[AnthropicMessageTransformer] Unknown image source type from provider: ${t.source.type}`),s.push({type:"text",content:`[Unsupported image format: ${JSON.stringify(t.source)}]`});else n.default.warn(`[AnthropicMessageTransformer] Unsupported content type from provider: ${t.type}. Converting to text.`),s.push({type:"text",content:JSON.stringify(t)});else"string"==typeof e.content?s.push({type:"text",content:e.content}):(n.default.warn("[AnthropicMessageTransformer] Unknown content format from provider. Converting to string."),s.push({type:"text",content:JSON.stringify(e.content)}));return{id:r(59100).ulid(),taskId:t,role:o,segments:s,providerId:"anthropic",providerMetadata:{format:"structured"},createdAt:new Date}}))}}},63381:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StoredDocService=void 0;const d=r(3563),u=r(43543),p=r(88648),f=a(r(91943)),h=a(r(70857)),m=a(r(16928)),g=r(53903),y=l(r(19055));let v=class{constructor(e){this.storedDocRepository=e}async storeDoc(e,t,r,o){const n=new u.StoredDoc(e,t,r,o);return await this.storedDocRepository.save(n),y.default.info(`Stored new document with ID: ${n.id}, sessionId: ${r||"none"}, workspaceName: ${o||"none"}`),n}async getDoc(e){const t=await this.storedDocRepository.findById(e);return t?y.default.info(`Retrieved document with ID: ${e}`):y.default.info(`Document not found with ID: ${e}`),t}async getDocMetadata(e){return this.storedDocRepository.findByIdWithoutContents(e)}async getDocsBySession(e){const t=await this.storedDocRepository.findBySessionId(e);return y.default.info(`Retrieved ${t.length} documents for session: ${e}`),t}async getDocsByWorkspace(e){const t=await this.storedDocRepository.findByWorkspaceName(e);return y.default.info(`Retrieved ${t.length} documents for workspace: ${e}`),t}async withFile(e,t){const r=await this.getDoc(e);if(!r)throw new Error(`Document not found with id: ${e}`);const o=await f.mkdtemp(m.join(h.tmpdir(),"hldk-")),n=m.join(o,`${(0,g.v4)()}`);y.default.info(`Created temporary file for document ${e}: ${n}`);try{await f.writeFile(n,r.contents);return await t(n)}finally{try{await f.unlink(n),await f.rmdir(o)}catch(e){y.default.error("Error cleaning up temporary file:",e)}}}};t.StoredDocService=v,t.StoredDocService=v=i([(0,d.Injectable)(),c("design:paramtypes",[p.StoredDocRepository])],v)},63887:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpsAgentService=void 0;const d=r(3563),u=a(r(79896)),p=r(93470),f=a(r(16928)),h=r(55277),m=r(86158),g=r(22300);let y=class extends h.GraphAgentService{constructor(e,t,r){super(e,t,r),this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}getName(){return"ops-agent"}async getTools(e){return await this.toolFactoryService.createTools(["read_file","update_file","delete_file","command_line","add_workspace","fetch_web_page","git_init","serp_api"],e)}async getSystemPrompt(e){let t="";const r=f.join(e.workspace.repoBaseDir,"ops-hints.md");u.existsSync(r)&&(t=u.readFileSync(r,"utf-8"));const o=process.platform,n="win32"===o?"Windows":"darwin"===o?"macOS":"Linux";return`\n    You are a helpful DevOps agent specializing in system operations, automation, and infrastructure management. Your task is to assist with various DevOps-related tasks and solve problems using the tools provided.\n\n    WORKSPACE INFORMATION:\n    Current working directory: ${e.workspace.repoBaseDir}\n    Current operating system: ${n}\n\n    AVAILABLE TOOLS AND THEIR USAGE:\n\n    1. File Operations:\n       - read_file: Read the contents of any file in the workspace\n       - update_file: Modify file contents (requires filePath, search text, and replacement text)\n       - delete_file: Remove a file (use with caution, confirm before deleting important files)\n\n    2. System Operations:\n       - command_line: Execute shell commands\n         * Can specify a subdirectory to run commands in\n         * Use for package management, build tools, and system commands\n         * ALWAYS include automatic confirmation flags to prevent hanging:\n           - Use --yes or -y for apt, apt-get\n           - Use -y for yum\n           - Use --no-input for pip\n           - Use -f or --force for npm/pnpm\n           - Use --defaults for yeoman\n           - Use --non-interactive for composer\n           - Use --assume-yes for other tools\n           - Add appropriate silent/quiet flags when available\n         * DO NOT use for process termination or destructive operations\n       \n    3. Git and Repository Management:\n       - git_init: Initialize a new Git repository\n       - Always use 'git add -A' for staging changes\n\n    5. Additional Tools:\n       - add_workspace: Add a new workspace (specify target project's base directory)\n       - fetch_web_page: Fetch web page content (only when explicitly requested)\n\n    OPERATIONAL GUIDELINES:\n\n    1. Safety and Security:\n       - Never perform destructive operations that cannot be undone\n       - Do not terminate processes unless explicitly instructed\n       - Stop and report if multiple solution attempts fail\n       - Never access or modify files outside the workspace directory\n\n    2. Workspace Management:\n       - You can create directories and files within the workspace\n       - You can read and modify any files under the repo root\n       - Never traverse up beyond the workspace root directory\n\n    3. Best Practices:\n       - Always verify file existence before operations\n       - Use appropriate error handling\n       - Document significant changes\n       - Ask for clarification when instructions are unclear or risky\n\n    4. New Project Creation:\n       - When asked to create a new project with specific technologies:\n         * First, search for suitable template projects:\n           - Use fetch_web_page with GitHub search URL in format:\n             https://github.com/search?q=tech1%20tech2%20app%20starter&type=repositories\n             (replacing tech1, tech2, etc. with the requested technologies)\n           - Analyze results and identify best candidates based on:\n             * Star count (higher is better)\n             * Last update date (2020 or newer preferred)\n             * Match to requested tech stack\n           - Present top candidates to user and ask if they want to use one as template\n           - If user selects a template, use add_workspace tool with the chosen repo URL\n         \n         * If no good templates found or user prefers fresh setup:\n           - Offer to bootstrap project using official tooling\n           - Create appropriate subdirectory in workspace\n           - Use command_line tool with proper package manager/CLI tools\n           - Use sensible defaults where possible\n           - Ask user for input only when necessary for key decisions\n           - After setup complete:\n             * Add a README.md file to the new project directory with instructions for the user\n             * Use the add_workspace tool with full path to the new project directory\n             * Read and relay setup/startup instructions\n             * Suggest next steps for development\n\n       - When asked to create a new project without specific tech stack:\n         * Use the add_workspace tool with gitRepoUrl: https://github.com/HigherLevelDev/fullstack-starter\n         * Create the new workspace as a subfolder of the current workspace unless an absolute path is specified\n         * Follow any specific requirements provided by the user\n         * After creating the workspace:\n           - Read and relay the README.md file contents to provide setup/startup instructions\n           - Suggest using the architect-agent or se-agent to implement requested features in the new workspace\n           - Provide clear next steps for the user to get started with their project\n\n    Additional Workspace-Specific Hints:\n    ${e.repositoryHints()?`${e.repositoryHints()}`:""}\n\n    IMPORTANT REMINDERS:\n    1. After creating a new project, add a README.md and call the add_workspace tool with the full path to add and let the user know it should appear in the list of workspaces\n    2. Always use 'git add -A' rather than adding individual files\n    3. Confirm destructive operations with the user before proceeding\n    4. Stay within the workspace boundaries\n    5. Use tools according to their documented purposes and limitations\n    6. ALWAYS include automatic confirmation flags (--yes, -y, --force, etc.) when running interactive commands\n    7. Add appropriate silent/quiet flags to prevent unnecessary output when available`}};t.OpsAgentService=y,t.OpsAgentService=y=i([(0,d.Injectable)(),l(0,(0,d.Inject)((0,d.forwardRef)((()=>g.GraphAgentCollaborator)))),c("design:paramtypes",[g.GraphAgentCollaborator,m.ToolFactoryService,p.AgentRuleService])],y)},64318:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ValidatorProvider=void 0;const a=r(3563),c=r(81125),l=r(34835),d=r(42992),u=r(26282),p=r(42929),f=r(81445),h=r(30873),m=i(r(19055));let g=o=class{constructor(e,t){this.validatorRegistry=e,this.treeSitterService=t}async onModuleInit(){await this.registerDefaultValidators()}async registerDefaultValidators(){const e=new l.TreeSitterValidator(this.treeSitterService);this.validatorRegistry.registerValidator(e),m.default.info(`[${o.name}] Registered TreeSitter validator with priority ${e.getPriority()}`),this.registerTypeScriptValidator(),this.registerESLintValidator(),this.registerPythonValidator(),this.registerJavaKotlinValidator()}registerTypeScriptValidator(){try{const e=new d.TypeScriptValidator;this.validatorRegistry.registerValidator(e),m.default.info(`[${o.name}] Registered TypeScript validator with priority ${e.getPriority()}`)}catch(e){m.default.warn(`[${o.name}] Failed to register TypeScript validator: ${e.message}`)}}registerESLintValidator(){try{const e=new u.ESLintValidator;this.validatorRegistry.registerValidator(e),m.default.info(`[${o.name}] Registered ESLint validator with priority ${e.getPriority()}`)}catch(e){m.default.warn(`[${o.name}] Failed to register ESLint validator: ${e.message}`)}}registerPythonValidator(){try{const e=new p.PylintValidator;this.validatorRegistry.registerValidator(e),m.default.info(`[${o.name}] Registered Pylint validator with priority ${e.getPriority()}`)}catch(e){m.default.warn(`[${o.name}] Failed to register Pylint validator: ${e.message}`)}}registerJavaKotlinValidator(){try{const e=new f.JavaKotlinValidator;this.validatorRegistry.registerValidator(e),m.default.info(`[${o.name}] Registered Java/Kotlin validator with priority ${e.getPriority()}`)}catch(e){m.default.warn(`[${o.name}] Failed to register Java/Kotlin validator: ${e.message}`)}}registerCustomValidator(e){this.validatorRegistry.registerValidator(e),m.default.info(`[${o.name}] Registered custom validator: ${e.getName()} with priority ${e.getPriority()}`)}};t.ValidatorProvider=g,t.ValidatorProvider=g=o=n([(0,a.Injectable)(),s("design:paramtypes",[c.ValidatorRegistryService,h.TreeSitterService])],g)},65018:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MCPTest=void 0;const n=r(83153),s=r(11569),i=r(35317),a=o(r(19055)),c=o(r(16928));class l extends n.Tool{constructor(e){super(),this.name="mcp_test",this.description="Test a command with the Model Context Protocol (MCP) lifecycle. This tool will return the MCP server capabilities JSON, available tools list, and tool invocation results",this.schema=s.z.object({command:s.z.string().describe("The command to execute to start the MCP server"),envVars:s.z.record(s.z.string()).optional().describe("Optional environment variables to set"),workingDir:s.z.string().optional().describe("Optional working directory relative to the workspace root")}),this.timeout=1e4,this.workspaceRootDir=e,this.maxOutputChars=parseInt(process.env.MAX_TOOL_OUTPUT_CHARS||"20000")}clipString(e){return e.length>this.maxOutputChars?e.slice(0,this.maxOutputChars/2)+"\n... [output truncated] ...\n"+e.slice(-this.maxOutputChars/2):e}async _call({command:e,envVars:t,workingDir:r}){try{const o=r?c.default.join(this.workspaceRootDir,r):this.workspaceRootDir;a.default.info(`Executing MCP test command: ${e} in directory: ${o}`);const n=e.split(" "),s=n[0],l=n.slice(1),d={...process.env,...t||{}};return new Promise(((t,r)=>{const n=(0,i.spawn)(s,l,{cwd:o,env:d});let c="",u="",p=!1,f="";const h=setTimeout((()=>{n.kill("SIGTERM");const e=`MCP test timed out after ${this.timeout}ms`;a.default.warn(e),r(e)}),this.timeout);n.stdout.on("data",(e=>{const t=e.toString();c+=t,a.default.debug(`MCP stdout: ${t}`);try{const e=t.split("\n").filter((e=>e.trim()));for(const t of e){const e=JSON.parse(t);2===e.id&&e.result&&e.result.tools&&(f=JSON.stringify(e.result,null,2))}}catch(e){}})),n.stderr.on("data",(e=>{const t=e.toString();u+=t,a.default.debug(`MCP stderr: ${t}`)})),n.on("close",(r=>{clearTimeout(h);const n=`MCP test ${0===r?"completed successfully":"exited with code "+r}.\nCommand: ${e}\nWorking directory: ${o}\n==== TOOLS RESPONSE ====\n${f||"No tools response received"}\n==== STDOUT ====\n${this.clipString(c)}\n==== STDERR ====\n${this.clipString(u)}`;t(n)})),n.on("error",(e=>{clearTimeout(h),a.default.error(`MCP test error: ${e.message}`),r(`Error executing MCP test: ${e.message}`)}));const m={jsonrpc:"2.0",id:1,method:"initialize",params:{protocolVersion:"2024-11-05",capabilities:{roots:{listChanged:!0},sampling:{},tools:{listChanged:!0}},clientInfo:{name:"EveMCPTestClient",version:"1.0.0"}}};a.default.debug(`Sending MCP initialize message: ${JSON.stringify(m)}`),n.stdin.write(JSON.stringify(m)+"\n"),setTimeout((()=>{const e={jsonrpc:"2.0",method:"notifications/initialized"};a.default.debug(`Sending MCP initialized notification: ${JSON.stringify(e)}`),n.stdin.write(JSON.stringify(e)+"\n"),p=!0,setTimeout((()=>{const e={jsonrpc:"2.0",id:2,method:"tools/list",params:{}};a.default.debug(`Sending MCP tools/list request: ${JSON.stringify(e)}`),n.stdin.write(JSON.stringify(e)+"\n"),setTimeout((()=>{a.default.debug("Closing MCP stdin to initiate shutdown"),n.stdin.end()}),1e3)}),500)}),500)}))}catch(t){return a.default.warn(`Error executing MCP test: ${e}`,t),`Error executing MCP test:\nCommand: ${e}\nError: ${t.message}`}}}t.MCPTest=l},65306:e=>{"use strict";e.exports=require("serpapi")},65591:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MCPAgentService=void 0;const u=r(3563),p=r(86158),f=r(93470),h=d(r(19055)),m=r(22300),g=r(55277),y=r(29234),v=r(52368),_=r(76910),w=a(r(16928)),b=a(r(79896));let k=class extends g.GraphAgentService{constructor(e,t,r,o){super(e,t,r),this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r,this.configService=o}async verifyRequest(e,t){this.mcpDirectory||(this.mcpDirectory=this.initMcpDir()),t.setToolBaseDir(this.mcpDirectory)}initMcpDir(){let e=this.configService.getProperty(_.ConfigPropNames.MCP_SERVERS_DIRECTORY,"~/.hldk/mcp-servers");return e.startsWith("~")&&(e=w.join(process.env.HOME||"",e.substring(1))),this.ensureMcpDirectoryExists(e),e}ensureMcpDirectoryExists(e){try{if(!b.existsSync(e)){b.mkdirSync(e,{recursive:!0}),h.default.info(`Created MCP directory at ${e}`);const t=w.join(e,"mcp-servers.json");b.existsSync(t)||(b.writeFileSync(t,JSON.stringify({mcpServers:{}},null,2)),h.default.info(`Created empty mcp-servers.json file at ${t}`))}}catch(e){h.default.error("Failed to create MCP directory:",e)}}getName(){return"mcp-agent"}async getTools(e){return await this.toolFactoryService.createTools(["list_files","read_file","update_file","delete_file","command_line","mcp_test","fetch_web_page","git_commit","current_timestamp","grep","find_files","serp_api","read_workspace_tree"],e)}async getSystemPrompt(e){this.mcpDirectory||(this.mcpDirectory=this.initMcpDir());const t=(await this.ruleService.getRulesByAgentName(this.getName())).content||"",r=`You are an Expert Software Engineer MCP Server Manager. Your primary purpose is to help users manage their set of Model Context Protocol (MCP) servers in the MCP directory with the precision and attention to detail of a senior software engineer.\n\nIMPORTANT: Always start by reading the mcp-servers.json file to see which servers are currently enabled. All file operations are relative to the MCP directory, so you can simply use "mcp-servers.json" as the file path.\n\nHere is the MCP directory structure:\n${new y.RequestContext({...e.workspace,repoBaseDir:this.mcpDirectory},e.requestId,e.sessionId).repositoryTree()}\n\nThe mcp-servers.json file format:\n{\n  "mcpServers": {\n    "server-name-1": {\n      "command": "/usr/local/bin/npx",\n      "args": ["-y", "package-name"],\n      "env": { "API_KEY": "your-api-key" },\n      "cwd": "/optional/working/directory",\n      "disabled": false\n    },\n    "server-name-2": {\n      "command": "/usr/bin/python",\n      "args": ["-m", "server_module"],\n      "disabled": true\n    }\n  }\n}\n\nIMPORTANT: Always use the full path to executables in the "command" field (e.g., "/usr/local/bin/node" instead of "node", "/usr/bin/python" instead of "python"). Do not assume the executable will be available on the PATH when the server starts. If you're not sure about the location of an executable, use the command_line tool to look it up:\n- On Unix/Mac: command_line({ command: "which node" }) or command_line({ command: "which python" })\n- On Windows: command_line({ command: "where node" }) or command_line({ command: "where python" })\nAlways verify the executable exists at the path before using it in the configuration.\n\nTo disable a server, set the "disabled" property to true in the server's configuration in mcp-servers.json.\nTo enable a server, set "disabled" to false or remove the "disabled" property.\n\nWhat you can do:\n1. List and examine current MCP servers in the mcp-servers.json file\n2. Enable or disable existing MCP servers\n3. Search for MCP servers using SerpApi when users request to install a specific server\n4. Present options for MCP servers based on search results\n5. Help install MCP servers by following these steps:\n   - Clone the git repository to the MCP directory, preserving the original repository name\n   - Configure any necessary environment variables directly in the "env" property in mcp-servers.json\n   - Install dependencies (using pnpm install, pip install, etc.)\n   - Update the mcp-servers.json configuration file\n   - Use the mcp_test tool to verify the server installation and configuration\n   - Inform the user they can ask to "list available tools" to check if the server is working properly\n\n6. Help build new MCP servers when needed or requested\n\nFollow these guidelines when helping users:\n1. When a user asks to install an MCP server:\n   a. First, always use serp_api to search for "MCP server for [what they asked]" or "Model Context Protocol server for [what they asked]"\n   b. Analyze the search results to find GitHub repositories that implement MCP servers\n   c. Present the options to the user with brief descriptions\n   d. Confirm which option they want to install\n   e. If no appropriate server exists, offer to build a new server for them\n\n2. When installing the selected server:\n   a. Clone the repository using git (via command_line), keeping the original repository name unless specifically requested otherwise\n   b. ALWAYS CHECK if required command line tools are installed before proceeding:\n      - Before running any command that requires a specific tool (like git, node, python, etc.), verify if it's available\n      - If a required tool is missing, STOP and explicitly ask the user for permission to install it\n      - Only proceed with installation after receiving explicit user permission\n   c. For repositories containing multiple servers:\n      - Carefully examine the repository structure to identify the specific server the user wants\n      - Focus on one server at a time and only follow the README for that specific server\n      - When using the command_line tool, ALWAYS use the appropriate subDir parameter to ensure you're operating in the correct directory\n      - Example: command_line({ command: "pnpm install", subDir: "path/to/specific/server" })\n   d. Check for installation instructions in README.md or similar files for the SPECIFIC server being installed\n   e. Guide the user through any API key or credential setup\n   f. Follow the installation steps (ALWAYS using pnpm instead of npm)\n   g. When configuring the server in mcp-servers.json, always use the full path to executables in the "command" field (e.g., "/usr/local/bin/node" instead of "node"). You can use the command_line tool with "which [command]" to find the full path on Unix/Mac systems or "where [command]" on Windows systems. Always verify the executable exists before adding it to the configuration. For example:\n      - command_line({ command: "which node" }) // On Unix/Mac\n      - command_line({ command: "where node" }) // On Windows\n   \n   IMPORTANT: Do not forget to run the install command to install the relevant packages (e.g., pnpm install, pip install -r requirements.txt). Failing to install dependencies is a common cause of server startup failures.\n   \n   h. Properly set the "cwd" field in mcp-servers.json to the specific subdirectory where the server is located\n   i. Add any required environment variables to the "env" property in the server's configuration in mcp-servers.json\n   j. Update the mcp-servers.json file with the complete server configuration\n   k. Test the server installation using the mcp_test tool:\n      - Extract the command, args, env, and cwd from the mcp-servers.json configuration\n      - Construct a proper command string from command and args\n      - Use mcp_test({ command: "full command string", envVars: serverConfig.env, workingDir: serverConfig.cwd })\n      - Analyze the output to verify the server returns proper MCP protocol responses\n      - IMPORTANT: DO NOT TRY TO RUN THE COMMAND YOURSELF USING THE COMMAND LINE TOOL OTHERWISE YOU WILL HANG!! Use the test tool. \n   l. Inform the user they can ask to "list available tools" to verify if the server is properly configured\n\n3. To maintain security:\n   a. Always store sensitive information like API keys in the "env" property of the server configuration in mcp-servers.json\n   b. Ensure users understand that the mcp-servers.json file contains sensitive information and should not be shared\n   c. Never commit sensitive information to git\n   d. Explain that the "env" property in mcp-servers.json is used to provide environment variables to the server process\n\n4. Directory management best practices:\n   a. ALWAYS use the subDir parameter with the command_line tool to specify the correct working directory\n   b. When a repository contains multiple servers, carefully identify the correct subdirectory for each server\n   c. Update the "cwd" field in mcp-servers.json to point to the specific subdirectory for each server\n   d. When reading documentation or files, make sure you're looking at the files for the specific server being installed\n   e. Keep track of the current directory context when helping the user\n\n5. When building a new MCP server (if no existing server meets the requirements or if specifically requested):\n   a. First, fetch the MCP server development guide from: https://raw.githubusercontent.com/cyanheads/model-context-protocol-resources/refs/heads/main/guides/mcp-server-development-guide.md\n   b. Read the guide for best practices and implementation details\n   c. Create a new directory in the MCP directory with a descriptive name\n   d. Set up a new Node.js project using TypeScript (recommended for MCP servers)\n   e. Install the MCP SDK: pnpm add @modelcontextprotocol/sdk\n   f. Create the basic server structure according to the guide\n   g. Implement the required tools following the MCP specifications\n   h. Set up proper TypeScript configuration and build scripts\n   i. Create a README.md with clear documentation\n   j. Test the server thoroughly\n   k. Update the mcp-servers.json configuration file to include the new server with appropriate "env" configuration\n\n6. For MCP server implementation details, follow the best practices from the development guide and:\n   a. Use the MCP SDK's registerTool method to register tools\n   b. Properly define input schemas for tools using JSON Schema\n   c. Implement clear error handling with appropriate error messages\n   d. Use async/await for asynchronous operations\n   e. Provide detailed descriptions for all tools\n   f. Follow security best practices for handling credentials\n   g. Access environment variables using process.env which will be populated from the "env" property in mcp-servers.json\n   h. Implement proper logging\n\nThe MCP directory is located at: ${this.mcpDirectory}\n\nIMPORTANT: Since all file operations are already set to work relative to the MCP directory, you don't need to specify the full path when reading, writing, or updating files. For example, use "mcp-servers.json" instead of the full path.\n\nUsing the mcp_test tool:\nThe mcp_test tool allows you to test an MCP server by running through the full Model Context Protocol lifecycle. This is an excellent way to verify that a server is properly installed and configured before letting the user know it's ready to use.\n\nHow to use the mcp_test tool:\n1. Extract the server configuration from mcp-servers.json\n2. Construct the full command string by combining the command with its args\n3. Call the tool with the command, environment variables, and working directory:\n   mcp_test({ \n     command: "full command string", \n     envVars: serverConfig.env, \n     workingDir: serverConfig.cwd \n   })\n4. Analyze the response to check for:\n   - Successful initialization\n   - Server capabilities in the response\n   - No errors or timeout messages\n\nExample:\n\nFor a server configured as:\n{\n  "command": "/usr/local/bin/node",\n  "args": ["server.js"],\n  "env": { "API_KEY": "abc123" },\n  "cwd": "some-server/src"\n}\n\nUse the mcp_test tool with:\nmcp_test({ \n  command: "/usr/local/bin/node server.js", \n  envVars: { "API_KEY": "abc123" }, \n  workingDir: "some-server/src" \n})\n\nThe tool will establish a connection with the server using the MCP protocol, exchange capabilities information, and then gracefully close the connection. This verifies that the server is properly implementing the MCP specification.\n\n${t?`Additional custom rules:\n${t}\n`:""}\n\nGet started by reading the mcp-servers.json file to understand the current MCP server configurations, then help the user with their MCP server management request as an expert software engineer.\n`;return h.default.debug(`MCP Agent system prompt for workspace '${e.workspace.name}' (length: ${r.length} chars)`),r}};t.MCPAgentService=k,t.MCPAgentService=k=i([(0,u.Injectable)(),l(0,(0,u.Inject)((0,u.forwardRef)((()=>m.GraphAgentCollaborator)))),c("design:paramtypes",[m.GraphAgentCollaborator,p.ToolFactoryService,f.AgentRuleService,v.ConfigService])],k)},66002:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=66002,e.exports=t},66375:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.McpController=void 0;const a=r(3563),c=r(2115),l=r(16406),d=r(19668),u=i(r(19055));let p=class{constructor(e,t,r){this.mcpHubService=e,this.mcpConfigService=t,this.userService=r}async getServers(){try{const e=(await this.userService.getCurrentUser()).userId;await this.mcpHubService.initializeUserServers(e);const t=this.mcpHubService.getAllUserServers(e);return u.default.info(`[McpController] Retrieved ${t.length} MCP servers for user: ${e}`),t}catch(e){throw u.default.error("[McpController] Error getting MCP servers:",e),new a.HttpException(`Failed to get MCP servers: ${e.message}`,a.HttpStatus.INTERNAL_SERVER_ERROR)}}async addServer(e){try{const t=(await this.userService.getCurrentUser()).userId,{name:r,...o}=e;await this.mcpConfigService.addServer(t,r,o);const n=await this.mcpConfigService.getUserSettings(t);return await this.mcpHubService.updateServerConnections(t,n.mcpServers),u.default.info(`[McpController] Added MCP server: ${r} for user: ${t}`),{message:`Server '${r}' added successfully`}}catch(e){throw u.default.error("[McpController] Error adding MCP server:",e),new a.HttpException(`Failed to add server: ${e.message}`,a.HttpStatus.BAD_REQUEST)}}async updateServer(e,t){try{const r=(await this.userService.getCurrentUser()).userId;await this.mcpConfigService.updateServerConfig(r,e,t);const o=await this.mcpConfigService.getUserSettings(r);return await this.mcpHubService.updateServerConnections(r,o.mcpServers),u.default.info(`[McpController] Updated MCP server: ${e} for user: ${r}`),{message:`Server '${e}' updated successfully`}}catch(t){throw u.default.error(`[McpController] Error updating MCP server ${e}:`,t),new a.HttpException(`Failed to update server: ${t.message}`,a.HttpStatus.BAD_REQUEST)}}async removeServer(e){try{const t=(await this.userService.getCurrentUser()).userId;await this.mcpConfigService.removeServer(t,e);const r=await this.mcpConfigService.getUserSettings(t);return await this.mcpHubService.updateServerConnections(t,r.mcpServers),u.default.info(`[McpController] Removed MCP server: ${e} for user: ${t}`),{message:`Server '${e}' removed successfully`}}catch(t){throw u.default.error(`[McpController] Error removing MCP server ${e}:`,t),new a.HttpException(`Failed to remove server: ${t.message}`,a.HttpStatus.BAD_REQUEST)}}async restartServer(e){try{const t=(await this.userService.getCurrentUser()).userId;return await this.mcpHubService.restartServer(t,e),u.default.info(`[McpController] Restarted MCP server: ${e} for user: ${t}`),{message:`Server '${e}' restarted successfully`}}catch(t){throw u.default.error(`[McpController] Error restarting MCP server ${e}:`,t),new a.HttpException(`Failed to restart server: ${t.message}`,a.HttpStatus.INTERNAL_SERVER_ERROR)}}async getConfiguration(){try{const e=(await this.userService.getCurrentUser()).userId,t=await this.mcpConfigService.getUserSettings(e);return u.default.info(`[McpController] Retrieved MCP configuration for user: ${e}`),t}catch(e){throw u.default.error("[McpController] Error getting MCP configuration:",e),new a.HttpException(`Failed to get configuration: ${e.message}`,a.HttpStatus.INTERNAL_SERVER_ERROR)}}async updateConfiguration(e){try{const t=(await this.userService.getCurrentUser()).userId;return await this.mcpConfigService.updateUserSettings(t,e),await this.mcpHubService.updateServerConnections(t,e.mcpServers),u.default.info(`[McpController] Updated complete MCP configuration for user: ${t}`),{message:"Configuration updated successfully"}}catch(e){throw u.default.error("[McpController] Error updating MCP configuration:",e),new a.HttpException(`Failed to update configuration: ${e.message}`,a.HttpStatus.BAD_REQUEST)}}async toggleServerEnabled(e,t){try{const r=(await this.userService.getCurrentUser()).userId;await this.mcpConfigService.toggleServerEnabled(r,e,t.enabled);const o=await this.mcpConfigService.getUserSettings(r);return await this.mcpHubService.updateServerConnections(r,o.mcpServers),u.default.info(`[McpController] Toggled MCP server ${e} to ${t.enabled?"enabled":"disabled"} for user: ${r}`),{message:`Server '${e}' ${t.enabled?"enabled":"disabled"} successfully`}}catch(t){throw u.default.error(`[McpController] Error toggling MCP server ${e}:`,t),new a.HttpException(`Failed to toggle server: ${t.message}`,a.HttpStatus.BAD_REQUEST)}}async updateAutoApproval(e,t){try{const r=(await this.userService.getCurrentUser()).userId;return await this.mcpConfigService.updateAutoApproval(r,e,t.toolNames),await this.mcpHubService.refreshAutoApprovalSettings(r,e),u.default.info(`[McpController] Updated auto-approval for MCP server ${e} for user: ${r}`),{message:`Auto-approval settings updated for server '${e}'`}}catch(t){throw u.default.error(`[McpController] Error updating auto-approval for MCP server ${e}:`,t),new a.HttpException(`Failed to update auto-approval: ${t.message}`,a.HttpStatus.BAD_REQUEST)}}async getPendingNotifications(){try{const e=(await this.userService.getCurrentUser()).userId,t=this.mcpHubService.getPendingNotifications(e);return u.default.debug(`[McpController] Retrieved ${t.length} pending notifications for user: ${e}`),t}catch(e){throw u.default.error("[McpController] Error getting pending notifications:",e),new a.HttpException(`Failed to get notifications: ${e.message}`,a.HttpStatus.INTERNAL_SERVER_ERROR)}}};t.McpController=p,o([(0,a.Get)("servers"),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],p.prototype,"getServers",null),o([(0,a.Post)("servers"),s(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],p.prototype,"addServer",null),o([(0,a.Put)("servers/:name"),s(0,(0,a.Param)("name")),s(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],p.prototype,"updateServer",null),o([(0,a.Delete)("servers/:name"),s(0,(0,a.Param)("name")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],p.prototype,"removeServer",null),o([(0,a.Post)("servers/:name/restart"),s(0,(0,a.Param)("name")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],p.prototype,"restartServer",null),o([(0,a.Get)("configuration"),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],p.prototype,"getConfiguration",null),o([(0,a.Put)("configuration"),s(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],p.prototype,"updateConfiguration",null),o([(0,a.Put)("servers/:name/toggle"),s(0,(0,a.Param)("name")),s(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],p.prototype,"toggleServerEnabled",null),o([(0,a.Put)("servers/:name/auto-approve"),s(0,(0,a.Param)("name")),s(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],p.prototype,"updateAutoApproval",null),o([(0,a.Get)("notifications"),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],p.prototype,"getPendingNotifications",null),t.McpController=p=o([(0,a.Controller)("api/mcp"),n("design:paramtypes",[c.McpHubService,l.McpConfigService,d.UserService])],p)},66595:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TaskEventHandler=void 0;const a=r(3563),c=i(r(19055)),l=r(96297),d=r(50461),u=r(56550),p=r(66963),f=r(91280),h=r(35444);let m=o=class{constructor(e,t,r){this.taskService=e,this.agentLoopOrchestrator=t,this.eventEmitter=r}async handleCreateTask(e,t){c.default.info(`[${o.name}] Processing createTask message from client: ${t.id}`);try{const r=await this.taskService.createTask(e);t.join(r),c.default.info(`[${o.name}] Client ${t.id} joined room ${r}`),this.eventEmitter.emit(f.InternalEvents.TASK_CREATED,{clientId:t.id,taskId:r,status:h.TaskStatus.WAITING_FOR_INPUT,data:{taskId:r}})}catch(e){c.default.error(`[${o.name}] Error creating task: ${e.message}\n${e.stack}`),this.eventEmitter.emit(f.InternalEvents.TOOL_ERROR,{clientId:t.id,taskId:"unknown",error:e.message,type:"task_error",context:{source:"createTask"}})}}async handleCreateTaskStep(e,t){c.default.info(`[${o.name}] Processing createTaskStep message from client: ${t.id}`);try{const t=await this.taskService.createTaskStep(e);c.default.info(`[${o.name}] Created task step ${t} for task ${e.taskId}. Task status remains unchanged.`)}catch(r){c.default.error(`[${o.name}] Error creating task step: ${r.message}\n${r.stack}`),this.eventEmitter.emit(f.InternalEvents.TOOL_ERROR,{clientId:t.id,taskId:e.taskId,error:r.message,type:"task_error",context:{source:"createTaskStep"}})}}async handleUpdateTaskStep(e,t){c.default.info(`[${o.name}] Processing updateTaskStep message from client: ${t.id}`);try{await this.taskService.updateTaskStep(e),c.default.info(`[${o.name}] Updated task step ${e.stepNumber} for task ${e.taskId}. Task status remains unchanged.`)}catch(r){c.default.error(`[${o.name}] Error updating task step: ${r.message}\n${r.stack}`),this.eventEmitter.emit(f.InternalEvents.TOOL_ERROR,{clientId:t.id,taskId:e.taskId,error:r.message,type:"task_error",context:{source:"updateTaskStep"}})}}async handleUpdateTask(e,t){c.default.warn(`[${o.name}] handleUpdateTask called directly. This might be deprecated. Task status should be managed by AgentLoopOrchestrator.`),c.default.info(`[${o.name}] Processing updateTask message from client: ${t.id}`);try{await this.taskService.updateTask(e),this.eventEmitter.emit(f.InternalEvents.TASK_UPDATED,{clientId:t.id,taskId:e.taskId,status:e.status,data:{result:e.result}})}catch(r){c.default.error(`[${o.name}] Error updating task: ${r.message}\n${r.stack}`),this.eventEmitter.emit(f.InternalEvents.TOOL_ERROR,{clientId:t.id,taskId:e.taskId,error:r.message,type:"task_error",context:{source:"updateTask"}})}}async handleCancelTask(e,t){c.default.info(`[${o.name}] Processing cancelTask message for task ${e.taskId} from client ${t.id}`),c.default.info(`[${o.name}] Cancellation reason: ${e.reason||"No reason provided"}`),l.debugLogger.log(`Received cancelTask for task ${e.taskId} from client ${t.id}`),l.debugLogger.dumpObject("CancelTask payload",e),l.debugLogger.log(`Setting task ${e.taskId} to aborting state`);const r=this.agentLoopOrchestrator.setTaskAborting(e.taskId,!0);r?l.debugLogger.log(`AbortSignal created for task ${e.taskId}, aborted state: ${r.aborted}`):l.debugLogger.log(`No AbortSignal returned for task ${e.taskId}`),l.debugLogger.log(`Using block-based tool call handling for task ${e.taskId}`);try{l.debugLogger.log(`[TaskService] Updating task ${e.taskId} with status USER_CANCELLED due to cancellation`),l.debugLogger.dumpObject("UpdateTask options",{taskId:e.taskId,status:h.TaskStatus.USER_CANCELLED,result:JSON.stringify({details:e.reason||"Task cancelled by user"})}),await this.taskService.updateTask({taskId:e.taskId,status:h.TaskStatus.USER_CANCELLED,result:JSON.stringify({details:e.reason||"Task cancelled by user"})}),l.debugLogger.log(`[TaskService] Emitted agent.task.updated event for task ${e.taskId} with status USER_CANCELLED`),l.debugLogger.log(`Sending ${f.NotificationEvents.TASK_STATUS_UPDATED} event to room ${e.taskId}`),l.debugLogger.dumpObject("TaskStatusUpdated payload",{clientId:t.id,taskId:e.taskId,status:h.TaskStatus.USER_CANCELLED,data:{reason:e.reason||"Task cancelled by user"}}),this.eventEmitter.emit(f.InternalEvents.TASK_UPDATED,{clientId:t.id,taskId:e.taskId,status:h.TaskStatus.USER_CANCELLED,data:{reason:e.reason||"Task cancelled by user"}}),c.default.info(`[${o.name}] Task ${e.taskId} cancelled successfully`),l.debugLogger.log(`Task ${e.taskId} cancelled successfully`)}catch(r){l.debugLogger.log(`Error updating task status for cancelled task ${e.taskId}: ${r.message}`),c.default.error(`[${o.name}] Error updating task status for cancelled task ${e.taskId}: ${r.message}\n${r.stack}`),this.eventEmitter.emit(f.InternalEvents.TASK_UPDATED,{clientId:t.id,taskId:e.taskId,status:h.TaskStatus.USER_CANCELLED,data:{reason:"Task cancelled, but failed to update task status in DB"}}),this.eventEmitter.emit(f.InternalEvents.TOOL_ERROR,{clientId:t.id,taskId:e.taskId,error:r.message,type:"task_error",context:{source:"cancelTask"}})}l.debugLogger.log(`Cleaning up resources for task ${e.taskId}`),this.agentLoopOrchestrator.cleanupTask(e.taskId),l.debugLogger.log(`Resources cleaned up for task ${e.taskId}`)}};t.TaskEventHandler=m,t.TaskEventHandler=m=o=n([(0,a.Injectable)(),s("design:paramtypes",[u.TaskService,p.AgentLoopOrchestrator,d.EventEmitter2])],m)},66651:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MCPController=void 0;const u=r(3563),p=r(52368),f=r(76910),h=a(r(16928)),m=a(r(79896)),g=d(r(19055));let y=class{constructor(e){this.configService=e}getMcpDirectory(){let e=this.configService.getProperty(f.ConfigPropNames.MCP_SERVERS_DIRECTORY,"~/.eve/mcp-servers");return e.startsWith("~")&&(e=h.join(process.env.HOME||"",e.substring(1))),e}ensureMcpDirectoryExists(e){try{if(!m.existsSync(e)){m.mkdirSync(e,{recursive:!0}),g.default.info(`Created MCP directory at ${e}`);const t=h.join(e,"mcp-servers.json");m.existsSync(t)||(m.writeFileSync(t,JSON.stringify({mcpServers:{}},null,2)),g.default.info(`Created empty mcp-servers.json file at ${t}`))}}catch(e){throw g.default.error("Failed to create MCP directory:",e),new Error(`Failed to create MCP directory: ${e.message}`)}}async getMcpConfig(){try{const e=this.getMcpDirectory();this.ensureMcpDirectoryExists(e);const t=h.join(e,"mcp-servers.json"),r=m.readFileSync(t,"utf8");return JSON.parse(r)}catch(e){throw g.default.error("Failed to get MCP config:",e),new Error(`Failed to get MCP config: ${e.message}`)}}async updateMcpConfig(e){try{const t=this.getMcpDirectory();this.ensureMcpDirectoryExists(t);const r=h.join(t,"mcp-servers.json");return m.writeFileSync(r,JSON.stringify(e,null,2)),g.default.info("Updated MCP config at "+r),{success:!0}}catch(e){throw g.default.error("Failed to update MCP config:",e),new Error(`Failed to update MCP config: ${e.message}`)}}async toggleServerDisabled(e){try{const t=this.getMcpDirectory();this.ensureMcpDirectoryExists(t);const r=h.join(t,"mcp-servers.json"),o=m.readFileSync(r,"utf8"),n=JSON.parse(o);if(!n.mcpServers||!n.mcpServers[e])throw new Error(`Server '${e}' not found`);return n.mcpServers[e].disabled=!n.mcpServers[e].disabled,m.writeFileSync(r,JSON.stringify(n,null,2)),g.default.info(`Toggled disabled state for MCP server '${e}' to ${n.mcpServers[e].disabled}`),{success:!0,serverName:e,disabled:n.mcpServers[e].disabled}}catch(t){throw g.default.error(`Failed to toggle disabled state for MCP server '${e}':`,t),new Error(`Failed to toggle disabled state: ${t.message}`)}}};t.MCPController=y,i([(0,u.Get)("config"),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],y.prototype,"getMcpConfig",null),i([(0,u.Put)("config"),l(0,(0,u.Body)()),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],y.prototype,"updateMcpConfig",null),i([(0,u.Post)("servers/:serverName/toggle-disabled"),l(0,(0,u.Param)("serverName")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],y.prototype,"toggleServerDisabled",null),t.MCPController=y=i([(0,u.Controller)("mcp"),c("design:paramtypes",[p.ConfigService])],y)},66963:function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.LlmStreamProcessorBlock=void 0,n(r(67485),t),n(r(57438),t),n(r(16387),t);const s=r(26897);Object.defineProperty(t,"LlmStreamProcessorBlock",{enumerable:!0,get:function(){return s.LlmStreamProcessorBlock}})},67182:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.XaiProvider=void 0;const i=r(3563),a=r(36206),c=r(78706),l=r(91386),d=r(9106),u=r(45733),p=s(r(19055));let f=class{constructor(e){this.providerRegistry=e,this.config={providerId:d.XAI_PROVIDER_ID,name:"X.AI Grok",description:"X.AI Grok models with advanced reasoning capabilities",website:"https://x.ai",docsLink:"https://docs.x.ai",baseUrl:d.XAI_BASE_URL,apiKeyName:d.XAI_API_KEY_NAME,defaultModelId:(0,u.getDefaultXaiModelId)(),modelDiscovery:"static",staticModels:(0,u.getXaiStaticModels)(),features:{supportsStreaming:!0,supportsCaching:!0,supportsTools:!0,supportsImages:!0}},p.default.info(`[XaiProvider] Initialized with ${this.config.staticModels?.length} static models`),this.providerRegistry.registerProvider(this)}getId(){return this.config.providerId}getName(){return this.config.name}getMetadata(){return{website:this.config.website,docs_link:this.config.docsLink,api_version:"v1",default_base_url:this.config.baseUrl,supports_reasoning:!0,supports_vision:!0}}requiresApiKey(){return!0}getDefaultBaseUrl(){return this.config.baseUrl}getDefaultModelId(){return this.config.defaultModelId}getApiKeyName(){return this.config.apiKeyName}getModelClient(e){const t={...e,baseUrl:e.baseUrl||this.config.baseUrl},r={enableVerboseLogging:!1,maxOutputTokens:this.getModelMaxOutputTokens(e.modelId)},o=new c.OpenAIModelClient(t,r),n=this.getStaticModels().find((t=>t.modelId===e.modelId));return n?o.setModelMetadata(n):p.default.warn(`[XaiProvider] Metadata not found for model ${e.modelId}`),this.enhanceClientForGrok(o,e.modelId),o}enhanceClientForGrok(e,t){const r=(0,u.getXaiModelCapabilities)(t);r&&r.supportsReasoningEffort&&p.default.debug(`[XaiProvider] Model ${t} supports reasoning effort`)}getModelMaxOutputTokens(e){const t=this.getStaticModels().find((t=>t.modelId===e));return t?.maxOutputTokens||8192}getProviderMetadata(){return l.OpenAICompatibleUtils.createProviderMetadata(this.config)}getStaticModels(){return this.config.staticModels||[]}async discoverDynamicModels(e,t,r){return{models:[],discoveredAt:new Date,discoveryMethod:"static",source:"static-configuration"}}requiresApiKeyForDiscovery(){return!1}async discoverModels(e,t,r){return this.getStaticModels()}};t.XaiProvider=f,t.XaiProvider=f=o([(0,i.Injectable)(),n("design:paramtypes",[a.ProviderRegistry])],f)},67249:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StandardAgentStateManager=void 0;const o=r(19314),n=r(28804);t.StandardAgentStateManager=class{static createGraphState(){return{messages:{reducer:(e,t)=>e.concat(t)}}}static shouldContinue(e){const t=e.messages,r=t[t.length-1];return r.tool_calls?.length?"tools":"__end__"}static createWorkflow(e,t){const r=this.createGraphState(),s=new n.ToolNode(t);return new o.StateGraph({channels:r}).addNode("agent",(async t=>await e(t))).addNode("tools",s).addEdge("__start__","agent").addConditionalEdges("agent",this.shouldContinue).addEdge("tools","agent")}}},67485:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentStateManager=void 0;const a=r(3563),c=i(r(19055)),l=r(96297),d=r(61302);let u=o=class{constructor(){this.isAborting=new Map,this.abortControllers=new Map,this.consecutiveMistakeCount=new Map,this.consecutiveToolFailures=new Map,this.truncationStrategies=new Map}setTaskAborting(e,t){if(t){this.isAborting.set(e,!0),this.abortControllers.has(e)||this.abortControllers.set(e,new AbortController);const t=this.abortControllers.get(e);return t.signal.aborted?(c.default.info(`[${o.name}] Task ${e} already aborted`),l.debugLogger.log(`Task ${e} already aborted, signal state: ${t.signal.aborted}`)):(t.abort(),c.default.info(`[${o.name}] Task ${e} marked for abortion and AbortController aborted`),l.debugLogger.log(`AbortSignal created for task ${e}, aborted state: ${t.signal.aborted}`)),t.signal}return this.isAborting.delete(e),this.abortControllers.set(e,new AbortController),void c.default.info(`[${o.name}] Abortion flag removed for task ${e} and new AbortController created`)}isTaskAborting(e){return this.isAborting.get(e)||!1}getAbortSignal(e){const t=this.abortControllers.get(e);return t?.signal}getOrCreateAbortSignal(e){return this.abortControllers.has(e)||this.abortControllers.set(e,new AbortController),this.abortControllers.get(e).signal}setupStreamAbortHandling(e,t,r){const n=this.getAbortSignal(t);if(n)(0,d.setupAbortHandling)(e,r,n);else{c.default.info(`[${o.name}] No abort signal for task ${t}, creating one`);const n=this.getOrCreateAbortSignal(t);(0,d.setupAbortHandling)(e,r,n)}}getMistakeCount(e){return this.consecutiveMistakeCount.get(e)||0}setMistakeCount(e,t){this.consecutiveMistakeCount.set(e,t)}incrementMistakeCount(e){const t=this.getMistakeCount(e)+1;return this.setMistakeCount(e,t),t}resetMistakeCount(e){this.setMistakeCount(e,0)}getToolFailureCount(e,t){return(this.consecutiveToolFailures.get(e)||{})[t]||0}setToolFailureCount(e,t,r){const o=this.consecutiveToolFailures.get(e)||{};o[t]=r,this.consecutiveToolFailures.set(e,o)}incrementToolFailureCount(e,t){const r=this.getToolFailureCount(e,t)+1;return this.setToolFailureCount(e,t,r),r}resetToolFailureCount(e,t){this.setToolFailureCount(e,t,0)}getTruncationStrategy(e){return this.truncationStrategies.get(e)}setTruncationStrategy(e,t){this.truncationStrategies.set(e,t)}cleanupTask(e){this.isAborting.delete(e),this.consecutiveMistakeCount.delete(e),this.consecutiveToolFailures.delete(e),this.truncationStrategies.delete(e),this.abortControllers.delete(e),c.default.info(`[${o.name}] Cleaned up state for task ${e}`)}};t.AgentStateManager=u,t.AgentStateManager=u=o=n([(0,a.Injectable)(),s("design:paramtypes",[])],u)},67660:e=>{"use strict";e.exports=require("tree-sitter-javascript")},67890:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createStreamProcessor=function(e,t){s.default.debug("[AnthropicStreamProcessor] Creating stream processor"),i.debugLogger.enable(),i.debugLogger.log("[AnthropicStreamProcessor] Creating stream processor with debug logging enabled");const r=(0,c.createBlockManager)(e),o=async function*(o){if(s.default.debug(`[AnthropicStreamProcessor] Processing text chunk: "${o.length>20?o.substring(0,20)+"...":o}"`),i.debugLogger.log(`Processing text chunk: "${o}"`),e.addTextContent(o),e.isBufferingContent()){s.default.debug(`[AnthropicStreamProcessor] Adding to existing buffer: "${o.length>20?o.substring(0,20)+"...":o}"`),e.addToBuffer(o);const r=e.getAndClearBuffer();return t.mightContainPartialTag(r)?(s.default.debug("[AnthropicStreamProcessor] Combined content still has partial tag, continuing to buffer"),e.startBuffering(),void e.addToBuffer(r)):(s.default.debug(`[AnthropicStreamProcessor] Processing buffered content: "${r.length>20?r.substring(0,20)+"...":r}"`),i.debugLogger.log(`Processing buffered content: "${r}"`),void(yield*u(r)))}if(e.getTagBuffer()){const r=e.getTagBuffer()+o;return s.default.debug(`[AnthropicStreamProcessor] Processing combined tag buffer: "${r.length>20?r.substring(0,20)+"...":r}"`),i.debugLogger.log(`Processing combined tag buffer: "${r}"`),e.clearTagBuffer(),t.mightContainPartialTag(r)?(s.default.debug("[AnthropicStreamProcessor] Combined buffer still has partial tag, switching to content buffering"),e.startBuffering(),void e.addToBuffer(r)):void(yield*u(r))}if(t.mightContainPartialTag(o))return s.default.debug(`[AnthropicStreamProcessor] Starting buffer for potential partial tag: "${o.length>20?o.substring(0,20)+"...":o}"`),e.startBuffering(),void e.addToBuffer(o);const n=t.findOpeningTag(o);if(n.found&&0===n.index&&a.TOOL_CALL_TAGS.includes(n.tagName)&&!e.isInsideToolCall()){s.default.debug(`[AnthropicStreamProcessor] Found tool call tag at start of text chunk: ${n.tagName}`),i.debugLogger.log(`Found tool call tag at start of text chunk: ${n.tagName}`);const t=e.getCurrentBlock();if(t&&!t.finished){s.default.debug(`[AnthropicStreamProcessor] Finishing existing block before tool call: ${t.id}`),i.debugLogger.log(`Finishing existing block before tool call: ${t.id}`);const e=r.finishBlock();e&&(yield e)}}yield*u(o)},l=async function*(t){s.default.debug(`[AnthropicStreamProcessor] Processing thinking delta: "${t.length>20?t.substring(0,20)+"...":t}"`),i.debugLogger.log(`Processing thinking delta: "${t}"`),e.addThinkingContent(t);const o=e.getCurrentBlock();if(!o||"thinking"!==o.blockType){if(o){s.default.debug(`[AnthropicStreamProcessor] Finishing existing block before creating thinking block: ${o.id}`),i.debugLogger.log(`Finishing existing block before creating thinking block: ${o.id}, type: ${o.blockType}`);const e=r.finishBlock();e&&(yield e)}s.default.debug("[AnthropicStreamProcessor] Creating new thinking block"),i.debugLogger.log("[AnthropicStreamProcessor] Creating new thinking block");const e=r.openBlock("thinking");yield e}s.default.debug(`[AnthropicStreamProcessor] Appending thinking content to block: ${e.getCurrentBlock().id}`),i.debugLogger.log(`Appending thinking content to block: ${e.getCurrentBlock().id}`),yield{type:"blockUpdate",blockId:e.getCurrentBlock().id,appendContent:t}},d=async function*(t){return s.default.debug(`[AnthropicStreamProcessor] Processing signature delta: "${t}"`),i.debugLogger.log(`Processing signature delta: "${t}"`),e.setThinkingSignature(t),i.debugLogger.log("Set thinking signature for MessageInterchange"),[]},u=async function*(o){let n=o;for(;n;){if(e.isInsideFence()){const t=n.indexOf("```");if(-1!==t){const o=n.substring(0,t+3);s.default.debug(`[AnthropicStreamProcessor] Found end of code fence, emitting content before fence: "${o.length>20?o.substring(0,20)+"...":o}"`),yield*r.emitText(o),e.setInsideFence(!1),n=n.substring(t+3);continue}s.default.debug(`[AnthropicStreamProcessor] Still in code fence, emitting all text: "${n.length>20?n.substring(0,20)+"...":n}"`),yield*r.emitText(n),n="";continue}const o=n.indexOf("```");if(-1!==o){const t=n.substring(0,o);t&&(s.default.debug(`[AnthropicStreamProcessor] Found start of code fence, emitting content before fence: "${t.length>20?t.substring(0,20)+"...":t}"`),yield*r.emitText(t)),s.default.debug("[AnthropicStreamProcessor] Entering code fence mode"),e.setInsideFence(!0),yield*r.emitText("```"),n=n.substring(o+3);continue}const i=e.getCurrentBlock();if(i&&(a.THINKING_TAGS.includes(i.tagName)||a.TOOL_CALL_TAGS.includes(i.tagName))){const o=`</${i.tagName}>`,a=n.indexOf(o);if(-1!==a){const c=n.substring(0,a);c&&(s.default.debug(`[AnthropicStreamProcessor] Found closing tag, appending content before closing: "${c.length>20?c.substring(0,20)+"...":c}"`),yield{type:"blockUpdate",blockId:i.id,appendContent:c}),s.default.debug(`[AnthropicStreamProcessor] Appending closing tag: "${o}"`),yield{type:"blockUpdate",blockId:i.id,appendContent:o},s.default.debug(`[AnthropicStreamProcessor] Finishing block after closing tag: ${i.id}`);const l=r.finishBlock();l&&(yield l);const d=n.substring(a+o.length);d&&t.endsWithPartialTag(d)?(s.default.debug(`[AnthropicStreamProcessor] Found partial tag at end after closing tag, buffering: "${d}"`),e.setTagBuffer(d),n=""):d?(yield*u(d),n=""):n="";continue}s.default.debug(`[AnthropicStreamProcessor] No closing tag found, appending all text: "${n.length>20?n.substring(0,20)+"...":n}"`),yield{type:"blockUpdate",blockId:i.id,appendContent:n},n="";continue}const c=t.findOpeningTag(n);if(c.found){const t=c.tagName;if(e.isInsideToolCall()){const r=e.getCurrentToolCallTag();if((t!==r||!n.substring(c.index).startsWith(`</${t}>`))&&(s.default.debug(`[AnthropicStreamProcessor] Inside tool call ${r}, treating ${t} tag as content`),i&&!i.finished)){const e=n.substring(0,c.index+c.fullMatch.length);yield{type:"blockUpdate",blockId:i.id,appendContent:e},n=n.substring(c.index+c.fullMatch.length);continue}}const o=a.THINKING_TAGS.includes(t)||a.TOOL_CALL_TAGS.includes(t),l=n.substring(0,c.index);if(l&&(s.default.debug(`[AnthropicStreamProcessor] Found opening tag, emitting content before tag: "${l.length>20?l.substring(0,20)+"...":l}"`),yield*r.emitText(l)),o&&!e.isInsideToolCall()){if(i){s.default.debug(`[AnthropicStreamProcessor] Finishing existing block before opening tag: ${i.id}`);const e=r.finishBlock();e&&(yield e)}const e=n.substring(c.index+c.fullMatch.length),o=`</${t}>`,a=e.indexOf(o);if(-1!==a){const i=c.fullMatch+e.substring(0,a)+o;s.default.debug(`[AnthropicStreamProcessor] Found self-contained tag, emitting immediate block: ${t} with content: "${i.length>20?i.substring(0,20)+"...":i}"`);try{const e=r.emitImmediateBlock(t,i);yield e}catch(e){if(e.message.startsWith("STREAM_INTERRUPTED:"))return void s.default.warn("[AnthropicStreamProcessor] Stream interrupted during immediate block creation");throw e}n=e.substring(a+o.length);continue}s.default.debug(`[AnthropicStreamProcessor] Starting new block with tag: ${t}`);try{const e=r.openBlock(t,c.fullMatch);yield e}catch(e){if(e.message.startsWith("STREAM_INTERRUPTED:"))return void s.default.warn("[AnthropicStreamProcessor] Stream interrupted during block creation");throw e}n=e;continue}if(s.default.debug(`[AnthropicStreamProcessor] Found non-top-level tag: ${t}, emitting as text`),i&&!i.finished){s.default.debug(`[AnthropicStreamProcessor] Appending tag to current block: ${i.id}`);const e=n.substring(0,c.index+c.fullMatch.length);yield{type:"blockUpdate",blockId:i.id,appendContent:e},n=n.substring(c.index+c.fullMatch.length);continue}yield*r.emitText(n.substring(0,c.index+c.fullMatch.length)),n=n.substring(c.index+c.fullMatch.length)}else if(t.endsWithPartialTag(n)){const t=e.getCurrentBlock();t&&(s.default.debug(`[AnthropicStreamProcessor] Found partial tag at end, buffering with block ID: ${t.id}`),e.setBufferedBlockId(t.id)),s.default.debug(`[AnthropicStreamProcessor] Found partial tag at end, buffering: "${n}"`),e.setTagBuffer(n),n=""}else if(t.mightContainPartialTag(n)){s.default.debug(`[AnthropicStreamProcessor] Text might contain partial tag, starting content buffering: "${n}"`),e.startBuffering(),e.addToBuffer(n);const t=e.getCurrentBlock();t&&(s.default.debug(`[AnthropicStreamProcessor] Storing current block ID with buffer: ${t.id}`),e.setBufferedBlockId(t.id)),n=""}else s.default.debug(`[AnthropicStreamProcessor] No special patterns, emitting as text: "${n.length>20?n.substring(0,20)+"...":n}"`),yield*r.emitText(n),n=""}};return{processStream:async function*(t,a,c){s.default.debug(`[AnthropicStreamProcessor] Processing stream for task: ${a}`),i.debugLogger.log(`Processing stream for task: ${a}`),e.reset();let u=null;try{for await(const n of t){if(c?.aborted||e.isStreamInterrupted()){s.default.debug("[AnthropicStreamProcessor] Stream processing interrupted");break}if(i.debugLogger.log("Processing chunk:",n),("content_block_start"===n.type||"content_block_delta"===n.type)&&void 0!==n.index&&null!==u&&n.index!==u){s.default.debug(`[AnthropicStreamProcessor] Switching from block index ${u} to ${n.index}`),i.debugLogger.log(`Switching from block index ${u} to ${n.index}`);const t=e.getCurrentBlock();if(t&&!t.finished){s.default.debug(`[AnthropicStreamProcessor] Finishing block due to index change: ${t.id}`),i.debugLogger.log(`Finishing block due to index change: ${t.id}`);const e=r.finishBlock();e&&(yield e)}}"content_block_start"!==n.type&&"content_block_delta"!==n.type||void 0===n.index||(u=n.index);try{if("message_start"===n.type&&n.message?.usage){s.default.debug(`[AnthropicStreamProcessor] Processing message_start with usage: ${JSON.stringify(n.message.usage)}`);const e={type:"usage",inputTokens:n.message.usage.input_tokens||0,outputTokens:n.message.usage.output_tokens||0,cacheWriteTokens:n.message.usage.cache_creation_input_tokens||0,cacheReadTokens:n.message.usage.cache_read_input_tokens||0};yield e}else if("content_block_start"===n.type&&"thinking"===n.content_block?.type)s.default.debug("[AnthropicStreamProcessor] Processing content_block_start with thinking"),yield*l(n.content_block.thinking||"");else if("content_block_start"===n.type&&"text"===n.content_block?.type)s.default.debug("[AnthropicStreamProcessor] Processing content_block_start with text"),yield*o(n.content_block.text||"");else if("content_block_delta"===n.type&&"thinking_delta"===n.delta?.type)s.default.debug("[AnthropicStreamProcessor] Processing content_block_delta with thinking_delta"),yield*l(n.delta.thinking||"");else if("content_block_delta"===n.type&&"text_delta"===n.delta?.type)s.default.debug("[AnthropicStreamProcessor] Processing content_block_delta with text_delta"),yield*o(n.delta.text||"");else if("content_block_delta"===n.type&&"signature_delta"===n.delta?.type)s.default.debug("[AnthropicStreamProcessor] Processing content_block_delta with signature_delta"),yield*d(n.delta.signature||"");else if("message_delta"===n.type&&n.usage){s.default.debug(`[AnthropicStreamProcessor] Processing message_delta with usage: ${JSON.stringify(n.usage)}`);const e={type:"usage",inputTokens:0,outputTokens:n.usage.output_tokens||0,cacheReadTokens:0,cacheWriteTokens:0};yield e}else if("content_block_stop"===n.type){s.default.debug(`[AnthropicStreamProcessor] Processing content_block_stop for index ${n.index}`),i.debugLogger.log(`Processing content_block_stop for index ${n.index}`);const t=e.getCurrentBlock();if(t&&!t.finished){s.default.debug(`[AnthropicStreamProcessor] Finishing block due to content_block_stop: ${t.id}`),i.debugLogger.log(`Finishing block due to content_block_stop: ${t.id}`);const e=r.finishBlock();e&&(yield e)}}}catch(e){if(e.message.startsWith("STREAM_INTERRUPTED:")){s.default.warn(`[AnthropicStreamProcessor] Stream interrupted: ${e.message}`);break}throw e}}const p=e.getCurrentBlock();if(p&&!p.finished){s.default.debug(`[AnthropicStreamProcessor] Finishing remaining block: ${p.id}`);const e=r.finishBlock();e&&(yield e)}const f=(0,n.ulid)(),h=[];if(e.getThinkingContent()&&(s.default.debug("[AnthropicStreamProcessor] Adding thinking segment to MessageInterchange"),h.push({type:"thinking",content:e.getThinkingContent(),metadata:e.getThinkingSignature()?{signature:e.getThinkingSignature()}:void 0})),e.getTextContent()&&(s.default.debug("[AnthropicStreamProcessor] Adding text segment to MessageInterchange"),h.push({type:"text",content:e.getTextContent()})),e.isStreamInterrupted()){const t=e.getInterruptionReason();s.default.debug("[AnthropicStreamProcessor] Adding interruption message to MessageInterchange"),h.push({type:"text",content:`\n\n[${t||"Response interrupted due to multiple tool usage"}]`})}s.default.debug(`[AnthropicStreamProcessor] Creating MessageInterchange with ${h.length} segments`);const m={type:"messageInterchange",messageInterchange:{id:f,taskId:a,role:"assistant",segments:h,providerId:"anthropic",createdAt:new Date}};yield m}catch(t){s.default.error(`[AnthropicStreamProcessor] Error processing stream: ${t.message}`,t.stack);const r=e.getCurrentBlock();throw r&&!r.finished&&(s.default.debug(`[AnthropicStreamProcessor] Finishing block with error: ${r.id}`),yield{type:"blockUpdate",blockId:r.id,newStatus:"error",errorText:`Error processing stream: ${t.message}`}),t}},processTextChunk:o,processThinkingDelta:l,processSignatureDelta:d}};const n=r(59100),s=o(r(19055)),i=r(96297),a=r(81685),c=r(89560)},68444:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigEventHandler=void 0;const c=r(3563),l=r(76134),d=r(74437),u=a(r(19055)),p=r(96297),f=r(19668),h=r(9102),m=r(16663);let g=o=class{constructor(e,t,r){this.userService=e,this.configService=t,this.eventHelper=r}async handleGetConfig(e){p.debugLogger.log(`Received getConfig message from client ${e.id}`),u.default.info(`[${o.name}] Received getConfig message from client: ${e.id}`);try{const t=await this.userService.getCurrentUser(),r=await this.configService.assembleFinalConfiguration(t.userId,"plan"),n=await this.configService.assembleFinalConfiguration(t.userId,"act"),s={plan:{provider:r.providerId,model:r.modelId,baseUrl:r.baseUrl,thinkingTokens:r.thinkingTokens},act:{provider:n.providerId,model:n.modelId,baseUrl:n.baseUrl,thinkingTokens:n.thinkingTokens}};return u.default.info(`[${o.name}] Sending config response to client ${e.id}`),e.emit("config",{event:"config",data:s}),{event:"config",data:s}}catch(t){const r=t instanceof f.AuthenticationError?`Authentication failed: ${t.message}`:t.message;return u.default.error(`[${o.name}] Error in handleGetConfig: ${r}`,t.stack),e.emit("error",{message:r}),this.eventHelper.emitError(e.id,"unknown_task",r,"handleGetConfig","api_error"),{event:"error",data:{message:r}}}}};t.ConfigEventHandler=g,n([i(0,(0,l.ConnectedSocket)()),s("design:type",Function),s("design:paramtypes",[d.Socket]),s("design:returntype",Promise)],g.prototype,"handleGetConfig",null),t.ConfigEventHandler=g=o=n([(0,c.Injectable)(),s("design:paramtypes",[f.UserService,h.EveConfigService,m.EventHelper])],g)},68565:e=>{"use strict";e.exports=require("@langchain/community/document_loaders/fs/pdf")},68817:e=>{"use strict";e.exports=require("file-type")},69179:e=>{"use strict";e.exports=require("@langchain/community/document_loaders/fs/docx")},69205:function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(74476),t),n(r(21950),t)},69250:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthTokenRevocationRequestSchema=t.OAuthClientRegistrationErrorSchema=t.OAuthClientInformationFullSchema=t.OAuthClientInformationSchema=t.OAuthClientMetadataSchema=t.OAuthErrorResponseSchema=t.OAuthTokensSchema=t.OAuthMetadataSchema=void 0;const o=r(11569);t.OAuthMetadataSchema=o.z.object({issuer:o.z.string(),authorization_endpoint:o.z.string(),token_endpoint:o.z.string(),registration_endpoint:o.z.string().optional(),scopes_supported:o.z.array(o.z.string()).optional(),response_types_supported:o.z.array(o.z.string()),response_modes_supported:o.z.array(o.z.string()).optional(),grant_types_supported:o.z.array(o.z.string()).optional(),token_endpoint_auth_methods_supported:o.z.array(o.z.string()).optional(),token_endpoint_auth_signing_alg_values_supported:o.z.array(o.z.string()).optional(),service_documentation:o.z.string().optional(),revocation_endpoint:o.z.string().optional(),revocation_endpoint_auth_methods_supported:o.z.array(o.z.string()).optional(),revocation_endpoint_auth_signing_alg_values_supported:o.z.array(o.z.string()).optional(),introspection_endpoint:o.z.string().optional(),introspection_endpoint_auth_methods_supported:o.z.array(o.z.string()).optional(),introspection_endpoint_auth_signing_alg_values_supported:o.z.array(o.z.string()).optional(),code_challenge_methods_supported:o.z.array(o.z.string()).optional()}).passthrough(),t.OAuthTokensSchema=o.z.object({access_token:o.z.string(),token_type:o.z.string(),expires_in:o.z.number().optional(),scope:o.z.string().optional(),refresh_token:o.z.string().optional()}).strip(),t.OAuthErrorResponseSchema=o.z.object({error:o.z.string(),error_description:o.z.string().optional(),error_uri:o.z.string().optional()}),t.OAuthClientMetadataSchema=o.z.object({redirect_uris:o.z.array(o.z.string()).refine((e=>e.every((e=>URL.canParse(e)))),{message:"redirect_uris must contain valid URLs"}),token_endpoint_auth_method:o.z.string().optional(),grant_types:o.z.array(o.z.string()).optional(),response_types:o.z.array(o.z.string()).optional(),client_name:o.z.string().optional(),client_uri:o.z.string().optional(),logo_uri:o.z.string().optional(),scope:o.z.string().optional(),contacts:o.z.array(o.z.string()).optional(),tos_uri:o.z.string().optional(),policy_uri:o.z.string().optional(),jwks_uri:o.z.string().optional(),jwks:o.z.any().optional(),software_id:o.z.string().optional(),software_version:o.z.string().optional()}).strip(),t.OAuthClientInformationSchema=o.z.object({client_id:o.z.string(),client_secret:o.z.string().optional(),client_id_issued_at:o.z.number().optional(),client_secret_expires_at:o.z.number().optional()}).strip(),t.OAuthClientInformationFullSchema=t.OAuthClientMetadataSchema.merge(t.OAuthClientInformationSchema),t.OAuthClientRegistrationErrorSchema=o.z.object({error:o.z.string(),error_description:o.z.string().optional()}).strip(),t.OAuthTokenRevocationRequestSchema=o.z.object({token:o.z.string(),token_type_hint:o.z.string().optional()}).strip()},69449:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.LangchainModule=void 0;const n=r(3563),s=r(51e3);let i=class{};t.LangchainModule=i,t.LangchainModule=i=o([(0,n.Module)({providers:[s.CheckpointerService],exports:[s.CheckpointerService]})],i)},69461:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ListFiles=void 0;const c=r(83153),l=r(11569),d=i(r(79896)),u=i(r(16928)),p=a(r(19055));class f extends c.Tool{constructor(e){super(),this.name="list_files",this.description="List files and directories, showing size, timestamps, and for directories also showing total size and latest update time",this.schema=l.z.object({dirPath:l.z.string().describe("The relative path of the directory to list")}),this.workspaceRootDir=e}async _call(e){const t=this.listFiles(e.dirPath);return"Directory listing for "+e.dirPath+":\n"+JSON.stringify(t,null,2)}getFilePermissions(e){const t=["---","--x","-w-","-wx","r--","r-x","rw-","rwx"];return`${t[e>>6&7]}${t[e>>3&7]}${t[7&e]}`}getDirStats(e){let t=0,r=new Date(0);try{return d.readdirSync(e).forEach((o=>{const n=u.join(e,o),s=d.statSync(n);t+=s.size,s.mtime>r&&(r=s.mtime)})),{totalSize:t,latestUpdate:r.toISOString()}}catch(e){return p.default.error(`Error getting directory stats: ${e.message}`),{totalSize:0,latestUpdate:new Date(0).toISOString()}}}listFiles(e){p.default.info(`ListFiles.listFiles called with: ${e}`);const t=u.join(this.workspaceRootDir,e);try{return d.readdirSync(t).map((e=>{const r=u.join(t,e),o=d.statSync(r),n={name:e,size:o.size,modifiedTime:o.mtime.toISOString(),isDirectory:o.isDirectory(),permissions:this.getFilePermissions(o.mode)};if(o.isDirectory()){const e=this.getDirStats(r);n.totalSize=e.totalSize,n.latestUpdate=e.latestUpdate}return n}))}catch(t){if(p.default.error(`Error listing directory: ${t.message}`),"ENOENT"===t.code)throw new Error(`Directory not found - ${e}`);throw new Error(`Error listing directory: ${t.message}`)}}}t.ListFiles=f},70136:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.truncateConversationHistory=s,t.getTruncationRange=function(e,t={}){const r={...n,...t};if(e.length<=r.minMessagesToKeep)return null;let o=Math.floor(e.length*(r.percentToRemove/100));"aggressive"===r.strategy&&(o=Math.floor(1.5*o));if(o=Math.min(o,e.length-r.minMessagesToKeep),o<=0)return null;switch(r.strategy){case"preserve_recent":case"aggressive":default:return[0,o-1];case"preserve_first_last":const e=2;return[e,e+o-1];case"preserve_tools":return null}},t.applyManualTruncationStrategies=function(e,t){let r=[...e];const o=[],n=a(e);for(const e of t){const t=r.length,n=a(r);r=s(r,{strategy:e});const i=r.length,c=a(r);t===i&&n===c||o.push(e||"unknown")}const i=a(r);return{truncatedHistory:r,appliedStrategies:o,messagesProcessed:e.length,tokensRemoved:Math.max(0,n-i),originalTokens:n,finalTokens:i}},t.getNextTruncationStrategy=function(e="clip_large_messages"){switch(e){case"clip_large_messages":return{strategy:"preserve_recent",percentToRemove:25};case"preserve_recent":return{strategy:"preserve_tools",percentToRemove:40};case"preserve_tools":return{strategy:"preserve_first_last",percentToRemove:50};case"preserve_first_last":return{strategy:"aggressive",percentToRemove:60};case"aggressive":return{strategy:"aggressive",percentToRemove:75};default:return{strategy:"clip_large_messages",percentToRemove:25}}};const n={strategy:"clip_large_messages",percentToRemove:25,minMessagesToKeep:4,logger:o(r(19055)).default};function s(e,t={}){const r={...n,...t};if("clip_large_messages"===r.strategy)return function(e,t){if(e.length<=2)return[...e];const r=e.map((e=>{const t=e.segments.reduce(((e,t)=>e+(t.content?.length||0)),0);return{message:e,length:t}})),o=r.map((e=>e.length)).sort(((e,t)=>e-t)),n=o[Math.floor(o.length/2)],s=Math.max(3*n,2e3),i=[];let a=0;for(const{message:e,length:t}of r)if(t>s){a++;const t={...e,segments:e.segments.map((e=>"text"===e.type&&e.content?{...e,content:e.content.substring(0,1e3)+"\n\n[Content clipped for context compaction - original message was "+e.content.length+" characters]"}:e))};i.push(t)}else i.push(e);a>0&&t.warn(`[ContextTruncation] Clipped ${a} large messages (threshold: ${s} chars, median: ${n} chars)`);return i}(e,r.logger);if(e.length<=r.minMessagesToKeep)return[...e];let o=Math.floor(e.length*(r.percentToRemove/100));if("aggressive"===r.strategy&&(o=Math.floor(1.5*o)),o=Math.min(o,e.length-r.minMessagesToKeep),o<=0)return[...e];switch(r.logger.warn(`[ContextTruncation] Truncating conversation history using '${r.strategy}' strategy. Removing ${o} of ${e.length} messages (${r.percentToRemove}%).`),r.strategy){case"preserve_recent":case"aggressive":default:return i(e,o);case"preserve_first_last":return function(e,t){const r=2,o=e.length-t-r;if(o<=0)return[...e];return[...e.slice(0,r),...e.slice(e.length-o)]}(e,o);case"preserve_tools":return function(e,t){const r=e=>e.segments.some((e=>"other"===e.type&&e.metadata?.providerSpecificType?.includes("tool"))),o=[],n=[];for(const t of e)r(t)?o.push(t):n.push(t);if(n.length<=t){const e=t-n.length;return e>0?o.slice(e):o}const s=n.slice(t),i=o.map(((t,r)=>({msg:t,originalIndex:e.indexOf(t)}))),a=s.map(((t,r)=>({msg:t,originalIndex:e.indexOf(t)}))),c=[...i,...a];return c.sort(((e,t)=>e.originalIndex-t.originalIndex)),c.map((e=>e.msg))}(e,o)}}function i(e,t){return e.slice(t)}function a(e){const t=e.reduce(((e,t)=>e+t.segments.reduce(((e,t)=>e+(t.content?.length||0)),0)),0);return Math.round(t/4)}},70209:function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(37886),t),n(r(40305),t),n(r(63118),t),n(r(160),t),n(r(10146),t)},70361:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolsModule=void 0;const n=r(3563),s=r(86158),i=r(62397),a=r(3177),c=r(45873),l=r(23880),d=r(57852),u=r(29161),p=r(76552),f=r(48624),h=r(71680),m=r(57967);let g=class{};t.ToolsModule=g,t.ToolsModule=g=o([(0,n.Module)({imports:[a.MutationsModule,c.WorkspaceModule,l.SessionModule,d.SourceArtefactModule,u.ChatCompletionModule,p.DatasetModule,f.StoredFileModule,h.DocstoreModule,m.ConfigModule],providers:[s.ToolFactoryService,i.McpToolFactoryService],exports:[s.ToolFactoryService]})],g)},70811:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.containsBase64Image=function(e){if("object"!=typeof e)return!1;if("image_url"===e?.type&&e?.image_url?.url){const t=e.image_url.url;return t.startsWith("data:image")&&t.includes("base64")}if(e?.data&&"string"==typeof e.data)return e.data.length>1e3&&/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/.test(e.data);return!1},t.processImageContent=function e(t){if(!t)return t;if("string"==typeof t&&(t.startsWith("{")||t.startsWith("[")))try{const r=JSON.parse(t),o=e(r);return JSON.stringify(o)}catch(e){return t}if(Array.isArray(t))return t.map((t=>e(t)));if("object"==typeof t&&null!==t){if("image_url"===t.type&&t.image_url?.url){const e=t.image_url.url;if(e.startsWith("data:image")&&e.includes("base64")){const t=e.match(/data:image\/([a-zA-Z0-9]+);base64,/),r=t?t[1]:"unknown",o=e.indexOf("base64,")+7,s=e.length-o;return n.default.info(`[ImageHandler] Replacing base64 image data (${r}, ${s} bytes) with reference`),{type:"image_url",image_url:{url:`[BASE64_IMAGE_DATA_${r.toUpperCase()}_${s}_BYTES]`}}}}if(t.data&&"string"==typeof t.data&&t.data.length>1e3&&/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/.test(t.data)){const e=t.data.length;return n.default.info(`[ImageHandler] Replacing base64 data (${e} bytes) with reference`),{...t,data:`[BASE64_DATA_${e}_BYTES]`}}const r={};for(const[o,n]of Object.entries(t))r[o]=e(n);return r}return t};const n=o(r(19055))},70857:e=>{"use strict";e.exports=require("os")},70943:e=>{"use strict";e.exports=require("shell-quote")},70989:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseToolCallingAgent=void 0;const i=r(91486),a=r(3563),c=r(71412),l=r(51e3),d=r(93239),u=r(52368),p=r(76910),f=r(30538),h=r(7373),m=r(86158),g=r(88474),y=s(r(19055)),v=r(96295),_=r(72873),w=r(93470);let b=class extends v.SimpleAgentService{constructor(e,t,r,o,n,s,i){super(e,t,r,o,n,i),this.workspaceService=e,this.sessionService=t,this.homeService=r,this.summaryCompletion=o,this.toolFactory=n,this.checkpointerService=s,this.ruleService=i}getToolCallingScheme(){return new _.MultilineToolCallingScheme}async*handleAppStream(e,t,r){let o;if(this.checkpointerService&&e.sessionId)try{const t=await this.checkpointerService.loadState(e.sessionId);t&&(o=t,y.default.debug("Loaded existing conversation state for session: %s",e.sessionId))}catch(e){y.default.warn("Failed to load conversation state:",e)}const n=await this.chatModelManager.getModel(e.config,this.getModelCategory(),this.isPrivateModelsOnly()),s=this.getTools(t);o||(o=this.createInitialState());const a=c.AgentRequest.getFirstTextContent(e.content),l=u.ConfigService.getInstance().getNumericProperty(p.ConfigPropNames.AGENT_ITERATION_LIMIT,20);let d=0,f=!1;const h=this.getToolCallingScheme();let m=await this.getSpecificSystemPrompt(t)+h.getSystemPrompt(t,s);const g=await this.getAgentRules();for(g&&(m=m+"\n\nAdditional system rules:\n"+g),y.default.debug("System prompt was:\n%s",m),o.messages.push(new i.SystemMessage({content:m})),o.messages.push(new i.HumanMessage({content:a}));d<l&&!f;){d++,y.default.info(`Iteration ${d}: Asking model for response...`);const t=await n.baseChatModel.invoke(o.messages);o.messages.push(t),this.checkpointerService&&e.sessionId&&await this.checkpointerService.saveState(e.sessionId,o),yield o;const r=t.content.toString();let a;y.default.info(`Iteration ${d}: Agent response:\n${r}`);try{a=h.parseLLMResponse(r)}catch(e){o.messages.push(new i.HumanMessage({content:"Error: Your response could not be parsed as valid. Please ensure you follow the correct format."}));continue}const{response:c,tool_calls:l,next:u}=a;if("finish"!==u)if("call_tools"===u&&Array.isArray(l))for(const e of l){const{tool_name:t,args:r}=e,n=s.find((e=>e.name===t));if(n)try{const e=await n.call(r);o.messages.push(new i.HumanMessage({content:`Tool: '${t}' output:\n${e}`}))}catch(e){y.default.error(`Error executing tool '${t}':`,e),o.messages.push(new i.HumanMessage({content:`Tool: Error executing '${t}': ${e.message}`})),yield o}else o.messages.push(new i.HumanMessage({content:`Tool: Unknown tool '${t}'.`})),yield o}else"continue"!==u&&(o.messages.push(new i.HumanMessage({content:`Tool: Unrecognized 'next' value '${u}'. Please use 'call_tools', 'continue', or 'finish'.`})),yield o);else f=!0}f||(o.messages.push(new i.SystemMessage({content:`Maximum iterations (${l}) reached without completion.`})),yield o)}};t.BaseToolCallingAgent=b,t.BaseToolCallingAgent=b=o([(0,a.Injectable)(),n("design:paramtypes",[g.WorkspaceService,h.SessionService,f.HomeService,d.SummaryCompletion,m.ToolFactoryService,l.CheckpointerService,w.AgentRuleService])],b)},71036:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolEventHandler=void 0;const a=r(3563),c=r(59100),l=i(r(19055)),d=r(96297),u=r(55324),p=r(48010),f=r(56349),h=r(16663),m=r(91280),g=r(50461);let y=o=class{constructor(e,t,r,o,n){this.blockService=e,this.toolExecutorService=t,this.conversationHistoryService=r,this.eventHelper=o,this.eventEmitter=n}async handleToolApproval(e,t){d.debugLogger.log(`Received toolApproval from client ${t.id} for block ${e.blockId}`),l.default.info(`[${o.name}] Received tool approval for block ${e.blockId}, Approved: ${e.approved}`);try{const r=await this.blockService.getBlock(e.blockId);if(!r)throw new Error(`Block with ID ${e.blockId} not found.`);const n=r.tagName||"unknown";if(e.approved){await this.blockService.updateBlock(e.blockId,{status:"approved"});const r={blockId:e.blockId,toolName:n};this.eventEmitter.emit(m.InternalEvents.TOOL_CALL_BATCH_DETECTED,{clientId:t.id,taskId:e.taskId,toolCalls:[r]}),l.default.info(`[${o.name}] Tool approval for block ${e.blockId} processed. Emitted TOOL_CALL_BATCH_DETECTED.`)}else{await this.blockService.updateBlock(e.blockId,{status:"rejected",output:"Tool execution declined by user"});const r={id:(0,c.ulid)(),taskId:e.taskId,role:"user",segments:[{type:"text",content:`I've rejected the ${n} tool call. Please continue without executing this tool and suggest an alternative approach or ask me what you'd like me to do instead.`}],providerId:"system",createdAt:new Date};try{await this.conversationHistoryService.addMessage(e.taskId,r),l.default.info(`[${o.name}] Added rejection message to conversation history for task ${e.taskId}`)}catch(t){l.default.error(`[${o.name}] Error adding rejection message to history for task ${e.taskId}: ${t.message}`)}if(!e.taskId||""===e.taskId.trim())return l.default.error(`[${o.name}] Invalid or empty taskId in tool rejection for block ${e.blockId}. TaskId: '${e.taskId}'`),void l.default.error(`[${o.name}] Cannot emit TOOL_EXECUTION_COMPLETED event without valid taskId. This indicates a bug in the client request.`);this.eventHelper.emitToolExecutionCompleted({clientId:t.id,taskId:e.taskId,blockId:e.blockId,toolName:n,result:{message:"Tool execution declined by user"},status:"rejected"}),l.default.info(`[${o.name}] Tool rejected for block ${e.blockId}, rejection message added to history`)}}catch(r){l.default.error(`[${o.name}] Error handling tool approval for block ${e.blockId}: ${r.message}\n${r.stack}`),this.eventHelper.emitError(t.id,e.taskId,r.message,"handleToolApproval","tool_error",{blockId:e.blockId})}}};t.ToolEventHandler=y,t.ToolEventHandler=y=o=n([(0,a.Injectable)(),s("design:paramtypes",[u.BlockService,p.ToolExecutorService,f.ConversationHistoryService,h.EventHelper,g.EventEmitter2])],y)},71064:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Protocol=t.DEFAULT_REQUEST_TIMEOUT_MSEC=void 0,t.mergeCapabilities=function(e,t){return Object.entries(t).reduce(((e,[t,r])=>(e[t]=r&&"object"==typeof r&&e[t]?{...e[t],...r}:r,e)),{...e})};const o=r(10815);t.DEFAULT_REQUEST_TIMEOUT_MSEC=6e4;t.Protocol=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this.setNotificationHandler(o.CancelledNotificationSchema,(e=>{const t=this._requestHandlerAbortControllers.get(e.params.requestId);null==t||t.abort(e.params.reason)})),this.setNotificationHandler(o.ProgressNotificationSchema,(e=>{this._onprogress(e)})),this.setRequestHandler(o.PingRequestSchema,(e=>({})))}_setupTimeout(e,t,r,o,n=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(o,t),startTime:Date.now(),timeout:t,maxTotalTimeout:r,resetTimeoutOnProgress:n,onTimeout:o})}_resetTimeout(e){const t=this._timeoutInfo.get(e);if(!t)return!1;const r=Date.now()-t.startTime;if(t.maxTotalTimeout&&r>=t.maxTotalTimeout)throw this._timeoutInfo.delete(e),new o.McpError(o.ErrorCode.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:t.maxTotalTimeout,totalElapsed:r});return clearTimeout(t.timeoutId),t.timeoutId=setTimeout(t.onTimeout,t.timeout),!0}_cleanupTimeout(e){const t=this._timeoutInfo.get(e);t&&(clearTimeout(t.timeoutId),this._timeoutInfo.delete(e))}async connect(e){this._transport=e,this._transport.onclose=()=>{this._onclose()},this._transport.onerror=e=>{this._onerror(e)},this._transport.onmessage=(e,t)=>{(0,o.isJSONRPCResponse)(e)||(0,o.isJSONRPCError)(e)?this._onresponse(e):(0,o.isJSONRPCRequest)(e)?this._onrequest(e,t):(0,o.isJSONRPCNotification)(e)?this._onnotification(e):this._onerror(new Error(`Unknown message type: ${JSON.stringify(e)}`))},await this._transport.start()}_onclose(){var e;const t=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._transport=void 0,null===(e=this.onclose)||void 0===e||e.call(this);const r=new o.McpError(o.ErrorCode.ConnectionClosed,"Connection closed");for(const e of t.values())e(r)}_onerror(e){var t;null===(t=this.onerror)||void 0===t||t.call(this,e)}_onnotification(e){var t;const r=null!==(t=this._notificationHandlers.get(e.method))&&void 0!==t?t:this.fallbackNotificationHandler;void 0!==r&&Promise.resolve().then((()=>r(e))).catch((e=>this._onerror(new Error(`Uncaught error in notification handler: ${e}`))))}_onrequest(e,t){var r,n,s;const i=null!==(r=this._requestHandlers.get(e.method))&&void 0!==r?r:this.fallbackRequestHandler;if(void 0===i)return void(null===(n=this._transport)||void 0===n||n.send({jsonrpc:"2.0",id:e.id,error:{code:o.ErrorCode.MethodNotFound,message:"Method not found"}}).catch((e=>this._onerror(new Error(`Failed to send an error response: ${e}`)))));const a=new AbortController;this._requestHandlerAbortControllers.set(e.id,a);const c={signal:a.signal,sessionId:null===(s=this._transport)||void 0===s?void 0:s.sessionId,sendNotification:t=>this.notification(t,{relatedRequestId:e.id}),sendRequest:(t,r,o)=>this.request(t,r,{...o,relatedRequestId:e.id}),authInfo:null==t?void 0:t.authInfo};Promise.resolve().then((()=>i(e,c))).then((t=>{var r;if(!a.signal.aborted)return null===(r=this._transport)||void 0===r?void 0:r.send({result:t,jsonrpc:"2.0",id:e.id})}),(t=>{var r,n;if(!a.signal.aborted)return null===(r=this._transport)||void 0===r?void 0:r.send({jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(t.code)?t.code:o.ErrorCode.InternalError,message:null!==(n=t.message)&&void 0!==n?n:"Internal error"}})})).catch((e=>this._onerror(new Error(`Failed to send response: ${e}`)))).finally((()=>{this._requestHandlerAbortControllers.delete(e.id)}))}_onprogress(e){const{progressToken:t,...r}=e.params,o=Number(t),n=this._progressHandlers.get(o);if(!n)return void this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));const s=this._responseHandlers.get(o),i=this._timeoutInfo.get(o);if(i&&s&&i.resetTimeoutOnProgress)try{this._resetTimeout(o)}catch(e){return void s(e)}n(r)}_onresponse(e){const t=Number(e.id),r=this._responseHandlers.get(t);if(void 0!==r)if(this._responseHandlers.delete(t),this._progressHandlers.delete(t),this._cleanupTimeout(t),(0,o.isJSONRPCResponse)(e))r(e);else{r(new o.McpError(e.error.code,e.error.message,e.error.data))}else this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`))}get transport(){return this._transport}async close(){var e;await(null===(e=this._transport)||void 0===e?void 0:e.close())}request(e,r,n){const{relatedRequestId:s,resumptionToken:i,onresumptiontoken:a}=null!=n?n:{};return new Promise(((c,l)=>{var d,u,p,f,h;if(!this._transport)return void l(new Error("Not connected"));!0===(null===(d=this._options)||void 0===d?void 0:d.enforceStrictCapabilities)&&this.assertCapabilityForMethod(e.method),null===(u=null==n?void 0:n.signal)||void 0===u||u.throwIfAborted();const m=this._requestMessageId++,g={...e,jsonrpc:"2.0",id:m};(null==n?void 0:n.onprogress)&&(this._progressHandlers.set(m,n.onprogress),g.params={...e.params,_meta:{progressToken:m}});const y=e=>{var t;this._responseHandlers.delete(m),this._progressHandlers.delete(m),this._cleanupTimeout(m),null===(t=this._transport)||void 0===t||t.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:m,reason:String(e)}},{relatedRequestId:s,resumptionToken:i,onresumptiontoken:a}).catch((e=>this._onerror(new Error(`Failed to send cancellation: ${e}`)))),l(e)};this._responseHandlers.set(m,(e=>{var t;if(!(null===(t=null==n?void 0:n.signal)||void 0===t?void 0:t.aborted)){if(e instanceof Error)return l(e);try{const t=r.parse(e.result);c(t)}catch(e){l(e)}}})),null===(p=null==n?void 0:n.signal)||void 0===p||p.addEventListener("abort",(()=>{var e;y(null===(e=null==n?void 0:n.signal)||void 0===e?void 0:e.reason)}));const v=null!==(f=null==n?void 0:n.timeout)&&void 0!==f?f:t.DEFAULT_REQUEST_TIMEOUT_MSEC;this._setupTimeout(m,v,null==n?void 0:n.maxTotalTimeout,(()=>y(new o.McpError(o.ErrorCode.RequestTimeout,"Request timed out",{timeout:v}))),null!==(h=null==n?void 0:n.resetTimeoutOnProgress)&&void 0!==h&&h),this._transport.send(g,{relatedRequestId:s,resumptionToken:i,onresumptiontoken:a}).catch((e=>{this._cleanupTimeout(m),l(e)}))}))}async notification(e,t){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);const r={...e,jsonrpc:"2.0"};await this._transport.send(r,t)}setRequestHandler(e,t){const r=e.shape.method.value;this.assertRequestHandlerCapability(r),this._requestHandlers.set(r,((r,o)=>Promise.resolve(t(e.parse(r),o))))}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,t){this._notificationHandlers.set(e.shape.method.value,(r=>Promise.resolve(t(e.parse(r)))))}removeNotificationHandler(e){this._notificationHandlers.delete(e)}}},71263:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProductAgentService=void 0;const a=r(3563),c=r(86158),l=r(93470),d=i(r(19055)),u=r(22300),p=r(55277),f=r(78921);let h=class extends p.GraphAgentService{constructor(e,t,r){super(e,t,r),this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}getName(){return"product-agent"}async getTools(e){return await this.toolFactoryService.createTools(["update_file","delete_file","fetch_web_page","current_timestamp","serp_api"],e)}async getSystemPrompt(e){let t=`As an AI Product Manager, your role is to define, refine, and manage product requirements through epics and stories. You excel at:\n\n1. Creating and Refining Requirements:\n   - Developing clear, comprehensive epic requirements\n   - Breaking down epics into well-defined stories\n   - Writing detailed, testable acceptance criteria\n   - Ensuring requirements are SMART (Specific, Measurable, Achievable, Relevant, Time-bound)\n\n2. Stakeholder Perspective Analysis:\n   - Product Value: Ensuring features deliver clear business value\n   - User Experience: Considering the end-user journey and usability\n   - Quality Assurance: Including testability and edge cases\n   - Operations: Considering scalability, monitoring, and maintenance\n   - Engineering: Evaluating technical feasibility and complexity\n   - Security: Identifying potential security implications\n   - Compliance: Ensuring regulatory and policy compliance\n\n3. Story Creation Best Practices:\n   - Write user-centric stories following the format:\n     "A a [user type], I want [goal] so that [benefit]"\n   - Create comprehensive acceptance criteria that:\n     * Are each formatted as "ACxx: Given a [user type], when [action], then [outcome]"\n     * Are specific and testable\n     * Cover happy path and edge cases\n     * Include performance requirements\n     * Specify error handling\n     * Define security requirements\n     * Include monitoring/observability requirements\n\n4. Requirements Quality Standards:\n   - Clarity: Unambiguous and easily understood\n   - Completeness: Covers all aspects of the feature\n   - Consistency: Aligns with existing features and patterns\n   - Testability: Can be verified through testing\n   - Feasibility: Technically achievable within constraints\n   - Traceability: Links to business goals and metrics\n\n${await f.EpicsPrompts.updateEpicInstructions(e)}\n\n${await f.EpicsPrompts.updateEpicStories(e)}\n\n${await f.EpicsPrompts.existingEpicsAndStories(e)}\n\n${e.productHints()?`Product Guidelines:\n${e.productHints()}`:""}\n\nIMPORTANT: Always write requirements from the user's perspective\nIMPORTANT: Every story must have clear, testable acceptance criteria\nIMPORTANT: Consider all stakeholder perspectives when defining requirements\nIMPORTANT: Ensure requirements are complete, clear, and unambiguous\nIMPORTANT: Include non-functional requirements (performance, security, etc.)\nIMPORTANT: Use the current_timestamp tool for timestamps\nIMPORTANT: Stories should be independent and deliverable\nIMPORTANT: DO NOT CREATE ANY STORIES UNLESS YOU ARE ASKED TO DO SO EXPLICITLY\n`;return d.default.debug(`Product Agent system prompt for workspace '${e.workspace.name}' (length: ${t.length} chars): ${t}`),t}};t.ProductAgentService=h,t.ProductAgentService=h=o([(0,a.Injectable)(),s(0,(0,a.Inject)((0,a.forwardRef)((()=>u.GraphAgentCollaborator)))),n("design:paramtypes",[u.GraphAgentCollaborator,c.ToolFactoryService,l.AgentRuleService])],h)},71412:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AgentRequest=void 0;const o=r(92003),n=r(59100);class s{constructor(e,t,r,n=new o.AgentConfig,i){this.sender=e,this.content=t,this.sessionId=r,this.config=n,this.workspaceName=i,this.sessionId=r||s.generateRandomSessionId()}static fromJSON(e){const{sender:t,content:r,sessionId:n,config:i,workspaceName:a,agent:c}=e;if(!r)throw new Error("Missing required field 'content'");const l=i?Object.assign(new o.AgentConfig,i):new o.AgentConfig,d=n||s.generateRandomSessionId();return new s(t,r,d,l,a)}static generateRandomSessionId(){return(0,n.ulid)()}static getFirstTextContent(e){if("string"==typeof e)return e;if(!Array.isArray(e))throw new Error("Invalid content type");{const t=e[0];if("text"===t.type)return t.text||""}}}t.AgentRequest=s},71600:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UseMcpToolToolFactory=void 0;const s=r(3563),i=r(15853),a=r(2115);let c=class{constructor(e){this.mcpHubService=e}getToolName(){return"use_mcp_tool"}create(e){return new i.UseMcpToolTool(this.mcpHubService,e.user.userId,{availableInPlan:!0,availableInAct:!0})}};t.UseMcpToolToolFactory=c,t.UseMcpToolToolFactory=c=o([(0,s.Injectable)(),n("design:paramtypes",[a.McpHubService])],c)},71618:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VercelProvider=void 0;const i=r(3563),a=r(36206),c=r(91760),l=r(78706),d=r(91386),u=r(51921),p=s(r(19055));let f=class{constructor(e,t){this.providerRegistry=e,this.openSourceModelRegistry=t,this.config={providerId:u.VERCEL_PROVIDER_ID,name:"Vercel v0",description:"Vercel v0 AI models for UI generation and development",website:"https://vercel.com/docs/v0/api",docsLink:"https://vercel.com/docs/v0/api",baseUrl:"https://api.v0.dev/v1",apiKeyName:"VERCEL_API_KEY",defaultModelId:(0,u.getDefaultVercelModelId)(),modelDiscovery:"api",features:{supportsStreaming:!0,supportsCaching:!0,supportsTools:!0,supportsImages:!0}},p.default.info("[VercelProvider] Initialized"),this.providerRegistry.registerProvider(this)}getId(){return this.config.providerId}getName(){return this.config.name}getMetadata(){return{website:this.config.website,docs_link:this.config.docsLink,api_version:"v1",default_base_url:this.config.baseUrl,specialties:["ui-generation","react","frontend","components"],pricing_model:"pay-per-use"}}requiresApiKey(){return!0}getDefaultBaseUrl(){return this.config.baseUrl}getDefaultModelId(){return this.config.defaultModelId}getApiKeyName(){return this.config.apiKeyName}getModelClient(e){const t={...e,baseUrl:e.baseUrl||this.config.baseUrl},r=new l.OpenAIModelClient(t,{enableVerboseLogging:!1});return this.discoverModels(e.apiKey,t.baseUrl).then((t=>{const o=t.find((t=>t.modelId===e.modelId));o?r.setModelMetadata(o):p.default.warn(`[VercelProvider] Metadata not found for model ${e.modelId}`)})).catch((e=>{p.default.warn(`[VercelProvider] Failed to discover models: ${e.message}`)})),r}getProviderMetadata(){return d.OpenAICompatibleUtils.createProviderMetadata(this.config)}getStaticModels(){return(0,u.getStaticVercelModels)()}async discoverDynamicModels(e,t){const r=t||this.config.baseUrl;return{models:await(0,u.discoverVercelModels)(e,r,this.openSourceModelRegistry),discoveredAt:new Date,discoveryMethod:"api",source:r}}requiresApiKeyForDiscovery(){return!0}async discoverModels(e,t){const r=t||this.config.baseUrl;return(0,u.discoverVercelModels)(e,r,this.openSourceModelRegistry)}};t.VercelProvider=f,t.VercelProvider=f=o([(0,i.Injectable)(),n("design:paramtypes",[a.ProviderRegistry,c.OpenSourceModelRegistryService])],f)},71672:function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(91926),t),n(r(91140),t),n(r(37916),t),n(r(31002),t),n(r(45789),t),n(r(15562),t),n(r(40791),t)},71680:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.DocstoreModule=void 0;const n=r(3563),s=r(58144),i=r(63381),a=r(88648),c=r(376);let l=class{};t.DocstoreModule=l,t.DocstoreModule=l=o([(0,n.Module)({imports:[c.DataSourceModule],controllers:[s.StoredDocController],providers:[i.StoredDocService,a.StoredDocRepository],exports:[i.StoredDocService]})],l)},71921:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AskFollowupQuestionTool=void 0;const a=r(3563),c=r(20436),l=i(r(19055));let d=o=class extends c.BaseTool{constructor(e){super(e),this.name="ask_followup_question",this.description="Ask the user a question to gather additional information needed to complete the task.",l.default.info(`[${o.name}] AskFollowupQuestionTool initialized`)}getModeSpecificGuidance(e){return null}getBaseUsageInstructions(e){return'## ask_followup_question\nDescription: Ask the user a question to gather additional information needed to complete the task. This tool should be used when you encounter ambiguities, need clarification, or require more details to proceed effectively. It allows for interactive problem-solving by enabling direct communication with the user. Use this tool judiciously to maintain a balance between gathering necessary information and avoiding excessive back-and-forth.\nParameters:\n- question: (required) The question to ask the user. This should be a clear, specific question that addresses the information you need.\n- options: (optional) An array of 2-5 options for the user to choose from. Each option should be a string describing a possible answer. You may not always need to provide options, but it may be helpful in many cases where it can save the user from having to type out a response manually. IMPORTANT: NEVER include an option to toggle to Act mode, as this would be something you need to direct the user to do manually themselves if needed.\nUsage:\n<ask_followup_question>\n<question>Your question here</question>\n<options>\nArray of options here (optional), e.g. ["Option 1", "Option 2", "Option 3"]\n</options>\n</ask_followup_question>'}validateParams(e){return"string"==typeof e.question&&""!==e.question.trim()}async execute(e){const{question:t,options:r}=e;return l.default.info(`[${o.name}] Asking followup question: ${t}`),{question:t,options:r,response:"This is a placeholder response. In a real implementation, the response would be provided by the user."}}};t.AskFollowupQuestionTool=d,t.AskFollowupQuestionTool=d=o=n([(0,a.Injectable)(),s("design:paramtypes",[Object])],d)},72083:e=>{"use strict";e.exports=require("tree-sitter-ruby")},72123:function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(86308),t),n(r(87001),t),n(r(89560),t),n(r(67890),t)},72177:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentsModule=void 0;const n=r(3563),s=r(93520),i=r(69449),a=r(5017),c=r(63887),l=r(53229),d=r(6695),u=r(32424),p=r(70361),f=r(7307),h=r(73690),m=r(48471),g=r(93470),y=r(5025),v=r(87223),_=r(71263),w=r(65591),b=r(66651),k=r(45873),S=r(23880),T=r(84193),R=r(29161),C=r(376),P=r(57967),E={provide:"AGENT_SERVICES",useFactory:async(e,t,r,o,n,s,i,a,c)=>{const l=new Map;l.set("se-agent",e),l.set("ops-agent",t),l.set("review-agent",r),l.set("computer-use-agent",o),l.set("private-coder-agent",n),l.set("architect-agent",s),l.set("product-agent",i),l.set("mcp-agent",a);return(await c.loadPlugins()).forEach((e=>{e&&e.getName&&l.set(e.getName(),e)})),l},inject:[a.SEAgentService,c.OpsAgentService,l.ReviewAgentService,d.ComputerUseAgentService,m.PrivateCoderAgentService,v.ArchitectAgentService,_.ProductAgentService,w.MCPAgentService,f.PluginLoaderService]};let I=class{};t.AgentsModule=I,t.AgentsModule=I=o([(0,n.Module)({imports:[u.GraphAgentModule,p.ToolsModule,h.SimpleAgentModule,k.WorkspaceModule,S.SessionModule,T.HomeModule,R.ChatCompletionModule,i.LangchainModule,C.DataSourceModule,P.ConfigModule],controllers:[s.AgentController,b.MCPController],providers:[a.SEAgentService,c.OpsAgentService,l.ReviewAgentService,d.ComputerUseAgentService,m.PrivateCoderAgentService,v.ArchitectAgentService,_.ProductAgentService,w.MCPAgentService,f.PluginLoaderService,g.AgentRuleService,y.AgentRuleRepository,E],exports:[E,g.AgentRuleService]})],I)},72609:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseCommandLineValidator=void 0;const c=i(r(16928)),l=i(r(91943)),d=i(r(70857)),u=a(r(19055)),p=r(79086);t.BaseCommandLineValidator=class{constructor(e){this.enabled=!0,this.config=e,this.checkCommandAvailability(),u.default.info(`[${this.constructor.name}] Created validator: ${e.name} with priority ${e.priority}`)}getPriority(){return this.config.priority}async checkCommandAvailability(){try{const e=this.config.command.split(" ")[0],{stdout:t,stderr:r}=await(0,p.execCommand)(`command -v ${e}`);u.default.info(`[${this.constructor.name}] Checking Availability Ran: 'command -v ${e}' - ${t} - ${r}`);!t.trim()||t.includes("not found")||t.includes("no such file")||r.includes("not found")||r.includes("no such file")?(this.enabled=!1,u.default.warn(`[${this.constructor.name}] Command '${e}' for validator '${this.config.name}' is not available. Validator disabled.`)):(this.enabled=!0,u.default.info(`[${this.constructor.name}] Command '${e}' is available for validator: ${this.config.name}`))}catch(e){this.enabled=!1,u.default.warn(`[${this.constructor.name}] Command for validator '${this.config.name}' is not available. Validator disabled. Error: ${e.message}`)}}canValidate(e){return this.enabled&&this.config.fileExtensions.includes(e.toLowerCase())}async validate(e,t,r){u.default.debug(`[${this.constructor.name}] Validating file: ${e}`);let o=null,n=c.isAbsolute(e)?e:c.resolve(r,e);try{try{await l.access(n)}catch(r){const s=await l.mkdtemp(c.join(d.tmpdir(),"eve-validation-"));o=c.join(s,c.basename(e)),await l.writeFile(o,t),n=o,u.default.debug(`[${this.constructor.name}] Created temporary file: ${o}`)}const s=this.config.command.replace("{filePath}",n).replace("{workingDirectory}",r);u.default.debug(`[${this.constructor.name}] Executing command: ${s}`),console.log(`[${this.constructor.name}] Executing command: ${s}`);const{stdout:i,stderr:a,code:f}=await(0,p.execCommand)(s,{cwd:r});u.default.debug(`[${this.constructor.name}] Command stdout: ${i}`),console.log(`[${this.constructor.name}] Command stdout: ${i}`),a&&(u.default.debug(`[${this.constructor.name}] Command stderr: ${a}`),console.log(`[${this.constructor.name}] Command stderr: ${a}`));const h=this.hasValidationErrors(i,a,f),m=this.formatValidationReport(i,a);return{validatorName:this.config.name,validationMethod:this.config.command,hasErrors:h,report:m}}catch(t){return u.default.error(`[${this.constructor.name}] Error validating file ${e}: ${t.message}`),{validatorName:this.config.name,validationMethod:this.config.command,hasErrors:!0,report:`Validation error: ${t.message}`}}finally{if(o)try{await l.unlink(o),await l.rmdir(c.dirname(o)),u.default.debug(`[${this.constructor.name}] Removed temporary file: ${o}`)}catch(e){u.default.warn(`[${this.constructor.name}] Error removing temporary file ${o}: ${e.message}`)}}}getName(){return this.config.name}}},72626:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReadDependencySourceFile=void 0;const o=r(83153),n=r(11569);class s extends o.Tool{constructor(e){super(),this.name="read_dependency_source_file",this.description='Read the content of a specific source file from a dependency, using the package manager scheme (e.g. "maven"), locator (e.g. "com.example:example:1.0.0"), and file path.\n  Currently only maven is supported so the scheme is always "maven" and the locator is always a Maven GAV tuple (group:artifact:version).\n  If no repository URLs are provided then the default Maven central repository will be used.\n  The file path should be relative to the root of the source directory, e.g., "com/foo/Bar.java".\n  If the file is not found, it will check for alternative extensions (e.g., .kt for Kotlin).\n  ',this.schema=n.z.object({input:n.z.string().describe("A JSON string containing packageManagerScheme, locator, filePath, and optional repositoryUrls")}),this.sourceArtefactService=e}async _call(e){const{packageManagerScheme:t,locator:r,filePath:o,repositoryUrls:n}=JSON.parse(e.input);if(!t||!r||!o)return"Error: Missing required parameters. Please provide packageManagerScheme, locator, and filePath.";try{return await this.sourceArtefactService.readArtefactSourceFile(t,r,o,n)}catch(e){return`Error: Unable to read dependency source file. ${e instanceof Error?e.message:"Unknown error occurred"}`}}}t.ReadDependencySourceFile=s},72776:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getAppDataSource=t.AppDataSource=void 0;const c=a(r(19055)),l=r(96297),d=a(r(31832)),u=i(r(99187)),p=r(88627),f=r(53903);class h{constructor(e){this.dbChoice=e,this.dbDebugContextService=null}setDbDebugContextService(e){this.dbDebugContextService=e,c.default.info("DbDebugContextService set in AppDataSource")}async initKnexOnly(){const e=this.dbChoice?(0,u.default)(this.dbChoice):(0,u.getDefaultKnexConfig)();c.default.info("Initializing knex with config:",{client:e.client,connection:"string"==typeof e.connection?e.connection:{...e.connection,password:"***"},pool:e.pool,dbChoice:this.dbChoice}),this.knex=(0,d.default)(e),this.setupQueryDebugListeners(),await this.verifyDbConnection(this.knex)}async verifyDbConnection(e){try{c.default.info("Verifying database connection...");const t=e.client.pool;if(t&&"object"==typeof t){const e={min:t.min,max:t.max};"function"==typeof t.numUsed&&(e.numUsed=t.numUsed()),"function"==typeof t.numFree&&(e.numFree=t.numFree()),"function"==typeof t.pendingCreates&&(e.pendingCreates=t.pendingCreates()),"function"==typeof t.pendingAcquires&&(e.pendingAcquires=t.pendingAcquires()),c.default.info("Connection pool status:",e)}await e.raw("SELECT 1"),c.default.info("Database connection successful")}catch(e){throw c.default.error("Database connection failed",{error:e.message,stack:e.stack,code:e.code,errno:e.errno}),e}}async initialize(){await this.initKnexOnly(),this.migrationManager=new p.KnexMigrationManager(this.knex),await this.runMigrations()}async runMigrations(){try{const e=await this.migrationManager.runMigrations();c.default.info(`Ran ${e.length} migrations`)}catch(e){throw c.default.error("Error running database migrations",e),e}}async close(){c.default.info("Closing data source..."),this.knex&&await this.knex.destroy(),c.default.info("Data source closed")}buildPaginationQuery(e,t){const r=(t.page-1)*t.limit;return`${e} LIMIT ${t.limit} OFFSET ${r}`}buildSortQuery(e,t){return`${e} ORDER BY ${t.field} ${t.order}`}setupQueryDebugListeners(){if(!this.knex)return void c.default.warn("Cannot set up query debug listeners: knex instance not initialized");"true"===process.env.EVE_SQL_QUERY_LOGGING?(c.default.info("SQL query logging is enabled"),this.knex.on("query",(e=>{e.queryId=(0,f.v4)(),e.startTime=Date.now();const t=this.dbDebugContextService?.getContext();t&&(t.queryId=e.queryId),l.debugLogger.log(`[Knex Query Start] ID: ${e.queryId}`,{sql:e.sql,bindings:e.bindings,operationId:t?.operationId,operationName:t?.operationName,taskId:t?.taskId})})),this.knex.on("query-response",((e,t)=>{const r=t.startTime?Date.now()-t.startTime:-1,o=this.dbDebugContextService?.getContext();l.debugLogger.log(`[Knex Query Success] ID: ${t.queryId} (Duration: ${r}ms)`,{operationId:o?.operationId,operationName:o?.operationName,taskId:o?.taskId})})),this.knex.on("query-error",((e,t)=>{const r=t.startTime?Date.now()-t.startTime:-1,o=this.dbDebugContextService?.getContext(),n=e.message.includes("SQLITE_BUSY")||e.message.includes("database is locked");if(c.default.error(`[Knex Query Error] ID: ${t.queryId} (Duration: ${r}ms)${n?" - DATABASE LOCKED!":""}`,{error:e.message,code:e.code,errno:e.errno,sql:t.sql,bindings:t.bindings,operationId:o?.operationId,operationName:o?.operationName,taskId:o?.taskId}),n&&this.dbDebugContextService){const e=this.dbDebugContextService.getActiveContexts();c.default.error("[Knex Query Error] DATABASE LOCKED! Active DB contexts potentially holding lock:",e.map((e=>({opId:e.operationId,name:e.operationName,taskId:e.taskId,ageMs:Date.now()-e.startTime,currentQueryId:e.queryId}))))}})),c.default.info("Knex query debug listeners set up successfully")):c.default.info("SQL query logging is disabled. Set EVE_SQL_QUERY_LOGGING=true to enable.")}}t.AppDataSource=h;let m=null;t.getAppDataSource=async()=>(null===m?(c.default.info("Creating new AppDataSource instance..."),m=new h,await m.initialize()):c.default.info("Returning existing AppDataSource instance..."),m)},72873:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MultilineToolCallingScheme=void 0;const o=r(56511);class n extends o.ToolCallingScheme{getSystemPrompt(e,t){return`\n\nYou are an AI being used as part of an agent to help implement the user's request.\nYou are one part of a multi-step process and you are operating in a loop.\nEach response should be targeted to provide some feedback to the user about what is happening now, but mostly it needs to instruct the agent on what to do next.\n\nThe general format for your responses is:\n\n<free text describing what our plan is>\n\n<<<<< NEXT_ACTION next_action >>>>> (where next_action is one of: call_tools, continue, finish)\n\nWhen you need to use a tool, use the following format embedded in your response:\n\n<<<<< NEXT_ACTION next_action >>>>>\n\n<<<<< TOOL CALL tool_name\n<<<<< arg_name_1\n(argument value 1)\n<<<<< arg_name_2\n(argument value 2)\n...\n>>>>> TOOL CALL END\n\n- **next_action** can be one of: \`call_tools\`, \`continue\`, or \`finish\`.\n  - Use \`call_tools\` if you expect the agent to execute the tools you've specified.\n  - Use \`continue\` if you want to proceed without tool execution and control will return to you.\n  - Use \`finish\` when you have completed all tasks or if you need more information from the user and you want to return control to them.\n- Start the next action line with \`<<<<< NEXT_ACTION next_action >>>>>\`.\n- If you are calling tools, include the tool calls as specified.\n- IMPORTANT: Just do one step at a time, ask for a tool call and wait for the response before asking for another tool call (or continuing/finishing).\n\nAvailable Tools:\n\n${this.getToolInstructions(t)}\n\nRemember:\n\n- **Use the exact argument names as specified for each tool.**\n- **Do not include any JSON or markdown formatting in your response.**\n- **Provide code snippets or text exactly as needed, without worrying about escaping.**\n- **Only use tools when necessary.**\n\n---\n\nExamples:\n\n1a. **Using \`update_file\` to update an existing file and specifying \`call_tools\`:**\n\nI need to update the file to replace certain code.\n\n<<<<< NEXT_ACTION call_tools >>>>>\n\n<<<<< TOOL CALL update_file\n<<<<< filePath\n/src/utils/math.js\n<<<<< search\nfunction add(a, b) {\n  return a + b;\n}\n<<<<< replace\nfunction add(a, b) {\n  return a - b;\n}\n>>>>> TOOL CALL END\n\n1b. **Using \`update_file\` to create a new file and specifying \`call_tools\`:**\n\nOr another example when we are creating a new file:\n\n<<<<< NEXT_ACTION call_tools >>>>>\n\n<<<<< TOOL CALL update_file\n<<<<< filePath\n/src/utils/math.js\n<<<<< search\n<<<<< replace\nfunction add(a, b) {\n  return a - b;\n}\n>>>>> TOOL CALL END\n\n2. **Continuing without tool execution (\`continue\`):**\n\nI will now proceed to document the changes made.\n\n<<<<< NEXT_ACTION continue >>>>>\n\n3. **Finishing the task (\`finish\`):**\n\nAll tasks are completed. Here's a summary of the changes made.\n\n<<<<< NEXT_ACTION finish >>>>>\n\n---\n\nNow, please proceed to assist the user with their request.\n`}parseLLMResponse(e){const t=this.extractNextAction(e),r=this.extractToolCalls(e);return{response:e.replace(/<<<<< NEXT_ACTION.*?>>>>>>/gs,"").replace(/<<<<< TOOL CALL.*?>>>>> TOOL CALL END/gs,"").trim(),tool_calls:r,next:t}}getToolInstructions(e){return e.map((e=>`Tool Name: ${e.name}\nDescription: ${e.description}\nUsage:\n<<<<< TOOL CALL ${e.name}\n${this.getToolArgumentsUsage(e)}\n>>>>> TOOL CALL END`)).join("\n\n")}getToolArgumentsUsage(e){const t=e.schema;if(!t||!t._def||"function"!=typeof t._def.shape)return"(No parameters required)";try{const e=t._def.shape();return e&&"object"==typeof e?Object.keys(e).map((e=>`<<<<< ${e}\n(value for ${e})`)).join("\n"):"(No parameters required)"}catch(e){return"(Error reading tool parameters)"}}extractNextAction(e){const t=e.match(/<<<<< NEXT_ACTION (\w+) >>>>>/);if(t){const e=t[1];if(["call_tools","continue","finish"].includes(e))return e}return"continue"}extractToolCalls(e){const t=[],r=/<<<<< TOOL CALL (\w+)[\s\S]*?>>>>> TOOL CALL END/g;let o;for(;null!==(o=r.exec(e));){const e=o[1],r=o[0],n=this.extractArgs(r);t.push({tool_name:e,args:n})}return t}extractArgs(e){const t={},r=/<<<<< (\w+)\n([\s\S]*?)(?=(<<<<< \w+|>>>>> TOOL CALL END))/g;let o;for(;null!==(o=r.exec(e));){const e=o[1],r=o[2].trim();t[e]=r}return t}}t.MultilineToolCallingScheme=n},72923:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CurrentTimestamp=void 0;const o=r(77773);class n extends o.Tool{constructor(){super(...arguments),this.name="current_timestamp",this.description="Returns the current timestamp in epoch milliseconds and ISO format"}async _call(){const e=new Date,t=e.getTime(),r=e.toISOString();return JSON.stringify({epochMillis:t,isoFormat:r})}}t.CurrentTimestamp=n},73024:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UnauthorizedError=void 0,t.auth=async function(e,{serverUrl:t,authorizationCode:r}){const o=await c(t);let n=await Promise.resolve(e.clientInformation());if(!n){if(void 0!==r)throw new Error("Existing OAuth client information is required when exchanging an authorization code");if(!e.saveClientInformation)throw new Error("OAuth client information must be saveable for dynamic registration");const s=await p(t,{metadata:o,clientMetadata:e.clientMetadata});await e.saveClientInformation(s),n=s}if(void 0!==r){const s=await e.codeVerifier(),i=await d(t,{metadata:o,clientInformation:n,authorizationCode:r,codeVerifier:s,redirectUri:e.redirectUrl});return await e.saveTokens(i),"AUTHORIZED"}const s=await e.tokens();if(null==s?void 0:s.refresh_token)try{const r=await u(t,{metadata:o,clientInformation:n,refreshToken:s.refresh_token});return await e.saveTokens(r),"AUTHORIZED"}catch(e){console.error("Could not refresh OAuth tokens:",e)}const{authorizationUrl:i,codeVerifier:a}=await l(t,{metadata:o,clientInformation:n,redirectUrl:e.redirectUrl});return await e.saveCodeVerifier(a),await e.redirectToAuthorization(i),"REDIRECT"},t.discoverOAuthMetadata=c,t.startAuthorization=l,t.exchangeAuthorization=d,t.refreshAuthorization=u,t.registerClient=p;const n=o(r(60383)),s=r(10815),i=r(69250);class a extends Error{constructor(e){super(null!=e?e:"Unauthorized")}}async function c(e,t){var r;const o=new URL("/.well-known/oauth-authorization-server",e);let n;try{n=await fetch(o,{headers:{"MCP-Protocol-Version":null!==(r=null==t?void 0:t.protocolVersion)&&void 0!==r?r:s.LATEST_PROTOCOL_VERSION}})}catch(e){if(!(e instanceof TypeError))throw e;n=await fetch(o)}if(404!==n.status){if(!n.ok)throw new Error(`HTTP ${n.status} trying to load well-known OAuth metadata`);return i.OAuthMetadataSchema.parse(await n.json())}}async function l(e,{metadata:t,clientInformation:r,redirectUrl:o}){const s="code",i="S256";let a;if(t){if(a=new URL(t.authorization_endpoint),!t.response_types_supported.includes(s))throw new Error(`Incompatible auth server: does not support response type ${s}`);if(!t.code_challenge_methods_supported||!t.code_challenge_methods_supported.includes(i))throw new Error(`Incompatible auth server: does not support code challenge method ${i}`)}else a=new URL("/authorize",e);const c=await(0,n.default)(),l=c.code_verifier,d=c.code_challenge;return a.searchParams.set("response_type",s),a.searchParams.set("client_id",r.client_id),a.searchParams.set("code_challenge",d),a.searchParams.set("code_challenge_method",i),a.searchParams.set("redirect_uri",String(o)),{authorizationUrl:a,codeVerifier:l}}async function d(e,{metadata:t,clientInformation:r,authorizationCode:o,codeVerifier:n,redirectUri:s}){const a="authorization_code";let c;if(t){if(c=new URL(t.token_endpoint),t.grant_types_supported&&!t.grant_types_supported.includes(a))throw new Error(`Incompatible auth server: does not support grant type ${a}`)}else c=new URL("/token",e);const l=new URLSearchParams({grant_type:a,client_id:r.client_id,code:o,code_verifier:n,redirect_uri:String(s)});r.client_secret&&l.set("client_secret",r.client_secret);const d=await fetch(c,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:l});if(!d.ok)throw new Error(`Token exchange failed: HTTP ${d.status}`);return i.OAuthTokensSchema.parse(await d.json())}async function u(e,{metadata:t,clientInformation:r,refreshToken:o}){const n="refresh_token";let s;if(t){if(s=new URL(t.token_endpoint),t.grant_types_supported&&!t.grant_types_supported.includes(n))throw new Error(`Incompatible auth server: does not support grant type ${n}`)}else s=new URL("/token",e);const a=new URLSearchParams({grant_type:n,client_id:r.client_id,refresh_token:o});r.client_secret&&a.set("client_secret",r.client_secret);const c=await fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a});if(!c.ok)throw new Error(`Token refresh failed: HTTP ${c.status}`);return i.OAuthTokensSchema.parse(await c.json())}async function p(e,{metadata:t,clientMetadata:r}){let o;if(t){if(!t.registration_endpoint)throw new Error("Incompatible auth server: does not support dynamic client registration");o=new URL(t.registration_endpoint)}else o=new URL("/register",e);const n=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok)throw new Error(`Dynamic client registration failed: HTTP ${n.status}`);return i.OAuthClientInformationFullSchema.parse(await n.json())}t.UnauthorizedError=a},73388:(e,t)=>{"use strict";function r(e,r=!1){if(r)return t.DEFAULT_DIRECTORY_ICON;const n=o(e);return t.FILE_ICON_MAP[n]||t.DEFAULT_FILE_ICON}function o(e){const t=e.split(".");return t.length>1?t[t.length-1].toLowerCase():""}function n(e,t=!1){return t?"mdi-folder-outline":"mdi-file-document-outline"}Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_DIRECTORY_ICON=t.DEFAULT_FILE_ICON=t.FILE_ICON_MAP=void 0,t.getFileIcon=r,t.getFileExtension=o,t.getFileIconFromPath=function(e,t=!1){return r(e.split("/").pop()||e,t)},t.getSimpleFileIcon=n,t.getSimpleFileIconFromPath=function(e,t=!1){return n(e,t)},t.FILE_ICON_MAP={js:"mdi-language-javascript",ts:"mdi-language-typescript",html:"mdi-language-html5",css:"mdi-language-css3",vue:"mdi-vuejs",jsx:"mdi-react",tsx:"mdi-react",py:"mdi-language-python",java:"mdi-language-java",c:"mdi-language-c",cpp:"mdi-language-cpp",cs:"mdi-language-csharp",go:"mdi-language-go",rb:"mdi-language-ruby",php:"mdi-language-php",swift:"mdi-language-swift",kt:"mdi-language-kotlin",rs:"mdi-language-rust",dart:"mdi-language-dart",json:"mdi-code-json",xml:"mdi-xml",yml:"mdi-file-document-outline",yaml:"mdi-file-document-outline",sql:"mdi-database",md:"mdi-language-markdown",txt:"mdi-file-document-outline",svg:"mdi-file-image",png:"mdi-file-image",jpg:"mdi-file-image",jpeg:"mdi-file-image",gif:"mdi-file-image",pdf:"mdi-file-pdf-box",doc:"mdi-file-word",docx:"mdi-file-word",xls:"mdi-file-excel",xlsx:"mdi-file-excel",ppt:"mdi-file-powerpoint",pptx:"mdi-file-powerpoint",zip:"mdi-zip-box",rar:"mdi-zip-box",tar:"mdi-zip-box",gz:"mdi-zip-box",mp3:"mdi-file-music",mp4:"mdi-file-video",mov:"mdi-file-video",avi:"mdi-file-video"},t.DEFAULT_FILE_ICON="mdi-file-document-outline",t.DEFAULT_DIRECTORY_ICON="mdi-folder-outline"},73433:e=>{"use strict";e.exports=require("tree-sitter-python")},73569:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigController=void 0;const a=r(3563),c=r(9102),l=r(75870),d=r(58620),u=r(19668),p=r(56292),f=r(84105),h=r(43510),m=i(r(19055));let g=class{constructor(e,t,r,o,n,s){this.eveConfigService=e,this.llmMetadataService=t,this.userService=r,this.personaRegistry=o,this.modelHistoryService=n,this.personaAssemblerService=s,this.serviceName="ConfigController"}async getAllProviders(){try{const e=await this.eveConfigService.getAllProviders();return m.default.debug(`[${this.serviceName}] Successfully retrieved ${e.length} providers`),e}catch(e){throw m.default.error(`[${this.serviceName}] Failed to get providers: ${e.message}`,e.stack),new Error(`Failed to retrieve providers: ${e.message}`)}}async getModelsForProvider(e){try{const t=await this.eveConfigService.getModelsForProvider(e);return m.default.debug(`[${this.serviceName}] Successfully retrieved ${t.length} models for provider ${e}`),t}catch(t){throw m.default.error(`[${this.serviceName}] Failed to get models for provider ${e}: ${t.message}`,t.stack),new Error(`Failed to retrieve models for provider ${e}: ${t.message}`)}}async getAllModes(){try{const e=await this.eveConfigService.getAllModes();return m.default.debug(`[${this.serviceName}] Successfully retrieved ${e.length} agent modes`),e}catch(e){throw m.default.error(`[${this.serviceName}] Failed to get modes: ${e.message}`,e.stack),new Error(`Failed to retrieve agent modes: ${e.message}`)}}async getPersonaDetails(e,t){try{let t;try{t=(await this.userService.getCurrentUser()).userId}catch(e){m.default.debug(`[${this.serviceName}] No user authentication for persona details`)}const r=await this.personaRegistry.getPersona(e,t);if(!!this.personaRegistry.isSystemPersona(e)){const o=r.getAllToolNames(),n={workingDir:"/example/workspace",workspaceName:"example-workspace",user:{userId:t||"anonymous",email:"user@example.com"},osInfo:{platform:"example",release:"1.0.0",homeDir:"/home/user",shell:"/bin/bash"},currentMode:"act",currentTime:(new Date).toISOString(),contextSizeCategory:l.ContextSizeCategory.LARGE};let s="System prompt generation not available",i=[],a=[];try{const e=r.getConfiguration(),t=this.personaAssemblerService.getDefaultEnabledOptionalComponents(),o=this.personaAssemblerService.assemblePrompt(e,t,n);s=o.corePersonaPrompt,i=o.systemComponents,a=e.optionalComponents}catch(t){m.default.warn(`[${this.serviceName}] Failed to generate system prompt for persona ${e}: ${t.message}`)}return{id:r.getId(),name:r.getName(),systemPrompt:s,systemComponents:i,enabledTools:o,enabledOptionalComponents:a,isCustom:!1,isReadOnly:!0}}{const r=this.personaRegistry.customPersonaService;if(r&&t){const o=await r.findById(e,t);if(o)return{id:o.id,name:o.name,systemPrompt:o.systemPrompt,enabledTools:o.enabledTools,enabledOptionalComponents:o.enabledOptionalComponents,isCustom:!0,isReadOnly:!1,createdAt:o.createdAt,updatedAt:o.updatedAt}}}throw new Error("Persona not found")}catch(t){throw m.default.error(`[${this.serviceName}] Failed to get persona details for ${e}: ${t.message}`,t.stack),new Error(`Failed to retrieve persona details: ${t.message}`)}}async getSystemComponents(){try{const e=this.personaAssemblerService.getAllComponentsForUI();return m.default.debug(`[${this.serviceName}] Successfully retrieved ${e.length} system components`),e}catch(e){throw m.default.error(`[${this.serviceName}] Failed to get system components: ${e.message}`,e.stack),new Error(`Failed to retrieve system components: ${e.message}`)}}async getAllPersonas(e){try{let e;try{e=(await this.userService.getCurrentUser()).userId}catch(e){m.default.debug(`[${this.serviceName}] No user authentication, returning only system personas`)}const t=(await this.personaRegistry.getAllPersonas(e)).map((e=>{const t=!this.personaRegistry.isSystemPersona(e.getId());return{id:e.getId(),name:e.getName(),isCustom:t,isReadOnly:!t,toolCount:e.getAllToolNames().length}}));return t.some((e=>"software-engineer"===e.id))||(m.default.warn(`[${this.serviceName}] software-engineer persona not found in registry, adding fallback`),t.unshift({id:"software-engineer",name:"Software Engineer",isCustom:!1,isReadOnly:!0})),m.default.debug(`[${this.serviceName}] Successfully retrieved ${t.length} personas for user: ${e||"anonymous"}`),t}catch(e){return m.default.error(`[${this.serviceName}] Failed to get personas: ${e.message}`,e.stack),m.default.warn(`[${this.serviceName}] Returning fallback personas due to error`),[{id:"software-engineer",name:"Software Engineer",isCustom:!1,isReadOnly:!0}]}}async getUserConfiguration(e){try{const e=await this.userService.getCurrentUser(),t=await this.eveConfigService.getUserConfiguration(e.userId);return m.default.debug(`[${this.serviceName}] Successfully retrieved configuration for user ${e.userId}`),t}catch(e){if(e instanceof u.AuthenticationError)throw m.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw m.default.error(`[${this.serviceName}] Failed to get user configuration: ${e.message}`,e.stack),new Error(`Failed to retrieve user configuration: ${e.message}`)}}async setActiveProviderForMode(e,t,r){try{const e=await this.userService.getCurrentUser();return await this.eveConfigService.setActiveProviderForMode(e.userId,t,r.activeProviderId),m.default.debug(`[${this.serviceName}] Successfully set active provider ${r.activeProviderId} for mode ${t} and user ${e.userId}`),await this.eveConfigService.getUserConfiguration(e.userId)}catch(e){if(e instanceof u.AuthenticationError)throw m.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw m.default.error(`[${this.serviceName}] Failed to set active provider for mode ${t}: ${e.message}`,e.stack),new Error(`Failed to set active provider for mode ${t}: ${e.message}`)}}async updateUserModeConfiguration(e,t,r,o){try{const e=await this.userService.getCurrentUser();if(await this.eveConfigService.updateUserModeConfiguration(e.userId,t,r,o),m.default.debug(`[${this.serviceName}] Successfully updated configuration for user ${e.userId}, mode ${t}, and provider ${r}`),o.apiKey)try{await this.shareApiKeyAcrossModes(e.userId,r,o.apiKey,o.baseUrl),m.default.debug(`[${this.serviceName}] Shared API key for provider ${r} across all modes`)}catch(e){m.default.error(`[${this.serviceName}] Error sharing API key: ${e.message}`,e.stack)}return await this.eveConfigService.getUserConfiguration(e.userId)}catch(e){if(e instanceof u.AuthenticationError)throw m.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw m.default.error(`[${this.serviceName}] Failed to update user configuration for mode ${t} and provider ${r}: ${e.message}`,e.stack),new Error(`Failed to update configuration for mode ${t} and provider ${r}: ${e.message}`)}}async refreshModelsForProvider(e,t,r){try{const e=await this.userService.getCurrentUser();m.default.debug(`[${this.serviceName}] Refreshing models for provider ${t}`);let o=r.apiKey;if(!o){m.default.debug(`[${this.serviceName}] No API key provided in request, checking user configuration`);const r=await this.eveConfigService.findApiKeyForProvider(e.userId,t);r&&r.apiKey&&(o=r.apiKey,m.default.debug(`[${this.serviceName}] Using API key from user configuration`))}await this.llmMetadataService.refreshModelsForProvider(t,o,r.baseUrl),m.default.debug(`[${this.serviceName}] Successfully refreshed models for provider ${t}`);const n=await this.eveConfigService.getModelsForProvider(t);return m.default.debug(`[${this.serviceName}] Returning ${n.length} models for provider ${t}`),n}catch(e){if(e instanceof u.AuthenticationError)throw m.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw m.default.error(`[${this.serviceName}] Failed to refresh models for provider ${t}: ${e.message}`,e.stack),new Error(`Failed to refresh models for provider ${t}: ${e.message}`)}}async shareApiKeyAcrossModes(e,t,r,o){try{m.default.debug(`[${this.serviceName}] Sharing API key for provider ${t} across all modes for user ${e}`);const n=await this.eveConfigService.getAllModes(),s=await this.eveConfigService.getUserConfiguration(e);for(const i of n){const n=s[i.modeId],a=n?.providerSettings[t];a?.isApiKeySet?m.default.debug(`[${this.serviceName}] Skipped updating API key for user ${e}, mode ${i.modeId}, provider ${t} (already set)`):(await this.eveConfigService.updateUserModeConfiguration(e,i.modeId,t,{apiKey:r,baseUrl:o}),m.default.debug(`[${this.serviceName}] Set API key for user ${e}, mode ${i.modeId}, provider ${t}`))}m.default.debug(`[${this.serviceName}] Successfully shared API key for provider ${t} across modes that didn't have one set`)}catch(e){throw m.default.error(`[${this.serviceName}] Error sharing API key: ${e.message}`,e.stack),e}}async getModelHistory(e,t){try{const e=await this.userService.getCurrentUser();if(!["plan","act"].includes(t))throw new Error('Invalid mode specified. Must be "plan" or "act".');const r=await this.modelHistoryService.getModelHistory(e.userId,t);return m.default.debug(`[${this.serviceName}] Successfully retrieved model history for user ${e.userId}, mode ${t}`),r}catch(e){if(e instanceof u.AuthenticationError)throw m.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw m.default.error(`[${this.serviceName}] Failed to get model history for mode ${t}: ${e.message}`,e.stack),new Error(`Failed to retrieve model history for mode ${t}: ${e.message}`)}}};t.ConfigController=g,o([(0,a.Get)("providers"),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],g.prototype,"getAllProviders",null),o([(0,a.Get)("providers/:providerId/models"),s(0,(0,a.Param)("providerId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],g.prototype,"getModelsForProvider",null),o([(0,a.Get)("modes"),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],g.prototype,"getAllModes",null),o([(0,a.Get)("personas/:id"),s(0,(0,a.Param)("id")),s(1,(0,a.Req)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],g.prototype,"getPersonaDetails",null),o([(0,a.Get)("personas/components"),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],g.prototype,"getSystemComponents",null),o([(0,a.Get)("personas"),s(0,(0,a.Req)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],g.prototype,"getAllPersonas",null),o([(0,a.Get)("user"),s(0,(0,a.Req)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],g.prototype,"getUserConfiguration",null),o([(0,a.Put)("user/modes/:modeId"),s(0,(0,a.Req)()),s(1,(0,a.Param)("modeId")),s(2,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object,String,Object]),n("design:returntype",Promise)],g.prototype,"setActiveProviderForMode",null),o([(0,a.Put)("user/modes/:modeId/providers/:providerId"),s(0,(0,a.Req)()),s(1,(0,a.Param)("modeId")),s(2,(0,a.Param)("providerId")),s(3,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object,String,String,Object]),n("design:returntype",Promise)],g.prototype,"updateUserModeConfiguration",null),o([(0,a.Post)("providers/:providerId/refresh-models"),s(0,(0,a.Req)()),s(1,(0,a.Param)("providerId")),s(2,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object,String,Object]),n("design:returntype",Promise)],g.prototype,"refreshModelsForProvider",null),o([(0,a.Get)("user/model-history/:modeId"),s(0,(0,a.Req)()),s(1,(0,a.Param)("modeId")),n("design:type",Function),n("design:paramtypes",[Object,String]),n("design:returntype",Promise)],g.prototype,"getModelHistory",null),t.ConfigController=g=o([(0,a.Controller)("eve/config"),n("design:paramtypes",[c.EveConfigService,d.LlmMetadataService,u.UserService,p.PersonaRegistry,f.ModelHistoryService,h.PersonaAssemblerService])],g)},73690:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleAgentModule=void 0;const n=r(3563),s=r(45873),i=r(23880),a=r(84193),c=r(29161);let l=class{};t.SimpleAgentModule=l,t.SimpleAgentModule=l=o([(0,n.Module)({imports:[s.WorkspaceModule,i.SessionModule,a.HomeModule,c.ChatCompletionModule],exports:[]})],l)},73864:e=>{"use strict";e.exports=require("command-exists")},74437:e=>{"use strict";e.exports=require("socket.io")},74476:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},74623:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Dataset=void 0;const o=r(59100);t.Dataset=class{constructor(e,t,r=(0,o.ulid)(),n=new Date){this.id=r,this.name=e,this.baseDir=t,this.createdAt=n}}},74650:e=>{"use strict";e.exports=require("adm-zip")},74717:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceRepository=void 0;const i=r(3563);r(31832);let a=class{constructor(e){this.knex=e}async findAll(e){let t=this.knex("workspaces").select("*");return void 0!==e&&(t=t.where("isTemp",e)),t}async findByName(e){return this.knex("workspaces").where("name",e).first()}async findById(e){return this.knex("workspaces").where("id",e).first()}async create(e){const t={...e};e.portFromBaseDir||delete t.portFromBaseDir,await this.knex("workspaces").insert(e)}async update(e,t){await this.knex("workspaces").where("name",e).update(t)}async delete(e){await this.knex("workspaces").where("name",e).delete()}async updateLastAccessedAt(e){await this.knex("workspaces").where("name",e).update("lastAccessedAt",this.knex.fn.now())}async findUnlockedTempWorkspaceByRemoteUrl(e){return this.knex("workspaces").where({remoteRepoUrl:e,isTemp:!0,isLocked:!1}).orderBy("lastAccessedAt","desc").first()}};t.WorkspaceRepository=a,t.WorkspaceRepository=a=o([(0,i.Injectable)(),s(0,(0,i.Inject)("KNEX")),n("design:paramtypes",[Function])],a)},75028:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseProviderErrorMapper=void 0;t.BaseProviderErrorMapper=class{getProviderName(){return this.providerName}extractStatusCode(e){return e?.statusCode||e?.status||e?.response?.status}extractMessage(e){return e?.message||e?.error?.message||e?.response?.data?.message||"Unknown error occurred"}extractCode(e){return e?.code||e?.error?.type||e?.response?.data?.code}isRetriableStatusCode(e){return!!e&&(429===e||e>=500&&e<600)}}},75056:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StoredFileController=void 0;const i=r(3563),a=r(49556),c=r(47205);let l=class{constructor(e){this.storedFileService=e}async uploadFile(e,t,r){return this.storedFileService.uploadFile(e,t,r)}async getFileContent(e,t){const r=await this.storedFileService.getFile(e);r?(t.setHeader("Content-Type",r.mimeType),t.setHeader("Content-Disposition",`attachment; filename="${r.originalFilename}"`),t.send(r.fileContents)):t.status(404).send("File not found")}async getFile(e){return this.storedFileService.getFileMetadata(e)}async getAllFiles(){return this.storedFileService.getAllFiles()}async deleteFile(e){await this.storedFileService.deleteFile(e)}async getFilesBySessionId(e){return this.storedFileService.getFilesBySessionId(e)}async getFilesByWorkspaceName(e){return this.storedFileService.getFilesByWorkspaceName(e)}};t.StoredFileController=l,o([(0,i.Post)("upload"),(0,i.UseInterceptors)((0,a.FileInterceptor)("file")),s(0,(0,i.UploadedFile)()),s(1,(0,i.Query)("sessionId")),s(2,(0,i.Query)("workspaceName")),n("design:type",Function),n("design:paramtypes",[Object,String,String]),n("design:returntype",Promise)],l.prototype,"uploadFile",null),o([(0,i.Get)(":id/content"),s(0,(0,i.Param)("id")),s(1,(0,i.Res)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],l.prototype,"getFileContent",null),o([(0,i.Get)(":id"),s(0,(0,i.Param)("id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],l.prototype,"getFile",null),o([(0,i.Get)(),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],l.prototype,"getAllFiles",null),o([(0,i.Delete)(":id"),s(0,(0,i.Param)("id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],l.prototype,"deleteFile",null),o([(0,i.Get)("session/:sessionId"),s(0,(0,i.Param)("sessionId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],l.prototype,"getFilesBySessionId",null),o([(0,i.Get)("workspace/:workspaceName"),s(0,(0,i.Param)("workspaceName")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],l.prototype,"getFilesByWorkspaceName",null),t.StoredFileController=l=o([(0,i.Controller)("stored-files"),n("design:paramtypes",[c.StoredFileService])],l)},75870:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ContextSizeCategory=void 0,t.getContextSizeCategory=function(e){if(e<32e3)return r.SMALL;if(e<1e5)return r.MEDIUM;return r.LARGE},t.getFileLimitsForContextSize=function(e){switch(e){case r.SMALL:return{maxFiles:15,maxTokens:5e3,maxRecentFiles:8,maxDirectories:20};case r.MEDIUM:return{maxFiles:60,maxTokens:3e4,maxRecentFiles:15,maxDirectories:50};case r.LARGE:return{maxFiles:100,maxTokens:5e4,maxRecentFiles:25,maxDirectories:-1}}},function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large"}(r||(t.ContextSizeCategory=r={}))},76134:e=>{"use strict";e.exports=require("@nestjs/websockets")},76297:e=>{"use strict";e.exports=require("tree-sitter-c-sharp")},76446:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(46410);class n extends TransformStream{constructor({onError:e,onRetry:t,onComment:r}={}){let n;super({start(s){n=o.createParser({onEvent:e=>{s.enqueue(e)},onError(t){"terminate"===e?s.error(t):"function"==typeof e&&e(t)},onRetry:t,onComment:r})},transform(e){n.feed(e)}})}}t.ParseError=o.ParseError,t.EventSourceParserStream=n},76552:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetModule=void 0;const n=r(3563),s=r(376),i=r(14632),a=r(8077),c=r(77184),l=r(26932),d=r(18460),u=r(26696),p=r(57967);let f=class{};t.DatasetModule=f,t.DatasetModule=f=o([(0,n.Module)({imports:[s.DataSourceModule,p.ConfigModule],controllers:[i.DatasetController],providers:[a.DatasetService,c.DatasetRepository,l.DatasetDocumentRepository,d.DatasetIndexingService,u.DatasetRetrievalService],exports:[a.DatasetService,u.DatasetRetrievalService]})],f)},76610:e=>{"use strict";e.exports=require("is-zip")},76662:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectiveComponent=void 0;t.ObjectiveComponent=class{constructor(){this.id="objective",this.name="Agent Objective",this.description="Methodical problem-solving approach and task completion guidelines",this.category="optional",this.canOptOut=!0,this.defaultEnabled=!0}getContent(e){return"OBJECTIVE\n\nYou accomplish a given task iteratively, breaking it down into clear steps and working through them methodically.\n\n1. Analyze the user's task and set clear, achievable goals to accomplish it. Prioritize these goals in a logical order.\n2. Work through these goals sequentially, utilizing available tools one at a time as necessary. Each goal should correspond to a distinct step in your problem-solving process. You will be informed on the work completed and what's remaining as you go.\n3. Remember, you have extensive capabilities with access to a wide range of tools that can be used in powerful and clever ways as necessary to accomplish each goal. Before calling a tool, do some analysis within <thinking></thinking> tags. First, analyze the file structure provided in environment_details to gain context and insights for proceeding effectively. Then, think about which of the provided tools is the most relevant tool to accomplish the user's task. Next, go through each of the required parameters of the relevant tool and determine if the user has directly provided or given enough information to infer a value. When deciding if the parameter can be inferred, carefully consider all the context to see if it supports a specific value. If all of the required parameters are present or can be reasonably inferred, close the thinking tag and proceed with the tool use. BUT, if one of the values for a required parameter is missing, DO NOT invoke the tool (not even with fillers for the missing params) and instead, ask the user to provide the missing parameters using the ask_followup_question tool. DO NOT ask for more information on optional parameters if it is not provided.\n4. Once you've completed the user's task, you must use the attempt_completion tool to present the result of the task to the user. You may also provide a CLI command to showcase the result of your task; this can be particularly useful for web development tasks, where you can run e.g. `open index.html` to show the website you've built.\n5. The user may provide feedback, which you can use to make improvements and try again. But DO NOT continue in pointless back and forth conversations, i.e. don't end your responses with questions or offers for further assistance."}}},76910:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigPropNames=void 0;class r{}t.ConfigPropNames=r,r.EVE_API_KEY="EVE_API_KEY",r.GOOGLE_API_KEY="GOOGLE_API_KEY",r.DEFAULT_CODING_MODEL="DEFAULT_CODING_MODEL",r.DEFAULT_REASONING_MODEL="DEFAULT_REASONING_MODEL",r.DEFAULT_SUMMARISATION_MODEL="DEFAULT_SUMMARISATION_MODEL",r.DEFAULT_RAG_QUERY_MODEL="DEFAULT_RAG_QUERY_MODEL",r.DEFAULT_ORCHESTRATION_MODEL="DEFAULT_ORCHESTRATION_MODEL",r.DEFAULT_ARCHITECT_MODEL="DEFAULT_ARCHITECT_MODEL",r.PRIVATE_CODING_MODEL="PRIVATE_CODING_MODEL",r.PRIVATE_REASONING_MODEL="PRIVATE_REASONING_MODEL",r.PRIVATE_SUMMARISATION_MODEL="PRIVATE_SUMMARISATION_MODEL",r.PRIVATE_RAG_QUERY_MODEL="PRIVATE_RAG_QUERY_MODEL",r.PRIVATE_ORCHESTRATION_MODEL="PRIVATE_ORCHESTRATION_MODEL",r.PRIVATE_ARCHITECT_MODEL="PRIVATE_ARCHITECT_MODEL",r.AGENT_RECURSION_LIMIT="AGENT_RECURSION_LIMIT",r.AGENT_ITERATION_LIMIT="AGENT_ITERATION_LIMIT",r.AGENT_SYSTEM_PROMPT="MAX_SYSTEM_PROMPT_LENGTH",r.OLLAMA_BASE_URL="OLLAMA_BASE_URL",r.MCP_SERVERS_ENABLED="MCP_SERVERS_ENABLED",r.MCP_SERVERS_DIRECTORY="MCP_SERVERS_DIRECTORY",r.VALUE_PER_LINE="VALUE_PER_LINE",r.ANTHROPIC_API_KEY="ANTHROPIC_API_KEY",r.OPENAI_API_KEY="OPENAI_API_KEY",r.FIREWORKS_API_KEY="FIREWORKS_API_KEY",r.GROQ_API_KEY="GROQ_API_KEY",r.HYPERBOLIC_API_KEY="HYPERBOLIC_API_KEY",r.MISTRAL_API_KEY="MISTRAL_API_KEY",r.OPENROUTER_API_KEY="OPENROUTER_API_KEY",r.GLHF_API_KEY="GLHF_API_KEY",r.DEEPSEEK_API_KEY="DEEPSEEK_API_KEY",r.LMSTUDIO_BASE_URL="LMSTUDIO_BASE_URL",r.LMSTUDIO_API_KEY="LMSTUDIO_API_KEY",r.SERP_API_KEY="SERP_API_KEY",r.MODE="MODE",r.COMMAND_OUTPUT_MAX_LENGTH="COMMAND_OUTPUT_MAX_LENGTH",r.COMMAND_OUTPUT_PREFIX_LENGTH="COMMAND_OUTPUT_PREFIX_LENGTH"},76946:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WriteToFileTool=void 0;const u=r(3563),p=c(r(91943)),f=d(r(19055)),h=c(r(16928)),m=r(20436),g=r(9581),y=r(4243),v=r(79616);let _=n=class extends m.BaseTool{constructor(e,t,r,o,n){super(o),this.name="write_to_file",this.description="Request to write content to a file at the specified path.",this.workingDir=e,this.fileValidationService=t,this.fileSystemEventService=r,this.currentMode=n}getFailureHandlingSuggestion(e){return e>=3?`The 'write_to_file' tool has failed ${e} times consecutively. Check that the path is valid and within the workspace, and that you have permission to write to the file. Also ensure that the content is properly formatted and doesn't contain any invalid characters.`:null}getBaseUsageInstructions(e){return`## write_to_file\nDescription: Request to write content to a file at the specified path. If the file exists, it will be overwritten with the provided content. If the file doesn't exist, it will be created. This tool will automatically create any directories needed to write the file.\nParameters:\n- path: (required) The path of the file to write to (relative to the current working directory ${e.workingDir})\n- content: (required) The content to write to the file. ALWAYS provide the COMPLETE intended content of the file, without any truncation or omissions. You MUST include ALL parts of the file, even if they haven't been modified.\nUsage:\n<write_to_file>\n<path>File path here</path>\n<content>\nYour file content here\n</content>\n</write_to_file>`}getModeSpecificGuidance(e){return"plan"===e?"PLAN MODE GUIDANCE:\n- Only update documentation files (e.g., .md, .txt).\n- Do NOT modify source code or configuration files in plan mode.\n- Use this to draft or update planning documents, requirement specifications, etc.":null}isDocumentationFile(e){const t=h.extname(e).toLowerCase();return[".md",".txt",".rst",".asciidoc",".adoc",".org"].includes(t)}validateParams(e){return"string"==typeof e.path&&""!==e.path.trim()&&"string"==typeof e.content}async execute(e){const{path:t}=e;if("plan"===this.currentMode&&!this.isDocumentationFile(t)){const e="WARNING: File write was not performed as we are currently in PLAN mode and should not be editing non-documentation files. Only .md, .txt, .rst, .asciidoc, .adoc, and .org files can be modified in PLAN mode.";return f.default.warn(`[${n.name}] ${e}`),e}let{content:r}=e;f.default.info(`[${n.name}] Writing to file: ${t} relative to ${this.workingDir}`);const o="<![CDATA[",s=r.trim();s.startsWith(o)&&s.endsWith("]]>")&&(f.default.warn(`[${n.name}] CDATA tags detected and stripped from content for file: ${t}`),r=s.substring(9,s.length-3).trim());const i=h.resolve(this.workingDir,t);if(!i.startsWith(this.workingDir)){const e=`Path traversal attempt detected: ${t} resolves outside of workspace ${this.workingDir}`;throw f.default.error(`[${n.name}] ${e}`),new g.FileSystemError(e,"PATH_TRAVERSAL_ERROR")}try{const e=await this.fileExists(i),o=h.dirname(i);await p.mkdir(o,{recursive:!0}),await p.writeFile(i,r,"utf8"),e?this.fileSystemEventService.emitFileCreated(this.workingDir,t):this.fileSystemEventService.emitFileModified(this.workingDir,t,"write"),f.default.info(`[${n.name}] File ${t} written successfully`);let s=`File ${t} written successfully`,a="";try{const e=await this.fileValidationService.validateFile(t,this.workingDir);e.hasErrors&&(a+="\n\nSyntax Validation Issues Found:",a+=`\n- ${e.report}`)}catch(e){f.default.error(`[${n.name}] Validation step failed for ${t}: ${e.message}`),a="\n\nNote: Syntax validation step encountered an error."}return s+=a,s}catch(e){const r=`Error writing to file ${t}: ${e.message}`;throw f.default.error(`[${n.name}] ${r}\n${e.stack}`),new g.FileSystemError(r,e.code||"FS_WRITE_ERROR")}}async fileExists(e){try{return await p.access(e),!1}catch{return!0}}};t.WriteToFileTool=_,t.WriteToFileTool=_=n=a([(0,u.Injectable)(),l("design:paramtypes",[String,y.FileValidationService,v.FileSystemEventService,Object,String])],_)},76982:e=>{"use strict";e.exports=require("crypto")},77078:e=>{"use strict";e.exports=require("fast-deep-equal")},77184:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetRepository=void 0;const i=r(3563);r(31832);let a=class{constructor(e){this.knex=e}async findAll(){return this.knex("datasets").select("*")}async findById(e){return this.knex("datasets").where("id",e).first()}async create(e){await this.knex("datasets").insert(e)}async update(e,t){await this.knex("datasets").where("id",e).update(t)}async delete(e){await this.knex("datasets").where("id",e).delete()}};t.DatasetRepository=a,t.DatasetRepository=a=o([(0,i.Injectable)(),s(0,(0,i.Inject)("KNEX")),n("design:paramtypes",[Function])],a)},77201:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(31321);const c=r(60818),l=r(16928),d=r(28781),u=r(40715),p=i(r(7252)),f=r(16928),h=a(r(19055)),m=r(99187);(0,c.config)({path:(0,l.resolve)(__dirname,"../.env")});const g=r(96297);"true"===process.env.EVE_DEBUG_LOGGING&&(g.debugLogger.enable(),h.default.info("Debug logging enabled via EVE_DEBUG_LOGGING=true")),"true"===process.env.EVE_SQL_QUERY_LOGGING&&h.default.info("SQL query logging enabled via EVE_SQL_QUERY_LOGGING=true"),async function(){(0,m.getDefaultKnexConfig)();const e=await d.NestFactory.create(u.AppModule);e.setGlobalPrefix("api"),e.enableCors({origin:["http://localhost:3011","http://localhost:3012","http://localhost:3013","http://localhost:3014"],methods:["GET","POST","PUT","PATCH","DELETE","OPTIONS"],allowedHeaders:"*",exposedHeaders:["Location"]}),e.use(p.json({limit:"100mb"})),e.use(p.urlencoded({limit:"100mb",extended:!0})),e.use(p.static((0,f.join)(__dirname,"webui"))),e.use("*",((e,t,r)=>{e.originalUrl.startsWith("/api")?r():t.sendFile((0,f.join)(__dirname,"webui","index.html"))}));const t=process.env.PORT||3010;await e.listen(t);const r=`http://localhost:${t}`;console.log(`\neve-server is now available at: ${r}`);const o=["SIGTERM","SIGINT"];for(const t of o)process.on(t,(async()=>{h.default.info(`Received ${t}. Starting graceful shutdown...`),await e.close(),h.default.info("Application shut down gracefully"),process.exit(0)}))}().catch((e=>{h.default.error("Error during application bootstrap:",e),process.exit(1)}))},77332:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.McpSettingsSchema=t.ServerConfigSchema=t.BaseConfigSchema=t.AutoApproveSchema=void 0;const o=r(11569);t.AutoApproveSchema=o.z.array(o.z.string()).default([]),t.BaseConfigSchema=o.z.object({autoApprove:t.AutoApproveSchema.optional(),disabled:o.z.boolean().optional().default(!1),timeout:o.z.number().min(10).optional().default(60)});t.ServerConfigSchema=o.z.union([t.BaseConfigSchema.extend({type:o.z.literal("stdio").optional().default("stdio"),command:o.z.string(),args:o.z.array(o.z.string()).optional(),cwd:o.z.string().optional(),env:o.z.record(o.z.string()).optional(),url:o.z.string().optional(),headers:o.z.record(o.z.string()).optional()}).transform((e=>({...e,type:"stdio"}))),t.BaseConfigSchema.extend({type:o.z.literal("sse").optional().default("sse"),url:o.z.string().url("URL must be a valid URL format"),headers:o.z.record(o.z.string()).optional(),command:o.z.string().optional(),args:o.z.array(o.z.string()).optional(),env:o.z.record(o.z.string()).optional()}).transform((e=>({...e,type:"sse"}))),t.BaseConfigSchema.extend({type:o.z.literal("streamableHttp").optional().default("streamableHttp"),url:o.z.string().url("URL must be a valid URL format"),headers:o.z.record(o.z.string()).optional(),command:o.z.string().optional(),args:o.z.array(o.z.string()).optional(),env:o.z.record(o.z.string()).optional()}).transform((e=>({...e,type:"streamableHttp"})))]),t.McpSettingsSchema=o.z.object({version:o.z.string().optional().default("1.0"),mcpServers:o.z.record(t.ServerConfigSchema)})},77403:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FileContentOptimizerService=void 0;const i=r(3563),a=s(r(19055)),c=r(44155);let l=class{constructor(e){this.responseFormatter=e}optimizeFileContent(e){if(e.length<=1)return e;const t=JSON.parse(JSON.stringify(e)),r={};t.forEach(((e,t)=>{for(const o of e.segments)if("text"===o.type){const e=this.extractFileContentPaths(o.content);for(const o of e)r[o]=t}}));for(let e=0;e<t.length;e++){const o=t[e];for(let n=0;n<o.segments.length;n++){const s=o.segments[n];"text"===s.type&&(t[e].segments[n].content=this.replaceOlderFileContent(s.content,e,r))}}return t}extractFileContentPaths(e){const t=/<file_content path="([^"]+)">/g,r=[];let o;for(;null!==(o=t.exec(e));)r.push(o[1]);return r}replaceOlderFileContent(e,t,r){const o=/<file_content path="([^"]+)">([\s\S]*?)<\/file_content>/g;let n=e;const s=[];let i;for(;null!==(i=o.exec(e));){const e=i[1],o=i[0];if(r[e]===t)continue;const n=`<file_content path="${e}">${this.responseFormatter.duplicateFileReadNotice()}</file_content>`;s.push({original:o,replacement:n}),a.default.debug(`[FileContentOptimizerService] Replacing older file_content block for ${e} at index ${t}`)}for(const{original:e,replacement:t}of s)n=n.replace(e,t);return n}};t.FileContentOptimizerService=l,t.FileContentOptimizerService=l=o([(0,i.Injectable)(),n("design:paramtypes",[c.ResponseFormatterService])],l)},77510:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReportingService=void 0;const a=r(3563),c=(r(31832),i(r(19055))),l=r(52368),d=r(76910);let u=class{constructor(e,t){this.knex=e,this.configService=t}async generateReport(e,t,r,o){try{const{startDate:n,endDate:s}=this.resolveDateRange(e,t,r),i=await this.getRequestTotalsData(n,s,o);return{requestTotals:i,dailyMetrics:await this.getHistoricStats(n,s,o),dateRange:{startDate:n,endDate:s}}}catch(e){throw c.default.error(`Error generating report: ${e.message}`,e.stack),e}}resolveDateRange(e,t,r){const o=new Date;let n,s;try{if(e&&t)n=new Date(e),s=new Date(t),s.setHours(23,59,59,999);else if(r)switch(s=new Date(o),s.setHours(23,59,59,999),r){case"today":n=new Date(o),n.setHours(0,0,0,0);break;case"this-week":n=new Date(o),n.setDate(n.getDate()-7),n.setHours(0,0,0,0);break;case"this-month":n=new Date(o),n.setDate(n.getDate()-30),n.setHours(0,0,0,0);break;case"all-time":n=new Date(o),n.setDate(n.getDate()-90),n.setHours(0,0,0,0);break;default:throw new Error("Invalid period specified")}else n=new Date(o),n.setDate(n.getDate()-90),n.setHours(0,0,0,0),s=new Date(o),s.setHours(23,59,59,999);return{startDate:n,endDate:s}}catch(e){throw c.default.error(`Error resolving date range: ${e.message}`,e.stack),e}}async getRequestTotalsData(e,t,r){try{let o=this.knex("requests").select(this.knex.raw("COUNT(*) as totalRequests"),this.knex.raw("COALESCE(SUM(tookMillis), 0) as totalProcessingMillis"),this.knex.raw("COALESCE(AVG(tookMillis), 0) as avgProcessingMillis"),this.knex.raw("COALESCE(SUM(inputTokens), 0) as totalInputTokens"),this.knex.raw("COALESCE(SUM(outputTokens), 0) as totalOutputTokens"),this.knex.raw("COALESCE(SUM(totalTokens), 0) as totalTokens"),this.knex.raw("COALESCE(SUM(cost), 0) as totalCost"),this.knex.raw("COALESCE(AVG(cost), 0) as avgCostPerRequest"),this.knex.raw("COALESCE(SUM(CASE WHEN linesChanged <= 500 THEN linesChanged ELSE 0 END), 0) as totalLinesChanged"),this.knex.raw("COALESCE(AVG(CASE WHEN linesChanged <= 500 THEN linesChanged ELSE NULL END), 0) as avgLinesChangedPerRequest"),this.knex.raw("COALESCE(SUM(filesChanged), 0) as totalFilesChanged"),this.knex.raw("COALESCE(SUM(insertions), 0) as totalInsertions"),this.knex.raw("COALESCE(SUM(deletions), 0) as totalDeletions"),this.knex.raw("COALESCE(SUM(CASE WHEN linesChanged <= 500 THEN testLinesChanged ELSE 0 END), 0) as totalTestLinesChanged"),this.knex.raw("COALESCE(SUM(testFilesChanged), 0) as totalTestFilesChanged"),this.knex.raw("COALESCE(SUM(testInsertions), 0) as totalTestInsertions"),this.knex.raw("COALESCE(SUM(testDeletions), 0) as totalTestDeletions"),this.knex.raw("COALESCE(SUM(cacheReadTokens), 0) as totalCacheReadTokens"),this.knex.raw("COALESCE(SUM(cacheWriteTokens), 0) as totalCacheWriteTokens")).whereBetween("startedAt",[e,t]);r&&""!==r.trim()&&(o=o.where("workspaceName",r));const n=await o.first(),s=n.totalLinesChanged-n.totalTestLinesChanged,i=n.totalFilesChanged-n.totalTestFilesChanged,a=n.totalLinesChanged>0?n.totalCost/n.totalLinesChanged:0,c=this.configService.getNumericProperty(d.ConfigPropNames.VALUE_PER_LINE)||2.4,l=n.totalLinesChanged*c,u=n.totalRequests>0?l/n.totalRequests:0,p=n.totalInputTokens+n.totalCacheReadTokens>0?100*n.totalCacheReadTokens/(n.totalInputTokens+n.totalCacheReadTokens):0;return{totalRequests:n.totalRequests,totalProcessingMillis:n.totalProcessingMillis,avgProcessingMillis:n.avgProcessingMillis,totalInputTokens:n.totalInputTokens,totalOutputTokens:n.totalOutputTokens,totalTokens:n.totalTokens,totalCost:n.totalCost,avgCostPerRequest:n.avgCostPerRequest,avgCostPerLine:a,totalLinesChanged:n.totalLinesChanged,totalFilesChanged:n.totalFilesChanged,totalInsertions:n.totalInsertions,totalDeletions:n.totalDeletions,totalTestLinesChanged:n.totalTestLinesChanged,totalTestFilesChanged:n.totalTestFilesChanged,totalTestInsertions:n.totalTestInsertions,totalTestDeletions:n.totalTestDeletions,totalProductionLinesChanged:s,totalProductionFilesChanged:i,totalValueCreated:l,avgValueCreatedPerRequest:u,avgLinesChangedPerRequest:n.avgLinesChangedPerRequest,totalCacheReadTokens:n.totalCacheReadTokens,totalCacheWriteTokens:n.totalCacheWriteTokens,inputCacheHitPercentage:p}}catch(e){throw c.default.error(`Error getting request totals data: ${e.message}`,e.stack),e}}async getHistoricStats(e,t,r){try{let o=this.knex("requests").select(this.knex.raw("strftime('%Y-%m-%d', datetime(startedAt/1000, 'unixepoch')) as label"),this.knex.raw("COALESCE(SUM(CASE WHEN linesChanged <= 500 THEN linesChanged ELSE 0 END), 0) as linesChanged"),this.knex.raw("COALESCE(SUM(cost), 0) as cost"),this.knex.raw("COUNT(*) as requests"),this.knex.raw("COALESCE(SUM(tookMillis), 0) as processingTime")).whereBetween("startedAt",[e,t]);r&&""!==r.trim()&&(o=o.where("workspaceName",r)),o=o.groupBy("label").orderBy("label","asc"),c.default.debug(`Query: ${o.toString()}`);const n=await o,s=this.configService.getNumericProperty(d.ConfigPropNames.VALUE_PER_LINE)||2.4;return n.map((e=>({label:e.label,linesChanged:e.linesChanged,cost:e.cost,valueCreated:e.linesChanged*s,requests:e.requests,processingTime:e.processingTime})))}catch(e){throw c.default.error(`Error getting historic stats: ${e.message}`,e.stack),e}}};t.ReportingService=u,t.ReportingService=u=o([(0,a.Injectable)(),s(0,(0,a.Inject)("KNEX")),n("design:paramtypes",[Function,l.ConfigService])],u)},77598:e=>{"use strict";e.exports=require("node:crypto")},77602:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.MutationsService=void 0;const s=r(3563),i=r(90672);let a=class{constructor(e){this.mutationRepository=e}async getMutationsForSession(e){return(await this.mutationRepository.findBySessionId(e,void 0,{field:"updatedAt",order:"DESC"})).map((e=>({id:e.id,type:e.type,filePath:e.filePath,updatedAt:e.updatedAt,description:e.description,fileContentsBefore:e.fileContentsBefore,fileContentsAfter:e.fileContentsAfter,requestId:e.requestId})))}async getMutation(e){return this.mutationRepository.findById(e)}async getMutationsForRequest(e){return(await this.mutationRepository.findByRequestId(e)).map((e=>({id:e.id,type:e.type,filePath:e.filePath,updatedAt:e.updatedAt,description:e.description,fileContentsBefore:e.fileContentsBefore,fileContentsAfter:e.fileContentsAfter,requestId:e.requestId})))}async createMutation(e){if(!e.sessionId)throw new Error("sessionId is required to create a mutation");if(!e.requestId)throw new Error("requestId is required to create a mutation");return await this.mutationRepository.create({...e,updatedAt:e.updatedAt||new Date})}};t.MutationsService=a,t.MutationsService=a=o([(0,s.Injectable)(),n("design:paramtypes",[i.MutationRepository])],a)},77773:e=>{"use strict";e.exports=require("langchain/tools")},78695:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TokenEstimator=void 0;const n=o(r(19055));class s{static estimateTextTokens(e){return e?Math.ceil(e.length/this.CHARS_PER_TOKEN_ESTIMATE):0}static estimateMessageTokens(e,t=!0){if(!e||!e.segments)return 0;let r=e.segments.reduce(((e,t)=>{switch(t.type){case"text":return e+this.estimateTextTokens(t.content);case"thinking":return e+this.estimateTextTokens(t.content)+30;case"image":return e+this.IMAGE_TOKEN_ESTIMATE;case"other":if("tool_use"===t.metadata?.providerSpecificType){return e+this.estimateTextTokens(t.content)+this.TOOL_CALL_OVERHEAD}return t.content&&"string"==typeof t.content?e+this.estimateTextTokens(t.content):e+this.estimateTextTokens(JSON.stringify(t));default:return t.content&&"string"==typeof t.content?e+this.estimateTextTokens(t.content):e+this.estimateTextTokens(JSON.stringify(t))}}),0);return t&&(r+=this.MESSAGE_FORMAT_OVERHEAD,"anthropic"===e.providerId&&e.providerMetadata&&(r+=this.CACHE_CONTROL_OVERHEAD)),r}static estimateInputTokens(e,t,r="anthropic"){let o=this.estimateTextTokens(e);"anthropic"===r&&(o+=this.SYSTEM_MESSAGE_OVERHEAD);const s=t.reduce(((e,t)=>e+this.estimateMessageTokens(t,!0)),0),i=o+s;return n.default.debug(`[TokenEstimator] Token estimation breakdown:\n  System prompt: ${this.estimateTextTokens(e)} + ${this.SYSTEM_MESSAGE_OVERHEAD} overhead = ${o}\n  Conversation: ${s} (${t.length} messages)\n  Total estimated: ${i}`),i}static getDetailedTokenBreakdown(e,t,r="anthropic"){const o=this.estimateTextTokens(e)+("anthropic"===r?this.SYSTEM_MESSAGE_OVERHEAD:0),n=t.map((e=>{const t=this.estimateMessageTokens(e,!0),r=this.getMessagePreview(e);return{id:e.id,role:e.role,tokens:t,preview:r}})),s=n.reduce(((e,t)=>e+t.tokens),0);return{systemTokens:o,messageBreakdown:n,totalTokens:o+s}}static getMessagePreview(e){const t=[e.segments.filter((e=>"text"===e.type)).map((e=>e.content)).join(" "),e.segments.filter((e=>"text"!==e.type)).map((e=>`[${e.type}]`)).join(" ")].filter(Boolean).join(" ");return t.length>200?t.substring(0,200)+"...":t}static calculateDynamicMaxTokens(e,t,r,o,s=.15,i="anthropic"){const a=this.estimateInputTokens(e,t,i),c=r-a;if(c<=0)return n.default.warn(`[TokenEstimator] Input tokens (${a}) exceed or equal context window (${r}). Returning minimum output tokens.`),this.MIN_OUTPUT_TOKENS_GUARANTEE;const l="anthropic"===i?Math.max(s,.1):s,d=Math.ceil(c*l),u=c-d,p=Math.min(u,o);n.default.debug(`[TokenEstimator] Dynamic max tokens calculation:\n  Context window: ${r}\n  Estimated input tokens: ${a}\n  Remaining space: ${c}\n  Safety buffer (${(100*l).toFixed(1)}% of remaining): ${d}\n  Available for output: ${u}\n  Model max output: ${o}\n  Final dynamic max: ${Math.max(p,this.MIN_OUTPUT_TOKENS_GUARANTEE)}`),u<.5*o&&n.default.warn(`[TokenEstimator] Available output tokens (${u}) is less than 50% of model capacity (${o}). Consider context truncation. Input tokens: ${a}/${r}`);const f=a/r*100;return f>80&&n.default.warn(`[TokenEstimator] High context usage: ${f.toFixed(1)}% (${a}/${r} tokens). Consider context truncation to improve response quality.`),Math.max(p,this.MIN_OUTPUT_TOKENS_GUARANTEE)}}t.TokenEstimator=s,s.CHARS_PER_TOKEN_ESTIMATE=2.5,s.IMAGE_TOKEN_ESTIMATE=1568,s.MIN_OUTPUT_TOKENS_GUARANTEE=100,s.CACHE_CONTROL_OVERHEAD=50,s.MESSAGE_FORMAT_OVERHEAD=20,s.SYSTEM_MESSAGE_OVERHEAD=100,s.TOOL_CALL_OVERHEAD=50},78706:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIModelClient=void 0;const i=r(3563),a=r(81495),c=r(29265),l=r(82757),d=r(19612),u=r(23738),p=r(38182),f=r(42808),h=s(r(56082)),m=s(r(19055));let g=class{constructor(e,t){this.config=e,this.options=t,this.openai=new h.default({apiKey:this.config.apiKey,baseURL:this.config.baseUrl}),this.chunkAdapter=new c.OpenAIChunkAdapter,this.messageTransformer=new f.OpenAIMessageTransformer;const r=new d.UnifiedTagDetector,o=new u.ChunkBuffer(r),n=new p.SmartToolCallTracker;this.unifiedBlockProcessor=new l.UnifiedBlockProcessor(o,r,null,n),m.default.info(`[OpenAIModelClient] Initialized for model: ${this.config.modelId}`)}getModelId(){return this.config.modelId}getModelMetadata(){return this.modelMetadata?this.modelMetadata:(m.default.warn(`[OpenAIModelClient] Metadata not set for model ${this.config.modelId}`),{modelId:this.config.modelId,providerId:"openai",name:this.config.modelId,contextWindow:0,maxOutputTokens:4096,supportsImages:!1,supportsToolUse:!1,supportsComputerUse:!1})}setModelMetadata(e){this.modelMetadata=e,m.default.debug(`[OpenAIModelClient] Metadata set for model ${this.config.modelId}`)}getEffectiveMaxTokens(){const e=this.options?.maxOutputTokens,t=this.modelMetadata?.maxOutputTokens;if(e&&t&&e<t)return e;if(t)return t;throw new Error(`Model ${this.config.modelId} missing maxOutputTokens in metadata. Provider must ensure all models have this field populated.`)}async generateSimpleResponse(e,t,r={},o){m.default.info(`[OpenAIModelClient] Generating simple response for model: ${this.config.modelId}`),(0,a.validateSimpleResponseOptions)(r);const n=this.messageTransformer.toProviderFormat(t);e&&n.unshift({role:"system",content:e});const s=r.maxTokens||this.getEffectiveMaxTokens(),i={model:this.config.modelId,messages:n,stream:!1,max_tokens:s,temperature:r.temperature,top_p:r.topP,frequency_penalty:r.frequencyPenalty,presence_penalty:r.presencePenalty};this.config.draftModelId&&(i.draft_model=this.config.draftModelId,m.default.info(`[OpenAIModelClient] Using draft model for speculative decoding: ${this.config.draftModelId}`));const c=await this.openai.chat.completions.create(i,{signal:o,timeout:r.timeout}),l=c.choices[0];if(!l)throw new Error("No response choice returned from OpenAI");return{content:l.message?.content||"",usage:{inputTokens:c.usage?.prompt_tokens||0,outputTokens:c.usage?.completion_tokens||0},stopReason:(0,a.mapGenericStopReason)(l.finish_reason),finishReason:l.finish_reason||void 0,providerId:"openai",modelId:this.config.modelId,metadata:{model:c.model,created:c.created,systemFingerprint:c.system_fingerprint}}}async*generateResponse(e,t,r,o){m.default.info(`[OpenAIModelClient] Task ${r} for model ${this.config.modelId}: Starting generation`);const n={providerId:this.modelMetadata?.providerId||"openai",taskId:r,toolCallConfig:{enabled:this.modelMetadata?.supportsToolUse||!1,allowMixedContent:!0},thinkingTagConfig:{enabled:this.modelMetadata?.supportsThinkingTokens||!1,tagNames:["thinking","reasoning"],stripTags:!0},bufferConfig:this.options?.bufferConfig,debug:this.options?.enableVerboseLogging},s=this.generateNormalizedStream(e,t,r,o);yield*this.unifiedBlockProcessor.processNormalizedStream(s,n)}async*generateNormalizedStream(e,t,r,o){const n=this.messageTransformer.toProviderFormat(t);e&&n.unshift({role:"system",content:e});const s=this.getEffectiveMaxTokens(),i={model:this.config.modelId,messages:n,stream:!0,max_tokens:s};this.config.draftModelId&&(i.draft_model=this.config.draftModelId,m.default.info(`[OpenAIModelClient] Using draft model for speculative decoding: ${this.config.draftModelId}`));const a=await this.openai.chat.completions.create(i,{signal:o});for await(const e of a){const t=this.chunkAdapter.convertChunk(e);for(const e of t)yield e}}};t.OpenAIModelClient=g,t.OpenAIModelClient=g=o([(0,i.Injectable)(),n("design:paramtypes",[Object,Object])],g)},78882:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceFilesComponent=void 0;t.WorkspaceFilesComponent=class{constructor(){this.id="workspace-files",this.name="Workspace Files",this.description="Include workspace file listings, directory structure, and recent files",this.category="optional",this.canOptOut=!0,this.defaultEnabled=!0}getContent(e){return"{{WORKSPACE_FILES_PLACEHOLDER}}"}}},78910:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MistralProvider=void 0;const n=r(82196),s=r(48483),i=r(8959),a=r(52368),c=o(r(58938));class l extends s.BaseProvider{getName(){return"mistral"}getBaseChatModel(e,t){return new n.ChatMistralAI({modelName:this.shortModelName(e),temperature:t.temperature,apiKey:a.ConfigService.getInstance().getProperty("MISTRAL_API_KEY")})}async getModelDescriptors(){return(await this.fetchModels()).map((e=>{let t=1e-6,r=3e-6;return e.id.includes("large")?(t=7e-6,r=2e-5):e.id.includes("medium")&&(t=25e-7,r=7e-6),new i.ModelDescriptor("mistral",e.id,t,0,0,r)}))}isValid(){return!!a.ConfigService.getInstance().getProperty("MISTRAL_API_KEY")}async fetchModels(){if(l.modelsCache&&Date.now()-l.modelsCache.timestamp<l.CACHE_TTL)return l.modelsCache.models;const e=a.ConfigService.getInstance().getProperty("MISTRAL_API_KEY");if(!e)return console.log("Mistral API key not found"),[];try{const t=await c.default.get("https://api.mistral.ai/v1/models",{headers:{Authorization:`Bearer ${e}`}});if(200===t.status){const e=t.data.data||[];return l.modelsCache={models:e,timestamp:Date.now()},e}return console.log(`Failed to fetch Mistral models. Status code: ${t.status}`),[]}catch(e){return console.error(`Error fetching Mistral models: ${e}`),[]}}}t.MistralProvider=l,l.modelsCache=null,l.CACHE_TTL=3e5},78921:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EpicsPrompts=void 0;const c=r(6426),l=i(r(16928)),d=i(r(79896)),u=a(r(30526));t.EpicsPrompts=class{static async getEpicsTree(e){const t=l.join(e.workspace.repoBaseDir,"epics"),r=(0,u.default)();return d.existsSync(t)?(0,c.generateTreeRecursive)(t,r,t):(d.mkdirSync(t,{recursive:!0}),"└── (empty epics directory)")}static async existingEpicsAndStories(e){return`To work with epics in this workspace, you need to understand the file structure:\n\n${await this.getEpicsTree(e)}\n\nEach epic follows this structure:\nEPIC-XX_Name/\n  ├── requirements.md (contains epic title and description)\n  └── stories/\n      └── STORY-XX_Name/\n          ├── story.json (contains story details)\n          └── tasks/\n              └── TASK-XX_Name.json (individual task details)\n\nUse the read_file tool (e.g. path: ./epics/EPIC-XX_Name/requirements.md) to inspect these files and understand the current state of epics.`}static async updateEpicInstructions(e){return"To create or update an epic:\n\n1. For a new epic:\n   - Create a directory named EPIC-XX_Name (where XX is a sequential number and Name is a short title)\n   - Use update_file to create requirements.md in the epic directory with this structure:\n     # XX_Name\n     \n     ## Description\n     Epic description goes here\n     \n     ## Goals\n     - Add specific, measurable goals here\n     \n     ## Success Criteria\n     - List the criteria that define when this epic is complete\n\n2. For updating an existing epic:\n   - Use read_file to get the current requirements.md content\n   - Use update_file to update the requirements.md with the new content (path: ./epics/EPIC-XX_Name/requirements.md)\n   - Maintain the same format with title, description, goals, and success criteria sections\n\nThe epic directory should be under the workspace at: ./epics/EPIC-XX_Name/"}static async updateEpicStories(e){return'To create or update stories in an epic:\n\n1. For a new story:\n   - Create a directory named STORY-XX_Name under the epic\'s stories directory\n   - Use update_file to create story.json with this structure:\n     {\n       "id": "STORY-XX_Name",\n       "title": "Story Title",\n       "description": "Detailed story description",\n       "status": "backlog",\n       "createdAt": "<use current_timestamp>",\n       "updatedAt": "<use current_timestamp>",\n       "acceptanceCriteria": [\n         "AC01: Given a normal user, when they log in, then they should see a welcome message",\n         "AC02: Given an admin user, when they log in, then they should be taken to the admin dashboard"\n       ]\n     }\n\n2. For updating an existing story:\n   - Use read_file to get the current story.json content\n   - Use update_file to update the story.json with the new content\n   - Maintain all existing fields and update only what\'s changed\n   - Update the updatedAt timestamp using current_timestamp\n\nThe story file should be under the stories directory of the epic which is under the workspace at: ./epics/EPIC-XX_Name/stories/STORY-XX_Name/story.json\n\nValid status values are: "backlog", "inprogress", "done" (all lowercase)'}static async updateStoryTasks(e){return`To create or update tasks in a story:\n\n1. For a new task:\n   - Create a new file named TASK-XX_Name.json in the story's tasks directory\n   - Use update_file to create the task with this structure:\n     {\n       "id": "TASK-XX_Name",\n       "title": "Task Title",\n       "description": "Detailed task description",\n       "assignee": "Agent-X",\n       "status": "backlog",\n       "createdAt": "<use current_timestamp>",\n       "updatedAt": "<use current_timestamp>"\n     }\n\n2. For updating an existing task:\n   - Use read_file to get the current task JSON file\n   - Update the necessary fields\n   - Update the updatedAt timestamp using current_timestamp\n   - Use update_file to save the modified task\n\nThe task files should be at: ${e.workspace.repoBaseDir}/epics/EPIC-XX_Name/stories/STORY-XX_Name/tasks/TASK-XX_Name.json\n\nValid task status values are: "backlog", "inprogress", "done" (all lowercase)\n\nRemember to update the story's status based on its tasks:\n- If all tasks are done -> story is done\n- If any task is inprogress -> story is inprogress\n- If all tasks are backlog or no tasks -> story is backlog\n\nAlso update the story.json file to reflect the current task status.`}static async allEpicInstructions(e){return`# Complete Epic Management Instructions\n\n${await this.existingEpicsAndStories(e)}\n\n${await this.updateEpicInstructions(e)}\n\n${await this.updateEpicStories(e)}\n\n${await this.updateStoryTasks(e)}\n\nRemember:\n1. Keep timestamps updated using current_timestamp\n2. Maintain proper status transitions\n3. Preserve existing data when updating\n4. Follow the exact file structure and formats`}}},79056:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MlxAdapter=void 0;const i=r(3563),a=r(1098),c=r(42808),l=s(r(19055));let d=class{constructor(e){this.provider=e,this.id="mlx",this.name="MLX Server",this.messageTransformer=new c.OpenAIMessageTransformer,l.default.info("[MlxAdapter] Initialized")}getProvider(){return this.provider}getModelClient(e){return this.provider.getModelClient(e)}toProviderFormat(e){return this.messageTransformer.toProviderFormat(e)}fromProviderFormat(e){return this.messageTransformer.fromProviderFormat(e,"")}extractMetadata(e){return{format:"openai-api"}}supportsThinking(){return!1}supportsFormatConversion(e){return!0}};t.MlxAdapter=d,t.MlxAdapter=d=o([(0,i.Injectable)(),n("design:paramtypes",[a.MlxProvider])],d)},79086:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.execCommand=async function(e,t){return new Promise((r=>{const o={...t};if(o?.timeout&&"string"==typeof o.timeout){const e=o.timeout,t=parseInt(e,10);!isNaN(t)&&t>0?(o.timeout=t,s.default.debug(`[execCommand] Converted timeout from string "${e}" to number ${t}`)):(s.default.warn(`[execCommand] Invalid timeout string "${e}", removing timeout parameter.`),delete o.timeout)}s.default.debug(`Executing command: ${e} with options: ${JSON.stringify(o)}`),(0,n.exec)(e,o,((e,t,o)=>{const n={stdout:t?t.toString():"",stderr:o?o.toString():"",code:e?e.code||1:0};s.default.debug(`Command execution completed with code ${n.code}`),0!==n.code&&s.default.debug(`Command stderr: ${n.stderr}`),r(n)}))}))};const n=r(35317),s=o(r(19055))},79191:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LlmInitializerService=void 0;const i=r(3563),a=r(72776),c=s(r(19055));let l=class{constructor(e){this.appDataSource=e,this.serviceName="LlmInitializerService"}async onModuleInit(){c.default.info(`[${this.serviceName}] Initializing LLM configuration data...`);try{await this.initializeProviders(),await this.initializeModels(),await this.initializeAgentModes(),c.default.info(`[${this.serviceName}] LLM configuration data initialized successfully.`)}catch(e){c.default.error(`[${this.serviceName}] Error initializing LLM configuration data: ${e.message}`,e.stack)}}async initializeProviders(){try{await this.appDataSource.knex("llm_providers").where("provider_id","anthropic").first()?c.default.info(`[${this.serviceName}] Anthropic provider already exists.`):(c.default.info(`[${this.serviceName}] Creating Anthropic provider...`),await this.appDataSource.knex("llm_providers").insert({provider_id:"anthropic",name:"Anthropic",default_model_id:"claude-3-7-sonnet-20250219",requires_api_key:!0,metadata:JSON.stringify({description:"Anthropic Claude models",website:"https://www.anthropic.com"})}),c.default.info(`[${this.serviceName}] Anthropic provider created successfully.`));await this.appDataSource.knex("llm_providers").where("provider_id","gemini").first()?c.default.info(`[${this.serviceName}] Gemini provider already exists.`):(c.default.info(`[${this.serviceName}] Creating Gemini provider...`),await this.appDataSource.knex("llm_providers").insert({provider_id:"gemini",name:"Google Gemini",requires_api_key:!0,metadata:JSON.stringify({description:"Google Gemini models",website:"https://deepmind.google/technologies/gemini/"})}),c.default.info(`[${this.serviceName}] Gemini provider created successfully.`));await this.appDataSource.knex("llm_providers").where("provider_id","fireworks").first()?c.default.info(`[${this.serviceName}] Fireworks provider already exists.`):(c.default.info(`[${this.serviceName}] Creating Fireworks provider...`),await this.appDataSource.knex("llm_providers").insert({provider_id:"fireworks",name:"Fireworks.ai",default_model_id:"accounts/fireworks/models/llama-v3p3-70b-instruct",requires_api_key:!0,metadata:JSON.stringify({description:"Fireworks.ai open source models",website:"https://fireworks.ai"})}),c.default.info(`[${this.serviceName}] Fireworks provider created successfully.`))}catch(e){if(!e.message.includes("UNIQUE constraint failed"))throw c.default.error(`[${this.serviceName}] Error initializing providers: ${e.message}`),e;c.default.info(`[${this.serviceName}] Provider already exists (concurrent initialization).`)}}async initializeModels(){try{await this.appDataSource.knex("llm_models").where("model_id","claude-3-7-sonnet-20250219").first()?c.default.info(`[${this.serviceName}] Claude 3.7 Sonnet model already exists.`):(c.default.info(`[${this.serviceName}] Creating Claude 3.7 Sonnet model...`),await this.appDataSource.knex("llm_models").insert({model_id:"claude-3-7-sonnet-20250219",provider_id:"anthropic",name:"Claude 3.7 Sonnet",context_window:2e5,max_output_tokens:4096,supports_images:!0,supports_tool_use:!0,supports_computer_use:!0,supports_prompt_cache:!1,supports_thinking_tokens:!0,recommended_thinking_tokens:1024,max_thinking_tokens:4e3,input_cost_per_million_tokens:15,output_cost_per_million_tokens:75,is_default_for_provider:!0,metadata:JSON.stringify({description:"Claude 3.7 Sonnet is a powerful, general-purpose AI assistant that excels at a wide range of tasks from creative content generation to complex reasoning.",release_date:"2025-02-19"})}),c.default.info(`[${this.serviceName}] Claude 3.7 Sonnet model created successfully.`));await this.appDataSource.knex("llm_models").where("model_id","accounts/fireworks/models/llama-v3p3-70b-instruct").first()?c.default.info(`[${this.serviceName}] Fireworks Llama 3.3 70B model already exists.`):(c.default.info(`[${this.serviceName}] Creating Fireworks Llama 3.3 70B model...`),await this.appDataSource.knex("llm_models").insert({model_id:"accounts/fireworks/models/llama-v3p3-70b-instruct",provider_id:"fireworks",name:"Llama 3.3 70B Instruct",context_window:131072,max_output_tokens:32768,supports_images:!1,supports_tool_use:!0,supports_computer_use:!1,supports_prompt_cache:!0,supports_thinking_tokens:!1,input_cost_per_million_tokens:.9,output_cost_per_million_tokens:2.7,is_default_for_provider:!0,metadata:JSON.stringify({description:"Llama 3.3 70B Instruct is a powerful open-source language model optimized for instruction following and reasoning tasks.",modelOwner:"Meta",isInstruct:!0})}),c.default.info(`[${this.serviceName}] Fireworks Llama 3.3 70B model created successfully.`))}catch(e){if(!e.message.includes("UNIQUE constraint failed"))throw c.default.error(`[${this.serviceName}] Error initializing models: ${e.message}`),e;c.default.info(`[${this.serviceName}] Model already exists (concurrent initialization).`)}}async initializeAgentModes(){try{await this.appDataSource.knex("agent_modes").where("mode_id","plan").first()?c.default.info(`[${this.serviceName}] Plan mode already exists.`):(c.default.info(`[${this.serviceName}] Creating plan mode...`),await this.appDataSource.knex("agent_modes").insert({mode_id:"plan",name:"Plan Mode",description:"Mode for planning tasks",default_provider_id:"anthropic",default_model_id:"claude-3-7-sonnet-20250219",default_thinking_tokens:1024,default_api_key_secret_name:"ANTHROPIC_API_KEY"}),c.default.info(`[${this.serviceName}] Plan mode created successfully.`))}catch(e){if(!e.message.includes("UNIQUE constraint failed"))throw c.default.error(`[${this.serviceName}] Error initializing plan mode: ${e.message}`),e;c.default.info(`[${this.serviceName}] Plan mode already exists (concurrent initialization).`)}try{await this.appDataSource.knex("agent_modes").where("mode_id","act").first()?c.default.info(`[${this.serviceName}] Act mode already exists.`):(c.default.info(`[${this.serviceName}] Creating act mode...`),await this.appDataSource.knex("agent_modes").insert({mode_id:"act",name:"Act Mode",description:"Mode for executing tasks",default_provider_id:"anthropic",default_model_id:"claude-3-7-sonnet-20250219",default_thinking_tokens:1024,default_api_key_secret_name:"ANTHROPIC_API_KEY"}),c.default.info(`[${this.serviceName}] Act mode created successfully.`))}catch(e){if(!e.message.includes("UNIQUE constraint failed"))throw c.default.error(`[${this.serviceName}] Error initializing act mode: ${e.message}`),e;c.default.info(`[${this.serviceName}] Act mode already exists (concurrent initialization).`)}}};t.LlmInitializerService=l,t.LlmInitializerService=l=o([(0,i.Injectable)(),n("design:paramtypes",[a.AppDataSource])],l)},79233:e=>{"use strict";e.exports=require("winston-daily-rotate-file")},79352:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeepSeekProvider=void 0;const o=r(48483),n=r(8959),s=r(52368),i=r(96228);class a extends o.BaseProvider{getName(){return"deepseek"}getBaseChatModel(e,t){return new i.ChatOpenAI({modelName:this.shortModelName(e),temperature:t.temperature,openAIApiKey:s.ConfigService.getInstance().getProperty("DEEPSEEK_API_KEY"),configuration:{baseURL:a.BASE_URL}})}async getModelDescriptors(){return[new n.ModelDescriptor("deepseek",a.DEEPSEEK_CHAT,0,0,0,0),new n.ModelDescriptor("deepseek",a.DEEPSEEK_REASONER,0,0,0,0)]}isValid(){return!!s.ConfigService.getInstance().getProperty("DEEPSEEK_API_KEY")}supportsOnDemandModels(){return!1}}t.DeepSeekProvider=a,a.DEEPSEEK_CHAT="deepseek-chat",a.DEEPSEEK_REASONER="deepseek-reasoner",a.BASE_URL="https://api.deepseek.com/v1"},79616:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FileSystemEventService=void 0;const a=r(3563),c=r(50461),l=i(r(19055)),d=r(44870);let u=o=class{constructor(e){this.eventEmitter=e}emitFileModified(e,t,r){const n=new d.FileModifiedEvent(e,t,r);this.eventEmitter.emit(d.FILE_SYSTEM_EVENTS.FILE_MODIFIED,n),l.default.debug(`[${o.name}] Emitted file.modified: ${t} in ${e}`)}emitFileCreated(e,t){const r=new d.FileCreatedEvent(e,t);this.eventEmitter.emit(d.FILE_SYSTEM_EVENTS.FILE_CREATED,r),l.default.debug(`[${o.name}] Emitted file.created: ${t} in ${e}`)}emitFileDeleted(e,t){const r=new d.FileDeletedEvent(e,t);this.eventEmitter.emit(d.FILE_SYSTEM_EVENTS.FILE_DELETED,r),l.default.debug(`[${o.name}] Emitted file.deleted: ${t} in ${e}`)}};t.FileSystemEventService=u,t.FileSystemEventService=u=o=n([(0,a.Injectable)(),s("design:paramtypes",[c.EventEmitter2])],u)},79896:e=>{"use strict";e.exports=require("fs")},80885:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioTranscriptionController=void 0;const i=r(3563),a=r(49556),c=r(34562);let l=class{constructor(e){this.audioTranscriptionService=e}async transcribeAudio(e){try{return{transcription:await this.audioTranscriptionService.transcribe(e.buffer.toString("base64"))}}catch(e){throw console.error("Transcription error:",e),new Error("An error occurred during transcription")}}};t.AudioTranscriptionController=l,o([(0,i.Post)(),(0,i.UseInterceptors)((0,a.FileInterceptor)("audio")),s(0,(0,i.UploadedFile)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],l.prototype,"transcribeAudio",null),t.AudioTranscriptionController=l=o([(0,i.Controller)("audio-transcription"),n("design:paramtypes",[c.AudioTranscriptionService])],l)},81080:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigProperty=void 0;t.ConfigProperty=class{constructor(e,t){this.name=e,this.value=t}}},81125:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ValidatorRegistryService=void 0;const u=r(3563),p=c(r(16928)),f=d(r(19055));let h=n=class{constructor(){this.validators=[],f.default.info(`[${n.name}] ValidatorRegistryService initialized`)}registerValidator(e){this.validators.push(e),f.default.info(`[${n.name}] Registered validator: ${e.getName()}`)}getValidatorsForFile(e){const t=p.extname(e).toLowerCase().slice(1),r=this.validators.filter((e=>e.canValidate(t)));return 0===r.length?f.default.debug(`[${n.name}] No validators found for file extension: ${t}`):f.default.debug(`[${n.name}] Found ${r.length} validators for file extension: ${t}`),r}getAllValidators(){return[...this.validators]}clearValidators(){this.validators=[],f.default.info(`[${n.name}] Cleared all validators`)}};t.ValidatorRegistryService=h,t.ValidatorRegistryService=h=n=a([(0,u.Injectable)(),l("design:paramtypes",[])],h)},81136:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StandardRulesService=void 0;const c=r(3563),l=(r(31832),r(56500)),d=a(r(19055));let u=o=class{constructor(e){this.knex=e}async onModuleInit(){try{await this.syncStandardRules(),d.default.info(`[${o.name}] Standard rules synced successfully`)}catch(e){d.default.error(`[${o.name}] Error syncing standard rules: ${e.message}\n${e.stack}`)}}async syncStandardRules(){const e=await this.knex("eve_rules").where("source_type","eve").select("*"),t=new Map(e.map((e=>[e.id,e])));for(const e of l.standardRules){const r=t.get(e.id);r?r.content===e.content&&r.name===e.name||(d.default.debug(`[${o.name}] Updating standard rule: ${e.name}`),await this.knex("eve_rules").where("id",e.id).update({name:e.name,content:e.content,updated_at:new Date})):(d.default.debug(`[${o.name}] Adding standard rule: ${e.name}`),await this.knex("eve_rules").insert((0,l.mapRuleToDbRecord)(e)))}for(const t of e){l.standardRules.some((e=>e.id===t.id))||(d.default.debug(`[${o.name}] Removing obsolete standard rule: ${t.name}`),await this.knex("eve_rules").where("id",t.id).delete(),await this.knex("eve_user_rule_preferences").where("rule_id",t.id).delete())}}};t.StandardRulesService=u,t.StandardRulesService=u=o=n([(0,c.Injectable)(),i(0,(0,c.Inject)("KNEX")),s("design:paramtypes",[Function])],u)},81162:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ModelCategory=void 0,function(e){e.CODING="CODING",e.REASONING="REASONING",e.SUMMARISATION="SUMMARISATION",e.RAG_QUERY="RAG_QUERY",e.ORCHESTRATION="ORCHESTRATION",e.ARCHITECT="ARCHITECT"}(r||(t.ModelCategory=r={}))},81373:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlanVsActComponent=void 0;t.PlanVsActComponent=class{constructor(){this.id="plan-vs-act",this.name="Plan vs Act Mode",this.description="Guidelines for operating in plan mode vs act mode",this.category="required",this.canOptOut=!1,this.defaultEnabled=!0}getContent(e){return"ACT MODE V.S. PLAN MODE\n\nIn each user message, the environment_details will specify the current mode. There are two modes:\n\n- ACT MODE: In this mode, you have access to all tools EXCEPT the plan_mode_respond tool.\n - In ACT MODE, you use tools to accomplish the user's task. Once you've completed the user's task, you use the attempt_completion tool to present the result of the task to the user.\n- PLAN MODE: In this special mode, you have access to the plan_mode_respond tool.\n - In PLAN MODE, the goal is to gather information and get context to create a detailed plan for accomplishing the task, which the user will review and approve before they switch you to ACT MODE to implement the solution.\n - In PLAN MODE, when you need to converse with the user or present a plan, you should use the plan_mode_respond tool to deliver your response directly, rather than using <thinking> tags to analyze when to respond. Do not talk about using plan_mode_respond - just use it directly to share your thoughts and provide helpful answers.\n - In PLAN MODE, YOU SHOULD USE the read_file tool to read ANY file you are interested in. DO NOT ASK FOR PERMISSION.\n\n## What is PLAN MODE?\n\n- While you are usually in ACT MODE, the user may switch to PLAN MODE in order to have a back and forth with you to plan how to best accomplish the task. \n- When starting in PLAN MODE, depending on the user's request, you may need to do some information gathering e.g. using read_file or search_files to get more context about the task. You may also ask the user clarifying questions to get a better understanding of the task. You may return mermaid diagrams to visually display your understanding.\n- When in plan mode, if you think you need to read a file then just go ahead and use the read_file tool to do it without stopping to ask for permission.\n- Once you've gained more context about the user's request, you should architect a detailed plan for how you will accomplish the task. Returning mermaid diagrams may be helpful here as well.\n- While it is perfectly fine to make direct updates to documentation files using the replace_in_file and write_to_file tools while in PLAN MODE you should try not to use tools to edit source files. Instead you should propose the code edits in the plan and then ask to switch to ACT mode to implement the changes.\n- Then you might ask the user if they are pleased with this plan, or if they would like to make any changes. Think of this as a brainstorming session where you can discuss the task and plan the best way to accomplish it.\n- If at any point a mermaid diagram would make your plan clearer to help the user quickly see the structure, you are encouraged to include a Mermaid code block in the response. (Note: if you use colors in your mermaid diagrams, be sure to use high contrast colors so the text is readable.)\n- Finally once it seems like you've reached a good plan, ask the user to switch you back to ACT MODE to implement the solution."}}},81445:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JavaKotlinValidator=void 0;const d=r(3563),u=r(72609),p=l(r(19055)),f=r(79086),h=a(r(16928)),m=a(r(91943));let g=class extends u.BaseCommandLineValidator{constructor(){super({name:"Java/Kotlin",command:'echo "No build system detected"',fileExtensions:["java","kt","kts"],priority:10,issuePattern:/([^:]+):(\d+):(\d+): (error|warning): (.+)/g}),this.checkCommandAvailability()}async checkCommandAvailability(){try{const e=await this.checkCommand("mvn"),t=await this.checkCommand("gradle");e||t?(this.enabled=!0,p.default.info(`[${this.constructor.name}] Build tools available (Maven: ${e}, Gradle: ${t}). Validator enabled.`)):(this.enabled=!1,p.default.warn(`[${this.constructor.name}] No build tools (mvn/gradle) available. Validator disabled.`))}catch(e){this.enabled=!1,p.default.warn(`[${this.constructor.name}] Error checking build tool availability. Validator disabled. Error: ${e.message}`)}}async checkCommand(e){try{const{stdout:t,stderr:r}=await(0,f.execCommand)(`command -v ${e}`);return!(!t.trim()||t.includes("not found")||t.includes("no such file")||r.includes("not found")||r.includes("no such file"))}catch(e){return!1}}async fileExists(e){try{return await m.access(e),!0}catch(e){return!1}}async findBuildSystem(e,t){const r=h.resolve(t,e);let o=h.dirname(r);for(;;){const e=h.join(o,"pom.xml");if(await this.fileExists(e))return p.default.debug(`[${this.constructor.name}] Found Maven project at ${e}`),{type:"maven",directory:o,command:"mvn compile -q"};const t=h.join(o,"build.gradle"),r=h.join(o,"build.gradle.kts");if(await this.fileExists(t)||await this.fileExists(r)){p.default.debug(`[${this.constructor.name}] Found Gradle project at ${o}`);const e=h.join(o,"gradlew");return{type:"gradle",directory:o,command:await this.fileExists(e)?"./gradlew compileJava -q":"gradle compileJava -q"}}const n=h.dirname(o);if(n===o)break;o=n}return p.default.debug(`[${this.constructor.name}] No build system found for ${e}`),null}hasValidationErrors(e,t,r){return 0!==r}formatValidationReport(e,t){return(e+(t?"\n"+t:"")).trim()}async validate(e,t,r){p.default.debug(`[${this.constructor.name}] Validating file: ${e} in directory: ${r}`),null!=t&&p.default.debug(`[${this.constructor.name}] Content parameter provided but will be ignored. Validating project using build system.`);try{const t=await this.findBuildSystem(e,r);if(!t)return p.default.debug(`[${this.constructor.name}] No Maven or Gradle project detected for ${e} - skipping validation`),{validatorName:this.config.name,validationMethod:"Build system detection",hasErrors:!1,report:"No Maven or Gradle project detected - skipping validation"};p.default.debug(`[${this.constructor.name}] Found ${t.type} project at ${t.directory}. Executing: ${t.command}`);const{stdout:o,stderr:n,code:s}=await(0,f.execCommand)(t.command,{cwd:t.directory});p.default.debug(`[${this.constructor.name}] Command stdout: ${o}`),n&&p.default.debug(`[${this.constructor.name}] Command stderr: ${n}`);const i=this.hasValidationErrors(o,n,s),a=this.formatValidationReport(o,n);return{validatorName:this.config.name,validationMethod:`${t.command} (in ${t.directory})`,hasErrors:i,report:i?a:void 0}}catch(t){return p.default.error(`[${this.constructor.name}] Error during validation for file ${e}: ${t.message}`),{validatorName:this.config.name,validationMethod:"Build system execution",hasErrors:!0,report:`Validation execution error: ${t.message}`}}}};t.JavaKotlinValidator=g,t.JavaKotlinValidator=g=i([(0,d.Injectable)(),c("design:paramtypes",[])],g)},81495:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapGenericStopReason=function(e){if(!e)return"end_turn";const t=e.toLowerCase();return t.includes("length")||t.includes("token")?"max_tokens":t.includes("stop")?"stop_sequence":t.includes("tool")?"tool_use":t.includes("error")?"error":"end_turn"},t.validateSimpleResponseOptions=function(e){if(void 0!==e.maxTokens&&e.maxTokens<=0)throw new Error("maxTokens must be positive");if(void 0!==e.temperature&&(e.temperature<0||e.temperature>2))throw new Error("temperature must be between 0 and 2");if(void 0!==e.topP&&(e.topP<0||e.topP>1))throw new Error("topP must be between 0 and 1");if(void 0!==e.frequencyPenalty&&(e.frequencyPenalty<-2||e.frequencyPenalty>2))throw new Error("frequencyPenalty must be between -2 and 2");if(void 0!==e.presencePenalty&&(e.presencePenalty<-2||e.presencePenalty>2))throw new Error("presencePenalty must be between -2 and 2");if(void 0!==e.timeout&&e.timeout<=0)throw new Error("timeout must be positive")}},81685:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_EDIT_TOOL_CAPABILITIES=t.TOOL_CALL_TAGS=t.THINKING_TAGS=void 0,t.mapTagToBlockType=function(e){if(!e)return"text";const r=e.toLowerCase();if(t.THINKING_TAGS.includes(r))return"thinking";if(t.TOOL_CALL_TAGS.includes(r))return"tool_call";return"text"},t.THINKING_TAGS=["thinking","reasoning"],t.TOOL_CALL_TAGS=["read_file","write_to_file","replace_in_file","search_files","list_files","execute_command","browser_action","list_code_definition_names","use_mcp_tool","access_mcp_resource","ask_followup_question","attempt_completion","create_new_task","plan_mode_respond","load_mcp_documentation","web_search","fake_tool_name_for_testing"],t.DEFAULT_EDIT_TOOL_CAPABILITIES={supportedDiffFormats:["traditional"],preferredDiffFormat:"traditional",requiresFlexibleMarkers:!1,toleratesMissingEndMarkers:!1,supportsOutOfOrderBlocks:!1,requiresEnhancedErrorMessages:!1}},81705:function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(50456),t),n(r(13686),t),n(r(11778),t),n(r(27400),t),n(r(5610),t),n(r(98055),t),n(r(4676),t)},81747:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetDocument=void 0;const o=r(59100);t.DatasetDocument=class{constructor(e,t,r,n="new",s=(0,o.ulid)(),i=new Date,a=new Date){this.id=s,this.datasetId=e,this.filename=t,this.contentHash=r,this.status=n,this.createdAt=i,this.updatedAt=a}}},81986:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AnthropicProvider=void 0;const n=r(40646),s=r(48483),i=r(8959),a=r(52368),c=r(32088),l=o(r(58938));class d extends s.BaseProvider{getMaxTokens(e){return e.endsWith(d.SONNET_MODEL_NAME)||e.endsWith(d.OPUS_MODEL_NAME)?8192:e.endsWith(d.HAIKU_MODEL_NAME)?4096:8192}getName(){return"anthropic"}getBaseChatModel(e,t){var r=this.getMaxTokens(e),o=null,s=t.temperature;t.thinkingBudget>0&&e.endsWith(d.SONNET_MODEL_NAME)&&(r+=t.thinkingBudget,o={type:"enabled",budget_tokens:t.thinkingBudget},s=null),console.log("Max tokens input:",r);return new n.ChatAnthropic({modelName:this.shortModelName(e),temperature:s,anthropicApiKey:a.ConfigService.getInstance().getProperty("ANTHROPIC_API_KEY"),maxTokens:r,thinking:o,anthropicApiUrl:process.env.ANTHROPIC_API_URL||"https://api.anthropic.com",clientOptions:{defaultHeaders:{"anthropic-beta":"prompt-caching-2024-07-31"}}})}async getModelDescriptors(){0===d.modelCache.models.length&&await this.fetchModels();return d.modelCache.models.map((e=>{const t=d.MODEL_COSTS[e.id]||{input:0,output:0};return new i.ModelDescriptor("anthropic",e.id,t.input,0,0,t.output,e.id===d.SONNET_MODEL_NAME)}))}isValid(){return!!a.ConfigService.getInstance().getProperty("ANTHROPIC_API_KEY")}async fetchModels(){if(!this.isValid())return[];const e=Date.now();if(d.modelCache.models.length>0&&e-d.modelCache.timestamp<3e5)return d.modelCache.models;const t=a.ConfigService.getInstance().getProperty("ANTHROPIC_API_KEY");if(!t)return console.log("Anthropic API key not found"),[];try{const r=process.env.ANTHROPIC_API_URL||"https://api.anthropic.com",o=await l.default.get(`${r}/v1/models`,{headers:{"x-api-key":t,"anthropic-version":"2023-06-01"}});if(200===o.status){const t=o.data.data||[];return d.modelCache={models:t,timestamp:e},t}return console.log(`Failed to fetch Anthropic models. Status code: ${o.status}`),[]}catch(e){return console.error(`Error fetching Anthropic models: ${e}`),[]}}getChatModelOptions(e,t){const r=this.getExtraHeaders(e.name,t),o=this.getExtraSystemMessageKwargs(e.name,t);return new c.ChatModelOptions(r,o)}getExtraHeaders(e,t){return this.isPromptCachingEnabled(t)?{"anthropic-beta":"prompt-caching-2024-07-31"}:null}getExtraSystemMessageKwargs(e,t){return this.isPromptCachingEnabled(t)?{cache_control:{type:"ephemeral"}}:null}}t.AnthropicProvider=d,d.SONNET_MODEL_NAME="claude-3-7-sonnet-20250219",d.OPUS_MODEL_NAME="claude-3-opus-20240229",d.HAIKU_MODEL_NAME="claude-3-haiku-20240307",d.modelCache={models:[],timestamp:0},d.MODEL_COSTS={"claude-3-7-sonnet-20250219":{input:225e-8,output:1125e-8},"claude-3-5-sonnet-20241022":{input:225e-8,output:1125e-8},"claude-3-opus-20240229":{input:1125e-8,output:5625e-8},"claude-3-haiku-20240307":{input:1.875e-7,output:9.375e-7}}},82010:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LMStudioProvider=void 0;const i=r(3563),a=r(36206),c=r(91760),l=r(78706),d=r(91386),u=r(44985),p=s(r(19055));let f=class{constructor(e,t){this.providerRegistry=e,this.openSourceModelRegistry=t,this.config={providerId:u.LMSTUDIO_PROVIDER_ID,name:"LM Studio",description:"Local LM Studio server with OpenAI-compatible API",website:"https://lmstudio.ai",docsLink:"https://lmstudio.ai/docs",baseUrl:"http://localhost:1234/v1",apiKeyName:"LMSTUDIO_API_KEY",defaultModelId:(0,u.getDefaultLMStudioModelId)(),modelDiscovery:"api",features:{supportsStreaming:!0,supportsCaching:!1,supportsTools:!0,supportsImages:!1}},p.default.info("[LMStudioProvider] Initialized"),this.providerRegistry.registerProvider(this)}getId(){return this.config.providerId}getName(){return this.config.name}getMetadata(){return{website:this.config.website,docs_link:this.config.docsLink,api_version:"v1",default_base_url:this.config.baseUrl,is_local:!0,requires_server:!0}}requiresApiKey(){return!1}getDefaultBaseUrl(){return this.config.baseUrl}getDefaultModelId(){return this.config.defaultModelId}getApiKeyName(){return this.config.apiKeyName}getModelClient(e){const t={...e,baseUrl:e.baseUrl||this.config.baseUrl,apiKey:"noop",draftModelId:e.draftModelId},r=new l.OpenAIModelClient(t,{enableVerboseLogging:!1});return this.discoverModels(t.baseUrl).then((t=>{const o=t.find((t=>t.modelId===e.modelId));o?r.setModelMetadata(o):p.default.debug(`[LMStudioProvider] Metadata not found for model ${e.modelId}`)})).catch((e=>{p.default.debug(`[LMStudioProvider] Failed to discover models: ${e.message}`)})),r}getProviderMetadata(){const e=d.OpenAICompatibleUtils.createProviderMetadata(this.config);return{...e,requiresApiKey:!1,features:{...e.features,supportsSpeculativeDecoding:!0}}}getStaticModels(){return[]}async discoverDynamicModels(e,t){const r=t||this.config.baseUrl;return{models:await(0,u.discoverLMStudioModels)(r,this.openSourceModelRegistry),discoveredAt:new Date,discoveryMethod:"api",source:r}}requiresApiKeyForDiscovery(){return!1}async discoverModels(e,t){return(0,u.discoverLMStudioModels)(t||this.config.baseUrl,this.openSourceModelRegistry)}};t.LMStudioProvider=f,t.LMStudioProvider=f=o([(0,i.Injectable)(),n("design:paramtypes",[a.ProviderRegistry,c.OpenSourceModelRegistryService])],f)},82097:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HyperbolicProvider=void 0;const o=r(96228),n=r(48483),s=r(8959),i=r(52368);class a extends n.BaseProvider{getName(){return a.PROVIDER_NAME}getBaseChatModel(e,t){return new o.ChatOpenAI({modelName:this.shortModelName(e),temperature:t.temperature,openAIApiKey:i.ConfigService.getInstance().getProperty("HYPERBOLIC_API_KEY"),configuration:{baseURL:"https://api.hyperbolic.ai/v1"}})}async getModelDescriptors(){return a.LIST_OF_MODELS.map((e=>new s.ModelDescriptor(a.PROVIDER_NAME,e,0,0,0,0)))}isValid(){return!!i.ConfigService.getInstance().getProperty("HYPERBOLIC_API_KEY")}}t.HyperbolicProvider=a,a.QWEN_2_5_CODER_32B_INSTRUCT="Qwen/Qwen2.5-Coder-32B-Instruct",a.QWEN_2_5_72B_INSTRUCT="Qwen/Qwen2.5-72B-Instruct",a.DEEPSEEK_V2_5="deepseek-ai/DeepSeek-V2.5",a.META_LLAMA_3_1_405B_INSTRUCT="meta-llama/Meta-Llama-3.1-405B-Instruct",a.META_LLAMA_3_1_8B_INSTRUCT="meta-llama/Meta-Llama-3.1-8B-Instruct",a.PROVIDER_NAME="hyperbolic",a.LIST_OF_MODELS=[a.QWEN_2_5_CODER_32B_INSTRUCT,a.QWEN_2_5_72B_INSTRUCT,a.DEEPSEEK_V2_5,a.META_LLAMA_3_1_405B_INSTRUCT,a.META_LLAMA_3_1_8B_INSTRUCT]},82196:e=>{"use strict";e.exports=require("@langchain/mistralai")},82267:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PlanModeRespondTool=void 0;const a=r(3563),c=r(20436),l=i(r(19055));let d=o=class extends c.BaseTool{constructor(e){super(e),this.name="plan_mode_respond",this.description="Respond to the user's inquiry in an effort to plan a solution to the user's task.",l.default.info(`[${o.name}] PlanModeRespondTool initialized`)}getModeSpecificGuidance(e){return null}getBaseUsageInstructions(e){return'## plan_mode_respond\nDescription: Respond to the user\'s inquiry in an effort to plan a solution to the user\'s task. This tool should be used when you need to provide a response to a question or statement from the user about how you plan to accomplish the task. This tool is only available in PLAN MODE. The environment_details will specify the current mode, if it is not PLAN MODE then you should not use this tool. Depending on the user\'s message, you may ask questions to get clarification about the user\'s request, architect a solution to the task, and to brainstorm ideas with the user. For example, if the user\'s task is to create a website, you may start by asking some clarifying questions, then present a detailed plan for how you will accomplish the task given the context, and perhaps engage in a back and forth to finalize the details before the user switches you to ACT MODE to implement the solution.\nParameters:\n- response: (required) The response to provide to the user. Do not try to use tools in this parameter, this is simply a chat response. (You MUST use the response parameter, do not simply place the response text directly within <plan_mode_respond> tags.)\n- options: (optional) An array of 2-5 options for the user to choose from. Each option should be a string describing a possible choice or path forward in the planning process. This can help guide the discussion and make it easier for the user to provide input on key decisions. You may not always need to provide options, but it may be helpful in many cases where it can save the user from having to type out a response manually. Do NOT present an option to toggle to Act mode, as this will be something you need to direct the user to do manually themselves.\nUsage:\n<plan_mode_respond>\n<response>Your response here</response>\n<options>\nArray of options here (optional), e.g. ["Option 1", "Option 2", "Option 3"]\n</options>\n</plan_mode_respond>'}validateParams(e){return"string"==typeof e.response&&""!==e.response.trim()}async execute(e){const{response:t,options:r}=e;return l.default.info(`[${o.name}] Responding in plan mode: ${t.substring(0,50)}...`),{response:t,options:r,success:!0}}};t.PlanModeRespondTool=d,t.PlanModeRespondTool=d=o=n([(0,a.Injectable)(),s("design:paramtypes",[Object])],d)},82355:e=>{"use strict";e.exports=require("isbinaryfile")},82385:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RepoRulesController=void 0;const a=r(3563),c=r(96170),l=i(r(19055)),d=r(88474);let u=class{constructor(e,t){this.rulesService=e,this.workspaceService=t}async getRepoRuleContent(e,t){if(!e||!t)throw new a.BadRequestException("Workspace and path are required");const r=await this.workspaceService.findOne(e);if(!r)throw new a.NotFoundException(`Workspace ${e} not found`);const o=r.repoBaseDir;l.default.debug(`[RepoRulesController] Getting content for repo rule in workspace: ${e}`),l.default.debug(`[RepoRulesController] Workspace directory path: ${o}`),l.default.debug(`[RepoRulesController] Rule path: ${t}`);const n=await this.rulesService.getRepoRuleContent(o,t);return l.default.debug(`[RepoRulesController] Content retrieved for repo rule: ${t}`),n}async updateRepoRuleContent(e,t,r){if(!e||!t)throw new a.BadRequestException("Workspace and path are required");const o=await this.workspaceService.findOne(e);if(!o)throw new a.NotFoundException(`Workspace ${e} not found`);const n=o.repoBaseDir;return l.default.debug(`[RepoRulesController] Updating repo rule in workspace: ${e}`),l.default.debug(`[RepoRulesController] Workspace directory path: ${n}`),l.default.debug(`[RepoRulesController] Rule path: ${t}`),await this.rulesService.updateRepoRuleContent(n,t,r.content),l.default.debug(`[RepoRulesController] Content updated for repo rule: ${t}`),{success:!0}}async createRepoRule(e,t){if(!e)throw new a.BadRequestException("Workspace is required");if(!t.name)throw new a.BadRequestException("Name is required");const r=await this.workspaceService.findOne(e);if(!r)throw new a.NotFoundException(`Workspace ${e} not found`);const o=r.repoBaseDir;l.default.debug(`[RepoRulesController] Creating new repo rule in workspace: ${e}`),l.default.debug(`[RepoRulesController] Workspace directory path: ${o}`),l.default.debug(`[RepoRulesController] Rule name: ${t.name}`);const n=await this.rulesService.createRepoRule(o,t.name,t.content||"",e);return l.default.debug(`[RepoRulesController] Rule created: ${t.name}`),n}async deleteRepoRule(e,t){if(!e||!t)throw new a.BadRequestException("Workspace and path are required");const r=await this.workspaceService.findOne(e);if(!r)throw new a.NotFoundException(`Workspace ${e} not found`);const o=r.repoBaseDir;return l.default.debug(`[RepoRulesController] Deleting repo rule in workspace: ${e}`),l.default.debug(`[RepoRulesController] Workspace directory path: ${o}`),l.default.debug(`[RepoRulesController] Rule path: ${t}`),await this.rulesService.deleteRepoRule(o,t),l.default.debug(`[RepoRulesController] Rule deleted: ${t}`),{success:!0}}};t.RepoRulesController=u,o([(0,a.Get)(":workspace/:path"),s(0,(0,a.Param)("workspace")),s(1,(0,a.Param)("path")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],u.prototype,"getRepoRuleContent",null),o([(0,a.Put)(":workspace/:path"),s(0,(0,a.Param)("workspace")),s(1,(0,a.Param)("path")),s(2,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,String,Object]),n("design:returntype",Promise)],u.prototype,"updateRepoRuleContent",null),o([(0,a.Post)(":workspace"),s(0,(0,a.Param)("workspace")),s(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],u.prototype,"createRepoRule",null),o([(0,a.Delete)(":workspace/:path"),s(0,(0,a.Param)("workspace")),s(1,(0,a.Param)("path")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],u.prototype,"deleteRepoRule",null),t.RepoRulesController=u=o([(0,a.Controller)("repo-rules"),n("design:paramtypes",[c.RulesService,d.WorkspaceService])],u)},82757:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UnifiedBlockProcessor=void 0;const i=r(3563),a=r(18448),c=r(58712),l=r(55705),d=r(19612),u=r(23738),p=r(59100),f=r(29311),h=r(38182),m=s(r(19055)),g=r(96297),y=r(11502);let v=class{constructor(e,t,r,o){this.currentBlock=null,this.textAccumulator="",this.thinkingAccumulator="",this.outerTagStripper=null,this.outerTagStripperBuffer="",this.smartToolCallTracker=null,this.processingContext=null,this.originalContentSegments=[],this.currentSegment=null,this.interruptedToolCalls=[],this.bufferManager=e,this.unifiedTagDetector=t||new d.UnifiedTagDetector,this.outerTagStripper=r||null,this.smartToolCallTracker=o||null}async*processNormalizedStream(e,t){this.initializeProcessing(t);try{m.default.debug(`[UnifiedBlockProcessor] Starting stream processing for provider: ${t.providerId}, task: ${t.taskId}`);for await(const t of e)this.processingContext.stats.chunksProcessed++,yield*this.processChunk(t);if(yield*this.flushRemainingContent(),this.currentBlock&&!this.currentBlock.finished){const e=this.finishCurrentBlock();e&&(yield e)}this.finalizeProcessing(),m.default.debug(`[UnifiedBlockProcessor] Completed stream processing. Stats: ${JSON.stringify(this.processingContext.stats)}`)}catch(e){this.processingContext.stats.errors++,m.default.error(`[UnifiedBlockProcessor] Processing error: ${e.message}`,e);const t=f.StopReasonMapper.createStopReasonBlock(l.NormalizedStopReason.ERROR,{originalError:e.message,...this.processingContext?.providerState||{}});t?yield t:yield this.createErrorBlock(`Processing error: ${e.message}`,this.processingContext?.providerState)}finally{if(this.originalContentSegments.length>0||this.currentSegment)try{const e=this.generateMessageInterchange();yield e}catch(e){m.default.error(`[UnifiedBlockProcessor] Failed to generate MessageInterchange: ${e.message}`,e)}}}initializeProcessing(e){const t={chunksProcessed:0,blocksCreated:0,toolCallsDetected:0,contentLength:0,bufferFlushes:0,errors:0,startTime:new Date};this.processingContext={config:e,stats:t,providerState:{}},this.resetState(),this.configureComponents(e)}configureComponents(e){if(e.bufferConfig){const t=e.bufferConfig;t.maxSize&&this.bufferManager.setMaxBufferSize(t.maxSize),t.smallChunkThreshold&&this.bufferManager.setSmallChunkThreshold(t.smallChunkThreshold),void 0!==t.maxBufferTime&&this.bufferManager.setMaxBufferTime(t.maxBufferTime)}e.outerTagConfig?this.outerTagStripper=new c.OuterTagStripper(e.outerTagConfig):this.outerTagStripper=null,e.thinkingTagConfig?.enabled&&e.thinkingTagConfig?.tagNames&&this.unifiedTagDetector.setThinkingTagNames(e.thinkingTagConfig.tagNames),this.smartToolCallTracker&&this.smartToolCallTracker.reset()}finalizeProcessing(){this.processingContext&&(this.processingContext.stats.endTime=new Date)}async*processChunk(e){g.debugLogger.dumpObject(`Normalized chunk #${this.processingContext.stats.chunksProcessed+1}`,e);try{(0,y.validateNormalizedChunk)(e,`UnifiedBlockProcessor - Provider: ${this.processingContext?.config?.providerId}`)}catch(e){if(e instanceof y.ChunkValidationError){m.default.warn(`[UnifiedBlockProcessor] Invalid chunk received: ${e.message}`,e.invalidChunk),this.processingContext&&this.processingContext.stats.errors++;const t=f.StopReasonMapper.createStopReasonBlock(l.NormalizedStopReason.ERROR,{errorType:"ChunkValidationError",errorMessage:e.message,invalidChunkDetails:e.invalidChunk,...this.processingContext?.providerState||{}});return void(t&&(yield t))}{m.default.error(`[UnifiedBlockProcessor] Unexpected validation error: ${e.message}`,e),this.processingContext&&this.processingContext.stats.errors++;const t=f.StopReasonMapper.createStopReasonBlock(l.NormalizedStopReason.ERROR,{errorType:"UnexpectedValidationError",errorMessage:e.message,...this.processingContext?.providerState||{}});return void(t&&(yield t))}}switch(e.metadata&&this.processingContext&&(this.processingContext.providerState={...this.processingContext.providerState,...e.metadata}),e.content&&this.processingContext&&(this.processingContext.stats.contentLength+=e.content.length),e.type){case a.NormalizedChunkType.THINKING:yield*this.handleThinkingChunk(e);break;case a.NormalizedChunkType.TEXT:yield*this.handleTextChunk(e);break;case a.NormalizedChunkType.USAGE:yield*this.handleUsageChunk(e);break;case a.NormalizedChunkType.STOP:yield*this.handleStopChunk(e);break;default:m.default.warn(`[UnifiedBlockProcessor] Unknown chunk type: ${e.type}`),this.processingContext&&this.processingContext.stats.errors++}}async*handleThinkingChunk(e){this.trackOriginalContent(e),e.content&&(this.thinkingAccumulator+=e.content,this.currentBlock&&"thinking"===this.currentBlock.blockType?(this.currentBlock.content+=e.content,yield this.createUpdateChunk(this.currentBlock.blockId,{appendContent:e.content})):(this.currentBlock&&(yield this.finishCurrentBlock()),this.currentBlock=this.createThinkingBlock(e.content),yield this.blockToChunk(this.currentBlock)))}async*handleTextChunk(e){this.trackOriginalContent(e);const t=e.content||"";if(!t&&e.type!==a.NormalizedChunkType.TEXT)return;if(this.currentBlock&&"text"!==this.currentBlock.blockType){const e=this.currentBlock.tagName||"thinking",r=this.currentBlock.content+t,o=this.unifiedTagDetector.findClosingTag(r,e,0);if(o){const e=r.substring(0,o.endIndex),n=r.substring(o.endIndex),s=t;return this.currentBlock.content=e,yield this.createUpdateChunk(this.currentBlock.blockId,{appendContent:s}),yield this.finishCurrentBlock(),this.currentBlock=null,void(this.hasNonWhitespaceContent(n)&&(yield*this.updateContentBlock(n)))}}let r=t;if(this.outerTagStripper){const o=this.outerTagStripper.processChunkedContent(t,this.outerTagStripperBuffer);if(this.processingContext?.config?.debug&&(o.hadXmlFences||o.hadOuterTags)&&(m.default.debug(`[UnifiedBlockProcessor] OuterTagStripper result: hadXmlFences=${!!o.hadXmlFences}, hadOuterTags=${!!o.hadOuterTags}, strippedBy=${JSON.stringify(o.strippedBy||[])}, needsMoreContent=${o.needsMoreContent}`),m.default.debug(`[UnifiedBlockProcessor] Original content for stripping: "${t}" (buffered: "${this.outerTagStripperBuffer}")`),m.default.debug(`[UnifiedBlockProcessor] Stripped content by OuterTagStripper: "${o.strippedContent}" (new UBP buffer: "${o.bufferedContent||""}")`)),this.outerTagStripperBuffer=o.bufferedContent||"",r=o.strippedContent,o.needsMoreContent)return void(r&&this.bufferManager.addToBuffer(r,e.metadata,e.type))}(r||e.type===a.NormalizedChunkType.TEXT)&&this.bufferManager.addToBuffer(r,e.metadata,e.type);const o=this.bufferManager.shouldFlush();if(o&&!this.outerTagStripperBuffer){let e;if(this.processingContext&&this.processingContext.stats.bufferFlushes++,m.default.debug(`[UnifiedBlockProcessor] Flushing buffer due to: ${o.reason}`),"toolCall"===o.type&&o.metadata?.isOpeningTag){const t=this.bufferManager.getCombinedContent(),r=this.unifiedTagDetector.findOpeningTag(t);e=r?this.bufferManager.flushBuffer({tagName:r.tagName,startIndex:r.startIndex}):this.bufferManager.flushBuffer()}else e=this.bufferManager.flushBuffer();for(const t of e)t.type!==a.NormalizedChunkType.TEXT&&t.type!==a.NormalizedChunkType.THINKING||!t.content?t.type===a.NormalizedChunkType.USAGE&&(yield*this.handleUsageChunk(t)):this.currentBlock&&"text"!==this.currentBlock.blockType&&"generating"===this.currentBlock.status||"toolCall"===o.type&&o.metadata?.isOpeningTag?yield*this.updateContentBlock(t.content):yield*this.processTextContent(t.content)}}async*processTextContent(e){if(this.processingContext?.config?.thinkingTagConfig?.enabled&&(!this.currentBlock||"text"===this.currentBlock.blockType||"generating"!==this.currentBlock.status)){const t=this.unifiedTagDetector.detectAllTags(e,this.processingContext.config.thinkingTagConfig.stripTags??!0);if(t.hasAnyTags)return void(yield*this.processContentWithThinkingTags(e,t))}const t=this.unifiedTagDetector.detectTag(e),r=t&&"tool_call"===t.tag.type?{preContent:t.preContent,postContent:t.postContent,toolCall:{name:t.tag.name,parameters:t.tag.content}}:null;if(r){if(this.processingContext&&this.processingContext.stats.toolCallsDetected++,this.smartToolCallTracker){const e=this.smartToolCallTracker.checkToolCall(r.toolCall.name);if("interrupt"===e.action&&e.reason)return m.default.warn(`[UnifiedBlockProcessor] SmartToolCallTracker interrupted stream: ${e.reason}`),void(this.currentBlock&&!this.currentBlock.finished&&(yield this.finishCurrentBlock(),this.currentBlock=null))}r.preContent&&(yield*this.updateContentBlock(r.preContent),this.currentBlock&&(yield this.finishCurrentBlock(),this.currentBlock=null));if(e.includes(`</${r.toolCall.name}>`)){const e=this.createToolCallBlock(r.toolCall.name,r.toolCall.parameters);yield this.blockToChunk(e),this.currentBlock=null}else{const e=`<${r.toolCall.name}>${r.toolCall.parameters}`;this.currentBlock=this.createToolCallBlockIncomplete(r.toolCall.name,e),yield this.blockToChunk(this.currentBlock)}r.postContent&&(yield*this.updateContentBlock(r.postContent))}else yield*this.updateContentBlock(e)}async*processContentWithThinkingTags(e,t){let r=0;this.processingContext;const o=t.tags.filter((e=>"thinking"===e.type));for(const t of o){if(t.startIndex>r){const o=e.substring(r,t.startIndex);if(this.hasNonWhitespaceContent(o)){const e=this.unifiedTagDetector.detectTag(o);e&&"tool_call"===e.tag.type?yield*this.processToolCallContent(o,{preContent:e.preContent,postContent:e.postContent,toolCall:{name:e.tag.name,parameters:e.tag.content}}):yield*this.updateContentBlock(o)}}this.currentBlock&&!this.currentBlock.finished&&(yield this.finishCurrentBlock(),this.currentBlock=null),this.currentBlock=this.createThinkingBlock(t.content),yield this.blockToChunk(this.currentBlock),yield this.finishCurrentBlock(),this.currentBlock=null,r=t.endIndex}if(r<e.length){const t=e.substring(r);if(this.hasNonWhitespaceContent(t)){const e=this.unifiedTagDetector.detectTag(t);e&&"tool_call"===e.tag.type?yield*this.processToolCallContent(t,{preContent:e.preContent,postContent:e.postContent,toolCall:{name:e.tag.name,parameters:e.tag.content}}):yield*this.updateContentBlock(t)}}}async*processToolCallContent(e,t){if(this.processingContext&&this.processingContext.stats.toolCallsDetected++,this.smartToolCallTracker){const e=this.smartToolCallTracker.checkToolCall(t.toolCall.name);if("interrupt"===e.action&&e.reason)return m.default.warn(`[UnifiedBlockProcessor] SmartToolCallTracker interrupted stream: ${e.reason}`),void(this.currentBlock&&!this.currentBlock.finished&&(yield this.finishCurrentBlock(),this.currentBlock=null))}t.preContent&&(yield*this.updateContentBlock(t.preContent),this.currentBlock&&(yield this.finishCurrentBlock(),this.currentBlock=null));if(e.includes(`</${t.toolCall.name}>`)){const e=this.createToolCallBlock(t.toolCall.name,t.toolCall.parameters);yield this.blockToChunk(e),this.currentBlock=null}else{const e=`<${t.toolCall.name}>${t.toolCall.parameters}`;this.currentBlock=this.createToolCallBlockIncomplete(t.toolCall.name,e),yield this.blockToChunk(this.currentBlock)}t.postContent&&(yield*this.updateContentBlock(t.postContent))}hasNonWhitespaceContent(e){return e.trim().length>0}async*updateContentBlock(e){if(this.currentBlock){if(this.unifiedTagDetector.findOpeningTag(e)&&"text"===this.currentBlock.blockType)return yield this.createUpdateChunk(this.currentBlock.blockId,{newStatus:"finished"}),this.currentBlock=null,void(yield*this.updateContentBlock(e));this.currentBlock.content+=e,this.textAccumulator+=e;const t=this.unifiedTagDetector.findOpeningTag(this.currentBlock.content);if(t&&"text"===this.currentBlock.blockType){if(this.smartToolCallTracker&&"tool_call"===t.tagType){const r=this.smartToolCallTracker.checkToolCall(t.tagName);if("interrupt"===r.action&&r.reason)return m.default.warn(`[UnifiedBlockProcessor] SmartToolCallTracker interrupted stream on opening tag: ${r.reason}`),this.interruptedToolCalls.push({toolName:t.tagName,reason:r.reason}),yield this.createUpdateChunk(this.currentBlock.blockId,{appendContent:e,newStatus:"finished"}),void(this.currentBlock=null)}const r=this.currentBlock.content.substring(0,t.startIndex);if(this.hasNonWhitespaceContent(r)){yield this.createUpdateChunk(this.currentBlock.blockId,{appendContent:e,newStatus:"finished"});const r=this.currentBlock.content.substring(t.startIndex),o=this.unifiedTagDetector.findClosingTag(r,t.tagName,0);if(o){const e=r.substring(t.endIndex-t.startIndex,o.startIndex);"thinking"===t.tagType?(this.currentBlock=this.createThinkingBlock(e),yield this.blockToChunk(this.currentBlock),yield this.createUpdateChunk(this.currentBlock.blockId,{newStatus:"finished"})):(this.processingContext&&this.processingContext.stats.toolCallsDetected++,this.currentBlock=this.createToolCallBlock(t.tagName,e),yield this.blockToChunk(this.currentBlock)),this.currentBlock=null}else"thinking"===t.tagType?this.currentBlock=this.createThinkingBlockIncomplete(r):(this.processingContext&&this.processingContext.stats.toolCallsDetected++,this.currentBlock=this.createToolCallBlockIncomplete(t.tagName,r)),yield this.blockToChunk(this.currentBlock)}else this.currentBlock.blockType=t.tagType,"tool_call"===t.tagType?(this.currentBlock.tagName=t.tagName,this.processingContext&&this.processingContext.stats.toolCallsDetected++,yield this.createUpdateChunk(this.currentBlock.blockId,{appendContent:e,newBlockType:"tool_call",newTagName:t.tagName})):yield this.createUpdateChunk(this.currentBlock.blockId,{appendContent:e,newBlockType:"thinking"})}else if("text"!==this.currentBlock.blockType){const t=this.currentBlock.tagName||"thinking";this.unifiedTagDetector.findClosingTag(this.currentBlock.content+e,t,0)&&"generating"===this.currentBlock.status?(yield this.createUpdateChunk(this.currentBlock.blockId,{appendContent:e,newStatus:"finished"}),this.currentBlock=null):yield this.createUpdateChunk(this.currentBlock.blockId,{appendContent:e})}else(this.hasNonWhitespaceContent(e)||"text"!==this.currentBlock.blockType)&&(yield this.createUpdateChunk(this.currentBlock.blockId,{appendContent:e}))}else{const t=this.unifiedTagDetector.findOpeningTag(e);if(t){if(this.smartToolCallTracker&&"tool_call"===t.tagType){const r=this.smartToolCallTracker.checkToolCall(t.tagName);if("interrupt"===r.action&&r.reason){m.default.warn(`[UnifiedBlockProcessor] SmartToolCallTracker interrupted stream on opening tag: ${r.reason}`),this.interruptedToolCalls.push({toolName:t.tagName,reason:r.reason});const o=e.substring(0,t.startIndex);return void(this.hasNonWhitespaceContent(o)&&(this.currentBlock=this.createTextBlock(o),yield this.blockToChunk(this.currentBlock),yield this.createUpdateChunk(this.currentBlock.blockId,{newStatus:"finished"}),this.currentBlock=null))}}const r=e.substring(0,t.startIndex);if(this.hasNonWhitespaceContent(r)){this.currentBlock=this.createTextBlock(r),yield this.blockToChunk(this.currentBlock),yield this.createUpdateChunk(this.currentBlock.blockId,{newStatus:"finished"});const o=e.substring(t.startIndex),n=this.unifiedTagDetector.findClosingTag(o,t.tagName,0);if(n){const e=o.substring(t.endIndex-t.startIndex,n.startIndex);"thinking"===t.tagType?(this.currentBlock=this.createThinkingBlock(e),yield this.blockToChunk(this.currentBlock),yield this.createUpdateChunk(this.currentBlock.blockId,{newStatus:"finished"})):(this.processingContext&&this.processingContext.stats.toolCallsDetected++,this.currentBlock=this.createToolCallBlock(t.tagName,e),yield this.blockToChunk(this.currentBlock)),this.currentBlock=null}else"thinking"===t.tagType?this.currentBlock=this.createThinkingBlockIncomplete(o):(this.processingContext&&this.processingContext.stats.toolCallsDetected++,this.currentBlock=this.createToolCallBlockIncomplete(t.tagName,o)),yield this.blockToChunk(this.currentBlock)}else{const r=this.unifiedTagDetector.findClosingTag(e,t.tagName,t.endIndex);if(r){const o=e.substring(t.endIndex,r.startIndex);"thinking"===t.tagType?(this.currentBlock=this.createThinkingBlock(o),yield this.blockToChunk(this.currentBlock),yield this.createUpdateChunk(this.currentBlock.blockId,{newStatus:"finished"})):(this.processingContext&&this.processingContext.stats.toolCallsDetected++,this.currentBlock=this.createToolCallBlock(t.tagName,o),yield this.blockToChunk(this.currentBlock)),this.currentBlock=null}else"thinking"===t.tagType?this.currentBlock=this.createThinkingBlockIncomplete(e):(this.processingContext&&this.processingContext.stats.toolCallsDetected++,this.currentBlock=this.createToolCallBlockIncomplete(t.tagName,e)),yield this.blockToChunk(this.currentBlock)}}else{if(!this.hasNonWhitespaceContent(e))return;this.currentBlock=this.createTextBlock(e),yield this.blockToChunk(this.currentBlock)}this.textAccumulator=e}}async*handleUsageChunk(e){if(!(e.inputTokens||e.outputTokens||e.cacheReadTokens||e.cacheWriteTokens))return;const t={type:"usage",inputTokens:e.inputTokens||0,outputTokens:e.outputTokens||0,cacheReadTokens:e.cacheReadTokens||0,cacheWriteTokens:e.cacheWriteTokens||0};yield t}async*handleStopChunk(e){if(yield*this.flushRemainingContent(),this.currentBlock&&(yield this.finishCurrentBlock(),this.currentBlock=null),this.outerTagStripperBuffer&&(m.default.warn(`[UnifiedBlockProcessor] Stream ended with incomplete outer tag fragment: ${this.outerTagStripperBuffer}`),yield*this.processTextContent(this.outerTagStripperBuffer),this.currentBlock&&(yield this.finishCurrentBlock(),this.currentBlock=null),this.outerTagStripperBuffer=""),e.stopReason){const t=f.StopReasonMapper.createStopReasonBlock(e.stopReason,this.processingContext?.providerState);t&&(yield t)}}async*flushRemainingContent(){this.outerTagStripperBuffer&&(yield*this.processTextContent(this.outerTagStripperBuffer),this.outerTagStripperBuffer=""),this.processingContext&&this.bufferManager.getCombinedContent().length>0&&this.processingContext.stats.bufferFlushes++;const e=this.bufferManager.flushBuffer();for(const t of e)t.type!==a.NormalizedChunkType.TEXT&&t.type!==a.NormalizedChunkType.THINKING||!t.content?t.type===a.NormalizedChunkType.USAGE&&(yield*this.handleUsageChunk(t)):this.currentBlock&&"text"!==this.currentBlock.blockType&&"generating"===this.currentBlock.status?yield*this.updateContentBlock(t.content):yield*this.processTextContent(t.content)}createThinkingBlock(e){return this.processingContext&&this.processingContext.stats.blocksCreated++,this.thinkingAccumulator=e,{blockId:(0,p.ulid)(),blockType:"thinking",status:"generating",content:e,finished:!1,createdAt:new Date,metadata:this.processingContext?.providerState}}createTextBlock(e){return this.processingContext&&this.processingContext.stats.blocksCreated++,{blockId:(0,p.ulid)(),blockType:"text",status:"generating",content:e,finished:!1,createdAt:new Date,metadata:this.processingContext?.providerState}}createToolCallBlock(e,t){this.processingContext&&this.processingContext.stats.blocksCreated++;const r=`<${e}>${t}</${e}>`;return{blockId:(0,p.ulid)(),blockType:"tool_call",tagName:e,status:"finished",content:r,finished:!0,createdAt:new Date,metadata:this.processingContext?.providerState}}createToolCallBlockIncomplete(e,t){return this.processingContext&&this.processingContext.stats.blocksCreated++,{blockId:(0,p.ulid)(),blockType:"tool_call",tagName:e,status:"generating",content:t,finished:!1,createdAt:new Date,metadata:this.processingContext?.providerState}}createThinkingBlockIncomplete(e){return this.processingContext&&this.processingContext.stats.blocksCreated++,{blockId:(0,p.ulid)(),blockType:"thinking",status:"generating",content:e,finished:!1,createdAt:new Date,metadata:this.processingContext?.providerState}}blockToChunk(e){return{type:"block",block:{blockId:e.blockId,blockType:e.blockType,tagName:e.tagName,status:e.status,content:e.content}}}createUpdateChunk(e,t){return{type:"blockUpdate",blockId:e,...t}}finishCurrentBlock(){return this.currentBlock?(this.currentBlock.status="finished",this.currentBlock.finished=!0,this.createUpdateChunk(this.currentBlock.blockId,{newStatus:"finished"})):null}createErrorBlock(e,t,r="error"){return{type:"block",block:{blockId:(0,p.ulid)(),blockType:"error",status:"error",content:e,..."interruption"===r&&{metadata:{...t,interruption:!0}}}}}resetState(){this.currentBlock=null,this.textAccumulator="",this.thinkingAccumulator="",this.bufferManager.reset(),this.outerTagStripperBuffer="",this.smartToolCallTracker&&this.smartToolCallTracker.reset(),this.originalContentSegments=[],this.currentSegment=null,this.interruptedToolCalls=[]}trackOriginalContent(e){if(!e.originalContent)return;const t=e.type===a.NormalizedChunkType.THINKING?"thinking":"text";this.currentSegment&&this.currentSegment.type===t?(this.currentSegment.originalContent+=e.originalContent,e.metadata&&(this.currentSegment.metadata={...this.currentSegment.metadata,...e.metadata})):(this.currentSegment&&(this.currentSegment.endTime=new Date,this.originalContentSegments.push(this.currentSegment)),this.currentSegment={type:t,originalContent:e.originalContent,metadata:e.metadata?{...e.metadata}:void 0,startTime:new Date})}generateMessageInterchange(){this.currentSegment&&(this.currentSegment.endTime=new Date,this.originalContentSegments.push(this.currentSegment),this.currentSegment=null);const e=this.originalContentSegments.map((e=>({type:e.type,content:e.originalContent,metadata:e.metadata})));if(this.interruptedToolCalls.length>0)for(const t of this.interruptedToolCalls)e.push({type:"text",content:`[SYSTEM] Interrupted additional tool call '${t.toolName}' after a possibly mutating tool call. Only one non-read-only tool call is allowed per message. Please assess the result of the previous tool call before proceeding with additional actions.`,metadata:{interruption:!0,toolName:t.toolName,reason:t.reason}});return{type:"messageInterchange",messageInterchange:{id:(0,p.ulid)(),taskId:this.processingContext.config.taskId,role:"assistant",segments:e,providerId:this.processingContext.config.providerId,providerMetadata:{format:"normalized",...this.processingContext?.providerState},createdAt:new Date}}}};t.UnifiedBlockProcessor=v,t.UnifiedBlockProcessor=v=o([(0,i.Injectable)(),n("design:paramtypes",[u.ChunkBuffer,d.UnifiedTagDetector,c.OuterTagStripper,h.SmartToolCallTracker])],v)},82900:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SerpApi=void 0;const a=r(83153),c=r(11569),l=i(r(19055)),d=r(3563),u=r(52368),p=r(76910),f=r(65306);let h=class extends a.Tool{constructor(e){super(),this.configService=e,this.name="serp_api",this.description="Search the web using SerpAPI and return the top search results. This takes a search term and returns the top results.",this.schema=c.z.object({searchTerm:c.z.string().describe("The search term to look for"),numResults:c.z.number().optional().describe("Number of results to return (default: 10)"),start:c.z.number().optional().describe("Starting position for pagination (0-based, optional)")}),this.apiKey=this.configService.getProperty(p.ConfigPropNames.SERP_API_KEY,""),this.apiKey||l.default.warn("SerpAPI key not found in config. The SerpAPI tool will not work without an API key.")}async _call({searchTerm:e,numResults:t=10,start:r=0}){if(!this.apiKey)return"Error: SerpAPI key not configured. Please set the SERP_API_KEY in system configuration.";try{l.default.info(`Searching with SerpAPI: "${e}", numResults: ${t}, start: ${r}`);const o={api_key:this.apiKey,q:e,engine:"google",google_domain:"google.com",hl:"en",num:t,start:r},n=await new Promise(((e,t)=>{(0,f.getJson)(o,(r=>{"Error"===r.search_metadata?.status?t(new Error(r.search_metadata.id||"Unknown error")):e(r)}))}));if(!n||!n.organic_results||0===n.organic_results.length)return`No results found for search: "${e}"`;const s=n.organic_results;let i=`Search results for: "${e}" (${n.search_information?.total_results||"unknown"} total results)\n`;if(i+=`Page: ${Math.floor(r/t)+1} (showing results ${r+1}-${r+s.length})\n\n`,s.forEach(((e,t)=>{i+=`${r+t+1}. ${e.title||"No title"}\n`,i+=`   URL: ${e.link||"No link"}\n`,e.snippet&&(i+=`   Snippet: ${e.snippet}\n`),e.date&&(i+=`   Date: ${e.date}\n`),i+="\n"})),n.pagination&&n.pagination.next){i+=`\nTo see more results, use start=${r+t} with the same search term.\n`}return i}catch(t){l.default.error(`Error searching with SerpAPI: ${e}`,t);return`Error searching with SerpAPI: ${t instanceof Error?t.message:"Unknown error occurred"}`}}};t.SerpApi=h,t.SerpApi=h=o([s(0,(0,d.Inject)(u.ConfigService)),n("design:paramtypes",[u.ConfigService])],h)},83049:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioTranscriptionModule=void 0;const n=r(3563),s=r(80885),i=r(34562);let a=class{};t.AudioTranscriptionModule=a,t.AudioTranscriptionModule=a=o([(0,n.Module)({controllers:[s.AudioTranscriptionController],providers:[i.AudioTranscriptionService,s.AudioTranscriptionController]})],a)},83153:e=>{"use strict";e.exports=require("@langchain/core/tools")},83229:function(e,t,r){"use strict";e=r.nmd(e);var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.convertDocxToHtml=async function(e,t={}){await k(e,t);return document.documentElement.outerHTML},t.convertDocxToHtmlDom=k,t.extractRawText=async function(e){w.default.debug("Extracting raw text from DOCX buffer");try{w.default.debug("Starting mammoth raw text extraction");const t=await d.extractRawText({buffer:e});return t.messages&&t.messages.length>0&&w.default.warn("Extraction warnings:",t.messages),t.value}catch(e){throw new Error(`Failed to extract raw text from DOCX: ${e.message}`)}},t.extractDocxXmlFromBytes=async function(e){return w.default.debug("Extracting XML from DOCX buffer"),new Promise(((t,r)=>{try{w.default.debug("Opening DOCX buffer for XML extraction"),g.fromBuffer(e,{lazyEntries:!0},((e,o)=>{if(w.default.debug("DOCX buffer opened"),e)return void r(new Error(`Failed to open DOCX buffer: ${e.message}`));let n="";o.on("entry",(e=>{w.default.debug("Found entry: %s",e.fileName),"word/document.xml"===e.fileName?o.openReadStream(e,((e,o)=>{if(e)return void r(new Error(`Failed to read document.xml: ${e.message}`));const s=[];o.on("data",(e=>s.push(e))),o.on("end",(async()=>{n=Buffer.concat(s).toString("utf8");try{const e=new f.Parser,r=await e.parseStringPromise(n),o=new f.Builder({renderOpts:{pretty:!0}}).buildObject(r);t(o)}catch(e){r(new Error(`Failed to parse XML: ${e.message}`))}}))})):(w.default.debug("Skipping entry: %s",e.fileName),o.readEntry())})),o.on("end",(()=>{w.default.debug("DOCX buffer ended"),n||r(new Error("Invalid .docx file: document.xml not found"))})),w.default.debug("Reading DOCX buffer entry"),o.readEntry()}))}catch(e){r(new Error(`Error processing DOCX buffer: ${e.message}`))}}))},t.extractDocxXml=S,t.editDocxFile=async function(e,t,r,o,n){if(w.default.info("Editing DOCX file: %s",e),w.default.info("Output path: %s",o),!t)throw new Error("Search text cannot be empty");const s=n||await c.promises.mkdtemp(p.join(u.tmpdir(),"docx-edit-"));try{const n=e=>new Promise(((t,r)=>{g.open(e,{lazyEntries:!0},((e,o)=>{e?r(e):t(o)}))})),i=await n(e),a=[];let l="";await new Promise(((e,t)=>{i.on("entry",(e=>{const r=p.join(s,e.fileName);c.mkdirSync(p.dirname(r),{recursive:!0}),i.openReadStream(e,((o,n)=>{if(o)t(o);else{if("word/document.xml"===e.fileName){const e=[];n.on("data",(t=>e.push(t))),n.on("end",(()=>{l=Buffer.concat(e).toString("utf8"),c.writeFileSync(r,l)}))}else{const e=c.createWriteStream(r);n.pipe(e)}a.push(new Promise((e=>{n.on("end",e)})))}})),i.readEntry()})),i.on("end",(()=>e())),i.on("error",t),i.readEntry()})),await Promise.all(a);const d=l.indexOf(t);if(-1===d)throw new Error("Search text not found in document");const u=l.slice(0,d)+r+l.slice(d+t.length);await c.promises.writeFile(p.join(s,"word/document.xml"),u);const f=new y.ZipFile,h=async(e,t="")=>{const r=await c.promises.readdir(e,{withFileTypes:!0});for(const o of r){const r=p.join(e,o.name),n=p.join(t,o.name);o.isDirectory()?await h(r,n):f.addFile(r,n)}};await h(s);const m=c.createWriteStream(o);f.outputStream.pipe(m),await new Promise(((e,t)=>{m.on("close",e),m.on("error",t),f.end()}))}finally{n||await c.promises.rm(s,{recursive:!0,force:!0})}},t.extractSectionsFromDocxBuffer=E,t.extractDocxXmlPartsFromBytes=I,t.extractSectionsFromXmlContent=O,t.extractSections=$;const c=i(r(79896)),l=r(32325),d=i(r(17393)),u=i(r(70857)),p=i(r(16928)),f=i(r(46566)),h=r(11879),m=i(r(39863)),g=i(r(21115)),y=i(r(37020)),v=i(r(76610)),_=v.default||v,w=a(r(19055)),b=1;async function k(e,t={}){w.default.debug("Converting DOCX to HTML with options: %j",t);try{w.default.debug("Starting mammoth conversion");const r=await d.convertToHtml({buffer:e});r.messages&&r.messages.length>0&&w.default.warn("Conversion warnings:",r.messages);let o=r.value;t.wrapperElement&&(w.default.debug("Adding wrapper element: %s",t.wrapperElement),o=`<html><head></head><body>${o}</body></html>`);let n=new l.JSDOM(o).window.document;if(t.removeImages){const e=n.getElementsByTagName("img");for(;e.length>0;)e[0].parentNode?.removeChild(e[0])}return n}catch(e){throw new Error(`Failed to convert DOCX to HTML: ${e.message}`)}}async function S(e){return w.default.info("Extracting XML from DOCX file: %s",e),new Promise(((t,r)=>{try{w.default.info("Opening DOCX file for XML extraction"),g.open(e,{lazyEntries:!0},((e,o)=>{if(e)return void r(new Error(`Failed to open DOCX file: ${e.message}`));let n="";o.on("entry",(e=>{"word/document.xml"===e.fileName?o.openReadStream(e,((e,o)=>{if(e)return void r(new Error(`Failed to read document.xml: ${e.message}`));const s=[];o.on("data",(e=>s.push(e))),o.on("end",(async()=>{n=Buffer.concat(s).toString("utf8");try{const e=new f.Parser,r=await e.parseStringPromise(n),o=new f.Builder({renderOpts:{pretty:!0}}).buildObject(r);t(o)}catch(e){r(new Error(`Failed to parse XML: ${e.message}`))}}))})):o.readEntry()})),o.on("end",(()=>{n||r(new Error("Invalid .docx file: document.xml not found"))})),o.readEntry()}))}catch(e){r(new Error(`Error processing DOCX file: ${e.message}`))}}))}function T(e){if(w.default.debug("Getting XPath for node: %s",e.nodeName),e.nodeType!==b)return w.default.debug("Node is not an element node, returning empty path"),"";let t="",r=e;const o=e.ownerDocument.documentElement,n={};for(let e=0;e<o.attributes.length;e++){const t=o.attributes[e];if(t.name.startsWith("xmlns:")){const e=t.name.split(":")[1];n[e]=t.value}else"xmlns"===t.name&&(n.default=t.value)}function s(e){if(!e)return null;for(const t in n)if(n[t]===e)return t;return null}for(;r&&r.nodeType===b&&"document"!==r.localName;){let e=1,o=r.previousSibling;for(;o;)o.nodeType===b&&o.localName===r.localName&&o.namespaceURI===r.namespaceURI&&e++,o=o.previousSibling;const n=s(r.namespaceURI);w.default.info("Node details - localName: %s, namespaceURI: %s, resolved prefix: %s",r.localName,r.namespaceURI,n);t=`/${n?`${n}:${r.localName}`:r.localName}[${e}]`+t,r=r.parentNode}if(r&&r.nodeType===b&&"document"===r.localName){const e=s(r.namespaceURI);t=`/${e?`${e}:${r.localName}`:r.localName}${t}`}return w.default.info("Completed XPath calculation for node: %s, path: %s",e.nodeName,t),t}function R(e,t){let r=t;for(;r;){if(r===e)return!0;r=r.parentNode}return!1}function C(e,t){w.default.debug("Finding label for input node: %s",e.nodeName);let r=e.parentNode;for(;r&&"w:body"!==r.nodeName;){if("w:tr"===r.nodeName){const o=Array.from(r.childNodes).filter((e=>"w:tc"===e.nodeName));w.default.debug("Found %d cells in table row",o.length);for(let n=0;n<o.length;n++){if(R(o[n],e)){w.default.debug("Input node found in cell %d, checking previous cells for label",n);for(let e=n-1;e>=0;e--){const r=t(".//w:t",o[e]).map((e=>e.textContent?.trim())).filter((e=>e)).join(" ");if(r)return w.default.debug("Found label text in same row: %s",r),r}let e=r;for(;e.previousSibling;){const r=e.previousSibling;if("w:tr"===r.nodeName){const e=Array.from(r.childNodes).filter((e=>"w:tc"===e.nodeName));for(const r of e){if(t('.//w:shd[@w:fill="E5E5E5"]',r)[0]){const e=t(".//w:t",r).map((e=>e.textContent?.trim())).filter((e=>e)).join(" ");if(e)return w.default.debug("Found label text in previous row: %s",e),e}}}e=r}}}}r=r.parentNode}return w.default.info("No label found for input node"),null}function P(e,t,r,o){function n(e){const r=t.find((t=>t.xpath===e.xpath));if(r)return r.label!==e.label&&w.default.warn("Found duplicate XPath with different labels. XPath: %s, Existing label: %s, New label: %s",e.xpath,r.label,e.label),void w.default.info("Skipping duplicate input with XPath: %s",e.xpath);t.push(e)}w.default.debug("Processing inputs in section: %s",e.nodeName);const s=r(".//w:sdt",e);w.default.debug("Found %d content controls (sdt nodes)",s.length),s.forEach((e=>{const t=r("./w:sdtPr",e)[0];if(t){let o="text",s="";w.default.debug("Determining input type for sdt node: %s",e.nodeName),w.default.debug("SDT Properties node structure: %j",t.toString());if(r(".//w14:checkbox",t)[0])w.default.debug("Found checkbox node - setting input type to checkbox"),o="checkbox";else{const e=r("./w:richText",t)[0],n=r("./w:text",t)[0];w.default.info("Checking for textarea: richTextNode=%s, textNode=%s",!!e,!!n&&!!r("./w:multiLine",n)[0]),e||n&&r("./w:multiLine",n)[0]?(w.default.debug("Found rich text or multiline text node - setting input type to textarea"),o="textarea"):w.default.debug("No special nodes found - defaulting to text input type")}const i=r("./w:sdtContent",e)[0];if(i){r(".//w:t",i).forEach((e=>{s+=e.textContent||""}))}const a=T(e),c=r("./w:id",t)[0],l=c?c.getAttribute("w:val"):null,d=C(e,r);w.default.info("Processing input node - Type: %s, XPath: %s, ID: %s, Label: %s",o,a,l,d),w.default.info("Original value from XML node: %s",s),n({xpath:a,type:o,id:l,label:d,originalValue:s||null})}}));const i=r(".//w:tc",e);w.default.info("Found %d table cells to process",i.length),i.forEach((e=>{if(r('.//w:tcBorders/w:bottom[@w:val="single"]',e)[0]){const t=r(".//w:t",e).map((e=>e.textContent||"")).join("").trim();if(!o||!t||" "===t){const o=e.parentNode;if(o&&"w:tr"===o.nodeName){const s=Array.from(o.childNodes).filter((e=>"w:tc"===e.nodeName)),i=s.findIndex((t=>t===e));if(i>0){const o=s[i-1],a=r(".//w:t",o).map((e=>e.textContent?.trim())).filter((e=>e)).join(" ");if(a){w.default.info("Found label text from left cell: %s",a);const r=e;w.default.info("Using the cell node itself as the target node");n({xpath:T(r),type:"text",id:null,label:a,originalValue:t||null})}else w.default.info("Left cell exists but has no text, skipping input")}else w.default.info("No cell to the left, skipping input")}else w.default.info("Could not find parent row for cell, skipping input")}}}));const a=r(".//w:t",e);w.default.info("Found %d text nodes to process",a.length),a.forEach((e=>{const t=e.textContent||"",s=t.replace(/[\s\u00A0]/g,"");if(!o||""===s){let o=!0,s=e.parentNode;for(;s;){if("w:tc"===s.nodeName){if(r('.//w:tcBorders/w:bottom[@w:val="single"]',s)[0])break;o=!1;break}s=s.parentNode}if(o){let o=null,s="r",i=e.parentNode;for(;i&&"w:r"!==i.nodeName;)i=i.parentNode;if(i)o=i,w.default.info("Found parent w:r node");else{let t=e.parentNode;for(;t&&"w:p"!==t.nodeName;)t=t.parentNode;t&&(o=t,s="p",w.default.info("No w:r node found, falling back to w:p node"))}if(o){const e=T(o),i=C(o,r);w.default.info("Processing text node - Node type: w:%s, XPath: %s, Label: %s",s,e,i),w.default.info("Original value from XML node: %s",t),n({xpath:e,type:"text",id:null,label:i,originalValue:t||null})}else w.default.warn("No suitable node (w:t or w:r) found for text node. Skipping this text node.")}else w.default.info("Skipping text node in table cell without bottom border")}}))}async function E(e,t=!0){w.default.info("Extracting sections from DOCX buffer");const{documentXml:r,stylesXml:o}=await I(e);return O(r,o,t)}async function I(e){if(w.default.info("Extracting XML parts from DOCX buffer"),!e||0===e.length)throw new Error("Invalid buffer: Buffer is empty");try{if(!_(e))throw new Error("Invalid buffer: Not a valid ZIP archive")}catch(e){throw w.default.error("Error validating ZIP buffer:",e),new Error("Failed to validate DOCX buffer: "+e.message)}return new Promise(((t,r)=>{try{w.default.info("Opening DOCX buffer for XML extraction");let o=setTimeout((()=>{r(new Error("Operation timed out while opening DOCX buffer"))}),5e3);g.fromBuffer(e,{lazyEntries:!0},((e,n)=>{if(clearTimeout(o),e||!n)return void r(new Error(`Failed to open DOCX buffer: ${e?.message}`));w.default.info("DOCX buffer opened successfully");let s=null,i=null;const a=new Set(["word/document.xml","word/styles.xml"]);n.on("entry",(e=>{w.default.info("Found entry: %s",e.fileName),a.has(e.fileName)?n.openReadStream(e,((o,c)=>{if(o||!c)return void r(new Error(`Failed to read ${e.fileName}: ${o?.message}`));const l=[];c.on("data",(e=>l.push(e))),c.on("end",(()=>{const r=Buffer.concat(l).toString("utf8");"word/document.xml"===e.fileName?s=r:"word/styles.xml"===e.fileName&&(i=r),a.delete(e.fileName),0===a.size?(n.close(),t({documentXml:s,stylesXml:i})):n.readEntry()})),c.on("error",(t=>{r(new Error(`Error reading ${e.fileName}: ${t.message}`))}))})):n.readEntry()})),n.on("end",(()=>{w.default.info("Finished reading DOCX entries"),a.size>0&&r(new Error("Invalid .docx file: Missing "+(a.has("word/document.xml")?"document.xml":"styles.xml")))})),n.on("error",(e=>{r(new Error(`Error processing DOCX buffer: ${e.message}`))})),w.default.info("Reading first entry in DOCX buffer"),n.readEntry()}))}catch(e){r(new Error(`Error processing DOCX buffer: ${e.message}`))}}))}async function O(e,t,r=!0){w.default.info("Parsing XML document: start of document: \n%s",e.slice(0,2e3));const o=(new h.DOMParser).parseFromString(e,"application/xml");if(!o||!o.documentElement)throw new Error("Failed to parse XML document");const n=o.documentElement,s={};for(let e=0;e<n.attributes.length;e++){const t=n.attributes[e];if(t.name.startsWith("xmlns:")){s[t.name.split(":")[1]]=t.value}else"xmlns"===t.name&&(s.default=t.value)}s.w||(s.w="http://schemas.openxmlformats.org/wordprocessingml/2006/main");const i=m.useNamespaces(s),a=[];w.default.info("Selecting document body node with namespaces: %j",s);const c=i("//w:body",o);if(!c||0===c.length)throw w.default.error("Could not find document body node. Available nodes: %s",Array.from(o.documentElement.childNodes).filter((e=>1===e.nodeType)).map((e=>e.nodeName)).join(", ")),new Error("Could not find document body node");const l=c[0];if(!l)throw new Error("Document body node is null");const u=Array.from(l.childNodes||[]);w.default.info("Found %d child nodes in document body",u.length);for(let e=0;e<u.length;e++){const o=u[e];if(1===o.nodeType)try{w.default.info("Processing section node: %s",o.nodeName);const e=T(o),s=(new h.XMLSerializer).serializeToString(o),c=[];P(o,c,i,r);const l=Array.from(n.attributes),u=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n  <w:document ${l.filter((e=>e.name.startsWith("xmlns:")||"xmlns"===e.name)).map((e=>`${e.name}="${e.value}"`)).join(" ")}>\n    <w:body>\n      ${s}\n    </w:body>\n  </w:document>`;w.default.info("Converting section to HTML: %s",e);const p=new y.ZipFile;w.default.info("Adding content types to zip");const f='<?xml version="1.0" encoding="UTF-8"?>\n<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">\n  <Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>\n  <Default Extension="xml" ContentType="application/xml"/>\n  <Override PartName="/word/document.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml"/>\n  <Override PartName="/word/styles.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml"/>\n</Types>';p.addBuffer(Buffer.from(f),"[Content_Types].xml"),w.default.info("Adding relationships to zip");const m='<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">\n  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="word/document.xml"/>\n</Relationships>';p.addBuffer(Buffer.from(m),"_rels/.rels"),w.default.info("Adding document.xml to zip"),p.addBuffer(Buffer.from(u),"word/document.xml"),w.default.info("Adding styles.xml to zip"),p.addBuffer(Buffer.from(t),"word/styles.xml"),w.default.info("Adding document.xml.rels to zip");const g='<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">\n  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="styles.xml"/>\n</Relationships>';p.addBuffer(Buffer.from(g),"word/_rels/document.xml.rels"),w.default.info("Finalizing zip");const v=await new Promise(((e,t)=>{const r=[];p.outputStream.on("data",(e=>r.push(e))),p.outputStream.on("end",(()=>e(Buffer.concat(r)))),p.outputStream.on("error",t),p.end()}));w.default.info("Converting section to HTML");const _=await d.convertToHtml({buffer:v});w.default.info("Mammoth result: %s",_);const b={xpath:e,convertedHtml:_.value,potentialInputs:c};w.default.info("Unescaped RAW XML for the section: %s",s),w.default.info("Resulting section: %s",JSON.stringify(b,null,2)),a.push(b)}catch(t){w.default.error(t),w.default.error("Failed to convert XML to HTML for section with index %s: %s",e,t.message)}}return{sections:a}}async function $(e,t=!1){w.default.info("Extracting sections from DOCX file: %s",e);return E(c.readFileSync(e),t)}if(r.c[r.s]===e){const e=process.argv.slice(2);e.length<1&&(console.error("Usage: node docxExtractor.js <path-to-docx-file> [sections|xml]"),process.exit(1));const t=e[0],r=e[1]||"sections";let o=!0;switch(e.length>1&&"false"===e[1]&&(o=!1),r){case"sections":$(t,o).then((e=>{console.log(JSON.stringify(e,null,2))})).catch((e=>{console.error("Failed to extract DOCX sections:",e),process.exit(1)}));break;case"xml":S(t).then((e=>{console.log(e)})).catch((e=>{console.error("Failed to extract DOCX XML:",e),process.exit(1)}));break;default:console.error('Invalid command. Use "sections" or "xml"'),process.exit(1)}}},83622:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeneralAgentBehaviorComponent=void 0;t.GeneralAgentBehaviorComponent=class{constructor(){this.id="general-agent-behavior",this.name="General Agent Behavior",this.description="Communication style, task approach, and general behavioral guidelines",this.category="optional",this.canOptOut=!0,this.defaultEnabled=!0}getContent(e){return"RULES\n\nCommunication Style:\n- You are STRICTLY FORBIDDEN from starting your messages with \"Great\", \"Certainly\", \"Okay\", \"Sure\". You should NOT be conversational in your responses, but rather direct and to the point. For example you should NOT say \"Great, I've updated the CSS\" but instead something like \"I've updated the CSS\". It is important you be clear and technical in your messages.\n- NEVER end attempt_completion result with a question or request to engage in further conversation! Formulate the end of your result in a way that is final and does not require further input from the user.\n\nTask Execution Approach:\n- Your goal is to try to accomplish the user's task, NOT engage in a back and forth conversation.\n- Do not ask for more information than necessary. Use the tools provided to accomplish the user's request efficiently and effectively. When you've completed your task, you must use the attempt_completion tool to present the result to the user. The user may provide feedback, which you can use to make improvements and try again.\n- You are only allowed to ask the user questions using the ask_followup_question tool. Use this tool only when you need additional details to complete a task, and be sure to use a clear and concise question that will help you move forward with the task. However if you can use the available tools to avoid having to ask the user questions, you should do so. For example, if the user mentions a file that may be in an outside directory like the Desktop, you should use the list_files tool to list the files in the Desktop and check if the file they are talking about is there, rather than asking the user to provide the file path themselves.\n\nContent Handling:\n- The user may provide a file's contents directly in their message, in which case you shouldn't use the read_file tool to get the file contents again since you already have it.\n- When presented with images, utilize your vision capabilities to thoroughly examine them and extract meaningful information. Incorporate these insights into your thought process as you accomplish the user's task.\n- At the end of each user message, you will automatically receive environment_details. This information is not written by the user themselves, but is auto-generated to provide potentially relevant context about the project structure and environment. While this information can be valuable for understanding the project context, do not treat it as a direct part of the user's request or response. Use it to inform your actions and decisions, but don't assume the user is explicitly asking about or referring to this information unless they clearly do so in their message. When using environment_details, explain your actions clearly to ensure the user understands, as they may not be aware of these details.\n- Before executing commands, check the \"Actively Running Terminals\" section in environment_details. If present, consider how these active processes might impact your task. For example, if a local development server is already running, you wouldn't need to start it again. If no active terminals are listed, proceed with command execution as normal.\n\nCode Quality and Project Considerations:\n- When creating a new project (such as an app, website, or any software project), organize all new files within a dedicated project directory unless the user specifies otherwise. Use appropriate file paths when creating files, as the write_to_file tool will automatically create any necessary directories. Structure the project logically, adhering to best practices for the specific type of project being created. Unless otherwise specified, new projects should be easily run without additional setup, for example most projects can be built in HTML, CSS, and JavaScript - which you can open in a browser.\n- Be sure to consider the type of project (e.g. Python, JavaScript, web application) when determining the appropriate structure and files to include. Also consider what files may be most relevant to accomplishing the task, for example looking at a project's manifest file would help you understand the project's dependencies, which you could incorporate into any code you write.\n- When making changes to code, always consider the context in which the code is being used. Ensure that your changes are compatible with the existing codebase and that they follow the project's coding standards and best practices.\n- When you want to modify a file, use the replace_in_file or write_to_file tool directly with the desired changes. You do not need to display the changes before using the tool."}}},83807:e=>{"use strict";e.exports=require("simple-git")},83936:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionRepository=void 0;const i=r(3563);r(31832);let a=class{constructor(e){this.knex=e}async findAll(e,t,r){let o=this.knex("sessions").select("*"),n=this.knex("sessions").count("* as count");r&&(o=o.where(r),n=n.where(r)),t&&(o=o.orderBy(t.field,t.order.toLowerCase()));const s=await n.first(),i=s?.count;if(e){const{page:t,limit:r}=e,n=(t-1)*r;o=o.offset(n).limit(r)}return{sessions:await o,total:i}}async findById(e){return this.knex("sessions").where("sessionId",e).first()}async create(e){await this.knex("sessions").insert(e)}async update(e,t){await this.knex("sessions").where("sessionId",e).update(t)}async delete(e){await this.knex("sessions").where("sessionId",e).delete()}async count(e){const t=this.knex("sessions").count("* as count");e&&t.where(e);const r=await t.first();return r?.count}async createItem(e){await this.knex("item").insert(e)}async findItemsBySessionId(e){return this.knex("item").where("sessionId",e).orderBy("createdAt","asc")}async updateItem(e,t){await this.knex("item").where("itemId",e).update(t)}};t.SessionRepository=a,t.SessionRepository=a=o([(0,i.Injectable)(),s(0,(0,i.Inject)("KNEX")),n("design:paramtypes",[Function])],a)},84105:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ModelHistoryService=void 0;const a=r(3563),c=(r(31832),r(59100)),l=i(r(19055));let d=class{constructor(e){this.knex=e,this.serviceName="ModelHistoryService"}async recordModelChoice(e){const{userId:t,mode:r,providerId:o,modelId:n,modelName:s,thinkingTokensEnabled:i,thinkingTokens:a}=e,d=new Date;try{const e=await this.knex("user_model_history").where({userId:t,mode:r,providerId:o,modelId:n,thinkingTokensEnabled:i}).first();let u;if(e){l.default.info(`[${this.serviceName}] Updating existing model history entry for user ${t}, mode ${r}, model ${n}`);const[o]=await this.knex("user_model_history").where({id:e.id}).update({thinkingTokens:a,modelName:s,lastUsedAt:d,updatedAt:d}).returning("*");u=o}else{l.default.info(`[${this.serviceName}] Creating new model history entry for user ${t}, mode ${r}, model ${n}`);const e=(0,c.ulid)(),[p]=await this.knex("user_model_history").insert({id:e,userId:t,mode:r,providerId:o,modelId:n,modelName:s,thinkingTokensEnabled:i,thinkingTokens:a,lastUsedAt:d,createdAt:d,updatedAt:d}).returning("*");u=p}return await this.pruneOldEntries(t,r),u}catch(e){return l.default.error(`[${this.serviceName}] Error recording model choice for user ${t}: ${e.message}`,e.stack),null}}async getModelHistory(e,t){try{const r=await this.knex("user_model_history").where({userId:e,mode:t}).orderBy("lastUsedAt","desc").limit(5);return l.default.info(`[${this.serviceName}] Retrieved ${r.length} model history entries for user ${e}, mode ${t}`),r}catch(t){return l.default.error(`[${this.serviceName}] Error retrieving model history for user ${e}: ${t.message}`,t.stack),[]}}async pruneOldEntries(e,t){try{const r=await this.knex("user_model_history").where({userId:e,mode:t}).orderBy("lastUsedAt","desc").select("id");if(r.length>5){const o=r.slice(5).map((e=>e.id));o.length>0&&(l.default.info(`[${this.serviceName}] Pruning ${o.length} old model history entries for user ${e}, mode ${t}`),await this.knex("user_model_history").whereIn("id",o).del())}}catch(t){l.default.error(`[${this.serviceName}] Error pruning old entries for user ${e}: ${t.message}`,t.stack)}}};t.ModelHistoryService=d,t.ModelHistoryService=d=o([(0,a.Injectable)(),s(0,(0,a.Inject)("KNEX")),n("design:paramtypes",[Function])],d)},84193:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.HomeModule=void 0;const n=r(3563),s=r(30538),i=r(57967),a=r(91367);let c=class{};t.HomeModule=c,t.HomeModule=c=o([(0,n.Module)({imports:[i.ConfigModule,(0,n.forwardRef)((()=>a.EveAgentModule))],providers:[s.HomeService],exports:[s.HomeService]})],c)},84358:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SchemePackageManager=void 0;const l=r(3563),d=a(r(16928)),u=a(r(70857)),p=a(r(91943)),f=r(38547);let h=class{constructor(e){this.schemes=new Map(e.map((e=>[e.getName(),e])))}getScheme(e){const t=this.schemes.get(e);if(!t)throw new Error(`Unknown scheme: ${e}`);return t}async downloadAndStoreSources(e,t,r){const o=this.schemes.get(e);if(!o)return new f.SourceArtefact({scheme:e,locator:t,valid:!1,error:`Unknown scheme: ${e}`,repo:"",cacheSrcBaseDir:""});const n=d.join(u.homedir(),".eve","cached-sources");try{return await o.downloadAndStoreSources(t,n,r)}catch(r){return new f.SourceArtefact({scheme:e,locator:t,valid:!1,error:r instanceof Error?r.message:"Unknown error occurred",repo:"",cacheSrcBaseDir:""})}}async deleteSourceCache(e){if(e)try{await p.rm(e,{recursive:!0,force:!0})}catch(e){console.error(`Error deleting source cache directory: ${e}`)}}async needsImport(e){const t=this.schemes.get(e.scheme);return!t||await t.needsImport(e)}};t.SchemePackageManager=h,t.SchemePackageManager=h=i([(0,l.Injectable)(),c("design:paramtypes",[Array])],h)},84390:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchFilesTool=void 0;const u=r(3563),p=r(35317),f=r(39023),h=d(r(19055)),m=c(r(16928)),g=c(r(91943)),y=r(20436),v=r(9581),_=r(2410),w=(0,f.promisify)(p.exec),b=500,k=10485760;let S=n=class extends y.BaseTool{constructor(e,t){super(t),this.name="search_files",this.description="Request to perform a regex search across files in a specified directory.",this.rgPath=null,this.workingDir=e}async findRipgrepPath(){const e="win32"===process.platform,t=e?"rg.exe":"rg",r=[m.join(process.cwd(),"node_modules","@vscode","ripgrep","bin",t),m.join(process.cwd(),"node_modules","vscode-ripgrep","bin",t),t];for(const t of r)try{return await w(`${e?`"${t}"`:t} --version`),t}catch(e){}return null}truncateOutputIfNeeded(e){const t=e.split("\n");if(t.length<=50)return e;return t.slice(0,50).join("\n")+"\n⚠️ WARNING: Search results have been truncated to 50 lines due to size limits.\nFor complete results, try:\n- Using a more specific regex pattern\n- Narrowing the search path to a specific subdirectory\n- Adding a more restrictive file_pattern (e.g., '*.ts', '*.js')\n- Searching for more unique terms"}getModeSpecificGuidance(e){return null}getBaseUsageInstructions(e){return`## search_files\nDescription: **LAST RESORT SEARCH TOOL** - Only use this tool after first trying list_files with up to 3 targeted calls. This performs regex search across files when repository structure exploration via list_files hasn't provided the needed information. This tool searches for patterns or specific content across multiple files, displaying each match with encapsulating context. Uses ripgrep (rg) if available for performance, otherwise falls back to Node.js search.\n\n**WHEN TO USE THIS TOOL:**\n- After making up to 3 targeted list_files calls on relevant directories\n- When you need to find specific patterns/content rather than understand structure\n- When list_files exploration hasn't revealed the information you need\n- For searching specific text patterns across multiple files\n\nSEARCH STRATEGY GUIDELINES:\n- Craft regex patterns balancing specificity and flexibility\n- Use for: code patterns, TODO comments, function definitions, text content\n- Results include context - analyze surrounding code for better understanding\n- Leverage in combination: search_files → read_file → replace_in_file\n- More effective than running terminal commands like ls or grep\n\nParameters:\n- path: (required) The path of the directory to search in (relative to the current working directory ${e.workingDir}). This directory will be recursively searched.\n- regex: (required) The regular expression pattern to search for. Uses Rust regex syntax if ripgrep is used, standard JS regex if fallback is used.\n- file_pattern: (optional) Glob pattern to filter files (e.g., '*.ts' for TypeScript files). If not provided, it will search all files (*).\n\nUsage:\n<search_files>\n<path>Directory path here</path>\n<regex>Your regex pattern here</regex>\n<file_pattern>file pattern here (optional)</file_pattern>\n</search_files>`}validateParams(e){return"string"==typeof e.path&&""!==e.path.trim()&&"string"==typeof e.regex&&""!==e.regex.trim()}async execute(e){const{path:t,regex:r,file_pattern:o}=e;h.default.info(`[${n.name}] Searching files in directory: ${t}, regex: ${r}, file_pattern: ${o}, relative to ${this.workingDir}`);const s=m.resolve(this.workingDir,t);if(!s.startsWith(this.workingDir)){const e=`Path traversal attempt detected: ${t} resolves outside of workspace ${this.workingDir}`;throw h.default.error(`[${n.name}] ${e}`),new v.FileSystemError(e,"PATH_TRAVERSAL_ERROR")}try{if(!(await g.stat(s)).isDirectory())throw new v.FileSystemError(`Search path is not a directory: ${t}`,"NOT_A_DIRECTORY")}catch(e){if("ENOENT"===e.code){const e=`Search path not found: ${t}`;throw h.default.error(`[${n.name}] ${e}`),new v.FileNotFoundError(e,t)}throw h.default.error(`[${n.name}] Error accessing search path ${t}: ${e.message}`),new v.FileSystemError(`Error accessing search path: ${e.message}`,e.code||"FS_ACCESS_ERROR")}try{if(null===this.rgPath&&(this.rgPath=await this.findRipgrepPath(),this.rgPath?h.default.info(`[${n.name}] Ripgrep found at: ${this.rgPath}`):h.default.warn(`[${n.name}] Ripgrep (rg) command not found. Falling back to Node.js search. Install ripgrep for better performance (e.g., 'brew install ripgrep' or 'apt-get install ripgrep').`)),!this.rgPath)return h.default.info(`[${n.name}] Using Node.js fallback search.`),this.nodeJsSearch(s,r,o);try{return h.default.info(`[${n.name}] Attempting search with ripgrep.`),await this.executeRipgrep(this.rgPath,s,r,o)}catch(e){return h.default.warn(`[${n.name}] Ripgrep execution failed: ${e.message}. Falling back to Node.js search.`),this.nodeJsSearch(s,r,o)}}catch(e){if(e instanceof v.FileNotFoundError||e instanceof v.FileSystemError)throw e;const r=`Error searching files in directory ${t}: ${e.message}`;throw h.default.error(`[${n.name}] ${r}\n${e.stack}`),new v.FileSystemError(r,e.code||"FS_SEARCH_ERROR")}}async executeRipgrep(e,t,r,o){return new Promise(((s,i)=>{const a=["--json","--context","2","--no-heading","--color","never","--line-number","--max-count",String(b)];a.push("--regexp",r),o&&a.push("--glob",o),a.push(t),h.default.debug(`[${n.name}] Executing ripgrep: ${e} ${a.join(" ")}`);const c=(0,p.spawn)(e,a,{cwd:this.workingDir,stdio:["ignore","pipe","pipe"]});let l="",d="";c.stdout.on("data",(e=>{l+=e.toString(),l.length>20971520&&(h.default.warn(`[${n.name}] Ripgrep stdout buffer exceeded limit, killing process.`),c.kill(),i(new v.FileSystemError("Ripgrep output exceeded size limit","OUTPUT_TOO_LARGE")))})),c.stderr.on("data",(e=>{d+=e.toString()})),c.on("close",(e=>{if(0!==e&&1!==e){const t=`Ripgrep exited with code ${e}: ${d||"No stderr output"}`;return h.default.error(`[${n.name}] ${t}`),void i(new v.FileSystemError(t,"RIPGREP_EXEC_ERROR"))}!d||d.includes("using explicit glob")||d.includes("No files were searched")||h.default.warn(`[${n.name}] Ripgrep stderr output: ${d}`);try{const e=this.parseRipgrepOutput(l),t=this.truncateOutputIfNeeded(e);s(t)}catch(e){h.default.error(`[${n.name}] Error parsing ripgrep output: ${e.message}\n${e.stack}`),i(new v.FileSystemError(`Error parsing ripgrep output: ${e.message}`,"PARSE_ERROR"))}})),c.on("error",(t=>{h.default.error(`[${n.name}] Error spawning ripgrep process: ${t.message}\n${t.stack}`),"ENOENT"===t.code?i(new v.FileSystemError(`Failed to execute ripgrep binary at ${e}. Ensure it's installed and executable.`,"RIPGREP_SPAWN_ENOENT")):i(new v.FileSystemError(`Error executing ripgrep: ${t.message}`,"RIPGREP_SPAWN_ERROR"))}))}))}async nodeJsSearch(e,t,r){let o=0,s="";const i=new RegExp(t);try{const t=r?m.join(e,"**",r):m.join(e,"**","*"),a=await(0,_.glob)(t,{nodir:!0,absolute:!0,ignore:["**/node_modules/**","**/.git/**"]});for(const e of a){if(o>=b){s+="\nSearch stopped after reaching 500 results.";break}try{if((await g.stat(e)).size>k){h.default.warn(`[${n.name}] Skipping large file (Node.js search): ${e}`);continue}const t=(await g.readFile(e,"utf-8")).split("\n");let r=!1,a="";for(let n=0;n<t.length&&!(i.test(t[n])&&(r||(a+=`\n${m.relative(this.workingDir,e)}:\n`,r=!0),a+=`  ${n+1}: ${t[n]}\n`,o++,o>=b));n++);r&&(s+=a)}catch(t){h.default.warn(`[${n.name}] Error reading file ${e}: ${t.message}`)}}const c=s.trim()||"No matches found.";return this.truncateOutputIfNeeded(c)}catch(e){throw h.default.error(`[${n.name}] Error during Node.js file search globbing: ${e.message}`),new v.FileSystemError(`Error finding files to search: ${e.message}`,"GLOB_ERROR")}}parseRipgrepOutput(e){if(!e.trim())return"No matches found.";const t=e.trim().split("\n"),r=[];let o=0;for(const e of t)try{if(e.trim()){const t=JSON.parse(e);r.push(t)}}catch(t){o++,o<5?h.default.warn(`[${n.name}] Error parsing ripgrep JSON line: ${t.message}. Line: "${e}"`):5===o&&h.default.warn(`[${n.name}] Too many ripgrep JSON parse errors, suppressing further warnings.`)}if(0===r.length&&o>0)return`Error: Could not parse ripgrep output. Found ${o} invalid JSON lines.`;if(0===r.length)return"No matches found.";let s="",i="",a=0;for(const e of r)if("match"===e.type){a++;const{path:t,lines:r,line_number:o}=e.data,n=t?.text||"unknown_file",c=m.relative(this.workingDir,n);c!==i&&(""!==i&&(s+="\n"),i=c,s+=`${i}:\n`),s+=`  ${o}: ${r.text.trimEnd()}\n`}else if("context"===e.type){const{path:t,lines:r,line_number:o}=e.data,n=t?.text||"unknown_file";m.relative(this.workingDir,n)}return(r.length>=b?"Showing first 500 matches.\n\n":`Found ${a} ${1===a?"match":"matches"}.\n\n`)+(s.trim()||"No matches found.")}};t.SearchFilesTool=S,t.SearchFilesTool=S=n=a([(0,u.Injectable)(),l("design:paramtypes",[String,Object])],S)},84480:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERCEL_PROVIDER_ID=t.getStaticVercelModels=t.getDefaultVercelModelId=t.discoverVercelModels=t.VercelAdapter=t.VercelProvider=void 0;var o=r(71618);Object.defineProperty(t,"VercelProvider",{enumerable:!0,get:function(){return o.VercelProvider}});var n=r(59512);Object.defineProperty(t,"VercelAdapter",{enumerable:!0,get:function(){return n.VercelAdapter}});var s=r(51921);Object.defineProperty(t,"discoverVercelModels",{enumerable:!0,get:function(){return s.discoverVercelModels}}),Object.defineProperty(t,"getDefaultVercelModelId",{enumerable:!0,get:function(){return s.getDefaultVercelModelId}}),Object.defineProperty(t,"getStaticVercelModels",{enumerable:!0,get:function(){return s.getStaticVercelModels}}),Object.defineProperty(t,"VERCEL_PROVIDER_ID",{enumerable:!0,get:function(){return s.VERCEL_PROVIDER_ID}})},85266:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.FileFiltersFactory=void 0;const n=r(3563);let s=class{static depthFilter(e){const t=(t,r)=>r.currentDepth>e?"prune-children":"include";return Object.defineProperty(t,"name",{value:"depthFilter",writable:!0}),t}static defaultRootIgnoreFilter(){const e=/^(?:node_modules|dist|build|target|out|bin|vendor|\.git|\.eve|\.next|\.nuxt|\.output|coverage|\.nyc_output|\.cache|\.parcel-cache|\.yarn|\.pnpm-store|__pycache__|env|venv|tmp|temp|deps|pkg|Pods)(?:\/|$)/,t=t=>{if(e.test(t.path))return"exclude";const r=t.path.split("/");for(const t of r)if(e.test(t+"/"))return"exclude";return"include"};return Object.defineProperty(t,"name",{value:"defaultRootIgnoreFilter",writable:!0}),t}static limitFilter(e){const t=(t,r)=>{if(e.maxItems&&r.stats.nodesIncluded>=e.maxItems)return"exclude";if(e.maxBytes&&r.stats.bytesIncluded+(t.sizeBytes||0)>e.maxBytes)return"exclude";if(e.maxTokens){const o=t.path.length/4;if(r.stats.estimatedTokens+o>e.maxTokens)return"exclude"}return"include"};return Object.defineProperty(t,"name",{value:"limitFilter",writable:!0}),t}static extensionFilter(e,t=!0){const r=e.map((e=>e.toLowerCase().startsWith(".")?e.toLowerCase():`.${e.toLowerCase()}`)),o=e=>{if(e.isDir&&t)return"include";if(!e.isDir){const t=e.path.toLowerCase();return r.some((e=>t.endsWith(e)))?"include":"exclude"}return"exclude"};return Object.defineProperty(o,"name",{value:"extensionFilter",writable:!0}),o}};t.FileFiltersFactory=s,t.FileFiltersFactory=s=o([(0,n.Injectable)()],s)},85515:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReadWorkspaceTree=void 0;const o=r(83153),n=r(11569),s=r(6426);class i extends o.Tool{constructor(e){super(),this.name="read_workspace_tree",this.description="Read the workspace file tree, respecting .gitignore and .aiderignore files",this.schema=n.z.object({}),this.workspaceRootDir=e}async _call(){return(0,s.generateTree)(this.workspaceRootDir)}}t.ReadWorkspaceTree=i},85915:e=>{"use strict";e.exports=require("tree-sitter-java")},86158:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolFactoryService=void 0;const a=r(3563),c=r(77602),l=i(r(19055)),d=r(88474),u=r(33153),p=r(7373),f=r(33923),h=r(44970),m=r(37465),g=r(97793),y=r(3765),v=r(85515),_=r(25996),w=r(61781),b=r(7600),k=r(72626),S=r(4911),T=r(53716),R=r(72923),C=r(54500),P=r(50042),E=r(69461),I=r(95188),O=r(308),$=r(82900),M=r(65018),A=r(93239),x=r(26696),D=r(47205),N=r(34934),j=r(61983),F=r(62397),L=r(52368),U=r(76910);let B=o=class{constructor(e,t,r,o,n,s,i,a,c){this.mutationsService=e,this.workspaceService=t,this.sourceArtefactService=r,this.sessionService=o,this.summaryCompletion=n,this.datasetRetrievalService=s,this.storedFileService=i,this.mcpToolFactoryService=a,this.configService=c,this.toolMap={update_file:e=>new f.UpdateFile(e.getToolBaseDir(),this.mutationsService,e.sessionId,e.requestId),read_file:e=>new h.ReadFile(e.getToolBaseDir()),read_port_from_file:e=>new g.ReadPortFromFile(e.workspace.portFromBaseDir),delete_file:e=>new m.DeleteFile(e.getToolBaseDir()),command_line:e=>new y.CommandLine(e.getToolBaseDir(),this.summaryCompletion),mcp_test:e=>new M.MCPTest(e.getToolBaseDir()),read_workspace_tree:e=>new v.ReadWorkspaceTree(e.getToolBaseDir()),add_workspace:e=>new _.AddWorkspace(this.workspaceService,e.getToolBaseDir()),fetch_web_page:()=>new w.FetchWebPage(this.summaryCompletion),read_dependency_source_tree:()=>new b.ReadDependencySourceTree(this.sourceArtefactService),read_dependency_source_file:()=>new k.ReadDependencySourceFile(this.sourceArtefactService),git_commit:e=>new S.GitCommit(e.getToolBaseDir(),e.requestId,this.sessionService),git_init:e=>new T.GitInit(e.getToolBaseDir()),current_timestamp:()=>new R.CurrentTimestamp,dataset_retrieval:()=>new C.DatasetRetrieval(this.datasetRetrievalService),docx_to_html:()=>new P.DocxToHtml(this.storedFileService),list_files:e=>new E.ListFiles(e.getToolBaseDir()),grep:e=>new I.Grep(e.getToolBaseDir()),find_files:e=>new O.FindFiles(e.getToolBaseDir()),serp_api:()=>new $.SerpApi(this.configService),computer:()=>{switch(process.platform){case"linux":return new N.ComputerToolLinux;case"darwin":return new j.ComputerToolMac;case"win32":throw new Error("ComputerTool is not supported on Windows yet.");default:throw new Error(`Unsupported platform: ${process.platform}`)}}}}toSnakeCase(e){return e.split(/(?=[A-Z])/).join("_").toLowerCase()}registerTool(e,t){const r=this.toSnakeCase(e);this.toolMap[r]=t,l.default.info(`[${o.name}] Registered new tool: ${r}`)}async createTools(e,t){const r=e.map((e=>{const r=this.toSnakeCase(e),o=this.toolMap[r];if(!o)throw new Error(`Unknown tool: ${e}`);return o(t)}));if(this.configService.getBooleanProperty(U.ConfigPropNames.MCP_SERVERS_ENABLED,!0))try{const e=await this.mcpToolFactoryService.createMcpTools();e.length>0&&(l.default.info(`[${o.name}] Adding ${e.length} MCP tools to the tool list`),r.push(...e))}catch(e){l.default.error(`[${o.name}] Failed to add MCP tools: ${e.message}`)}else l.default.info(`[${o.name}] MCP servers are disabled, skipping MCP tools`);return r}createTool(e,t){const r=this.toSnakeCase(e),o=this.toolMap[r];if(!o)throw new Error(`Unknown tool: ${e}`);return o(t)}async allTools(e){const t=Object.values(this.toolMap).map((t=>t(e)));if(this.configService.getBooleanProperty(U.ConfigPropNames.MCP_SERVERS_ENABLED,!0))try{const e=await this.mcpToolFactoryService.createMcpTools();e.length>0&&(l.default.info(`[${o.name}] Adding ${e.length} MCP tools to all tools list`),t.push(...e))}catch(e){l.default.error(`[${o.name}] Failed to add MCP tools to all tools: ${e.message}`)}else l.default.info(`[${o.name}] MCP servers are disabled, skipping MCP tools in allTools`);return t}async createMcpTools(e){if(!this.configService.getBooleanProperty(U.ConfigPropNames.MCP_SERVERS_ENABLED,!0))return l.default.info(`[${o.name}] MCP servers are disabled, returning empty array`),[];try{return await this.mcpToolFactoryService.createMcpTools()}catch(e){return l.default.error(`[${o.name}] Failed to create MCP tools: ${e.message}`),[]}}};t.ToolFactoryService=B,t.ToolFactoryService=B=o=n([(0,a.Injectable)(),s("design:paramtypes",[c.MutationsService,d.WorkspaceService,u.SourceArtefactService,p.SessionService,A.SummaryCompletion,x.DatasetRetrievalService,D.StoredFileService,F.McpToolFactoryService,L.ConfigService])],B)},86254:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageUtils=void 0;const n=r(91486),s=o(r(19055));class i{static processOutputEvent(e){try{s.default.debug("Processing output event: %s",JSON.stringify(e));let t,r=e?.messages,o="AI",a="No content found";if(!r&&e?.agent?.messages?r=e.agent.messages:!r&&e?.tools?.messages&&(r=e.tools.messages,o="Tool"),r&&Array.isArray(r)&&r.length>0){const c=r[r.length-1];if(!c)return s.default.warn("Last message is undefined or null"),{label:"Unknown",content:"Invalid message format"};if(c instanceof n.ToolMessage||"tool"===c.type){const e=c.name||"Unknown Tool";if(void 0!==c.content){return{label:"Tool",content:`Calling ${e}\nOutput was:\n${i.processContent(c.content)}`}}return s.default.warn("Tool message has undefined content: %s",JSON.stringify(c)),{label:"Tool",content:`Calling ${e}\nOutput was undefined`}}if(c instanceof n.AIMessage)return void 0!==c.content?(a=i.processContent(c.content),t=this.extractUsageMetadata(c),a.trim().length<1?(s.default.warn("AI message has empty content %s",{lastMessage:JSON.stringify(c)}),{label:"AI",content:JSON.stringify(c),usageMetadata:t}):{label:"AI",content:a,usageMetadata:t}):(s.default.warn("AI message has undefined content: %s",JSON.stringify(c)),{label:"AI",content:"AI message content was undefined",usageMetadata:t});if(c instanceof n.HumanMessage)return void 0!==c.content?(a=i.processContent(c.content),o=a.startsWith("Tool:")?"Tool":"Human",{label:o,content:a}):(s.default.warn("Human message has undefined content: %s",JSON.stringify(c)),{label:"Human",content:"Human message content was undefined"});if(c instanceof n.BaseMessage)return void 0!==c.content?(a=i.processContent(c.content),{label:o,content:a}):(s.default.warn("Base message has undefined content: %s",JSON.stringify(c)),{label:o,content:"Base message content was undefined"});try{s.default.warn("Processing unknown output using strings",{output:JSON.stringify(e)});const r=JSON.stringify(c),n=JSON.parse(r);if(n&&"object"==typeof n&&"kwargs"in n&&n.kwargs&&"object"==typeof n.kwargs&&"content"in n.kwargs)return a=n.kwargs.content,t=this.extractUsageMetadata(n),{label:o,content:a,usageMetadata:t}}catch(e){s.default.error("Error parsing message: %s",e)}}return s.default.warn("Processing unknown output: %s",{output:JSON.stringify(e)}),{label:"Unknown",content:JSON.stringify(e)}}catch(t){return s.default.error("Error in processOutputEvent: %s",t),s.default.error("Output that caused error: %s",JSON.stringify(e)),{label:"Error",content:`Error processing output: ${t.message}. See logs for details.`}}}static processContent(e){if(Array.isArray(e))try{return s.default.debug("Processing array content: %s",JSON.stringify(e)),e.filter((e=>e&&"object"==typeof e)).filter((e=>("text"!==e.type||"text"in e||s.default.warn('Found item with type "text" but missing text property: %s',JSON.stringify(e)),"text"===e.type&&"text"in e))).map((e=>e.text||"")).join("\n")}catch(t){return s.default.error("Error processing content array: %s",t),s.default.error("Content that caused error: %s",JSON.stringify(e)),String(e)}return String(e)}static extractUsageMetadata(e){try{if(!e)return void s.default.warn("Cannot extract usage metadata: message is undefined");const t=e.response_metadata?.usage||e.usage_metadata;if(!t)return void s.default.debug("No usage metadata found in message");s.default.debug("Raw usage data: %s",JSON.stringify(t));const r={inputTokens:t.input_tokens||0,cacheWriteTokens:t.cache_creation_input_tokens||0,cacheReadTokens:t.cache_read_input_tokens||0,outputTokens:t.output_tokens||0,totalTokens:t.total_tokens||0};return s.default.info("extractUsageMetadata - usageMetadata: %s",{usageMetadata:JSON.stringify(r)}),r}catch(t){return s.default.error("Error extracting usage metadata: %s",t),void s.default.error("Message that caused error: %s",JSON.stringify(e))}}static buildHumanMessage(e){try{if("string"==typeof e)return new n.HumanMessage(e);if(Array.isArray(e)){if(s.default.debug("Building human message from array content: %s",JSON.stringify(e)),1===e.length&&e[0]&&"object"==typeof e[0]&&"text"===e[0].type&&"text"in e[0])return new n.HumanMessage(e[0].text);const t=e;return new n.HumanMessage({content:t})}{const t=e;return new n.HumanMessage({content:t})}}catch(t){return s.default.error("Error building human message: %s",t),s.default.error("Content that caused error: %s",JSON.stringify(e)),new n.HumanMessage("Error processing message content")}}}t.MessageUtils=i},86268:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ListCodeDefinitionsTool=void 0;const u=r(3563),p=c(r(91943)),f=d(r(19055)),h=c(r(16928)),m=r(20436),g=r(30873),y=r(41070),v=r(9581),_=r(8984);let w=n=class extends m.BaseTool{constructor(e,t,r,o){super(o),this.treeSitterService=t,this.cacheService=r,this.name="list_code_definition_names",this.description="Request to list definition names (classes, functions, methods, etc.) used in source code files. Uses breadth-first traversal and caching for performance.",this.parameterSchema={path:{type:"string",required:!0,validate:e=>e&&""!==e.trim()},max_files:{type:"number",required:!1,default:100,validate:e=>e>=1&&e<=1e3}},this.workingDir=e}getBaseUsageInstructions(e){return`## list_code_definition_names\nDescription: CODE SIGNATURE ANALYSIS - Use this AFTER understanding file organization via list_files. This extracts the actual source code lines containing function declarations, method signatures, class definitions, and module declarations from source files. You'll see complete signatures with types, parameters, and modifiers - giving you a comprehensive overview of the API surface and architectural patterns without reading full file contents. Focus on specific directories identified through file exploration.\nParameters:\n- path: (required) The path of the directory (relative to the current working directory ${e.workingDir}) to scan for source code definitions.\n- max_files: (optional) Maximum number of files to process (default: 100). Use higher values (150-200) when you've narrowed down to the right areas.\nUsage:\n<list_code_definition_names>\n<path>Directory path here</path>\n<max_files>150</max_files>\n</list_code_definition_names>`}validateParams(e){try{const t=(0,_.convertToolParams)(e,this.parameterSchema);return Object.assign(e,t),!0}catch(e){return f.default.warn(`[${this.name}] Parameter validation failed: ${e.message}`),!1}}async execute(e){const{path:t,max_files:r=100}=e;f.default.info(`[${n.name}] Listing code definitions in directory: ${t} relative to ${this.workingDir} (max_files: ${r})`);const o=h.resolve(this.workingDir,t);if(!o.startsWith(this.workingDir)){const e=`Path traversal attempt detected: ${t} resolves outside of workspace ${this.workingDir}`;throw f.default.error(`[${n.name}] ${e}`),new v.FileSystemError(e,"PATH_TRAVERSAL_ERROR")}try{try{await p.stat(o)}catch(e){if("ENOENT"===e.code){const e=`Path not found: ${t}`;throw f.default.error(`[${n.name}] ${e}`),new v.FileNotFoundError(e,t)}throw e}const e=await this.getSourceCodeFilesBreadthFirst(o,r);if(0===e.length)return"No source code files found in the specified path.";const s=await this.extractDefinitionsWithCache(e),i=this.formatDefinitions(s,this.workingDir);return i+(e.length>=r?`\nProcessed ${e.length} files (limit reached). Use higher max_files for deeper analysis.`:`\nProcessed ${e.length} files.`)}catch(e){if(e instanceof v.FileNotFoundError||e instanceof v.FileSystemError)throw e;const r=`Error listing code definitions in directory ${t}: ${e.message}`;throw f.default.error(`[${n.name}] ${r}\n${e.stack}`),new v.FileSystemError(r,e.code||"FS_LIST_DEFINITIONS_ERROR")}}async getSourceCodeFilesBreadthFirst(e,t){let r;try{r=await p.stat(e)}catch(e){if("ENOENT"===e.code)return[];throw e}if(r.isFile())return this.isSourceCodeFile(e)?[e]:[];if(!r.isDirectory())return[];const o=[e],s=[];for(;o.length>0&&s.length<t;){const e=o.shift();let r;try{r=await p.readdir(e,{withFileTypes:!0})}catch(t){f.default.warn(`[${n.name}] Error reading directory ${e}: ${t.message}`);continue}for(const o of r){if(s.length>=t)break;o.isFile()&&this.isSourceCodeFile(o.name)&&s.push(h.join(e,o.name))}if(s.length<t)for(const t of r)t.isDirectory()&&!this.shouldIgnoreDirectory(t.name)&&o.push(h.join(e,t.name))}return s.slice(0,t)}isSourceCodeFile(e){const t=h.extname(e).toLowerCase().slice(1);return this.treeSitterService.isExtensionSupported(t)}shouldIgnoreDirectory(e){return["node_modules","dist","build","out",".git",".vscode",".idea","__pycache__","venv","env"].includes(e)}async extractDefinitionsWithCache(e){const t=new Map;let r=0,o=0;for(const s of e)try{const e=await p.stat(s),n=e.mtime.getTime(),i=e.size,a=await this.cacheService.getCachedDefinitions(this.workingDir,s,n,i);if(null!==a)r++,a.length>0&&t.set(s,a);else{o++;const e=await p.readFile(s,"utf8"),r=this.treeSitterService.parseDefinitions(s,e);r.length>0&&t.set(s,r),await this.cacheService.setCachedDefinitions(this.workingDir,s,n,i,r)}}catch(e){f.default.warn(`[${n.name}] Error processing file ${s}: ${e.message}`)}return f.default.debug(`[${n.name}] Cache performance: ${r} hits, ${o} misses`),t}getModeSpecificGuidance(e){return null}formatDefinitions(e,t){if(0===e.size)return"No definitions found.";let r="";const o=Array.from(e.keys()).sort();for(const n of o){const o=e.get(n)||[];r+=`\n${h.relative(t,n)}:\n`,o.sort();for(const e of o)r+=`  - ${e}\n`}return r.trim()}};t.ListCodeDefinitionsTool=w,t.ListCodeDefinitionsTool=w=n=a([(0,u.Injectable)(),l("design:paramtypes",[String,g.TreeSitterService,y.TreeSitterCacheService,Object])],w)},86308:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createStateManager=function(){const e={current:void 0,insideFence:!1,tagBuf:"",pendingPrefix:!0,TAG_BUF_LIMIT:100,isBuffering:!1,contentBuffer:"",thinkingContent:"",textContent:"",toolCallCount:0,firstToolCallName:void 0,streamInterrupted:!1,interruptionReason:void 0};return{getState:()=>e,getCurrentBlock:()=>(e.current,e.current),setCurrentBlock:t=>{e.current=t,t&&(e.pendingPrefix=!0)},getTagBuffer:()=>e.tagBuf,setTagBuffer:t=>{e.tagBuf=t},appendTagBuffer:t=>{e.tagBuf+=t,e.tagBuf.length>e.TAG_BUF_LIMIT&&(e.tagBuf=e.tagBuf.slice(0,e.TAG_BUF_LIMIT))},clearTagBuffer:()=>{e.tagBuf,e.tagBuf=""},getBufferedBlockId:()=>e.bufferedBlockId,setBufferedBlockId:t=>{e.bufferedBlockId=t},clearBufferedBlockId:()=>{e.bufferedBlockId,e.bufferedBlockId=void 0},isBufferingContent:()=>e.isBuffering,startBuffering:()=>{e.isBuffering=!0,e.contentBuffer=""},addToBuffer:t=>{e.contentBuffer+=t},getAndClearBuffer:()=>{const t=e.contentBuffer;return e.contentBuffer="",e.isBuffering=!1,t},isInsideFence:()=>e.insideFence,setInsideFence:t=>{e.insideFence=t},isPendingPrefix:()=>e.pendingPrefix,setPendingPrefix:t=>{e.pendingPrefix=t},addThinkingContent:t=>{e.thinkingContent+=t},addTextContent:t=>{e.textContent+=t},setThinkingSignature:t=>{e.thinkingSignature=t},getThinkingContent:()=>e.thinkingContent,getTextContent:()=>e.textContent,getThinkingSignature:()=>e.thinkingSignature,getToolCallCount:()=>e.toolCallCount,incrementToolCallCount:()=>(e.toolCallCount++,e.toolCallCount),setFirstToolCallName:t=>{e.firstToolCallName=t},getFirstToolCallName:()=>e.firstToolCallName,setStreamInterrupted:(t,r)=>{e.streamInterrupted=t,e.interruptionReason=r},isStreamInterrupted:()=>e.streamInterrupted,getInterruptionReason:()=>e.interruptionReason,isInsideToolCall:()=>{const t=e.current;return t&&"tool_call"===t.blockType&&!t.finished},getCurrentToolCallTag:()=>{const t=e.current;return t&&"tool_call"===t.blockType&&!t.finished?t.tagName:null},reset:()=>{e.current=void 0,e.insideFence=!1,e.tagBuf="",e.pendingPrefix=!0,e.isBuffering=!1,e.contentBuffer="",e.bufferedBlockId=void 0,e.thinkingContent="",e.textContent="",e.thinkingSignature=void 0,e.toolCallCount=0,e.firstToolCallName=void 0,e.streamInterrupted=!1,e.interruptionReason=void 0}}}},86540:e=>{"use strict";e.exports=require("tree-sitter-cpp")},86571:(e,t,r)=>{"use strict";const o=r(16928),n=r(39976),s=r(48230),i=r(92529),a="win32"===process.platform,c=/\.(?:com|exe)$/i,l=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function d(e){if(!a)return e;const t=function(e){e.file=n(e);const t=e.file&&i(e.file);return t?(e.args.unshift(e.file),e.command=t,n(e)):e.file}(e),r=!c.test(t);if(e.options.forceShell||r){const r=l.test(t);e.command=o.normalize(e.command),e.command=s.command(e.command),e.args=e.args.map((e=>s.argument(e,r)));const n=[e.command].concat(e.args).join(" ");e.args=["/d","/s","/c",`"${n}"`],e.command=process.env.comspec||"cmd.exe",e.options.windowsVerbatimArguments=!0}return e}e.exports=function(e,t,r){t&&!Array.isArray(t)&&(r=t,t=null);const o={command:e,args:t=t?t.slice(0):[],options:r=Object.assign({},r),file:void 0,original:{command:e,args:t}};return r.shell?o:d(o)}},86808:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.HelloWorldModule=void 0;const n=r(3563),s=r(15096),i=r(45533);let a=class{};t.HelloWorldModule=a,t.HelloWorldModule=a=o([(0,n.Module)({controllers:[s.HelloWorldController],providers:[i.HelloWorldService]})],a)},86997:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FIREWORKS_PROVIDER_ID=void 0,t.discoverFireworksModels=async function(e,r,o){if(!e)return s.default.warn("[FireworksModels] No API key provided, skipping model discovery"),[];try{s.default.debug(`[FireworksModels] Attempting to discover models from: ${r}`);const i=new n.default({apiKey:e,baseURL:r}),a=(await i.models.list()).data;if(!a||0===a.length)return s.default.debug(`[FireworksModels] No models found at ${r}`),[];s.default.info(`[FireworksModels] Discovered ${a.length} models from Fireworks API`);const c=await Promise.all(a.map((async e=>{const r=await o.getModel(e.id),n=e.context_length||r?.specifications.contextWindow||32768,s=e.pricing?.input?1e6*parseFloat(e.pricing.input):.1,i=e.pricing?.output?1e6*parseFloat(e.pricing.output):.1;return{modelId:e.id,providerId:t.FIREWORKS_PROVIDER_ID,name:r?.displayName||e.display_name||e.id,family:r?.family||"unknown",contextWindow:n,maxOutputTokens:r?.specifications.maxOutputTokens||8192,supportsImages:r?.capabilities.supportsVision||!1,supportsToolUse:r?.capabilities.supportsToolUse??!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:s,outputCostPerMillionTokens:i,isDefaultForProvider:"accounts/fireworks/models/llama-v3p3-70b-instruct"===e.id,metadata:{isLocal:!1,originalModelId:e.id,registryMatch:r,fireworksSpecific:{object:e.object}}}})));return c.sort(((e,t)=>e.name.localeCompare(t.name))),s.default.info(`[FireworksModels] Successfully transformed ${c.length} Fireworks models`),c}catch(e){return s.default.error(`[FireworksModels] Fireworks discovery failed: ${e.message}`),[]}},t.getDefaultFireworksModelId=i;const n=o(r(56082)),s=o(r(19055));function i(){return"accounts/fireworks/models/llama-v3p3-70b-instruct"}t.FIREWORKS_PROVIDER_ID="fireworks"},87001:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createPatternUtils=function(){n.default.debug("[AnthropicPatternUtils] Creating pattern utils");const e=/<([A-Za-z_][\w\-.]*)(\s[^>]*)?>/,t=e=>new RegExp(`^</${e}\\s*>`),r=/<([A-Za-z_][\w\-.]*)(\s[^>]*)?\/>/,o=/^```/;return{findOpeningTag:t=>{const r=e.exec(t);return r?(n.default.debug(`[AnthropicPatternUtils] Found opening tag: ${r[1]}`),{found:!0,tagName:r[1],fullMatch:r[0],index:r.index}):{found:!1}},findClosingTag:(e,r)=>{const o=t(r),s=e.match(o);return s?(n.default.debug(`[AnthropicPatternUtils] Found closing tag: ${r}`),{found:!0,fullMatch:s[0],index:s.index}):{found:!1}},findSpecificClosingTag:(e,r)=>{const o=t(r),s=e.match(o);return s?(n.default.debug(`[AnthropicPatternUtils] Found specific closing tag: ${r}`),{found:!0,fullMatch:s[0],index:s.index,afterContent:e.substring(s.index+s[0].length)}):{found:!1}},findSelfClosingTag:e=>{const t=e.match(r);return t?(n.default.debug(`[AnthropicPatternUtils] Found self-closing tag: ${t[1]}`),{found:!0,tagName:t[1],fullMatch:t[0],index:t.index}):{found:!1}},findCodeFence:e=>{const t=e.match(o);return t?(n.default.debug("[AnthropicPatternUtils] Found code fence"),{found:!0,fullMatch:t[0],index:t.index}):{found:!1}},findLeadingWhitespace:e=>{const t=e.match(/^\s+/);return t?(n.default.debug(`[AnthropicPatternUtils] Found leading whitespace: "${t[0]}"`),{found:!0,whitespace:t[0],length:t[0].length}):{found:!1}},findTrailingWhitespace:e=>{const t=e.match(/\s+$/);return t?(n.default.debug(`[AnthropicPatternUtils] Found trailing whitespace: "${t[0]}"`),{found:!0,whitespace:t[0],length:t[0].length}):{found:!1}},endsWithPartialTag:e=>{if(e.match(/<[a-zA-Z0-9_]+$/))return n.default.debug(`[AnthropicPatternUtils] Text ends with partial opening tag: "${e}"`),!0;if(e.match(/<\/[a-zA-Z0-9_]+$/))return n.default.debug(`[AnthropicPatternUtils] Text ends with partial closing tag: "${e}"`),!0;const t=e.lastIndexOf("<");return-1!==t&&-1===e.indexOf(">",t)?(n.default.debug(`[AnthropicPatternUtils] Text ends with unclosed bracket: "${e}"`),!0):!(!e.endsWith("</thinking")&&!e.match(/<\/[a-zA-Z0-9_]+\s*$/))&&(n.default.debug(`[AnthropicPatternUtils] Text ends with partial closing tag with whitespace: "${e}"`),!0)},startsWithTagContinuation:e=>e.match(/^[a-zA-Z0-9_]+>/)?(n.default.debug(`[AnthropicPatternUtils] Text starts with tag name continuation: "${e}"`),!0):e.match(/^\/[a-zA-Z0-9_]+>/)?(n.default.debug(`[AnthropicPatternUtils] Text starts with closing tag continuation: "${e}"`),!0):e.match(/^\s*>/)?(n.default.debug(`[AnthropicPatternUtils] Text starts with closing bracket: "${e}"`),!0):!!e.match(/^[a-zA-Z0-9_]+_[a-zA-Z0-9_]+>/)&&(n.default.debug(`[AnthropicPatternUtils] Text starts with potential tool call tag: "${e}"`),!0),mightContainPartialTag:e=>{if(e.length<10&&e.includes("<"))return!0;const t=e.lastIndexOf("<");if(-1!==t){if(-1===e.indexOf(">",t))return!0}return e.endsWith("/")||e.endsWith("<")||null!==e.match(/<\/?[A-Za-z0-9_-]+$/)}}};const n=o(r(19055))},87161:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.ArchitectPersona=void 0;const n=r(3563),s=r(95819);let i=class{getId(){return"architect"}getName(){return"Software Architect"}getConfiguration(){return{id:this.getId(),name:this.getName(),corePrompt:(0,s.getBasePrompt)(),specificInstructions:(0,s.getArchitectInstructions)({}),requiredComponents:["tool-use-guidelines","plan-vs-act"],optionalComponents:["general-agent-behavior","objective","workspace-files","user-rules"],toolNames:this.getAllToolNames()}}getAllToolNames(){return["list_files","list_code_definition_names","search_files","read_file","write_to_file","replace_in_file","execute_command","web_search","use_mcp_tool","access_mcp_resource","ask_followup_question","plan_mode_respond","attempt_completion"]}getToolNamesForMode(e,t){return this.getAllToolNames()}};t.ArchitectPersona=i,t.ArchitectPersona=i=o([(0,n.Injectable)()],i)},87223:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ArchitectAgentService=void 0;const a=r(3563),c=r(93470),l=r(86158),d=i(r(19055)),u=r(22300),p=r(55277),f=r(78921);let h=class extends p.GraphAgentService{constructor(e,t,r){super(e,t,r),this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}getName(){return"architect-agent"}async getTools(e){const t=["list_files","read_file","update_file","delete_file","fetch_web_page","current_timestamp","grep","find_files","serp_api"];return e.workspace.portFromBaseDir&&t.push("read_port_from_file"),await this.toolFactoryService.createTools(t,e)}async getSystemPrompt(e){let t=`As an expert AI Software Architect, your primary role is to analyze requirements and break them down into well-defined, implementable tasks. Your main responsibilities vary based on the type of request:\n\n1. STORY TASK BREAKDOWN (Primary Role):\n   When breaking down an existing story into tasks:\n   \n   a) First analyze the context:\n      - Read the epic's requirements.md for high-level context\n      - Study the story.json to understand specific acceptance criteria\n      - Research the existing codebase using the repository file tree defined below and the read_file to understand current implementation\n      - Read the hints.md and README.md files to understand the tech stack and any other relevant information\n      - Read any other files that seem at all relevant to the task or to see examples of how things are done\n      - Use the read_file tool to read examples of existing code that might be relevant to the task\n      - Do not make assumptions about the codebase, always use the read_file tool to understand the existing code before designing new code\n   \n   b) Create tasks that:\n      - Fulfill all acceptance criteria\n      - Include basic happy path end-to-end tests\n      - Are sized for one atomic commit (3-4 files max)\n      - Are ordered logically for implementation\n      - If possible, include both the backend and frontend code changes in the same task so they can immediately be tested together\n      - Prefer lots of small tasks over fewer larger tasks\n   \n   c) For each task provide:\n      - Clear, descriptive title\n      - List of files to be created and the files to be modified\n      - For each file, describe the changes needed with pseudo code or code snippets if applicable\n      - Define entity/dto properties if applicable\n      - Show the code for DB table creation/updates if applicable\n      - Dependencies on other tasks\n      - Basic testing requirements which should include a happy path end to end test (no mocking/fixtures)\n      - List which acceptance criteria the task fulfills\n      - Status "backlog"\n      - Assignee "se-agent"\n\n2. EPIC/STORY PLANNING:\n   When asked to create a plan for something (and no specific EPIC is mentioned):\n   \n   a) Create a new epic with:\n      - Clear requirements.md file (this can be technical in nature rather than business requirements)\n      - 1-2 initial stories\n   \n   b) STOP and present the plan to user and wait for approval before breaking down the first story\n   \n   c) Only proceed with task breakdown after user approval\n\n3. FIRST EPIC SETUP:\n   When breaking down the first epic/stories in a project (e.g. EPIC-01):\n   \n   a) First task should be either:\n      - Scaffolding: Ask user for tech stack or propose a tech stack and ask user to confirm\n      OR\n      - Rebranding: If template exists:\n        * Update all wording/readmes\n        * Disable/hide template features if needed\n        * Include startup instructions for SE agent to show user\n   \n   b) Second task should implement first actual requirement\n   \n   c) Ensure proper tech stack is defined:\n      - Check hints.md and codebase for existing choices\n      - If none found, propose stack to user and wait for confirmation\n      - Update hints.md with confirmed stack\n\n4. REFACTORING PLANS:\n   When asked to create a refactoring plan:\n   \n   a) Test Coverage:\n      - Assess existing test coverage and add and missing happy path tests for important behaviors\n      - Create test story first if needed to add tests\n      - Plan for test updates/temporary disabling tests if needed\n   \n   b) Analysis & Principles:\n      - Identify complexity, duplication, coupling, large files, etc.\n      - Follow SOLID principles\n      - Keep changes independently deployable\n      - Maintain backward compatibility during the refactoring\n   \n   c) Task Structure:\n      1. Setup (tests, infrastructure)\n      2. Extraction (new files, minimal changes, bit by bit etc)\n      3. Updates (client code, dependencies)\n      4. Cleanup (remove old code, re-enable tests)\n\n${await f.EpicsPrompts.allEpicInstructions(e)}\n\nHere is the file tree of the system:\n${e.repositoryTree()}\n\n${e.portFromSourceTree()?`\nHere is the "port from" file tree containing another codebase that you can learn from and/or port code from (use read_port_from_file tool to read files from here):\n${e.portFromSourceTree()}\n`:""}\n\n${e.repositoryHints()?`Additional hints:\n${e.repositoryHints()}`:""}\n\nIMPORTANT GUIDELINES:\n- If there is no tech stack defined yet in the repository, then propose a tech stack and STOP AND ASK USER TO CONFIRM if that technology stack is okay\n- Always use read_file to examine code before referencing it\n- Tasks should be small (single commit) but complete (testable)\n- Every acceptance criterion must have a task\n- Use current_timestamp for timestamps\n- Order tasks logically\n- You create tasks/stories only - no direct code edits unless specifically asked to do so\n- When creating first epic, focus on proper setup/scaffolding\n- Always stop and present plan to user before detailed breakdown\n\nWhat follows may be more specific instructions which should be followed in preference to the general instructions above...\n`;return d.default.debug(`Architect Agent system prompt for workspace '${e.workspace.name}' (length: ${t.length} chars): ${t}`),t}};t.ArchitectAgentService=h,t.ArchitectAgentService=h=o([(0,a.Injectable)(),s(0,(0,a.Inject)((0,a.forwardRef)((()=>u.GraphAgentCollaborator)))),n("design:paramtypes",[u.GraphAgentCollaborator,l.ToolFactoryService,c.AgentRuleService])],h)},87516:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ContextManagerService=void 0;const a=r(3563),c=i(r(19055));let l=o=class{constructor(){c.default.info(`[${o.name}] ContextManagerService initialized`)}getNewContextMessagesAndMetadata(e,t,r,o,n){let s=!1;if(n>=0){const i=t[n];if(i&&i.text){const{tokensIn:t,tokensOut:n,cacheWrites:a,cacheReads:c}=JSON.parse(i.text),l=(t||0)+(n||0)+(a||0)+(c||0);let d,u=r.getModel().info.contextWindow||128e3;switch(u){case 64e3:d=u-27e3;break;case 128e3:d=u-3e4;break;case 2e5:d=u-4e4;break;default:d=Math.max(u-4e4,.8*u)}if(l>=d){const t=l/2>d?"quarter":"half";o=this.getNextTruncationRange(e,o,t),s=!0}}}return{conversationHistoryDeletedRange:o,updatedConversationHistoryDeletedRange:s,truncatedConversationHistory:this.getTruncatedMessages(e,o)}}getNextTruncationRange(e,t,r){const o=t?t[1]+1:1;let n;n="half"===r?2*Math.floor((e.length-o)/4):2*Math.floor(3*(e.length-o)/4/2);let s=o+n-1;return"user"!==e[s]?.role&&(s-=1),[1,s]}getTruncatedMessages(e,t){if(!t)return e;const[r,o]=t;return[...e.slice(0,r),...e.slice(o+1)]}};t.ContextManagerService=l,t.ContextManagerService=l=o=n([(0,a.Injectable)(),s("design:paramtypes",[])],l)},87650:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToolResult=t.ToolError=void 0;class r extends Error{constructor(e){super(e),this.name="ToolError"}}t.ToolError=r;class o{constructor(e="",t="",r=null){this.output=e,this.error=t,this.base64_image=r}replace({output:e=null,error:t=null,base64_image:r=null}){return new o(null!==e?e:this.output,null!==t?t:this.error,null!==r?r:this.base64_image)}}t.ToolResult=o},88366:e=>{"use strict";e.exports=require("ollama")},88474:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},a=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceService=void 0;const d=r(3563),u=r(74717),p=a(r(79896)),f=a(r(16928)),h=l(r(19055)),m=l(r(83807)),g=r(92434);let y=class{constructor(e){this.workspaceRepository=e}async lockSessionWorkspace(e){const t=`session/${e}`;if(await this.workspaceRepository.findByName(t))return this.lockByName(t);const r=process.env.TEMP_WORKSPACE_ROOT_DIR||"~/.eve/temp-workspaces/",o=f.join(r,"session",e);p.mkdirSync(o,{recursive:!0});const n=await this.createWorkspace({name:t,repoBaseDir:o,isTemp:!0});return this.lockByName(n.name)}async lockTempWorkspace(e){const t=await this.workspaceRepository.findUnlockedTempWorkspaceByRemoteUrl(e);if(t)return this.lockByName(t.name);const r=this.generateWorkspaceName(e),o=this.createWorkspaceDirectory(r);await this.cloneRepository(e,o);const n=await this.createWorkspace({name:r,repoBaseDir:o,isTemp:!0});return this.lockByName(n.name)}generateWorkspaceName(e){return`${f.basename(e,".git")}-${Math.random().toString(36).substring(2,7)}`}createWorkspaceDirectory(e){const t=process.env.TEMP_WORKSPACE_ROOT_DIR||f.join(process.env.HOME||"","/.eve/temp-workspaces/"),r=f.join(t,e);return p.mkdirSync(r,{recursive:!0}),r}async cloneRepository(e,t){const r=(0,m.default)();await r.clone(e,t)}async updateWorkspace(e,t){const r=await this.workspaceRepository.findByName(e);if(!r)throw new d.NotFoundException(`Workspace with name ${e} not found`);return r.buildOrTestCommand=t.buildOrTestCommand,r.portFromBaseDir=t.portFromBaseDir,await this.workspaceRepository.update(e,{buildOrTestCommand:t.buildOrTestCommand,portFromBaseDir:t.portFromBaseDir}),h.default.info(`Workspace updated successfully: ${JSON.stringify(r)}`),r}async lockByName(e){const t=await this.workspaceRepository.findByName(e);if(!t)throw new d.NotFoundException(`Workspace with name ${e} not found`);if(t.isLocked)throw new d.BadRequestException(`Workspace with name ${e} is already locked`);return t.isLocked=!0,t.lastAccessedAt=new Date,await this.workspaceRepository.update(e,{isLocked:!0,lastAccessedAt:t.lastAccessedAt}),h.default.info(`Workspace locked successfully: ${JSON.stringify(t)}`),t}async unlockByName(e){const t=await this.workspaceRepository.findByName(e);if(!t)throw new d.NotFoundException(`Workspace with name ${e} not found`);return t.isLocked=!1,await this.workspaceRepository.update(e,{isLocked:!1}),h.default.info(`Workspace unlocked successfully: ${JSON.stringify(t)}`),t}async createWorkspace(e){h.default.info(`Importing workspace with request: ${JSON.stringify(e)}`);let t=e.name;t||(t=f.basename(e.repoBaseDir));if(await this.workspaceRepository.findByName(t))throw new d.BadRequestException("A workspace with the same name already exists");if(!p.existsSync(e.repoBaseDir)||!p.statSync(e.repoBaseDir).isDirectory())throw new d.BadRequestException("The specified repository directory does not exist or is not a directory");let r=await this.isValidGitRepo(e.repoBaseDir);if(h.default.info(`isGitRepo: ${r}`),!r&&e.ensureGitRepo){const t=(0,m.default)(e.repoBaseDir);await t.init(),r=!0,h.default.info(`Initialized new Git repository in ${e.repoBaseDir}`)}if(r){if(g.GitUtils.ensureGitignoreExists(e.repoBaseDir)){const t=(0,m.default)(e.repoBaseDir);await t.add(".gitignore"),await t.commit("Added default .gitignore file"),h.default.info("Added default .gitignore file")}}const o={name:t,repoBaseDir:e.repoBaseDir,status:"Created",remoteRepoUrl:"",buildOrTestCommand:null,isGitRepo:r,isLocked:!1,isTemp:e.isTemp??!1,lastAccessedAt:new Date,portFromBaseDir:e.portFromBaseDir};if(r)try{o.remoteRepoUrl=await this.getRemoteRepoUrl(e.repoBaseDir);(0,m.default)(e.repoBaseDir);await this.hasCommits(e.repoBaseDir)&&await this.getCurrentBranch(e.repoBaseDir)}catch(e){console.error("Error getting Git information:",e),o.status="Error: Unable to get Git information"}return await this.workspaceRepository.create(o),h.default.info(`Workspace created successfully: ${JSON.stringify(o)}`),o}async findAll(e){return this.workspaceRepository.findAll(e)}async findOne(e){return this.workspaceRepository.findByName(e)}async findById(e){return this.workspaceRepository.findById(e)}async updateLastAccessedAt(e){await this.workspaceRepository.updateLastAccessedAt(e)}async removeWorkspace(e){if(!await this.workspaceRepository.findByName(e))throw new d.NotFoundException(`Workspace with name ${e} not found`);await this.workspaceRepository.delete(e),h.default.info(`Workspace removed successfully: ${e}`)}async getRemoteRepoUrl(e){const t=(0,m.default)(e),r=(await t.getRemotes(!0)).find((e=>"origin"===e.name));return r?r.refs.fetch:""}async getCurrentBranch(e){return(0,m.default)(e).revparse(["--abbrev-ref","HEAD"])}async isValidGitRepo(e){try{const t=(0,m.default)(e);return await t.revparse(["--is-inside-work-tree"]),!0}catch(e){return!1}}async hasCommits(e){try{const t=(0,m.default)(e);return(await t.log(["--oneline","-1"])).total>0}catch(e){return!1}}};t.WorkspaceService=y,t.WorkspaceService=y=i([(0,d.Injectable)(),c("design:paramtypes",[u.WorkspaceRepository])],y)},88489:e=>{"use strict";e.exports=require("shelljs")},88507:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchFilesToolFactory=void 0;const s=r(3563),i=r(84390);let a=class{constructor(){}getToolName(){return"search_files"}create(e){return new i.SearchFilesTool(e.workingDir,{availableInPlan:!0,availableInAct:!0})}};t.SearchFilesToolFactory=a,t.SearchFilesToolFactory=a=o([(0,s.Injectable)(),n("design:paramtypes",[])],a)},88627:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.KnexMigrationManager=void 0;const n=o(r(19055));t.KnexMigrationManager=class{constructor(e){this.knexInstance=e}async runMigrations(){try{const e=await this.knexInstance.migrate.latest();return n.default.info(`Ran ${e[1].length} migrations`),e[1]}catch(e){throw n.default.error("Failed to run Knex migrations",e),e}}async getMigrationStatus(){try{const e=await this.knexInstance.migrate.list();return{completed:e[0],newMigrations:e[1]}}catch(e){throw n.default.error("Failed to get Knex migration status",e),e}}}},88648:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StoredDocRepository=void 0;const i=r(3563),a=(r(31832),r(43543)),c=r(27823);let l=class{constructor(e){this.knex=e,this.columns={all:["id","contents","mimeType","createdAt","sessionId","workspaceName"],withoutContents:["id","mimeType","createdAt","sessionId","workspaceName"]}}async save(e){await this.knex("stored_docs").insert({id:e.id,contents:e.contents,mimeType:e.mimeType,createdAt:e.createdAt,sessionId:e.sessionId,workspaceName:e.workspaceName})}async findById(e){const t=await this.knex("stored_docs").select(this.columns.all).where("id",e).first();return t?new a.StoredDoc(t.contents,t.mimeType,t.sessionId,t.workspaceName,t.id,t.createdAt):null}async findByIdWithoutContents(e){const t=await this.knex("stored_docs").select(this.columns.withoutContents).where("id",e).first();return t?c.StoredDocDTO.fromStoredDoc(t):null}async findBySessionId(e){return(await this.knex("stored_docs").select(this.columns.withoutContents).where("sessionId",e)).map((e=>c.StoredDocDTO.fromStoredDoc(e)))}async findByWorkspaceName(e){return(await this.knex("stored_docs").select(this.columns.withoutContents).where("workspaceName",e)).map((e=>c.StoredDocDTO.fromStoredDoc(e)))}};t.StoredDocRepository=l,t.StoredDocRepository=l=o([(0,i.Injectable)(),s(0,(0,i.Inject)("KNEX")),n("design:paramtypes",[Function])],l)},88668:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JsonDiffStrategy=t.TraditionalDiffStrategy=t.DiffStrategyFactory=void 0;var o=r(44731);Object.defineProperty(t,"DiffStrategyFactory",{enumerable:!0,get:function(){return o.DiffStrategyFactory}});var n=r(11438);Object.defineProperty(t,"TraditionalDiffStrategy",{enumerable:!0,get:function(){return n.TraditionalDiffStrategy}});var s=r(44799);Object.defineProperty(t,"JsonDiffStrategy",{enumerable:!0,get:function(){return s.JsonDiffStrategy}})},89445:e=>{"use strict";e.exports=require("tree-sitter-go")},89560:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createBlockManager=function(e){const t=()=>(0,n.ulid)();return{openBlock:(r,o="")=>{const n=(0,s.mapTagToBlockType)(r);if("tool_call"===n){if(1!==e.incrementToolCallCount()){const t=e.getFirstToolCallName(),o=`Response interrupted: Only one tool may be used per message. The first tool call (${t}) has been processed. Please assess its result before using additional tools.`;throw i.default.warn(`[AnthropicBlockManager] Multiple tool calls detected. First: ${t}, Second: ${r}. Interrupting stream.`),e.setStreamInterrupted(!0,o),new Error(`STREAM_INTERRUPTED: ${o}`)}e.setFirstToolCallName(r)}const a={type:"block",block:{blockId:t(),blockType:n,..."tool_call"===n&&{tagName:r},status:"generating",content:o}};return e.setCurrentBlock({id:a.block.blockId,tagName:r,blockType:n,emitted:!0,finished:!1}),a},updateBlock:(e,t)=>({type:"blockUpdate",blockId:e,...t}),finishBlock:()=>{const t=e.getCurrentBlock();if(!t||t.finished)return null;t.finished=!0;const r={type:"blockUpdate",blockId:t.id,newStatus:"finished"};return e.setCurrentBlock(void 0),r},emitImmediateBlock:(r,o)=>{const n=(0,s.mapTagToBlockType)(r);if("tool_call"===n){if(1!==e.incrementToolCallCount()){const t=e.getFirstToolCallName(),o=`Response interrupted: Only one tool may be used per message. The first tool call (${t}) has been processed. Please assess its result before using additional tools.`;throw i.default.warn(`[AnthropicBlockManager] Multiple tool calls detected (immediate). First: ${t}, Second: ${r}. Interrupting stream.`),e.setStreamInterrupted(!0,o),new Error(`STREAM_INTERRUPTED: ${o}`)}e.setFirstToolCallName(r)}return{type:"block",block:{blockId:t(),blockType:n,..."tool_call"===n&&{tagName:r},status:"finished",content:o}}},emitText:r=>{const o=e.getCurrentBlock(),n=[];if(!o){const o=t();let a=r;const c=a.match(/^(\s*)<([A-Za-z_][\w\-.]*)/);if(c){const e=c[1]||"",t=c[2];s.TOOL_CALL_TAGS.includes(t)&&e&&(a=a.substring(e.length))}else if(""===a.trim())return async function*(){}();e.setPendingPrefix(!1);const l=a.match(/^<([A-Za-z_][\w\-.]*)/);if(l){const t=l[1];if(!e.isInsideToolCall()&&s.TOOL_CALL_TAGS.includes(t)){if(e.isStreamInterrupted())return async function*(){}();if(1!==e.incrementToolCallCount()){const r=e.getFirstToolCallName(),o=`Response interrupted: Only one tool may be used per message. The first tool call (${r}) has been processed. Please assess its result before using additional tools.`;return i.default.warn(`[AnthropicBlockManager] Multiple tool calls detected (emitText). First: ${r}, Second: ${t}. Interrupting stream.`),e.setStreamInterrupted(!0,o),async function*(){}()}e.setFirstToolCallName(t),n.push({type:"block",block:{blockId:o,blockType:"tool_call",tagName:t,status:"generating",content:a}}),e.setCurrentBlock({id:o,tagName:t,blockType:"tool_call",emitted:!0,finished:!1})}else n.push({type:"block",block:{blockId:o,blockType:"text",status:"generating",content:a}}),e.setCurrentBlock({id:o,tagName:"text",blockType:"text",emitted:!0,finished:!1})}else n.push({type:"block",block:{blockId:o,blockType:"text",status:"generating",content:a}}),e.setCurrentBlock({id:o,tagName:"text",blockType:"text",emitted:!0,finished:!1});return async function*(){for(const e of n)yield e}()}let a=r;if("tool_call"===o.blockType&&!o.finished&&e.isPendingPrefix()){if(new RegExp(`^\\s+<${o.tagName}`).test(a)){const e=a.indexOf("<"+o.tagName);a=a.substring(e)}}return e.setPendingPrefix(!1),a?(n.push({type:"blockUpdate",blockId:o.id,appendContent:a}),async function*(){for(const e of n)yield e}()):async function*(){}()}}};const n=r(59100),s=r(81685),i=o(r(19055))},89841:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AttemptCompletionToolFactory=void 0;const s=r(3563),i=r(3060);let a=class{constructor(){}getToolName(){return"attempt_completion"}create(e){return new i.AttemptCompletionTool({availableInPlan:!0,availableInAct:!0})}};t.AttemptCompletionToolFactory=a,t.AttemptCompletionToolFactory=a=o([(0,s.Injectable)(),n("design:paramtypes",[])],a)},90062:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ListFilesTool=void 0;const u=r(3563),p=c(r(91943)),f=d(r(19055)),h=c(r(16928)),m=r(20436),g=r(22141),y=r(44155),v=r(37526),_=r(91346),w=r(85266),b=r(9581);let k=n=class extends m.BaseTool{constructor(e,t,r,o,n){super(n),this.fileSystemService=e,this.responseFormatter=t,this.ignoreConfigService=r,this.name="list_files",this.description="Request to list files and directories within the specified directory.",this.workingDir=o}getBaseUsageInstructions(e){return`## list_files\nDescription: **PRIMARY REPOSITORY EXPLORATION TOOL** - Use this tool FIRST for understanding repository structure. Target the deepest relevant directory node and make up to 3 targeted calls before considering search_files as a last resort. Do not use this tool to confirm the existence of files you may have created, as the user will let you know if the files were created successfully or not.\nParameters:\n- path: (required) Specific directory path to explore (relative to ${e.workingDir}). **TARGET THE DEEPEST RELEVANT NODE FIRST** - use targeted paths like 'src/components' rather than '.' which duplicates the initial context listing\n- max_files: (optional) Maximum number of files to return (default: 200)\n- depth: (optional) Maximum directory depth to traverse (default: unlimited)\n- file_extensions: (optional) Array of file extensions to filter by (e.g., [".ts", ".js"])\n\n**EXPLORATION STRATEGY:**\n1. **First call**: Use list_files on the deepest relevant directory (use default 200 max_files)\n2. **If results unclear**: Make more targeted calls to specific subdirectories\n3. **Maximum 3 calls**: Use up to 3 list_files calls before considering search_files\n4. **Last resort**: Only use search_files when list_files doesn't provide needed structure information\n\nUsage:\n<list_files>\n<path>Targeted sub-directory path to explore (do not use .)</path>\n<max_files>200 (optional)</max_files>\n<depth>3 (optional)</depth>\n<file_extensions>[".ts", ".js"] (optional)</file_extensions>\n</list_files>`}validateParams(e){return"string"==typeof e.path}async execute(e){const{path:t,max_files:r=200,depth:o,file_extensions:s}=e;f.default.info(`[${n.name}] Listing files in directory: ${t}, max_files: ${r}, depth: ${o}, extensions: ${s}, relative to ${this.workingDir}`);const i=h.resolve(this.workingDir,t);if(!i.startsWith(this.workingDir)){const e=`Path traversal attempt detected: ${t} resolves outside of workspace ${this.workingDir}`;throw f.default.error(`[${n.name}] ${e}`),new b.FileSystemError(e,"PATH_TRAVERSAL_ERROR")}try{if(!(await p.stat(i)).isDirectory()){const e=`Path is not a directory: ${t}`;throw f.default.error(`[${n.name}] ${e}`),new b.FileNotFoundError(e,t)}const e=new _.FileScanner(this.workingDir),a=[w.FileFiltersFactory.defaultRootIgnoreFilter(),this.ignoreConfigService.createGitIgnoreFilter(this.workingDir),this.ignoreConfigService.createEveIgnoreFilter(this.workingDir),w.FileFiltersFactory.limitFilter({maxItems:r})];s&&Array.isArray(s)&&s.length>0&&a.push(w.FileFiltersFactory.extensionFilter(s,!0));let c=[],l=!1;for await(const n of e.scanBreadthFirst(t,a,{maxFilesPerDirectory:100,sortByPath:!0,maxDepth:o})){if("type"in n&&"truncation-marker"===n.type)continue;const e=n,t=e.path+(e.isDir?"/":"");if(c.push(t),c.length>=r){l=!0;break}}const d=await this.fileSystemService.getIgnoredFilesCached(i);return this.responseFormatter.formatFilesList(i,c,l,d)}catch(e){if("ENOENT"===e.code){const e=`Directory not found: ${t}`;throw f.default.error(`[${n.name}] ${e}`),new b.FileNotFoundError(e,t)}const r=`Error listing files in directory ${t}: ${e.message}`;throw f.default.error(`[${n.name}] ${r}\n${e.stack}`),new b.FileSystemError(r,e.code||"FS_LIST_ERROR")}}getModeSpecificGuidance(e){return null}};t.ListFilesTool=k,t.ListFilesTool=k=n=a([(0,u.Injectable)(),l("design:paramtypes",[g.FileSystemService,y.ResponseFormatterService,v.IgnoreConfigService,String,Object])],k)},90290:e=>{"use strict";e.exports=require("async_hooks")},90672:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MutationRepository=void 0;const a=r(3563),c=(r(31832),r(53903)),l=i(r(19055));let d=class{constructor(e){this.knex=e}async findAll(e,t){let r=this.knex("mutations").select("*");if(t&&(r=r.orderBy(t.field,t.order.toLowerCase())),e){const{page:t,limit:o}=e,n=(t-1)*o;r=r.offset(n).limit(o)}return r}async findById(e){return this.knex("mutations").where("id",e).first()}async findBySessionId(e,t,r){let o=this.knex("mutations").where("sessionId",e);if(r&&(o=o.orderBy(r.field,r.order.toLowerCase())),t){const{page:e,limit:r}=t,n=(e-1)*r;o=o.offset(n).limit(r)}return o}async findBySessionIds(e){return this.knex("mutations").whereIn("sessionId",e)}async findByRequestId(e){return this.knex("mutations").where("requestId",e)}async create(e){const t=(0,c.v4)(),r=(new Date).toISOString();try{return await this.knex("mutations").insert({id:t,...e,updatedAt:r}),t}catch(o){throw l.default.error("Failed to create mutation:",{error:o.message,stack:o.stack,mutation:{id:t,...e,updatedAt:r}}),o}}async update(e,t){await this.knex("mutations").where("id",e).update(t)}async delete(e){await this.knex("mutations").where("id",e).delete()}};t.MutationRepository=d,t.MutationRepository=d=o([(0,a.Injectable)(),s(0,(0,a.Inject)("KNEX")),n("design:paramtypes",[Function])],d)},91140:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GeminiModelClient=void 0;const i=r(3563),a=r(69205),c=s(r(19055));let l=class{constructor(e,t){this.config=e,this.options=t,this.adapter=this.createAdapter(),c.default.info(`[GeminiModelClient] Initialized for model: ${this.config.modelId} using normalized adapter.`)}createAdapter(){const e={apiKey:this.config.apiKey,modelId:this.config.modelId,baseUrl:this.config.baseUrl},t={enableVerboseLogging:this.options?.enableVerboseLogging,bufferConfig:this.options?.bufferConfig,maxOutputTokens:this.options?.maxOutputTokens};return new a.GeminiNewSDKAdapter(e,t)}getModelId(){return this.config.modelId}getModelMetadata(){return this.adapter.getModelMetadata()}setModelMetadata(e){this.adapter.setModelMetadata(e),c.default.debug(`[GeminiModelClient] Metadata updated for model ${this.config.modelId}.`)}async generateSimpleResponse(e,t,r,o){return c.default.info(`[GeminiModelClient] Generating simple response for model: ${this.config.modelId}`),this.adapter.generateSimpleResponse(e,t,r,o)}async*generateResponse(e,t,r,o){c.default.info(`[GeminiModelClient] Task ${r} for model ${this.config.modelId}: Using normalized adapter.`),this.options?.enableVerboseLogging&&c.default.debug(`[GeminiModelClient] Task ${r} - Using normalized processing for Gemini.`),yield*this.adapter.generateResponse(e,t,r,o)}getAdapterInfo(){return{type:"normalized",modelId:this.config.modelId}}refreshAdapters(){c.default.info(`[GeminiModelClient] Refreshing adapter for model: ${this.config.modelId}`);const e=this.adapter.getModelMetadata();this.adapter=this.createAdapter(),this.adapter.setModelMetadata(e),c.default.debug(`[GeminiModelClient] Adapter refreshed for model: ${this.config.modelId}`)}};t.GeminiModelClient=l,t.GeminiModelClient=l=o([(0,i.Injectable)(),n("design:paramtypes",[Object,Object])],l)},91280:(e,t)=>{"use strict";var r,o,n;Object.defineProperty(t,"__esModule",{value:!0}),t.ClientToServerEvents=t.NotificationEvents=t.InternalEvents=t.TASK_UPDATE_EVENT=void 0,t.TASK_UPDATE_EVENT="agent.taskUpdate",function(e){e.TOOL_EXECUTED="agent.tool.executed",e.TOOL_ERROR="agent.tool.error",e.TASK_CREATED="agent.task.created",e.TASK_UPDATED="agent.task.updated",e.AGENT_ERROR_NOTIFICATION="agent.error.notification",e.BLOCK_CREATED="agent.block.created",e.BLOCK_UPDATED="agent.block.updated",e.BLOCK_USAGE_TRACKED="agent.block.usage.tracked",e.TOOL_CALL_BATCH_DETECTED="agent.tool.batch.detected",e.TOOL_EXECUTION_COMPLETED="agent.tool.execution.completed",e.TOOL_BATCH_COMPLETED="agent.tool.batch.completed"}(r||(t.InternalEvents=r={})),function(e){e.TASK_STATUS_UPDATED="taskStatusUpdated",e.AGENT_ERROR="agentError",e.CONTEXT_TRUNCATED="contextTruncated",e.TASK_CREATED="taskCreated",e.BLOCK_EVENT="blockEvent"}(o||(t.NotificationEvents=o={})),function(e){e.USER_PROMPT="userPrompt",e.TOOL_APPROVAL="toolApproval",e.CREATE_TASK="createTask",e.CANCEL_TASK="cancelTask",e.CHANGE_AGENT_MODE="changeAgentMode"}(n||(t.ClientToServerEvents=n={}))},91346:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FileScanner=void 0;const u=r(3563),p=c(r(91943)),f=c(r(16928)),h=d(r(19055)),m=r(85266);let g=n=class{constructor(e){this.rootPath=e}async*scan(e,t,r){void 0===r.limitFilterExcludedFiles&&(r.limitFilterExcludedFiles=!1);const o=this.normalizePath(e);try{const e=f.join(this.rootPath,o),s=await p.stat(e),i={path:o,isDir:s.isDirectory(),sizeBytes:s.size};r.stats.nodesScanned++,r.stats.bytesScanned+=s.size;let a=!0,c=i.isDir;for(const e of t){const t=await e(i,r);if("exclude"===t){"limitFilter"===e.name&&(r.limitFilterExcludedFiles=!0),a=!1;break}"prune-children"===t&&(c=!1)}if(a&&(r.stats.nodesIncluded++,r.stats.bytesIncluded+=s.size,r.stats.estimatedTokens+=this.estimateTokens(i),yield i),!i.isDir||!c)return;const l=[],d=await p.readdir(e);d.sort(((e,t)=>e.localeCompare(t)));for(const e of d)l.push({path:f.join(o,e),depth:1});for(;l.length>0;){const{path:e,depth:o}=l.shift(),s=f.join(this.rootPath,e);r.currentDepth=o;try{const i=await p.stat(s),a={path:e,isDir:i.isDirectory(),sizeBytes:i.size};r.stats.nodesScanned++,r.stats.bytesScanned+=i.size;let c=!0,d=a.isDir;for(const e of t){const t=await e(a,r);if("exclude"===t){"limitFilter"===e.name&&(r.limitFilterExcludedFiles=!0),c=!1,d=!1;break}"prune-children"===t&&(d=!1)}if(c&&(r.stats.nodesIncluded++,r.stats.bytesIncluded+=i.size,r.stats.estimatedTokens+=this.estimateTokens(a),yield a),a.isDir&&d)try{const t=await p.readdir(s);t.sort(((e,t)=>e.localeCompare(t)));for(const r of t)l.push({path:f.join(e,r),depth:o+1})}catch(e){h.default.error(`[${n.name}] Error reading directory ${s}: ${e.message}`)}}catch(e){if("ENOENT"===e.code&&s.includes("node_modules"))continue;h.default.error(`[${n.name}] Error scanning ${s}: ${e.message}`)}}}catch(e){h.default.error(`[${n.name}] Error scanning root ${f.join(this.rootPath,o)}: ${e.message}`)}}async collect(e,t,r={}){const o=r.initialContext||{rootPath:this.rootPath,currentDepth:0,limitFilterExcludedFiles:!1,stats:{nodesScanned:0,nodesIncluded:0,bytesScanned:0,bytesIncluded:0,estimatedTokens:0}},n=[];for await(const r of this.scan(e,t,o))n.push(r);const s=o.limitFilterExcludedFiles||!1;return{nodes:n,stats:{...o.stats,truncated:s,truncatedDirectories:0},truncated:s}}async*scanBreadthFirst(e,t,r={}){const o=r.maxFilesPerDirectory||100,s=this.normalizePath(e),i={rootPath:this.rootPath,currentDepth:0,limitFilterExcludedFiles:!1,stats:{nodesScanned:0,nodesIncluded:0,bytesScanned:0,bytesIncluded:0,estimatedTokens:0}},a=f.join(this.rootPath,s);try{const e=await p.stat(a),r={path:s,isDir:e.isDirectory(),sizeBytes:e.size};let o=r.isDir;for(const e of t){const t=await e(r,i);if("exclude"===t)return;"prune-children"===t&&(o=!1)}if(!o)return}catch(e){return void h.default.error(`[${n.name}] Error checking root directory ${a}: ${e.message}`)}const c=[{path:s,depth:0}];for(;c.length>0;){const{path:e,depth:s}=c.shift(),a=f.join(this.rootPath,e);i.currentDepth=s;try{const l=await p.readdir(a,{withFileTypes:!0}),d=[],u=[];for(const o of l){const c=f.join(e,o.name),l=f.join(a,o.name),m={path:c,isDir:o.isDirectory()||o.isSymbolicLink(),sizeBytes:0};let g=!0,y=m.isDir;for(const e of t){const t=await e(m,i);if("exclude"===t){"limitFilter"===e.name&&(i.limitFilterExcludedFiles=!0),g=!1,y=!1;break}"prune-children"===t&&(y=!1)}if(g)try{const e=o.isSymbolicLink()?await p.lstat(l):await p.stat(l),n={path:c,isDir:e.isDirectory(),sizeBytes:e.size};i.stats.nodesScanned++,i.stats.bytesScanned+=e.size,g=!0,y=n.isDir;for(const e of t){const t=await e(n,i);if("exclude"===t){"limitFilter"===e.name&&(i.limitFilterExcludedFiles=!0),g=!1,y=!1;break}"prune-children"===t&&(y=!1)}g&&(n.isDir?(yield n,y&&u.push({path:c,depth:s+1})):(void 0===r.maxDepth||s<=r.maxDepth)&&(d.push(n),i.stats.nodesIncluded++,i.stats.bytesIncluded+=e.size,i.stats.estimatedTokens+=this.estimateTokens(n)))}catch(e){if("ENOENT"===e.code&&l.includes("node_modules"))continue;h.default.error(`[${n.name}] Error processing entry ${l}: ${e.message}`)}}if(r.sortByPath&&d.sort(((e,t)=>e.path.localeCompare(t.path))),d.length>o){i.limitFilterExcludedFiles=!0,yield{type:"truncation-marker",directory:e,droppedCount:d.length-o};for(const e of d.slice(0,o))yield e}else for(const e of d)yield e;c.push(...u)}catch(e){if("ENOENT"===e.code&&a.includes("node_modules"))continue;h.default.error(`[${n.name}] Error scanning directory ${a}: ${e.message}`)}}}async collectForLLM(e={},t=[],r="."){const o=[],n=[];let s=0,i=0,a=!1;const c={rootPath:this.rootPath,currentDepth:0,limitFilterExcludedFiles:!1,stats:{nodesScanned:0,nodesIncluded:0,bytesScanned:0,bytesIncluded:0,estimatedTokens:0}};void 0!==e.maxDepth&&t.push(m.FileFiltersFactory.depthFilter(e.maxDepth));for await(const l of this.scanBreadthFirst(this.normalizePath(r),t,{maxFilesPerDirectory:e.maxFilesPerDirectory||100,sortByPath:!1!==e.sortByPath,maxDepth:e.maxDepth})){if("type"in l&&"truncation-marker"===l.type){n.push(l);continue}const t=l;if(e.maxItems&&o.length>=e.maxItems||e.maxBytes&&i+(t.sizeBytes||0)>e.maxBytes||e.maxTokens&&s+this.estimateTokens(t)>e.maxTokens){a=!0,c.limitFilterExcludedFiles=!0;break}o.push(t),i+=t.sizeBytes||0,s+=this.estimateTokens(t)}return{nodes:o,truncationMarkers:n,stats:{nodesScanned:o.length+(a?1:0),nodesIncluded:o.length,bytesScanned:i,bytesIncluded:i,estimatedTokens:s,truncated:a,truncatedDirectories:n.length},truncated:a}}estimateTokens(e){const t=e.path.length/4;if(e.isDir)return t+2;const r=(e.sizeBytes||0)/4;return t+Math.min(r,10)}normalizePath(e){return"."===e||""===e?"":e}};t.FileScanner=g,t.FileScanner=g=n=a([(0,u.Injectable)(),l("design:paramtypes",[String])],g)},91367:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.EveAgentModule=void 0;const i=r(3563),a=r(57967),c=r(79191),l=r(19668),d=r(50461),u=r(84193),p=r(45873),f=r(9102),h=r(15369),m=r(36206),g=r(58620),y=r(45702),v=r(35499),_=r(35630),w=r(61208),b=r(37916),k=r(24160),S=r(13686),T=r(79056),R=r(17299),C=r(14624),P=r(34070),E=r(59503),I=r(20712),O=r(44810),$=r(12597),M=r(73569),A=r(39421),x=r(51991),D=r(55884),N=r(30662),j=r(82385),F=r(66375),L=r(56550),U=r(60269),B=r(20150),q=r(44404),z=r(59512),G=r(66963),W=r(55324),H=r(66595),K=r(57663),V=r(29076),X=r(71036),J=r(68444),Y=r(4704),Q=r(44043),Z=r(16663),ee=r(72776),te=r(30873),re=r(41070),oe=r(4243),ne=r(81125),se=r(64318),ie=r(34835),ae=r(87516),ce=r(56349),le=r(36647),de=r(16724),ue=r(22141),pe=r(37526),fe=r(85266),he=r(22811),me=r(24939),ge=r(44155),ye=r(77403),ve=r(48010),_e=r(32398),we=r(18615),be=r(96170),ke=r(81136),Se=r(58190),Te=r(17057),Re=r(84105),Ce=r(2620),Pe=r(50074),Ee=r(92427),Ie=r(18400),Oe=r(91760),$e=r(79616),Me=r(32937),Ae=r(10289),xe=r(9833),De=r(17260),Ne=r(39578),je=r(33583),Fe=r(96428),Le=r(12425),Ue=r(13220),Be=r(46823),qe=r(55156),ze=r(49235),Ge=r(88507),We=r(25814),He=r(7050),Ke=r(2115),Ve=r(16406),Xe=r(71600),Je=r(55177),Ye=r(29220),Qe=r(44230),Ze=r(89841),et=r(28716),tt=r(4584),rt=r(56292),ot=r(33911),nt=r(36683),st=r(87161),it=r(726),at=r(10646),ct=r(43510);let lt=class{constructor(e,t,r,o,n,s,i,a,c){this.toolProvider=e,this.treeSitterService=t,this.contextManagerService=r,this.dbDebugContextService=o,this.appDataSource=n,this.toolFactories=s,this.cacheRegistry=i,this.recentFilesCache=a,this.directoryStructureCache=c}onModuleInit(){for(const e of this.toolFactories)this.toolProvider.registerToolFactory(e);this.cacheRegistry.registerCacheManager(this.recentFilesCache),this.cacheRegistry.registerCacheManager(this.directoryStructureCache),this.appDataSource.setDbDebugContextService(this.dbDebugContextService)}};t.EveAgentModule=lt,t.EveAgentModule=lt=o([(0,i.Module)({imports:[d.EventEmitterModule.forRoot(),(0,i.forwardRef)((()=>u.HomeModule)),p.WorkspaceModule,a.ConfigModule],controllers:[$.EveAgentController,M.ConfigController,A.CustomPersonaController,x.TaskHistoryController,D.BlockController,N.RulesController,j.RepoRulesController,he.FileSystemController,me.AutocompleteController,F.McpController],providers:[{provide:ee.AppDataSource,useFactory:ee.getAppDataSource},{provide:"KNEX",useFactory:e=>e.knex,inject:[ee.AppDataSource]},U.DbDebugContextService,f.EveConfigService,m.ProviderRegistry,g.LlmMetadataService,c.LlmInitializerService,y.ModelRefreshService,v.ToolResultTransformerService,_.AnthropicProvider,_.GeminiProvider,_.OpenAIProvider,_.FireworksProvider,_.VercelProvider,_.LMStudioProvider,_.OllamaProvider,_.MlxProvider,R.XaiProvider,w.AnthropicAdapter,b.GeminiAdapter,_.OpenAIAdapter,q.FireworksAdapter,z.VercelAdapter,k.LMStudioAdapter,S.OllamaAdapter,T.MlxAdapter,R.XaiAdapter,C.ProviderAdapterRegistry,{provide:"PROVIDER_ADAPTERS",useFactory:(e,t,r,o,n,s,i,a,c)=>[e,t,r,o,n,s,i,a,c],inject:[w.AnthropicAdapter,b.GeminiAdapter,_.OpenAIAdapter,q.FireworksAdapter,z.VercelAdapter,k.LMStudioAdapter,S.OllamaAdapter,T.MlxAdapter,R.XaiAdapter]},h.ApiHandlerFactory,O.WebSocketService,P.EveAgentIncomingGateway,E.EveAgentInternalGateway,I.EveAgentOutgoingGateway,L.TaskService,te.TreeSitterService,re.TreeSitterCacheService,ae.ContextManagerService,ce.ConversationHistoryService,le.TaskHistoryService,ue.FileSystemService,pe.IgnoreConfigService,fe.FileFiltersFactory,oe.FileValidationService,ne.ValidatorRegistryService,se.ValidatorProvider,ie.TreeSitterValidator,ge.ResponseFormatterService,ye.FileContentOptimizerService,ve.ToolExecutorService,_e.ToolProvider,we.PromptBuilderService,be.RulesService,ke.StandardRulesService,l.UserService,De.AutocompleteRegistryService,Ne.AutocompleteRequestManagerService,je.WorkspaceFileIndexService,Fe.FilePathAutocompleteProvider,Le.SlashCommandAutocompleteProvider,W.BlockService,G.AgentStateManager,G.ContextTruncationHandler,G.LlmStreamProcessorBlock,G.AgentLoopOrchestrator,Te.ToolResultAggregatorService,B.CostCalculationService,H.TaskEventHandler,K.UserPromptHandler,V.FeedbackEventHandler,de.MentionsService,X.ToolEventHandler,J.ConfigEventHandler,Y.AgentModeHandler,Q.MessagingHandler,Z.EventHelper,Se.CancellationResetService,Re.ModelHistoryService,Ce.RateLimitRetryService,Pe.ProviderErrorMapperRegistry,Ee.SimpleLlmService,Ie.SimpleLlmCacheService,Oe.OpenSourceModelRegistryService,$e.FileSystemEventService,Me.CacheRegistryService,Ae.RecentFilesCacheService,xe.DirectoryStructureCacheService,rt.PersonaRegistry,ot.SoftwareEngineerPersona,nt.ProductManagerPersona,st.ArchitectPersona,it.CustomPersonaService,at.ComponentRegistry,ct.PersonaAssemblerService,Ue.ReadFileToolFactory,Be.WriteToFileToolFactory,qe.ReplaceInFileToolFactory,ze.ListFilesToolFactory,Ge.SearchFilesToolFactory,We.ExecuteCommandToolFactory,He.ListCodeDefinitionsToolFactory,Ve.McpConfigService,Ke.McpHubService,Xe.UseMcpToolToolFactory,Je.AccessMcpResourceToolFactory,Ye.AskFollowupQuestionToolFactory,Qe.PlanModeRespondToolFactory,Ze.AttemptCompletionToolFactory,et.CreateNewTaskToolFactory,tt.WebSearchToolFactory,{provide:"TOOL_FACTORIES",useFactory:(e,t,r,o,n,s,i,a,c,l,d,u,p,f)=>[e,t,r,o,n,s,i,a,c,l,d,u,p,f],inject:[Ue.ReadFileToolFactory,Be.WriteToFileToolFactory,qe.ReplaceInFileToolFactory,ze.ListFilesToolFactory,Ge.SearchFilesToolFactory,We.ExecuteCommandToolFactory,He.ListCodeDefinitionsToolFactory,Xe.UseMcpToolToolFactory,Je.AccessMcpResourceToolFactory,Ye.AskFollowupQuestionToolFactory,Qe.PlanModeRespondToolFactory,Ze.AttemptCompletionToolFactory,et.CreateNewTaskToolFactory,tt.WebSearchToolFactory]}],exports:[f.EveConfigService,m.ProviderRegistry,g.LlmMetadataService,c.LlmInitializerService,y.ModelRefreshService,v.ToolResultTransformerService,_.AnthropicProvider,_.GeminiProvider,_.OpenAIProvider,R.XaiProvider,h.ApiHandlerFactory,ve.ToolExecutorService,_e.ToolProvider,U.DbDebugContextService,l.UserService,ce.ConversationHistoryService,C.ProviderAdapterRegistry,Ee.SimpleLlmService]}),s(5,(0,i.Inject)("TOOL_FACTORIES")),n("design:paramtypes",[_e.ToolProvider,te.TreeSitterService,ae.ContextManagerService,U.DbDebugContextService,ee.AppDataSource,Array,Me.CacheRegistryService,Ae.RecentFilesCacheService,xe.DirectoryStructureCacheService])],lt)},91386:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAICompatibleUtils=void 0;const n=o(r(56082)),s=o(r(19055));t.OpenAICompatibleUtils=class{static createProviderMetadata(e){return{providerId:e.providerId,name:e.name,description:e.description,website:e.website,docsLink:e.docsLink,requiresApiKey:!0,defaultModelId:e.defaultModelId,defaultBaseUrl:e.baseUrl,apiKeyName:e.apiKeyName,features:e.features||{supportsStreaming:!0,supportsCaching:!0,supportsTools:!0,supportsImages:!0}}}static async discoverModelsViaAPI(e,t,r){try{const o=new n.default({apiKey:e,baseURL:t}),s=await o.models.list();return{models:s.data.map((e=>({modelId:e.id,providerId:r,name:e.id,contextWindow:32768,maxOutputTokens:8192,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:.5,outputCostPerMillionTokens:1.5}))),discoveredAt:new Date,discoveryMethod:"api",source:t}}catch(e){throw s.default.error(`[OpenAICompatibleUtils] Model discovery failed for ${t}: ${e.message}`),e}}static enhanceModelWithDefaults(e,t){return{modelId:e.modelId||"unknown",providerId:t,name:e.name||e.modelId||"Unknown Model",contextWindow:e.contextWindow||32768,maxOutputTokens:e.maxOutputTokens||8192,supportsImages:e.supportsImages||!1,supportsToolUse:e.supportsToolUse||!0,supportsComputerUse:e.supportsComputerUse||!1,supportsPromptCache:e.supportsPromptCache||!0,supportsThinkingTokens:e.supportsThinkingTokens||!1,inputCostPerMillionTokens:e.inputCostPerMillionTokens||.5,outputCostPerMillionTokens:e.outputCostPerMillionTokens||1.5,isDefaultForProvider:e.isDefaultForProvider||!1,...e}}}},91486:e=>{"use strict";e.exports=require("@langchain/core/messages")},91643:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},91760:function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.getDeepSeekModels=t.getQwenModels=void 0,n(r(39690),t),n(r(31424),t);var s=r(26573);Object.defineProperty(t,"getQwenModels",{enumerable:!0,get:function(){return s.getQwenModels}});var i=r(99538);Object.defineProperty(t,"getDeepSeekModels",{enumerable:!0,get:function(){return i.getDeepSeekModels}})},91926:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GeminiProvider=void 0;const i=r(3563),a=r(36206),c=s(r(19055)),l=r(91140),d=r(45789);let u=class{constructor(e){this.providerRegistry=e,c.default.info("[GeminiProvider] Initialized"),this.providerRegistry.registerProvider(this)}getId(){return d.GEMINI_PROVIDER_ID}getName(){return"Google Gemini"}getMetadata(){return{website:"https://ai.google.dev/",docs_link:"https://ai.google.dev/docs"}}requiresApiKey(){return!0}getDefaultBaseUrl(){return this.config?.geminiBaseUrl||void 0}getDefaultModelId(){return d.DEFAULT_GEMINI_MODEL_ID}getApiKeyName(){return"GOOGLE_API_KEY"}setConfig(e){this.config=e}getModelClient(e){const t={...e,baseUrl:this.config?.geminiBaseUrl||e.baseUrl},r=new l.GeminiModelClient(t,{});return this.discoverModels(e.apiKey,t.baseUrl).then((t=>{const o=t.find((t=>t.modelId===e.modelId));o?r.setModelMetadata(o):c.default.warn(`[GeminiProvider] Metadata not found for model ${e.modelId} during client creation.`)})).catch((t=>{c.default.warn(`[GeminiProvider] Failed to discover models for client ${e.modelId}: ${t.message}`)})),r}getProviderMetadata(){return{providerId:d.GEMINI_PROVIDER_ID,name:"Google Gemini",description:"Google Gemini models for advanced AI capabilities with multimodal support",website:"https://ai.google.dev/",docsLink:"https://ai.google.dev/docs",requiresApiKey:!0,defaultModelId:d.DEFAULT_GEMINI_MODEL_ID,apiKeyName:"GOOGLE_API_KEY",features:{supportsStreaming:!0,supportsCaching:!0,supportsTools:!0,supportsImages:!0,supportsThinking:!0}}}getStaticModels(){return(0,d.getStaticGeminiModels)()}async discoverDynamicModels(e,t,r){return{models:await(0,d.discoverGeminiModels)(e,t),discoveredAt:new Date,discoveryMethod:"api",source:t||"https://generativelanguage.googleapis.com"}}requiresApiKeyForDiscovery(){return!1}async discoverModels(e,t,r){return(0,d.discoverGeminiModels)(e,t)}};t.GeminiProvider=u,t.GeminiProvider=u=o([(0,i.Injectable)(),n("design:paramtypes",[a.ProviderRegistry])],u)},91943:e=>{"use strict";e.exports=require("fs/promises")},92003:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AgentConfig=void 0;t.AgentConfig=class{constructor(e,t=0,r,o=!0,n,s=0){this.model=e,this.temperature=t,this.recursionLimit=r,this.cachePrompt=o,this.privateModelsRequired=n,this.thinkingBudget=s}}},92427:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleLlmService=void 0;const i=r(3563),a=r(36206),c=r(9102),l=r(52368),d=r(18400),u=s(r(19055));let p=class{constructor(e,t,r){this.providerRegistry=e,this.eveConfigService=t,this.cacheService=r}async generateSimpleResponse(e,t,r,o,n,s,i=!0){u.default.info(`[SimpleLlmService] Generating simple response for user ${e} in ${t} mode`);const a=await this.eveConfigService.assembleFinalConfiguration(e,t);if(!a.apiKey&&this.providerRequiresApiKey(a.providerId))throw new Error(`No API key configured for provider: ${a.providerId}`);const c=this.providerRegistry.getProvider(a.providerId);if(!c)throw new Error(`Provider not found: ${a.providerId}`);let l;if(i&&this.cacheService.shouldCache(o,n||{})){l=this.cacheService.generateCacheKey(r,o,n||{},a.providerId,a.modelId);const t=await this.cacheService.get(l);if(t)return u.default.debug(`[SimpleLlmService] Cache hit for user ${e}`),t}const d={apiKey:a.apiKey||"",baseUrl:a.baseUrl,modelId:a.modelId,draftModelId:a.draftModelId,thinkingTokens:a.thinkingTokens,maxOutputTokens:n?.maxTokens},p=c.getModelClient(d);u.default.debug(`[SimpleLlmService] Using provider ${a.providerId} with model ${a.modelId}`);const f=await p.generateSimpleResponse(r,o,n,s);return i&&l&&await this.cacheService.set(l,f),f}async generateSimpleResponseWithOverride(e,t,r,o,n,s,i,a){u.default.info(`[SimpleLlmService] Generating simple response with override for user ${e}: ${r}/${o}`);await this.eveConfigService.assembleFinalConfiguration(e,t);let c;const d=await this.eveConfigService.findApiKeyForProvider(e,r);if(d)c=d.apiKey;else if(this.providerRequiresApiKey(r)){const e=this.providerRegistry.getProvider(r);if(e){const t=e.getApiKeyName();c=l.ConfigService.getProperty(t)}if(!c)throw new Error(`No API key configured for provider: ${r}`)}const p=this.providerRegistry.getProvider(r);if(!p)throw new Error(`Provider not found: ${r}`);if(!await this.eveConfigService.getModel(o))throw new Error(`Model not found: ${o}`);const f={apiKey:c||"",baseUrl:d?.baseUrl||p.getDefaultBaseUrl(),modelId:o,maxOutputTokens:i?.maxTokens},h=p.getModelClient(f);return u.default.debug(`[SimpleLlmService] Using override provider ${r} with model ${o}`),h.generateSimpleResponse(n,s,i,a)}providerRequiresApiKey(e){const t=this.providerRegistry.getProvider(e);return!t||t.requiresApiKey()}async getAvailableModelsForUser(e,t){const r=await this.eveConfigService.assembleFinalConfiguration(e,t);return this.eveConfigService.getModelsForProvider(r.providerId)}async getAvailableModels(e){return this.eveConfigService.getModelsForProvider(e)}async getUserConfiguration(e,t){return this.eveConfigService.assembleFinalConfiguration(e,t)}async testSimpleResponse(e,t="plan",r,o){const n="You are a helpful assistant.",s=[{id:"test-message",taskId:"test-task",role:"user",segments:[{type:"text",content:"Say hello!"}],providerId:r||"unknown",createdAt:new Date}];return r&&o?this.generateSimpleResponseWithOverride(e,t,r,o,n,s,{maxTokens:50,temperature:.5}):this.generateSimpleResponse(e,t,n,s,{maxTokens:50,temperature:.5})}};t.SimpleLlmService=p,t.SimpleLlmService=p=o([(0,i.Injectable)(),n("design:paramtypes",[a.ProviderRegistry,c.EveConfigService,d.SimpleLlmCacheService])],p)},92434:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GitUtils=void 0;const c=i(r(79896)),l=i(r(16928)),d=a(r(19055));class u{static ensureGitignoreExists(e){const t=l.join(e,".gitignore");return!c.existsSync(t)&&(d.default.info("No .gitignore file found, creating one with default patterns"),c.writeFileSync(t,this.DEFAULT_GITIGNORE),!0)}}t.GitUtils=u,u.DEFAULT_GITIGNORE="# Dependencies\nnode_modules/\n.pnpm-store/\nvenv/\npackage-lock.json\nyarn.lock\n\n# Build outputs\ndist/\nbuild/\ntarget/\n*.class\n*.jar\n*.war\n\n# IDEs and editors\n.idea/\n.vscode/\n*.swp\n*.swo\n.project\n.classpath\n.settings/\n\n# Logs and databases\n*.log\nlogs/\n*.sqlite\n*.db\n\n# Environment variables\n.env\n.env.*\n!.env.example\n\n# Testing\ncoverage/\n.nyc_output/\n\n# Temporary files\ntmp/\ntemp/\n.DS_Store\nThumbs.db\n\n# Compiled output\n*.pyc\n__pycache__/\n*.o\n*.so\n\n# Package files\n*.tgz\n*.zip\n*.tar.gz\n\n# Secrets\n*.pem\n*.key\n*.cert\n*.p12\n\n# Project specific\n.turbo/\n.cache/\n"},92529:(e,t,r)=>{"use strict";const o=r(79896),n=r(46747);e.exports=function(e){const t=Buffer.alloc(150);let r;try{r=o.openSync(e,"r"),o.readSync(r,t,0,150,0),o.closeSync(r)}catch(e){}return n(t.toString())}},93053:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AnthropicErrorMapper=void 0;const n=r(75028),s=r(9581),i=o(r(19055));class a extends n.BaseProviderErrorMapper{constructor(){super(...arguments),this.providerName="anthropic"}mapToEveAgentError(e){i.default.debug(`[AnthropicErrorMapper] Mapping error: ${JSON.stringify(e)}`);const t=this.extractStatusCode(e),r=this.extractMessage(e),o=e?.error?.type;if(this.isRateLimitError(e)){const n=this.extractRetryAfter(e);return new s.RateLimitError(r,this.providerName,n,{originalError:e,errorType:o,statusCode:t})}return this.isContextWindowError(e)?new s.ContextWindowError(r,this.providerName,{originalError:e,errorType:o,statusCode:t}):t?new s.ApiError(r,o||"ANTHROPIC_API_ERROR",t,{originalError:e,errorType:o},this.isRetriableStatusCode(t)):(0,s.toEveAgentError)(e,"ANTHROPIC_ERROR",r)}isRateLimitError(e){const t=this.extractStatusCode(e),r=e?.error?.type,o=this.extractMessage(e);return 429===t||"rate_limit_error"===r||o.toLowerCase().includes("rate limit")||o.toLowerCase().includes("too many requests")}extractRetryAfter(e){const t=e?.response?.headers?.["retry-after"]||e?.headers?.["retry-after"];if(t){const e=parseInt(t,10);if(!isNaN(e))return e}const r=this.extractMessage(e),o=r.match(/try again in (\d+) seconds?/i);if(o)return parseInt(o[1],10);const n=r.match(/try again in (\d+) minutes?/i);return n?60*parseInt(n[1],10):this.isRateLimitError(e)?(i.default.warn("[AnthropicErrorMapper] Rate limit error detected but no retry-after found. Defaulting to 60 seconds."),60):void 0}isContextWindowError(e){const t=e?.error?.type,r=this.extractMessage(e);return"invalid_request_error"===t&&(r.toLowerCase().includes("context window")||r.toLowerCase().includes("context length")||r.toLowerCase().includes("token limit")||r.toLowerCase().includes("maximum context"))}}t.AnthropicErrorMapper=a},93131:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ExecuteCommandTool=void 0;const a=r(3563),c=r(35317),l=i(r(19055)),d=r(20436),u=r(9581),p=r(52368),f=r(76910),h=r(8984);let m=o=class extends d.BaseTool{constructor(e,t){super(t),this.name="execute_command",this.description="Request to execute a CLI command on the system.",this.parameterSchema={command:{type:"string",required:!0,validate:e=>e&&""!==e.trim()},requires_approval:{type:"boolean",required:!0},timeout:{type:"number",required:!1,default:3e4,validate:e=>e>0&&e<=3e5}},this.workingDir=e}validateParams(e){try{const t=(0,h.convertToolParams)(e,this.parameterSchema);return Object.assign(e,t),!0}catch(e){return l.default.warn(`[${this.name}] Parameter validation failed: ${e.message}`),!1}}clipOutput(e,t,r){if(e.length<=t)return e;const o=e.substring(0,r),n=e.substring(e.length-(t-r));return`${o}\n[...CONTENT CLIPPED (${e.length-t} characters)...]\n${n}`}getBaseUsageInstructions(e){return`## execute_command\nDescription: Request to execute a CLI command on the system. Use this when you need to perform system operations or run specific commands to accomplish any step in the user's task. You must tailor your command to the user's system and provide a clear explanation of what the command does. For command chaining, use the appropriate chaining syntax for the user's shell. Prefer to execute complex CLI commands over creating executable scripts, as they are more flexible and easier to run. Commands will be executed in the current working directory: ${e.workingDir}\nParameters:\n- command: (required) The CLI command to execute. This should be valid for the current operating system. Ensure the command is properly formatted and does not contain any harmful instructions.\n- requires_approval: (required) A boolean indicating whether this command requires explicit user approval before execution in case the user has auto-approve mode enabled. Set to 'true' for potentially impactful operations like installing/uninstalling packages, deleting/overwriting files, system configuration changes, network operations, or any commands that could have unintended side effects. Set to 'false' for safe operations like reading files/directories, running development servers, building projects, and other non-destructive operations.\n- timeout: (optional) The maximum time in milliseconds to wait for the command to complete. Defaults to 30000 (30 seconds). If the command does not complete within this time, it will be terminated and a timeout message will be returned.\n\nCOMMAND EXECUTION GUIDELINES:\n- Review SYSTEM INFORMATION in environment_details for compatibility before execution\n- For commands outside ${e.workingDir}: use cd target_dir && your_command (as one command)\n- If no output appears, assume command succeeded and proceed\n- Use ask_followup_question tool if you absolutely need actual terminal output\n\nImportant Notes:\n- **CRITICAL: Must never try to stop running processes unless specifically asked to do so.**\n- This tool is NOT suitable for starting long-running processes like servers or watch commands. If you need to start a long-running process, ask the user to run the command manually.\n- Commands that take longer than the timeout will be terminated automatically.\n- Output is limited to a maximum length. If exceeded, only the beginning and end of the output will be returned with a message indicating content was clipped.\nUsage:\n<execute_command>\n<command>Your command here</command>\n<requires_approval>true or false</requires_approval>\n<timeout>30000</timeout> \x3c!-- Optional, defaults to 30000 (30 seconds) --\x3e\n</execute_command>`}getModeSpecificGuidance(e){return"plan"===e?"PLAN MODE GUIDANCE:\n- Use only for information gathering and analysis commands\n- Prefer read-only operations like ls, cat, grep, find, git status, etc.\n- Avoid commands that modify the system, install packages, or change files\n- Focus on understanding the current state of the project":null}async execute(e){const{command:t,requires_approval:r,timeout:n=3e4}=e,s=n,i=p.ConfigService.getNumericProperty(f.ConfigPropNames.COMMAND_OUTPUT_MAX_LENGTH,1e4),a=p.ConfigService.getNumericProperty(f.ConfigPropNames.COMMAND_OUTPUT_PREFIX_LENGTH,200);l.default.info(`[${o.name}] Executing command in ${this.workingDir} with ${s}ms timeout: ${t}`);const d=this.workingDir;return new Promise(((e,r)=>{try{const n=(0,c.spawn)(t,{shell:!0,cwd:d,stdio:["ignore","pipe","pipe"]});let p="",f="",h=!1;const m=setTimeout((()=>{h=!0;try{n.kill()}catch(e){l.default.error(`[${o.name}] Error killing process after timeout: ${e.message}`)}const r=`\n[Command timed out after ${s/1e3} seconds]`;l.default.warn(`[${o.name}] Command "${t}" timed out after ${s/1e3} seconds`);const c=this.clipOutput(p,i,a),d=this.clipOutput(f,i,a);e({output:(c+(d?"\n"+d:"")+r).trim(),exitCode:-1})}),s);n.stdout.on("data",(e=>{p+=e.toString()})),n.stderr.on("data",(e=>{f+=e.toString()})),n.on("close",(r=>{if(clearTimeout(m),!h){const n=this.clipOutput(p,i,a),s=this.clipOutput(f,i,a),c=(n+(s?"\n"+s:"")).trim();l.default.info(`[${o.name}] Command "${t}" executed with exit code: ${r}`),e({output:c,exitCode:null===r?-1:r})}})),n.on("error",(e=>{if(clearTimeout(m),!h){const n=`Error executing command "${t}": ${e.message}`;l.default.error(`[${o.name}] ${n}\n${e.stack}`);const s=e instanceof Error&&"code"in e&&"string"==typeof e.code?e.code:"COMMAND_EXECUTION_ERROR";r(new u.FileSystemError(n,s))}}))}catch(e){const n=`Error spawning command "${t}": ${e.message}`;l.default.error(`[${o.name}] ${n}\n${e.stack}`);const s=e instanceof Error&&"code"in e&&"string"==typeof e.code?e.code:"COMMAND_SPAWN_ERROR";r(new u.FileSystemError(n,s))}}))}};t.ExecuteCommandTool=m,t.ExecuteCommandTool=m=o=n([(0,a.Injectable)(),s("design:paramtypes",[String,Object])],m)},93239:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SummaryCompletion=void 0;const i=r(3563),a=r(81162),c=r(11544),l=r(91486),d=r(40724),u=s(r(19055)),p=r(92003);let f=class{constructor(){this.chatModelManager=c.ChatModelManager.getInstance()}async getSummary(e,t,r=a.ModelCategory.SUMMARISATION,o=!1,n){if(!t)throw new Error("Input content is empty - some models require input content to produce a summary");const s=n?new p.AgentConfig(n):new p.AgentConfig,i=await this.chatModelManager.getModel(s,r,o),c=[new l.SystemMessage(e),new l.HumanMessage(t)],f=new d.StringOutputParser,h=Date.now(),m=await i.baseChatModel.invoke(c),g=await f.invoke(m),y=Date.now()-h;return u.default.info("Summary produced by %s in %sms: %s",i.modelDescriptor.getFullName(),y,g),g}async getSummaryJson(e,t,r=a.ModelCategory.SUMMARISATION,o=!1,n){u.default.debug(`Getting summary JSON for prompt: ${e}`);const s=function(e){const t=e.indexOf("{"),r=e.indexOf("[");let o,n,s;if(-1!==t&&(-1===r||t<r))o=t,n="{",s="}";else{if(-1===r)return null;o=r,n="[",s="]"}let i=o+1,a=1;for(;i<e.length&&a>0;){const t=e[i];t===n?a++:t===s&&a--,i++}return 0===a?e.substring(o,i):null}((await this.getSummary(e,t,r,o,n)).trim());if(!s)throw new Error("No valid JSON object or array found in response");try{return JSON.parse(s),s}catch(e){throw new Error(`Failed to parse JSON from extracted content: ${e.message}`)}}};t.SummaryCompletion=f,t.SummaryCompletion=f=o([(0,i.Injectable)(),n("design:paramtypes",[])],f)},93409:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReplaceInFileTool=void 0;const u=r(3563),p=c(r(91943)),f=c(r(16928)),h=d(r(19055)),m=r(20436),g=r(9581),y=r(44731),v=r(81685),_=r(4243),w=r(79616),b=r(96775);let k=n=class extends m.BaseTool{constructor(e,t,r,o,n,s){super(o),this.name="replace_in_file",this.description="Request to replace sections of content in an existing file using SEARCH/REPLACE blocks.",this.workingDir=e,this.fileValidationService=t,this.fileSystemEventService=r,this.currentMode=n,this.systemContext=s}getFailureHandlingSuggestion(e){return e>=3?`The 'replace_in_file' tool has failed ${e} times consecutively. Consider using the 'write_to_file' tool with the complete intended file content instead. Keep in mind that using write_to_file means you'll be re-writing the entire contents of the file, so ensure you include ALL parts of the file in your write_to_file operation, not just the sections you want to change.`:null}getBaseUsageInstructions(e){const t=this.systemContext||e,r=this.getModelCapabilities(t);let o=y.DiffStrategyFactory.getStrategyForInstructions(r).generateUsageInstructions(r).replace("relative to the current working directory",`relative to the current working directory ${e.workingDir}`);return o+="\n\nCRITICAL MATCHING RULES:\n1. old_string must match file content EXACTLY (character-for-character)\n2. Include complete lines in SEARCH blocks, not partial lines\n3. For multiple SEARCH/REPLACE blocks, list them in file order (line 10 before line 50)\n4. Use proper JSON syntax with double quotes",o}getModeSpecificGuidance(e){return"plan"===e?"PLAN MODE GUIDANCE:\n- Only modify documentation files (e.g., .md, .txt, .rst)\n- Do NOT modify source code or configuration files in plan mode\n- Use this to update planning documents, requirements, specifications":null}isDocumentationFile(e){const t=f.extname(e).toLowerCase();return[".md",".txt",".rst",".asciidoc",".adoc",".org"].includes(t)}validateParams(e){const t="string"==typeof e.path&&""!==e.path.trim(),r="string"==typeof e.diff&&""!==e.diff.trim(),o="string"==typeof e.content&&""!==e.content.trim();return t&&(r||o)}async execute(e,t){const{path:r}=e,o=e.diff||e.content;if(!o)throw new g.FileSystemError('Missing diff content. Provide either "diff" or "content" parameter.',"MISSING_DIFF_CONTENT");if("plan"===this.currentMode&&!this.isDocumentationFile(r)){const e="WARNING: File edit was not performed as we are currently in PLAN mode and should not be editing non-documentation files. Only .md, .txt, .rst, .asciidoc, .adoc, and .org files can be modified in PLAN mode.";return h.default.warn(`[${n.name}] ${e}`),e}h.default.info(`[${n.name}] Replacing content in file: ${r} relative to ${this.workingDir}`),h.default.info(`[${n.name}] Diff length: ${o.length} characters`);const s=f.resolve(this.workingDir,r);if(!s.startsWith(this.workingDir)){const e=`Path traversal attempt detected: ${r} resolves outside of workspace ${this.workingDir}`;throw h.default.error(`[${n.name}] ${e}`),new g.FileSystemError(e,"PATH_TRAVERSAL_ERROR")}let i;try{let e;try{e=await p.stat(s)}catch(e){if("ENOENT"===e.code){const e=`File not found: ${r}`;throw h.default.error(`[${n.name}] ${e}`),new g.FileNotFoundError(e,r)}throw e}if(!e.isFile()){const e=`Path is not a file: ${r}`;throw h.default.error(`[${n.name}] ${e}`),new g.FileNotFoundError(e,r)}i=await p.readFile(s,"utf8"),h.default.info(`[${n.name}] Original file content length: ${i.length} characters`);try{const e=this.applyDiff(i,o,t),a=i!==e;h.default.info(`[${n.name}] Content changed: ${a}, new content length: ${e.length} characters`),await p.writeFile(s,e,"utf8"),this.fileSystemEventService.emitFileModified(this.workingDir,r,"replace"),h.default.info(`[${n.name}] File ${r} modified successfully`);let c=`File ${r} modified successfully`,l="";try{const e=await this.fileValidationService.validateFile(r,this.workingDir);e.hasErrors&&(l+="\n\nSyntax Validation Issues Found:",l+=`\n- ${e.report}`)}catch(e){h.default.error(`[${n.name}] Validation step failed for ${r}: ${e.message}`),l="\n\nNote: Syntax validation step encountered an error."}return c+=l,c}catch(e){if(e instanceof g.FileNotFoundError||e instanceof g.FileSystemError){const o=this.getModelCapabilities(t);if(o?.requiresEnhancedErrorMessages){const t=this.generateErrorMessage(e,o,r,i);throw new g.FileSystemError(t,e.code)}throw e}throw e}}catch(e){if(e instanceof g.FileNotFoundError||e instanceof g.FileSystemError)throw e;const t=`Error replacing content in file ${r}: ${e.message}`;throw h.default.error(`[${n.name}] ${t}\n${e.stack}`),new g.FileSystemError(t,e.code||"FS_REPLACE_ERROR")}}applyDiff(e,t,r){try{const o=this.stripCDataSections(t),s=this.getModelCapabilities(r),i=y.DiffStrategyFactory.getStrategy(o,s);h.default.info(`[${n.name}] Using diff strategy: ${i.name}`);const a=i.parse(o,s);h.default.info(`[${n.name}] Parsed diff contains ${a.length} search/replace blocks`),a.forEach(((e,t)=>{h.default.info(`[${n.name}] Search block ${t+1}: ${e.search.length} chars, Replace block: ${e.replace.length} chars`)}));const c=i.apply(e,a,s),l=e!==c.content;return h.default.info(`[${n.name}] Changes made by strategy: ${l}, applied ${c.appliedBlocks} blocks`),c.content}catch(e){throw h.default.error(`[${n.name}] Error in applyDiff: ${e.message}`),e}}getModelCapabilities(e){return e?.modelMetadata?.editToolCapabilities??v.DEFAULT_EDIT_TOOL_CAPABILITIES}generateErrorMessage(e,t,r,o){return r&&void 0!==o?b.ReplaceInFileErrorMessages.generateDiffError(r,o,t):b.ReplaceInFileErrorMessages.generateValidationError(e,t)}stripCDataSections(e){const t=e.trim();if(!t.includes("<![CDATA["))return e;if(/\]\]>\s*<!\[CDATA\[/.test(t)){let e=t.replace(/<!\[CDATA\[/g,"");return e=e.replace(/\]\]>/g,""),e}return t.startsWith("<![CDATA[")&&t.endsWith("]]>")?t.slice(9,-3):e}};t.ReplaceInFileTool=k,t.ReplaceInFileTool=k=n=a([(0,u.Injectable)(),l("design:paramtypes",[String,_.FileValidationService,w.FileSystemEventService,Object,String,Object])],k)},93470:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentRuleService=void 0;const s=r(3563),i=r(5025),a=r(95862);let c=class{constructor(e){this.ruleRepository=e}async getRulesByAgentName(e){const t=await this.ruleRepository.findByAgentName(e);return t||new a.AgentRule(e,"",new Date,new Date)}async upsertRule(e,t){const r=new a.AgentRule(e,t,new Date,new Date);await this.ruleRepository.upsert(r)}};t.AgentRuleService=c,t.AgentRuleService=c=o([(0,s.Injectable)(),n("design:paramtypes",[i.AgentRuleRepository])],c)},93520:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentController=void 0;const a=r(3563),c=r(71412),l=r(93470),d=i(r(19055));let u=class{constructor(e,t){this.agentServices=e,this.agentRuleService=t}getAgentService(e){const t=this.agentServices.get(e);if(!t)throw new Error(`Unknown agent: ${e}`);return t}async processRequestWithStream(e,t,r){try{const o=c.AgentRequest.fromJSON(t);r.setHeader("Content-Type","text/event-stream"),r.setHeader("Cache-Control","no-cache"),r.setHeader("Connection","keep-alive"),r.setHeader("Location",`/sessions/${o.sessionId}/stream`);for await(const t of this.getAgentService(e).processRequestStream(o))r.write(`data: ${JSON.stringify(t)}\n\n`);r.end()}catch(e){d.default.error(`Error processing request: ${e.message}`,e.stack),r.setHeader("Content-Type","application/json"),r.status(a.HttpStatus.BAD_REQUEST).json({statusCode:a.HttpStatus.BAD_REQUEST,message:"Error processing request",error:e.message,stack:void 0})}}async processRequestNoStream(e,t,r){try{const o=c.AgentRequest.fromJSON(t),n=await this.getAgentService(e).processRequest(o);d.default.info("Returning result: %s",JSON.stringify(n)),r.setHeader("Content-Type","application/json"),r.json(n)}catch(e){d.default.error(`Error processing request: ${e.message}`,e.stack),r.status(a.HttpStatus.BAD_REQUEST).json({statusCode:a.HttpStatus.BAD_REQUEST,message:"Error processing request",error:e.message,stack:void 0})}}async processRequestAndGetContent(e,t,r){try{const o=c.AgentRequest.fromJSON(t);let n=(await this.getAgentService(e).processRequest(o)).responseContent.trim();d.default.info("Raw result: %s",n);const s=r.req.headers.accept;if(s&&s.includes("application/json"))try{const e=n.match(/\{[\s\S]*\}/);if(e){const t=JSON.parse(e[0]);return n=t,d.default.info("Extracted JSON content: %s",JSON.stringify(t)),r.setHeader("Content-Type","application/json"),void r.json(t)}}catch(e){d.default.warn("Failed to extract JSON from response content: %s",e.message)}r.setHeader("Content-Type","text/plain"),r.send(n)}catch(e){d.default.error(`Error processing request: ${e.message}`,e.stack),r.status(a.HttpStatus.BAD_REQUEST).json({statusCode:a.HttpStatus.BAD_REQUEST,message:"Error processing request",error:e.message,stack:void 0})}}async getRules(e){return this.agentRuleService.getRulesByAgentName(e)}async updateRules(e,t){return await this.agentRuleService.upsertRule(e,t.content),{success:!0}}};t.AgentController=u,o([(0,a.Post)(":name/stream"),(0,a.HttpCode)(a.HttpStatus.OK),s(0,(0,a.Param)("name")),s(1,(0,a.Body)()),s(2,(0,a.Res)()),n("design:type",Function),n("design:paramtypes",[String,String,Object]),n("design:returntype",Promise)],u.prototype,"processRequestWithStream",null),o([(0,a.Post)(":name"),(0,a.HttpCode)(a.HttpStatus.OK),s(0,(0,a.Param)("name")),s(1,(0,a.Body)()),s(2,(0,a.Res)()),n("design:type",Function),n("design:paramtypes",[String,String,Object]),n("design:returntype",Promise)],u.prototype,"processRequestNoStream",null),o([(0,a.Post)(":name/responseContent"),(0,a.HttpCode)(a.HttpStatus.OK),s(0,(0,a.Param)("name")),s(1,(0,a.Body)()),s(2,(0,a.Res)()),n("design:type",Function),n("design:paramtypes",[String,String,Object]),n("design:returntype",Promise)],u.prototype,"processRequestAndGetContent",null),o([(0,a.Get)(":name/rules"),s(0,(0,a.Param)("name")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"getRules",null),o([(0,a.Put)(":name/rules"),s(0,(0,a.Param)("name")),s(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],u.prototype,"updateRules",null),t.AgentController=u=o([(0,a.Controller)("agents"),s(0,(0,a.Inject)("AGENT_SERVICES")),n("design:paramtypes",[Map,l.AgentRuleService])],u)},93548:e=>{"use strict";e.exports=require("@langchain/ollama")},94143:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RequestController=void 0;const i=r(3563),a=r(7373);let c=class{constructor(e){this.sessionService=e}async getRequest(e){return this.sessionService.getRequest(e)}};t.RequestController=c,o([(0,i.Get)(":requestId"),s(0,(0,i.Param)("requestId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"getRequest",null),t.RequestController=c=o([(0,i.Controller)("requests"),n("design:paramtypes",[a.SessionService])],c)},94279:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SourceArtefactController=void 0;const i=r(3563),a=r(33153);let c=class{constructor(e){this.sourceArtefactService=e}async importSourceArtefact(e){return this.sourceArtefactService.importSourceArtefact(e.scheme,e.locator,e.repoUrls)}async findById(e){return this.sourceArtefactService.findById(e)}async delete(e){return this.sourceArtefactService.delete(e)}async findBySchemeAndLocator(e,t){return this.sourceArtefactService.findBySchemeAndLocator(e,t)}async query(e,t,r=1,o=10,n="locator",s="ASC"){return this.sourceArtefactService.query(e,t,r,o,n,s)}};t.SourceArtefactController=c,o([(0,i.Post)("import"),s(0,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],c.prototype,"importSourceArtefact",null),o([(0,i.Get)(":id"),s(0,(0,i.Param)("id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"findById",null),o([(0,i.Delete)(":id"),s(0,(0,i.Param)("id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"delete",null),o([(0,i.Get)("find"),s(0,(0,i.Query)("scheme")),s(1,(0,i.Query)("locator")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],c.prototype,"findBySchemeAndLocator",null),o([(0,i.Get)(),s(0,(0,i.Query)("scheme")),s(1,(0,i.Query)("partialLocator")),s(2,(0,i.Query)("page")),s(3,(0,i.Query)("pageSize")),s(4,(0,i.Query)("sortBy")),s(5,(0,i.Query)("sortOrder")),n("design:type",Function),n("design:paramtypes",[String,String,Number,Number,String,String]),n("design:returntype",Promise)],c.prototype,"query",null),t.SourceArtefactController=c=o([(0,i.Controller)("source-artefacts"),n("design:paramtypes",[a.SourceArtefactService])],c)},95188:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Grep=void 0;const c=r(83153),l=r(11569),d=i(r(88489)),u=i(r(16928)),p=i(r(79896)),f=a(r(19055));class h extends c.Tool{static async main(e,t,r,o,n){f.default.info(`Starting grep search in workspace: ${e}`),f.default.info(`Parameters - startPath: ${t}, searchTerm: ${r}, filePattern: ${o}, max: ${n}`);const s=new h(e),i=await s._call({startPath:t,searchTerm:r,filePattern:o,max:n});return f.default.info("Grep search completed"),i}constructor(e){super(),this.name="grep",this.description="Use this grep tool to search for specific terms throughout the codebase when needed. Try to constrain the search to a specific files or a particular part of the codebase if possible.",this.schema=l.z.object({startPath:l.z.string().describe("The relative path to start the search from (use '.' for entire workspace)"),searchTerm:l.z.string().describe("The search term or regex pattern to look for"),filePattern:l.z.string().describe("Regex pattern to filter file names (required)"),max:l.z.number().optional().describe("Maximum number of files to return (optional, defaults to 20)")}),this.MAX_RESULTS=20,this.workspaceRootDir=e,d.config.silent=!0,d.config.fatal=!0}async _call(e){try{const{startPath:t,searchTerm:r,filePattern:o,max:n}=e,s=u.resolve(this.workspaceRootDir,t),i=n||this.MAX_RESULTS,a=5,c=new RegExp(o),l=this.getAllFiles(s,c),d=[];let h=!1;for(const e of l){if(d.length>=i){h=!0;break}try{const t=p.readFileSync(e,"utf-8").split("\n"),o=[];for(let e=0;e<t.length&&o.length<a;e++){const n=t[e];let s=!1;try{s=new RegExp(r).test(n)}catch(e){s=n.includes(r)}s&&o.push({lineNum:e+1,line:n.trim()})}o.length>0&&d.push({filePath:u.relative(this.workspaceRootDir,e),matches:o})}catch(t){f.default.info(`Skipping unreadable file ${e}: ${t.message}`);continue}}const m={matchingFiles:d};if(h){const e=`Stopped searching after finding matches in ${i} files. There may be more matching files.`;f.default.info(e),m.warning=e}return f.default.info(`Found matches in ${d.length} files`),JSON.stringify(m,null,2)}catch(e){throw f.default.info(`Error in grep search: ${e.message}`),new Error(`Error performing grep search: ${e.message}`)}}getAllFiles(e,t,r=[]){const o=p.readdirSync(e,{withFileTypes:!0});for(const n of o){const o=u.join(e,n.name);n.isDirectory()?this.getAllFiles(o,t,r):n.isFile()&&t.test(n.name)&&r.push(o)}return r}}t.Grep=h},95265:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBasePrompt=function(){return"You are Eve, an expert AI Product Manager with deep expertise in:\n\n- **Requirements Engineering:** Creating clear, comprehensive, and testable requirements\n- **Epic & Story Management:** Breaking down complex features into manageable deliverables\n- **Stakeholder Analysis:** Considering multiple perspectives (user, business, technical, security, compliance)\n- **Acceptance Criteria:** Writing detailed, testable criteria following Given/When/Then format\n- **Product Strategy:** Aligning features with business goals and user needs\n- **Technical Collaboration:** Working effectively with engineering teams\n\nYou excel at transforming high-level product vision into structured, actionable requirements that development teams can implement successfully."},t.getProductManagerInstructions=function(e){return"\nYou are expected to manage product requirements through epics, stories, and tasks, adhering to the \"Requirements to Code Workflow\" rule.\n\nKey Responsibilities:\n1.  **Creating and Refining Requirements:**\n    *   Develop clear, comprehensive epic requirements in `EpicName_prd.md`.\n    *   Break down epics into well-defined stories in `STORY_XX_StoryName.md`.\n    *   Write detailed, testable acceptance criteria for each story.\n    *   Ensure requirements are SMART (Specific, Measurable, Achievable, Relevant, Time-bound).\n    *   Update `EpicName_progress.md` to reflect current status.\n\n2.  **Stakeholder Perspective Analysis (Consider these for each requirement):**\n    *   **Product Value:** Does this deliver clear business value?\n    *   **User Experience:** How does this impact the end-user journey and usability?\n    *   **Quality Assurance:** Is this testable? What are the edge cases?\n    *   **Operations:** Are there scalability, monitoring, or maintenance considerations?\n    *   **Engineering:** Is this technically feasible? What is the complexity?\n    *   **Security:** Are there potential security implications?\n    *   **Compliance:** Does this meet regulatory and policy requirements?\n\n3.  **Story Creation Best Practices (as per 'Requirements to Code Workflow'):**\n    *   Write user-centric stories: \"As a [user type], I want [goal] so that [benefit]\".\n    *   Create comprehensive acceptance criteria (ACs):\n        *   Numbered, testable criteria (e.g., \"1. Given a [user type], when [action], then [outcome]\").\n        *   Cover happy path, edge cases, performance, error handling, security, and monitoring.\n\n4.  **Requirements Quality Standards:**\n    *   **Clarity:** Unambiguous and easily understood.\n    *   **Completeness:** Covers all aspects of the feature.\n    *   **Consistency:** Aligns with existing features and patterns.\n    *   **Testability:** Can be verified through testing.\n    *   **Feasibility:** Technically achievable within constraints.\n    *   **Traceability:** Links to business goals and metrics.\n\n\n  To work with epics in this workspace, you need to understand the file structure:\n  epics/\n    └── EPIC_Name/\n        ├── EpicName_prd.md\n        ├── EpicName_progress.md\n        └── STORY_01_StoryName/\n            ├── STORY_01_StoryName.md\n            ├── TASK_01_TaskName.md\n            └── TASK_02_TaskName2.md\n\n  Refer to the 'Requirements to Code Workflow' rule for detailed file formats and update procedures.\n  \n\nIMPORTANT:\n- Always write requirements from the user's perspective.\n- Every story MUST have clear, testable acceptance criteria as defined in the workflow rule.\n- Consider all stakeholder perspectives when defining requirements.\n- Ensure requirements are complete, clear, and unambiguous.\n- Include non-functional requirements (performance, security, etc.).\n- Adhere strictly to the file structures and YAML frontmatter defined in the 'Requirements to Code Workflow' rule when creating or updating requirement files.\n- Use the `replace_in_file` tool for precise updates to progress files and YAML frontmatter.\n"}},95312:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0;t.Request=class{constructor(e,t,r,o,n={}){this.responseContent="",this.startedAt=new Date,this.endedAt=new Date,this.tookMillis=0,this.inputTokens=0,this.cacheWriteTokens=0,this.cacheReadTokens=0,this.outputTokens=0,this.totalTokens=0,this.cost=0,this.filesChanged=0,this.insertions=0,this.deletions=0,this.testFilesChanged=0,this.testInsertions=0,this.testDeletions=0,this.linesChanged=0,this.testLinesChanged=0,this.requestId=e,this.sessionId=t,this.workspaceName=r,this.requestContent=o,Object.assign(this,n)}}},95775:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoredFileDto=void 0;class r{constructor(e){this.id=e.id,this.originalFilename=e.originalFilename,this.mimeType=e.mimeType,this.createdAt=e.createdAt,this.sessionId=e.sessionId,this.workspaceName=e.workspaceName}static fromStoredFile(e){return new r({id:e.id,originalFilename:e.originalFilename,mimeType:e.mimeType,createdAt:e.createdAt,sessionId:e.sessionId,workspaceName:e.workspaceName})}}t.StoredFileDto=r},95819:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBasePrompt=function(){return"You are Eve, an expert AI Software Architect with deep expertise in:\n\n- **Requirements Analysis:** Breaking down complex features into implementable components\n- **System Design:** Creating scalable, maintainable software architectures\n- **Task Decomposition:** Converting epics and stories into atomic, testable development tasks\n- **Technical Planning:** Designing implementation strategies that follow SOLID principles\n- **Codebase Analysis:** Understanding existing systems before proposing changes\n- **Technology Assessment:** Evaluating and recommending appropriate tech stacks\n- **Refactoring Strategy:** Planning systematic code improvements while maintaining stability\n\nYou excel at bridging the gap between high-level requirements and concrete implementation plans, ensuring that development teams have clear, actionable tasks that can be completed independently and tested thoroughly."},t.getArchitectInstructions=function(e){return'\nAs an expert AI Software Architect, your primary role is to analyze requirements and break them down into well-defined, implementable tasks following the "Requirements to Code Workflow" rule.\n\n## PRIMARY RESPONSIBILITIES\n\n### 1. STORY TASK BREAKDOWN (Primary Role)\nWhen breaking down an existing story into tasks:\n\n**Context Analysis Phase:**\n- Read the epic\'s `EpicName_prd.md` for high-level context\n- Study the `STORY_XX_StoryName.md` to understand acceptance criteria, architecture, and technical design\n- Research the existing codebase using read_file tool to understand current implementation\n- Read hints.md and README.md files to understand the tech stack\n- **CRITICAL:** Never make assumptions about the codebase - always use read_file to understand existing code before designing new code\n\n**Task Creation Following Workflow Rule:**\n- Create `TASK_XX_TaskName.md` files within the story directory\n- Follow the exact YAML frontmatter format specified in the workflow rule\n- Include all required content sections: Technical Approach, File Paths to Read, API Endpoint Details, etc.\n- Size tasks for atomic commits (single, complete, testable units)\n- Order tasks logically for implementation\n- Ensure each task fulfills specific acceptance criteria from the story\n\n### 2. EPIC/STORY PLANNING\nWhen asked to create a plan for something (and no specific EPIC is mentioned):\n\n**Epic Creation Process:**\n- Create new epic directory with `EPIC_Name/` structure\n- Create `EpicName_prd.md` with proper YAML frontmatter and required content sections\n- Create initial `EpicName_progress.md` with empty story checklist\n- Define 1-2 initial stories following the `STORY_XX_StoryName/` structure\n\n**Approval Process:**\n- **STOP and present the plan to user**\n- **Wait for approval before breaking down the first story**\n- Only proceed with task breakdown after user confirmation\n\n### 3. STORY CREATION\nWhen creating new stories:\n\n**Story File Creation:**\n- Create `STORY_XX_StoryName/` directory (numbered sequentially)\n- Create `STORY_XX_StoryName.md` with required YAML frontmatter\n- Include all required content sections:\n  - User-centric description: "As a [user type], I want [goal] so that [benefit]"\n  - Numbered, testable Acceptance Criteria\n  - Architecture section with Mermaid diagrams\n  - Technical Design Considerations (security, validation, performance, etc.)\n- Update epic progress file to include new story in checklist\n\n### 4. WORKFLOW COMPLIANCE\n**Always follow the "Requirements to Code Workflow" rule:**\n\n- Use exact file naming conventions: `EPIC_Name/`, `STORY_XX_StoryName/`, `TASK_XX_TaskName.md`\n- Include proper YAML frontmatter with all required fields\n- Update progress files using `replace_in_file` tool for precise updates\n- Mark tasks complete by changing status in YAML frontmatter\n- Update epic progress checklists when tasks/stories are completed\n\n## CRITICAL GUIDELINES\n\n- **Workflow Adherence:** Strictly follow the "Requirements to Code Workflow" rule for all file structures and formats\n- **Research First:** Always use read_file to examine existing code before proposing changes\n- **Atomic Tasks:** Tasks should be small (single commit) but complete (testable)\n- **Complete Coverage:** Every acceptance criterion must have a corresponding task\n- **YAML Precision:** Be exact when reading and updating YAML frontmatter\n- **Progress Tracking:** Always update both task-level and epic-level progress\n- **Tech Stack Validation:** If no tech stack is defined, propose one and STOP to ask user for confirmation\n- **User Approval:** Always stop and present plan to user before detailed breakdown\n\n## OPERATIONAL WORKFLOW\n\nWhen assigned a task, follow this sequence:\n1. Read `EpicName_progress.md` to understand current status\n2. Read the story file to understand acceptance criteria and technical design\n3. Read the specific task file for implementation details\n4. Execute the task following the technical approach\n5. Update task status in YAML frontmatter to "completed"\n6. Update epic progress file checklist and timestamps\n\nThe "Requirements to Code Workflow" rule provides the complete specification for file formats, directory structures, and operational procedures. Always refer to and follow that rule precisely.\n\nWhat follows may be more specific instructions which should be followed in preference to the general instructions above...\n'}},95846:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIAdapter=void 0;const i=r(3563),a=r(98280),c=r(42808),l=s(r(19055));let d=class{constructor(e){this.provider=e,this.id="openai",this.name="OpenAI",this.messageTransformer=new c.OpenAIMessageTransformer,l.default.info("[OpenAIAdapter] Initialized")}getProvider(){return this.provider}getModelClient(e){return this.provider.getModelClient(e)}toProviderFormat(e){return this.messageTransformer.toProviderFormat(e)}fromProviderFormat(e){return this.messageTransformer.fromProviderFormat(e,"")}extractMetadata(e){return{format:"openai-api"}}supportsThinking(){return!1}supportsFormatConversion(e){return!0}};t.OpenAIAdapter=d,t.OpenAIAdapter=d=o([(0,i.Injectable)(),n("design:paramtypes",[a.OpenAIProvider])],d)},95862:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AgentRule=void 0;t.AgentRule=class{constructor(e,t,r,o){this.agentName=e,this.content=t,this.createdAt=r,this.updatedAt=o}}},96170:function(e,t,r){"use strict";var o,n,s=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&s(t,e,r[n]);return i(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RulesService=void 0;const p=r(3563),f=(r(31832),c(r(16928))),h=c(r(79896)),m=r(53903),g=u(r(19055)),y=r(1145),v=r(22141),_=r(19668),w=r(16724);let b=n=class{constructor(e,t,r,o){this.fileSystemService=e,this.knex=t,this.userService=r,this.mentionsService=o,g.default.info(`[${n.name}] RulesService initialized`)}async getAllRules(e,t){try{let r;g.default.debug(`[${n.name}] Getting all rules for working directory: ${e}`);try{const e=await this.userService.getCurrentUser();r=e.userId,g.default.debug(`[${n.name}] Using authenticated user ID: ${r} (${e.email})`)}catch(e){r="system",g.default.warn(`[${n.name}] Failed to get user ID, falling back to 'system': ${e.message}`)}const o=(await this.getAllRulesWithPreferences(e,r,t)).filter((e=>e.isEnabled));return o.length>0?(g.default.debug(`[${n.name}] Found ${o.length} enabled rules in total`),this.formatRuleOutput(o)):void g.default.debug(`[${n.name}] No enabled rules found`)}catch(e){return void g.default.error(`[${n.name}] Error getting all rules: ${e.message}\n${e.stack}`)}}formatRuleOutputLegacy(e){return e.map((e=>`---- Rules from ${e.sourceIdentifier||e.id} ----\n${e.content}\n--------------------------------`)).join("\n\n")}async getRulesBySource(e,t,r,o){try{switch(e){case y.RuleSource.REPO:if(!r)throw new p.BadRequestException("Workspace path is required for repo rules");return this.getRepoRules(r,t,o);case y.RuleSource.USER:return this.getUserRules(t);case y.RuleSource.EVE:return this.getEveRules(t);default:throw new p.BadRequestException(`Invalid rule source: ${e}`)}}catch(e){throw g.default.error(`[${n.name}] Error getting rules by source: ${e.message}\n${e.stack}`),e}}async getRepoRules(e,t,r){try{const o=f.isAbsolute(e)?e:f.resolve(process.cwd(),e);g.default.debug(`[${n.name}] Getting repo rules for workspace: ${e}`),g.default.debug(`[${n.name}] Resolved absolute workspace path: ${o}`),g.default.debug(`[${n.name}] Current working directory: ${process.cwd()}`);const s=[],i=f.join(o,"hints.md");g.default.debug(`[${n.name}] Checking for hints.md at: ${i}`),await this.addRepoRuleIfExists(s,i,t,r,o);const a=f.join(o,".clinerules");g.default.debug(`[${n.name}] Checking for .clinerules directory at: ${a}`);const c=h.existsSync(a);g.default.debug(`[${n.name}] .clinerules directory sync exists check: ${c}`);const l=await this.fileSystemService.directoryExists(a);g.default.debug(`[${n.name}] .clinerules directory async exists check: ${l}`);try{if(c){const e=h.statSync(a).isDirectory();g.default.debug(`[${n.name}] Is .clinerules a directory (sync): ${e}`),e&&g.default.debug(`[${n.name}] .clinerules contents (sync): ${h.readdirSync(a)}`)}}catch(e){g.default.error(`[${n.name}] Error checking .clinerules directory: ${e.message}`)}await this.addRepoRulesFromDirectory(s,a,t,r,o);const d=f.join(o,".everules");return g.default.debug(`[${n.name}] Checking for .everules directory at: ${d}`),g.default.debug(`[${n.name}] Directory exists: ${h.existsSync(d)}`),await this.addRepoRulesFromDirectory(s,d,t,r,o),g.default.debug(`[${n.name}] Found ${s.length} repo rules`),s}catch(e){return g.default.error(`[${n.name}] Error getting repo rules: ${e.message}\n${e.stack}`),[]}}async addRepoRuleIfExists(e,t,r,o,s){try{if(h.existsSync(t)){const s=h.readFileSync(t,"utf8"),i=f.basename(t),a=this.getRelativePath(t),c=o?`${o}:${a}`:a,l=await this.getUserRulePreference(r,c);g.default.debug(`[${n.name}] Adding repo rule: ${c}, preference: ${l?JSON.stringify(l):"null"}`),e.push({id:c,name:i,content:s,sourceType:y.RuleSource.REPO,sourceIdentifier:a,isEnabled:!l||l.isEnabled,isEditable:!0,isDeletable:!0,createdAt:new Date,updatedAt:new Date})}}catch(e){g.default.error(`[${n.name}] Error adding repo rule: ${e.message}`)}}async addRepoRulesFromDirectory(e,t,r,o,s){try{if(h.existsSync(t)&&h.statSync(t).isDirectory()){const s=h.readdirSync(t).filter((e=>e.endsWith(".md"))).sort();g.default.debug(`[${n.name}] Found ${s.length} .md files in ${t}: ${s.join(", ")}`);for(const i of s){const s=f.join(t,i);g.default.debug(`[${n.name}] Processing rule file: ${s}`);const a=h.readFileSync(s,"utf8"),c=this.getRelativePath(s),l=o?`${o}:${c}`:c;g.default.debug(`[${n.name}] Rule ID (with workspace): ${l}`);const d=await this.getUserRulePreference(r,l);g.default.debug(`[${n.name}] User preference for ${l}: ${d?JSON.stringify(d):"null"}`),g.default.debug(`[${n.name}] Adding repo rule from directory: ${l}, preference: ${d?JSON.stringify(d):"null"}`),e.push({id:l,name:i,content:a,sourceType:y.RuleSource.REPO,sourceIdentifier:c,isEnabled:!d||d.isEnabled,isEditable:!0,isDeletable:!0,createdAt:new Date,updatedAt:new Date}),g.default.debug(`[${n.name}] Added rule: ${i}`)}}else g.default.debug(`[${n.name}] Directory does not exist or is not a directory: ${t}`)}catch(e){g.default.error(`[${n.name}] Error adding repo rules from directory: ${e.message}`)}}getRelativePath(e){const t=e.split(f.sep),r=t.indexOf(".everules"),o=t.indexOf(".clinerules");return r>=0?f.join(".everules",...t.slice(r+1)):o>=0?f.join(".clinerules",...t.slice(o+1)):"hints.md"===t[t.length-1]?"hints.md":e}async getUserRules(e){try{const t=await this.knex("eve_rules").where("source_type",y.RuleSource.USER).select("*");return await Promise.all(t.map((async t=>{const r=await this.getUserRulePreference(e,t.id);return g.default.debug(`[${n.name}] Adding user rule: ${t.id}, preference: ${r?JSON.stringify(r):"null"}`),{id:t.id,name:t.name,content:t.content,sourceType:t.source_type,sourceIdentifier:t.source_identifier,isEnabled:!!r&&r.isEnabled,isEditable:t.is_editable,isDeletable:t.is_deletable,createdAt:t.created_at,updatedAt:t.updated_at}})))}catch(e){return g.default.error(`[${n.name}] Error getting user rules: ${e.message}\n${e.stack}`),[]}}async getEveRules(e){try{const t=await this.knex("eve_rules").where("source_type",y.RuleSource.EVE).select("*");return await Promise.all(t.map((async t=>{const r=await this.getUserRulePreference(e,t.id);return g.default.debug(`[${n.name}] Adding Eve rule: ${t.id}, preference: ${r?JSON.stringify(r):"null"}`),{id:t.id,name:t.name,content:t.content,sourceType:t.source_type,sourceIdentifier:t.source_identifier,isEnabled:!!r&&r.isEnabled,isEditable:!1,isDeletable:!1,createdAt:t.created_at,updatedAt:t.updated_at}})))}catch(e){return g.default.error(`[${n.name}] Error getting Eve standard rules: ${e.message}\n${e.stack}`),[]}}async getRuleContent(e,t){try{switch(t){case y.RuleSource.REPO:throw new p.BadRequestException("Use getRepoRuleContent for repo rules");case y.RuleSource.USER:case y.RuleSource.EVE:const r=await this.knex("eve_rules").where("id",e).where("source_type",t).first();if(!r)throw new p.NotFoundException(`Rule ${e} not found`);return{content:r.content};default:throw new p.BadRequestException(`Invalid rule source: ${t}`)}}catch(e){throw g.default.error(`[${n.name}] Error getting rule content: ${e.message}\n${e.stack}`),e}}async getRepoRuleContent(e,t){try{const r=f.join(e,t);if(!h.existsSync(r))throw new p.NotFoundException(`Rule file ${t} not found`);return{content:h.readFileSync(r,"utf8")}}catch(e){throw g.default.error(`[${n.name}] Error getting repo rule content: ${e.message}\n${e.stack}`),e}}async updateRuleContent(e,t,r){try{switch(t){case y.RuleSource.REPO:throw new p.BadRequestException("Use updateRepoRuleContent for repo rules");case y.RuleSource.USER:const o=await this.knex("eve_rules").where("id",e).where("source_type",t).first();if(!o)throw new p.NotFoundException(`Rule ${e} not found`);if(!o.is_editable)throw new p.BadRequestException(`Rule ${e} cannot be edited`);await this.knex("eve_rules").where("id",e).update({content:r,updated_at:new Date});break;case y.RuleSource.EVE:throw new p.BadRequestException("Eve standard rules cannot be edited");default:throw new p.BadRequestException(`Invalid rule source: ${t}`)}}catch(e){throw g.default.error(`[${n.name}] Error updating rule content: ${e.message}\n${e.stack}`),e}}async updateRepoRuleContent(e,t,r){try{const o=f.join(e,t);if(!h.existsSync(o))throw new p.NotFoundException(`Rule file ${t} not found`);h.writeFileSync(o,r)}catch(e){throw g.default.error(`[${n.name}] Error updating repo rule content: ${e.message}\n${e.stack}`),e}}async toggleRuleStatus(e,t,r){try{g.default.debug(`[${n.name}] Toggling rule status for rule ID: ${e}, user ID: ${t}, enabled: ${r}`);const o=await this.getUserRulePreference(t,e);if(g.default.debug(`[${n.name}] Existing preference: ${o?JSON.stringify(o):"none"}`),o){g.default.debug(`[${n.name}] Updating existing preference for rule ID: ${e}`);const o=await this.knex("eve_user_rule_preferences").where("user_id",t).where("rule_id",e).update({is_enabled:r?1:0,updated_at:new Date});g.default.debug(`[${n.name}] Update result: ${o} rows affected`)}else{g.default.debug(`[${n.name}] Creating new preference for rule ID: ${e}`);const o=await this.knex("eve_user_rule_preferences").insert({user_id:t,rule_id:e,is_enabled:r?1:0,created_at:new Date,updated_at:new Date});g.default.debug(`[${n.name}] Insert result: ${o}`)}const s=await this.getUserRulePreference(t,e);return void g.default.debug(`[${n.name}] Updated preference: ${s?JSON.stringify(s):"none"}`)}catch(e){throw g.default.error(`[${n.name}] Error toggling rule status: ${e.message}\n${e.stack}`),e}}async createRule(e,t,r,o,s){try{switch(e){case y.RuleSource.REPO:if(!o)throw new p.BadRequestException("Workspace path is required for repo rules");return this.createRepoRule(o,t,r,s);case y.RuleSource.USER:return this.createUserRule(t,r);case y.RuleSource.EVE:throw new p.BadRequestException("Eve standard rules cannot be created");default:throw new p.BadRequestException(`Invalid rule source: ${e}`)}}catch(e){throw g.default.error(`[${n.name}] Error creating rule: ${e.message}\n${e.stack}`),e}}async createRepoRule(e,t,r,o){try{const n=f.join(e,".everules");h.existsSync(n)||h.mkdirSync(n,{recursive:!0});const s=f.join(n,t);h.writeFileSync(s,r);const i=f.join(".everules",t);return{id:o?`${o}:${i}`:i,name:t,content:r,sourceType:y.RuleSource.REPO,sourceIdentifier:i,isEnabled:!0,isEditable:!0,isDeletable:!0,createdAt:new Date,updatedAt:new Date}}catch(e){throw g.default.error(`[${n.name}] Error creating repo rule: ${e.message}\n${e.stack}`),e}}async createUserRule(e,t){try{const r=(0,m.v4)();return await this.knex("eve_rules").insert({id:r,name:e,content:t,source_type:y.RuleSource.USER,is_editable:!0,is_deletable:!0,created_at:new Date,updated_at:new Date}),{id:r,name:e,content:t,sourceType:y.RuleSource.USER,isEnabled:!0,isEditable:!0,isDeletable:!0,createdAt:new Date,updatedAt:new Date}}catch(e){throw g.default.error(`[${n.name}] Error creating user rule: ${e.message}\n${e.stack}`),e}}async deleteRule(e,t){try{switch(t){case y.RuleSource.REPO:throw new p.BadRequestException("Use deleteRepoRule for repo rules");case y.RuleSource.USER:const r=await this.knex("eve_rules").where("id",e).where("source_type",t).first();if(!r)throw new p.NotFoundException(`Rule ${e} not found`);if(!r.is_deletable)throw new p.BadRequestException(`Rule ${e} cannot be deleted`);await this.knex("eve_rules").where("id",e).delete(),await this.knex("eve_user_rule_preferences").where("rule_id",e).delete();break;case y.RuleSource.EVE:throw new p.BadRequestException("Eve standard rules cannot be deleted");default:throw new p.BadRequestException(`Invalid rule source: ${t}`)}}catch(e){throw g.default.error(`[${n.name}] Error deleting rule: ${e.message}\n${e.stack}`),e}}async deleteRepoRule(e,t){try{const r=f.join(e,t);if(!h.existsSync(r))throw new p.NotFoundException(`Rule file ${t} not found`);h.unlinkSync(r)}catch(e){throw g.default.error(`[${n.name}] Error deleting repo rule: ${e.message}\n${e.stack}`),e}}async getUserRulePreference(e,t){try{g.default.debug(`[${n.name}] Getting user rule preference for user ID: ${e}, rule ID: ${t}`);const r=await this.knex("eve_user_rule_preferences").where("user_id",e).where("rule_id",t).first();if(!r)return g.default.debug(`[${n.name}] No preference found for user ID: ${e}, rule ID: ${t}`),null;const o=1===r.is_enabled||!0===r.is_enabled;return g.default.debug(`[${n.name}] Found preference for user ID: ${e}, rule ID: ${t}, is_enabled: ${r.is_enabled} (raw), ${o} (boolean)`),{userId:r.user_id,ruleId:r.rule_id,isEnabled:o,createdAt:r.created_at,updatedAt:r.updated_at}}catch(e){return g.default.error(`[${n.name}] Error getting user rule preference: ${e.message}\n${e.stack}`),null}}async setUserRulePreference(e,t,r){try{g.default.debug(`[${n.name}] Setting user rule preference for user ID: ${e}, rule ID: ${t}, enabled: ${r}`);if(await this.getUserRulePreference(e,t)){g.default.debug(`[${n.name}] Updating existing preference for rule ID: ${t}`);const o=await this.knex("eve_user_rule_preferences").where("user_id",e).where("rule_id",t).update({is_enabled:r?1:0,updated_at:new Date});g.default.debug(`[${n.name}] Update result: ${o} rows affected`)}else{g.default.debug(`[${n.name}] Creating new preference for rule ID: ${t}`);const o=await this.knex("eve_user_rule_preferences").insert({user_id:e,rule_id:t,is_enabled:r?1:0,created_at:new Date,updated_at:new Date});g.default.debug(`[${n.name}] Insert result: ${o}`)}const o=await this.getUserRulePreference(e,t);g.default.debug(`[${n.name}] Updated preference: ${o?JSON.stringify(o):"none"}`)}catch(e){throw g.default.error(`[${n.name}] Error setting user rule preference: ${e.message}\n${e.stack}`),e}}async getAllRulesWithPreferences(e,t,r){try{g.default.debug(`[${n.name}] Getting all rules with preferences for working directory: ${e}`);const o=await this.getRepoRules(e,t,r),s=await this.getUserRules(t),i=await this.getEveRules(t);return[...o,...s,...i]}catch(e){return g.default.error(`[${n.name}] Error getting all rules with preferences: ${e.message}\n${e.stack}`),[]}}async getRulesWithProcessedMentions(e,t,r){try{g.default.debug(`[${n.name}] Getting rules with processed mentions for working directory: ${e}`);const o=(await this.getAllRulesWithPreferences(e,t,r)).filter((e=>e.isEnabled));if(0===o.length)return g.default.debug(`[${n.name}] No enabled rules found`),{referencedFiles:[]};const{processedRules:s,referencedFiles:i}=await this.mentionsService.processRulesMentions(o,e);return g.default.debug(`[${n.name}] Processed ${s.length} rules with ${i.length} referenced files`),{rulesText:this.formatRuleOutput(s),referencedFiles:i}}catch(e){return g.default.error(`[${n.name}] Error getting rules with processed mentions: ${e.message}\n${e.stack}`),{referencedFiles:[]}}}formatRuleOutput(e){return e.map((e=>{e.sourceIdentifier||e.name;return`---- Rule: ${e.name} ----\n${e.content}\n--------------------------------`})).join("\n\n")}};t.RulesService=b,t.RulesService=b=n=a([(0,p.Injectable)(),d(1,(0,p.Inject)("KNEX")),l("design:paramtypes",[v.FileSystemService,Function,_.UserService,w.MentionsService])],b)},96228:e=>{"use strict";e.exports=require("@langchain/openai")},96295:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleAgentService=void 0;const i=r(3563),a=r(71412),c=r(88474),l=r(7373),d=r(30538),u=r(93239),p=r(29234),f=r(59100),h=s(r(19055)),m=r(4911),g=r(11544),y=r(86254),v=r(86158),_=r(93470);let w=class{constructor(e,t,r,o,n,s){this.workspaceService=e,this.sessionService=t,this.homeService=r,this.summaryCompletion=o,this.toolFactory=n,this.ruleService=s,this.chatModelManager=g.ChatModelManager.getInstance()}async getAgentRules(){const e=await this.ruleService.getRulesByAgentName(this.getName());return e?.content||null}createInitialState(){return{messages:[]}}async*processRequestStream(e){const t=(0,f.ulid)();if(!await this.homeService.isAccessOkay()){const r={label:"Error",content:"Access is not valid. Please check your Eve API key and try again."},o=await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:e.sessionId||this.generateSessionId(),label:r.label,content:r.content,createdAt:new Date,requestId:t});return void(yield o)}const r=new Date;e.sessionId||(e.sessionId=this.generateSessionId());const o=await this.chatModelManager.getModel(e.config,this.getModelCategory(),this.isPrivateModelsOnly());let n;e.workspaceName?n=await this.workspaceService.lockByName(e.workspaceName):(n=await this.workspaceService.lockSessionWorkspace(e.sessionId),e.workspaceName=n.name);const s=n.name,i=new p.RequestContext(n,t,e.sessionId);let c=!1,l=0,d=0,u=0,g=0,v="";try{const n=a.AgentRequest.getFirstTextContent(e.content),s=await this.sessionService.ensureSession(e.workspaceName,e.sessionId,n,this.getName());await this.sessionService.updateSessionStatus(s.sessionId,"active"),h.default.info("%s received request: %s - %s",this.getName(),t,JSON.stringify(e)),h.default.info("Using primary model: %s",o.modelDescriptor.getFullName()),await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:e.sessionId,label:"Human",content:n,createdAt:new Date,requestId:t}),await this.sessionService.addRequest({requestId:t,sessionId:e.sessionId,workspaceName:e.workspaceName,requestContent:n,startedAt:r});const p=await this.handleAppStream(e,i,o);for await(const r of p){h.default.debug("Output Event was: %s",JSON.stringify(r));const n=y.MessageUtils.processOutputEvent(r);h.default.debug("Processed message: %s",n);const s=n.usageMetadata,i=o.calculateCost(s?.inputTokens||0,s?.cacheWriteTokens||0,s?.cacheReadTokens||0,s?.outputTokens||0),a={itemId:this.generateItemId(),sessionId:e.sessionId,label:n.label,content:n.content,createdAt:new Date,inputTokens:s?.inputTokens,cacheWriteTokens:s?.cacheWriteTokens,cacheReadTokens:s?.cacheReadTokens,outputTokens:s?.outputTokens,totalTokens:s?.totalTokens,cost:i,requestId:t},p=await this.sessionService.addItem(a);l+=s?.inputTokens||0,d+=s?.cacheWriteTokens||0,u+=s?.cacheReadTokens||0,g+=s?.outputTokens||0,v=n.content;const f=await this.sessionService.getSession(e.sessionId);if(c=f&&"aborted"===f.status,c){const t={label:"Error",content:"Session was aborted by the user."},r=await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:e.sessionId,label:t.label,content:t.content,createdAt:new Date});yield r;break}yield p}}catch(t){h.default.error("Error in Agent:",t);const r={label:"Error",content:`An error occurred: ${t.message}`},o=await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:e.sessionId,label:r.label,content:r.content,createdAt:new Date});yield o}finally{try{if(!c&&n.isGitRepo){const e=new m.GitCommit(n.repoBaseDir,t,this.sessionService);if(await e.hasUncommittedUpdates()){const t=await e.getUncommittedChanges(),r="Give me a good commit message for the following diff contents - just return the message without quotes",o=await this.summaryCompletion.getSummary(r,t);h.default.info("Detected uncommitted git updates - committing changes with message: "+o),await e._call(o)}}await this.sessionService.updateSessionStatus(e.sessionId,"inactive");const s=o.calculateCost(l,d,u,g),i=new Date,a=i.getTime()-r.getTime(),p=l+d+u+g,f=await this.sessionService.updateRequest(t,{responseContent:v,endedAt:i,tookMillis:a,inputTokens:l,cacheWriteTokens:d,cacheReadTokens:u,outputTokens:g,totalTokens:p,cost:s});await this.homeService.logRequest(f),h.default.info("Agent processing completed in %s seconds - Input tokens: %s, Cache Write tokens: %s, Cache Read tokens: %s, Output tokens: %s, Total tokens: %s, Total cost: £%s",a/1e3,l,d,u,g,p,s.toFixed(6))}finally{s&&await this.workspaceService.unlockByName(s)}}}async processRequest(e){h.default.info("Processing request: %s",JSON.stringify(e));const t=this.processRequestStream(e);let r=null;for await(const e of t)r=e,h.default.info("Yielded item: %s",JSON.stringify(e));if(!r)throw new Error("No items were yielded from the generator");const o=await this.sessionService.getRequest(r?.requestId);if(!o)throw new Error("Failed to retrieve persisted request");return h.default.info("Returning request: %s",JSON.stringify(o)),o}async simpleRequest(e,t,r=null){const o=new a.AgentRequest(null,e,r,null,t);return(await this.processRequest(o)).responseContent}generateSessionId(){return(0,f.ulid)()}generateItemId(){return(0,f.ulid)()}};t.SimpleAgentService=w,t.SimpleAgentService=w=o([(0,i.Injectable)(),n("design:paramtypes",[c.WorkspaceService,l.SessionService,d.HomeService,u.SummaryCompletion,v.ToolFactoryService,_.AgentRuleService])],w)},96297:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.debugLogger=t.DebugLogger=void 0;const c=i(r(79896)),l=i(r(16928)),d=a(r(19055));class u{constructor(){this.enabled=!1;const e=l.join(process.cwd(),"logs","debug");c.existsSync(e)||c.mkdirSync(e,{recursive:!0}),this.logFile=l.join(e,`debug-${Date.now()}.log`),d.default.info(`Debug logger initialized with log file: ${this.logFile}`)}static getInstance(){return u.instance||(u.instance=new u),u.instance}enable(){this.enabled=!0,this.log("Debug logging enabled")}disable(){this.log("Debug logging disabled"),this.enabled=!1}log(e,t){if(!this.enabled)return;const r=`[${(new Date).toISOString()}] ${e}`;if(t){const e="string"==typeof t?t:JSON.stringify(t,null,2);c.appendFileSync(this.logFile,`${r}\n${e}\n\n`)}else c.appendFileSync(this.logFile,`${r}\n`)}dumpObject(e,t){this.enabled&&this.log(`${e}:`,t)}}t.DebugLogger=u,t.debugLogger=u.getInstance()},96428:function(e,t,r){"use strict";var o,n=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FilePathAutocompleteProvider=void 0;const a=r(3563),c=r(88474),l=r(33583),d=i(r(19055)),u=r(73388);let p=o=class{constructor(e,t){this.workspaceFileIndexService=e,this.workspaceService=t}getTriggerChar(){return"@"}getName(){return"file-path"}async search(e,t){if(!e||e.trim().length<1)return d.default.debug(`[${o.name}] Query too short for file search: "${e}"`),[];if(!t.workspaceName)return d.default.debug(`[${o.name}] No workspace name provided`),[];const r=await this.workspaceService.findOne(t.workspaceName);if(!r||!r.repoBaseDir)return d.default.debug(`[${o.name}] Workspace not found or no repoBaseDir: ${t.workspaceName}`),[];d.default.debug(`[${o.name}] Searching for "${e}" in workspace: ${r.repoBaseDir}`);const n=await this.workspaceFileIndexService.getFiles(r.repoBaseDir,e);return d.default.debug(`[${o.name}] Found ${n.length} files for query "${e}"`),n.map((e=>({id:e.path,label:e.path,description:e.isDir?"Directory":this.getFileDescription(e),icon:e.isDir?"mdi-folder":(0,u.getFileIconFromPath)(e.path,e.isDir),category:e.isDir?"directory":"file",metadata:{isDirectory:e.isDir,sizeBytes:e.sizeBytes,path:e.path}})))}getFileDescription(e){if(e.isDir)return"Directory";const t=e.sizeBytes||0;return t<1024?`${t} B`:t<1048576?`${(t/1024).toFixed(1)} KB`:`${(t/1048576).toFixed(1)} MB`}};t.FilePathAutocompleteProvider=p,t.FilePathAutocompleteProvider=p=o=n([(0,a.Injectable)(),s("design:paramtypes",[l.WorkspaceFileIndexService,c.WorkspaceService])],p)},96775:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReplaceInFileErrorMessages=void 0;t.ReplaceInFileErrorMessages=class{static generateDiffError(e,t,r){const o=r?.requiresEnhancedErrorMessages??!1;let n="This is likely because the SEARCH block content doesn't match exactly with what's in the file.";return o&&(n+=" Please ensure that when using the replace_in_file tool:\n- Do NOT add extra characters to the markers\n- Do NOT forget to use the closing marker  \n- Do NOT modify the marker format in any way\n- Malformed formatting will cause complete tool failure"),n+="\n\nThe file was reverted to its original state:\n\n",n+=`<file_content path="${e}">\n${t}\n</file_content>\n\n`,n+="Try the operation again with fewer, more precise SEARCH blocks.",o&&(n+="\n(If you run into this error 3 times in a row, you may use the write_to_file tool as a fallback.)"),n}static generateValidationError(e,t){const r=t?.requiresEnhancedErrorMessages??!1;let o=`Invalid diff format: ${e.message}`;if(r){const e=t?.preferredDiffFormat||"traditional";o+=`\n\nThis model prefers the ${e} format. `,o+="json"===e?'Please use JSON format:\n{\n  "replacements": [\n    {\n      "old_string": "exact string from file",\n      "new_string": "replacement string"\n    }\n  ]\n}':"Please use traditional SEARCH/REPLACE format:\n<<<<<<< SEARCH\nexact content to find\n=======\nnew content to replace with\n>>>>>>> REPLACE"}return o}static generateFormatError(e,t,r){const o=r?.requiresEnhancedErrorMessages??!1;let n=`${e.toUpperCase()} format error: ${t}`;return o&&(n+="json"===e?'\n\nEnsure your JSON follows this exact structure:\n{\n  "replacements": [\n    {\n      "old_string": "exact text from file",\n      "new_string": "replacement text"\n    }\n  ]\n}\n\nCommon JSON errors:\n- Missing quotes around property names\n- Trailing commas\n- Unescaped quotes in strings':"\n\nEnsure your traditional format follows this structure:\n<<<<<<< SEARCH\nexact content to find\n=======\nnew content to replace with\n>>>>>>> REPLACE\n\nCommon traditional format errors:\n- Incorrect marker formatting\n- Missing end markers\n- Extra characters in markers"),n}}},96804:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const o=r(71064),n=r(10815);class s extends o.Protocol{constructor(e,t){var r;super(t),this._clientInfo=e,this._capabilities=null!==(r=null==t?void 0:t.capabilities)&&void 0!==r?r:{}}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=(0,o.mergeCapabilities)(this._capabilities,e)}assertCapability(e,t){var r;if(!(null===(r=this._serverCapabilities)||void 0===r?void 0:r[e]))throw new Error(`Server does not support ${e} (required for ${t})`)}async connect(e,t){if(await super.connect(e),void 0===e.sessionId)try{const e=await this.request({method:"initialize",params:{protocolVersion:n.LATEST_PROTOCOL_VERSION,capabilities:this._capabilities,clientInfo:this._clientInfo}},n.InitializeResultSchema,t);if(void 0===e)throw new Error(`Server sent invalid initialize result: ${e}`);if(!n.SUPPORTED_PROTOCOL_VERSIONS.includes(e.protocolVersion))throw new Error(`Server's protocol version is not supported: ${e.protocolVersion}`);this._serverCapabilities=e.capabilities,this._serverVersion=e.serverInfo,this._instructions=e.instructions,await this.notification({method:"notifications/initialized"})}catch(e){throw this.close(),e}}getServerCapabilities(){return this._serverCapabilities}getServerVersion(){return this._serverVersion}getInstructions(){return this._instructions}assertCapabilityForMethod(e){var t,r,o,n,s;switch(e){case"logging/setLevel":if(!(null===(t=this._serverCapabilities)||void 0===t?void 0:t.logging))throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!(null===(r=this._serverCapabilities)||void 0===r?void 0:r.prompts))throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":case"resources/subscribe":case"resources/unsubscribe":if(!(null===(o=this._serverCapabilities)||void 0===o?void 0:o.resources))throw new Error(`Server does not support resources (required for ${e})`);if("resources/subscribe"===e&&!this._serverCapabilities.resources.subscribe)throw new Error(`Server does not support resource subscriptions (required for ${e})`);break;case"tools/call":case"tools/list":if(!(null===(n=this._serverCapabilities)||void 0===n?void 0:n.tools))throw new Error(`Server does not support tools (required for ${e})`);break;case"completion/complete":if(!(null===(s=this._serverCapabilities)||void 0===s?void 0:s.completions))throw new Error(`Server does not support completions (required for ${e})`)}}assertNotificationCapability(e){var t;if("notifications/roots/list_changed"===e)if(!(null===(t=this._capabilities.roots)||void 0===t?void 0:t.listChanged))throw new Error(`Client does not support roots list changed notifications (required for ${e})`)}assertRequestHandlerCapability(e){switch(e){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Client does not support sampling capability (required for ${e})`);break;case"roots/list":if(!this._capabilities.roots)throw new Error(`Client does not support roots capability (required for ${e})`)}}async ping(e){return this.request({method:"ping"},n.EmptyResultSchema,e)}async complete(e,t){return this.request({method:"completion/complete",params:e},n.CompleteResultSchema,t)}async setLoggingLevel(e,t){return this.request({method:"logging/setLevel",params:{level:e}},n.EmptyResultSchema,t)}async getPrompt(e,t){return this.request({method:"prompts/get",params:e},n.GetPromptResultSchema,t)}async listPrompts(e,t){return this.request({method:"prompts/list",params:e},n.ListPromptsResultSchema,t)}async listResources(e,t){return this.request({method:"resources/list",params:e},n.ListResourcesResultSchema,t)}async listResourceTemplates(e,t){return this.request({method:"resources/templates/list",params:e},n.ListResourceTemplatesResultSchema,t)}async readResource(e,t){return this.request({method:"resources/read",params:e},n.ReadResourceResultSchema,t)}async subscribeResource(e,t){return this.request({method:"resources/subscribe",params:e},n.EmptyResultSchema,t)}async unsubscribeResource(e,t){return this.request({method:"resources/unsubscribe",params:e},n.EmptyResultSchema,t)}async callTool(e,t=n.CallToolResultSchema,r){return this.request({method:"tools/call",params:e},t,r)}async listTools(e,t){return this.request({method:"tools/list",params:e},n.ListToolsResultSchema,t)}async sendRootsListChanged(){return this.notification({method:"notifications/roots/list_changed"})}}t.Client=s},97751:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComputerToolBase=void 0;const o=r(83153),n=r(11569);class s extends o.Tool{constructor(){super(),this.name="computer",this.description='Interact with the screen, keyboard, and mouse of the current computer. Available actions:\n    - key: Send keyboard key events (requires text parameter with key sequence)\n    - type: Type text directly (requires text parameter with content to type)\n    - mouse_move: Move mouse cursor to coordinates (requires coordinate parameter [x, y])\n    - left_click: Perform a left mouse click at current position\n    - left_click_drag: Click and drag from current position to coordinates (requires coordinate parameter [x, y])\n    - right_click: Perform a right mouse click at current position\n    - middle_click: Perform a middle mouse click at current position\n    - double_click: Perform a double click at current position\n    - screenshot: Take a screenshot of the current screen\n    - cursor_position: Get the current cursor position\n    \n    Example: {"action": "type", "text": "Hello World"} or {"action": "mouse_move", "coordinate": [100, 200]}',this.schema=n.z.object({input:n.z.string().optional()}).transform((e=>{try{return JSON.parse(e.input||"{}")}catch(e){return{}}})),this.scale=parseFloat(process.env.SCALE||"0.5"),(isNaN(this.scale)||this.scale<=0||this.scale>1)&&(console.warn(`Invalid SCALE value ${process.env.SCALE}, defaulting to 0.5`),this.scale=.5),this.width=process.env.WIDTH?parseInt(process.env.WIDTH,10):null,this.height=process.env.HEIGHT?parseInt(process.env.HEIGHT,10):null,this.maxOutputChars=2e3}clipString(e){return e.length>this.maxOutputChars?e.slice(-this.maxOutputChars):e}async _call(e){return this.execute(e)}}t.ComputerToolBase=s},97793:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReadPortFromFile=void 0;const c=r(83153),l=r(11569),d=i(r(79896)),u=i(r(16928)),p=a(r(19055));class f extends c.Tool{constructor(e){super(),this.name="read_port_from_file",this.description="Read the content of a file from the portFromBaseDir in the workspace. Should only be used for reading files that are expected to be text based. Do not use this tool for binary files.",this.schema=l.z.object({filePath:l.z.string().describe("The relative path of the file to read")}),this.portFromBaseDir=e}async _call(e){return this.readFile(e.filePath)}readFile(e){p.default.info(`ReadPortFromFile.readFile called with: ${e}`);const t=u.join(this.portFromBaseDir,e);try{return d.readFileSync(t,"utf-8")}catch(t){return"ENOENT"===t.code?`Error: File not found - ${e}`:`Error reading file: ${t.message}`}}}t.ReadPortFromFile=f},98055:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_OLLAMA_BASE_URL=t.OLLAMA_PROVIDER_ID=void 0,t.discoverOllamaModels=async function(e,r){const o=e||t.DEFAULT_OLLAMA_BASE_URL;try{s.default.debug(`[OllamaModels] Attempting to discover models from: ${o}`);const e=await n.default.get(`${o}/api/tags`,{timeout:3e3,headers:{Accept:"application/json"}});if(!e.data?.models||0===e.data.models.length)return s.default.debug(`[OllamaModels] No models available in Ollama at ${o}`),[];if(s.default.info(`[OllamaModels] Discovered ${e.data.models.length} models from Ollama`),!r)return s.default.error("[OllamaModels] OpenSourceModelRegistryService instance not provided to discoverOllamaModels."),[];const t=[];for(const o of e.data.models){const e=i(o),n=await c(e,r);t.push(n)}return t.sort(((e,t)=>e.isDefaultForProvider&&!t.isDefaultForProvider?-1:!e.isDefaultForProvider&&t.isDefaultForProvider?1:e.name.localeCompare(t.name))),s.default.info(`[OllamaModels] Successfully transformed ${t.length} Ollama models with registry enhancement`),t}catch(e){return"ECONNREFUSED"===e.code||"ENOTFOUND"===e.code?s.default.debug(`[OllamaModels] Ollama server not accessible at ${o}`):"TimeoutError"===e.name?s.default.debug(`[OllamaModels] Ollama server timeout at ${o}`):s.default.warn(`[OllamaModels] Ollama discovery failed: ${e.message}`),[]}},t.getDefaultOllamaModelId=function(){return};const n=o(r(58938)),s=o(r(19055));function i(e){const r=e.name,o=r,n=function(e){const t=e.toLowerCase();return t.includes("vision")||t.includes("llava")||t.includes("minicpm")||t.includes("qwen-vl")||t.includes("moondream")||t.includes("cogvlm")}(r),s=function(e){const t=e.toLowerCase();return t.includes("code")||t.includes("coder")||t.includes("starcoder")||t.includes("deepseek-coder")||t.includes("codellama")}(r),i=function(e){const t=e.toLowerCase();return t.includes("llama")?"llama":t.includes("mistral")?"mistral":t.includes("mixtral")?"mixtral":t.includes("deepseek")?"deepseek":t.includes("qwen")?"qwen":t.includes("phi")?"phi":t.includes("yi")?"yi":t.includes("codellama")?"codellama":t.includes("starcoder")?"starcoder":t.includes("gemma")?"gemma":t.includes("vicuna")?"vicuna":t.includes("orca")?"orca":t.includes("nous")?"nous":"unknown"}(r),c=function(e){const t=e.match(/(\d+(?:\.\d+)?)(b|m)/i);if(t){const[,e,r]=t;return`${e}${r.toUpperCase()}`}return}(r),l=function(e){const t=e.toLowerCase();if(t.includes("128k"))return 131072;if(t.includes("32k"))return 32768;if(t.includes("16k"))return 16384;if(t.includes("8k"))return 8192;if(t.includes("4k"))return 4096;if(t.includes("llama3")||t.includes("llama-3"))return 131072;if(t.includes("qwen2.5")||t.includes("qwen3"))return 131072;if(t.includes("deepseek-v3"))return 131072;return 32768}(r),d=Math.min(l/4,8192);return{modelId:r,providerId:t.OLLAMA_PROVIDER_ID,name:o,contextWindow:l,maxOutputTokens:d,supportsImages:n,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!1,supportsThinkingTokens:!1,supportsSystemMessages:!0,inputCostPerMillionTokens:0,outputCostPerMillionTokens:0,isDefaultForProvider:a(r),metadata:{isLocal:!0,serverUrl:t.DEFAULT_OLLAMA_BASE_URL,modelFamily:i,parameterSize:c,isVision:n,isCode:s,originalModelId:r,modelSize:e.size,modifiedAt:e.modified_at,digest:e.digest,details:e.details}}}function a(e){const t=e.toLowerCase();return t.includes("llama3.1:8b")||t.includes("qwen2.5:7b")||t.includes("deepseek-v3:latest")}async function c(e,t){try{const r=function(e){let t=e.split(":")[0];const r={"llama3.1":"llama-3.1",llama3:"llama-3","qwen2.5":"qwen2.5","qwen2.5-coder":"qwen2.5-coder","deepseek-v3":"deepseek-v3","deepseek-coder":"deepseek-coder"};for(const[e,o]of Object.entries(r))if(t.includes(e)){t=t.replace(e,o);break}return t}(e.modelId),o=await t.searchModels({query:r,fuzzyMatch:!0});if(0===o.length)return s.default.debug(`[OllamaModels] No registry match found for ${e.modelId}`),e;const n=o[0],i=n.model;s.default.debug(`[OllamaModels] Enhanced ${e.modelId} with registry data from ${i.modelId} (score: ${n.score.toFixed(2)})`);const a={...e,contextWindow:i.specifications.contextWindow,maxOutputTokens:i.specifications.maxOutputTokens,supportsImages:i.capabilities.supportsVision||e.supportsImages,supportsToolUse:i.capabilities.supportsToolUse,supportsSystemMessages:i.capabilities.supportsSystemMessages,metadata:{...e.metadata,registryMatch:{modelId:i.modelId,family:i.family,series:i.series,variant:i.variant,matchScore:n.score,matchReason:n.matchReason,isCodeSpecialized:i.capabilities.isCodeSpecialized,isVisionModel:i.capabilities.supportsVision,isMultilingual:i.capabilities.isMultilingual,organization:i.ownership.organization,releaseDate:i.release.releaseDate,huggingFaceUrl:i.metadata.huggingFaceUrl,githubUrl:i.metadata.githubUrl,paperUrl:i.metadata.paperUrl}}};return n.score>.8&&i.displayName.length>0&&(a.name=i.displayName),a}catch(t){return s.default.warn(`[OllamaModels] Failed to enhance ${e.modelId} with registry: ${t.message}`),e}}t.OLLAMA_PROVIDER_ID="ollama",t.DEFAULT_OLLAMA_BASE_URL="http://localhost:11434"},98280:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIProvider=void 0;const i=r(3563),a=r(36206),c=r(78706),l=r(21527),d=s(r(19055));let u=class{constructor(e){this.providerRegistry=e,d.default.info("[OpenAIProvider] Initialized"),this.providerRegistry.registerProvider(this)}getId(){return l.OPENAI_PROVIDER_ID}getName(){return"OpenAI"}getMetadata(){return{website:"https://openai.com",docs_link:"https://platform.openai.com/docs",api_version:"v1"}}requiresApiKey(){return!0}getDefaultBaseUrl(){}getDefaultModelId(){return l.DEFAULT_OPENAI_MODEL_ID}getApiKeyName(){return"OPENAI_API_KEY"}getModelClient(e){const t=new c.OpenAIModelClient(e,{enableVerboseLogging:!1}),r=l.OPENAI_MODELS[e.modelId];return r?t.setModelMetadata(r):d.default.warn(`[OpenAIProvider] Metadata not found for model ${e.modelId}`),t}getProviderMetadata(){return{providerId:l.OPENAI_PROVIDER_ID,name:"OpenAI",description:"OpenAI GPT models for advanced language understanding and generation",website:"https://openai.com",docsLink:"https://platform.openai.com/docs",requiresApiKey:!0,defaultModelId:l.DEFAULT_OPENAI_MODEL_ID,apiKeyName:"OPENAI_API_KEY",features:{supportsStreaming:!0,supportsCaching:!0,supportsTools:!0,supportsImages:!0}}}getStaticModels(){return Object.values(l.OPENAI_MODELS)}async discoverDynamicModels(e,t){return{models:this.getStaticModels(),discoveredAt:new Date,discoveryMethod:"static",source:"static list"}}requiresApiKeyForDiscovery(){return!1}async discoverModels(e,t){return this.getStaticModels()}};t.OpenAIProvider=u,t.OpenAIProvider=u=o([(0,i.Injectable)(),n("design:paramtypes",[a.ProviderRegistry])],u)},99095:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ItemRepository=void 0;const i=r(3563);r(31832);let a=class{constructor(e){this.knex=e}async findAll(e,t){let r=this.knex("items").select("*");if(t&&(r=r.orderBy(t.field,t.order.toLowerCase())),e){const{page:t,limit:o}=e,n=(t-1)*o;r=r.offset(n).limit(o)}return r}async findById(e){return this.knex("items").where("itemId",e).first()}async findBySessionId(e,t,r){let o=this.knex("items").where("sessionId",e);if(r&&(o=o.orderBy(r.field,r.order.toLowerCase())),t){const{page:e,limit:r}=t,n=(e-1)*r;o=o.offset(n).limit(r)}return o}async create(e){await this.knex("items").insert(e)}async update(e,t){await this.knex("items").where("itemId",e).update(t)}async delete(e){await this.knex("items").where("itemId",e).delete()}async countBySessionId(e){const t=await this.knex("items").where("sessionId",e).count("* as count").first();return t?.count}async getSessionStats(e){const t=await this.knex("items").select("sessionId").sum("inputTokens as inputTokens").sum("cacheWriteTokens as cacheWriteTokens").sum("cacheReadTokens as cacheReadTokens").sum("outputTokens as outputTokens").sum("totalTokens as totalTokens").sum("cost as cost").whereIn("sessionId",e).groupBy("sessionId"),r={};return t.forEach((e=>{r[e.sessionId]={inputTokens:e.inputTokens,cacheWriteTokens:e.cacheWriteTokens,cacheReadTokens:e.cacheReadTokens,outputTokens:e.outputTokens,totalTokens:e.totalTokens,cost:e.cost}})),r}async getRequestStats(e){const t=await this.knex("items").select("requestId").sum("inputTokens as inputTokens").sum("cacheWriteTokens as cacheWriteTokens").sum("cacheReadTokens as cacheReadTokens").sum("outputTokens as outputTokens").sum("totalTokens as totalTokens").sum("cost as cost").whereIn("requestId",e).groupBy("requestId"),r={};return t.forEach((e=>{r[e.requestId]={inputTokens:e.inputTokens,cacheWriteTokens:e.cacheWriteTokens,cacheReadTokens:e.cacheReadTokens,outputTokens:e.outputTokens,totalTokens:e.totalTokens,cost:e.cost}})),r}};t.ItemRepository=a,t.ItemRepository=a=o([(0,i.Injectable)(),s(0,(0,i.Inject)("KNEX")),n("design:paramtypes",[Function])],a)},99187:function(e,t,r){"use strict";var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),i=0;i<r.length;i++)"default"!==r[i]&&n(t,e,r[i]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultKnexConfig=function(){y||(y=g());return y};const c=i(r(79896)),l=i(r(16928)),d=i(r(70857)),u=a(r(19055)),p=l.join(d.homedir(),".eve","db","eve.sqlite");function f(){let e=__dirname,t=l.join(e,"migrations");for(u.default.info(`Looking for migrations in: ${t} - will recurse up looking for migrations`);!h(t);)e=l.dirname(e),t=l.join(e,"migrations");if(m(t)||(t=l.join(process.cwd(),"migrations")),m(t)||(t=l.join(process.cwd(),"server","migrations")),!m(t))throw new Error("No migrations directory found in any of the usual locations");return t}function h(e){return c.existsSync(e)&&m(e)}function m(e){return c.readdirSync(e).some((e=>e.endsWith(".js")))}function g(e){let t;void 0===e&&(e=process.env.DB_CHOICE||"local"),u.default.info(`Using database configuration: ${e}`);try{t=function(e=process.env.DB_CHOICE||"local"){let t,r=process.env.DB_CONFIG_PATH||"db-config.json";try{t=c.readFileSync(r,"utf8")}catch(e){r=l.join(process.cwd(),"config","db-config.json");try{t=c.readFileSync(r,"utf8")}catch(e){throw new Error("Unable to find db-config.json")}}u.default.info(`Using db config at: ${r}`);const o=JSON.parse(t);if(!o[e])throw u.default.error(`Invalid DB_CHOICE: ${e} - not found in db-config.json - ${JSON.stringify(o)}`),new Error(`Invalid DB_CHOICE: ${e} - not found in db-config.json`);const n=o[e],s=n.connection;if("object"==typeof s&&"filename"in s&&(s.filename=s.filename.replace("~",d.homedir()),!c.existsSync(s.filename))){const e=l.dirname(r),t=l.resolve(e,s.filename);u.default.info(`Resolved filename: ${t} from config file directory: ${e} using relative path: ${s.filename}`),c.existsSync(t)?s.filename=t:u.default.warn(`DB File does not exist: ${t}`)}const i=n.migrations;if(i&&"string"==typeof i.directory){const e=l.resolve(l.dirname(r),i.directory);m(e)&&(n.migrations.directory=e)}return n.useNullAsDefault=!0,n}(e)}catch(r){if("local"!==e)throw u.default.error("error",r),u.default.error(`Invalid DB_CHOICE: ${e} - no db-config.json found`),new Error(`Invalid DB_CHOICE: ${e} - no db-config.json found`);u.default.info("Did not find db-config.json, using default SQLite configuration"),t={client:"better-sqlite3",connection:{filename:p},useNullAsDefault:!0}}if(u.default.info(`Using db config (after making paths absolute): ${JSON.stringify(t)}`),t.migrations||(u.default.warn("No migrations directory found in db-config.json, using default"),t.migrations={directory:f()}),t.migrations.extension="js","better-sqlite3"===t.client?(u.default.warn("Enforcing single connection pool (min: 1, max: 1) for SQLite client to prevent locking issues."),t.pool={min:1,max:1,acquireTimeoutMillis:9e4},t.pragma&&t.pragma.busy_timeout&&(u.default.warn("Removing busy_timeout pragma as pool size is 1."),delete t.pragma.busy_timeout)):t.pool={min:1,max:10,acquireTimeoutMillis:6e4},t.connection&&"object"==typeof t.connection&&"filename"in t.connection){const e=t.connection.filename,r=l.dirname(e);c.existsSync(r)||(u.default.info(`Creating Database directory: ${r}`),c.mkdirSync(r,{recursive:!0}))}return u.default.info(`Using knex config: ${JSON.stringify(t)}`),t}var y=void 0;t.default=g},99538:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDeepSeekModels=function(){return[{modelId:"deepseek-v3",family:"deepseek",series:"deepseek-v3",variant:"671b",displayName:"DeepSeek-V3",aliases:["deepseek-ai/deepseek-v3","deepseek-v3-base","deepseek-chat","accounts/fireworks/models/deepseek-v3","accounts/fireworks/models/deepseek-chat"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:671,activeParameters:37,contextWindow:131072,maxOutputTokens:8192,isMoE:!0},ownership:{organization:"DeepSeek",license:"Custom DeepSeek License",allowsCommercialUse:!0},release:{releaseDate:"2024-12-26",version:"3.0",announcementUrl:"https://api-docs.deepseek.com/news/news250325"},metadata:{huggingFaceUrl:"https://huggingface.co/deepseek-ai/DeepSeek-V3",githubUrl:"https://github.com/deepseek-ai/DeepSeek-V3",docsUrl:"https://api-docs.deepseek.com/",paperUrl:"https://arxiv.org/pdf/2412.19437",trainingTokens:148e11,dataCutoff:"2024-05"}},{modelId:"deepseek-v3-0324",family:"deepseek",series:"deepseek-v3",variant:"685b",displayName:"DeepSeek-V3-0324",aliases:["deepseek-ai/deepseek-v3-0324","accounts/fireworks/models/deepseek-v3-0324"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:685,activeParameters:37,contextWindow:131072,maxOutputTokens:8192,isMoE:!0},ownership:{organization:"DeepSeek",license:"Custom DeepSeek License",allowsCommercialUse:!0},release:{releaseDate:"2025-03-24",version:"3.0-0324",announcementUrl:"https://api-docs.deepseek.com/news/news250325"},metadata:{huggingFaceUrl:"https://huggingface.co/deepseek-ai/DeepSeek-V3-0324",githubUrl:"https://github.com/deepseek-ai/DeepSeek-V3",docsUrl:"https://api-docs.deepseek.com/",paperUrl:"https://arxiv.org/pdf/2412.19437"}},{modelId:"deepseek-r1",family:"deepseek",series:"deepseek-r1",variant:"671b",displayName:"DeepSeek-R1",aliases:["deepseek-ai/deepseek-r1","deepseek-reasoner","accounts/fireworks/models/deepseek-r1"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:671,activeParameters:37,contextWindow:65536,maxOutputTokens:32768,isMoE:!0},ownership:{organization:"DeepSeek",license:"Custom DeepSeek License",allowsCommercialUse:!0},release:{releaseDate:"2025-05-28",version:"R1",announcementUrl:"https://api-docs.deepseek.com/guides/reasoning_model"},metadata:{huggingFaceUrl:"https://huggingface.co/deepseek-ai/DeepSeek-R1",githubUrl:"https://github.com/deepseek-ai/DeepSeek-R1",docsUrl:"https://api-docs.deepseek.com/",paperUrl:"https://arxiv.org/abs/2501.12948"}},{modelId:"deepseek-r1-0528",family:"deepseek",series:"deepseek-r1",variant:"671b-0528",displayName:"DeepSeek-R1-0528",aliases:["deepseek-ai/deepseek-r1-0528","accounts/fireworks/models/deepseek-r1-0528"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:671,activeParameters:37,contextWindow:65536,maxOutputTokens:32768,isMoE:!0},ownership:{organization:"DeepSeek",license:"Custom DeepSeek License",allowsCommercialUse:!0},release:{releaseDate:"2025-05-28",version:"R1-0528",announcementUrl:"https://api-docs.deepseek.com/guides/reasoning_model"},metadata:{huggingFaceUrl:"https://huggingface.co/deepseek-ai/DeepSeek-R1-0528",githubUrl:"https://github.com/deepseek-ai/DeepSeek-R1",docsUrl:"https://api-docs.deepseek.com/"}},{modelId:"deepseek-v2.5",family:"deepseek",series:"deepseek-v2.5",variant:"236b",displayName:"DeepSeek-V2.5",aliases:["deepseek-ai/deepseek-v2.5","deepseek-coder","accounts/fireworks/models/deepseek-v2.5","accounts/fireworks/models/deepseek-coder"],capabilities:{supportsVision:!1,isCodeSpecialized:!0,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:236,activeParameters:21,contextWindow:131072,maxOutputTokens:8192,isMoE:!0,programmingLanguagesCount:338},ownership:{organization:"DeepSeek",license:"Custom DeepSeek License",allowsCommercialUse:!0},release:{releaseDate:"2024-09-05",version:"2.5",announcementUrl:"https://api-docs.deepseek.com/"},metadata:{huggingFaceUrl:"https://huggingface.co/deepseek-ai/DeepSeek-V2.5",githubUrl:"https://github.com/deepseek-ai/",docsUrl:"https://api-docs.deepseek.com/"}},{modelId:"deepseek-v2",family:"deepseek",series:"deepseek-v2",variant:"236b",displayName:"DeepSeek-V2",aliases:["deepseek-ai/deepseek-v2","deepseek-v2-chat","deepseek-ai/deepseek-v2-chat","accounts/fireworks/models/deepseek-v2","accounts/fireworks/models/deepseek-v2-chat"],capabilities:{supportsVision:!1,isCodeSpecialized:!1,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:236,activeParameters:21,contextWindow:131072,maxOutputTokens:8192,isMoE:!0},ownership:{organization:"DeepSeek",license:"Custom DeepSeek License",allowsCommercialUse:!0},release:{releaseDate:"2024-05-06",version:"2.0",announcementUrl:"https://api-docs.deepseek.com/"},metadata:{huggingFaceUrl:"https://huggingface.co/deepseek-ai/DeepSeek-V2",githubUrl:"https://github.com/deepseek-ai/",docsUrl:"https://api-docs.deepseek.com/"}},{modelId:"deepseek-coder-v2-16b",family:"deepseek",series:"deepseek-coder-v2",variant:"16b",displayName:"DeepSeek-Coder-V2 16B",aliases:["deepseek-ai/deepseek-coder-v2-lite","deepseek-coder-v2-lite","deepseek-ai/deepseek-coder-v2-lite-instruct","deepseek-coder-v2-lite-instruct","accounts/fireworks/models/deepseek-coder-v2-lite-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!0,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:16,activeParameters:2.4,contextWindow:131072,maxOutputTokens:8192,isMoE:!0,programmingLanguagesCount:338},ownership:{organization:"DeepSeek",license:"Custom DeepSeek License",allowsCommercialUse:!0},release:{releaseDate:"2024-06-17",version:"2.0-coder",announcementUrl:"https://github.com/deepseek-ai/DeepSeek-Coder-V2"},metadata:{huggingFaceUrl:"https://huggingface.co/deepseek-ai/DeepSeek-Coder-V2-Lite",githubUrl:"https://github.com/deepseek-ai/DeepSeek-Coder-V2",docsUrl:"https://api-docs.deepseek.com/"}},{modelId:"deepseek-coder-v2-236b",family:"deepseek",series:"deepseek-coder-v2",variant:"236b",displayName:"DeepSeek-Coder-V2 236B",aliases:["deepseek-ai/deepseek-coder-v2","deepseek-coder-v2","deepseek-ai/deepseek-coder-v2-instruct","deepseek-coder-v2-instruct","accounts/fireworks/models/deepseek-coder-v2-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!0,supportsToolUse:!0,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!0},specifications:{totalParameters:236,activeParameters:21,contextWindow:131072,maxOutputTokens:8192,isMoE:!0,programmingLanguagesCount:338},ownership:{organization:"DeepSeek",license:"Custom DeepSeek License",allowsCommercialUse:!0},release:{releaseDate:"2024-06-17",version:"2.0-coder",announcementUrl:"https://github.com/deepseek-ai/DeepSeek-Coder-V2"},metadata:{huggingFaceUrl:"https://huggingface.co/deepseek-ai/DeepSeek-Coder-V2",githubUrl:"https://github.com/deepseek-ai/DeepSeek-Coder-V2",docsUrl:"https://api-docs.deepseek.com/"}},{modelId:"deepseek-coder-6.7b",family:"deepseek",series:"deepseek-coder",variant:"6.7b",displayName:"DeepSeek-Coder 6.7B",aliases:["deepseek-ai/deepseek-coder-6.7b","deepseek-coder-6.7b-instruct","deepseek-ai/deepseek-coder-6.7b-instruct","accounts/fireworks/models/deepseek-coder-6.7b-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!0,supportsToolUse:!1,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!1},specifications:{totalParameters:6.7,contextWindow:16384,maxOutputTokens:4096,isMoE:!1,programmingLanguagesCount:86},ownership:{organization:"DeepSeek",license:"Custom DeepSeek License",allowsCommercialUse:!0},release:{releaseDate:"2023-11-08",version:"1.0-coder",announcementUrl:"https://github.com/deepseek-ai/DeepSeek-Coder"},metadata:{huggingFaceUrl:"https://huggingface.co/deepseek-ai/deepseek-coder-6.7b",githubUrl:"https://github.com/deepseek-ai/DeepSeek-Coder",docsUrl:"https://api-docs.deepseek.com/"}},{modelId:"deepseek-coder-33b",family:"deepseek",series:"deepseek-coder",variant:"33b",displayName:"DeepSeek-Coder 33B",aliases:["deepseek-ai/deepseek-coder-33b","deepseek-coder-33b-instruct","deepseek-ai/deepseek-coder-33b-instruct","accounts/fireworks/models/deepseek-coder-33b-instruct"],capabilities:{supportsVision:!1,isCodeSpecialized:!0,supportsToolUse:!1,supportsSystemMessages:!0,isMultilingual:!0,supportsLongContext:!1},specifications:{totalParameters:33,contextWindow:16384,maxOutputTokens:4096,isMoE:!1,programmingLanguagesCount:86},ownership:{organization:"DeepSeek",license:"Custom DeepSeek License",allowsCommercialUse:!0},release:{releaseDate:"2023-11-08",version:"1.0-coder",announcementUrl:"https://github.com/deepseek-ai/DeepSeek-Coder"},metadata:{huggingFaceUrl:"https://huggingface.co/deepseek-ai/deepseek-coder-33b",githubUrl:"https://github.com/deepseek-ai/DeepSeek-Coder",docsUrl:"https://api-docs.deepseek.com/"}}]}},99547:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.retry=i,t.retryApiOperation=a,t.retryWithContextTruncation=async function(e,t,r={}){try{return await a(e,r)}catch(e){if((0,n.toEveAgentError)(e)instanceof n.ContextWindowError){return(r.logger||s.logger).warn("[RetryUtil] Context window exceeded. Truncating conversation history and retrying."),await t()}throw e}};const n=r(9581),s={maxRetries:3,initialDelayMs:1e3,maxDelayMs:3e4,backoffFactor:2,jitter:!0,isRetriable:e=>(0,n.toEveAgentError)(e).retriable,onRetry:()=>{},logger:o(r(19055)).default};async function i(e,t={}){const r={...s,...t};let o,i=0;for(;i<=r.maxRetries;)try{return await e()}catch(e){if(o=e,i++,i>r.maxRetries||!r.isRetriable(e))throw e;let t=r.initialDelayMs*Math.pow(r.backoffFactor,i-1);if(r.jitter){const e=.8+.4*Math.random();t=Math.floor(t*e)}t=Math.min(t,r.maxDelayMs);const s=(0,n.toEveAgentError)(e);s instanceof n.RateLimitError&&s.context?.retryAfterSeconds&&(t=Math.max(t,1e3*s.context.retryAfterSeconds)),r.logger.warn(`[RetryUtil] Retrying operation after error (attempt ${i}/${r.maxRetries}, delay: ${t}ms): ${s.message}`),r.onRetry(e,i,t),await new Promise((e=>setTimeout(e,t)))}throw o}async function a(e,t={}){return i(e,{...t,isRetriable:e=>{const r=(0,n.toEveAgentError)(e);return!(r instanceof n.ContextWindowError)&&(r instanceof n.ApiError?r.retriable:t.isRetriable?t.isRetriable(e):s.isRetriable(e))}})}},99605:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebSearchTool=void 0;const i=r(3563),a=r(9970),c=s(r(19055)),l=r(96297),d=r(20436),u=r(9581),p=r(8984);let f=class extends d.BaseTool{constructor(e,t,r){super(r),this.workingDir=e,this.name="web_search",this.description="Search the web for real-time information about any topic. Use this tool when you need up-to-date information that might not be available in your training data, or when you need to verify current facts. When formulating your search query, include 50-100 words of context to make the search more targeted and effective.",this.parameterSchema={query:{type:"string",required:!0,validate:e=>e&&""!==e.trim()},maxResults:{type:"number",required:!1,default:10,validate:e=>void 0!==e&&e>0&&e<=50},allowedDomains:{type:"array",required:!1,validate:e=>Array.isArray(e)},blockedDomains:{type:"array",required:!1,validate:e=>Array.isArray(e)}},this.getUserApiKey=t}validateParams(e){try{const t=(0,p.convertToolParams)(e,this.parameterSchema);return Object.assign(e,t),!0}catch(e){return c.default.warn(`[${this.name}] Parameter validation failed: ${e.message}`),!1}}getBaseUsageInstructions(e){return'## web_search\nDescription: Search the web for real-time information about any topic. Use this tool when you need up-to-date information that might not be available in your training data, or when you need to verify current facts. When formulating your search query, include 50-100 words of context to make the search more targeted and effective.\nParameters:\n- query: (required) The search query with sufficient context (it\'s okay to include lots of details)\n- maxResults: (optional) Maximum number of search results to return (default: 5)\n- allowedDomains: (optional) Array of domain strings. Format as JSON array: ["domain1.com", "domain2.org"]\n- blockedDomains: (optional) Array of domain strings. Format as JSON array: ["unwanted.com", "spam.net"]\n\nUsage Examples:\n<web_search>\n<query>OpenAI API pricing 2024 2025 GPT-4o GPT-4 Turbo o1 mini pricing per token input output costs official pricing page</query>\n<maxResults>3</maxResults>\n<allowedDomains>["openai.com", "platform.openai.com"]</allowedDomains>\n</web_search>\n\n<web_search>\n<query>JavaScript best practices modern development 2024</query>\n<blockedDomains>["w3schools.com", "tutorialspoint.com"]</blockedDomains>\n</web_search>\n\n<web_search>\n<query>Latest news artificial intelligence developments</query>\n<maxResults>5</maxResults>\n<allowedDomains>["techcrunch.com", "arstechnica.com", "theverge.com"]</allowedDomains>\n</web_search>\n\nIMPORTANT: Arrays must be formatted as valid JSON with double quotes around strings. Single quotes will cause validation errors.'}getModeSpecificGuidance(e){return null}async execute(e){let t=null;try{if(t=await this.getUserApiKey("anthropic"),!t)return c.default.warn(`[${this.name}] Anthropic API key not available. Web search cannot be performed.`),{error:"Web search is not available. Anthropic API key is not configured for your account.",instructions:"Please go to Settings > Model Configuration > Anthropic and set your API key to enable web search."}}catch(e){return c.default.error(`[${this.name}] Error fetching Anthropic API key: ${e.message}`),{error:"Web search is not available. Unable to retrieve Anthropic API key.",instructions:"Please go to Settings > Model Configuration > Anthropic and set your API key to enable web search."}}const r=new a.Anthropic({apiKey:t}),{query:o,allowedDomains:n,blockedDomains:s}=e,i=void 0!==e.maxResults?e.maxResults:5;try{c.default.info(`[${this.name}] Performing web search for query: "${o}"`);const e={type:"web_search_20250305",name:"web_search",max_uses:i};n&&n.length>0&&(e.allowed_domains=n),s&&s.length>0&&(e.blocked_domains=s);const t="claude-3-7-sonnet-20250219",a=await r.messages.create({model:t,max_tokens:2048,messages:[{role:"user",content:o}],tools:[e]});c.default.info(`[${this.name}] Web search API call successful.`),l.debugLogger.dumpObject("Anthropic Web Search API Response",a);let d="",u=!1;for(const e of a.content){"text"===e.type?d+=e.text+"\n\n":"tool_use"===e.type&&"web_search"===e.name&&c.default.warn(`[${this.name}] Received 'tool_use' block for web_search, which was not expected. Raw input: ${JSON.stringify(e.input)}`),"text"===e.type&&e.text.includes("Ok, I will search the web for that.");const t=e;if("web_search_tool_result"===t.type&&Array.isArray(t.content)){u=!0,d+="Search Results:\n";for(const e of t.content)"web_search_result"===e.type&&(d+=`- Title: ${e.title}\n`,d+=`  URL: ${e.url}\n`,d+=`  Source: ${e.source?.name||"Unknown"}\n`,e.text_content&&(d+=`  Snippet: ${e.text_content.substring(0,200)}...\n`),d+="\n")}}return u||""!==d.trim()||(c.default.warn(`[${this.name}] No 'web_search_tool_result' content blocks found in response, or text content is empty. Query: "${o}"`),d=a.content.some((e=>"text"===e.type&&""!==e.text.trim()))?a.content.filter((e=>"text"===e.type)).map((e=>e.text)).join("\n\n"):"No specific search results were returned by the web search tool for this query."),d.trim()}catch(e){throw c.default.error(`[${this.name}] Error during web search for query "${o}": ${e.message}`,e.stack),new u.ToolExecutionError(`Anthropic API error during web search: ${e.message}`,this.name,"API_ERROR",{originalError:e})}}};t.WebSearchTool=f,t.WebSearchTool=f=o([(0,i.Injectable)(),n("design:paramtypes",[String,Function,Object])],f)},99664:e=>{"use strict";e.exports=require("@langchain/google-genai")},99989:function(e,t,r){"use strict";var o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MutationsController=void 0;const i=r(3563),a=r(77602);let c=class{constructor(e){this.mutationsService=e}async getMutationsForSession(e){return this.mutationsService.getMutationsForSession(e)}async getMutation(e){return this.mutationsService.getMutation(e)}};t.MutationsController=c,o([(0,i.Get)("session/:sessionId"),s(0,(0,i.Param)("sessionId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"getMutationsForSession",null),o([(0,i.Get)(":id"),s(0,(0,i.Param)("id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"getMutation",null),t.MutationsController=c=o([(0,i.Controller)("mutations"),n("design:paramtypes",[a.MutationsService])],c)}},__webpack_module_cache__={},leafPrototypes,getProto;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(r.exports,r,r.exports,__webpack_require__),r.loaded=!0,r.exports}__webpack_require__.c=__webpack_module_cache__,getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var r=Object.create(null);__webpack_require__.r(r);var o={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var n=2&t&&e;"object"==typeof n&&!~leafPrototypes.indexOf(n);n=getProto(n))Object.getOwnPropertyNames(n).forEach((t=>o[t]=()=>e[t]));return o.default=()=>e,__webpack_require__.d(r,o),r},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var __webpack_exports__=__webpack_require__(__webpack_require__.s=77201)})();