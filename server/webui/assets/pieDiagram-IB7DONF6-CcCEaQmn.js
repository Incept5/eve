import{p as U}from"./chunk-4BMEZGHF-yPGTZcse.js";import{aa as y,a2 as z,aF as j,C as H,n as Z,o as q,s as J,g as K,c as Q,b as X,_ as p,l as F,t as Y,d as tt,D as et,H as at,O as rt,k as nt}from"./index-CwzAko7O.js";import{p as it}from"./radar-MK3ICKWK-imOQUFIk.js";import{d as P}from"./arc-CQQjXXCj.js";import{o as st}from"./ordinal-Cboi1Yqb.js";import"./_baseUniq-CAsGxxhN.js";import"./_basePickBy-N3dAaZRc.js";import"./clone-DBTsW2hb.js";import"./init-Gi6I4Gst.js";function ot(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function lt(t){return t}function ct(){var t=lt,e=ot,a=null,n=y(0),i=y(z),r=y(0);function s(s){var o,l,p,c,d,u=(s=j(s)).length,f=0,g=new Array(u),h=new Array(u),m=+n.apply(this,arguments),y=Math.min(z,Math.max(-z,i.apply(this,arguments)-m)),x=Math.min(Math.abs(y)/u,r.apply(this,arguments)),w=x*(y<0?-1:1);for(o=0;o<u;++o)(d=h[g[o]=o]=+t(s[o],o,s))>0&&(f+=d);for(null!=e?g.sort((function(t,a){return e(h[t],h[a])})):null!=a&&g.sort((function(t,e){return a(s[t],s[e])})),o=0,p=f?(y-u*w)/f:0;o<u;++o,m=c)l=g[o],c=m+((d=h[l])>0?d*p:0)+w,h[l]={data:s[l],index:o,value:d,startAngle:m,endAngle:c,padAngle:x};return h}return s.value=function(e){return arguments.length?(t="function"==typeof e?e:y(+e),s):t},s.sortValues=function(t){return arguments.length?(e=t,a=null,s):e},s.sort=function(t){return arguments.length?(a=t,e=null,s):a},s.startAngle=function(t){return arguments.length?(n="function"==typeof t?t:y(+t),s):n},s.endAngle=function(t){return arguments.length?(i="function"==typeof t?t:y(+t),s):i},s.padAngle=function(t){return arguments.length?(r="function"==typeof t?t:y(+t),s):r},s}var R=H.pie,G={sections:new Map,showData:!1,config:R},b=G.sections,O=G.showData,ut=structuredClone(R),pt=p((()=>structuredClone(ut)),"getConfig"),gt=p((()=>{b=new Map,O=G.showData,Y()}),"clear"),dt=p((({label:t,value:e})=>{b.has(t)||(b.set(t,e),F.debug(`added new section: ${t}, with value: ${e}`))}),"addSection"),ft=p((()=>b),"getSections"),mt=p((t=>{O=t}),"setShowData"),ht=p((()=>O),"getShowData"),I={getConfig:pt,clear:gt,setDiagramTitle:Z,getDiagramTitle:q,setAccTitle:J,getAccTitle:K,setAccDescription:Q,getAccDescription:X,addSection:dt,getSections:ft,setShowData:mt,getShowData:ht},vt=p(((t,e)=>{U(t,e),e.setShowData(t.showData),t.sections.map(e.addSection)}),"populateDb"),St={parse:p((async t=>{const e=await it("pie",t);F.debug(e),vt(e,I)}),"parse")},yt=p((t=>`\n  .pieCircle{\n    stroke: ${t.pieStrokeColor};\n    stroke-width : ${t.pieStrokeWidth};\n    opacity : ${t.pieOpacity};\n  }\n  .pieOuterCircle{\n    stroke: ${t.pieOuterStrokeColor};\n    stroke-width: ${t.pieOuterStrokeWidth};\n    fill: none;\n  }\n  .pieTitleText {\n    text-anchor: middle;\n    font-size: ${t.pieTitleTextSize};\n    fill: ${t.pieTitleTextColor};\n    font-family: ${t.fontFamily};\n  }\n  .slice {\n    font-family: ${t.fontFamily};\n    fill: ${t.pieSectionTextColor};\n    font-size:${t.pieSectionTextSize};\n    // fill: white;\n  }\n  .legend text {\n    fill: ${t.pieLegendTextColor};\n    font-family: ${t.fontFamily};\n    font-size: ${t.pieLegendTextSize};\n  }\n`),"getStyles"),xt=yt,At=p((t=>{const e=[...t.entries()].map((t=>({label:t[0],value:t[1]}))).sort(((t,e)=>e.value-t.value));return ct().value((t=>t.value))(e)}),"createPieArcs"),wt=p(((t,e,a,n)=>{F.debug("rendering pie chart\n"+t);const i=n.db,r=tt(),s=et(i.getConfig(),r.pie),o=18,l=450,p=l,c=at(e),d=c.append("g");d.attr("transform","translate(225,225)");const{themeVariables:u}=r;let[f]=rt(u.pieOuterStrokeWidth);f??(f=2);const g=s.textPosition,h=Math.min(p,l)/2-40,m=P().innerRadius(0).outerRadius(h),y=P().innerRadius(h*g).outerRadius(h*g);d.append("circle").attr("cx",0).attr("cy",0).attr("r",h+f/2).attr("class","pieOuterCircle");const x=i.getSections(),w=At(x),S=[u.pie1,u.pie2,u.pie3,u.pie4,u.pie5,u.pie6,u.pie7,u.pie8,u.pie9,u.pie10,u.pie11,u.pie12],C=st(S);d.selectAll("mySlices").data(w).enter().append("path").attr("d",m).attr("fill",(t=>C(t.data.label))).attr("class","pieCircle");let b=0;x.forEach((t=>{b+=t})),d.selectAll("mySlices").data(w).enter().append("text").text((t=>(t.data.value/b*100).toFixed(0)+"%")).attr("transform",(t=>"translate("+y.centroid(t)+")")).style("text-anchor","middle").attr("class","slice"),d.append("text").text(i.getDiagramTitle()).attr("x",0).attr("y",-200).attr("class","pieTitleText");const A=d.selectAll(".legend").data(C.domain()).enter().append("g").attr("class","legend").attr("transform",((t,e)=>"translate(216,"+(22*e-22*C.domain().length/2)+")"));A.append("rect").attr("width",o).attr("height",o).style("fill",C).style("stroke",C),A.data(w).append("text").attr("x",22).attr("y",14).text((t=>{const{label:e,value:a}=t.data;return i.getShowData()?`${e} [${a}]`:e}));const T=512+Math.max(...A.selectAll("text").nodes().map((t=>(null==t?void 0:t.getBoundingClientRect().width)??0)));c.attr("viewBox",`0 0 ${T} 450`),nt(c,l,T,s.useMaxWidth)}),"draw"),Ct={draw:wt},Gt={parser:St,db:I,renderer:Ct,styles:xt};export{Gt as diagram};