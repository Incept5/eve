(()=>{var __webpack_modules__={42:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DocxToHtml=void 0;const u=r(5534),f=r(3563),p=r(7205),h=a(r(9896)),g=a(r(6928)),m=a(r(857)),y=d(r(9055)),v=r(3229);let _=class extends u.Tool{constructor(e){super(),this.storedFileService=e,this.name="docx_to_html",this.description="Converts a DOCX file to HTML. Takes a stored file ID as input and returns the generated HTML content directly."}async _call(e){try{const t=await this.storedFileService.getFile(e);if(!t)throw new Error(`File with ID ${e} not found`);y.default.info("Converting DOCX to HTML");const r=await(0,v.convertDocxToHtml)(t.fileContents,{wrapperElement:"html",removeImages:!0}),n=m.tmpdir(),o=g.join(n,`docx-${Date.now()}.html`);return h.writeFileSync(o,r,"utf8"),y.default.info(`HTML content written to temp file: ${o}`),r}catch(e){throw new Error(`Failed to convert DOCX to HTML: ${e.message}`)}}};t.DocxToHtml=_,t.DocxToHtml=_=s([(0,f.Injectable)(),l(0,(0,f.Inject)(p.StoredFileService)),c("design:paramtypes",[p.StoredFileService])],_)},59:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GlhfProvider=void 0;const o=r(8483),i=r(8959),s=r(2368),a=n(r(8938)),c=r(6228);class l extends o.BaseProvider{getName(){return"glhf"}getBaseChatModel(e,t){return new c.ChatOpenAI({modelName:this.shortModelName(e),temperature:t.temperature,openAIApiKey:s.ConfigService.getInstance().getProperty("GLHF_API_KEY"),configuration:{baseURL:l.BASE_URL}})}async getModelDescriptors(){return(await this.fetchModels()).map((e=>new i.ModelDescriptor("glhf",e.id,0,0,0,0)))}isValid(){return!!s.ConfigService.getInstance().getProperty("GLHF_API_KEY")}async fetchModels(){if(l.modelsCache&&Date.now()-l.modelsCache.timestamp<l.CACHE_TTL)return l.modelsCache.models;const e=s.ConfigService.getInstance().getProperty("GLHF_API_KEY");if(!e)return console.log("GLHF API key not found"),[];try{const t=await a.default.get(`${l.BASE_URL}/models`,{headers:{Authorization:`Bearer ${e}`}});if(200===t.status){const e=t.data.data;return l.modelsCache={models:e,timestamp:Date.now()},e}}catch(e){console.error("Error fetching GLHF models:",e)}return[]}supportsOnDemandModels(){return!0}}t.GlhfProvider=l,l.QWEN_2_5_CODER_32B_INSTRUCT="glhf/hf:Qwen/Qwen2.5-Coder-32B-Instruct",l.QWEN_2_5_72B_INSTRUCT="glhf/hf:Qwen/Qwen2.5-72B-Instruct",l.META_LLAMA_3_1_405B_INSTRUCT="glhf/hf:meta-llama/Meta-Llama-3.1-405B-Instruct",l.META_LLAMA_3_1_8B_INSTRUCT="glhf/hf:meta-llama/Meta-Llama-3.1-8B-Instruct",l.META_LLAMA_3_3_70B_INSTRUCT="glhf/hf:meta-llama/Llama-3.3-70B-Instruct",l.modelsCache=null,l.CACHE_TTL=3e5,l.BASE_URL="https://glhf.chat/api/openai/v1"},62:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ListFilesTool=void 0;const u=r(3563),f=c(r(1943)),p=d(r(9055)),h=c(r(6928)),g=r(2141),m=r(4155),y=r(9581);let v=o=class{constructor(e,t,r){this.fileSystemService=e,this.responseFormatter=t,this.name="list_files",this.description="Request to list files and directories within the specified directory.",this.workingDir=r}getUsageInstructions(e){return`## list_files\nDescription: Request to list files and directories within the specified directory. If recursive is true, it will list all files and directories recursively. If recursive is false or not provided, it will only list the top-level contents. Do not use this tool to confirm the existence of files you may have created, as the user will let you know if the files were created successfully or not.\nParameters:\n- path: (required) The path of the directory to list contents for (relative to the current working directory ${e.workingDir})\n- recursive: (optional) Whether to list files recursively. Use true for recursive listing, false or omit for top-level only.\nUsage:\n<list_files>\n<path>Directory path here</path>\n<recursive>true or false (optional)</recursive>\n</list_files>`}validateParams(e){return"string"==typeof e.path}async execute(e){const{path:t,recursive:r=!1}=e;p.default.info(`[${o.name}] Listing files in directory: ${t}, recursive: ${r}, relative to ${this.workingDir}`);const n=h.resolve(this.workingDir,t);if(!n.startsWith(this.workingDir)){const e=`Path traversal attempt detected: ${t} resolves outside of workspace ${this.workingDir}`;throw p.default.error(`[${o.name}] ${e}`),new y.FileSystemError(e,"PATH_TRAVERSAL_ERROR")}try{if(!(await f.stat(n)).isDirectory()){const e=`Path is not a directory: ${t}`;throw p.default.error(`[${o.name}] ${e}`),new y.FileNotFoundError(e,t)}const e=await this.fileSystemService.getIgnoredFilesCached(n);let i,s=!1;const a=1e3;return r?(i=await this.listFilesRecursively(n,""),i.length>a&&(i=i.slice(0,a),s=!0)):(i=await this.listFilesInDirectory(n,""),i.length>a&&(i=i.slice(0,a),s=!0)),this.responseFormatter.formatFilesList(n,i,s,e)}catch(e){if("ENOENT"===e.code){const e=`Directory not found: ${t}`;throw p.default.error(`[${o.name}] ${e}`),new y.FileNotFoundError(e,t)}const r=`Error listing files in directory ${t}: ${e.message}`;throw p.default.error(`[${o.name}] ${r}\n${e.stack}`),new y.FileSystemError(r,e.code||"FS_LIST_ERROR")}}async listFilesInDirectory(e,t){return(await f.readdir(e,{withFileTypes:!0})).map((e=>{const r=h.join(t,e.name);return e.isDirectory()?`${r}/`:r}))}async listFilesRecursively(e,t){let r;try{r=await f.readdir(e,{withFileTypes:!0})}catch(t){return p.default.warn(`[${o.name}] Error reading subdirectory ${e}: ${t.message}`),[]}const n=[];for(const o of r){const r=h.join(t,o.name),i=h.join(e,o.name);if(o.isDirectory()){n.push(`${r}/`);const e=await this.listFilesRecursively(i,r);n.push(...e)}else o.isFile()&&n.push(r)}return n}};t.ListFilesTool=v,t.ListFilesTool=v=o=a([(0,u.Injectable)(),l("design:paramtypes",[g.FileSystemService,m.ResponseFormatterService,String])],v)},136:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.truncateConversationHistory=function(e,t={}){const r={...o,...t};if(e.length<=r.minMessagesToKeep)return[...e];let n=Math.floor(e.length*(r.percentToRemove/100));"aggressive"===r.strategy&&(n=Math.floor(1.5*n));if(n=Math.min(n,e.length-r.minMessagesToKeep),n<=0)return[...e];switch(r.logger.warn(`[ContextTruncation] Truncating conversation history using '${r.strategy}' strategy. Removing ${n} of ${e.length} messages (${r.percentToRemove}%).`),r.strategy){case"preserve_recent":case"aggressive":default:return i(e,n);case"preserve_first_last":return function(e,t){const r=2,n=e.length-t-r;if(n<=0)return[...e];return[...e.slice(0,r),...e.slice(e.length-n)]}(e,n);case"preserve_tools":return function(e,t){const r=e=>e.segments.some((e=>"other"===e.type&&e.metadata?.providerSpecificType?.includes("tool"))),n=[],o=[];for(const t of e)r(t)?n.push(t):o.push(t);if(o.length<=t){const e=t-o.length;return e>0?n.slice(e):n}const i=o.slice(t),s=n.map(((t,r)=>({msg:t,originalIndex:e.indexOf(t)}))),a=i.map(((t,r)=>({msg:t,originalIndex:e.indexOf(t)}))),c=[...s,...a];return c.sort(((e,t)=>e.originalIndex-t.originalIndex)),c.map((e=>e.msg))}(e,n)}},t.getTruncationRange=function(e,t={}){const r={...o,...t};if(e.length<=r.minMessagesToKeep)return null;let n=Math.floor(e.length*(r.percentToRemove/100));"aggressive"===r.strategy&&(n=Math.floor(1.5*n));if(n=Math.min(n,e.length-r.minMessagesToKeep),n<=0)return null;switch(r.strategy){case"preserve_recent":case"aggressive":default:return[0,n-1];case"preserve_first_last":const e=2;return[e,e+n-1];case"preserve_tools":return null}},t.getNextTruncationStrategy=function(e="preserve_recent"){switch(e){case"preserve_recent":return{strategy:"preserve_tools",percentToRemove:40};case"preserve_tools":return{strategy:"preserve_first_last",percentToRemove:50};case"preserve_first_last":return{strategy:"aggressive",percentToRemove:60};case"aggressive":return{strategy:"aggressive",percentToRemove:75};default:return{strategy:"preserve_recent",percentToRemove:25}}};const o={strategy:"preserve_recent",percentToRemove:25,minMessagesToKeep:4,logger:n(r(9055)).default};function i(e,t){return e.slice(t)}},146:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AnthropicProvider=void 0;const s=r(3563),a=r(6206),c=i(r(9055)),l=r(160),d=r(305);let u=class{constructor(e){this.providerRegistry=e,c.default.info("[AnthropicProvider] Initialized"),this.providerRegistry.registerProvider(this)}getId(){return d.ANTHROPIC_PROVIDER_ID}getName(){return"Anthropic"}getMetadata(){return{website:"https://www.anthropic.com",docs_link:"https://docs.anthropic.com"}}requiresApiKey(){return!0}getDefaultBaseUrl(){return this.config?.anthropicBaseUrl||void 0}getDefaultModelId(){return d.DEFAULT_ANTHROPIC_MODEL_ID}getApiKeyName(){return"ANTHROPIC_API_KEY"}setConfig(e){this.config=e}getModelClient(e){const t={...e,baseUrl:this.config?.anthropicBaseUrl||e.baseUrl},r=new l.AnthropicModelClient(t);return this.discoverModels(e.apiKey,t.baseUrl).then((t=>{const n=t.find((t=>t.modelId===e.modelId));n?r.setModelMetadata(n):c.default.warn(`[AnthropicProvider] Metadata not found for model ${e.modelId} during client creation.`)})).catch((t=>{c.default.warn(`[AnthropicProvider] Failed to discover models for client ${e.modelId}: ${t.message}`)})),r}async discoverModels(e,t){return(0,d.discoverAnthropicModels)(e,t)}};t.AnthropicProvider=u,t.AnthropicProvider=u=n([(0,s.Injectable)(),o("design:paramtypes",[a.ProviderRegistry])],u)},156:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n(class\n  name: (constant) @name.definition.class) @definition.class\n\n(method\n  name: (identifier) @name.definition.method) @definition.method\n\n(singleton_method\n  name: (identifier) @name.definition.method) @definition.method\n\n(module\n  name: (constant) @name.definition.module) @definition.module\n"},160:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AnthropicModelClient=void 0;const o=r(9970),i=r(3118),s=r(2123),a=n(r(9055));t.AnthropicModelClient=class{constructor(e){a.default.debug(`[AnthropicModelClient] Initializing with model: ${e.modelId}`),this.anthropic=new o.Anthropic({apiKey:e.apiKey}),this.modelId=e.modelId,this.transformer=new i.AnthropicMessageTransformer;const t=(0,s.createStateManager)(),r=(0,s.createPatternUtils)();this.streamProcessor=(0,s.createStreamProcessor)(t,r)}getModelId(){return this.modelId}getModelMetadata(){return this.modelMetadata?this.modelMetadata:{modelId:this.modelId,providerId:"anthropic",name:this.modelId,contextWindow:1e5,maxOutputTokens:4e3,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!0,supportsThinkingTokens:!0,supportsCancellation:!0,inputCostPerMillionTokens:8,outputCostPerMillionTokens:24}}setModelMetadata(e){a.default.debug(`[AnthropicModelClient] Setting model metadata for ${e.modelId}`),this.modelMetadata=e}supportsCancellation(){return!0}async*generateResponse(e,t,r,n){a.default.info(`[AnthropicModelClient] Generating response for task ${r} with model ${this.modelId}`);try{const o=this.transformer.toProviderFormat(t),i=await this.anthropic.messages.create({model:this.modelId,system:e,messages:o,max_tokens:4e3,stream:!0},{signal:n}),s=this.streamProcessor.processStream(i,r,n);yield*async function*(e,t=10){const r={};let n=null;for await(const o of e){if("blockUpdate"!==o.type||!("appendContent"in o)||void 0===o.appendContent){n&&r[n]&&(a.default.debug(`[AnthropicModelClient] Flushing buffered content for block ${n}: "${r[n]}"`),yield{type:"blockUpdate",blockId:n,appendContent:r[n]},r[n]=""),yield o;continue}const{blockId:e,appendContent:i}=o;if(n&&n!==e&&r[n]&&(a.default.debug(`[AnthropicModelClient] Flushing buffered content for previous block ${n}: "${r[n]}"`),yield{type:"blockUpdate",blockId:n,appendContent:r[n]},r[n]=""),r[e]||(r[e]=""),i.length<t)a.default.debug(`[AnthropicModelClient] Buffering small content for block ${e}: "${i}"`),r[e]+=i,r[e].length>=t&&(a.default.debug(`[AnthropicModelClient] Buffer size threshold reached, flushing for block ${e}: "${r[e]}"`),yield{type:"blockUpdate",blockId:e,appendContent:r[e]},r[e]="");else if(r[e]){const t=r[e]+i;a.default.debug(`[AnthropicModelClient] Combining buffered content with new content for block ${e}: "${t}"`),yield{type:"blockUpdate",blockId:e,appendContent:t},r[e]=""}else yield o;n=e}for(const[e,t]of Object.entries(r))t&&(a.default.debug(`[AnthropicModelClient] Final flush of buffered content for block ${e}: "${t}"`),yield{type:"blockUpdate",blockId:e,appendContent:t})}(s,10)}catch(e){throw a.default.error(`[AnthropicModelClient] Error generating response: ${e.message}`,e.stack),e}}}},209:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(7886),t),o(r(305),t),o(r(3118),t),o(r(160),t),o(r(146),t)},242:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n(function_item\n  name: (identifier) @name.definition.function) @definition.function\n\n(struct_item\n  name: (type_identifier) @name.definition.struct) @definition.struct\n\n(enum_item\n  name: (type_identifier) @name.definition.enum) @definition.enum\n\n(trait_item\n  name: (type_identifier) @name.definition.trait) @definition.trait\n\n(impl_item\n  trait: (type_identifier) @name.definition.impl) @definition.impl\n"},251:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Epic=void 0;const n=r(9100),o=r(7655);t.Epic=class{constructor(e,t,r,o=[],i=(0,n.ulid)(),s=new Date,a=new Date){this.id=i,this.title=e,this.description=t,this.workspaceName=r,this.stories=o,this.createdAt=s,this.updatedAt=a}addStory(e){this.stories.push(e),this.updatedAt=new Date}removeStory(e){this.stories=this.stories.filter((t=>t.id!==e)),this.updatedAt=new Date}getStatus(){return 0===this.stories.length?o.StoryStatus.BACKLOG:this.stories.every((e=>e.status===o.StoryStatus.DONE))?o.StoryStatus.DONE:this.stories.some((e=>e.status===o.StoryStatus.IN_PROGRESS))?o.StoryStatus.IN_PROGRESS:o.StoryStatus.BACKLOG}}},260:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRulesPrompt=function(e){return`RULES\n\n- Your current working directory is: ${e.workingDir}\n- You cannot \`cd\` into a different directory to complete a task. You are stuck operating from '${e.workingDir}', so be sure to pass in the correct 'path' parameter when using tools that require a path.\n- Do not use the ~ character or $HOME to refer to the home directory.\n- Before using the execute_command tool, you must first think about the SYSTEM INFORMATION context provided to understand the user's environment and tailor your commands to ensure they are compatible with their system. You must also consider if the command you need to run should be executed in a specific directory outside of the current working directory '${e.workingDir}', and if so prepend with \`cd\`'ing into that directory && then executing the command (as one command since you are stuck operating from '${e.workingDir}'). For example, if you needed to run \`npm install\` in a project outside of '${e.workingDir}', you would need to prepend with a \`cd\` i.e. pseudocode for this would be \`cd (path to project) && (command, in this case npm install)\`.\n- When using the search_files tool, craft your regex patterns carefully to balance specificity and flexibility. Based on the user's task you may use it to find code patterns, TODO comments, function definitions, or any text-based information across the project. The results include context, so analyze the surrounding code to better understand the matches. Leverage the search_files tool in combination with other tools for more comprehensive analysis. For example, use it to find specific code patterns, then use read_file to examine the full context of interesting matches before using replace_in_file to make informed changes.\n- When creating a new project (such as an app, website, or any software project), organize all new files within a dedicated project directory unless the user specifies otherwise. Use appropriate file paths when creating files, as the write_to_file tool will automatically create any necessary directories. Structure the project logically, adhering to best practices for the specific type of project being created. Unless otherwise specified, new projects should be easily run without additional setup, for example most projects can be built in HTML, CSS, and JavaScript - which you can open in a browser.\n- Be sure to consider the type of project (e.g. Python, JavaScript, web application) when determining the appropriate structure and files to include. Also consider what files may be most relevant to accomplishing the task, for example looking at a project's manifest file would help you understand the project's dependencies, which you could incorporate into any code you write.\n- When making changes to code, always consider the context in which the code is being used. Ensure that your changes are compatible with the existing codebase and that they follow the project's coding standards and best practices.\n- When you want to modify a file, use the replace_in_file or write_to_file tool directly with the desired changes. You do not need to display the changes before using the tool.\n- Do not ask for more information than necessary. Use the tools provided to accomplish the user's request efficiently and effectively. When you've completed your task, you must use the attempt_completion tool to present the result to the user. The user may provide feedback, which you can use to make improvements and try again.\n- You are only allowed to ask the user questions using the ask_followup_question tool. Use this tool only when you need additional details to complete a task, and be sure to use a clear and concise question that will help you move forward with the task. However if you can use the available tools to avoid having to ask the user questions, you should do so. For example, if the user mentions a file that may be in an outside directory like the Desktop, you should use the list_files tool to list the files in the Desktop and check if the file they are talking about is there, rather than asking the user to provide the file path themselves.\n- When executing commands, if you don't see the expected output, assume the terminal executed the command successfully and proceed with the task. The user's terminal may be unable to stream the output back properly. If you absolutely need to see the actual terminal output, use the ask_followup_question tool to request the user to copy and paste it back to you.\n- The user may provide a file's contents directly in their message, in which case you shouldn't use the read_file tool to get the file contents again since you already have it.\n- Your goal is to try to accomplish the user's task, NOT engage in a back and forth conversation.\n- NEVER end attempt_completion result with a question or request to engage in further conversation! Formulate the end of your result in a way that is final and does not require further input from the user.\n- You are STRICTLY FORBIDDEN from starting your messages with "Great", "Certainly", "Okay", "Sure". You should NOT be conversational in your responses, but rather direct and to the point. For example you should NOT say "Great, I've updated the CSS" but instead something like "I've updated the CSS". It is important you be clear and technical in your messages.\n- When presented with images, utilize your vision capabilities to thoroughly examine them and extract meaningful information. Incorporate these insights into your thought process as you accomplish the user's task.\n- At the end of each user message, you will automatically receive environment_details. This information is not written by the user themselves, but is auto-generated to provide potentially relevant context about the project structure and environment. While this information can be valuable for understanding the project context, do not treat it as a direct part of the user's request or response. Use it to inform your actions and decisions, but don't assume the user is explicitly asking about or referring to this information unless they clearly do so in their message. When using environment_details, explain your actions clearly to ensure the user understands, as they may not be aware of these details.\n- Before executing commands, check the "Actively Running Terminals" section in environment_details. If present, consider how these active processes might impact your task. For example, if a local development server is already running, you wouldn't need to start it again. If no active terminals are listed, proceed with command execution as normal.\n- When using the replace_in_file tool, you must include complete lines in your SEARCH blocks, not partial lines. The system requires exact line matches and cannot match partial lines. For example, if you want to match a line containing "const x = 5;", your SEARCH block must include the entire line, not just "x = 5" or other fragments.\n- When using the replace_in_file tool, if you use multiple SEARCH/REPLACE blocks, list them in the order they appear in the file. For example if you need to make changes to both line 10 and line 50, first include the SEARCH/REPLACE block for line 10, followed by the SEARCH/REPLACE block for line 50.\n- It is critical you wait for the user's response after each tool use, in order to confirm the success of the tool use. For example, if asked to make a todo app, you would create a file, wait for the user's response it was created successfully, then create another file if needed, wait for the user's response it was created successfully, etc.`}},269:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.DbDebugContextService=void 0;const o=r(3563),i=r(290),s=r(9100),a=r(6297);let c=class{constructor(){this.storage=new i.AsyncLocalStorage,this.activeContexts=new Map}async runWithContext(e,t){const r={...e,operationId:(0,s.ulid)(),startTime:Date.now()};return this.activeContexts.set(r.operationId,r),a.debugLogger.log(`[DbDebugContext] Starting operation: ${r.operationName} (ID: ${r.operationId}, Task: ${r.taskId||"N/A"})`),this.storage.run(r,(async()=>{try{return await t()}finally{this.activeContexts.delete(r.operationId);const e=Date.now()-r.startTime;a.debugLogger.log(`[DbDebugContext] Finished operation: ${r.operationName} (ID: ${r.operationId}, Duration: ${e}ms)`)}}))}getContext(){return this.storage.getStore()}getActiveContexts(){return Array.from(this.activeContexts.values())}};t.DbDebugContextService=c,t.DbDebugContextService=c=n([(0,o.Injectable)()],c)},290:e=>{"use strict";e.exports=require("async_hooks")},305:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_THINKING_TOKENS=t.DEFAULT_THINKING_TOKENS=t.DEFAULT_ANTHROPIC_MODEL_ID=t.ANTHROPIC_PROVIDER_ID=void 0,t.discoverAnthropicModels=async function(e,r){return o.default.info("[AnthropicProvider] Using hardcoded model list"),[{modelId:"claude-3-7-sonnet-20250219",providerId:t.ANTHROPIC_PROVIDER_ID,name:"Claude 3.7 Sonnet",contextWindow:2e5,maxOutputTokens:8192,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!0,supportsPromptCache:!0,supportsThinkingTokens:!0,supportsCancellation:!0,recommendedThinkingTokens:t.DEFAULT_THINKING_TOKENS,maxThinkingTokens:t.MAX_THINKING_TOKENS,inputCostPerMillionTokens:3,outputCostPerMillionTokens:15,cacheWritesPrice:3.75,cacheReadsPrice:.3,isDefaultForProvider:!0,metadata:{description:"Claude 3.7 Sonnet is an advanced large language model with improved reasoning, coding, and problem-solving capabilities."}},{modelId:"claude-3-5-sonnet-20241022",providerId:t.ANTHROPIC_PROVIDER_ID,name:"Claude 3.5 Sonnet",contextWindow:2e5,maxOutputTokens:8192,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!0,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsCancellation:!0,inputCostPerMillionTokens:3,outputCostPerMillionTokens:15,cacheWritesPrice:3.75,cacheReadsPrice:.3,metadata:{description:"Claude 3.5 Sonnet offers strong performance for a wide range of tasks."}},{modelId:"claude-3-5-haiku-20241022",providerId:t.ANTHROPIC_PROVIDER_ID,name:"Claude 3.5 Haiku",contextWindow:2e5,maxOutputTokens:8192,supportsImages:!1,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsCancellation:!0,inputCostPerMillionTokens:.8,outputCostPerMillionTokens:4,cacheWritesPrice:1,cacheReadsPrice:.08,metadata:{description:"Claude 3.5 Haiku is a faster, more affordable model for simpler tasks."}},{modelId:"claude-3-opus-20240229",providerId:t.ANTHROPIC_PROVIDER_ID,name:"Claude 3 Opus",contextWindow:2e5,maxOutputTokens:4096,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,supportsCancellation:!0,inputCostPerMillionTokens:15,outputCostPerMillionTokens:75,cacheWritesPrice:18.75,cacheReadsPrice:1.5,metadata:{description:"Claude 3 Opus is Anthropic's most powerful model, with state-of-the-art performance."}}]};const o=n(r(9055));t.ANTHROPIC_PROVIDER_ID="anthropic",t.DEFAULT_ANTHROPIC_MODEL_ID="claude-3-7-sonnet-20250219",t.DEFAULT_THINKING_TOKENS=1024,t.MAX_THINKING_TOKENS=1e4},308:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FindFiles=void 0;const c=r(5534),l=r(1569),d=s(r(6928)),u=s(r(9896)),f=a(r(9055));class p extends c.Tool{static async main(e,t,r,n,o){f.default.info(`Starting find files search in workspace: ${e}`),f.default.info(`Parameters - startPath: ${t}, searchTerm: ${r}, fileExtensions: ${n}, max: ${o}`);const i=new p(e),s=await i._call({startPath:t,searchTerm:r,fileExtensions:n,max:o});return f.default.info("Find files search completed"),s}constructor(e){super(),this.name="find_files",this.description="Find all file paths in the repository that contain a given search term (case insensitive) in their names",this.schema=l.z.object({startPath:l.z.string().describe("The relative path under repo root to start search from (use '.' for entire repo)"),searchTerm:l.z.string().describe("Search term (case insensitive) or regex to match in the file names"),fileExtensions:l.z.string().optional().describe("Optional regex for file extensions to limit search to (e.g. '\\.(ts|js|java)$')"),max:l.z.number().optional().describe("Maximum number of files to return (optional, defaults to 50)")}),this.MAX_RESULTS=50,this.workspaceRootDir=e}async _call(e){try{const{startPath:t,searchTerm:r,fileExtensions:n,max:o}=e,i=d.resolve(this.workspaceRootDir,t),s=o||this.MAX_RESULTS,a=new RegExp(r,"i"),c=n?new RegExp(n):null,l=[];let p=!1;const h=e=>{if(l.length>=s)return void(p=!0);const t=u.readdirSync(e,{withFileTypes:!0});for(const r of t){if(l.length>=s){p=!0;break}const t=d.join(e,r.name);r.isDirectory()?h(t):r.isFile()&&a.test(r.name)&&(c&&!c.test(r.name)||l.push(d.relative(this.workspaceRootDir,t)))}};h(i);const g={matchingFiles:l};if(p){const e=`Stopped searching after finding ${s} files. There may be more matching files.`;f.default.info(e),g.warning=e}return f.default.info(`Found ${l.length} matching files`),JSON.stringify(g,null,2)}catch(e){throw f.default.error(`Error in find files search: ${e.message}`),new Error(`Error performing find files search: ${e.message}`)}}}t.FindFiles=p},353:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReportingController=void 0;const s=r(3563),a=r(7510);let c=class{constructor(e){this.reportingService=e}async getReport(e,t,r,n){return this.reportingService.generateReport(e,t,r,n)}};t.ReportingController=c,n([(0,s.Get)("report"),i(0,(0,s.Query)("from")),i(1,(0,s.Query)("to")),i(2,(0,s.Query)("period")),i(3,(0,s.Query)("workspaceName")),o("design:type",Function),o("design:paramtypes",[String,String,String,String]),o("design:returntype",Promise)],c.prototype,"getReport",null),t.ReportingController=c=n([(0,s.Controller)("reporting"),o("design:paramtypes",[a.ReportingService])],c)},361:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolsModule=void 0;const o=r(3563),i=r(6158),s=r(4778),a=r(3177),c=r(5873),l=r(3880),d=r(7852),u=r(9161),f=r(6552),p=r(8624),h=r(1680),g=r(7967);let m=class{};t.ToolsModule=m,t.ToolsModule=m=n([(0,o.Module)({imports:[a.MutationsModule,c.WorkspaceModule,l.SessionModule,d.SourceArtefactModule,u.ChatCompletionModule,f.DatasetModule,p.StoredFileModule,h.DocstoreModule,g.ConfigModule],providers:[i.ToolFactoryService,s.McpToolFactoryService],exports:[i.ToolFactoryService]})],m)},376:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.DataSourceModule=void 0;const o=r(3563),i=r(2776);let s=class{};t.DataSourceModule=s,t.DataSourceModule=s=n([(0,o.Module)({providers:[{provide:i.AppDataSource,useFactory:i.getAppDataSource},{provide:"KNEX",useFactory:e=>e.knex,inject:[i.AppDataSource]}],exports:[i.AppDataSource,"KNEX"]})],s)},460:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n(class_declaration\n  name: (identifier) @name.definition.class) @definition.class\n\n(method_declaration\n  name: (identifier) @name.definition.method) @definition.method\n\n(interface_declaration\n  name: (identifier) @name.definition.interface) @definition.interface\n"},461:e=>{"use strict";e.exports=require("@nestjs/event-emitter")},499:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(7188),t),o(r(3192),t)},508:e=>{"use strict";e.exports=require("tree-sitter")},526:e=>{"use strict";e.exports=require("ignore")},538:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HomeService=void 0;const u=r(3563),f=r(9668),p=d(r(9055)),h=r(2368),g=d(r(8938)),m=a(r(857));class y{constructor(e){const{requestContent:t,responseContent:r,startedAt:n,endedAt:o,...i}=e;this.requestData=i}toJSON(){return this.requestData}}let v=class{constructor(e,t){this.configService=e,this.userService=t,this.accessCheck={lastResultCode:null,timeOfLastCheck:null,failedToConnect:!1},this.userData=null,this.workerQueue=[],this.workerInterval=null,this.isShuttingDown=!1}onModuleInit(){this.startWorkerThread()}async onApplicationShutdown(e){p.default.info("Application shutdown initiated"+(e?` (signal: ${e})`:"")),this.isShuttingDown=!0,this.workerInterval&&clearInterval(this.workerInterval),this.workerQueue.length>0&&(p.default.info(`Processing ${this.workerQueue.length} remaining requests before shutdown`),await this.processRemainingRequests()),p.default.info("Shutdown process completed")}isValidUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}async checkAccess(){const e=this.configService.getProperty("EVE_API_KEY");if(!e)throw new Error("API Key is not configured");if(!this.isValidUUID(e))throw new Error("Invalid API Key");const t=m.hostname();try{const r=await g.default.post("https://otiiwxlfsrejhbrxdras.supabase.co/functions/v1/log-access",{hostname:t},{headers:{Authorization:`Bearer ${e}`},timeout:3e3});if(r.data&&r.data.userId&&r.data.email){const{userId:e,email:t}=r.data;this.userData={userId:e,email:t},p.default.info(`Access granted for user: ${t} (ID: ${e})`)}else p.default.warn("Log access response did not contain expected user data.");this.accessCheck={lastResultCode:r.status,timeOfLastCheck:new Date,failedToConnect:!1}}catch(e){if(g.default.isAxiosError(e)){const t=e;t.response?this.accessCheck={lastResultCode:t.response.status,timeOfLastCheck:new Date,failedToConnect:!1}:(t.request,this.accessCheck={lastResultCode:null,timeOfLastCheck:new Date,failedToConnect:!0})}else this.accessCheck={lastResultCode:null,timeOfLastCheck:new Date,failedToConnect:!0};p.default.error("Failed to check access",e)}return this.accessCheck}async isAccessOkay(){const e=new Date(Date.now()-864e5);return(!this.accessCheck.timeOfLastCheck||this.accessCheck.timeOfLastCheck<e||403===this.accessCheck.lastResultCode)&&await this.checkAccess(),200===this.accessCheck.lastResultCode||this.accessCheck.failedToConnect}async getUserData(){try{return await this.userService.getCurrentUser()}catch(e){if(e instanceof f.AuthenticationError?p.default.error(`[HomeService] Authentication error: ${e.message}`):p.default.error(`[HomeService] Error getting user data: ${e.message}`),this.userData)return this.userData;if(!this.userData)try{await this.checkAccess()}catch(e){p.default.error(`[HomeService] Error checking access: ${e.message}`)}if(!this.userData)throw e;return this.userData}}async logRequest(e){await this.isAccessOkay()&&!this.accessCheck.failedToConnect&&this.workerQueue.push(new y(e))}startWorkerThread(){this.workerInterval=setInterval((async()=>{if(this.workerQueue.length>0&&!this.isShuttingDown){const e=[...this.workerQueue];this.workerQueue=[],await this.sendRequestsToHomeServer(e)}}),1e4)}async processRemainingRequests(){if(this.workerQueue.length>0){const e=[...this.workerQueue];this.workerQueue=[],await this.sendRequestsToHomeServer(e)}}async sendRequestsToHomeServer(e){const t=this.configService.getProperty("EVE_API_KEY");if(!t)return void p.default.warn("API Key is not configured");const r=e.map((e=>g.default.post("https://otiiwxlfsrejhbrxdras.supabase.co/functions/v1/log-request",e,{headers:{Authorization:`Bearer ${t}`},timeout:5e3})));(await Promise.allSettled(r)).forEach(((e,t)=>{"rejected"===e.status&&p.default.warn(`Failed to log request at index ${t}`,e.reason)}))}};t.HomeService=v,t.HomeService=v=s([(0,u.Injectable)(),l(1,(0,u.Inject)((0,u.forwardRef)((()=>f.UserService)))),c("design:paramtypes",[h.ConfigService,f.UserService])],v)},573:e=>{"use strict";e.exports=require("rxjs")},639:e=>{"use strict";e.exports=require("@google/generative-ai")},646:e=>{"use strict";e.exports=require("@langchain/anthropic")},652:e=>{"use strict";e.exports=require("tree-sitter-c")},662:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RulesController=void 0;const a=r(3563),c=r(6170),l=r(9668),d=r(1145),u=s(r(9055)),f=r(8474);let p=class{constructor(e,t,r){this.rulesService=e,this.userService=t,this.workspaceService=r}async getRules(e,t){if(!e)throw new a.BadRequestException("Source is required");u.default.debug(`[RulesController] Getting rules for source: ${e}, workspace: ${t||"none"}`);const r=await this.userService.getCurrentUser();u.default.debug(`[RulesController] Current user: ${r.email} (ID: ${r.userId})`);let n=t;if(e===d.RuleSource.REPO&&t){const e=await this.workspaceService.findOne(t);if(!e)throw new a.NotFoundException(`Workspace ${t} not found`);n=e.repoBaseDir,u.default.debug(`[RulesController] Resolved workspace path: ${n}`)}const o=await this.rulesService.getRulesBySource(e,r.userId,n,t);return u.default.debug(`[RulesController] Found ${o.length} rules for source: ${e}`),o}async getRule(e,t){if(!t)throw new a.BadRequestException("Source is required");try{const r=decodeURIComponent(e);return u.default.debug(`[RulesController] Getting rule content for ID: ${r}, source: ${t}`),this.rulesService.getRuleContent(r,t)}catch(e){throw u.default.error(`[RulesController] Error getting rule content: ${e.message}\n${e.stack}`),e}}async updateRule(e,t){if(!t.source)throw new a.BadRequestException("Source is required");try{const r=decodeURIComponent(e);return u.default.debug(`[RulesController] Updating rule content for ID: ${r}, source: ${t.source}`),this.rulesService.updateRuleContent(r,t.source,t.content)}catch(e){throw u.default.error(`[RulesController] Error updating rule content: ${e.message}\n${e.stack}`),e}}async toggleRule(e,t){try{const r=decodeURIComponent(e);u.default.debug(`[RulesController] Toggling rule status for ID: ${r}, enabled: ${t.enabled}`);const n=await this.userService.getCurrentUser();u.default.debug(`[RulesController] User ID for toggle: ${n.userId}`);const o=await this.rulesService.toggleRuleStatus(r,n.userId,t.enabled);return u.default.debug("[RulesController] Toggle result:",o),o}catch(e){throw u.default.error(`[RulesController] Error toggling rule status: ${e.message}\n${e.stack}`),e}}async createRule(e){if(!e.source)throw new a.BadRequestException("Source is required");let t=e.workspaceId;if(e.source===d.RuleSource.REPO&&e.workspaceId){const r=await this.workspaceService.findOne(e.workspaceId);if(!r)throw new a.NotFoundException(`Workspace ${e.workspaceId} not found`);t=r.repoBaseDir,u.default.debug(`[RulesController] Creating rule in workspace: ${e.workspaceId}`),u.default.debug(`[RulesController] Resolved workspace path: ${t}`)}return this.rulesService.createRule(e.source,e.name,e.content,t,e.workspaceId)}async deleteRule(e,t){if(!t)throw new a.BadRequestException("Source is required");try{const r=decodeURIComponent(e);return u.default.debug(`[RulesController] Deleting rule with ID: ${r}, source: ${t}`),this.rulesService.deleteRule(r,t)}catch(e){throw u.default.error(`[RulesController] Error deleting rule: ${e.message}\n${e.stack}`),e}}};t.RulesController=p,n([(0,a.Get)(),i(0,(0,a.Query)("source")),i(1,(0,a.Query)("workspace")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],p.prototype,"getRules",null),n([(0,a.Get)(":id"),i(0,(0,a.Param)("id")),i(1,(0,a.Query)("source")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],p.prototype,"getRule",null),n([(0,a.Put)(":id"),i(0,(0,a.Param)("id")),i(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],p.prototype,"updateRule",null),n([(0,a.Put)(":id/toggle"),i(0,(0,a.Param)("id")),i(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],p.prototype,"toggleRule",null),n([(0,a.Post)(),i(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],p.prototype,"createRule",null),n([(0,a.Delete)(":id"),i(0,(0,a.Param)("id")),i(1,(0,a.Query)("source")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],p.prototype,"deleteRule",null),t.RulesController=p=n([(0,a.Controller)("rules"),o("design:paramtypes",[c.RulesService,l.UserService,f.WorkspaceService])],p)},672:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MutationRepository=void 0;const a=r(3563),c=(r(1832),r(3903)),l=s(r(9055));let d=class{constructor(e){this.knex=e}async findAll(e,t){let r=this.knex("mutations").select("*");if(t&&(r=r.orderBy(t.field,t.order.toLowerCase())),e){const{page:t,limit:n}=e,o=(t-1)*n;r=r.offset(o).limit(n)}return r}async findById(e){return this.knex("mutations").where("id",e).first()}async findBySessionId(e,t,r){let n=this.knex("mutations").where("sessionId",e);if(r&&(n=n.orderBy(r.field,r.order.toLowerCase())),t){const{page:e,limit:r}=t,o=(e-1)*r;n=n.offset(o).limit(r)}return n}async findBySessionIds(e){return this.knex("mutations").whereIn("sessionId",e)}async findByRequestId(e){return this.knex("mutations").where("requestId",e)}async create(e){const t=(0,c.v4)(),r=(new Date).toISOString();try{return await this.knex("mutations").insert({id:t,...e,updatedAt:r}),t}catch(n){throw l.default.error("Failed to create mutation:",{error:n.message,stack:n.stack,mutation:{id:t,...e,updatedAt:r}}),n}}async update(e,t){await this.knex("mutations").where("id",e).update(t)}async delete(e){await this.knex("mutations").where("id",e).delete()}};t.MutationRepository=d,t.MutationRepository=d=n([(0,a.Injectable)(),i(0,(0,a.Inject)("KNEX")),o("design:paramtypes",[Function])],d)},712:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EveAgentOutgoingGateway=void 0;const a=r(6134),c=r(4437),l=r(3563),d=r(461),u=s(r(9055)),f=r(6297),p=r(4810),h=r(1280),g=r(5324);let m=n=class{constructor(e,t){this.webSocketService=e,this.eventEmitter=t}afterInit(e){this.webSocketService.setServer(e),u.default.info(`[${n.name}] Gateway initialized and server set in WebSocketService`)}async handleToolExecutionCompleted(e){switch(u.default.info(`[${n.name}] Received ${h.InternalEvents.TOOL_EXECUTION_COMPLETED} event for task ${e.taskId}, tool ${e.toolName}, status: ${e.status}`),e.status){case"success":u.default.info(`[${n.name}] Tool ${e.toolName} executed successfully for task ${e.taskId}`);break;case"error":u.default.info(`[${n.name}] Tool ${e.toolName} execution failed for task ${e.taskId}`);const t={clientId:e.clientId,taskId:e.taskId,error:e.result?.error||"Unknown tool execution error",type:"tool_error",code:e.result?.code,context:{toolName:e.toolName,blockId:e.blockId}};f.debugLogger.log(`Sending ${h.NotificationEvents.AGENT_ERROR} event to room ${e.taskId}`),f.debugLogger.dumpObject("AgentError payload",t),u.default.info(`[${n.name}] Sending agentError to room ${e.taskId}`),this.webSocketService.emitToRoom(e.taskId,h.NotificationEvents.AGENT_ERROR,t);break;case"rejected":u.default.info(`[${n.name}] Tool ${e.toolName} rejected for task ${e.taskId}`)}}handleTaskStatusUpdated(e){u.default.info(`[${n.name}] Received ${h.InternalEvents.TASK_UPDATED} event for task ${e.taskId}`),u.default.info(`[${n.name}] Task status: ${e.status}, Mode: ${e.mode||"N/A"}`),f.debugLogger.log(`Sending ${h.NotificationEvents.TASK_STATUS_UPDATED} event to room ${e.taskId}`),f.debugLogger.dumpObject("TaskStatusUpdated payload",e),u.default.info(`[${n.name}] Sending taskStatusUpdated to room ${e.taskId}`),this.webSocketService.emitToRoom(e.taskId,h.NotificationEvents.TASK_STATUS_UPDATED,e)}handleContextTruncated(e){u.default.info(`[${n.name}] Received ${h.NotificationEvents.CONTEXT_TRUNCATED} event for task ${e.taskId}`),u.default.info(`[${n.name}] Removed ${e.removedCount} messages: ${e.message}`),f.debugLogger.log(`Sending ${h.NotificationEvents.CONTEXT_TRUNCATED} event to room ${e.taskId}`),f.debugLogger.dumpObject("ContextTruncated payload",e),u.default.info(`[${n.name}] Sending contextTruncated to room ${e.taskId}`),this.webSocketService.emitToRoom(e.taskId,h.NotificationEvents.CONTEXT_TRUNCATED,e)}handleTaskCreated(e){u.default.info(`[${n.name}] Received ${h.InternalEvents.TASK_CREATED} event for task ${e.taskId}`),f.debugLogger.log(`Sending ${h.NotificationEvents.TASK_CREATED} event to client ${e.clientId} for task ${e.taskId}`),f.debugLogger.dumpObject("TaskCreated payload",e),u.default.info(`[${n.name}] Sending taskCreated to client ${e.clientId} for task ${e.taskId}`),this.webSocketService.emitToClient(e.clientId,h.NotificationEvents.TASK_CREATED,e)}handleBlockCreated(e){u.default.debug(`[${n.name}] Received ${g.InternalBlockEvents.BLOCK_CREATED} event for block ${e.blockId} in task ${e.taskId}`);const t={type:"block",taskId:e.taskId,blockId:e.blockId,role:e.role,blockType:e.blockType,tagName:e.tagName,status:e.status,content:e.content,description:e.description,metadata:e.metadata?JSON.parse(e.metadata):void 0,errorText:e.errorText};f.debugLogger.log(`Sending ${h.NotificationEvents.BLOCK_EVENT} (created) to room ${e.taskId}`),f.debugLogger.dumpObject("BlockEvent payload (created)",t),this.webSocketService.emitToRoom(e.taskId,h.NotificationEvents.BLOCK_EVENT,t)}handleBlockUpdated(e){u.default.debug(`[${n.name}] Received ${g.InternalBlockEvents.BLOCK_UPDATED} event for block ${e.blockId} in task ${e.taskId}`);const t={type:"blockUpdate",taskId:e.taskId,blockId:e.blockId};void 0!==e.appendContent&&(t.appendContent=e.appendContent),void 0!==e.status&&(t.newStatus=e.status),void 0!==e.blockType&&(t.newBlockType=e.blockType),void 0!==e.tagName&&(t.newTagName=e.tagName),void 0!==e.output&&(t.output=e.output),void 0!==e.errorText&&(t.errorText=e.errorText),void 0!==e.content&&void 0===e.appendContent&&(t.newContent=e.content),void 0!==e.description&&(t.description=e.description),void 0!==e.metadata&&(t.metadata="string"==typeof e.metadata?JSON.parse(e.metadata):e.metadata);t.newStatus&&t.newStatus;f.debugLogger.log(`Sending ${h.NotificationEvents.BLOCK_EVENT} (updated) to room ${e.taskId}`),f.debugLogger.dumpObject("BlockEvent payload (updated)",t),this.webSocketService.emitToRoom(e.taskId,h.NotificationEvents.BLOCK_EVENT,t)}handleUsageTracked(e){f.debugLogger.log(`[${n.name}] Received ${g.InternalBlockEvents.USAGE_TRACKED} event for task ${e.taskId}`);const t={type:"usage",taskId:e.taskId,inputTokens:e.inputTokens,outputTokens:e.outputTokens,cacheWriteTokens:e.cacheWriteTokens,cacheReadTokens:e.cacheReadTokens,totalCost:e.totalCost};f.debugLogger.log(`Sending ${h.NotificationEvents.BLOCK_EVENT} (usage) to room ${e.taskId}`),f.debugLogger.dumpObject("BlockEvent payload (usage)",t),this.webSocketService.emitToRoom(e.taskId,h.NotificationEvents.BLOCK_EVENT,t)}handleAgentErrorNotification(e){u.default.info(`[${n.name}] Received ${h.InternalEvents.AGENT_ERROR_NOTIFICATION} for task ${e.taskId}: ${e.error}`),f.debugLogger.log(`Sending ${h.NotificationEvents.AGENT_ERROR} event to room ${e.taskId}`),f.debugLogger.dumpObject("AgentError payload (notification)",e),this.webSocketService.emitToRoom(e.taskId,h.NotificationEvents.AGENT_ERROR,e)}};t.EveAgentOutgoingGateway=m,o([(0,a.WebSocketServer)(),i("design:type",c.Server)],m.prototype,"server",void 0),o([(0,d.OnEvent)(h.InternalEvents.TOOL_EXECUTION_COMPLETED),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Promise)],m.prototype,"handleToolExecutionCompleted",null),o([(0,d.OnEvent)(h.InternalEvents.TASK_UPDATED),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",void 0)],m.prototype,"handleTaskStatusUpdated",null),o([(0,d.OnEvent)(h.NotificationEvents.CONTEXT_TRUNCATED),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",void 0)],m.prototype,"handleContextTruncated",null),o([(0,d.OnEvent)(h.InternalEvents.TASK_CREATED),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",void 0)],m.prototype,"handleTaskCreated",null),o([(0,d.OnEvent)(g.InternalBlockEvents.BLOCK_CREATED),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",void 0)],m.prototype,"handleBlockCreated",null),o([(0,d.OnEvent)(g.InternalBlockEvents.BLOCK_UPDATED),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",void 0)],m.prototype,"handleBlockUpdated",null),o([(0,d.OnEvent)(g.InternalBlockEvents.USAGE_TRACKED),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",void 0)],m.prototype,"handleUsageTracked",null),o([(0,d.OnEvent)(h.InternalEvents.AGENT_ERROR_NOTIFICATION),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",void 0)],m.prototype,"handleAgentErrorNotification",null),t.EveAgentOutgoingGateway=m=n=o([(0,a.WebSocketGateway)({namespace:"eve-agent",cors:{origin:"*"}}),(0,l.Injectable)(),i("design:paramtypes",[p.WebSocketService,d.EventEmitter2])],m)},715:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AppModule=void 0;const s=r(3563),a=r(2810),c=r(6928),l=r(6808),d=r(5873),u=r(3880),f=r(2177),p=r(9449),h=r(3177),g=r(3049),m=r(376),y=r(7967),v=r(1901),_=r(361),w=r(8221),b=r(7852),k=r(9161),S=r(4193),R=r(756),T=r(6552),$=r(8624),O=r(8377),P=r(1367),E=r(2776),I=i(r(9055));let C=class{constructor(e){this.appDataSource=e}async onModuleDestroy(){I.default.info("AppModule onModuleDestroy called.."),await this.appDataSource.close()}};t.AppModule=C,t.AppModule=C=n([(0,s.Module)({imports:[a.ServeStaticModule.forRoot({rootPath:(0,c.join)(__dirname,"..","..","vitify-webui","dist"),exclude:["/api*"]}),m.DataSourceModule,l.HelloWorldModule,d.WorkspaceModule,u.SessionModule,f.AgentsModule,p.LangchainModule,h.MutationsModule,g.AudioTranscriptionModule,y.ConfigModule,v.GitModule,_.ToolsModule,w.ReportingModule,b.SourceArtefactModule,k.ChatCompletionModule,S.HomeModule,R.PluginModule,T.DatasetModule,$.StoredFileModule,O.EpicsModule,P.EveAgentModule],providers:[{provide:E.AppDataSource,useFactory:E.getAppDataSource}]}),o("design:paramtypes",[E.AppDataSource])],C)},724:e=>{"use strict";e.exports=require("@langchain/core/output_parsers")},756:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.PluginModule=void 0;const o=r(3563),i=r(7307),s=r(2177),a=r(361),c=r(2424);let l=class{};t.PluginModule=l,t.PluginModule=l=n([(0,o.Module)({imports:[s.AgentsModule,a.ToolsModule,c.GraphAgentModule],providers:[i.PluginLoaderService],exports:[i.PluginLoaderService]})],l)},758:e=>{"use strict";e.exports=require("puppeteer")},779:e=>{"use strict";e.exports=require("@langchain/community/document_loaders/fs/csv")},811:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RequestRepository=void 0;const s=r(3563);r(1832);let a=class{constructor(e){this.knex=e}async findAll(e,t){let r=this.knex("requests").select("*");if(t&&(r=r.orderBy(t.field,t.order.toLowerCase())),e){const{page:t,limit:n}=e,o=(t-1)*n;r=r.offset(o).limit(n)}return r}async findById(e){return this.knex("requests").where("requestId",e).first()}async findBySessionId(e,t,r){let n=this.knex("requests").where("sessionId",e);if(r&&(n=n.orderBy(r.field,r.order.toLowerCase())),t){const{page:e,limit:r}=t,o=(e-1)*r;n=n.offset(o).limit(r)}return n}async create(e){await this.knex("requests").insert(e)}async update(e,t){await this.knex("requests").where("requestId",e).update(t)}async delete(e){await this.knex("requests").where("requestId",e).delete()}async countBySessionId(e){const t=await this.knex("requests").where("sessionId",e).count("* as count").first();return t?.count}async updateRequest(e,t){await this.knex("requests").where("requestId",e).update(t)}async updateGitStats(e,t){await this.knex("requests").where("requestId",e).update(t)}async getSessionGitStats(e){return(await this.knex("requests").select("sessionId").sum("filesChanged as filesChanged").sum("insertions as insertions").sum("deletions as deletions").sum("testFilesChanged as testFilesChanged").sum("testInsertions as testInsertions").sum("testDeletions as testDeletions").sum("linesChanged as linesChanged").sum("testLinesChanged as testLinesChanged").whereIn("sessionId",e).groupBy("sessionId")).reduce(((e,t)=>(e[t.sessionId]={filesChanged:t.filesChanged,insertions:t.insertions,deletions:t.deletions,testFilesChanged:t.testFilesChanged,testInsertions:t.testInsertions,testDeletions:t.testDeletions,linesChanged:t.linesChanged,testLinesChanged:t.testLinesChanged},e)),{})}};t.RequestRepository=a,t.RequestRepository=a=n([(0,s.Injectable)(),i(0,(0,s.Inject)("KNEX")),o("design:paramtypes",[Function])],a)},818:e=>{"use strict";e.exports=require("dotenv")},857:e=>{"use strict";e.exports=require("os")},873:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TreeSitterService=void 0;const u=r(3563),f=d(r(508)),p=d(r(9055)),h=r(9123),g=d(r(7660)),m=d(r(6844)),y=d(r(3433)),v=d(r(5915)),_=d(r(3297)),w=d(r(2083)),b=d(r(6540)),k=d(r(652)),S=d(r(8678)),R=d(r(9445)),T=c(r(6928)),$=r(5390);let O=o=class{constructor(){this.parsers={},p.default.info(`[${o.name}] TreeSitterService initialized`)}async onModuleInit(){await this.initializeParsers()}async initializeParsers(){try{const e=new f.default;e.setLanguage(g.default),this.parsers.js={parser:e,query:new f.default.Query(g.default,$.javascriptQuery)},this.parsers.jsx=this.parsers.js;const t=new f.default;t.setLanguage(m.default.typescript),this.parsers.ts={parser:t,query:new f.default.Query(m.default.typescript,$.typescriptQuery)};const r=new f.default;r.setLanguage(m.default.tsx),this.parsers.tsx={parser:r,query:new f.default.Query(m.default.tsx,$.typescriptQuery)};const n=new f.default;n.setLanguage(y.default),this.parsers.py={parser:n,query:new f.default.Query(y.default,$.pythonQuery)};const i=new f.default;i.setLanguage(v.default),this.parsers.java={parser:i,query:new f.default.Query(v.default,$.javaQuery)};const s=new f.default;s.setLanguage(_.default),this.parsers.rs={parser:s,query:new f.default.Query(_.default,$.rustQuery)};const a=new f.default;a.setLanguage(w.default),this.parsers.rb={parser:a,query:new f.default.Query(w.default,$.rubyQuery)};const c=new f.default;c.setLanguage(b.default),this.parsers.cpp={parser:c,query:new f.default.Query(b.default,$.cppQuery)},this.parsers.hpp=this.parsers.cpp;const l=new f.default;l.setLanguage(k.default),this.parsers.c={parser:l,query:new f.default.Query(k.default,$.cQuery)},this.parsers.h=this.parsers.c;const d=new f.default;d.setLanguage(S.default),this.parsers.cs={parser:d,query:new f.default.Query(S.default,$.csharpQuery)};const u=new f.default;u.setLanguage(R.default),this.parsers.go={parser:u,query:new f.default.Query(R.default,$.goQuery)},p.default.info(`[${o.name}] All parsers initialized successfully`)}catch(e){throw p.default.error(`[${o.name}] Error initializing parsers: ${e.message}\n${e.stack}`),e}}parseDefinitions(e,t){const r=T.extname(e).toLowerCase().slice(1),n=[],i=this.parsers[r];if(!i)return p.default.warn(`[${o.name}] No parser available for file extension: ${r}`),n;try{const{parser:e,query:r}=i,o=e.parse(t),s=r.captures(o.rootNode);s.sort(((e,t)=>e.node.startPosition.row-t.node.startPosition.row));const a=t.split("\n");let c=-1;return s.forEach((e=>{const{node:t,name:r}=e,o=t.startPosition.row,i=t.endPosition.row;r.includes("name")&&a[o]&&n.push(a[o].trim()),c=i})),n}catch(t){return p.default.error(`[${o.name}] Error parsing definitions in file ${e}: ${t.message}\n${t.stack}`),n}}isExtensionSupported(e){return e in this.parsers}getParserForFile(e){const t=T.extname(e).toLowerCase().slice(1),r=this.parsers[t];return r?r.parser:null}collectErrorNodes(e,t,r){let n=!1;"ERROR"===e.type&&(r.push({filePath:t,line:e.startPosition.row+1,column:e.startPosition.column+1,endLine:e.endPosition.row+1,endColumn:e.endPosition.column+1,message:`Syntax error: issue near '${e.text.substring(0,30).replace(/\s+/g," ")}...' (type: ${e.type})`,severity:h.IssueSeverity.ERROR,source:"TreeSitter"}),n=!0),"MISSING"===e.type&&(r.push({filePath:t,line:e.startPosition.row+1,column:e.startPosition.column+1,endLine:e.endPosition.row+1,endColumn:e.endPosition.column+1,message:`Syntax error: missing element near '${e.text.substring(0,30).replace(/\s+/g," ")}...'`,severity:h.IssueSeverity.ERROR,source:"TreeSitter"}),n=!0);const o=e.type.toLowerCase();(o.includes("error")||o.includes("missing"))&&(r.push({filePath:t,line:e.startPosition.row+1,column:e.startPosition.column+1,endLine:e.endPosition.row+1,endColumn:e.endPosition.column+1,message:`Syntax error: issue near '${e.text.substring(0,30).replace(/\s+/g," ")}...' (type: ${e.type})`,severity:h.IssueSeverity.ERROR,source:"TreeSitter"}),n=!0),"unexpected_token"!==e.type&&"UNEXPECTED"!==e.type||(r.push({filePath:t,line:e.startPosition.row+1,column:e.startPosition.column+1,endLine:e.endPosition.row+1,endColumn:e.endPosition.column+1,message:`Syntax error: unexpected token '${e.text.substring(0,30).replace(/\s+/g," ")}...'`,severity:h.IssueSeverity.ERROR,source:"TreeSitter"}),n=!0);for(const o of e.children)this.collectErrorNodes(o,t,r)&&(n=!0);return n}getSyntaxIssues(e,t){const r=[],n=this.getParserForFile(e);if(!n)return p.default.warn(`[${o.name}] No parser available for syntax validation of: ${e}`),r;try{const o=n.parse(t);if(""===t.trim())return r;this.collectErrorNodes(o.rootNode,e,r);!0===o.rootNode.hasError&&0===r.length&&r.push({filePath:e,line:1,column:1,message:"Syntax error detected in file",severity:h.IssueSeverity.ERROR,source:"TreeSitter"});const i=T.extname(e).toLowerCase().slice(1);if(0===r.length&&""!==t.trim()&&("ts"===i||"js"===i||"py"===i)){const n=o.rootNode.endPosition,i=t.split("\n"),s=i.length;if(n.row<s-1||n.row===s-1&&n.column<i[s-1].length){const t=n.row+1,o=n.column+1,s=i[n.row].substring(Math.max(0,n.column-10),Math.min(i[n.row].length,n.column+20));r.push({filePath:e,line:t,column:o,message:`Syntax error: parsing stopped near '${s.replace(/\s+/g," ")}'`,severity:h.IssueSeverity.ERROR,source:"TreeSitter"})}}}catch(t){p.default.error(`[${o.name}] Error during Tree-sitter parsing for ${e}: ${t.message}`),r.push({filePath:e,line:1,column:1,message:`Failed to parse file with Tree-sitter: ${t.message}`,severity:h.IssueSeverity.ERROR,source:"TreeSitterInternal"})}return r}};t.TreeSitterService=O,t.TreeSitterService=O=o=a([(0,u.Injectable)(),l("design:paramtypes",[])],O)},885:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioTranscriptionController=void 0;const s=r(3563),a=r(9556),c=r(4562);let l=class{constructor(e){this.audioTranscriptionService=e}async transcribeAudio(e){try{return{transcription:await this.audioTranscriptionService.transcribe(e.buffer.toString("base64"))}}catch(e){throw console.error("Transcription error:",e),new Error("An error occurred during transcription")}}};t.AudioTranscriptionController=l,n([(0,s.Post)(),(0,s.UseInterceptors)((0,a.FileInterceptor)("audio")),i(0,(0,s.UploadedFile)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],l.prototype,"transcribeAudio",null),t.AudioTranscriptionController=l=n([(0,s.Controller)("audio-transcription"),o("design:paramtypes",[c.AudioTranscriptionService])],l)},904:e=>{"use strict";e.exports=require("mime-types")},943:e=>{"use strict";e.exports=require("shell-quote")},989:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseToolCallingAgent=void 0;const s=r(1486),a=r(3563),c=r(1412),l=r(1e3),d=r(3239),u=r(2368),f=r(6910),p=r(538),h=r(7373),g=r(6158),m=r(8474),y=i(r(9055)),v=r(6295),_=r(2873),w=r(3470);let b=class extends v.SimpleAgentService{constructor(e,t,r,n,o,i,s){super(e,t,r,n,o,s),this.workspaceService=e,this.sessionService=t,this.homeService=r,this.summaryCompletion=n,this.toolFactory=o,this.checkpointerService=i,this.ruleService=s}getToolCallingScheme(){return new _.MultilineToolCallingScheme}async*handleAppStream(e,t,r){let n;if(this.checkpointerService&&e.sessionId)try{const t=await this.checkpointerService.loadState(e.sessionId);t&&(n=t,y.default.debug("Loaded existing conversation state for session: %s",e.sessionId))}catch(e){y.default.warn("Failed to load conversation state:",e)}const o=await this.chatModelManager.getModel(e.config,this.getModelCategory(),this.isPrivateModelsOnly()),i=this.getTools(t);n||(n=this.createInitialState());const a=c.AgentRequest.getFirstTextContent(e.content),l=u.ConfigService.getInstance().getNumericProperty(f.ConfigPropNames.AGENT_ITERATION_LIMIT,20);let d=0,p=!1;const h=this.getToolCallingScheme();let g=await this.getSpecificSystemPrompt(t)+h.getSystemPrompt(t,i);const m=await this.getAgentRules();for(m&&(g=g+"\n\nAdditional system rules:\n"+m),y.default.debug("System prompt was:\n%s",g),n.messages.push(new s.SystemMessage({content:g})),n.messages.push(new s.HumanMessage({content:a}));d<l&&!p;){d++,y.default.info(`Iteration ${d}: Asking model for response...`);const t=await o.baseChatModel.invoke(n.messages);n.messages.push(t),this.checkpointerService&&e.sessionId&&await this.checkpointerService.saveState(e.sessionId,n),yield n;const r=t.content.toString();let a;y.default.info(`Iteration ${d}: Agent response:\n${r}`);try{a=h.parseLLMResponse(r)}catch(e){n.messages.push(new s.HumanMessage({content:"Error: Your response could not be parsed as valid. Please ensure you follow the correct format."}));continue}const{response:c,tool_calls:l,next:u}=a;if("finish"!==u)if("call_tools"===u&&Array.isArray(l))for(const e of l){const{tool_name:t,args:r}=e,o=i.find((e=>e.name===t));if(o)try{const e=await o.call(r);n.messages.push(new s.HumanMessage({content:`Tool: '${t}' output:\n${e}`}))}catch(e){y.default.error(`Error executing tool '${t}':`,e),n.messages.push(new s.HumanMessage({content:`Tool: Error executing '${t}': ${e.message}`})),yield n}else n.messages.push(new s.HumanMessage({content:`Tool: Unknown tool '${t}'.`})),yield n}else"continue"!==u&&(n.messages.push(new s.HumanMessage({content:`Tool: Unrecognized 'next' value '${u}'. Please use 'call_tools', 'continue', or 'finish'.`})),yield n);else p=!0}p||(n.messages.push(new s.SystemMessage({content:`Maximum iterations (${l}) reached without completion.`})),yield n)}};t.BaseToolCallingAgent=b,t.BaseToolCallingAgent=b=n([(0,a.Injectable)(),o("design:paramtypes",[m.WorkspaceService,h.SessionService,p.HomeService,d.SummaryCompletion,g.ToolFactoryService,l.CheckpointerService,w.AgentRuleService])],b)},1e3:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CheckpointerService=void 0;const i=r(3563),s=r(9314);let a=class{constructor(){this.checkpointer=new s.MemorySaver,this.stateMap=new Map}getCheckpointer(){return this.checkpointer}async saveState(e,t){this.stateMap.set(e,t)}async loadState(e){return this.stateMap.get(e)||null}};t.CheckpointerService=a,t.CheckpointerService=a=n([(0,i.Injectable)(),o("design:paramtypes",[])],a)},1002:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1036:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolEventHandler=void 0;const a=r(3563),c=s(r(9055)),l=r(6297),d=r(6780),u=r(5324),f=r(8010),p=r(6663);let h=n=class{constructor(e,t,r){this.blockService=e,this.toolExecutorService=t,this.eventHelper=r}async handleToolApproval(e,t){l.debugLogger.log(`Received toolApproval from client ${t.id} for block ${e.blockId}`),c.default.info(`[${n.name}] Received tool approval for block ${e.blockId}, Approved: ${e.approved}`);try{const r=await this.blockService.getBlock(e.blockId);if(!r)throw new Error(`Block with ID ${e.blockId} not found.`);const o=r.tagName||"unknown";if(e.approved){await this.blockService.updateBlock(e.blockId,{status:"executing"});const i=(0,d.parseToolParams)(r.content,o);await this.toolExecutorService.executeToolForBlock(t.id,e.taskId,e.blockId,o,i),c.default.info(`[${n.name}] Tool execution initiated for block ${e.blockId}`)}else await this.blockService.updateBlock(e.blockId,{status:"error",errorText:"Tool execution rejected by user"}),this.eventHelper.emitToolExecutionCompleted({clientId:t.id,taskId:e.taskId,blockId:e.blockId,toolName:o,result:{error:"Tool execution rejected by user"},status:"rejected"}),c.default.info(`[${n.name}] Tool rejected for block ${e.blockId}`)}catch(r){c.default.error(`[${n.name}] Error handling tool approval for block ${e.blockId}: ${r.message}\n${r.stack}`),this.eventHelper.emitError(t.id,e.taskId,r.message,"handleToolApproval","tool_error",{blockId:e.blockId})}}};t.ToolEventHandler=h,t.ToolEventHandler=h=n=o([(0,a.Injectable)(),i("design:paramtypes",[u.BlockService,f.ToolExecutorService,p.EventHelper])],h)},1075:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createBlockManager=function(e){return{safeEmitUpdate(t){const r=e.getCurrentBlockId();return r?{type:"blockUpdate",blockId:r,...t}:(i.default.error("[BlockManager] CRITICAL: Attempting to yield blockUpdate with null currentBlockId!"),null)},async*finishCurrentBlockIfNeeded(){if(e.isBlockGenerating()&&e.getCurrentBlockId()){const t=this.safeEmitUpdate({newStatus:"finished"});t&&(yield t),e.setBlockGenerating(!1),e.setCurrentBlockId(null),e.setCurrentBlockType(null),e.setCurrentTagName(null)}},async*startNewBlock(t,r,n){yield*this.finishCurrentBlockIfNeeded();const i=(0,o.ulid)();e.setCurrentBlockId(i),e.setCurrentBlockType(t),e.setCurrentTagName(r),e.setBlockGenerating(!0);const s={blockId:i,blockType:t,status:"error"===t?"error":"generating",content:n};"tool_call"!==t&&"thinking"!==t||!r||(s.tagName=r),"error"===t&&(s.errorText=n,s.content=""),yield{type:"block",block:s}},async*appendOrStartText(t,r){if(t)if(r.value+=t,e.isBlockGenerating()&&e.getCurrentBlockId()){const e=this.safeEmitUpdate({appendContent:t});e&&(yield e)}else t.trim()&&(yield*this.startNewBlock("text",null,t))},async*appendAndFinishText(t,r){if(t)if(r.value+=t,e.isBlockGenerating()&&e.getCurrentBlockId()){const r=this.safeEmitUpdate({appendContent:t,newStatus:"finished"});r&&(yield r),e.setBlockGenerating(!1),e.setCurrentBlockId(null),e.setCurrentBlockType(null),e.setCurrentTagName(null)}else if(t.trim()){yield*this.startNewBlock("text",null,t);const r=this.safeEmitUpdate({newStatus:"finished"});r&&(yield r),e.setBlockGenerating(!1),e.setCurrentBlockId(null),e.setCurrentBlockType(null),e.setCurrentTagName(null)}},async*createToolCallBlockFromContent(t,r){const n=(e=>{const t=e.match(/^\s*```(?:\w*\s*)?\n?([\s\S]*?)\n?\s*```\s*$/);return t&&void 0!==t[1]?t[1]:e})(r);yield*this.finishCurrentBlockIfNeeded(),yield*this.startNewBlock("tool_call",t,n);const o=this.safeEmitUpdate({newStatus:"finished"});o&&(yield o),i.default.info(`[BlockManager] Created tool_call block for "${t}" from extracted content`),e.setBlockGenerating(!1),e.setCurrentBlockId(null),e.setCurrentBlockType(null),e.setCurrentTagName(null)}}};const o=r(9100),i=n(r(9055))},1080:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigProperty=void 0;t.ConfigProperty=class{constructor(e,t){this.name=e,this.value=t}}},1114:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n(class_declaration\n  name: (identifier) @name.definition.class) @definition.class\n\n(method_declaration\n  name: (identifier) @name.definition.method) @definition.method\n\n(interface_declaration\n  name: (identifier) @name.definition.interface) @definition.interface\n\n(namespace_declaration\n  name: (identifier) @name.definition.namespace) @definition.namespace\n"},1115:e=>{"use strict";e.exports=require("yauzl")},1125:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ValidatorRegistryService=void 0;const u=r(3563),f=c(r(6928)),p=d(r(9055));let h=o=class{constructor(){this.validators=[],p.default.info(`[${o.name}] ValidatorRegistryService initialized`)}registerValidator(e){this.validators.push(e),p.default.info(`[${o.name}] Registered validator: ${e.getName()}`)}getValidatorsForFile(e){const t=f.extname(e).toLowerCase().slice(1),r=this.validators.filter((e=>e.canValidate(t)));return 0===r.length?p.default.debug(`[${o.name}] No validators found for file extension: ${t}`):p.default.debug(`[${o.name}] Found ${r.length} validators for file extension: ${t}`),r}getAllValidators(){return[...this.validators]}clearValidators(){this.validators=[],p.default.info(`[${o.name}] Cleared all validators`)}};t.ValidatorRegistryService=h,t.ValidatorRegistryService=h=o=a([(0,u.Injectable)(),l("design:paramtypes",[])],h)},1136:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StandardRulesService=void 0;const c=r(3563),l=(r(1832),r(6500)),d=a(r(9055));let u=n=class{constructor(e){this.knex=e}async onModuleInit(){try{await this.syncStandardRules(),d.default.info(`[${n.name}] Standard rules synced successfully`)}catch(e){d.default.error(`[${n.name}] Error syncing standard rules: ${e.message}\n${e.stack}`)}}async syncStandardRules(){const e=await this.knex("eve_rules").where("source_type","eve").select("*"),t=new Map(e.map((e=>[e.id,e])));for(const e of l.standardRules){const r=t.get(e.id);r?r.content===e.content&&r.name===e.name||(d.default.debug(`[${n.name}] Updating standard rule: ${e.name}`),await this.knex("eve_rules").where("id",e.id).update({name:e.name,content:e.content,updated_at:new Date})):(d.default.debug(`[${n.name}] Adding standard rule: ${e.name}`),await this.knex("eve_rules").insert((0,l.mapRuleToDbRecord)(e)))}for(const t of e){l.standardRules.some((e=>e.id===t.id))||(d.default.debug(`[${n.name}] Removing obsolete standard rule: ${t.name}`),await this.knex("eve_rules").where("id",t.id).delete(),await this.knex("eve_user_rule_preferences").where("rule_id",t.id).delete())}}};t.StandardRulesService=u,t.StandardRulesService=u=n=o([(0,c.Injectable)(),s(0,(0,c.Inject)("KNEX")),i("design:paramtypes",[Function])],u)},1140:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GeminiModelClient=void 0;const s=r(3563),a=r(639),c=r(5562),l=i(r(9055)),d=r(3089),u=r(9448);let f=class{constructor(e,t){this.config=e,this.DEFAULT_CACHE_TTL_SECONDS=900,this.client=new a.GoogleGenerativeAI(this.config.apiKey),this.options={enableVerboseLogging:!1,enableCaching:!0,cacheTtlSeconds:this.DEFAULT_CACHE_TTL_SECONDS,...t},this.stateManager=(0,u.createStateManager)(),this.patternUtils=(0,u.createPatternUtils)(),this.blockManager=(0,u.createBlockManager)(this.stateManager),this.streamProcessor=(0,u.createStreamProcessor)(this.blockManager,this.stateManager,this.patternUtils);const r=(0,c.getMaskedApiKey)(this.config.apiKey);l.default.info(`[GeminiModelClient] Initialized for model: ${this.config.modelId}`),l.default.info(`[GeminiModelClient] Using API key: ${r}`),this.options.enableVerboseLogging&&l.default.info(`[GeminiModelClient] Configuration: ${JSON.stringify({...this.options})}`),this.modelMetadata={modelId:this.config.modelId,providerId:"gemini",name:this.config.modelId,contextWindow:1e6,maxOutputTokens:8192,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1}}getModelId(){return this.config.modelId}getModelMetadata(){return this.modelMetadata}setModelMetadata(e){this.modelMetadata=e,l.default.info(`[GeminiModelClient] Updated metadata for ${this.config.modelId}: MaxOutputTokens=${this.modelMetadata.maxOutputTokens}`)}async*generateResponse(e,t,r,n){if(l.default.info(`[GeminiModelClient] Generating response with system prompt length: ${e.length} characters`),l.default.info(`[GeminiModelClient] Messages count: ${t.length}`),0===t.length)throw l.default.error("[GeminiModelClient] No messages provided to generateResponse"),new Error("messages: at least one message is required");this.stateManager.reset();try{const o=t.map(c.convertEveMessageToGemini),i=o[o.length-1];l.default.info(`[GeminiModelClient] Last message role: ${i.role}`);let s="Non-string or empty content";i.parts&&i.parts.length>0&&i.parts[0].text&&(s=`${i.parts[0].text.substring(0,300)}...`),l.default.info(`[GeminiModelClient] Last message content (first 300 chars): ${s}`),n?(l.default.info(`[GeminiModelClient] Using abort signal, current state: ${n.aborted}`),n.addEventListener("abort",(()=>l.default.info("[GeminiModelClient] Abort signal triggered")))):l.default.info("[GeminiModelClient] No abort signal provided");const u=this.client.getGenerativeModel({model:this.config.modelId,systemInstruction:e,generationConfig:{temperature:0,maxOutputTokens:this.modelMetadata.maxOutputTokens||8192},safetySettings:[{category:a.HarmCategory.HARM_CATEGORY_HARASSMENT,threshold:a.HarmBlockThreshold.BLOCK_NONE},{category:a.HarmCategory.HARM_CATEGORY_HATE_SPEECH,threshold:a.HarmBlockThreshold.BLOCK_NONE},{category:a.HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:a.HarmBlockThreshold.BLOCK_NONE},{category:a.HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:a.HarmBlockThreshold.BLOCK_NONE}]}),f={contents:o,safetySettings:[{category:a.HarmCategory.HARM_CATEGORY_HARASSMENT,threshold:a.HarmBlockThreshold.BLOCK_NONE},{category:a.HarmCategory.HARM_CATEGORY_HATE_SPEECH,threshold:a.HarmBlockThreshold.BLOCK_NONE},{category:a.HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:a.HarmBlockThreshold.BLOCK_NONE},{category:a.HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:a.HarmBlockThreshold.BLOCK_NONE}]};l.default.info("[GeminiModelClient] Caching disabled (not yet implemented for Gemini API)");const p=await u.generateContentStream(f);yield*this.streamProcessor.processStream(p.stream,r,n);try{const e=await p.response,t=e?.usageMetadata;if(t){l.default.info(`[GeminiModelClient] Usage - Prompt: ${t.promptTokenCount}, Candidates: ${t.candidatesTokenCount}, Total: ${t.totalTokenCount}`),l.default.info(`[GeminiModelClient] Cache - Cached Content: ${t.cachedContentTokenCount||0} tokens`);const e=(0,d.calculateGeminiCost)(this.modelMetadata,t.promptTokenCount||0,t.candidatesTokenCount||0,t.cachedContentTokenCount||0);void 0!==e&&l.default.info(`[GeminiModelClient] Estimated cost: $${e.toFixed(6)}`),yield{type:"usage",inputTokens:t.promptTokenCount||0,outputTokens:t.candidatesTokenCount||0,cacheReadTokens:t.cachedContentTokenCount||0,totalCost:e}}else l.default.warn("[GeminiModelClient] Usage metadata not found in final response."),yield{type:"usage",inputTokens:0,outputTokens:0}}catch(e){l.default.error(`[GeminiModelClient] Error getting usage metadata: ${e.message}`),yield{type:"usage",inputTokens:0,outputTokens:0}}}catch(e){const t=(0,c.getMaskedApiKey)(this.config.apiKey);throw l.default.error(`[GeminiModelClient] Error in generateResponse: ${e.message}`,e.stack),l.default.error(`[GeminiModelClient] Using API key: ${t}`),e}}};t.GeminiModelClient=f,t.GeminiModelClient=f=n([(0,s.Injectable)(),o("design:paramtypes",[Object,Object])],f)},1145:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.RuleSource=void 0,function(e){e.REPO="repo",e.USER="user",e.EVE="eve"}(r||(t.RuleSource=r={}))},1162:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ModelCategory=void 0,function(e){e.CODING="CODING",e.REASONING="REASONING",e.SUMMARISATION="SUMMARISATION",e.RAG_QUERY="RAG_QUERY",e.ORCHESTRATION="ORCHESTRATION",e.ARCHITECT="ARCHITECT"}(r||(t.ModelCategory=r={}))},1208:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AnthropicAdapter=void 0;const s=r(3563),a=r(146),c=i(r(9055)),l=r(3118);let d=class{constructor(e){this.provider=e,this.id="anthropic",this.name="Anthropic",this.messageTransformer=new l.AnthropicMessageTransformer}getProvider(){return this.provider}getModelClient(e){return this.provider.getModelClient(e)}toProviderFormat(e){return this.messageTransformer.toProviderFormat(e)}fromProviderFormat(e,t=""){return this.messageTransformer.fromProviderFormat(e,t).map((e=>({...e,taskId:e.taskId||t||""})))}extractMetadata(e){return c.default.debug("[AnthropicAdapter] extractMetadata called, returning null as logic is in ModelClient."),null}supportsThinking(){return!0}supportsFormatConversion(e){return!0}};t.AnthropicAdapter=d,t.AnthropicAdapter=d=n([(0,s.Injectable)(),o("design:paramtypes",[a.AnthropicProvider])],d)},1263:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProductAgentService=void 0;const a=r(3563),c=r(6158),l=r(3470),d=s(r(9055)),u=r(2300),f=r(5277),p=r(8921);let h=class extends f.GraphAgentService{constructor(e,t,r){super(e,t,r),this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}getName(){return"product-agent"}async getTools(e){return await this.toolFactoryService.createTools(["update_file","delete_file","fetch_web_page","current_timestamp","serp_api"],e)}async getSystemPrompt(e){let t=`As an AI Product Manager, your role is to define, refine, and manage product requirements through epics and stories. You excel at:\n\n1. Creating and Refining Requirements:\n   - Developing clear, comprehensive epic requirements\n   - Breaking down epics into well-defined stories\n   - Writing detailed, testable acceptance criteria\n   - Ensuring requirements are SMART (Specific, Measurable, Achievable, Relevant, Time-bound)\n\n2. Stakeholder Perspective Analysis:\n   - Product Value: Ensuring features deliver clear business value\n   - User Experience: Considering the end-user journey and usability\n   - Quality Assurance: Including testability and edge cases\n   - Operations: Considering scalability, monitoring, and maintenance\n   - Engineering: Evaluating technical feasibility and complexity\n   - Security: Identifying potential security implications\n   - Compliance: Ensuring regulatory and policy compliance\n\n3. Story Creation Best Practices:\n   - Write user-centric stories following the format:\n     "A a [user type], I want [goal] so that [benefit]"\n   - Create comprehensive acceptance criteria that:\n     * Are each formatted as "ACxx: Given a [user type], when [action], then [outcome]"\n     * Are specific and testable\n     * Cover happy path and edge cases\n     * Include performance requirements\n     * Specify error handling\n     * Define security requirements\n     * Include monitoring/observability requirements\n\n4. Requirements Quality Standards:\n   - Clarity: Unambiguous and easily understood\n   - Completeness: Covers all aspects of the feature\n   - Consistency: Aligns with existing features and patterns\n   - Testability: Can be verified through testing\n   - Feasibility: Technically achievable within constraints\n   - Traceability: Links to business goals and metrics\n\n${await p.EpicsPrompts.updateEpicInstructions(e)}\n\n${await p.EpicsPrompts.updateEpicStories(e)}\n\n${await p.EpicsPrompts.existingEpicsAndStories(e)}\n\n${e.productHints()?`Product Guidelines:\n${e.productHints()}`:""}\n\nIMPORTANT: Always write requirements from the user's perspective\nIMPORTANT: Every story must have clear, testable acceptance criteria\nIMPORTANT: Consider all stakeholder perspectives when defining requirements\nIMPORTANT: Ensure requirements are complete, clear, and unambiguous\nIMPORTANT: Include non-functional requirements (performance, security, etc.)\nIMPORTANT: Use the current_timestamp tool for timestamps\nIMPORTANT: Stories should be independent and deliverable\nIMPORTANT: DO NOT CREATE ANY STORIES UNLESS YOU ARE ASKED TO DO SO EXPLICITLY\n`;return d.default.debug(`Product Agent system prompt for workspace '${e.workspace.name}' (length: ${t.length} chars): ${t}`),t}};t.ProductAgentService=h,t.ProductAgentService=h=n([(0,a.Injectable)(),i(0,(0,a.Inject)((0,a.forwardRef)((()=>u.GraphAgentCollaborator)))),o("design:paramtypes",[u.GraphAgentCollaborator,c.ToolFactoryService,l.AgentRuleService])],h)},1280:(e,t)=>{"use strict";var r,n,o;Object.defineProperty(t,"__esModule",{value:!0}),t.ClientToServerEvents=t.NotificationEvents=t.InternalEvents=t.TASK_UPDATE_EVENT=void 0,t.TASK_UPDATE_EVENT="agent.taskUpdate",function(e){e.TOOL_EXECUTED="agent.tool.executed",e.TOOL_ERROR="agent.tool.error",e.TASK_CREATED="agent.task.created",e.TASK_UPDATED="agent.task.updated",e.AGENT_ERROR_NOTIFICATION="agent.error.notification",e.BLOCK_CREATED="agent.block.created",e.BLOCK_UPDATED="agent.block.updated",e.BLOCK_USAGE_TRACKED="agent.block.usage.tracked",e.TOOL_CALL_DETECTED="agent.tool.call.detected",e.TOOL_EXECUTION_COMPLETED="agent.tool.execution.completed"}(r||(t.InternalEvents=r={})),function(e){e.TASK_STATUS_UPDATED="taskStatusUpdated",e.AGENT_ERROR="agentError",e.CONTEXT_TRUNCATED="contextTruncated",e.TASK_CREATED="taskCreated",e.BLOCK_EVENT="blockEvent"}(n||(t.NotificationEvents=n={})),function(e){e.USER_PROMPT="userPrompt",e.TOOL_APPROVAL="toolApproval",e.CREATE_TASK="createTask",e.CANCEL_TASK="cancelTask",e.CHANGE_AGENT_MODE="changeAgentMode"}(o||(t.ClientToServerEvents=o={}))},1302:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PROVIDER_CANCELLATION_STRATEGIES=void 0,t.getCancellationStrategy=s,t.setupAbortHandling=function(e,t,r){if(!r)return void o.default.info(`[CancellationUtils] No abort signal provided for ${t} stream`);const n=s(t);r.aborted&&(o.default.info(`[CancellationUtils] Abort signal already aborted for ${t} stream`),i.debugLogger.log(`Abort signal already aborted for ${t} stream`));r.addEventListener("abort",(()=>{o.default.info(`[CancellationUtils] Abort signal triggered for ${t} stream`),i.debugLogger.log(`ABORT SIGNAL TRIGGERED for ${t} stream`),n.cancelStream(e)})),o.default.info(`[CancellationUtils] Abort handling set up for ${t} stream`)},t.createAbortableStream=async function*(e,t){if(t?.aborted)throw o.default.info("[CancellationUtils] Stream aborted before processing started"),new Error("Operation aborted before stream processing started");try{for await(const r of e){if(t?.aborted)throw o.default.info("[CancellationUtils] Stream aborted during processing"),new Error("Operation aborted during stream processing");yield r}}catch(e){if(t?.aborted||e.message?.includes("abort")||e.message?.includes("cancel"))throw o.default.info(`[CancellationUtils] Stream aborted with error: ${e.message}`),new Error("Operation aborted: "+e.message);throw e}};const o=n(r(9055)),i=r(6297);function s(e){return t.PROVIDER_CANCELLATION_STRATEGIES[e]||t.PROVIDER_CANCELLATION_STRATEGIES.default}t.PROVIDER_CANCELLATION_STRATEGIES={anthropic:{supportsNativeCancellation:!0,cancelStream:e=>{e&&"function"==typeof e.cancel&&e.cancel()},shouldCheckAbortBeforeChunk:!0},google:{supportsNativeCancellation:!1,cancelStream:e=>{o.default.info("[CancellationUtils] Attempting to cancel Google stream (may not be supported)")},shouldCheckAbortBeforeChunk:!0},default:{supportsNativeCancellation:!1,cancelStream:()=>{o.default.info("[CancellationUtils] Using default cancellation strategy (no-op)")},shouldCheckAbortBeforeChunk:!0}}},1321:e=>{"use strict";e.exports=require("reflect-metadata")},1346:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FileScanner=void 0;const u=r(3563),f=c(r(1943)),p=c(r(6928)),h=d(r(9055)),g=r(5266);let m=o=class{constructor(e){this.rootPath=e}async*scan(e,t,r){void 0===r.limitFilterExcludedFiles&&(r.limitFilterExcludedFiles=!1);const n=this.normalizePath(e);try{const e=p.join(this.rootPath,n),i=await f.stat(e),s={path:n,isDir:i.isDirectory(),sizeBytes:i.size};r.stats.nodesScanned++,r.stats.bytesScanned+=i.size;let a=!0,c=s.isDir;for(const e of t){const t=await e(s,r);if("exclude"===t){"limitFilter"===e.name&&(r.limitFilterExcludedFiles=!0),a=!1;break}"prune-children"===t&&(c=!1)}if(a&&(r.stats.nodesIncluded++,r.stats.bytesIncluded+=i.size,r.stats.estimatedTokens+=this.estimateTokens(s),yield s),!s.isDir||!c)return;const l=[],d=await f.readdir(e);d.sort(((e,t)=>e.localeCompare(t)));for(const e of d)l.push({path:p.join(n,e),depth:1});for(;l.length>0;){const{path:e,depth:n}=l.shift(),i=p.join(this.rootPath,e);r.currentDepth=n;try{const s=await f.stat(i),a={path:e,isDir:s.isDirectory(),sizeBytes:s.size};r.stats.nodesScanned++,r.stats.bytesScanned+=s.size;let c=!0,d=a.isDir;for(const e of t){const t=await e(a,r);if("exclude"===t){"limitFilter"===e.name&&(r.limitFilterExcludedFiles=!0),c=!1;break}"prune-children"===t&&(d=!1)}if(c&&(r.stats.nodesIncluded++,r.stats.bytesIncluded+=s.size,r.stats.estimatedTokens+=this.estimateTokens(a),yield a),a.isDir&&d)try{const t=await f.readdir(i);t.sort(((e,t)=>e.localeCompare(t)));for(const r of t)l.push({path:p.join(e,r),depth:n+1})}catch(e){h.default.error(`[${o.name}] Error reading directory ${i}: ${e.message}`)}}catch(e){h.default.error(`[${o.name}] Error scanning ${i}: ${e.message}`)}}}catch(e){h.default.error(`[${o.name}] Error scanning root ${p.join(this.rootPath,n)}: ${e.message}`)}}async collect(e,t,r={}){const n=r.initialContext||{rootPath:this.rootPath,currentDepth:0,limitFilterExcludedFiles:!1,stats:{nodesScanned:0,nodesIncluded:0,bytesScanned:0,bytesIncluded:0,estimatedTokens:0}},o=[];for await(const r of this.scan(e,t,n))o.push(r);const i=n.limitFilterExcludedFiles||!1;return{nodes:o,stats:{...n.stats,truncated:i,truncatedDirectories:0},truncated:i}}async*scanBreadthFirst(e,t,r={}){const n=r.maxFilesPerDirectory||100,i=[{path:this.normalizePath(e),depth:0}],s={rootPath:this.rootPath,currentDepth:0,limitFilterExcludedFiles:!1,stats:{nodesScanned:0,nodesIncluded:0,bytesScanned:0,bytesIncluded:0,estimatedTokens:0}};for(;i.length>0;){const{path:e,depth:a}=i.shift(),c=p.join(this.rootPath,e);s.currentDepth=a;try{const l=await f.readdir(c,{withFileTypes:!0}),d=[],u=[];for(const n of l){const i=p.join(e,n.name),l=p.join(c,n.name);try{const e=await f.stat(l),n={path:i,isDir:e.isDirectory(),sizeBytes:e.size};s.stats.nodesScanned++,s.stats.bytesScanned+=e.size;let o=!0,c=n.isDir;for(const e of t){const t=await e(n,s);if("exclude"===t){"limitFilter"===e.name&&(s.limitFilterExcludedFiles=!0),o=!1;break}"prune-children"===t&&(c=!1)}o&&(n.isDir?(c&&u.push({path:i,depth:a+1}),yield n):(void 0===r.maxDepth||a<=r.maxDepth)&&(d.push(n),s.stats.nodesIncluded++,s.stats.bytesIncluded+=e.size,s.stats.estimatedTokens+=this.estimateTokens(n)))}catch(e){h.default.error(`[${o.name}] Error processing entry ${l}: ${e.message}`)}}if(r.sortByPath&&d.sort(((e,t)=>e.path.localeCompare(t.path))),d.length>n){s.limitFilterExcludedFiles=!0,yield{type:"truncation-marker",directory:e,droppedCount:d.length-n};for(const e of d.slice(0,n))yield e}else for(const e of d)yield e;i.push(...u)}catch(e){h.default.error(`[${o.name}] Error scanning directory ${c}: ${e.message}`)}}}async collectForLLM(e={},t=[],r="."){const n=[],o=[];let i=0,s=0,a=!1;const c={rootPath:this.rootPath,currentDepth:0,limitFilterExcludedFiles:!1,stats:{nodesScanned:0,nodesIncluded:0,bytesScanned:0,bytesIncluded:0,estimatedTokens:0}};void 0!==e.maxDepth&&t.push(g.FileFiltersFactory.depthFilter(e.maxDepth));for await(const l of this.scanBreadthFirst(this.normalizePath(r),t,{maxFilesPerDirectory:e.maxFilesPerDirectory||100,sortByPath:!1!==e.sortByPath,maxDepth:e.maxDepth})){if("type"in l&&"truncation-marker"===l.type){o.push(l);continue}const t=l;if(e.maxItems&&n.length>=e.maxItems||e.maxBytes&&s+(t.sizeBytes||0)>e.maxBytes||e.maxTokens&&i+this.estimateTokens(t)>e.maxTokens){a=!0,c.limitFilterExcludedFiles=!0;break}n.push(t),s+=t.sizeBytes||0,i+=this.estimateTokens(t)}return{nodes:n,truncationMarkers:o,stats:{nodesScanned:n.length+(a?1:0),nodesIncluded:n.length,bytesScanned:s,bytesIncluded:s,estimatedTokens:i,truncated:a,truncatedDirectories:o.length},truncated:a}}estimateTokens(e){const t=e.path.length/4;if(e.isDir)return t+2;const r=(e.sizeBytes||0)/4;return t+Math.min(r,10)}normalizePath(e){return"."===e||""===e?"":e}};t.FileScanner=m,t.FileScanner=m=o=a([(0,u.Injectable)(),l("design:paramtypes",[String])],m)},1367:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.EveAgentModule=void 0;const s=r(3563),a=r(7967),c=r(9191),l=r(9668),d=r(461),u=r(4193),f=r(5873),p=r(9102),h=r(5369),g=r(6206),m=r(8620),y=r(5702),v=r(5499),_=r(5630),w=r(1208),b=r(7916),k=r(4624),S=r(4070),R=r(9503),T=r(712),$=r(4810),O=r(2597),P=r(3569),E=r(1991),I=r(5884),C=r(662),A=r(2385),M=r(6550),D=r(269),x=r(6963),j=r(5324),N=r(6595),F=r(7663),L=r(9076),U=r(1036),B=r(8444),q=r(4704),G=r(4043),H=r(6663),W=r(2776),K=r(873),z=r(4243),V=r(1125),Y=r(4318),X=r(4835),J=r(7516),Q=r(6349),Z=r(6647),ee=r(6724),te=r(2141),re=r(7526),ne=r(2811),oe=r(4155),ie=r(7403),se=r(8010),ae=r(2398),ce=r(8615),le=r(6170),de=r(1136),ue=r(8190),fe=r(3220),pe=r(6823),he=r(5156),ge=r(9235),me=r(8507),ye=r(5814),ve=r(7050),_e=r(2115),we=r(1600),be=r(5177),ke=r(9220),Se=r(4230),Re=r(9841),Te=r(6292),$e=r(3911);let Oe=class{constructor(e,t,r,n,o,i){this.toolProvider=e,this.treeSitterService=t,this.contextManagerService=r,this.dbDebugContextService=n,this.appDataSource=o,this.toolFactories=i}onModuleInit(){for(const e of this.toolFactories)this.toolProvider.registerToolFactory(e);this.appDataSource.setDbDebugContextService(this.dbDebugContextService)}};t.EveAgentModule=Oe,t.EveAgentModule=Oe=n([(0,s.Module)({imports:[d.EventEmitterModule.forRoot(),(0,s.forwardRef)((()=>u.HomeModule)),f.WorkspaceModule,a.ConfigModule],controllers:[O.EveAgentController,P.ConfigController,E.TaskHistoryController,I.BlockController,C.RulesController,A.RepoRulesController,ne.FileSystemController],providers:[{provide:W.AppDataSource,useFactory:W.getAppDataSource},{provide:"KNEX",useFactory:e=>e.knex,inject:[W.AppDataSource]},D.DbDebugContextService,p.EveConfigService,g.ProviderRegistry,m.LlmMetadataService,c.LlmInitializerService,y.ModelRefreshService,v.ToolResultTransformerService,_.AnthropicProvider,_.GeminiProvider,w.AnthropicAdapter,b.GeminiAdapter,k.ProviderAdapterRegistry,{provide:"PROVIDER_ADAPTERS",useFactory:(e,t)=>[e,t],inject:[w.AnthropicAdapter,b.GeminiAdapter]},h.ApiHandlerFactory,$.WebSocketService,S.EveAgentIncomingGateway,R.EveAgentInternalGateway,T.EveAgentOutgoingGateway,M.TaskService,K.TreeSitterService,J.ContextManagerService,Q.ConversationHistoryService,Z.TaskHistoryService,te.FileSystemService,re.IgnoreConfigService,z.FileValidationService,V.ValidatorRegistryService,Y.ValidatorProvider,X.TreeSitterValidator,oe.ResponseFormatterService,ie.FileContentOptimizerService,se.ToolExecutorService,ae.ToolProvider,ce.PromptBuilderService,le.RulesService,de.StandardRulesService,l.UserService,j.BlockService,x.AgentStateManager,x.ContextTruncationHandler,x.LlmStreamProcessorBlock,x.AgentLoopOrchestrator,N.TaskEventHandler,F.UserPromptHandler,L.FeedbackEventHandler,ee.MentionsService,U.ToolEventHandler,B.ConfigEventHandler,q.AgentModeHandler,G.MessagingHandler,H.EventHelper,ue.CancellationResetService,Te.PersonaRegistry,$e.SoftwareEngineerPersona,fe.ReadFileToolFactory,pe.WriteToFileToolFactory,he.ReplaceInFileToolFactory,ge.ListFilesToolFactory,me.SearchFilesToolFactory,ye.ExecuteCommandToolFactory,ve.ListCodeDefinitionsToolFactory,_e.McpHubService,we.UseMcpToolToolFactory,be.AccessMcpResourceToolFactory,ke.AskFollowupQuestionToolFactory,Se.PlanModeRespondToolFactory,Re.AttemptCompletionToolFactory,{provide:"TOOL_FACTORIES",useFactory:(e,t,r,n,o,i,s,a,c,l,d,u)=>[e,t,r,n,o,i,s,a,c,l,d,u],inject:[fe.ReadFileToolFactory,pe.WriteToFileToolFactory,he.ReplaceInFileToolFactory,ge.ListFilesToolFactory,me.SearchFilesToolFactory,ye.ExecuteCommandToolFactory,ve.ListCodeDefinitionsToolFactory,we.UseMcpToolToolFactory,be.AccessMcpResourceToolFactory,ke.AskFollowupQuestionToolFactory,Se.PlanModeRespondToolFactory,Re.AttemptCompletionToolFactory]}],exports:[p.EveConfigService,g.ProviderRegistry,m.LlmMetadataService,c.LlmInitializerService,y.ModelRefreshService,v.ToolResultTransformerService,_.AnthropicProvider,_.GeminiProvider,h.ApiHandlerFactory,se.ToolExecutorService,ae.ToolProvider,D.DbDebugContextService,l.UserService,Q.ConversationHistoryService,k.ProviderAdapterRegistry]}),i(5,(0,s.Inject)("TOOL_FACTORIES")),o("design:paramtypes",[ae.ToolProvider,K.TreeSitterService,J.ContextManagerService,D.DbDebugContextService,W.AppDataSource,Array])],Oe)},1391:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n(function_signature\n  name: (identifier) @name.definition.function) @definition.function\n\n(method_signature\n  name: (property_identifier) @name.definition.method) @definition.method\n\n(abstract_method_signature\n  name: (property_identifier) @name.definition.method) @definition.method\n\n(abstract_class_declaration\n  name: (type_identifier) @name.definition.class) @definition.class\n\n(module\n  name: (identifier) @name.definition.module) @definition.module\n\n(function_declaration\n  name: (identifier) @name.definition.function) @definition.function\n\n(method_definition\n  name: (property_identifier) @name.definition.method) @definition.method\n\n(class_declaration\n  name: (type_identifier) @name.definition.class) @definition.class\n"},1412:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AgentRequest=void 0;const n=r(2003),o=r(9100);class i{constructor(e,t,r,o=new n.AgentConfig,s){this.sender=e,this.content=t,this.sessionId=r,this.config=o,this.workspaceName=s,this.sessionId=r||i.generateRandomSessionId()}static fromJSON(e){const{sender:t,content:r,sessionId:o,config:s,workspaceName:a,agent:c}=e;if(!r)throw new Error("Missing required field 'content'");const l=s?Object.assign(new n.AgentConfig,s):new n.AgentConfig,d=o||i.generateRandomSessionId();return new i(t,r,d,l,a)}static generateRandomSessionId(){return(0,o.ulid)()}static getFirstTextContent(e){if("string"==typeof e)return e;if(!Array.isArray(e))throw new Error("Invalid content type");{const t=e[0];if("text"===t.type)return t.text||""}}}t.AgentRequest=i},1463:e=>{"use strict";e.exports=require("@langchain/groq")},1486:e=>{"use strict";e.exports=require("@langchain/core/messages")},1544:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatModelManager=void 0;const o=r(4264),i=r(1986),s=r(4659),a=r(8312),c=r(2088),l=r(2003),d=n(r(9055)),u=r(1162),f=r(2368),p=r(2097),h=r(8910),g=r(3971),m=r(59),y=r(9352),v=r(9361);class _{constructor(){this.providers=[new i.AnthropicProvider,new o.OpenAIProvider,new s.GroqProvider,new a.OllamaProvider,new p.HyperbolicProvider,new h.MistralProvider,new g.OpenRouterProvider,new m.GlhfProvider,new y.DeepSeekProvider,new v.GoogleProvider]}static getInstance(){return _.instance||(_.instance=new _),_.instance}static async getModel(e,t=u.ModelCategory.CODING){return _.getInstance().getModel(e,t)}async getModel(e,t=u.ModelCategory.CODING,r=!1){let n=e?.model;if(!n){n=(void 0!==e?.privateModelsRequired?e.privateModelsRequired:r)?f.ConfigService.getInstance().getProperty(`PRIVATE_${t}_MODEL`):f.ConfigService.getInstance().getProperty(`DEFAULT_${t}_MODEL`)}const o=await this.getProvider(n),i=await o.getModelDescriptor(n),s=o.getBaseChatModel(n,e||new l.AgentConfig),a=o.getChatModelOptions(i,e);return new c.ChatModel(i,s,a)}async getValidModelDescriptors(){const e=this.providers.filter((e=>e.isValid())).map((async e=>{try{return await e.getModelDescriptors()}catch(t){return d.default.error(`Error fetching model descriptors from provider ${e.getName()}:`,t),[]}}));return(await Promise.all(e)).flat()}async getValidModelNames(){return(await this.getValidModelDescriptors()).map((e=>e.name))}async getValidModelFullNames(){return(await this.getValidModelDescriptors()).map((e=>e.getFullName())).sort()}async getProvider(e){if(e){const[t]=e.split("/"),r=this.providers.find((e=>e.getName()===t));if(r){if(r.isValid())return r;d.default.warn(`Provider ${t} is not valid. Searching for first valid provider.`)}d.default.warn(`Provider not found or not valid for model ${e}. Searching for first valid provider.`)}const t=this.providers.find((e=>e.isValid()));if(t)return t;throw new Error("No valid provider found. Please check your API keys.")}}t.ChatModelManager=_},1547:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n(function_definition\n  declarator: (function_declarator\n    declarator: (identifier) @name.definition.function)) @definition.function\n\n(struct_specifier\n  name: (type_identifier) @name.definition.struct) @definition.struct\n\n(enum_specifier\n  name: (type_identifier) @name.definition.enum) @definition.enum\n"},1569:e=>{"use strict";e.exports=require("zod")},1600:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UseMcpToolToolFactory=void 0;const i=r(3563),s=r(5853),a=r(2115);let c=class{constructor(e){this.mcpHubService=e}getToolName(){return"use_mcp_tool"}create(e){return new s.UseMcpToolTool(this.mcpHubService)}};t.UseMcpToolToolFactory=c,t.UseMcpToolToolFactory=c=n([(0,i.Injectable)(),o("design:paramtypes",[a.McpHubService])],c)},1623:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RESPONSE_ONLY_TOOLS=void 0,t.RESPONSE_ONLY_TOOLS=["plan_mode_respond","attempt_completion","ask_followup_question"]},1672:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(1926),t),o(r(1140),t),o(r(7916),t),o(r(1002),t),o(r(5789),t),o(r(5562),t)},1680:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.DocstoreModule=void 0;const o=r(3563),i=r(8144),s=r(3381),a=r(8648),c=r(376);let l=class{};t.DocstoreModule=l,t.DocstoreModule=l=n([(0,o.Module)({imports:[c.DataSourceModule],controllers:[i.StoredDocController],providers:[s.StoredDocService,a.StoredDocRepository],exports:[s.StoredDocService]})],l)},1685:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TOOL_CALL_TAGS=t.THINKING_TAGS=void 0,t.mapTagToBlockType=function(e){if(!e)return"text";const r=e.toLowerCase();if(t.THINKING_TAGS.includes(r))return"thinking";if(t.TOOL_CALL_TAGS.includes(r))return"tool_call";return"text"},t.THINKING_TAGS=["thinking","reasoning"],t.TOOL_CALL_TAGS=["read_file","write_to_file","replace_in_file","search_files","list_files","execute_command","browser_action","list_code_definition_names","use_mcp_tool","access_mcp_resource","ask_followup_question","attempt_completion","new_task","plan_mode_respond","load_mcp_documentation","fake_tool_name_for_testing"]},1747:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetDocument=void 0;const n=r(9100);t.DatasetDocument=class{constructor(e,t,r,o="new",i=(0,n.ulid)(),s=new Date,a=new Date){this.id=i,this.datasetId=e,this.filename=t,this.contentHash=r,this.status=o,this.createdAt=s,this.updatedAt=a}}},1781:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FetchWebPage=void 0;const a=r(5534),c=r(1569),l=s(r(758)),d=s(r(9055)),u=r(3563),f=r(3239);let p=class extends a.Tool{constructor(e){super(),this.summaryCompletion=e,this.name="fetch_web_page",this.description="Fetch the body text of a web page using a headless browser. This tool should only be used if the user has specifically asked for a web page by URL.",this.schema=c.z.object({url:c.z.string().describe("The URL of the web page to fetch")}),this.warningThreshold=5e4}async _call({url:e}){try{d.default.info(`Fetching web page: ${e}`);const t=await l.default.launch({headless:!0}),r=await t.newPage();await r.goto(e,{waitUntil:"networkidle0"});const n=await r.evaluate((()=>document.body.innerText));if(await t.close(),n.length>this.warningThreshold){d.default.warn(`Large text content detected (${n.length} characters) for URL: ${e}`);const t=`Please summarise the contents of the web url: ${e} so that we get all the useful information from the page`;return`Fetched and summarized text from URL: ${e}\nSummary:\n${await this.summaryCompletion.getSummary(t,n)}`}return`Fetched text from URL: ${e}\nContent:\n${n}`}catch(t){d.default.error(`Error fetching web page: ${e}`,t);return`Error fetching web page: ${e}\nError:\n${t.message||"Unknown error occurred"}`}}};t.FetchWebPage=p,t.FetchWebPage=p=n([i(0,(0,u.Inject)(f.SummaryCompletion)),o("design:paramtypes",[f.SummaryCompletion])],p)},1832:e=>{"use strict";e.exports=require("knex")},1879:e=>{"use strict";e.exports=require("xmldom")},1901:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.GitModule=void 0;const o=r(3563),i=r(7265),s=r(5190),a=r(5873);let c=class{};t.GitModule=c,t.GitModule=c=n([(0,o.Module)({imports:[a.WorkspaceModule],controllers:[i.GitController],providers:[s.GitService]})],c)},1921:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AskFollowupQuestionTool=void 0;const a=r(3563),c=s(r(9055));let l=n=class{constructor(){this.name="ask_followup_question",this.description="Ask the user a question to gather additional information needed to complete the task.",c.default.info(`[${n.name}] AskFollowupQuestionTool initialized`)}getUsageInstructions(e){return'## ask_followup_question\nDescription: Ask the user a question to gather additional information needed to complete the task. This tool should be used when you encounter ambiguities, need clarification, or require more details to proceed effectively. It allows for interactive problem-solving by enabling direct communication with the user. Use this tool judiciously to maintain a balance between gathering necessary information and avoiding excessive back-and-forth.\nParameters:\n- question: (required) The question to ask the user. This should be a clear, specific question that addresses the information you need.\n- options: (optional) An array of 2-5 options for the user to choose from. Each option should be a string describing a possible answer. You may not always need to provide options, but it may be helpful in many cases where it can save the user from having to type out a response manually. IMPORTANT: NEVER include an option to toggle to Act mode, as this would be something you need to direct the user to do manually themselves if needed.\nUsage:\n<ask_followup_question>\n<question>Your question here</question>\n<options>\nArray of options here (optional), e.g. ["Option 1", "Option 2", "Option 3"]\n</options>\n</ask_followup_question>'}validateParams(e){return"string"==typeof e.question&&""!==e.question.trim()}async execute(e){const{question:t,options:r}=e;return c.default.info(`[${n.name}] Asking followup question: ${t}`),{question:t,options:r,response:"This is a placeholder response. In a real implementation, the response would be provided by the user."}}};t.AskFollowupQuestionTool=l,t.AskFollowupQuestionTool=l=n=o([(0,a.Injectable)(),i("design:paramtypes",[])],l)},1926:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GeminiProvider=void 0;const s=r(3563),a=r(6206),c=i(r(9055)),l=r(1140),d=r(5789);let u=class{constructor(e){this.providerRegistry=e,c.default.info("[GeminiProvider] Initialized"),this.providerRegistry.registerProvider(this)}getId(){return d.GEMINI_PROVIDER_ID}getName(){return"Google Gemini"}getMetadata(){return{website:"https://ai.google.dev/",docs_link:"https://ai.google.dev/docs"}}requiresApiKey(){return!0}getDefaultBaseUrl(){return this.config?.geminiBaseUrl||void 0}getDefaultModelId(){return d.DEFAULT_GEMINI_MODEL_ID}getApiKeyName(){return"GOOGLE_API_KEY"}setConfig(e){this.config=e}getModelClient(e){const t={...e,baseUrl:this.config?.geminiBaseUrl||e.baseUrl},r=new l.GeminiModelClient(t,{enableCaching:!1!==this.config?.enableCaching,cacheTtlSeconds:this.config?.cacheTtlSeconds||900});return this.discoverModels(e.apiKey,t.baseUrl).then((t=>{const n=t.find((t=>t.modelId===e.modelId));n?r.setModelMetadata(n):c.default.warn(`[GeminiProvider] Metadata not found for model ${e.modelId} during client creation.`)})).catch((t=>{c.default.warn(`[GeminiProvider] Failed to discover models for client ${e.modelId}: ${t.message}`)})),r}async discoverModels(e,t){return(0,d.discoverGeminiModels)(e,t)}};t.GeminiProvider=u,t.GeminiProvider=u=n([(0,s.Injectable)(),o("design:paramtypes",[a.ProviderRegistry])],u)},1943:e=>{"use strict";e.exports=require("fs/promises")},1983:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ComputerToolMac=void 0;const c=r(1569),l=r(5317),d=r(9023),u=r(3903),f=s(r(943)),p=a(r(3864)),h=s(r(9896)),g=s(r(6928)),m=r(7751),y=r(7650),v=a(r(9055)),_=(0,d.promisify)(l.exec);class w extends m.ComputerToolBase{validateParams(e){return c.z.object({action:c.z.enum(["key","type","mouse_move","left_click","left_click_drag","right_click","middle_click","double_click","screenshot","cursor_position"]),text:c.z.string().optional(),coordinate:c.z.array(c.z.number()).length(2).optional()}).parse(e)}constructor(){super(),this.screenshotDelay=2,this.scalingEnabled=!0,this.outputDir="/tmp/outputs",this.kpKeys=new Set(["arrow-down","arrow-left","arrow-right","arrow-up","brightness-down","brightness-up","delete","end","enter","esc","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","f13","f14","f15","f16","fwd-delete","home","keys-light-down","keys-light-toggle","keys-light-up","mute","num-0","num-1","num-2","num-3","num-4","num-5","num-6","num-7","num-8","num-9","num-clear","num-divide","num-enter","num-equals","num-minus","num-multiply","num-plus","page-down","page-up","play-next","play-pause","play-previous","return","space","tab","volume-down","volume-up"]),v.default.info("Initializing ComputerToolMac"),(0,p.default)("cliclick").then((function(e){v.default.info("cliclick command found")})).catch((function(){const e="cliclick is not installed. Please install it via Homebrew: brew install cliclick";throw v.default.error(e),new Error(e)})),(0,p.default)("convert").then((function(e){v.default.info("ImageMagick convert command found")})).catch((function(){const e="ImageMagick is not installed. Please install it via Homebrew: brew install imagemagick";throw v.default.error(e),new Error(e)}))}async execute(e){v.default.info(`Executing ComputerToolMac command: ${JSON.stringify(e)}`);try{const t=this.validateParams(e);v.default.info(`Parameters validated successfully: ${JSON.stringify(t)}`);const{action:r,text:n,coordinate:o}=t;let i;switch(r){case"mouse_move":case"left_click_drag":if(!o)throw new y.ToolError(`coordinate is required for ${r}`);const[e,t]=o,s=Math.round(e/this.scale),a=Math.round(t/this.scale);if(v.default.info(`Adjusted coordinates for scale factor (${this.scale}): (${s}, ${a})`),"mouse_move"===r)i=await this.executeCommands([`m:${s},${a}`]);else{const e=[`dd:${s},${a}`,`du:${s},${a}`];i=await this.executeCommands(e)}break;case"key":if(!n)throw new y.ToolError(`text is required for ${r}`);i=await this.pressKey(n);break;case"type":if(!n)throw new y.ToolError(`text is required for ${r}`);i=await this.typeText(n);break;case"left_click":case"right_click":case"middle_click":case"double_click":i=await this.clickAction(r);break;case"screenshot":return i=await this.screenshot(),[{type:"image_url",image_url:{url:`data:image/png;base64,${i.base64_image}`}}];case"cursor_position":i=await this.getCursorPosition();break;default:throw new y.ToolError(`Invalid action: ${r}`)}return i.output}catch(e){return e instanceof y.ToolError?(v.default.error("Tool error in ComputerToolMac",{error:e.message,stack:e.stack}),`Error: ${e.message}`):(v.default.error("Unexpected error in ComputerToolMac",{error:e instanceof Error?e.stack:String(e)}),`Unexpected error: ${e}`)}}async typeText(e){v.default.info(`Typing text: ${e}`);const t=["-w 200"];t.push(`t:${f.quote([e])}`),v.default.info(`Built commands for typing text: ${t.join(" ")}`);return await this.executeCommands(t)}async pressKey(e){v.default.info(`Pressing key: ${e}`);const{modifiers:t,key:r}=this.parseKeyCommand(e),n=["-w 200"];for(const e of t)v.default.info(`Key down modifier: ${e}`),n.push(`kd:${e}`);if(this.kpKeys.has(r))v.default.info(`Pressing special key with kp: ${r}`),n.push(`kp:${r}`);else{if(1!==r.length)throw new y.ToolError(`Invalid key: ${r}`);v.default.info(`Typing key with t: ${r}`),n.push(`t:${f.quote([r])}`)}for(const e of t.reverse())v.default.info(`Key up modifier: ${e}`),n.push(`ku:${e}`);v.default.info(`Built commands for key press: ${n.join(" ")}`);return await this.executeCommands(n)}async clickAction(e){const t={left_click:"c:.",right_click:"rc:.",middle_click:"mc:.",double_click:"dc:."}[e];if(!t)throw new y.ToolError(`Invalid click action: ${e}`);const r=["-w 200",t];return await this.executeCommands(r)}async getCursorPosition(){const e=await this.executeCommands(["p:."],!1),t=e.output?.trim()||"",r=t.match(/(\d+),(\d+)/);if(!r)throw new y.ToolError(`Failed to parse cursor position: ${t}`);const n=parseInt(r[1],10),o=parseInt(r[2],10);return new y.ToolResult(`X=${n},Y=${o}`,"")}async screenshot(){v.default.info("Taking screenshot"),v.default.info(`Ensuring output directory exists: ${this.outputDir}`),h.mkdirSync(this.outputDir,{recursive:!0});const e=g.join(this.outputDir,`screenshot_${(0,u.v4)().replace(/-/g,"")}.png`);v.default.info(`Screenshot will be saved to: ${e}`);const t=`screencapture -x ${e}`;v.default.info("Executing screenshot command",{cmd:t});const r=await _(t,{shell:"/bin/bash"});let n=this.width,o=this.height;if(null==n||null==o){const t=`magick identify -format "%w %h" ${e}`;v.default.info(`Executing identify command to get image dimensions: ${t}`);const r=await _(t,{shell:"/bin/bash"}),[i,s]=r.stdout.trim().split(" ");n=parseInt(i,10),o=parseInt(s,10),this.width=n,this.height=o}const i=`magick ${e} -resize ${Math.floor(n*this.scale)}x${Math.floor(o*this.scale)}! ${e}`;if(v.default.info(`Executing resize command: ${i}`),await _(i,{shell:"/bin/bash"}),h.existsSync(e)){const t=h.readFileSync(e).toString("base64");return new y.ToolResult("","",t)}throw new y.ToolError(`Failed to take screenshot: ${r.stderr}`)}async executeCommands(e,t=!0){v.default.info(`Executing commands: ${e.join(" ")}`);const r=`cliclick ${e.join(" ")}`;v.default.info(`Final cliclick command: ${r}`);try{const{stdout:e,stderr:n}=await _(r,{shell:"/bin/bash"});e&&v.default.info(`Command produced stdout output: ${e}`),n&&v.default.warn(`Command produced stderr output: ${n}`);let o=null;return t&&(v.default.info(`Waiting ${this.screenshotDelay} seconds before taking screenshot`),await new Promise((e=>setTimeout(e,1e3*this.screenshotDelay))),o=(await this.screenshot()).base64_image),v.default.info("Commands executed successfully",{hasOutput:!!e,hasScreenshot:!!o}),new y.ToolResult(e,n,o)}catch(e){throw v.default.error(`Command execution failed: ${e instanceof Error?e.stack:String(e)}`),e}}parseKeyCommand(e){const t=e.toLowerCase().split("+"),r=t.pop(),n={cmd:"cmd",command:"cmd",ctrl:"ctrl",control:"ctrl",alt:"alt",option:"alt",fn:"fn",shift:"shift"},o=t.map((e=>{const t=n[e];if(!t)throw new y.ToolError(`Invalid modifier key: ${e}`);return t}));if(this.kpKeys.has(r))return{modifiers:o,key:r};if(1===r.length&&/^[a-z0-9]$/.test(r))return{modifiers:o,key:r};throw new y.ToolError(`Invalid key: ${r}`)}}t.ComputerToolMac=w},1986:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AnthropicProvider=void 0;const o=r(646),i=r(8483),s=r(8959),a=r(2368),c=r(2088),l=n(r(8938));class d extends i.BaseProvider{getMaxTokens(e){return e.endsWith(d.SONNET_MODEL_NAME)||e.endsWith(d.OPUS_MODEL_NAME)?8192:e.endsWith(d.HAIKU_MODEL_NAME)?4096:8192}getName(){return"anthropic"}getBaseChatModel(e,t){var r=this.getMaxTokens(e),n=null,i=t.temperature;t.thinkingBudget>0&&e.endsWith(d.SONNET_MODEL_NAME)&&(r+=t.thinkingBudget,n={type:"enabled",budget_tokens:t.thinkingBudget},i=null),console.log("Max tokens input:",r);return new o.ChatAnthropic({modelName:this.shortModelName(e),temperature:i,anthropicApiKey:a.ConfigService.getInstance().getProperty("ANTHROPIC_API_KEY"),maxTokens:r,thinking:n,anthropicApiUrl:process.env.ANTHROPIC_API_URL||"https://api.anthropic.com",clientOptions:{defaultHeaders:{"anthropic-beta":"prompt-caching-2024-07-31"}}})}async getModelDescriptors(){0===d.modelCache.models.length&&await this.fetchModels();return d.modelCache.models.map((e=>{const t=d.MODEL_COSTS[e.id]||{input:0,output:0};return new s.ModelDescriptor("anthropic",e.id,t.input,0,0,t.output,e.id===d.SONNET_MODEL_NAME)}))}isValid(){return!!a.ConfigService.getInstance().getProperty("ANTHROPIC_API_KEY")}async fetchModels(){if(!this.isValid())return[];const e=Date.now();if(d.modelCache.models.length>0&&e-d.modelCache.timestamp<3e5)return d.modelCache.models;const t=a.ConfigService.getInstance().getProperty("ANTHROPIC_API_KEY");if(!t)return console.log("Anthropic API key not found"),[];try{const r=process.env.ANTHROPIC_API_URL||"https://api.anthropic.com",n=await l.default.get(`${r}/v1/models`,{headers:{"x-api-key":t,"anthropic-version":"2023-06-01"}});if(200===n.status){const t=n.data.data||[];return d.modelCache={models:t,timestamp:e},t}return console.log(`Failed to fetch Anthropic models. Status code: ${n.status}`),[]}catch(e){return console.error(`Error fetching Anthropic models: ${e}`),[]}}getChatModelOptions(e,t){const r=this.getExtraHeaders(e.name,t),n=this.getExtraSystemMessageKwargs(e.name,t);return new c.ChatModelOptions(r,n)}getExtraHeaders(e,t){return this.isPromptCachingEnabled(t)?{"anthropic-beta":"prompt-caching-2024-07-31"}:null}getExtraSystemMessageKwargs(e,t){return this.isPromptCachingEnabled(t)?{cache_control:{type:"ephemeral"}}:null}}t.AnthropicProvider=d,d.SONNET_MODEL_NAME="claude-3-7-sonnet-20250219",d.OPUS_MODEL_NAME="claude-3-opus-20240229",d.HAIKU_MODEL_NAME="claude-3-haiku-20240307",d.modelCache={models:[],timestamp:0},d.MODEL_COSTS={"claude-3-7-sonnet-20250219":{input:225e-8,output:1125e-8},"claude-3-5-sonnet-20241022":{input:225e-8,output:1125e-8},"claude-3-opus-20240229":{input:1125e-8,output:5625e-8},"claude-3-haiku-20240307":{input:1.875e-7,output:9.375e-7}}},1991:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TaskHistoryController=void 0;const a=r(3563),c=r(6647),l=r(9668),d=s(r(9055));let u=class{constructor(e,t){this.taskHistoryService=e,this.userService=t}async getTaskSummaries(e,t,r){try{const e=await this.userService.getCurrentUser();d.default.debug(`Received request for task summaries from user ${e.userId} with limit ${t||"default"} and workspace ${r||"all"}`);return await this.taskHistoryService.getTaskSummaries(e.userId,t,r)}catch(e){if(e instanceof l.AuthenticationError)throw d.default.error(`[TaskHistoryController] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw d.default.error(`Error in getTaskSummaries endpoint: ${e.message}`,e.stack),e}}async getTaskEvents(e,t){try{const e=await this.userService.getCurrentUser();d.default.debug(`Received request for events of task ${t} from user ${e.userId}`);return await this.taskHistoryService.getTaskEvents(t,e.userId)}catch(e){if(e instanceof l.AuthenticationError)throw d.default.error(`[TaskHistoryController] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw d.default.error(`Error in getTaskEvents endpoint: ${e.message}`,e.stack),e}}};t.TaskHistoryController=u,n([(0,a.Get)("/summaries"),i(0,(0,a.Request)()),i(1,(0,a.Query)("limit")),i(2,(0,a.Query)("workspace")),o("design:type",Function),o("design:paramtypes",[Object,Number,String]),o("design:returntype",Promise)],u.prototype,"getTaskSummaries",null),n([(0,a.Get)("/:taskId/events"),i(0,(0,a.Request)()),i(1,(0,a.Param)("taskId")),o("design:type",Function),o("design:paramtypes",[Object,String]),o("design:returntype",Promise)],u.prototype,"getTaskEvents",null),t.TaskHistoryController=u=n([(0,a.Controller)("/eve-agent/task-history"),o("design:paramtypes",[c.TaskHistoryService,l.UserService])],u)},2003:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AgentConfig=void 0;t.AgentConfig=class{constructor(e,t=0,r,n=!0,o,i=0){this.model=e,this.temperature=t,this.recursionLimit=r,this.cachePrompt=n,this.privateModelsRequired=o,this.thinkingBudget=i}}},2083:e=>{"use strict";e.exports=require("tree-sitter-ruby")},2088:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatModel=t.ChatModelOptions=void 0;class r{constructor(e=null,t=null,r=!0){this.extraHeaders=e,this.extraSystemMessageKwargs=t,this.systemPromptSupported=r}}t.ChatModelOptions=r;t.ChatModel=class{constructor(e,t,n=new r){this.modelDescriptor=e,this.baseChatModel=t,this.options=n}calculateCost(e,t,r,n){const o=this.modelDescriptor;return e*o.costPerInputToken+t*o.costPerCacheWriteToken+r*o.costPerCacheReadToken+n*o.costPerOutputToken}}},2097:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HyperbolicProvider=void 0;const n=r(6228),o=r(8483),i=r(8959),s=r(2368);class a extends o.BaseProvider{getName(){return a.PROVIDER_NAME}getBaseChatModel(e,t){return new n.ChatOpenAI({modelName:this.shortModelName(e),temperature:t.temperature,openAIApiKey:s.ConfigService.getInstance().getProperty("HYPERBOLIC_API_KEY"),configuration:{baseURL:"https://api.hyperbolic.ai/v1"}})}async getModelDescriptors(){return a.LIST_OF_MODELS.map((e=>new i.ModelDescriptor(a.PROVIDER_NAME,e,0,0,0,0)))}isValid(){return!!s.ConfigService.getInstance().getProperty("HYPERBOLIC_API_KEY")}}t.HyperbolicProvider=a,a.QWEN_2_5_CODER_32B_INSTRUCT="Qwen/Qwen2.5-Coder-32B-Instruct",a.QWEN_2_5_72B_INSTRUCT="Qwen/Qwen2.5-72B-Instruct",a.DEEPSEEK_V2_5="deepseek-ai/DeepSeek-V2.5",a.META_LLAMA_3_1_405B_INSTRUCT="meta-llama/Meta-Llama-3.1-405B-Instruct",a.META_LLAMA_3_1_8B_INSTRUCT="meta-llama/Meta-Llama-3.1-8B-Instruct",a.PROVIDER_NAME="hyperbolic",a.LIST_OF_MODELS=[a.QWEN_2_5_CODER_32B_INSTRUCT,a.QWEN_2_5_72B_INSTRUCT,a.DEEPSEEK_V2_5,a.META_LLAMA_3_1_405B_INSTRUCT,a.META_LLAMA_3_1_8B_INSTRUCT]},2115:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.McpHubService=void 0;const a=r(3563),c=r(9102),l=s(r(9055));let d=n=class{constructor(e){this.configService=e,this.connections=new Map,l.default.info(`[${n.name}] McpHubService initialized`)}async callTool(e,t,r){return l.default.info(`[${n.name}] Calling tool ${t} on server ${e}`),{result:`Mock result from tool ${t} on server ${e}`,args:r}}async readResource(e,t){return l.default.info(`[${n.name}] Reading resource ${t} from server ${e}`),{content:`Mock content from resource ${t} on server ${e}`}}async listTools(e){return l.default.info(`[${n.name}] Listing tools on server ${e}`),[{name:"mock_tool_1",description:"A mock tool"},{name:"mock_tool_2",description:"Another mock tool"}]}async listResources(e){return l.default.info(`[${n.name}] Listing resources on server ${e}`),[{uri:"mock://resource/1",description:"A mock resource"},{uri:"mock://resource/2",description:"Another mock resource"}]}};t.McpHubService=d,t.McpHubService=d=n=o([(0,a.Injectable)(),i("design:paramtypes",[c.EveConfigService])],d)},2123:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(6308),t),o(r(7001),t),o(r(9560),t),o(r(7890),t)},2141:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FileSystemService=void 0;const u=r(3563),f=c(r(1943)),p=c(r(6928)),h=r(8474),g=d(r(9055)),m=r(7526),y=r(1346),v=r(5266);let _=o=class{constructor(e,t){this.workspaceService=e,this.ignoreConfigService=t,g.default.info(`[${o.name}] FileSystemService initialized`)}resolvePath(e,t){const r=p.resolve(t,e);if(!r.startsWith(t)){const r=`Path traversal attempt detected: ${e} resolves outside of base directory ${t}`;throw g.default.error(`[${o.name}] ${r}`),new Error(r)}return r}async getWorkspaceFileList(e,t={}){g.default.debug(`[${o.name}] Getting workspace file list for: ${e}`);try{const r=new y.FileScanner(e),n=[v.FileFiltersFactory.defaultRootIgnoreFilter(),this.ignoreConfigService.createGitIgnoreFilter(e),this.ignoreConfigService.createEveIgnoreFilter(e)];!1!==t.applyInclude&&n.push(this.ignoreConfigService.createEveIncludeFilter(e)),t.limit&&n.push(v.FileFiltersFactory.limitFilter({maxItems:t.limit}));const{nodes:o,stats:i,truncated:s}=await r.collect(".",n);return{files:o.map((e=>e.path+(e.isDir?"/":""))),truncated:s,stats:{totalFiles:i.nodesScanned,includedFiles:i.nodesIncluded,estimatedTokens:i.estimatedTokens}}}catch(t){return g.default.error(`[${o.name}] Error getting workspace file list for ${e}: ${t.message}\n${t.stack}`),{files:[],truncated:!1,stats:{totalFiles:0,includedFiles:0,estimatedTokens:0}}}}async listDirectoryTree(e,t=".",r=1,n="standard"){g.default.info(`listing directory tree for: ${t}`);try{const i=new y.FileScanner(e),s=[v.FileFiltersFactory.depthFilter(r),this.ignoreConfigService.createGitIgnoreFilter(e),this.ignoreConfigService.createEveIgnoreFilter(e)];"standard"===n&&s.push(this.ignoreConfigService.createEveIncludeFilter(e)),"show_ignored"===n&&g.default.warn(`[${o.name}] show_ignored mode not fully implemented yet`);const{nodes:a,stats:c,truncated:l}=await i.collect(t,s);return{tree:this.convertToTreeStructure(a),truncated:l,stats:{totalNodes:c.nodesScanned,includedNodes:c.nodesIncluded}}}catch(t){return g.default.error(`[${o.name}] Error getting directory tree for ${e}: ${t.message}\n${t.stack}`),{tree:[],truncated:!1,stats:{totalNodes:0,includedNodes:0}}}}async getWorkspaceFileListForLLM(e,t={}){try{const r=[100,50,20,10,5];let n;n=void 0===t.maxFilesPerDirectory?r:Array.isArray(t.maxFilesPerDirectory)?t.maxFilesPerDirectory:[t.maxFilesPerDirectory];const i=[v.FileFiltersFactory.defaultRootIgnoreFilter(),this.ignoreConfigService.createGitIgnoreFilter(e),this.ignoreConfigService.createEveIgnoreFilter(e),this.ignoreConfigService.createEveIncludeFilter(e)];for(let r=0;r<n.length;r++){const s=n[r],a=new y.FileScanner(e),{nodes:c,truncationMarkers:l,stats:d,truncated:u}=await a.collectForLLM({maxTokens:t.maxTokens||5e4,maxItems:t.maxFiles||1e3,maxBytes:t.maxBytes,maxFilesPerDirectory:s,sortByPath:!0},i);if(!u||r===n.length-1)return{files:c,truncationMarkers:l,stats:{totalFiles:d.nodesScanned,includedFiles:c.length,estimatedTokens:d.estimatedTokens,truncated:u}};g.default.debug(`[${o.name}] File list truncated with maxFilesPerDirectory=${s}, retrying with ${n[r+1]}`)}throw new Error("Unexpected code path in getWorkspaceFileListForLLM")}catch(t){return g.default.error(`[${o.name}] Error getting workspace file list for LLM for ${e}: ${t.message}\n${t.stack}`),{files:[],truncationMarkers:[],stats:{totalFiles:0,includedFiles:0,estimatedTokens:0,truncated:!1}}}}convertToTreeStructure(e){const t=e=>"."===e||""===e?e:e.replace(/\/+$/,""),r=[],n=new Map;let o="";if(e.length){const r=e.map((e=>t(e.path))).sort(((e,t)=>e.length-t.length));o=r[0]}for(const r of e){const e=t(r.path),o=e.split("/").filter(Boolean),i={name:o.length?o[o.length-1]:".",path:e,type:r.isDir?"dir":"file",sizeBytes:r.sizeBytes};r.isDir&&(i.hasChildren=!0,i.children=[]),n.set(e,i)}for(const[e,i]of n){if(e===o&&"."!==o&&""!==o)continue;if("."===e||""===e){r.push(i);continue}const s=e.split("/").filter(Boolean);if(1===s.length)r.push(i);else{const e=t(s.slice(0,-1).join("/")),o=n.get(e);o&&o.children?o.children.push(i):r.push(i)}}const i=(e,t)=>"dir"===e.type&&"dir"!==t.type?-1:"dir"!==e.type&&"dir"===t.type?1:e.name.localeCompare(t.name);let s;if("."===o||""===o)s=r.filter((e=>"."!==e.path&&""!==e.path)).sort(i);else{const e=n.get(o);s=e&&e.children&&e.children.length>0?[...e.children].sort(i):r.filter((e=>"."!==e.path&&""!==e.path&&e.path!==o)).sort(i)}const a=e=>{for(const t of e)t.children&&t.children.length&&(t.children.sort(i),a(t.children))};return a(s),s}async fileExists(e){try{return(await f.stat(e)).isFile()}catch(e){return!1}}async directoryExists(e){try{return(await f.stat(e)).isDirectory()}catch(e){return!1}}async getIgnoredFilesCached(e){g.default.debug(`[${o.name}] Getting ignored files for: ${e}`);try{const t=new y.FileScanner(e),r=[this.ignoreConfigService.createGitIgnoreFilter(e),this.ignoreConfigService.createEveIgnoreFilter(e)],n=(await t.collect(".",[])).nodes,o={rootPath:e,currentDepth:0,stats:{nodesScanned:0,nodesIncluded:0,bytesScanned:0,bytesIncluded:0,estimatedTokens:0}},i=new Set;for(const t of n){let n=!1;for(const e of r){if("exclude"===await e(t,o)){n=!0;break}}if(n){const r=p.resolve(e,t.path);i.add(r)}}return i}catch(t){return g.default.error(`[${o.name}] Error getting ignored files for ${e}: ${t.message}\n${t.stack}`),new Set}}};t.FileSystemService=_,t.FileSystemService=_=o=a([(0,u.Injectable)(),l("design:paramtypes",[h.WorkspaceService,m.IgnoreConfigService])],_)},2177:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentsModule=void 0;const o=r(3563),i=r(3520),s=r(9449),a=r(5017),c=r(3887),l=r(5610),d=r(6695),u=r(2424),f=r(361),p=r(7307),h=r(3690),g=r(8471),m=r(3470),y=r(5025),v=r(7223),_=r(1263),w=r(5591),b=r(6651),k=r(5873),S=r(3880),R=r(4193),T=r(9161),$=r(376),O=r(7967),P={provide:"AGENT_SERVICES",useFactory:async(e,t,r,n,o,i,s,a,c)=>{const l=new Map;l.set("se-agent",e),l.set("ops-agent",t),l.set("review-agent",r),l.set("computer-use-agent",n),l.set("private-coder-agent",o),l.set("architect-agent",i),l.set("product-agent",s),l.set("mcp-agent",a);return(await c.loadPlugins()).forEach((e=>{e&&e.getName&&l.set(e.getName(),e)})),l},inject:[a.SEAgentService,c.OpsAgentService,l.ReviewAgentService,d.ComputerUseAgentService,g.PrivateCoderAgentService,v.ArchitectAgentService,_.ProductAgentService,w.MCPAgentService,p.PluginLoaderService]};let E=class{};t.AgentsModule=E,t.AgentsModule=E=n([(0,o.Module)({imports:[u.GraphAgentModule,f.ToolsModule,h.SimpleAgentModule,k.WorkspaceModule,S.SessionModule,R.HomeModule,T.ChatCompletionModule,s.LangchainModule,$.DataSourceModule,O.ConfigModule],controllers:[i.AgentController,b.MCPController],providers:[a.SEAgentService,c.OpsAgentService,l.ReviewAgentService,d.ComputerUseAgentService,g.PrivateCoderAgentService,v.ArchitectAgentService,_.ProductAgentService,w.MCPAgentService,p.PluginLoaderService,m.AgentRuleService,y.AgentRuleRepository,P],exports:[P,m.AgentRuleService]})],E)},2196:e=>{"use strict";e.exports=require("@langchain/mistralai")},2251:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetController=void 0;const s=r(3563),a=r(9556),c=r(6982),l=r(8077),d=r(6696);let u=class{constructor(e,t){this.datasetService=e,this.datasetRetrievalService=t}async getAllDatasets(){return this.datasetService.getAllDatasets()}async getDataset(e){return this.datasetService.getDatasetById(e)}async createDataset(e){if(!e.name.match(/^[a-zA-Z0-9]{3,30}$/))throw new Error("Dataset name must be 3-30 alphanumeric characters with no spaces");return this.datasetService.createDataset(e.name,e.baseDir)}async updateDataset(e,t){await this.datasetService.updateDataset(e,t)}async deleteDataset(e){await this.datasetService.deleteDataset(e)}async getDocuments(e){return this.datasetService.getDocuments(e)}async getDocument(e){return this.datasetService.getDocumentById(e)}async createDocument(e,t){const r=(0,c.createHash)("md5").update(t.buffer).digest("hex");return this.datasetService.createDocument(e,t.originalname,r,t.buffer)}async updateDocumentStatus(e,t){await this.datasetService.updateDocumentStatus(e,t.status)}async deleteDocument(e){await this.datasetService.deleteDocument(e)}async queryDataset(e,t,r){const n=await this.datasetService.getDatasetById(e);return this.datasetRetrievalService.searchDataset(n.name,t,r?parseInt(r,10):void 0)}};t.DatasetController=u,n([(0,s.Get)(),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],u.prototype,"getAllDatasets",null),n([(0,s.Get)(":id"),i(0,(0,s.Param)("id")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"getDataset",null),n([(0,s.Post)(),i(0,(0,s.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],u.prototype,"createDataset",null),n([(0,s.Put)(":id"),i(0,(0,s.Param)("id")),i(1,(0,s.Body)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],u.prototype,"updateDataset",null),n([(0,s.Delete)(":id"),i(0,(0,s.Param)("id")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"deleteDataset",null),n([(0,s.Get)(":datasetId/documents"),i(0,(0,s.Param)("datasetId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"getDocuments",null),n([(0,s.Get)(":datasetId/documents/:id"),i(0,(0,s.Param)("id")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"getDocument",null),n([(0,s.Post)(":datasetId/documents"),(0,s.UseInterceptors)((0,a.FileInterceptor)("file")),i(0,(0,s.Param)("datasetId")),i(1,(0,s.UploadedFile)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],u.prototype,"createDocument",null),n([(0,s.Put)(":datasetId/documents/:id/status"),i(0,(0,s.Param)("id")),i(1,(0,s.Body)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],u.prototype,"updateDocumentStatus",null),n([(0,s.Delete)(":datasetId/documents/:id"),i(0,(0,s.Param)("id")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"deleteDocument",null),n([(0,s.Get)(":id/query"),i(0,(0,s.Param)("id")),i(1,(0,s.Query)("q")),i(2,(0,s.Query)("numResults")),o("design:type",Function),o("design:paramtypes",[String,String,String]),o("design:returntype",Promise)],u.prototype,"queryDataset",null),t.DatasetController=u=n([(0,s.Controller)("datasets"),o("design:paramtypes",[l.DatasetService,d.DatasetRetrievalService])],u)},2267:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PlanModeRespondTool=void 0;const a=r(3563),c=s(r(9055));let l=n=class{constructor(){this.name="plan_mode_respond",this.description="Respond to the user's inquiry in an effort to plan a solution to the user's task.",c.default.info(`[${n.name}] PlanModeRespondTool initialized`)}getUsageInstructions(e){return'## plan_mode_respond\nDescription: Respond to the user\'s inquiry in an effort to plan a solution to the user\'s task. This tool should be used when you need to provide a response to a question or statement from the user about how you plan to accomplish the task. This tool is only available in PLAN MODE. The environment_details will specify the current mode, if it is not PLAN MODE then you should not use this tool. Depending on the user\'s message, you may ask questions to get clarification about the user\'s request, architect a solution to the task, and to brainstorm ideas with the user. For example, if the user\'s task is to create a website, you may start by asking some clarifying questions, then present a detailed plan for how you will accomplish the task given the context, and perhaps engage in a back and forth to finalize the details before the user switches you to ACT MODE to implement the solution.\nParameters:\n- response: (required) The response to provide to the user. Do not try to use tools in this parameter, this is simply a chat response. (You MUST use the response parameter, do not simply place the response text directly within <plan_mode_respond> tags.)\n- options: (optional) An array of 2-5 options for the user to choose from. Each option should be a string describing a possible choice or path forward in the planning process. This can help guide the discussion and make it easier for the user to provide input on key decisions. You may not always need to provide options, but it may be helpful in many cases where it can save the user from having to type out a response manually. Do NOT present an option to toggle to Act mode, as this will be something you need to direct the user to do manually themselves.\nUsage:\n<plan_mode_respond>\n<response>Your response here</response>\n<options>\nArray of options here (optional), e.g. ["Option 1", "Option 2", "Option 3"]\n</options>\n</plan_mode_respond>'}validateParams(e){return"string"==typeof e.response&&""!==e.response.trim()}async execute(e){const{response:t,options:r}=e;return c.default.info(`[${n.name}] Responding in plan mode: ${t.substring(0,50)}...`),{response:t,options:r,success:!0}}};t.PlanModeRespondTool=l,t.PlanModeRespondTool=l=n=o([(0,a.Injectable)(),i("design:paramtypes",[])],l)},2300:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GraphAgentCollaborator=void 0;const s=r(3563),a=r(7373),c=r(1e3),l=r(1412),d=r(1544),u=r(1486),f=i(r(9055)),p=r(6254),h=r(9100),g=r(9234),m=r(8474),y=r(6910),v=r(2368),_=r(538),w=r(3239),b=r(4911);let k=class{constructor(e,t,r,n,o){this.workspaceService=e,this.sessionService=t,this.checkpointerService=r,this.homeService=n,this.summaryCompletion=o,this.chatModelManager=d.ChatModelManager.getInstance()}async processRequest(e,t){f.default.info("Processing request: %s",JSON.stringify(t));const r=this.processRequestStream(e,t);let n=null;for await(const e of r)n=e,f.default.info("Yielded item: %s",JSON.stringify(e));if(!n)throw new Error("No items were yielded from the generator");const o=await this.sessionService.getRequest(n?.requestId);if(!o)throw new Error("Failed to retrieve persisted request");return f.default.info("Returning request: %s",JSON.stringify(o)),o}async*processRequestStream(e,t){const r=(0,h.ulid)();if(!await this.homeService.isAccessOkay()){const e={label:"Error",content:"Access is not valid. Please check your Eve API key and try again."},n=await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:t.sessionId||this.generateSessionId(),label:e.label,content:e.content,createdAt:new Date,requestId:r});return void(yield n)}const n=new Date;t.sessionId||(t.sessionId=this.generateSessionId());const o=await this.chatModelManager.getModel(t.config,e.getModelCategory(),e.isPrivateModelsOnly());let i;t.workspaceName?i=await this.workspaceService.lockByName(t.workspaceName):(i=await this.workspaceService.lockSessionWorkspace(t.sessionId),t.workspaceName=i.name);const s=i.name,a=new g.RequestContext(i,r,t.sessionId);await e.verifyRequest(t,a);let c=!1,d=0,m=0,_=0,w=0,k="";try{const i=l.AgentRequest.getFirstTextContent(t.content),s=await this.sessionService.ensureSession(t.workspaceName,t.sessionId,i,e.getName());await this.sessionService.updateSessionStatus(s.sessionId,"active"),f.default.info("%s received request: %s - %s",e.getName(),r,JSON.stringify(t)),f.default.info("Using model: %s",o.modelDescriptor.getFullName());const h=await e.getTools(a),g=o.baseChatModel.bindTools(h);let b=await e.getSystemPrompt(a);const R=await e.getAgentRules();R&&(b=b+"\n\nAdditional system rules:\n"+R),f.default.info("System prompt length: %s",b.length);const T=v.ConfigService.getNumericProperty(y.ConfigPropNames.AGENT_SYSTEM_PROMPT)||1e5;if(b.length>T)throw f.default.error("System prompt is longer than the maximum allowed length of %s characters - check the system prompt for %s",T,e.getName()),f.default.error("System prompt: %s",b),f.default.error("Consider adding a .eveignore file or updating your .gitignore file to ignore some of the files in the workspace"),new Error(`System prompt is longer than the maximum allowed length of ${T} characters - check logs for more details - you can increase the limit by setting ${y.ConfigPropNames.AGENT_SYSTEM_PROMPT} on the home page`);var S=b;o.options.extraSystemMessageKwargs&&(S=[{type:"text",text:S,...o.options.extraSystemMessageKwargs}],f.default.debug("Using extra system message kwargs",o.options.extraSystemMessageKwargs));const $=this.checkpointerService.getCheckpointer(),O=e.createGraph(g,h,$);await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:t.sessionId,label:"Human",content:i,createdAt:new Date,requestId:r}),await this.sessionService.addRequest({requestId:r,sessionId:t.sessionId,workspaceName:t.workspaceName,requestContent:i,startedAt:n});const P=t.config.recursionLimit||v.ConfigService.getNumericProperty(y.ConfigPropNames.AGENT_RECURSION_LIMIT)||50,E=o.options.extraHeaders?{configurable:{thread_id:t.sessionId},recursionLimit:P,headers:o.options.extraHeaders}:{configurable:{thread_id:t.sessionId},recursionLimit:P};f.default.debug("Call options: %s",JSON.stringify(E));const I=await $.get(E),C=p.MessageUtils.buildHumanMessage(t.content);let A=e.createInitialState();I?A.messages=[C]:o.options.extraSystemMessageKwargs?(f.default.debug("Using extra system message kwargs",o.options.extraSystemMessageKwargs),A.messages=[new u.SystemMessage({content:S,additional_kwargs:o.options.extraSystemMessageKwargs}),C]):o.options.systemPromptSupported?A.messages=[new u.SystemMessage({content:S}),C]:A.messages=[new u.HumanMessage({content:S}),C];const M=await O.stream(A,E);for await(const e of M){f.default.debug("Output Event was: %s",JSON.stringify(e));const n=p.MessageUtils.processOutputEvent(e);f.default.debug("Processed message: %s",n);const i=n.usageMetadata,s=o.calculateCost(i?.inputTokens||0,i?.cacheWriteTokens||0,i?.cacheReadTokens||0,i?.outputTokens||0),a={itemId:this.generateItemId(),sessionId:t.sessionId,label:n.label,content:n.content,createdAt:new Date,inputTokens:n.usageMetadata?.inputTokens,cacheWriteTokens:i?.cacheWriteTokens,cacheReadTokens:i?.cacheReadTokens,outputTokens:i?.outputTokens,totalTokens:i?.totalTokens,cost:s,requestId:r},l=await this.sessionService.addItem(a);d+=i?.inputTokens||0,m+=i?.cacheWriteTokens||0,_+=i?.cacheReadTokens||0,w+=i?.outputTokens||0,k=n.content;const u=await this.sessionService.getSession(t.sessionId);if(c=u&&"aborted"===u.status,c){const e={label:"Error",content:"Session was aborted by the user."},r=await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:t.sessionId,label:e.label,content:e.content,createdAt:new Date});yield r;break}yield l}}catch(e){f.default.error("--------------------------------------------------"),f.default.error("Error processing request in GraphAgentCollaborator:"),f.default.error("Request ID: %s",r),f.default.error("Session ID: %s",t.sessionId),f.default.error("Workspace: %s",t.workspaceName);try{f.default.error("Agent Request Content: %s",JSON.stringify(t.content,null,2))}catch(e){f.default.error("Could not stringify agentRequest.content:",e)}f.default.error("Error Message: %s",e.message),f.default.error("Error Stack:",e.stack||"No stack trace available"),f.default.error("--------------------------------------------------");const n={label:"Error",content:`An error occurred while processing request ${r}: ${e.message}. Please check the server logs for more details.`};if(t.sessionId)try{const e=await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:t.sessionId,label:n.label,content:n.content,createdAt:new Date,requestId:r});yield e}catch(e){f.default.error("Failed to add error item to session %s:",t.sessionId,e)}else f.default.error("Cannot add error item to session because sessionId is missing.")}finally{try{if(!c&&i.isGitRepo){const e=new b.GitCommit(i.repoBaseDir,r,this.sessionService);if(await e.hasUncommittedUpdates()){const t=await e.getUncommittedChanges(),r="Give me a good commit message for the following diff contents - just return the message without quotes",n=await this.summaryCompletion.getSummary(r,t);f.default.info("Detected uncommitted git updates - committing changes with message: "+n),await e._call(n)}}await this.sessionService.updateSessionStatus(t.sessionId,"inactive");const e=o.calculateCost(d,m,_,w),s=new Date,a=s.getTime()-n.getTime(),l=d+m+_+w,u=await this.sessionService.updateRequest(r,{responseContent:k,endedAt:s,tookMillis:a,inputTokens:d,cacheWriteTokens:m,cacheReadTokens:_,outputTokens:w,totalTokens:l,cost:e});await this.homeService.logRequest(u),f.default.info("Agent processing completed in %s seconds - Input tokens: %s, Cache Write tokens: %s, Cache Read tokens: %s, Output tokens: %s, Total tokens: %s, Total cost: £%s",a/1e3,d,m,_,w,l,e.toFixed(6))}finally{s&&await this.workspaceService.unlockByName(s)}}}generateSessionId(){return(0,h.ulid)()}generateItemId(){return(0,h.ulid)()}};t.GraphAgentCollaborator=k,t.GraphAgentCollaborator=k=n([(0,s.Injectable)(),o("design:paramtypes",[m.WorkspaceService,a.SessionService,c.CheckpointerService,_.HomeService,w.SummaryCompletion])],k)},2303:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Mutation=t.MutationType=void 0,function(e){e.CREATE="create",e.UPDATE="update",e.DELETE="delete"}(r||(t.MutationType=r={}));t.Mutation=class{constructor(e,t,r,n,o,i,s,a,c){this.id=e,this.type=t,this.filePath=r,this.description=n,this.fileContentsBefore=o,this.fileContentsAfter=i,this.updatedAt=s,this.sessionId=a,this.requestId=c}}},2325:e=>{"use strict";e.exports=require("jsdom")},2355:e=>{"use strict";e.exports=require("isbinaryfile")},2368:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigService=void 0;const a=r(3563),c=r(5699),l=s(r(9055)),d=r(3713),u=r(6910);let f=n=class{constructor(e){this.configPropertyRepository=e,this.configCache=new Map,this.possibleValuesCache=new Map,n.instance=this,this.cachedDescriptors=d.ConfigDescriptors.getDefaultDescriptors()}static getInstance(){if(!n.instance)throw new Error("ConfigService has not been initialized");return n.instance}static getProperty(e,t){return n.getInstance().getProperty(e,t)}static getNumericProperty(e,t){return n.getInstance().getNumericProperty(e,t)}static getBooleanProperty(e,t){return n.getInstance().getBooleanProperty(e,t)}async onModuleInit(){try{await this.loadConfigToCache()}catch(e){l.default.error(`[${n.name}] Failed to load config properties to cache`,e)}}async loadConfigToCache(){try{const e=await this.configPropertyRepository.getAllProperties();this.configCache.clear();for(const t of e)this.configCache.set(t.name,t.value);l.default.info(`[${n.name}] Config properties loaded to cache successfully`)}catch(e){throw l.default.error(`[${n.name}] Error loading config properties to cache`,e),e}}async getConfig(){const e=new Map,t=[],r=d.ConfigDescriptors.getDefaultDescriptors();for(const t of r.sections)for(const r of t.properties){const t=this.getProperty(r.name);if(null!==t&&e.set(r.name,r.sensitive?this.maskValue(t):t),"function"==typeof r.possibleValues){const e=this.possibleValuesCache.get(r.possibleValues);if(e)r.possibleValues=e;else{const e=await r.possibleValues();this.possibleValuesCache.set(r.possibleValues,e),r.possibleValues=e}}}return null===this.getProperty(u.ConfigPropNames.EVE_API_KEY)&&t.push("You need to set the Eve API Key which you can get from incept5.github.io/eve-web-admin"),null===this.getProperty(u.ConfigPropNames.ANTHROPIC_API_KEY)&&t.push("You need to set the Anthropic API Key which you can get from console.anthropic.com"),{version:"2.3.0",mode:process.env.MODE||"normal",descriptors:r,currentValues:Object.fromEntries(e),requiredActions:t.length>0?t:void 0}}getProperty(e,t){const r=process.env[e];if(void 0!==r)return r;const o=this.configCache.get(e);if(void 0!==o)return o;const i=this.findDescriptor(e);return i?i?.defaultValue?i.defaultValue.toString():t||null:(l.default.warn(`[${n.name}] Unknown property: ${e}`),null)}getNumericProperty(e,t){const r=this.getProperty(e);return null!==r?parseFloat(r):t||null}getBooleanProperty(e,t){const r=this.getProperty(e);return null!==r?"true"===r.toLowerCase():t||null}findDescriptor(e){for(const t of this.cachedDescriptors.sections){const r=t.properties.find((t=>t.name===e));if(r)return r}}async setProperty(e,t){try{t?(await this.configPropertyRepository.setProperty(e,t),this.configCache.set(e,t)):await this.unsetProperty(e)}catch(t){throw l.default.error(`[${n.name}] Error setting property ${e}`,t),t}}async unsetProperty(e){try{await this.configPropertyRepository.deleteProperty(e),this.configCache.delete(e)}catch(t){throw l.default.error(`[${n.name}] Error unsetting property ${e}`,t),t}}async getAllProperties(){return Array.from(this.configCache.entries()).map((([e,t])=>({name:e,value:t})))}maskValue(e){if(!e)return"not set";if(e.length<20)return"*".repeat(e.length);const t=e.length-8-4;return e.slice(0,8)+"*".repeat(t)+e.slice(-4)}};t.ConfigService=f,t.ConfigService=f=n=o([(0,a.Injectable)(),i("design:paramtypes",[c.ConfigPropertyRepository])],f)},2385:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RepoRulesController=void 0;const a=r(3563),c=r(6170),l=s(r(9055)),d=r(8474);let u=class{constructor(e,t){this.rulesService=e,this.workspaceService=t}async getRepoRuleContent(e,t){if(!e||!t)throw new a.BadRequestException("Workspace and path are required");const r=await this.workspaceService.findOne(e);if(!r)throw new a.NotFoundException(`Workspace ${e} not found`);const n=r.repoBaseDir;l.default.debug(`[RepoRulesController] Getting content for repo rule in workspace: ${e}`),l.default.debug(`[RepoRulesController] Workspace directory path: ${n}`),l.default.debug(`[RepoRulesController] Rule path: ${t}`);const o=await this.rulesService.getRepoRuleContent(n,t);return l.default.debug(`[RepoRulesController] Content retrieved for repo rule: ${t}`),o}async updateRepoRuleContent(e,t,r){if(!e||!t)throw new a.BadRequestException("Workspace and path are required");const n=await this.workspaceService.findOne(e);if(!n)throw new a.NotFoundException(`Workspace ${e} not found`);const o=n.repoBaseDir;return l.default.debug(`[RepoRulesController] Updating repo rule in workspace: ${e}`),l.default.debug(`[RepoRulesController] Workspace directory path: ${o}`),l.default.debug(`[RepoRulesController] Rule path: ${t}`),await this.rulesService.updateRepoRuleContent(o,t,r.content),l.default.debug(`[RepoRulesController] Content updated for repo rule: ${t}`),{success:!0}}async createRepoRule(e,t){if(!e)throw new a.BadRequestException("Workspace is required");if(!t.name)throw new a.BadRequestException("Name is required");const r=await this.workspaceService.findOne(e);if(!r)throw new a.NotFoundException(`Workspace ${e} not found`);const n=r.repoBaseDir;l.default.debug(`[RepoRulesController] Creating new repo rule in workspace: ${e}`),l.default.debug(`[RepoRulesController] Workspace directory path: ${n}`),l.default.debug(`[RepoRulesController] Rule name: ${t.name}`);const o=await this.rulesService.createRepoRule(n,t.name,t.content||"",e);return l.default.debug(`[RepoRulesController] Rule created: ${t.name}`),o}async deleteRepoRule(e,t){if(!e||!t)throw new a.BadRequestException("Workspace and path are required");const r=await this.workspaceService.findOne(e);if(!r)throw new a.NotFoundException(`Workspace ${e} not found`);const n=r.repoBaseDir;return l.default.debug(`[RepoRulesController] Deleting repo rule in workspace: ${e}`),l.default.debug(`[RepoRulesController] Workspace directory path: ${n}`),l.default.debug(`[RepoRulesController] Rule path: ${t}`),await this.rulesService.deleteRepoRule(n,t),l.default.debug(`[RepoRulesController] Rule deleted: ${t}`),{success:!0}}};t.RepoRulesController=u,n([(0,a.Get)(":workspace/:path"),i(0,(0,a.Param)("workspace")),i(1,(0,a.Param)("path")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],u.prototype,"getRepoRuleContent",null),n([(0,a.Put)(":workspace/:path"),i(0,(0,a.Param)("workspace")),i(1,(0,a.Param)("path")),i(2,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,String,Object]),o("design:returntype",Promise)],u.prototype,"updateRepoRuleContent",null),n([(0,a.Post)(":workspace"),i(0,(0,a.Param)("workspace")),i(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],u.prototype,"createRepoRule",null),n([(0,a.Delete)(":workspace/:path"),i(0,(0,a.Param)("workspace")),i(1,(0,a.Param)("path")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],u.prototype,"deleteRepoRule",null),t.RepoRulesController=u=n([(0,a.Controller)("repo-rules"),o("design:paramtypes",[c.RulesService,d.WorkspaceService])],u)},2397:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceController=void 0;const s=r(3563),a=r(8474);let c=class{constructor(e){this.workspaceService=e}async unlock(e){return this.workspaceService.unlockByName(e)}async findAll(e){const t="true"===e;return this.workspaceService.findAll(t)}async findOne(e){return this.workspaceService.findOne(e)}async create(e){return this.workspaceService.createWorkspace(e)}async update(e,t){return this.workspaceService.updateWorkspace(e,t)}async remove(e){return this.workspaceService.removeWorkspace(e)}};t.WorkspaceController=c,n([(0,s.Post)(":name/unlock"),i(0,(0,s.Param)("name")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],c.prototype,"unlock",null),n([(0,s.Get)(),i(0,(0,s.Query)("isTemp")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],c.prototype,"findAll",null),n([(0,s.Get)(":name"),i(0,(0,s.Param)("name")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],c.prototype,"findOne",null),n([(0,s.Post)(),i(0,(0,s.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],c.prototype,"create",null),n([(0,s.Patch)(":name"),i(0,(0,s.Param)("name")),i(1,(0,s.Body)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],c.prototype,"update",null),n([(0,s.Delete)(":name"),i(0,(0,s.Param)("name")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],c.prototype,"remove",null),t.WorkspaceController=c=n([(0,s.Controller)("workspace"),o("design:paramtypes",[a.WorkspaceService])],c)},2398:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolProvider=void 0;const a=r(3563),c=s(r(9055));let l=n=class{constructor(){this.toolFactories=new Map,c.default.info(`[${n.name}] ToolProvider initialized`)}registerToolFactory(e){const t=e.getToolName();c.default.info(`[${n.name}] Registering tool factory for: ${t}`),this.toolFactories.set(t,e)}getTools(e,t){return c.default.debug(`[${n.name}] Creating tools...`),e.filter((e=>this.toolFactories.has(e))).map((e=>this.toolFactories.get(e).create(t)))}getAllToolFactories(){return Array.from(this.toolFactories.values())}getToolFactory(e){return this.toolFactories.get(e)}};t.ToolProvider=l,t.ToolProvider=l=n=o([(0,a.Injectable)(),i("design:paramtypes",[])],l)},2410:e=>{"use strict";e.exports=require("glob")},2424:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.GraphAgentModule=void 0;const o=r(3563),i=r(2300),s=r(5873),a=r(3880),c=r(9449),l=r(3177),d=r(4193),u=r(9161);let f=class{};t.GraphAgentModule=f,t.GraphAgentModule=f=n([(0,o.Module)({imports:[s.WorkspaceModule,a.SessionModule,c.LangchainModule,l.MutationsModule,d.HomeModule,u.ChatCompletionModule],providers:[i.GraphAgentCollaborator],exports:[i.GraphAgentCollaborator]})],f)},2434:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GitUtils=void 0;const c=s(r(9896)),l=s(r(6928)),d=a(r(9055));class u{static ensureGitignoreExists(e){const t=l.join(e,".gitignore");return!c.existsSync(t)&&(d.default.info("No .gitignore file found, creating one with default patterns"),c.writeFileSync(t,this.DEFAULT_GITIGNORE),!0)}}t.GitUtils=u,u.DEFAULT_GITIGNORE="# Dependencies\nnode_modules/\n.pnpm-store/\nvenv/\npackage-lock.json\nyarn.lock\n\n# Build outputs\ndist/\nbuild/\ntarget/\n*.class\n*.jar\n*.war\n\n# IDEs and editors\n.idea/\n.vscode/\n*.swp\n*.swo\n.project\n.classpath\n.settings/\n\n# Logs and databases\n*.log\nlogs/\n*.sqlite\n*.db\n\n# Environment variables\n.env\n.env.*\n!.env.example\n\n# Testing\ncoverage/\n.nyc_output/\n\n# Temporary files\ntmp/\ntemp/\n.DS_Store\nThumbs.db\n\n# Compiled output\n*.pyc\n__pycache__/\n*.o\n*.so\n\n# Package files\n*.tgz\n*.zip\n*.tar.gz\n\n# Secrets\n*.pem\n*.key\n*.cert\n*.p12\n\n# Project specific\n.turbo/\n.cache/\n"},2597:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EveAgentController=void 0;const a=r(3563),c=s(r(9055)),l=r(5369),d=r(6550),u=r(9668);let f=class{constructor(e,t,r){this.apiHandlerFactory=e,this.taskService=t,this.userService=r}async getStatus(){try{return await this.userService.getCurrentUser(),{status:"ok",version:"0.1.0"}}catch(e){if(e instanceof u.AuthenticationError)throw c.default.error(`[EveAgentController] Authentication error in getStatus: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw c.default.error(`[EveAgentController] Error in getStatus: ${e.message}`,e.stack),e}}async createTask(e){try{await this.userService.getCurrentUser();return{success:!0,taskId:await this.taskService.createTask(e)}}catch(e){if(e instanceof u.AuthenticationError)throw c.default.error(`[EveAgentController] Authentication error in createTask: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw c.default.error(`[EveAgentController] Error in createTask: ${e.message}`,e.stack),e}}async getTask(e){try{await this.userService.getCurrentUser();return{success:!0,task:await this.taskService.getTask(e)}}catch(e){if(e instanceof u.AuthenticationError)throw c.default.error(`[EveAgentController] Authentication error in getTask: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw c.default.error(`[EveAgentController] Error in getTask: ${e.message}`,e.stack),e}}async getTaskSteps(e){try{await this.userService.getCurrentUser();return{success:!0,steps:await this.taskService.getTaskSteps(e)}}catch(e){if(e instanceof u.AuthenticationError)throw c.default.error(`[EveAgentController] Authentication error in getTaskSteps: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw c.default.error(`[EveAgentController] Error in getTaskSteps: ${e.message}`,e.stack),e}}async getUserTasks(e,t="10",r="0"){try{const n=await this.userService.getCurrentUser();e!==n.userId&&(c.default.warn(`[EveAgentController] UserId mismatch in getUserTasks: requested ${e}, authenticated as ${n.userId}`),e=n.userId);return{success:!0,tasks:await this.taskService.getUserTasks(e,parseInt(t),parseInt(r))}}catch(e){if(e instanceof u.AuthenticationError)throw c.default.error(`[EveAgentController] Authentication error in getUserTasks: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw c.default.error(`[EveAgentController] Error in getUserTasks: ${e.message}`,e.stack),e}}};t.EveAgentController=f,n([(0,a.Get)("status"),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],f.prototype,"getStatus",null),n([(0,a.Post)("tasks"),i(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],f.prototype,"createTask",null),n([(0,a.Get)("tasks/:taskId"),i(0,(0,a.Param)("taskId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],f.prototype,"getTask",null),n([(0,a.Get)("tasks/:taskId/steps"),i(0,(0,a.Param)("taskId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],f.prototype,"getTaskSteps",null),n([(0,a.Get)("users/:userId/tasks"),i(0,(0,a.Param)("userId")),i(1,(0,a.Query)("limit")),i(2,(0,a.Query)("offset")),o("design:type",Function),o("design:paramtypes",[String,Object,Object]),o("design:returntype",Promise)],f.prototype,"getUserTasks",null),t.EveAgentController=f=n([(0,a.Controller)("eve-agent"),o("design:paramtypes",[l.ApiHandlerFactory,d.TaskService,u.UserService])],f)},2609:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseCommandLineValidator=void 0;const c=s(r(6928)),l=s(r(1943)),d=s(r(857)),u=a(r(9055)),f=r(9086);t.BaseCommandLineValidator=class{constructor(e){this.enabled=!0,this.config=e,this.checkCommandAvailability(),u.default.info(`[${this.constructor.name}] Created validator: ${e.name} with priority ${e.priority}`)}getPriority(){return this.config.priority}async checkCommandAvailability(){try{const e=this.config.command.split(" ")[0],{stdout:t,stderr:r}=await(0,f.execCommand)(`command -v ${e}`);u.default.info(`[${this.constructor.name}] Checking Availability Ran: 'command -v ${e}' - ${t} - ${r}`);!t.trim()||t.includes("not found")||t.includes("no such file")||r.includes("not found")||r.includes("no such file")?(this.enabled=!1,u.default.warn(`[${this.constructor.name}] Command '${e}' for validator '${this.config.name}' is not available. Validator disabled.`)):(this.enabled=!0,u.default.info(`[${this.constructor.name}] Command '${e}' is available for validator: ${this.config.name}`))}catch(e){this.enabled=!1,u.default.warn(`[${this.constructor.name}] Command for validator '${this.config.name}' is not available. Validator disabled. Error: ${e.message}`)}}canValidate(e){return this.enabled&&this.config.fileExtensions.includes(e.toLowerCase())}async validate(e,t,r){u.default.debug(`[${this.constructor.name}] Validating file: ${e}`);let n=null,o=c.isAbsolute(e)?e:c.resolve(r,e);try{try{await l.access(o)}catch(r){const i=await l.mkdtemp(c.join(d.tmpdir(),"eve-validation-"));n=c.join(i,c.basename(e)),await l.writeFile(n,t),o=n,u.default.debug(`[${this.constructor.name}] Created temporary file: ${n}`)}const i=this.config.command.replace("{filePath}",o).replace("{workingDirectory}",r);u.default.debug(`[${this.constructor.name}] Executing command: ${i}`),console.log(`[${this.constructor.name}] Executing command: ${i}`);const{stdout:s,stderr:a,code:p}=await(0,f.execCommand)(i,{cwd:r});u.default.debug(`[${this.constructor.name}] Command stdout: ${s}`),console.log(`[${this.constructor.name}] Command stdout: ${s}`),a&&(u.default.debug(`[${this.constructor.name}] Command stderr: ${a}`),console.log(`[${this.constructor.name}] Command stderr: ${a}`));const h=this.hasValidationErrors(s,a,p),g=this.formatValidationReport(s,a);return{validatorName:this.config.name,validationMethod:this.config.command,hasErrors:h,report:g}}catch(t){return u.default.error(`[${this.constructor.name}] Error validating file ${e}: ${t.message}`),{validatorName:this.config.name,validationMethod:this.config.command,hasErrors:!0,report:`Validation error: ${t.message}`}}finally{if(n)try{await l.unlink(n),await l.rmdir(c.dirname(n)),u.default.debug(`[${this.constructor.name}] Removed temporary file: ${n}`)}catch(e){u.default.warn(`[${this.constructor.name}] Error removing temporary file ${n}: ${e.message}`)}}}getName(){return this.config.name}}},2626:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReadDependencySourceFile=void 0;const n=r(5534),o=r(1569);class i extends n.Tool{constructor(e){super(),this.name="read_dependency_source_file",this.description='Read the content of a specific source file from a dependency, using the package manager scheme (e.g. "maven"), locator (e.g. "com.example:example:1.0.0"), and file path.\n  Currently only maven is supported so the scheme is always "maven" and the locator is always a Maven GAV tuple (group:artifact:version).\n  If no repository URLs are provided then the default Maven central repository will be used.\n  The file path should be relative to the root of the source directory, e.g., "com/foo/Bar.java".\n  If the file is not found, it will check for alternative extensions (e.g., .kt for Kotlin).\n  ',this.schema=o.z.object({input:o.z.string().describe("A JSON string containing packageManagerScheme, locator, filePath, and optional repositoryUrls")}),this.sourceArtefactService=e}async _call(e){const{packageManagerScheme:t,locator:r,filePath:n,repositoryUrls:o}=JSON.parse(e.input);if(!t||!r||!n)return"Error: Missing required parameters. Please provide packageManagerScheme, locator, and filePath.";try{return await this.sourceArtefactService.readArtefactSourceFile(t,r,n,o)}catch(e){return`Error: Unable to read dependency source file. ${e instanceof Error?e.message:"Unknown error occurred"}`}}}t.ReadDependencySourceFile=i},2775:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getToolUseGuidelines=function(e){return"TOOL USE\n\nYou have access to a set of tools that are executed upon the user's approval. You can use one tool per message, and will receive the result of that tool use in the user's response. You use tools step-by-step to accomplish a given task, with each tool use informed by the result of the previous tool use.\n\n# Tool Use Formatting\n\nTool use is formatted using XML-style tags. The tool name is enclosed in opening and closing tags, and each parameter is similarly enclosed within its own set of tags. Here's the structure:\n\n<tool_name>\n<parameter1_name>value1</parameter1_name>\n<parameter2_name>value2</parameter2_name>\n...\n</tool_name>\n\nFor example:\n\n<read_file>\n<path>src/main.js</path>\n</read_file>\n\nIMPORTANT: NEVER try to wrap the tool call in an xml code block with backticks!\nIMPORTANT: DO NOT USE <tool_use> OR <tool_name> TAGS AT ALL.\n\nAlways adhere to this format for the tool use to ensure proper parsing and execution.\n\n# Tool Use Guidelines\n\n1. In <thinking> tags, assess what information you already have and what information you need to proceed with the task.\n2. Choose the most appropriate tool based on the task and the tool descriptions provided. Assess if you need additional information to proceed, and which of the available tools would be most effective for gathering this information. For example using the list_files tool is more effective than running a command like `ls` in the terminal. It's critical that you think about each available tool and use the one that best fits the current step in the task.\n3. If multiple actions are needed, use one tool at a time per message to accomplish the task iteratively, with each tool use being informed by the result of the previous tool use. Do not assume the outcome of any tool use. Each step must be informed by the previous step's result.\n4. Formulate your tool use using the XML format specified for each tool.\n5. After each tool use, the user will respond with the result of that tool use. This result will provide you with the necessary information to continue your task or make further decisions. This response may include:\n  - Information about whether the tool succeeded or failed, along with any reasons for failure.\n  - Linter errors that may have arisen due to the changes you made, which you'll need to address.\n  - New terminal output in reaction to the changes, which you may need to consider or act upon.\n  - Any other relevant feedback or information related to the tool use.\n6. ALWAYS wait for user confirmation after each tool use before proceeding. Never assume the success of a tool use without explicit confirmation of the result from the user.\n\nIt is crucial to proceed step-by-step, waiting for the user's message after each tool use before moving forward with the task. This approach allows you to:\n1. Confirm the success of each step before proceeding.\n2. Address any issues or errors that arise immediately.\n3. Adapt your approach based on new information or unexpected results.\n4. Ensure that each action builds correctly on the previous ones.\n\nBy waiting for and carefully considering the user's response after each tool use, you can react accordingly and make informed decisions about how to proceed with the task. This iterative process helps ensure the overall success and accuracy of your work."}},2776:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getAppDataSource=t.AppDataSource=void 0;const c=a(r(9055)),l=r(6297),d=a(r(1832)),u=s(r(9187)),f=r(8627),p=r(3903);class h{constructor(e){this.dbChoice=e,this.dbDebugContextService=null}setDbDebugContextService(e){this.dbDebugContextService=e,c.default.info("DbDebugContextService set in AppDataSource")}async initKnexOnly(){const e=this.dbChoice?(0,u.default)(this.dbChoice):(0,u.getDefaultKnexConfig)();c.default.info("Initializing knex with config:",{client:e.client,connection:"string"==typeof e.connection?e.connection:{...e.connection,password:"***"},pool:e.pool,dbChoice:this.dbChoice}),this.knex=(0,d.default)(e),this.setupQueryDebugListeners(),await this.verifyDbConnection(this.knex)}async verifyDbConnection(e){try{c.default.info("Verifying database connection...");const t=e.client.pool;if(t&&"object"==typeof t){const e={min:t.min,max:t.max};"function"==typeof t.numUsed&&(e.numUsed=t.numUsed()),"function"==typeof t.numFree&&(e.numFree=t.numFree()),"function"==typeof t.pendingCreates&&(e.pendingCreates=t.pendingCreates()),"function"==typeof t.pendingAcquires&&(e.pendingAcquires=t.pendingAcquires()),c.default.info("Connection pool status:",e)}await e.raw("SELECT 1"),c.default.info("Database connection successful")}catch(e){throw c.default.error("Database connection failed",{error:e.message,stack:e.stack,code:e.code,errno:e.errno}),e}}async initialize(){await this.initKnexOnly(),this.migrationManager=new f.KnexMigrationManager(this.knex),await this.runMigrations()}async runMigrations(){try{const e=await this.migrationManager.runMigrations();c.default.info(`Ran ${e.length} migrations`)}catch(e){throw c.default.error("Error running database migrations",e),e}}async close(){c.default.info("Closing data source..."),this.knex&&await this.knex.destroy(),c.default.info("Data source closed")}buildPaginationQuery(e,t){const r=(t.page-1)*t.limit;return`${e} LIMIT ${t.limit} OFFSET ${r}`}buildSortQuery(e,t){return`${e} ORDER BY ${t.field} ${t.order}`}setupQueryDebugListeners(){if(!this.knex)return void c.default.warn("Cannot set up query debug listeners: knex instance not initialized");"true"===process.env.EVE_SQL_QUERY_LOGGING?(c.default.info("SQL query logging is enabled"),this.knex.on("query",(e=>{e.queryId=(0,p.v4)(),e.startTime=Date.now();const t=this.dbDebugContextService?.getContext();t&&(t.queryId=e.queryId),l.debugLogger.log(`[Knex Query Start] ID: ${e.queryId}`,{sql:e.sql,bindings:e.bindings,operationId:t?.operationId,operationName:t?.operationName,taskId:t?.taskId})})),this.knex.on("query-response",((e,t)=>{const r=t.startTime?Date.now()-t.startTime:-1,n=this.dbDebugContextService?.getContext();l.debugLogger.log(`[Knex Query Success] ID: ${t.queryId} (Duration: ${r}ms)`,{operationId:n?.operationId,operationName:n?.operationName,taskId:n?.taskId})})),this.knex.on("query-error",((e,t)=>{const r=t.startTime?Date.now()-t.startTime:-1,n=this.dbDebugContextService?.getContext(),o=e.message.includes("SQLITE_BUSY")||e.message.includes("database is locked");if(c.default.error(`[Knex Query Error] ID: ${t.queryId} (Duration: ${r}ms)${o?" - DATABASE LOCKED!":""}`,{error:e.message,code:e.code,errno:e.errno,sql:t.sql,bindings:t.bindings,operationId:n?.operationId,operationName:n?.operationName,taskId:n?.taskId}),o&&this.dbDebugContextService){const e=this.dbDebugContextService.getActiveContexts();c.default.error("[Knex Query Error] DATABASE LOCKED! Active DB contexts potentially holding lock:",e.map((e=>({opId:e.operationId,name:e.operationName,taskId:e.taskId,ageMs:Date.now()-e.startTime,currentQueryId:e.queryId}))))}})),c.default.info("Knex query debug listeners set up successfully")):c.default.info("SQL query logging is disabled. Set EVE_SQL_QUERY_LOGGING=true to enable.")}}t.AppDataSource=h;let g=null;t.getAppDataSource=async()=>(null===g?(c.default.info("Creating new AppDataSource instance..."),g=new h,await g.initialize()):c.default.info("Returning existing AppDataSource instance..."),g)},2810:e=>{"use strict";e.exports=require("@nestjs/serve-static")},2811:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FileSystemController=void 0;const u=r(3563),f=a(r(9896)),p=a(r(6928)),h=d(r(9055)),g=r(2141),m=r(8474),y=r(9668),v=r(6724);let _=class{constructor(e,t,r,n){this.fileSystemService=e,this.workspaceService=t,this.userService=r,this.mentionsService=n}async getStats(e,t=!0){try{await this.userService.getCurrentUser();const r=await this.workspaceService.findOne(e);if(!r)throw new Error(`Workspace ${e} not found`);const n=await this.fileSystemService.getWorkspaceFileList(r.repoBaseDir,{applyInclude:t}),o=await this.fileSystemService.getWorkspaceFileListForLLM(r.repoBaseDir,{maxTokens:1e5});return{totalFiles:n.stats.totalFiles,includedFiles:n.stats.includedFiles,estimatedTokens:n.stats.estimatedTokens,wouldBeTruncated:o.stats.truncated,estimatedFilesAfterTruncation:o.stats.includedFiles}}catch(e){if(e instanceof y.AuthenticationError)throw h.default.error(`[FileSystemController] Authentication error in getStats: ${e.message}`),new u.UnauthorizedException(`Authentication failed: ${e.message}`);throw h.default.error(`[FileSystemController] Error in getStats: ${e.message}`,e.stack),e}}async listForLLM(e,t){try{await this.userService.getCurrentUser();const r=await this.workspaceService.findOne(e.workspaceName);if(!r)throw new Error(`Workspace ${e.workspaceName} not found`);t.setHeader("Content-Type","application/x-ndjson");const n=await this.fileSystemService.getWorkspaceFileListForLLM(r.repoBaseDir,{maxTokens:e.maxTokens,maxFiles:e.maxFiles,maxBytes:e.maxBytes});for(const e of n.files)t.write(JSON.stringify(e)+"\n");for(const e of n.truncationMarkers)t.write(JSON.stringify(e)+"\n");t.write(JSON.stringify({stats:{totalFiles:n.stats.totalFiles,includedFiles:n.stats.includedFiles,truncated:n.stats.truncated,sentTokens:n.stats.estimatedTokens,truncatedDirectories:n.truncationMarkers.length}})+"\n"),t.end()}catch(e){if(e instanceof y.AuthenticationError)throw h.default.error(`[FileSystemController] Authentication error in listForLLM: ${e.message}`),new u.UnauthorizedException(`Authentication failed: ${e.message}`);throw h.default.error(`[FileSystemController] Error in listForLLM: ${e.message}`,e.stack),e}}async getTree(e,t=".",r=0,n="standard",o){try{await this.userService.getCurrentUser();const i=await this.workspaceService.findOne(e);if(!i)throw new Error(`Workspace ${e} not found`);const s=this.fileSystemService.resolvePath(t,i.repoBaseDir),a=await f.promises.stat(s),c=t.split("/").pop()||t;if(!a.isFile()){let e=0;if(o){const r=this.parseCursor(o);t=r.path,e=r.offset}const s=await this.fileSystemService.listDirectoryTree(i.repoBaseDir,t,r,n);return{item:{name:c,path:t,type:"dir",sizeBytes:a.size,modified:a.mtime,children:s.tree},hasMore:s.truncated,nextCursor:s.truncated?this.generateCursor(t,s.stats.includedNodes):null}}{const e={name:c,path:t,type:"file",sizeBytes:a.size,modified:a.mtime};if(!await this.isTextFile(s))return{item:{...e,isText:!1}};try{const t=await f.promises.readFile(s,"utf8");return{item:{...e,isText:!0,content:t}}}catch(t){return h.default.warn(`Failed to read file as text: ${s}`,t),{item:{...e,isText:!1}}}}}catch(e){if(e instanceof y.AuthenticationError)throw h.default.error(`[FileSystemController] Authentication error in getTree: ${e.message}`),new u.UnauthorizedException(`Authentication failed: ${e.message}`);throw h.default.error(`[FileSystemController] Error in getTree: ${e.message}`,e.stack),e}}generateCursor(e,t){return Buffer.from(`${e}:${t}`).toString("base64")}parseCursor(e){const t=Buffer.from(e,"base64").toString(),[r,n]=t.split(":");return{path:r,offset:parseInt(n,10)}}async isTextFile(e){try{const t=await f.promises.open(e,"r"),r=Buffer.alloc(4096),{bytesRead:n}=await t.read(r,0,4096,0);if(await t.close(),0===n)return!0;const o=r.slice(0,n);if(o.includes(0))return!1;let i=0;for(let e=0;e<n;e++){const t=o[e];t<32&&9!==t&&10!==t&&13!==t&&i++}if(i/n>.05)return!1;try{return o.toString("utf8"),!0}catch(e){return!1}}catch(t){return h.default.error(`Error checking if file is text: ${t.message}`),this.isTextFileByExtension(e)}}isTextFileByExtension(e){const t=p.extname(e).toLowerCase();return[".txt",".md",".js",".ts",".html",".css",".json",".xml",".yml",".yaml",".sh",".bash",".py",".java",".c",".cpp",".h",".cs",".go",".rb",".php",".vue",".jsx",".tsx"].includes(t)}async updateFileContent(e){try{await this.userService.getCurrentUser();const t=await this.workspaceService.findOne(e.workspaceName);if(!t)throw new Error(`Workspace ${e.workspaceName} not found`);const r=this.fileSystemService.resolvePath(e.path,t.repoBaseDir);return await f.promises.writeFile(r,e.content,"utf8"),{success:!0}}catch(e){if(e instanceof y.AuthenticationError)throw h.default.error(`[FileSystemController] Authentication error in updateFileContent: ${e.message}`),new u.UnauthorizedException(`Authentication failed: ${e.message}`);throw h.default.error(`[FileSystemController] Error in updateFileContent: ${e.message}`,e.stack),e}}async getContent(e,t=".",r=1,n){try{await this.userService.getCurrentUser();const o=await this.workspaceService.findOne(e);if(!o)throw new Error(`Workspace ${e} not found`);const i=await this.mentionsService.getContentAsText(o.repoBaseDir,t,r);n.setHeader("Content-Type","text/plain"),n.send(i)}catch(e){if(e instanceof y.AuthenticationError)throw h.default.error(`[FileSystemController] Authentication error in getContent: ${e.message}`),new u.UnauthorizedException(`Authentication failed: ${e.message}`);throw h.default.error(`[FileSystemController] Error in getContent: ${e.message}`,e.stack),e}}async searchInDirectory(e,t,r){try{await this.userService.getCurrentUser();if(!await this.workspaceService.findOne(e))throw new Error(`Workspace ${e} not found`);return h.default.info(`[FileSystemController] Search request: workspace=${e}, path=${t}, query=${r}`),{results:[]}}catch(e){if(e instanceof y.AuthenticationError)throw h.default.error(`[FileSystemController] Authentication error in searchInDirectory: ${e.message}`),new u.UnauthorizedException(`Authentication failed: ${e.message}`);throw h.default.error(`[FileSystemController] Error in searchInDirectory: ${e.message}`,e.stack),e}}};t.FileSystemController=_,s([(0,u.Get)("stats"),l(0,(0,u.Query)("workspaceName")),l(1,(0,u.Query)("applyInclude")),c("design:type",Function),c("design:paramtypes",[String,Boolean]),c("design:returntype",Promise)],_.prototype,"getStats",null),s([(0,u.Post)("list-for-llm"),l(0,(0,u.Body)()),l(1,(0,u.Res)()),c("design:type",Function),c("design:paramtypes",[Object,Object]),c("design:returntype",Promise)],_.prototype,"listForLLM",null),s([(0,u.Get)("tree"),l(0,(0,u.Query)("workspaceName")),l(1,(0,u.Query)("path")),l(2,(0,u.Query)("depth")),l(3,(0,u.Query)("filterMode")),l(4,(0,u.Query)("cursor")),c("design:type",Function),c("design:paramtypes",[String,String,Number,String,String]),c("design:returntype",Promise)],_.prototype,"getTree",null),s([(0,u.Put)("content"),l(0,(0,u.Body)()),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],_.prototype,"updateFileContent",null),s([(0,u.Get)("content"),l(0,(0,u.Query)("workspaceName")),l(1,(0,u.Query)("path")),l(2,(0,u.Query)("depth")),l(3,(0,u.Res)()),c("design:type",Function),c("design:paramtypes",[String,String,Number,Object]),c("design:returntype",Promise)],_.prototype,"getContent",null),s([(0,u.Get)("search"),l(0,(0,u.Query)("workspaceName")),l(1,(0,u.Query)("path")),l(2,(0,u.Query)("query")),c("design:type",Function),c("design:paramtypes",[String,String,String]),c("design:returntype",Promise)],_.prototype,"searchInDirectory",null),t.FileSystemController=_=s([(0,u.Controller)("eve/fs"),c("design:paramtypes",[g.FileSystemService,m.WorkspaceService,y.UserService,v.MentionsService])],_)},2873:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MultilineToolCallingScheme=void 0;const n=r(6511);class o extends n.ToolCallingScheme{getSystemPrompt(e,t){return`\n\nYou are an AI being used as part of an agent to help implement the user's request.\nYou are one part of a multi-step process and you are operating in a loop.\nEach response should be targeted to provide some feedback to the user about what is happening now, but mostly it needs to instruct the agent on what to do next.\n\nThe general format for your responses is:\n\n<free text describing what our plan is>\n\n<<<<< NEXT_ACTION next_action >>>>> (where next_action is one of: call_tools, continue, finish)\n\nWhen you need to use a tool, use the following format embedded in your response:\n\n<<<<< NEXT_ACTION next_action >>>>>\n\n<<<<< TOOL CALL tool_name\n<<<<< arg_name_1\n(argument value 1)\n<<<<< arg_name_2\n(argument value 2)\n...\n>>>>> TOOL CALL END\n\n- **next_action** can be one of: \`call_tools\`, \`continue\`, or \`finish\`.\n  - Use \`call_tools\` if you expect the agent to execute the tools you've specified.\n  - Use \`continue\` if you want to proceed without tool execution and control will return to you.\n  - Use \`finish\` when you have completed all tasks or if you need more information from the user and you want to return control to them.\n- Start the next action line with \`<<<<< NEXT_ACTION next_action >>>>>\`.\n- If you are calling tools, include the tool calls as specified.\n- IMPORTANT: Just do one step at a time, ask for a tool call and wait for the response before asking for another tool call (or continuing/finishing).\n\nAvailable Tools:\n\n${this.getToolInstructions(t)}\n\nRemember:\n\n- **Use the exact argument names as specified for each tool.**\n- **Do not include any JSON or markdown formatting in your response.**\n- **Provide code snippets or text exactly as needed, without worrying about escaping.**\n- **Only use tools when necessary.**\n\n---\n\nExamples:\n\n1a. **Using \`update_file\` to update an existing file and specifying \`call_tools\`:**\n\nI need to update the file to replace certain code.\n\n<<<<< NEXT_ACTION call_tools >>>>>\n\n<<<<< TOOL CALL update_file\n<<<<< filePath\n/src/utils/math.js\n<<<<< search\nfunction add(a, b) {\n  return a + b;\n}\n<<<<< replace\nfunction add(a, b) {\n  return a - b;\n}\n>>>>> TOOL CALL END\n\n1b. **Using \`update_file\` to create a new file and specifying \`call_tools\`:**\n\nOr another example when we are creating a new file:\n\n<<<<< NEXT_ACTION call_tools >>>>>\n\n<<<<< TOOL CALL update_file\n<<<<< filePath\n/src/utils/math.js\n<<<<< search\n<<<<< replace\nfunction add(a, b) {\n  return a - b;\n}\n>>>>> TOOL CALL END\n\n2. **Continuing without tool execution (\`continue\`):**\n\nI will now proceed to document the changes made.\n\n<<<<< NEXT_ACTION continue >>>>>\n\n3. **Finishing the task (\`finish\`):**\n\nAll tasks are completed. Here's a summary of the changes made.\n\n<<<<< NEXT_ACTION finish >>>>>\n\n---\n\nNow, please proceed to assist the user with their request.\n`}parseLLMResponse(e){const t=this.extractNextAction(e),r=this.extractToolCalls(e);return{response:e.replace(/<<<<< NEXT_ACTION.*?>>>>>>/gs,"").replace(/<<<<< TOOL CALL.*?>>>>> TOOL CALL END/gs,"").trim(),tool_calls:r,next:t}}getToolInstructions(e){return e.map((e=>`Tool Name: ${e.name}\nDescription: ${e.description}\nUsage:\n<<<<< TOOL CALL ${e.name}\n${this.getToolArgumentsUsage(e)}\n>>>>> TOOL CALL END`)).join("\n\n")}getToolArgumentsUsage(e){const t=e.schema;if(!t||!t._def||"function"!=typeof t._def.shape)return"(No parameters required)";try{const e=t._def.shape();return e&&"object"==typeof e?Object.keys(e).map((e=>`<<<<< ${e}\n(value for ${e})`)).join("\n"):"(No parameters required)"}catch(e){return"(Error reading tool parameters)"}}extractNextAction(e){const t=e.match(/<<<<< NEXT_ACTION (\w+) >>>>>/);if(t){const e=t[1];if(["call_tools","continue","finish"].includes(e))return e}return"continue"}extractToolCalls(e){const t=[],r=/<<<<< TOOL CALL (\w+)[\s\S]*?>>>>> TOOL CALL END/g;let n;for(;null!==(n=r.exec(e));){const e=n[1],r=n[0],o=this.extractArgs(r);t.push({tool_name:e,args:o})}return t}extractArgs(e){const t={},r=/<<<<< (\w+)\n([\s\S]*?)(?=(<<<<< \w+|>>>>> TOOL CALL END))/g;let n;for(;null!==(n=r.exec(e));){const e=n[1],r=n[2].trim();t[e]=r}return t}}t.MultilineToolCallingScheme=o},2900:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SerpApi=void 0;const a=r(5534),c=r(1569),l=s(r(9055)),d=r(3563),u=r(2368),f=r(6910),p=r(5306);let h=class extends a.Tool{constructor(e){super(),this.configService=e,this.name="serp_api",this.description="Search the web using SerpAPI and return the top search results. This takes a search term and returns the top results.",this.schema=c.z.object({searchTerm:c.z.string().describe("The search term to look for"),numResults:c.z.number().optional().describe("Number of results to return (default: 10)"),start:c.z.number().optional().describe("Starting position for pagination (0-based, optional)")}),this.apiKey=this.configService.getProperty(f.ConfigPropNames.SERP_API_KEY,""),this.apiKey||l.default.warn("SerpAPI key not found in config. The SerpAPI tool will not work without an API key.")}async _call({searchTerm:e,numResults:t=10,start:r=0}){if(!this.apiKey)return"Error: SerpAPI key not configured. Please set the SERP_API_KEY in system configuration.";try{l.default.info(`Searching with SerpAPI: "${e}", numResults: ${t}, start: ${r}`);const n={api_key:this.apiKey,q:e,engine:"google",google_domain:"google.com",hl:"en",num:t,start:r},o=await new Promise(((e,t)=>{(0,p.getJson)(n,(r=>{"Error"===r.search_metadata?.status?t(new Error(r.search_metadata.id||"Unknown error")):e(r)}))}));if(!o||!o.organic_results||0===o.organic_results.length)return`No results found for search: "${e}"`;const i=o.organic_results;let s=`Search results for: "${e}" (${o.search_information?.total_results||"unknown"} total results)\n`;if(s+=`Page: ${Math.floor(r/t)+1} (showing results ${r+1}-${r+i.length})\n\n`,i.forEach(((e,t)=>{s+=`${r+t+1}. ${e.title||"No title"}\n`,s+=`   URL: ${e.link||"No link"}\n`,e.snippet&&(s+=`   Snippet: ${e.snippet}\n`),e.date&&(s+=`   Date: ${e.date}\n`),s+="\n"})),o.pagination&&o.pagination.next){s+=`\nTo see more results, use start=${r+t} with the same search term.\n`}return s}catch(t){l.default.error(`Error searching with SerpAPI: ${e}`,t);return`Error searching with SerpAPI: ${t instanceof Error?t.message:"Unknown error occurred"}`}}};t.SerpApi=h,t.SerpApi=h=n([i(0,(0,d.Inject)(u.ConfigService)),o("design:paramtypes",[u.ConfigService])],h)},2923:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CurrentTimestamp=void 0;const n=r(7773);class o extends n.Tool{constructor(){super(...arguments),this.name="current_timestamp",this.description="Returns the current timestamp in epoch milliseconds and ISO format"}async _call(){const e=new Date,t=e.getTime(),r=e.toISOString();return JSON.stringify({epochMillis:t,isoFormat:r})}}t.CurrentTimestamp=o},2929:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PylintValidator=void 0;const i=r(3563),s=r(2609);let a=class extends s.BaseCommandLineValidator{constructor(){super({name:"Pylint",command:"pylint --output-format=text {filePath}",fileExtensions:["py"],issuePattern:/(?<filePath>[^:]+):(?<line>\d+):(?<column>\d+): (?<code>[A-Z]\d+): (?<message>.+)/g,priority:30})}hasValidationErrors(e,t,r){return 0!==r||this.config.issuePattern.test(e)||this.config.issuePattern.test(t)}formatValidationReport(e,t){return e||t}checkForSyntaxErrors(e){return e.includes("    ")&&e.includes("  def ")||e.includes("def ")&&!e.includes("def ")||(e.match(/\(/g)||[]).length!==(e.match(/\)/g)||[]).length||e.includes("import")&&e.includes("ImportError")}};t.PylintValidator=a,t.PylintValidator=a=n([(0,i.Injectable)(),o("design:paramtypes",[])],a)},2992:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TypeScriptValidator=void 0;const d=r(3563),u=r(2609),f=l(r(9055)),p=r(9086),h=a(r(6928)),g=a(r(1943)),m=a(r(857));let y=class extends u.BaseCommandLineValidator{constructor(){super({name:"TypeScript",command:"tsc --noEmit --pretty false {filePath}",fileExtensions:["ts","tsx"],issuePattern:/([^:]+):(\d+):(\d+) - (error|warning) ([^:]+): (.+)/g,priority:10}),this.checkCommandAvailability()}async checkCommandAvailability(){try{const e=this.config.command.split(" ")[0],{stdout:t,stderr:r}=await(0,p.execCommand)(`command -v ${e}`),n=`${t.trim()} ${r.trim()}`.trim();f.default.info(`[${this.constructor.name}] Checking Availability Ran: 'command -v ${e}' - ${n}`);!t.trim()||t.includes("not found")||t.includes("no such file")||r.includes("not found")||r.includes("no such file")?(this.enabled=!1,f.default.warn(`[${this.constructor.name}] Command '${e}' for validator '${this.config.name}' is not available. Validator disabled.`)):(this.enabled=!0,f.default.info(`[${this.constructor.name}] Command '${e}' is available for validator: ${this.config.name}`))}catch(e){this.enabled=!1,f.default.warn(`[${this.constructor.name}] Command for validator '${this.config.name}' is not available. Validator disabled. Error: ${e.message}`)}}hasValidationErrors(e,t,r){return 0!==r}formatValidationReport(e,t){return t||e}async validate(e,t,r){f.default.debug(`[${this.constructor.name}] Validating file: ${e}`);const n=await this.findNearestConfigFile(e,"tsconfig.json");let o=null,i=h.isAbsolute(e)?e:h.resolve(r,e);try{try{await g.access(i)}catch(r){const n=await g.mkdtemp(h.join(m.tmpdir(),"eve-validation-"));o=h.join(n,h.basename(e)),await g.writeFile(o,t),i=o,f.default.debug(`[${this.constructor.name}] Created temporary file: ${o}`)}const s=this.config.command.replace("{filePath}",i).replace("{workingDirectory}",r),a=n||r;n?f.default.info(`[${this.constructor.name}] Using tsconfig.json found at: ${n}`):f.default.warn(`[${this.constructor.name}] No tsconfig.json found for ${e}, using default working directory`),f.default.debug(`[${this.constructor.name}] Executing command: ${s} in directory: ${a}`),console.log(`[${this.constructor.name}] Executing command: ${s} in directory: ${a}`);const{stdout:c,stderr:l,code:d}=await(0,p.execCommand)(s,{cwd:a});f.default.debug(`[${this.constructor.name}] Command stdout: ${c}`),console.log(`[${this.constructor.name}] Command stdout: ${c}`),l&&(f.default.debug(`[${this.constructor.name}] Command stderr: ${l}`),console.log(`[${this.constructor.name}] Command stderr: ${l}`));const u=this.hasValidationErrors(c,l,d),y=this.formatValidationReport(c,l);return{validatorName:this.config.name,validationMethod:this.config.command,hasErrors:u,report:y}}catch(t){return f.default.error(`[${this.constructor.name}] Error validating file ${e}: ${t.message}`),{validatorName:this.config.name,validationMethod:this.config.command,hasErrors:!0,report:`Validation error: ${t.message}`}}finally{if(o)try{await g.unlink(o),await g.rmdir(h.dirname(o)),f.default.debug(`[${this.constructor.name}] Removed temporary file: ${o}`)}catch(e){f.default.warn(`[${this.constructor.name}] Error removing temporary file ${o}: ${e.message}`)}}}async findNearestConfigFile(e,t){let r=h.dirname(h.resolve(e));const n=h.parse(r).root;for(;r!==n;){const e=h.join(r,t);try{return await g.access(e),f.default.debug(`[${this.constructor.name}] Found ${t} at: ${r}`),r}catch(e){r=h.dirname(r)}}const o=h.join(n,t);try{return await g.access(o),f.default.debug(`[${this.constructor.name}] Found ${t} at root: ${n}`),n}catch(r){return f.default.debug(`[${this.constructor.name}] No ${t} found in directory tree for: ${e}`),null}}};t.TypeScriptValidator=y,t.TypeScriptValidator=y=s([(0,d.Injectable)(),c("design:paramtypes",[])],y)},3049:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioTranscriptionModule=void 0;const o=r(3563),i=r(885),s=r(4562);let a=class{};t.AudioTranscriptionModule=a,t.AudioTranscriptionModule=a=n([(0,o.Module)({controllers:[i.AudioTranscriptionController],providers:[s.AudioTranscriptionService,i.AudioTranscriptionController]})],a)},3060:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AttemptCompletionTool=void 0;const a=r(3563),c=s(r(9055));let l=n=class{constructor(){this.name="attempt_completion",this.description="After each tool use, the user will respond with the result of that tool use, i.e. if it succeeded or failed, along with any reasons for failure. Once you've received the results of tool uses and can confirm that the task is complete, use this tool to present the result of your work to the user.",c.default.info(`[${n.name}] AttemptCompletionTool initialized`)}getUsageInstructions(e){return"## attempt_completion\nDescription: After each tool use, the user will respond with the result of that tool use, i.e. if it succeeded or failed, along with any reasons for failure. Once you've received the results of tool uses and can confirm that the task is complete, use this tool to present the result of your work to the user. Optionally you may provide a CLI command to showcase the result of your work. The user may respond with feedback if they are not satisfied with the result, which you can use to make improvements and try again.\nIMPORTANT NOTE: This tool CANNOT be used until you've confirmed from the user that any previous tool uses were successful. Failure to do so will result in code corruption and system failure. Before using this tool, you must ask yourself in <thinking></thinking> tags if you've confirmed from the user that any previous tool uses were successful. If not, then DO NOT use this tool.\nParameters:\n- result: (required) The result of the task. Formulate this result in a way that is final and does not require further input from the user. Don't end your result with questions or offers for further assistance.\n- command: (optional) A CLI command to execute to show a live demo of the result to the user. For example, use `open index.html` to display a created html website, or `open localhost:3000` to display a locally running development server. But DO NOT use commands like `echo` or `cat` that merely print text. This command should be valid for the current operating system. Ensure the command is properly formatted and does not contain any harmful instructions.\nUsage:\n<attempt_completion>\n<result>\nYour final result description here\n</result>\n<command>Command to demonstrate result (optional)</command>\n</attempt_completion>"}validateParams(e){return"string"==typeof e.result&&""!==e.result.trim()}async execute(e){const{result:t,command:r}=e;return c.default.info(`[${n.name}] Attempting completion: ${t.substring(0,50)}...`),{result:t,command:r,success:!0}}};t.AttemptCompletionTool=l,t.AttemptCompletionTool=l=n=o([(0,a.Injectable)(),i("design:paramtypes",[])],l)},3089:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculateGeminiCost=function(e,t,r,n=0){const o=e.inputCostPerMillionTokens,i=e.outputCostPerMillionTokens,s=e.cacheReadsPrice;if(!o||!i)return;const a=Math.max(0,t-n);return o/1e6*a+i/1e6*r+(s?s/1e6*n:0)},t.calculateApiCost=function(e,t,r,n=0,o=0){const i=e.inputCostPerMillionTokens,s=e.outputCostPerMillionTokens,a=e.cacheReadsPrice,c=e.cacheWritesPrice;if(!i||!s)return;const l=Math.max(0,t-n);return i/1e6*l+s/1e6*r+(a?a/1e6*n:0)+(c?c/1e6*o:0)}},3118:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AnthropicMessageTransformer=void 0;const o=n(r(9055)),i=r(6297);t.AnthropicMessageTransformer=class{toProviderFormat(e,t=!1){o.default.info(`[AnthropicMessageTransformer] Converting ${e.length} messages to provider format. Thinking enabled: ${t}`);return e.map(((e,r)=>{if("anthropic"===e.providerId&&e.providerMetadata)return e.providerMetadata;const n="assistant"===e.role?"assistant":"user",s=[];for(const r of e.segments)if("text"===r.type)s.push({type:"text",text:r.content});else if("thinking"===r.type)if(t){const t={type:"thinking",thinking:r.content};"string"==typeof r.metadata?.signature&&r.metadata.signature.length>0?t.signature=r.metadata.signature:(o.default.warn(`[AnthropicMessageTransformer] Missing or invalid signature for thinking segment in message ${e.id}. Omitting signature field.`),i.debugLogger.dumpObject("[AnthropicMessageTransformer] Segment with missing signature:",r)),s.push(t)}else o.default.debug(`[AnthropicMessageTransformer] Converting past thinking segment to text for message ${e.id} as thinking is disabled for this request.`),s.push({type:"text",text:`<thinking>${r.content}</thinking>`});else if("other"===r.type&&"tool_use"===r.metadata?.providerSpecificType){const e=JSON.parse(r.content);s.push({type:"tool_use",id:e.id||"tool-"+Date.now(),name:e.name,input:e.input})}else if("image"===r.type){const t=r.metadata?.url||r.content;if(t.startsWith("data:")){o.default.info(`[AnthropicMessageTransformer] Processing base64 image in message ${e.id}`);let n=r.metadata?.mediaType||"image/jpeg";if(t.startsWith("data:")&&t.includes(";base64,")){const e=t.match(/^data:([^;]+);base64,/);e&&e[1]&&(n=e[1])}let i=t;t.includes(";base64,")&&(i=t.split(";base64,")[1]),s.push({type:"image",source:{type:"base64",media_type:n,data:i}})}else o.default.info(`[AnthropicMessageTransformer] Processing URL image in message ${e.id}`),s.push({type:"image",source:{type:"url",url:t}})}else o.default.warn(`[AnthropicMessageTransformer] Unsupported segment type: ${r.type}. Converting to text.`),s.push({type:"text",text:r.content});return{role:n,content:s}}))}fromProviderFormat(e,t){return e.map((e=>{const n="assistant"===e.role?"assistant":"user",i=[];if(Array.isArray(e.content))for(const t of e.content)if("text"===t.type)i.push({type:"text",content:t.text});else if("thinking"===t.type)i.push({type:"thinking",content:t.thinking||"",metadata:{signature:t.signature}});else if("image"===t.type&&t.source)if("url"===t.source.type&&t.source.url)o.default.info("[AnthropicMessageTransformer] Processing URL image from provider"),i.push({type:"image",content:`[Image: ${t.source.url}]`,metadata:{url:t.source.url,mediaType:"image/jpeg"}});else if("base64"===t.source.type&&t.source.data){o.default.info("[AnthropicMessageTransformer] Processing base64 image from provider");const e=t.source.media_type||"image/jpeg",r=`data:${e};base64,${t.source.data}`;i.push({type:"image",content:r,metadata:{mediaType:e}})}else o.default.warn(`[AnthropicMessageTransformer] Unknown image source type from provider: ${t.source.type}`),i.push({type:"text",content:`[Unsupported image format: ${JSON.stringify(t.source)}]`});else o.default.warn(`[AnthropicMessageTransformer] Unsupported content type from provider: ${t.type}. Converting to text.`),i.push({type:"text",content:JSON.stringify(t)});else"string"==typeof e.content?i.push({type:"text",content:e.content}):(o.default.warn("[AnthropicMessageTransformer] Unknown content format from provider. Converting to string."),i.push({type:"text",content:JSON.stringify(e.content)}));return{id:r(9100).ulid(),taskId:t,role:n,segments:i,providerId:"anthropic",providerMetadata:{format:"structured"},createdAt:new Date}}))}}},3131:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ExecuteCommandTool=void 0;const a=r(3563),c=r(5317),l=s(r(9055)),d=r(9581),u=r(2368),f=r(6910);let p=n=class{constructor(e){this.name="execute_command",this.description="Request to execute a CLI command on the system.",this.workingDir=e}validateParams(e){return"string"==typeof e.command&&""!==e.command.trim()&&"boolean"==typeof e.requires_approval&&(void 0===e.timeout||"number"==typeof e.timeout&&e.timeout>0)}clipOutput(e,t,r){if(e.length<=t)return e;const n=e.substring(0,r),o=e.substring(e.length-(t-r));return`${n}\n[...CONTENT CLIPPED (${e.length-t} characters)...]\n${o}`}getUsageInstructions(e){return`## execute_command\nDescription: Request to execute a CLI command on the system. Use this when you need to perform system operations or run specific commands to accomplish any step in the user's task. You must tailor your command to the user's system and provide a clear explanation of what the command does. For command chaining, use the appropriate chaining syntax for the user's shell. Prefer to execute complex CLI commands over creating executable scripts, as they are more flexible and easier to run. Commands will be executed in the current working directory: ${e.workingDir}\nParameters:\n- command: (required) The CLI command to execute. This should be valid for the current operating system. Ensure the command is properly formatted and does not contain any harmful instructions.\n- requires_approval: (required) A boolean indicating whether this command requires explicit user approval before execution in case the user has auto-approve mode enabled. Set to 'true' for potentially impactful operations like installing/uninstalling packages, deleting/overwriting files, system configuration changes, network operations, or any commands that could have unintended side effects. Set to 'false' for safe operations like reading files/directories, running development servers, building projects, and other non-destructive operations.\n- timeout: (optional) The maximum time in milliseconds to wait for the command to complete. Defaults to 30000 (30 seconds). If the command does not complete within this time, it will be terminated and a timeout message will be returned.\nImportant Notes:\n- This tool is NOT suitable for starting long-running processes like servers or watch commands. If you need to start a long-running process, ask the user to run the command manually.\n- Commands that take longer than the timeout will be terminated automatically.\n- Output is limited to a maximum length. If exceeded, only the beginning and end of the output will be returned with a message indicating content was clipped.\nUsage:\n<execute_command>\n<command>Your command here</command>\n<requires_approval>true or false</requires_approval>\n<timeout>30000</timeout> \x3c!-- Optional, defaults to 30000 (30 seconds) --\x3e\n</execute_command>`}async execute(e){const{command:t,requires_approval:r}=e,o=void 0!==e.timeout?e.timeout:3e4,i=u.ConfigService.getNumericProperty(f.ConfigPropNames.COMMAND_OUTPUT_MAX_LENGTH,1e4),s=u.ConfigService.getNumericProperty(f.ConfigPropNames.COMMAND_OUTPUT_PREFIX_LENGTH,200);l.default.info(`[${n.name}] Executing command in ${this.workingDir} with ${o}ms timeout: ${t}`);const a=this.workingDir;return new Promise(((e,r)=>{try{const u=(0,c.spawn)(t,{shell:!0,cwd:a,stdio:["ignore","pipe","pipe"]});let f="",p="",h=!1;const g=setTimeout((()=>{h=!0;try{u.kill()}catch(e){l.default.error(`[${n.name}] Error killing process after timeout: ${e.message}`)}const r=`\n[Command timed out after ${o/1e3} seconds]`;l.default.warn(`[${n.name}] Command "${t}" timed out after ${o/1e3} seconds`);const a=this.clipOutput(f,i,s),c=this.clipOutput(p,i,s);e({output:(a+(c?"\n"+c:"")+r).trim(),exitCode:-1})}),o);u.stdout.on("data",(e=>{f+=e.toString()})),u.stderr.on("data",(e=>{p+=e.toString()})),u.on("close",(r=>{if(clearTimeout(g),!h){const o=this.clipOutput(f,i,s),a=this.clipOutput(p,i,s),c=(o+(a?"\n"+a:"")).trim();l.default.info(`[${n.name}] Command "${t}" executed with exit code: ${r}`),e({output:c,exitCode:null===r?-1:r})}})),u.on("error",(e=>{if(clearTimeout(g),!h){const o=`Error executing command "${t}": ${e.message}`;l.default.error(`[${n.name}] ${o}\n${e.stack}`);const i=e instanceof Error&&"code"in e&&"string"==typeof e.code?e.code:"COMMAND_EXECUTION_ERROR";r(new d.FileSystemError(o,i))}}))}catch(e){const o=`Error spawning command "${t}": ${e.message}`;l.default.error(`[${n.name}] ${o}\n${e.stack}`);const i=e instanceof Error&&"code"in e&&"string"==typeof e.code?e.code:"COMMAND_SPAWN_ERROR";r(new d.FileSystemError(o,i))}}))}};t.ExecuteCommandTool=p,t.ExecuteCommandTool=p=n=o([(0,a.Injectable)(),i("design:paramtypes",[String])],p)},3153:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SourceArtefactService=void 0;const i=r(3563),s=r(5908),a=r(8547),c=r(4358);let l=class{constructor(e,t){this.sourceArtefactRepository=e,this.schemePackageManager=t}async importSourceArtefact(e,t,r){if(await this.findBySchemeAndLocator(e,t))throw new i.BadRequestException(`Source artefact with scheme '${e}' and locator '${t}' already exists.`);try{const n=await this.schemePackageManager.downloadAndStoreSources(e,t,r);return this.sourceArtefactRepository.create(n)}catch(r){const n=r instanceof Error?r.message:"Unknown error occurred";return this.sourceArtefactRepository.create(new a.SourceArtefact({scheme:e,locator:t,valid:!1,error:n,repo:"",cacheSrcBaseDir:""}))}}async findById(e){return this.sourceArtefactRepository.findById(e)}async delete(e){const t=await this.sourceArtefactRepository.findById(e);return t&&await this.schemePackageManager.deleteSourceCache(t.cacheSrcBaseDir),this.sourceArtefactRepository.delete(e)}async findBySchemeAndLocator(e,t){return this.sourceArtefactRepository.findBySchemeAndLocator(e,t)}async query(e,t,r=1,n=10,o="locator",i="ASC"){return this.sourceArtefactRepository.query(e,t,r,n,o,i)}async readArtefactSourceTree(e,t,r){const n=await this.ensureSourceArtefact(e,t,r);return this.schemePackageManager.getScheme(e).readArtefactSourceTree(n)}async readArtefactSourceFile(e,t,r,n){const o=await this.ensureSourceArtefact(e,t,n);return this.schemePackageManager.getScheme(e).readArtefactSourceFile(o,r)}async ensureSourceArtefact(e,t,r){let n=await this.findBySchemeAndLocator(e,t);const o=this.schemePackageManager.getScheme(e);return n&&!await o.needsImport(n)||(n=await this.importSourceArtefact(e,t,r)),n}};t.SourceArtefactService=l,t.SourceArtefactService=l=n([(0,i.Injectable)(),o("design:paramtypes",[s.SourceArtefactRepository,c.SchemePackageManager])],l)},3177:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.MutationsModule=void 0;const o=r(3563),i=r(376),s=r(9989),a=r(7602),c=r(672);let l=class{};t.MutationsModule=l,t.MutationsModule=l=n([(0,o.Module)({imports:[i.DataSourceModule],controllers:[s.MutationsController],providers:[a.MutationsService,c.MutationRepository],exports:[a.MutationsService]})],l)},3192:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.containsBase64Image=function(e){if("object"!=typeof e)return!1;if("image_url"===e?.type&&e?.image_url?.url){const t=e.image_url.url;return t.startsWith("data:image")&&t.includes("base64")}if(e?.data&&"string"==typeof e.data)return e.data.length>1e3&&/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/.test(e.data);return!1},t.processImageContent=function e(t){if(!t)return t;if("string"==typeof t&&(t.startsWith("{")||t.startsWith("[")))try{const r=JSON.parse(t),n=e(r);return JSON.stringify(n)}catch(e){return t}if(Array.isArray(t))return t.map((t=>e(t)));if("object"==typeof t&&null!==t){if("image_url"===t.type&&t.image_url?.url){const e=t.image_url.url;if(e.startsWith("data:image")&&e.includes("base64")){const t=e.match(/data:image\/([a-zA-Z0-9]+);base64,/),r=t?t[1]:"unknown",n=e.indexOf("base64,")+7,i=e.length-n;return o.default.info(`[ImageHandler] Replacing base64 image data (${r}, ${i} bytes) with reference`),{type:"image_url",image_url:{url:`[BASE64_IMAGE_DATA_${r.toUpperCase()}_${i}_BYTES]`}}}}if(t.data&&"string"==typeof t.data&&t.data.length>1e3&&/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/.test(t.data)){const e=t.data.length;return o.default.info(`[ImageHandler] Replacing base64 data (${e} bytes) with reference`),{...t,data:`[BASE64_DATA_${e}_BYTES]`}}const r={};for(const[n,o]of Object.entries(t))r[n]=e(o);return r}return t};const o=n(r(9055))},3220:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ReadFileToolFactory=void 0;const i=r(3563),s=r(4833);let a=class{constructor(){}getToolName(){return"read_file"}create(e){return new s.ReadFileTool(e.workingDir)}};t.ReadFileToolFactory=a,t.ReadFileToolFactory=a=n([(0,i.Injectable)(),o("design:paramtypes",[])],a)},3229:function(e,t,r){"use strict";e=r.nmd(e);var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.convertDocxToHtml=async function(e,t={}){await k(e,t);return document.documentElement.outerHTML},t.convertDocxToHtmlDom=k,t.extractRawText=async function(e){w.default.debug("Extracting raw text from DOCX buffer");try{w.default.debug("Starting mammoth raw text extraction");const t=await d.extractRawText({buffer:e});return t.messages&&t.messages.length>0&&w.default.warn("Extraction warnings:",t.messages),t.value}catch(e){throw new Error(`Failed to extract raw text from DOCX: ${e.message}`)}},t.extractDocxXmlFromBytes=async function(e){return w.default.debug("Extracting XML from DOCX buffer"),new Promise(((t,r)=>{try{w.default.debug("Opening DOCX buffer for XML extraction"),m.fromBuffer(e,{lazyEntries:!0},((e,n)=>{if(w.default.debug("DOCX buffer opened"),e)return void r(new Error(`Failed to open DOCX buffer: ${e.message}`));let o="";n.on("entry",(e=>{w.default.debug("Found entry: %s",e.fileName),"word/document.xml"===e.fileName?n.openReadStream(e,((e,n)=>{if(e)return void r(new Error(`Failed to read document.xml: ${e.message}`));const i=[];n.on("data",(e=>i.push(e))),n.on("end",(async()=>{o=Buffer.concat(i).toString("utf8");try{const e=new p.Parser,r=await e.parseStringPromise(o),n=new p.Builder({renderOpts:{pretty:!0}}).buildObject(r);t(n)}catch(e){r(new Error(`Failed to parse XML: ${e.message}`))}}))})):(w.default.debug("Skipping entry: %s",e.fileName),n.readEntry())})),n.on("end",(()=>{w.default.debug("DOCX buffer ended"),o||r(new Error("Invalid .docx file: document.xml not found"))})),w.default.debug("Reading DOCX buffer entry"),n.readEntry()}))}catch(e){r(new Error(`Error processing DOCX buffer: ${e.message}`))}}))},t.extractDocxXml=S,t.editDocxFile=async function(e,t,r,n,o){if(w.default.info("Editing DOCX file: %s",e),w.default.info("Output path: %s",n),!t)throw new Error("Search text cannot be empty");const i=o||await c.promises.mkdtemp(f.join(u.tmpdir(),"docx-edit-"));try{const o=e=>new Promise(((t,r)=>{m.open(e,{lazyEntries:!0},((e,n)=>{e?r(e):t(n)}))})),s=await o(e),a=[];let l="";await new Promise(((e,t)=>{s.on("entry",(e=>{const r=f.join(i,e.fileName);c.mkdirSync(f.dirname(r),{recursive:!0}),s.openReadStream(e,((n,o)=>{if(n)t(n);else{if("word/document.xml"===e.fileName){const e=[];o.on("data",(t=>e.push(t))),o.on("end",(()=>{l=Buffer.concat(e).toString("utf8"),c.writeFileSync(r,l)}))}else{const e=c.createWriteStream(r);o.pipe(e)}a.push(new Promise((e=>{o.on("end",e)})))}})),s.readEntry()})),s.on("end",(()=>e())),s.on("error",t),s.readEntry()})),await Promise.all(a);const d=l.indexOf(t);if(-1===d)throw new Error("Search text not found in document");const u=l.slice(0,d)+r+l.slice(d+t.length);await c.promises.writeFile(f.join(i,"word/document.xml"),u);const p=new y.ZipFile,h=async(e,t="")=>{const r=await c.promises.readdir(e,{withFileTypes:!0});for(const n of r){const r=f.join(e,n.name),o=f.join(t,n.name);n.isDirectory()?await h(r,o):p.addFile(r,o)}};await h(i);const g=c.createWriteStream(n);p.outputStream.pipe(g),await new Promise(((e,t)=>{g.on("close",e),g.on("error",t),p.end()}))}finally{o||await c.promises.rm(i,{recursive:!0,force:!0})}},t.extractSectionsFromDocxBuffer=P,t.extractDocxXmlPartsFromBytes=E,t.extractSectionsFromXmlContent=I,t.extractSections=C;const c=s(r(9896)),l=r(2325),d=s(r(7393)),u=s(r(857)),f=s(r(6928)),p=s(r(6566)),h=r(1879),g=s(r(9863)),m=s(r(1115)),y=s(r(7020)),v=s(r(6610)),_=v.default||v,w=a(r(9055)),b=1;async function k(e,t={}){w.default.debug("Converting DOCX to HTML with options: %j",t);try{w.default.debug("Starting mammoth conversion");const r=await d.convertToHtml({buffer:e});r.messages&&r.messages.length>0&&w.default.warn("Conversion warnings:",r.messages);let n=r.value;t.wrapperElement&&(w.default.debug("Adding wrapper element: %s",t.wrapperElement),n=`<html><head></head><body>${n}</body></html>`);let o=new l.JSDOM(n).window.document;if(t.removeImages){const e=o.getElementsByTagName("img");for(;e.length>0;)e[0].parentNode?.removeChild(e[0])}return o}catch(e){throw new Error(`Failed to convert DOCX to HTML: ${e.message}`)}}async function S(e){return w.default.info("Extracting XML from DOCX file: %s",e),new Promise(((t,r)=>{try{w.default.info("Opening DOCX file for XML extraction"),m.open(e,{lazyEntries:!0},((e,n)=>{if(e)return void r(new Error(`Failed to open DOCX file: ${e.message}`));let o="";n.on("entry",(e=>{"word/document.xml"===e.fileName?n.openReadStream(e,((e,n)=>{if(e)return void r(new Error(`Failed to read document.xml: ${e.message}`));const i=[];n.on("data",(e=>i.push(e))),n.on("end",(async()=>{o=Buffer.concat(i).toString("utf8");try{const e=new p.Parser,r=await e.parseStringPromise(o),n=new p.Builder({renderOpts:{pretty:!0}}).buildObject(r);t(n)}catch(e){r(new Error(`Failed to parse XML: ${e.message}`))}}))})):n.readEntry()})),n.on("end",(()=>{o||r(new Error("Invalid .docx file: document.xml not found"))})),n.readEntry()}))}catch(e){r(new Error(`Error processing DOCX file: ${e.message}`))}}))}function R(e){if(w.default.debug("Getting XPath for node: %s",e.nodeName),e.nodeType!==b)return w.default.debug("Node is not an element node, returning empty path"),"";let t="",r=e;const n=e.ownerDocument.documentElement,o={};for(let e=0;e<n.attributes.length;e++){const t=n.attributes[e];if(t.name.startsWith("xmlns:")){const e=t.name.split(":")[1];o[e]=t.value}else"xmlns"===t.name&&(o.default=t.value)}function i(e){if(!e)return null;for(const t in o)if(o[t]===e)return t;return null}for(;r&&r.nodeType===b&&"document"!==r.localName;){let e=1,n=r.previousSibling;for(;n;)n.nodeType===b&&n.localName===r.localName&&n.namespaceURI===r.namespaceURI&&e++,n=n.previousSibling;const o=i(r.namespaceURI);w.default.info("Node details - localName: %s, namespaceURI: %s, resolved prefix: %s",r.localName,r.namespaceURI,o);t=`/${o?`${o}:${r.localName}`:r.localName}[${e}]`+t,r=r.parentNode}if(r&&r.nodeType===b&&"document"===r.localName){const e=i(r.namespaceURI);t=`/${e?`${e}:${r.localName}`:r.localName}${t}`}return w.default.info("Completed XPath calculation for node: %s, path: %s",e.nodeName,t),t}function T(e,t){let r=t;for(;r;){if(r===e)return!0;r=r.parentNode}return!1}function $(e,t){w.default.debug("Finding label for input node: %s",e.nodeName);let r=e.parentNode;for(;r&&"w:body"!==r.nodeName;){if("w:tr"===r.nodeName){const n=Array.from(r.childNodes).filter((e=>"w:tc"===e.nodeName));w.default.debug("Found %d cells in table row",n.length);for(let o=0;o<n.length;o++){if(T(n[o],e)){w.default.debug("Input node found in cell %d, checking previous cells for label",o);for(let e=o-1;e>=0;e--){const r=t(".//w:t",n[e]).map((e=>e.textContent?.trim())).filter((e=>e)).join(" ");if(r)return w.default.debug("Found label text in same row: %s",r),r}let e=r;for(;e.previousSibling;){const r=e.previousSibling;if("w:tr"===r.nodeName){const e=Array.from(r.childNodes).filter((e=>"w:tc"===e.nodeName));for(const r of e){if(t('.//w:shd[@w:fill="E5E5E5"]',r)[0]){const e=t(".//w:t",r).map((e=>e.textContent?.trim())).filter((e=>e)).join(" ");if(e)return w.default.debug("Found label text in previous row: %s",e),e}}}e=r}}}}r=r.parentNode}return w.default.info("No label found for input node"),null}function O(e,t,r,n){function o(e){const r=t.find((t=>t.xpath===e.xpath));if(r)return r.label!==e.label&&w.default.warn("Found duplicate XPath with different labels. XPath: %s, Existing label: %s, New label: %s",e.xpath,r.label,e.label),void w.default.info("Skipping duplicate input with XPath: %s",e.xpath);t.push(e)}w.default.debug("Processing inputs in section: %s",e.nodeName);const i=r(".//w:sdt",e);w.default.debug("Found %d content controls (sdt nodes)",i.length),i.forEach((e=>{const t=r("./w:sdtPr",e)[0];if(t){let n="text",i="";w.default.debug("Determining input type for sdt node: %s",e.nodeName),w.default.debug("SDT Properties node structure: %j",t.toString());if(r(".//w14:checkbox",t)[0])w.default.debug("Found checkbox node - setting input type to checkbox"),n="checkbox";else{const e=r("./w:richText",t)[0],o=r("./w:text",t)[0];w.default.info("Checking for textarea: richTextNode=%s, textNode=%s",!!e,!!o&&!!r("./w:multiLine",o)[0]),e||o&&r("./w:multiLine",o)[0]?(w.default.debug("Found rich text or multiline text node - setting input type to textarea"),n="textarea"):w.default.debug("No special nodes found - defaulting to text input type")}const s=r("./w:sdtContent",e)[0];if(s){r(".//w:t",s).forEach((e=>{i+=e.textContent||""}))}const a=R(e),c=r("./w:id",t)[0],l=c?c.getAttribute("w:val"):null,d=$(e,r);w.default.info("Processing input node - Type: %s, XPath: %s, ID: %s, Label: %s",n,a,l,d),w.default.info("Original value from XML node: %s",i),o({xpath:a,type:n,id:l,label:d,originalValue:i||null})}}));const s=r(".//w:tc",e);w.default.info("Found %d table cells to process",s.length),s.forEach((e=>{if(r('.//w:tcBorders/w:bottom[@w:val="single"]',e)[0]){const t=r(".//w:t",e).map((e=>e.textContent||"")).join("").trim();if(!n||!t||" "===t){const n=e.parentNode;if(n&&"w:tr"===n.nodeName){const i=Array.from(n.childNodes).filter((e=>"w:tc"===e.nodeName)),s=i.findIndex((t=>t===e));if(s>0){const n=i[s-1],a=r(".//w:t",n).map((e=>e.textContent?.trim())).filter((e=>e)).join(" ");if(a){w.default.info("Found label text from left cell: %s",a);const r=e;w.default.info("Using the cell node itself as the target node");o({xpath:R(r),type:"text",id:null,label:a,originalValue:t||null})}else w.default.info("Left cell exists but has no text, skipping input")}else w.default.info("No cell to the left, skipping input")}else w.default.info("Could not find parent row for cell, skipping input")}}}));const a=r(".//w:t",e);w.default.info("Found %d text nodes to process",a.length),a.forEach((e=>{const t=e.textContent||"",i=t.replace(/[\s\u00A0]/g,"");if(!n||""===i){let n=!0,i=e.parentNode;for(;i;){if("w:tc"===i.nodeName){if(r('.//w:tcBorders/w:bottom[@w:val="single"]',i)[0])break;n=!1;break}i=i.parentNode}if(n){let n=null,i="r",s=e.parentNode;for(;s&&"w:r"!==s.nodeName;)s=s.parentNode;if(s)n=s,w.default.info("Found parent w:r node");else{let t=e.parentNode;for(;t&&"w:p"!==t.nodeName;)t=t.parentNode;t&&(n=t,i="p",w.default.info("No w:r node found, falling back to w:p node"))}if(n){const e=R(n),s=$(n,r);w.default.info("Processing text node - Node type: w:%s, XPath: %s, Label: %s",i,e,s),w.default.info("Original value from XML node: %s",t),o({xpath:e,type:"text",id:null,label:s,originalValue:t||null})}else w.default.warn("No suitable node (w:t or w:r) found for text node. Skipping this text node.")}else w.default.info("Skipping text node in table cell without bottom border")}}))}async function P(e,t=!0){w.default.info("Extracting sections from DOCX buffer");const{documentXml:r,stylesXml:n}=await E(e);return I(r,n,t)}async function E(e){if(w.default.info("Extracting XML parts from DOCX buffer"),!e||0===e.length)throw new Error("Invalid buffer: Buffer is empty");try{if(!_(e))throw new Error("Invalid buffer: Not a valid ZIP archive")}catch(e){throw w.default.error("Error validating ZIP buffer:",e),new Error("Failed to validate DOCX buffer: "+e.message)}return new Promise(((t,r)=>{try{w.default.info("Opening DOCX buffer for XML extraction");let n=setTimeout((()=>{r(new Error("Operation timed out while opening DOCX buffer"))}),5e3);m.fromBuffer(e,{lazyEntries:!0},((e,o)=>{if(clearTimeout(n),e||!o)return void r(new Error(`Failed to open DOCX buffer: ${e?.message}`));w.default.info("DOCX buffer opened successfully");let i=null,s=null;const a=new Set(["word/document.xml","word/styles.xml"]);o.on("entry",(e=>{w.default.info("Found entry: %s",e.fileName),a.has(e.fileName)?o.openReadStream(e,((n,c)=>{if(n||!c)return void r(new Error(`Failed to read ${e.fileName}: ${n?.message}`));const l=[];c.on("data",(e=>l.push(e))),c.on("end",(()=>{const r=Buffer.concat(l).toString("utf8");"word/document.xml"===e.fileName?i=r:"word/styles.xml"===e.fileName&&(s=r),a.delete(e.fileName),0===a.size?(o.close(),t({documentXml:i,stylesXml:s})):o.readEntry()})),c.on("error",(t=>{r(new Error(`Error reading ${e.fileName}: ${t.message}`))}))})):o.readEntry()})),o.on("end",(()=>{w.default.info("Finished reading DOCX entries"),a.size>0&&r(new Error("Invalid .docx file: Missing "+(a.has("word/document.xml")?"document.xml":"styles.xml")))})),o.on("error",(e=>{r(new Error(`Error processing DOCX buffer: ${e.message}`))})),w.default.info("Reading first entry in DOCX buffer"),o.readEntry()}))}catch(e){r(new Error(`Error processing DOCX buffer: ${e.message}`))}}))}async function I(e,t,r=!0){w.default.info("Parsing XML document: start of document: \n%s",e.slice(0,2e3));const n=(new h.DOMParser).parseFromString(e,"application/xml");if(!n||!n.documentElement)throw new Error("Failed to parse XML document");const o=n.documentElement,i={};for(let e=0;e<o.attributes.length;e++){const t=o.attributes[e];if(t.name.startsWith("xmlns:")){i[t.name.split(":")[1]]=t.value}else"xmlns"===t.name&&(i.default=t.value)}i.w||(i.w="http://schemas.openxmlformats.org/wordprocessingml/2006/main");const s=g.useNamespaces(i),a=[];w.default.info("Selecting document body node with namespaces: %j",i);const c=s("//w:body",n);if(!c||0===c.length)throw w.default.error("Could not find document body node. Available nodes: %s",Array.from(n.documentElement.childNodes).filter((e=>1===e.nodeType)).map((e=>e.nodeName)).join(", ")),new Error("Could not find document body node");const l=c[0];if(!l)throw new Error("Document body node is null");const u=Array.from(l.childNodes||[]);w.default.info("Found %d child nodes in document body",u.length);for(let e=0;e<u.length;e++){const n=u[e];if(1===n.nodeType)try{w.default.info("Processing section node: %s",n.nodeName);const e=R(n),i=(new h.XMLSerializer).serializeToString(n),c=[];O(n,c,s,r);const l=Array.from(o.attributes),u=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n  <w:document ${l.filter((e=>e.name.startsWith("xmlns:")||"xmlns"===e.name)).map((e=>`${e.name}="${e.value}"`)).join(" ")}>\n    <w:body>\n      ${i}\n    </w:body>\n  </w:document>`;w.default.info("Converting section to HTML: %s",e);const f=new y.ZipFile;w.default.info("Adding content types to zip");const p='<?xml version="1.0" encoding="UTF-8"?>\n<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">\n  <Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>\n  <Default Extension="xml" ContentType="application/xml"/>\n  <Override PartName="/word/document.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml"/>\n  <Override PartName="/word/styles.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml"/>\n</Types>';f.addBuffer(Buffer.from(p),"[Content_Types].xml"),w.default.info("Adding relationships to zip");const g='<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">\n  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="word/document.xml"/>\n</Relationships>';f.addBuffer(Buffer.from(g),"_rels/.rels"),w.default.info("Adding document.xml to zip"),f.addBuffer(Buffer.from(u),"word/document.xml"),w.default.info("Adding styles.xml to zip"),f.addBuffer(Buffer.from(t),"word/styles.xml"),w.default.info("Adding document.xml.rels to zip");const m='<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">\n  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="styles.xml"/>\n</Relationships>';f.addBuffer(Buffer.from(m),"word/_rels/document.xml.rels"),w.default.info("Finalizing zip");const v=await new Promise(((e,t)=>{const r=[];f.outputStream.on("data",(e=>r.push(e))),f.outputStream.on("end",(()=>e(Buffer.concat(r)))),f.outputStream.on("error",t),f.end()}));w.default.info("Converting section to HTML");const _=await d.convertToHtml({buffer:v});w.default.info("Mammoth result: %s",_);const b={xpath:e,convertedHtml:_.value,potentialInputs:c};w.default.info("Unescaped RAW XML for the section: %s",i),w.default.info("Resulting section: %s",JSON.stringify(b,null,2)),a.push(b)}catch(t){w.default.error(t),w.default.error("Failed to convert XML to HTML for section with index %s: %s",e,t.message)}}return{sections:a}}async function C(e,t=!1){w.default.info("Extracting sections from DOCX file: %s",e);return P(c.readFileSync(e),t)}if(r.c[r.s]===e){const e=process.argv.slice(2);e.length<1&&(console.error("Usage: node docxExtractor.js <path-to-docx-file> [sections|xml]"),process.exit(1));const t=e[0],r=e[1]||"sections";let n=!0;switch(e.length>1&&"false"===e[1]&&(n=!1),r){case"sections":C(t,n).then((e=>{console.log(JSON.stringify(e,null,2))})).catch((e=>{console.error("Failed to extract DOCX sections:",e),process.exit(1)}));break;case"xml":S(t).then((e=>{console.log(e)})).catch((e=>{console.error("Failed to extract DOCX XML:",e),process.exit(1)}));break;default:console.error('Invalid command. Use "sections" or "xml"'),process.exit(1)}}},3239:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SummaryCompletion=void 0;const s=r(3563),a=r(1162),c=r(1544),l=r(1486),d=r(724),u=i(r(9055)),f=r(2003);let p=class{constructor(){this.chatModelManager=c.ChatModelManager.getInstance()}async getSummary(e,t,r=a.ModelCategory.SUMMARISATION,n=!1,o){if(!t)throw new Error("Input content is empty - some models require input content to produce a summary");const i=o?new f.AgentConfig(o):new f.AgentConfig,s=await this.chatModelManager.getModel(i,r,n),c=[new l.SystemMessage(e),new l.HumanMessage(t)],p=new d.StringOutputParser,h=Date.now(),g=await s.baseChatModel.invoke(c),m=await p.invoke(g),y=Date.now()-h;return u.default.info("Summary produced by %s in %sms: %s",s.modelDescriptor.getFullName(),y,m),m}async getSummaryJson(e,t,r=a.ModelCategory.SUMMARISATION,n=!1,o){u.default.debug(`Getting summary JSON for prompt: ${e}`);const i=function(e){const t=e.indexOf("{"),r=e.indexOf("[");let n,o,i;if(-1!==t&&(-1===r||t<r))n=t,o="{",i="}";else{if(-1===r)return null;n=r,o="[",i="]"}let s=n+1,a=1;for(;s<e.length&&a>0;){const t=e[s];t===o?a++:t===i&&a--,s++}return 0===a?e.substring(n,s):null}((await this.getSummary(e,t,r,n,o)).trim());if(!i)throw new Error("No valid JSON object or array found in response");try{return JSON.parse(i),i}catch(e){throw new Error(`Failed to parse JSON from extracted content: ${e.message}`)}}};t.SummaryCompletion=p,t.SummaryCompletion=p=n([(0,s.Injectable)(),o("design:paramtypes",[])],p)},3297:e=>{"use strict";e.exports=require("tree-sitter-rust")},3381:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StoredDocService=void 0;const d=r(3563),u=r(3543),f=r(8648),p=a(r(1943)),h=a(r(857)),g=a(r(6928)),m=r(3903),y=l(r(9055));let v=class{constructor(e){this.storedDocRepository=e}async storeDoc(e,t,r,n){const o=new u.StoredDoc(e,t,r,n);return await this.storedDocRepository.save(o),y.default.info(`Stored new document with ID: ${o.id}, sessionId: ${r||"none"}, workspaceName: ${n||"none"}`),o}async getDoc(e){const t=await this.storedDocRepository.findById(e);return t?y.default.info(`Retrieved document with ID: ${e}`):y.default.info(`Document not found with ID: ${e}`),t}async getDocMetadata(e){return this.storedDocRepository.findByIdWithoutContents(e)}async getDocsBySession(e){const t=await this.storedDocRepository.findBySessionId(e);return y.default.info(`Retrieved ${t.length} documents for session: ${e}`),t}async getDocsByWorkspace(e){const t=await this.storedDocRepository.findByWorkspaceName(e);return y.default.info(`Retrieved ${t.length} documents for workspace: ${e}`),t}async withFile(e,t){const r=await this.getDoc(e);if(!r)throw new Error(`Document not found with id: ${e}`);const n=await p.mkdtemp(g.join(h.tmpdir(),"hldk-")),o=g.join(n,`${(0,m.v4)()}`);y.default.info(`Created temporary file for document ${e}: ${o}`);try{await p.writeFile(o,r.contents);return await t(o)}finally{try{await p.unlink(o),await p.rmdir(n)}catch(e){y.default.error("Error cleaning up temporary file:",e)}}}};t.StoredDocService=v,t.StoredDocService=v=s([(0,d.Injectable)(),c("design:paramtypes",[f.StoredDocRepository])],v)},3409:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReplaceInFileTool=void 0;const u=r(3563),f=c(r(1943)),p=c(r(6928)),h=d(r(9055)),g=r(9581),m=r(6006),y=r(4243);let v=o=class{constructor(e,t){this.name="replace_in_file",this.description="Request to replace sections of content in an existing file using SEARCH/REPLACE blocks.",this.workingDir=e,this.fileValidationService=t}getFailureHandlingSuggestion(e){return e>=3?`The 'replace_in_file' tool has failed ${e} times consecutively. Consider using the 'write_to_file' tool with the complete intended file content instead. Keep in mind that using write_to_file means you'll be re-writing the entire contents of the file, so ensure you include ALL parts of the file in your write_to_file operation, not just the sections you want to change.`:null}getUsageInstructions(e){return`## replace_in_file\nDescription: Request to replace sections of content in an existing file using SEARCH/REPLACE blocks that define exact changes to specific parts of the file. This tool should be used when you need to make targeted changes to specific parts of a file.\nParameters:\n- path: (required) The path of the file to modify (relative to the current working directory ${e.workingDir})\n- diff: (required) One or more SEARCH/REPLACE blocks following this exact format:\n  \`\`\`\n  <<<<<<< SEARCH\n  [exact content to find]\n  =======\n  [new content to replace with]\n  >>>>>>> REPLACE\n  \`\`\`\n  Critical rules:\n  1. SEARCH content must match the associated file section to find EXACTLY:\n     * Match character-for-character including whitespace, indentation, line endings\n     * Include all comments, docstrings, etc.\n  2. SEARCH/REPLACE blocks will ONLY replace the first match occurrence.\n     * Including multiple unique SEARCH/REPLACE blocks if you need to make multiple changes.\n     * Include *just* enough lines in each SEARCH section to uniquely match each set of lines that need to change.\n     * When using multiple SEARCH/REPLACE blocks, list them in the order they appear in the file.\n  3. Keep SEARCH/REPLACE blocks concise:\n     * Break large SEARCH/REPLACE blocks into a series of smaller blocks that each change a small portion of the file.\n     * Include just the changing lines, and a few surrounding lines if needed for uniqueness.\n     * Do not include long runs of unchanging lines in SEARCH/REPLACE blocks.\n     * Each line must be complete. Never truncate lines mid-way through as this can cause matching failures.\n  4. Special operations:\n     * To move code: Use two SEARCH/REPLACE blocks (one to delete from original + one to insert at new location)\n     * To delete code: Use empty REPLACE section\nUsage:\n<replace_in_file>\n<path>File path here</path>\n<diff>\nSearch and replace blocks here\n</diff>\n</replace_in_file>`}validateParams(e){return"string"==typeof e.path&&""!==e.path.trim()&&"string"==typeof e.diff&&""!==e.diff.trim()}async execute(e){const{path:t,diff:r}=e;h.default.info(`[${o.name}] Replacing content in file: ${t} relative to ${this.workingDir}`);const n=p.resolve(this.workingDir,t);if(!n.startsWith(this.workingDir)){const e=`Path traversal attempt detected: ${t} resolves outside of workspace ${this.workingDir}`;throw h.default.error(`[${o.name}] ${e}`),new g.FileSystemError(e,"PATH_TRAVERSAL_ERROR")}try{let e;try{e=await f.stat(n)}catch(e){if("ENOENT"===e.code){const e=`File not found: ${t}`;throw h.default.error(`[${o.name}] ${e}`),new g.FileNotFoundError(e,t)}throw e}if(!e.isFile()){const e=`Path is not a file: ${t}`;throw h.default.error(`[${o.name}] ${e}`),new g.FileNotFoundError(e,t)}const i=await f.readFile(n,"utf8"),s=this.applyDiff(i,r);await f.writeFile(n,s,"utf8"),h.default.info(`[${o.name}] File ${t} modified successfully`);let a=`File ${t} modified successfully`,c="";try{const e=await this.fileValidationService.validateFile(t,this.workingDir);e.hasErrors&&(c+="\n\nSyntax Validation Issues Found:",c+=`\n- ${e.report}`)}catch(e){h.default.error(`[${o.name}] Validation step failed for ${t}: ${e.message}`),c="\n\nNote: Syntax validation step encountered an error."}return a+=c,a}catch(e){if(e instanceof g.FileNotFoundError||e instanceof g.FileSystemError)throw e;const r=`Error replacing content in file ${t}: ${e.message}`;throw h.default.error(`[${o.name}] ${r}\n${e.stack}`),new g.FileSystemError(r,e.code||"FS_REPLACE_ERROR")}}applyDiff(e,t){try{return(0,m.applyDiff)(e,t)}catch(e){throw h.default.error(`[${o.name}] Error in applyDiff: ${e.message}`),e}}};t.ReplaceInFileTool=v,t.ReplaceInFileTool=v=o=a([(0,u.Injectable)(),l("design:paramtypes",[String,y.FileValidationService])],v)},3433:e=>{"use strict";e.exports=require("tree-sitter-python")},3470:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentRuleService=void 0;const i=r(3563),s=r(5025),a=r(5862);let c=class{constructor(e){this.ruleRepository=e}async getRulesByAgentName(e){const t=await this.ruleRepository.findByAgentName(e);return t||new a.AgentRule(e,"",new Date,new Date)}async upsertRule(e,t){const r=new a.AgentRule(e,t,new Date,new Date);await this.ruleRepository.upsert(r)}};t.AgentRuleService=c,t.AgentRuleService=c=n([(0,i.Injectable)(),o("design:paramtypes",[s.AgentRuleRepository])],c)},3520:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentController=void 0;const a=r(3563),c=r(1412),l=r(3470),d=s(r(9055));let u=class{constructor(e,t){this.agentServices=e,this.agentRuleService=t}getAgentService(e){const t=this.agentServices.get(e);if(!t)throw new Error(`Unknown agent: ${e}`);return t}async processRequestWithStream(e,t,r){try{const n=c.AgentRequest.fromJSON(t);r.setHeader("Content-Type","text/event-stream"),r.setHeader("Cache-Control","no-cache"),r.setHeader("Connection","keep-alive"),r.setHeader("Location",`/sessions/${n.sessionId}/stream`);for await(const t of this.getAgentService(e).processRequestStream(n))r.write(`data: ${JSON.stringify(t)}\n\n`);r.end()}catch(e){d.default.error(`Error processing request: ${e.message}`,e.stack),r.setHeader("Content-Type","application/json"),r.status(a.HttpStatus.BAD_REQUEST).json({statusCode:a.HttpStatus.BAD_REQUEST,message:"Error processing request",error:e.message,stack:void 0})}}async processRequestNoStream(e,t,r){try{const n=c.AgentRequest.fromJSON(t),o=await this.getAgentService(e).processRequest(n);d.default.info("Returning result: %s",JSON.stringify(o)),r.setHeader("Content-Type","application/json"),r.json(o)}catch(e){d.default.error(`Error processing request: ${e.message}`,e.stack),r.status(a.HttpStatus.BAD_REQUEST).json({statusCode:a.HttpStatus.BAD_REQUEST,message:"Error processing request",error:e.message,stack:void 0})}}async processRequestAndGetContent(e,t,r){try{const n=c.AgentRequest.fromJSON(t);let o=(await this.getAgentService(e).processRequest(n)).responseContent.trim();d.default.info("Raw result: %s",o);const i=r.req.headers.accept;if(i&&i.includes("application/json"))try{const e=o.match(/\{[\s\S]*\}/);if(e){const t=JSON.parse(e[0]);return o=t,d.default.info("Extracted JSON content: %s",JSON.stringify(t)),r.setHeader("Content-Type","application/json"),void r.json(t)}}catch(e){d.default.warn("Failed to extract JSON from response content: %s",e.message)}r.setHeader("Content-Type","text/plain"),r.send(o)}catch(e){d.default.error(`Error processing request: ${e.message}`,e.stack),r.status(a.HttpStatus.BAD_REQUEST).json({statusCode:a.HttpStatus.BAD_REQUEST,message:"Error processing request",error:e.message,stack:void 0})}}async getRules(e){return this.agentRuleService.getRulesByAgentName(e)}async updateRules(e,t){return await this.agentRuleService.upsertRule(e,t.content),{success:!0}}};t.AgentController=u,n([(0,a.Post)(":name/stream"),(0,a.HttpCode)(a.HttpStatus.OK),i(0,(0,a.Param)("name")),i(1,(0,a.Body)()),i(2,(0,a.Res)()),o("design:type",Function),o("design:paramtypes",[String,String,Object]),o("design:returntype",Promise)],u.prototype,"processRequestWithStream",null),n([(0,a.Post)(":name"),(0,a.HttpCode)(a.HttpStatus.OK),i(0,(0,a.Param)("name")),i(1,(0,a.Body)()),i(2,(0,a.Res)()),o("design:type",Function),o("design:paramtypes",[String,String,Object]),o("design:returntype",Promise)],u.prototype,"processRequestNoStream",null),n([(0,a.Post)(":name/responseContent"),(0,a.HttpCode)(a.HttpStatus.OK),i(0,(0,a.Param)("name")),i(1,(0,a.Body)()),i(2,(0,a.Res)()),o("design:type",Function),o("design:paramtypes",[String,String,Object]),o("design:returntype",Promise)],u.prototype,"processRequestAndGetContent",null),n([(0,a.Get)(":name/rules"),i(0,(0,a.Param)("name")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"getRules",null),n([(0,a.Put)(":name/rules"),i(0,(0,a.Param)("name")),i(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],u.prototype,"updateRules",null),t.AgentController=u=n([(0,a.Controller)("agents"),i(0,(0,a.Inject)("AGENT_SERVICES")),o("design:paramtypes",[Map,l.AgentRuleService])],u)},3543:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoredDoc=void 0;const n=r(9100);t.StoredDoc=class{constructor(e,t,r,o,i=(0,n.ulid)(),s=new Date){if(this.id=i,this.contents=e,this.sessionId=r,this.workspaceName=o,this.createdAt=s,t)this.mimeType=t;else try{JSON.parse(e),this.mimeType="application/json"}catch{e.trim().startsWith("<")&&e.trim().endsWith(">")?this.mimeType="text/html":this.mimeType="text/plain"}}}},3548:e=>{"use strict";e.exports=require("@langchain/ollama")},3563:e=>{"use strict";e.exports=require("@nestjs/common")},3569:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigController=void 0;const a=r(3563),c=r(9102),l=r(8620),d=r(9668),u=s(r(9055));let f=class{constructor(e,t,r){this.eveConfigService=e,this.llmMetadataService=t,this.userService=r,this.serviceName="ConfigController"}async getAllProviders(){try{const e=await this.eveConfigService.getAllProviders();return u.default.info(`[${this.serviceName}] Successfully retrieved ${e.length} providers`),e}catch(e){throw u.default.error(`[${this.serviceName}] Failed to get providers: ${e.message}`,e.stack),new Error(`Failed to retrieve providers: ${e.message}`)}}async getModelsForProvider(e){try{const t=await this.eveConfigService.getModelsForProvider(e);return u.default.info(`[${this.serviceName}] Successfully retrieved ${t.length} models for provider ${e}`),t}catch(t){throw u.default.error(`[${this.serviceName}] Failed to get models for provider ${e}: ${t.message}`,t.stack),new Error(`Failed to retrieve models for provider ${e}: ${t.message}`)}}async getAllModes(){try{const e=await this.eveConfigService.getAllModes();return u.default.info(`[${this.serviceName}] Successfully retrieved ${e.length} agent modes`),e}catch(e){throw u.default.error(`[${this.serviceName}] Failed to get modes: ${e.message}`,e.stack),new Error(`Failed to retrieve agent modes: ${e.message}`)}}async getUserConfiguration(e){try{const e=await this.userService.getCurrentUser(),t=await this.eveConfigService.getUserConfiguration(e.userId);return u.default.info(`[${this.serviceName}] Successfully retrieved configuration for user ${e.userId}`),t}catch(e){if(e instanceof d.AuthenticationError)throw u.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw u.default.error(`[${this.serviceName}] Failed to get user configuration: ${e.message}`,e.stack),new Error(`Failed to retrieve user configuration: ${e.message}`)}}async setActiveProviderForMode(e,t,r){try{const e=await this.userService.getCurrentUser();return await this.eveConfigService.setActiveProviderForMode(e.userId,t,r.activeProviderId),u.default.info(`[${this.serviceName}] Successfully set active provider ${r.activeProviderId} for mode ${t} and user ${e.userId}`),await this.eveConfigService.getUserConfiguration(e.userId)}catch(e){if(e instanceof d.AuthenticationError)throw u.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw u.default.error(`[${this.serviceName}] Failed to set active provider for mode ${t}: ${e.message}`,e.stack),new Error(`Failed to set active provider for mode ${t}: ${e.message}`)}}async updateUserModeConfiguration(e,t,r,n){try{const e=await this.userService.getCurrentUser();if(await this.eveConfigService.updateUserModeConfiguration(e.userId,t,r,n),u.default.info(`[${this.serviceName}] Successfully updated configuration for user ${e.userId}, mode ${t}, and provider ${r}`),n.apiKey)try{await this.shareApiKeyAcrossModes(e.userId,r,n.apiKey,n.baseUrl),u.default.info(`[${this.serviceName}] Shared API key for provider ${r} across all modes`)}catch(e){u.default.error(`[${this.serviceName}] Error sharing API key: ${e.message}`,e.stack)}return await this.eveConfigService.getUserConfiguration(e.userId)}catch(e){if(e instanceof d.AuthenticationError)throw u.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw u.default.error(`[${this.serviceName}] Failed to update user configuration for mode ${t} and provider ${r}: ${e.message}`,e.stack),new Error(`Failed to update configuration for mode ${t} and provider ${r}: ${e.message}`)}}async refreshModelsForProvider(e,t,r){try{const e=await this.userService.getCurrentUser();u.default.info(`[${this.serviceName}] Refreshing models for provider ${t}`);let n=r.apiKey;if(!n){u.default.info(`[${this.serviceName}] No API key provided in request, checking user configuration`);const r=await this.eveConfigService.findApiKeyForProvider(e.userId,t);r&&r.apiKey&&(n=r.apiKey,u.default.info(`[${this.serviceName}] Using API key from user configuration`))}await this.llmMetadataService.refreshModelsForProvider(t,n,r.baseUrl),u.default.info(`[${this.serviceName}] Successfully refreshed models for provider ${t}`);const o=await this.eveConfigService.getModelsForProvider(t);return u.default.info(`[${this.serviceName}] Returning ${o.length} models for provider ${t}`),o}catch(e){if(e instanceof d.AuthenticationError)throw u.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw u.default.error(`[${this.serviceName}] Failed to refresh models for provider ${t}: ${e.message}`,e.stack),new Error(`Failed to refresh models for provider ${t}: ${e.message}`)}}async shareApiKeyAcrossModes(e,t,r,n){try{u.default.info(`[${this.serviceName}] Sharing API key for provider ${t} across all modes for user ${e}`);const o=await this.eveConfigService.getAllModes(),i=await this.eveConfigService.getUserConfiguration(e);for(const s of o){const o=i[s.modeId],a=o?.providerSettings[t];a?.isApiKeySet?u.default.info(`[${this.serviceName}] Skipped updating API key for user ${e}, mode ${s.modeId}, provider ${t} (already set)`):(await this.eveConfigService.updateUserModeConfiguration(e,s.modeId,t,{apiKey:r,baseUrl:n}),u.default.info(`[${this.serviceName}] Set API key for user ${e}, mode ${s.modeId}, provider ${t}`))}u.default.info(`[${this.serviceName}] Successfully shared API key for provider ${t} across modes that didn't have one set`)}catch(e){throw u.default.error(`[${this.serviceName}] Error sharing API key: ${e.message}`,e.stack),e}}};t.ConfigController=f,n([(0,a.Get)("providers"),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],f.prototype,"getAllProviders",null),n([(0,a.Get)("providers/:providerId/models"),i(0,(0,a.Param)("providerId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],f.prototype,"getModelsForProvider",null),n([(0,a.Get)("modes"),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],f.prototype,"getAllModes",null),n([(0,a.Get)("user"),i(0,(0,a.Req)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],f.prototype,"getUserConfiguration",null),n([(0,a.Put)("user/modes/:modeId"),i(0,(0,a.Req)()),i(1,(0,a.Param)("modeId")),i(2,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object,String,Object]),o("design:returntype",Promise)],f.prototype,"setActiveProviderForMode",null),n([(0,a.Put)("user/modes/:modeId/providers/:providerId"),i(0,(0,a.Req)()),i(1,(0,a.Param)("modeId")),i(2,(0,a.Param)("providerId")),i(3,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object,String,String,Object]),o("design:returntype",Promise)],f.prototype,"updateUserModeConfiguration",null),n([(0,a.Post)("providers/:providerId/refresh-models"),i(0,(0,a.Req)()),i(1,(0,a.Param)("providerId")),i(2,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object,String,Object]),o("design:returntype",Promise)],f.prototype,"refreshModelsForProvider",null),t.ConfigController=f=n([(0,a.Controller)("eve/config"),o("design:paramtypes",[c.EveConfigService,l.LlmMetadataService,d.UserService])],f)},3690:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleAgentModule=void 0;const o=r(3563),i=r(5873),s=r(3880),a=r(4193),c=r(9161);let l=class{};t.SimpleAgentModule=l,t.SimpleAgentModule=l=n([(0,o.Module)({imports:[i.WorkspaceModule,s.SessionModule,a.HomeModule,c.ChatCompletionModule],exports:[]})],l)},3713:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigDescriptors=t.ConfigSection=t.ConfigPropertyDescriptor=void 0;const n=r(6910),o=r(1544),i=r(1986),s=r(4264),a=r(59),c=r(4659);class l{constructor(e,t,r,n,o,i,s){this.label=e,this.name=t,this.type=r,this.description=n,this.sensitive=o,this.defaultValue=i,this.possibleValues=s}}t.ConfigPropertyDescriptor=l;class d{constructor(e,t){this.title=e,this.properties=t}}t.ConfigSection=d;class u{constructor(e){this.sections=e}static getDefaultDescriptors(){const e=async()=>o.ChatModelManager.getInstance().getValidModelFullNames();return new u([new d("API Keys",[new l("Eve API Key",n.ConfigPropNames.EVE_API_KEY,"string","Eve API Key",!0),new l("Google API Key",n.ConfigPropNames.GOOGLE_API_KEY,"string","Google API Key for Gemini models",!0),new l("Anthropic API Key",n.ConfigPropNames.ANTHROPIC_API_KEY,"string","Anthropic API Key",!0),new l("OpenAI API Key",n.ConfigPropNames.OPENAI_API_KEY,"string","OpenAI API Key",!0),new l("Groq API Key",n.ConfigPropNames.GROQ_API_KEY,"string","Groq API Key",!0),new l("Hyperbolic API Key",n.ConfigPropNames.HYPERBOLIC_API_KEY,"string","Hyperbolic API Key",!0),new l("Mistral API Key",n.ConfigPropNames.MISTRAL_API_KEY,"string","Mistral API Key",!0),new l("OpenRouter API Key",n.ConfigPropNames.OPENROUTER_API_KEY,"string","OpenRouter API Key",!0),new l("GLHF Chat API Key",n.ConfigPropNames.GLHF_API_KEY,"string","GLHF Chat API Key",!0),new l("DeepSeek API Key",n.ConfigPropNames.DEEPSEEK_API_KEY,"string","DeepSeek API Key",!0),new l("SerpAPI Key",n.ConfigPropNames.SERP_API_KEY,"string","SerpAPI Key for web search functionality",!0)]),new d("Default Models",[new l("Coding Model",n.ConfigPropNames.DEFAULT_CODING_MODEL,"enum","Coding Model",!1,"anthropic/"+i.AnthropicProvider.SONNET_MODEL_NAME,e),new l("Reasoning Model",n.ConfigPropNames.DEFAULT_REASONING_MODEL,"enum","Reasoning Model",!1,"openai/"+s.OpenAIProvider.GPT_4O_MODEL_NAME,e),new l("Summarisation Model",n.ConfigPropNames.DEFAULT_SUMMARISATION_MODEL,"enum","Summarisation Model",!1,c.GroqProvider.LLAMA_31_8BB_INSTANT,e),new l("RAG Query Model",n.ConfigPropNames.DEFAULT_RAG_QUERY_MODEL,"enum","RAG Query Model",!1,"openai/"+s.OpenAIProvider.GPT_4O_MODEL_NAME,e),new l("Orchestration Model",n.ConfigPropNames.DEFAULT_ORCHESTRATION_MODEL,"enum","Orchestration Model",!1,"openai/"+s.OpenAIProvider.GPT_4O_MODEL_NAME,e),new l("Architect Model",n.ConfigPropNames.DEFAULT_ARCHITECT_MODEL,"enum","Architect Model",!1,"anthropic/"+i.AnthropicProvider.SONNET_MODEL_NAME,e)]),new d("Private Models",[new l("Coding Model",n.ConfigPropNames.PRIVATE_CODING_MODEL,"enum","Private Coding Model",!1,a.GlhfProvider.META_LLAMA_3_3_70B_INSTRUCT,e),new l("Reasoning Model",n.ConfigPropNames.PRIVATE_REASONING_MODEL,"enum","Private Reasoning Model",!1,a.GlhfProvider.META_LLAMA_3_3_70B_INSTRUCT,e),new l("Summarisation Model",n.ConfigPropNames.PRIVATE_SUMMARISATION_MODEL,"enum","Private Summarisation Model",!1,c.GroqProvider.LLAMA_31_8BB_INSTANT,e),new l("RAG Query Model",n.ConfigPropNames.PRIVATE_RAG_QUERY_MODEL,"enum","Private RAG Query Model",!1,a.GlhfProvider.META_LLAMA_3_3_70B_INSTRUCT,e),new l("Orchestration Model",n.ConfigPropNames.PRIVATE_ORCHESTRATION_MODEL,"enum","Private Orchestration Model",!1,a.GlhfProvider.META_LLAMA_3_3_70B_INSTRUCT,e),new l("Architect Model",n.ConfigPropNames.PRIVATE_ARCHITECT_MODEL,"enum","Private Architect Model",!1,a.GlhfProvider.META_LLAMA_3_3_70B_INSTRUCT,e)]),new d("Ollama",[new l("Ollama Base URL",n.ConfigPropNames.OLLAMA_BASE_URL,"string","Ollama Base URL - default: http://localhost:11434",!1)]),new d("MCP Servers",[new l("MCP Servers Enabled",n.ConfigPropNames.MCP_SERVERS_ENABLED,"boolean","Enable or disable MCP servers",!1,!0),new l("MCP Servers Directory",n.ConfigPropNames.MCP_SERVERS_DIRECTORY,"string","Directory containing MCP servers",!1,"~/.eve/mcp-servers")]),new d("Misc",[new l("Agent Recursion Limit",n.ConfigPropNames.AGENT_RECURSION_LIMIT,"number","How many times a graph based agent can call itself recursively before halting",!1,50),new l("Agent Iteration Limit",n.ConfigPropNames.AGENT_ITERATION_LIMIT,"number","How many times a simple agent can iterate before halting",!1,50),new l("Agent System Prompt",n.ConfigPropNames.AGENT_SYSTEM_PROMPT,"number","Maximum length of the system prompt for agents",!1,1e5),new l("Dashboard £ per LOC",n.ConfigPropNames.VALUE_PER_LINE,"number","Approximate value created per line of code generated in £",!1,2.4),new l("Command Output Max Length",n.ConfigPropNames.COMMAND_OUTPUT_MAX_LENGTH,"number","Maximum length of command output (stdout/stderr) in characters",!1,1e4),new l("Command Output Prefix Length",n.ConfigPropNames.COMMAND_OUTPUT_PREFIX_LENGTH,"number","When command output is clipped, how many characters to keep from the beginning",!1,200)])])}}t.ConfigDescriptors=u},3716:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GitInit=void 0;const c=r(5534),l=r(1569),d=a(r(9055)),u=s(r(6928)),f=s(r(9896)),p=a(r(3807));class h extends c.Tool{constructor(e){super(),this.name="git_init",this.description="Initialize a git repository in the specified directory if it's not already a git repository",this.schema=l.z.object({folder:l.z.string().describe("The folder relative to the workspace root to initialize as a git repository")}),this.workspaceRootDir=e,this.maxOutputChars=parseInt(process.env.MAX_TOOL_OUTPUT_CHARS||"2000",10)}clipOutput(e){return e.length>this.maxOutputChars?`Large output detected so clipped to last ${this.maxOutputChars} chars...\n${e.slice(-this.maxOutputChars)}`:e}async _call({folder:e}){try{d.default.info(`Initializing git repository in ${e} under workspace ${this.workspaceRootDir}`);const t=u.join(this.workspaceRootDir,e);if(!f.existsSync(t))return`Error: The directory ${t} does not exist.`;const r=u.join(t,".git");if(f.existsSync(r))return`The directory ${t} is already a git repository.`;const n=(0,p.default)(t);return await n.init(),`Successfully initialized git repository in ${t}`}catch(e){d.default.warn(`Error initializing git repository: ${e.message}`,e);return`Error initializing git repository:\nError:\n${this.clipOutput(e.message)}`}}}t.GitInit=h},3765:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CommandLine=void 0;const o=r(5534),i=r(1569),s=r(5317),a=r(9023),c=n(r(9055)),l=n(r(6928)),d=r(1162),u=(0,a.promisify)(s.exec);class f extends o.Tool{constructor(e,t){super(),this.name="command_line",this.description="Execute a command line instruction in the workspace directory or a subdirectory",this.schema=i.z.object({command:i.z.string().describe("The command to execute"),subDir:i.z.string().optional().describe("Optional subdirectory relative to the workspace root to execute the command in")}),this.privateRequired=!1,this.summaryPrompt="\n  You are a helpful assistant that summarises text. Your job is present the minumum useful information in the shortest way possible.\n  Summarise the following text pulling out just the interesting things. For example:\n  \n  a) If it looks like test output:\n     - If all tests passed, just say that and mention how many tests passed if possible.\n     - IF THERE ARE ANY FAILURES THEN YOU MUST ALL INFORMATION ABOUT ALL OF THE ERRORS INCLUDING ALL OF THE STACK TRACES OR ERROR INFORMATION AND INCLUDE ALL FILES/LINE NUMBERS ETC.\n     - ALSO INCLUDE ALL THE DEBUG/CONSOLE OUTPUT THAT IS RELATED TO THE TESTS THAT FAILED. IT IS BETTER TO INCLUDE TOO MUCH INFORMATION THAN TOO LITTLE.\n\n  b) If it's something else, then just pull out the most important information.",this.workspaceRootDir=e,this.maxOutputChars=parseInt(process.env.MAX_TOOL_OUTPUT_CHARS||"20000"),this.summaryCompletion=t}setPrivateRequired(e){this.privateRequired=e}async summariseOutput(e,t){const r="Stdout:\n"+e+"\nStderr:\n"+t;if(r.length>this.maxOutputChars){if(this.summaryCompletion){c.default.debug(`Summarising large command output - ${r.length} chars - content:\n ${r}`);const e=await this.summaryCompletion.getSummary(this.summaryPrompt,r,d.ModelCategory.SUMMARISATION,this.privateRequired);return c.default.info(`Summarised large command output - reduced ${r.length} chars to ${e.length}`),e}{const n=this.clipString(e),o=this.clipString(t);return`Summarised large command output - reduced ${r.length} chars to ${n.length+o.length}:\n${n}\n${o}`}}return r}clipString(e){return e.length>this.maxOutputChars?e.slice(-this.maxOutputChars):e}async _call({command:e,subDir:t}){try{const r=t&&"."!==t?l.default.join(this.workspaceRootDir,t):this.workspaceRootDir;c.default.info(`Executing command: ${e} in directory: ${r}`);const{stdout:n,stderr:o}=await u(e,{cwd:r});return`Successfully executed command:\n${e}\nWorking Directory: ${r}\nOutput was:\n${await this.summariseOutput(n,o)}`}catch(t){c.default.warn(`Error executing command: ${e}`,t),c.default.warn(`Error stdout: ${t.stdout}`),c.default.warn(`Error stderr: ${t.stderr}`);const r=t.stdout||"",n=t.stderr||"";return`Error encountered when executing command:\n${e}\nOutput was:\n${await this.summariseOutput(r,n)}\nError was:\n${this.clipString(t.message)}`}}}t.CommandLine=f},3807:e=>{"use strict";e.exports=require("simple-git")},3864:e=>{"use strict";e.exports=require("command-exists")},3877:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBasePrompt=function(){return"You are Eve, a highly skilled software engineer with extensive knowledge \nin many programming languages, frameworks, design patterns, and best practices.\n\nAs a software engineer, you excel at:\n- Analyzing and understanding complex codebases\n- Designing elegant and maintainable software architectures \n- Implementing efficient and robust solutions\n- Debugging and troubleshooting technical issues\n- Following best practices and coding standards\n- Considering performance, security, and scalability in your solutions\n\nYou provide technical, concise responses focused on delivering high-quality code and \npractical solutions. You prioritize clarity, maintainability, and following established \nconventions in the codebase you're working with."}},3880:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionModule=void 0;const o=r(3563),i=r(376),s=r(5480),a=r(4143),c=r(7373),l=r(3936),d=r(9095),u=r(811),f=r(3177);let p=class{};t.SessionModule=p,t.SessionModule=p=n([(0,o.Module)({imports:[i.DataSourceModule,f.MutationsModule],controllers:[s.SessionController,a.RequestController],providers:[c.SessionService,l.SessionRepository,d.ItemRepository,u.RequestRepository],exports:[c.SessionService]})],p)},3887:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpsAgentService=void 0;const d=r(3563),u=a(r(9896)),f=r(3470),p=a(r(6928)),h=r(5277),g=r(6158),m=r(2300);let y=class extends h.GraphAgentService{constructor(e,t,r){super(e,t,r),this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}getName(){return"ops-agent"}async getTools(e){return await this.toolFactoryService.createTools(["read_file","update_file","delete_file","command_line","add_workspace","fetch_web_page","git_init","serp_api"],e)}async getSystemPrompt(e){let t="";const r=p.join(e.workspace.repoBaseDir,"ops-hints.md");u.existsSync(r)&&(t=u.readFileSync(r,"utf-8"));const n=process.platform,o="win32"===n?"Windows":"darwin"===n?"macOS":"Linux";return`\n    You are a helpful DevOps agent specializing in system operations, automation, and infrastructure management. Your task is to assist with various DevOps-related tasks and solve problems using the tools provided.\n\n    WORKSPACE INFORMATION:\n    Current working directory: ${e.workspace.repoBaseDir}\n    Current operating system: ${o}\n\n    AVAILABLE TOOLS AND THEIR USAGE:\n\n    1. File Operations:\n       - read_file: Read the contents of any file in the workspace\n       - update_file: Modify file contents (requires filePath, search text, and replacement text)\n       - delete_file: Remove a file (use with caution, confirm before deleting important files)\n\n    2. System Operations:\n       - command_line: Execute shell commands\n         * Can specify a subdirectory to run commands in\n         * Use for package management, build tools, and system commands\n         * ALWAYS include automatic confirmation flags to prevent hanging:\n           - Use --yes or -y for apt, apt-get\n           - Use -y for yum\n           - Use --no-input for pip\n           - Use -f or --force for npm/pnpm\n           - Use --defaults for yeoman\n           - Use --non-interactive for composer\n           - Use --assume-yes for other tools\n           - Add appropriate silent/quiet flags when available\n         * DO NOT use for process termination or destructive operations\n       \n    3. Git and Repository Management:\n       - git_init: Initialize a new Git repository\n       - Always use 'git add -A' for staging changes\n\n    5. Additional Tools:\n       - add_workspace: Add a new workspace (specify target project's base directory)\n       - fetch_web_page: Fetch web page content (only when explicitly requested)\n\n    OPERATIONAL GUIDELINES:\n\n    1. Safety and Security:\n       - Never perform destructive operations that cannot be undone\n       - Do not terminate processes unless explicitly instructed\n       - Stop and report if multiple solution attempts fail\n       - Never access or modify files outside the workspace directory\n\n    2. Workspace Management:\n       - You can create directories and files within the workspace\n       - You can read and modify any files under the repo root\n       - Never traverse up beyond the workspace root directory\n\n    3. Best Practices:\n       - Always verify file existence before operations\n       - Use appropriate error handling\n       - Document significant changes\n       - Ask for clarification when instructions are unclear or risky\n\n    4. New Project Creation:\n       - When asked to create a new project with specific technologies:\n         * First, search for suitable template projects:\n           - Use fetch_web_page with GitHub search URL in format:\n             https://github.com/search?q=tech1%20tech2%20app%20starter&type=repositories\n             (replacing tech1, tech2, etc. with the requested technologies)\n           - Analyze results and identify best candidates based on:\n             * Star count (higher is better)\n             * Last update date (2020 or newer preferred)\n             * Match to requested tech stack\n           - Present top candidates to user and ask if they want to use one as template\n           - If user selects a template, use add_workspace tool with the chosen repo URL\n         \n         * If no good templates found or user prefers fresh setup:\n           - Offer to bootstrap project using official tooling\n           - Create appropriate subdirectory in workspace\n           - Use command_line tool with proper package manager/CLI tools\n           - Use sensible defaults where possible\n           - Ask user for input only when necessary for key decisions\n           - After setup complete:\n             * Add a README.md file to the new project directory with instructions for the user\n             * Use the add_workspace tool with full path to the new project directory\n             * Read and relay setup/startup instructions\n             * Suggest next steps for development\n\n       - When asked to create a new project without specific tech stack:\n         * Use the add_workspace tool with gitRepoUrl: https://github.com/HigherLevelDev/fullstack-starter\n         * Create the new workspace as a subfolder of the current workspace unless an absolute path is specified\n         * Follow any specific requirements provided by the user\n         * After creating the workspace:\n           - Read and relay the README.md file contents to provide setup/startup instructions\n           - Suggest using the architect-agent or se-agent to implement requested features in the new workspace\n           - Provide clear next steps for the user to get started with their project\n\n    Additional Workspace-Specific Hints:\n    ${e.repositoryHints()?`${e.repositoryHints()}`:""}\n\n    IMPORTANT REMINDERS:\n    1. After creating a new project, add a README.md and call the add_workspace tool with the full path to add and let the user know it should appear in the list of workspaces\n    2. Always use 'git add -A' rather than adding individual files\n    3. Confirm destructive operations with the user before proceeding\n    4. Stay within the workspace boundaries\n    5. Use tools according to their documented purposes and limitations\n    6. ALWAYS include automatic confirmation flags (--yes, -y, --force, etc.) when running interactive commands\n    7. Add appropriate silent/quiet flags to prevent unnecessary output when available`}};t.OpsAgentService=y,t.OpsAgentService=y=s([(0,d.Injectable)(),l(0,(0,d.Inject)((0,d.forwardRef)((()=>m.GraphAgentCollaborator)))),c("design:paramtypes",[m.GraphAgentCollaborator,g.ToolFactoryService,f.AgentRuleService])],y)},3903:e=>{"use strict";e.exports=require("uuid")},3911:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.SoftwareEngineerPersona=void 0;const o=r(3563),i=r(3877),s=r(2775),a=r(5299),c=r(260),l=r(7016);let d=class{getId(){return"software-engineer"}getName(){return"Software Engineer"}async getSystemPrompt(e){return`${(0,i.getBasePrompt)()}\n\n====\n\n${(0,s.getToolUseGuidelines)(e)}\n\n====\n\n${(0,a.getPlanVsActPrompt)(e)}\n\n====\n\n${(0,c.getRulesPrompt)(e)}\n\n====\n\n${(0,l.getObjectivePrompt)(e)}`}getToolNames(){return["read_file","write_to_file","replace_in_file","list_files","search_files","execute_command","list_code_definition_names","use_mcp_tool","access_mcp_resource","ask_followup_question","plan_mode_respond","attempt_completion"]}requiresFileList(){return!0}};t.SoftwareEngineerPersona=d,t.SoftwareEngineerPersona=d=n([(0,o.Injectable)()],d)},3923:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateFile=void 0;const c=r(5534),l=r(1569),d=s(r(9896)),u=s(r(6928)),f=a(r(9055)),p=r(2303);class h extends c.Tool{constructor(e,t,r,n){super(),this.name="update_file",this.description="Update the content of a file in the workspace by providing the path of the file to update, the text block to search for in the file content, and the text block to replace the search block with. All 3 arguments are required: filePath, search (use a blank/empty string when creating new files), and replace.",this.schema=l.z.object({filePath:l.z.string().describe("The relative path of the file to update"),search:l.z.string().describe("The unique text block to search for in the file content. For new files, use a blank/empty string. For existing files, make sure to include a big enough search block to ensure you're only updating the intended text."),replace:l.z.string().describe("The text block to replace the search block with - DO NOT FORGET TO INCLUDE THIS!!!")}),this.workspaceRootDir=e,this.mutationsService=t,this.sessionId=r,this.requestId=n}async _call(e){return this.updateFile(e.filePath,e.search,e.replace)}ensureDirectoryExists(e){try{return d.existsSync(e)||(f.default.info(`Creating directory: ${e}`),d.mkdirSync(e,{recursive:!0})),!0}catch(t){return f.default.error(`Failed to create directory ${e}:`,t),!1}}async updateFile(e,t,r){f.default.info("UpdateFile.updateFile called with: %s\n>>>>> SEARCH\n%s\n-------\n%s<<<<< REPLACE\n",e,t,r);const n=u.join(this.workspaceRootDir,e);try{let o,i,s=!1;if(d.existsSync(n)||t&&""!==t)if(o=d.readFileSync(n,"utf-8"),""!==o.trim()||t&&""!==t.trim()){const s=o.includes("\r\n")?"\r\n":"\n",a=t.replace(/\r\n|\n/g,s),c=r.replace(/\r\n|\n/g,s);if(o.split(a).length-1>1)return f.default.warn("Multiple exact matches found for search block: --\x3e%s<-- and file content was:\n--\x3e%s<--",t,o),`ERROR: the search block was found multiple times in the file. Please expand the search block to make it unique and construct the corresponding replace block and try again.\nFile path was: ${e}\nSearch block was:\n${t}\n`;let l=o.indexOf(a),u=a.length,p=a;if(-1===l){f.default.info("Exact match not found, attempting indentation-agnostic search.");const r=a.split(s).map((e=>e.trim())).filter((e=>e.length>0)).map((e=>e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"))).join("\\s*"),n=new RegExp(r.replace(/\s+/g,"\\s+"),"g"),d=o.match(n);if(d&&d.length>1)return f.default.warn("Multiple indentation-agnostic matches found for search block"),f.default.warn("Search block was:\n%s",t),f.default.warn("Full file content was:\n%s",o),`ERROR: the search block was found multiple times in the file. \nPlease expand the search block to make it unique and construct the corresponding replace block and try again.\nFile path was: ${e}\nSearch block was:\n${t}\n`;n.lastIndex=0;const h=n.exec(o);if(!h)return f.default.warn("UpdateFile.updateFile failed to find the search block in the file content."),f.default.warn("Search block was:\n%s",t),f.default.warn("Full file content was:\n%s",o),`ERROR: failed to find search block in file content.\nPlease try again with a different search block.\nFile path was: ${e}\nSearch block was:\n${t}\n`;l=h.index,u=h[0].length,p=h[0];const g=p.split(s),m=g[0].match(/^\s*/)[0],y=g.filter((e=>e.trim().length>0)).map((e=>e.match(/^\s*/)[0].length-m.length)),v=c.split(s),_=v.map(((e,t)=>{if(!e.trim())return"";const r=y[Math.min(t,y.length-1)]||0;return m+" ".repeat(Math.max(0,r))+e.trim()})).join(s);i=o.slice(0,l)+_+o.slice(l+u)}else i=o.slice(0,l)+c+o.slice(l+u);f.default.info(`Updating file: ${e}`),f.default.debug("Updated file - Content after:\n%s",i),d.writeFileSync(n,i,"utf-8")}else{const e=r.replace(/\r\n/g,"\n");d.writeFileSync(n,e,"utf-8"),i=e}else{const e=u.dirname(n);if(!this.ensureDirectoryExists(e))return`ERROR: Failed to create directory: ${e}`;const t=r.replace(/\r\n/g,"\n");d.writeFileSync(n,t,"utf-8"),o="",i=t,s=!0}const a=s?`Successfully created new file: ${e}`:`Successfully updated file: ${e}`;try{await this.mutationsService.createMutation({type:s?p.MutationType.CREATE:p.MutationType.UPDATE,filePath:e,description:a,fileContentsBefore:o,fileContentsAfter:i,updatedAt:new Date,sessionId:this.sessionId,requestId:this.requestId})}catch(t){throw f.default.error("UpdateFile.updateFile encountered an error while recording the mutation:",{error:t.message,stack:t.stack,context:{filePath:e,isNewFile:s,sessionId:this.sessionId,requestId:this.requestId}}),new Error(`Failed to record file mutation: ${t.message}`)}return f.default.info("UpdateFile.updateFile completed successfully"),`Successfully updated file: ${e} with search block:\n${t}\n`}catch(e){return f.default.error("UpdateFile.updateFile encountered an error:",e),`Error: ${e.message}`}}}t.UpdateFile=h},3936:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionRepository=void 0;const s=r(3563);r(1832);let a=class{constructor(e){this.knex=e}async findAll(e,t,r){let n=this.knex("sessions").select("*"),o=this.knex("sessions").count("* as count");r&&(n=n.where(r),o=o.where(r)),t&&(n=n.orderBy(t.field,t.order.toLowerCase()));const i=await o.first(),s=i?.count;if(e){const{page:t,limit:r}=e,o=(t-1)*r;n=n.offset(o).limit(r)}return{sessions:await n,total:s}}async findById(e){return this.knex("sessions").where("sessionId",e).first()}async create(e){await this.knex("sessions").insert(e)}async update(e,t){await this.knex("sessions").where("sessionId",e).update(t)}async delete(e){await this.knex("sessions").where("sessionId",e).delete()}async count(e){const t=this.knex("sessions").count("* as count");e&&t.where(e);const r=await t.first();return r?.count}async createItem(e){await this.knex("item").insert(e)}async findItemsBySessionId(e){return this.knex("item").where("sessionId",e).orderBy("createdAt","asc")}async updateItem(e,t){await this.knex("item").where("itemId",e).update(t)}};t.SessionRepository=a,t.SessionRepository=a=n([(0,s.Injectable)(),i(0,(0,s.Inject)("KNEX")),o("design:paramtypes",[Function])],a)},3971:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenRouterProvider=void 0;const o=r(6228),i=r(8483),s=r(8959),a=r(2368),c=n(r(8938));class l extends i.BaseProvider{constructor(){super()}getName(){return"openrouter"}getBaseChatModel(e,t){const r=process.env.OPENROUTER_BASE_URL||"https://openrouter.ai";let n=8e3;if(l.modelCache.models.length>0){const t=l.modelCache.models.find((t=>t.id===this.shortModelName(e)));t?.per_request_limits?.prompt_tokens&&(n=t.per_request_limits.prompt_tokens)}return new o.ChatOpenAI({modelName:this.shortModelName(e),temperature:t.temperature,maxTokens:n,openAIApiKey:a.ConfigService.getInstance().getProperty("OPENROUTER_API_KEY")},{basePath:`${r}/api/v1`,baseOptions:{headers:{"X-Title":"Eve"}}})}async getModelDescriptors(){return 0===l.modelCache.models.length&&await this.fetchModels(),l.modelCache.models.map((e=>{const t=parseFloat(e.pricing.prompt)||0,r=parseFloat(e.pricing.completion)||0;return new s.ModelDescriptor("openrouter",e.id,t,0,0,r)}))}isValid(){return!!a.ConfigService.getInstance().getProperty("OPENROUTER_API_KEY")}async fetchModels(){if(!this.isValid())return[];const e=Date.now();if(l.modelCache.models.length>0&&e-l.modelCache.timestamp<3e5)return l.modelCache.models;const t=a.ConfigService.getInstance().getProperty("OPENROUTER_API_KEY"),r=process.env.OPENROUTER_BASE_URL||"https://openrouter.ai";if(!t)return console.log("OpenRouter API key not found"),[];try{const n=await c.default.get(`${r}/api/v1/models`,{headers:{Authorization:`Bearer ${t}`,"X-Title":"Eve"}});if(200===n.status){const t=n.data.data||[];return l.modelCache={models:t,timestamp:e},t}return console.log(`Failed to fetch OpenRouter models. Status code: ${n.status}`),[]}catch(e){return console.error(`Error fetching OpenRouter models: ${e}`),[]}}}t.OpenRouterProvider=l,l.modelCache={models:[],timestamp:0}},4043:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagingHandler=void 0;const a=r(3563),c=s(r(9055)),l=r(6297);let d=n=class{constructor(){}handleEcho(e,t){l.debugLogger.log(`Received echo message from client ${t.id}`),c.default.info(`[${n.name}] Received echo message from client ${t.id}: ${JSON.stringify(e)}`);const r={event:"echo",data:e};return t.emit("echo",r),r}};t.MessagingHandler=d,t.MessagingHandler=d=n=o([(0,a.Injectable)(),i("design:paramtypes",[])],d)},4070:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EveAgentIncomingGateway=void 0;const c=r(6134),l=r(4437),d=a(r(9055)),u=r(6297),f=r(6595),p=r(7663),h=r(1036),g=r(8444),m=r(4704),y=r(4043),v=r(4810),_=r(9668);let w=n=class{constructor(e,t,r,n,o,i,s){this.webSocketService=e,this.taskEventHandler=t,this.userPromptHandler=r,this.toolEventHandler=n,this.configEventHandler=o,this.agentModeHandler=i,this.messagingHandler=s}afterInit(e){d.default.info(`[${n.name}] Gateway initialized.`)}handleConnection(e){this.webSocketService.addClient(e.id,e),e.join(e.id),u.debugLogger.log(`Client connected: ${e.id} (IncomingGateway)`),d.default.info(`[${n.name}] Client connected: ${e.id}`);try{const e=this.webSocketService.getServer()||this.server;if(e&&e.sockets&&e.sockets.adapter){const t=e.sockets.adapter.rooms;if(t){const e=Array.from(t.keys()).filter((e=>!e.startsWith("/")));u.debugLogger.log(`Socket.io rooms (on connect): ${JSON.stringify(e)}`)}}}catch(e){d.default.warn(`[${n.name}] Error accessing Socket.io rooms on connect: ${e.message}`)}}handleDisconnect(e){this.webSocketService.removeClient(e.id),u.debugLogger.log(`Client disconnected: ${e.id} (IncomingGateway)`),d.default.info(`[${n.name}] Client disconnected: ${e.id}`);try{const e=this.webSocketService.getServer()||this.server;if(e&&e.sockets&&e.sockets.adapter){const t=e.sockets.adapter.rooms;if(t){const e=Array.from(t.keys()).filter((e=>!e.startsWith("/")));u.debugLogger.log(`Socket.io rooms (on disconnect): ${JSON.stringify(e)}`)}}}catch(e){d.default.warn(`[${n.name}] Error accessing Socket.io rooms on disconnect: ${e.message}`)}}handleEcho(e,t){return this.messagingHandler.handleEcho(e,t)}async handleGetConfig(e){return this.configEventHandler.handleGetConfig(e)}async handleCreateTask(e,t){u.debugLogger.log(`Received createTask from client ${t.id}`),d.default.info(`[${n.name}] Received createTask from client ${t.id}`);try{await this.taskEventHandler.handleCreateTask({workspaceName:e.workspaceName,personaId:e.personaId},t),d.default.info(`[${n.name}] Task creation initiated for client ${t.id}`)}catch(e){const r=e instanceof _.AuthenticationError?`Authentication failed: ${e.message}`:e.message;d.default.error(`[${n.name}] Error creating task for client ${t.id}: ${r}\n${e.stack}`),t.emit("taskError",{message:r})}}async handleCreateTaskStep(e,t){d.default.info(`[${n.name}] Received createTaskStep (legacy) from client ${t.id} for task ${e.taskId}`);try{await this.taskEventHandler.handleCreateTaskStep(e,t),d.default.info(`[${n.name}] Task step ${e.stepNumber} creation initiated for task ${e.taskId}`)}catch(r){d.default.error(`[${n.name}] Error creating task step for task ${e.taskId}: ${r.message}\n${r.stack}`),t.emit("taskStepError",{taskId:e.taskId,stepNumber:e.stepNumber,message:r.message})}}async handleUpdateTaskStep(e,t){d.default.info(`[${n.name}] Received updateTaskStep (legacy) from client ${t.id} for task ${e.taskId}`);try{await this.taskEventHandler.handleUpdateTaskStep(e,t),d.default.info(`[${n.name}] Task step ${e.stepNumber} update initiated for task ${e.taskId}`)}catch(r){d.default.error(`[${n.name}] Error updating task step for task ${e.taskId}: ${r.message}\n${r.stack}`),t.emit("taskStepError",{taskId:e.taskId,stepNumber:e.stepNumber,message:r.message})}}async handleToolApproval(e,t){await this.toolEventHandler.handleToolApproval(e,t)}async handleUserPrompt(e,t){u.debugLogger.log(`Received userPrompt from client ${t.id} for task ${e.taskId}`),d.default.info(`[${n.name}] Received userPrompt for task ${e.taskId}, passing to TaskEventHandler.`);try{t.join(e.taskId),d.default.info(`[${n.name}] Client ${t.id} joined room ${e.taskId}`),await this.userPromptHandler.handleUserPrompt(e,t.id),d.default.info(`[${n.name}] User prompt for task ${e.taskId} passed to UserPromptHandler.`)}catch(r){d.default.error(`[${n.name}] Error calling TaskEventHandler for task ${e.taskId}: ${r.message}\n${r.stack}`),t.emit("promptError",{taskId:e.taskId,message:`Gateway error: ${r.message}`})}}async handleCancelTask(e,t){await this.taskEventHandler.handleCancelTask(e,t),d.default.info(`[${n.name}] Task ${e.taskId} cancellation initiated by request.`)}async handleChangeAgentMode(e,t){await this.agentModeHandler.handleChangeAgentMode(e,t)}async handleJoinTaskRoom(e,t){await this.agentModeHandler.handleJoinTaskRoom(e,t)}};t.EveAgentIncomingGateway=w,o([(0,c.WebSocketServer)(),i("design:type",l.Server)],w.prototype,"server",void 0),o([(0,c.SubscribeMessage)("echo"),s(0,(0,c.MessageBody)()),s(1,(0,c.ConnectedSocket)()),i("design:type",Function),i("design:paramtypes",[Object,l.Socket]),i("design:returntype",void 0)],w.prototype,"handleEcho",null),o([(0,c.SubscribeMessage)("getConfig"),s(0,(0,c.ConnectedSocket)()),i("design:type",Function),i("design:paramtypes",[l.Socket]),i("design:returntype",Promise)],w.prototype,"handleGetConfig",null),o([(0,c.SubscribeMessage)("createTask"),s(0,(0,c.MessageBody)()),s(1,(0,c.ConnectedSocket)()),i("design:type",Function),i("design:paramtypes",[Object,l.Socket]),i("design:returntype",Promise)],w.prototype,"handleCreateTask",null),o([(0,c.SubscribeMessage)("createTaskStep"),s(0,(0,c.MessageBody)()),s(1,(0,c.ConnectedSocket)()),i("design:type",Function),i("design:paramtypes",[Object,l.Socket]),i("design:returntype",Promise)],w.prototype,"handleCreateTaskStep",null),o([(0,c.SubscribeMessage)("updateTaskStep"),s(0,(0,c.MessageBody)()),s(1,(0,c.ConnectedSocket)()),i("design:type",Function),i("design:paramtypes",[Object,l.Socket]),i("design:returntype",Promise)],w.prototype,"handleUpdateTaskStep",null),o([(0,c.SubscribeMessage)("toolApproval"),s(0,(0,c.MessageBody)()),s(1,(0,c.ConnectedSocket)()),i("design:type",Function),i("design:paramtypes",[Object,l.Socket]),i("design:returntype",Promise)],w.prototype,"handleToolApproval",null),o([(0,c.SubscribeMessage)("userPrompt"),s(0,(0,c.MessageBody)()),s(1,(0,c.ConnectedSocket)()),i("design:type",Function),i("design:paramtypes",[Object,l.Socket]),i("design:returntype",Promise)],w.prototype,"handleUserPrompt",null),o([(0,c.SubscribeMessage)("cancelTask"),s(0,(0,c.MessageBody)()),s(1,(0,c.ConnectedSocket)()),i("design:type",Function),i("design:paramtypes",[Object,l.Socket]),i("design:returntype",Promise)],w.prototype,"handleCancelTask",null),o([(0,c.SubscribeMessage)("changeAgentMode"),s(0,(0,c.MessageBody)()),s(1,(0,c.ConnectedSocket)()),i("design:type",Function),i("design:paramtypes",[Object,l.Socket]),i("design:returntype",Promise)],w.prototype,"handleChangeAgentMode",null),o([(0,c.SubscribeMessage)("joinTaskRoom"),s(0,(0,c.MessageBody)()),s(1,(0,c.ConnectedSocket)()),i("design:type",Function),i("design:paramtypes",[Object,l.Socket]),i("design:returntype",Promise)],w.prototype,"handleJoinTaskRoom",null),t.EveAgentIncomingGateway=w=n=o([(0,c.WebSocketGateway)({namespace:"eve-agent",cors:{origin:"*"}}),i("design:paramtypes",[v.WebSocketService,f.TaskEventHandler,p.UserPromptHandler,h.ToolEventHandler,g.ConfigEventHandler,m.AgentModeHandler,y.MessagingHandler])],w)},4143:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RequestController=void 0;const s=r(3563),a=r(7373);let c=class{constructor(e){this.sessionService=e}async getRequest(e){return this.sessionService.getRequest(e)}};t.RequestController=c,n([(0,s.Get)(":requestId"),i(0,(0,s.Param)("requestId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],c.prototype,"getRequest",null),t.RequestController=c=n([(0,s.Controller)("requests"),o("design:paramtypes",[a.SessionService])],c)},4155:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ResponseFormatterService=void 0;const c=r(3563),l=a(r(6928));let d=class{duplicateFileReadNotice(){return"[[NOTE] This file read has been removed to save space in the context window. Refer to the latest file read for the most up to date version of this file.]"}contextTruncationNotice(){return"[NOTE] Some previous conversation history with the user has been removed to maintain optimal context window length. The initial user task and the most recent exchanges have been retained for continuity, while intermediate conversation history has been removed. Please keep this in mind as you continue assisting the user."}toolDenied(){return"The user denied this operation."}toolError(e){return`The tool execution failed with the following error:\n<error>\n${e}\n</error>`}formatFilesList(e,t,r,n){const o=t.map((t=>{const r=l.relative(e,t).replace(/\\/g,"/");return t.endsWith("/")||t.endsWith("\\")?r+"/":r})).sort(((e,t)=>{const r=e.split("/"),n=t.split("/");for(let e=0;e<Math.min(r.length,n.length);e++)if(r[e]!==n[e])return e+1===r.length&&e+1<n.length?-1:e+1===n.length&&e+1<r.length?1:r[e].localeCompare(n[e],void 0,{numeric:!0,sensitivity:"base"});return r.length-n.length})),i=n?o.map((t=>{const r=l.resolve(e,t);return n.has(r)?`🔒 ${t}`:t})):o;return r?`${i.join("\n")}\n\n(File list truncated. Use list_files on specific subdirectories if you need to explore further.)`:0===i.length||1===i.length&&""===i[0]?"No files found.":i.join("\n")}};t.ResponseFormatterService=d,t.ResponseFormatterService=d=s([(0,c.Injectable)()],d)},4193:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.HomeModule=void 0;const o=r(3563),i=r(538),s=r(7967),a=r(1367);let c=class{};t.HomeModule=c,t.HomeModule=c=n([(0,o.Module)({imports:[s.ConfigModule,(0,o.forwardRef)((()=>a.EveAgentModule))],providers:[i.HomeService],exports:[i.HomeService]})],c)},4219:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n(function_definition\n  declarator: (function_declarator\n    declarator: (identifier) @name.definition.function)) @definition.function\n\n(class_specifier\n  name: (type_identifier) @name.definition.class) @definition.class\n\n(struct_specifier\n  name: (type_identifier) @name.definition.struct) @definition.struct\n\n(enum_specifier\n  name: (type_identifier) @name.definition.enum) @definition.enum\n\n; (namespace_definition\n;   name: (identifier) @name.definition.namespace) @definition.namespace\n"},4230:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PlanModeRespondToolFactory=void 0;const i=r(3563),s=r(2267);let a=class{constructor(){}getToolName(){return"plan_mode_respond"}create(e){return new s.PlanModeRespondTool}};t.PlanModeRespondToolFactory=a,t.PlanModeRespondToolFactory=a=n([(0,i.Injectable)(),o("design:paramtypes",[])],a)},4243:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FileValidationService=void 0;const u=r(3563),f=c(r(1943)),p=r(873),h=r(2141),g=r(1125),m=r(4318),y=d(r(9055)),v=c(r(6928));let _=o=class{constructor(e,t,r,n){this.treeSitterService=e,this.fileSystemService=t,this.validatorRegistry=r,this.validatorProvider=n}async onModuleInit(){y.default.info(`[${o.name}] FileValidationService initialized`)}async validateFile(e,t){let r;const n=v.isAbsolute(e)?e:this.fileSystemService.resolvePath(e,t),i=v.extname(e).toLowerCase().slice(1);try{if(!await this.fileSystemService.fileExists(n))return y.default.warn(`[${o.name}] File not found for validation: ${n}`),{validatorName:"FileValidationService",validationMethod:"File existence check",hasErrors:!0,report:`File not found for validation: ${n}`};r=await f.readFile(n,"utf8")}catch(e){return y.default.error(`[${o.name}] Error reading file ${n} for validation: ${e.message}`),{validatorName:"FileValidationService",validationMethod:"File reading",hasErrors:!0,report:`Error reading file for validation: ${e.message}`}}const s=this.validatorRegistry.getValidatorsForFile(e);if(0===s.length)return y.default.info(`[${o.name}] No validators found for file extension: ${i}`),{validatorName:"None",validationMethod:"No validator available",hasErrors:!1,report:`No validators available for file extension: ${i}`};s.sort(((e,t)=>e.getPriority()-t.getPriority()));const a=s[0];y.default.info(`[${o.name}] Using validator: ${a.getName()} (priority ${a.getPriority()}) for file: ${e}`);try{return await a.validate(e,r,t)}catch(t){return y.default.error(`[${o.name}] Error running validator ${a.getName()} for ${e}: ${t.message}`),{validatorName:a.getName(),validationMethod:"Failed validation",hasErrors:!0,report:`Validation error: ${t.message}`}}}};t.FileValidationService=_,t.FileValidationService=_=o=a([(0,u.Injectable)(),l("design:paramtypes",[p.TreeSitterService,h.FileSystemService,g.ValidatorRegistryService,m.ValidatorProvider])],_)},4264:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIProvider=void 0;const o=r(6228),i=r(8483),s=r(8959),a=r(2368),c=n(r(8938)),l=r(2088);class d extends i.BaseProvider{static isO1Model(e){return e.startsWith("o1")}getName(){return"openai"}getBaseChatModel(e,t){const r=process.env.OPENAI_BASE_URL||"https://api.openai.com/v1",n=this.shortModelName(e);return new o.ChatOpenAI({modelName:n,openAIApiKey:a.ConfigService.getInstance().getProperty("OPENAI_API_KEY"),configuration:{basePath:r}})}async getModelDescriptors(){0===d.modelCache.models.length&&await this.fetchModels();return d.modelCache.models.map((e=>{const t=d.MODEL_COSTS[e.id]||{input:0,output:0};return new s.ModelDescriptor("openai",e.id,t.input/1e3,0,0,t.output/1e3)}))}isValid(){return!!a.ConfigService.getInstance().getProperty("OPENAI_API_KEY")}async fetchModels(){if(!this.isValid())return[];const e=Date.now();if(d.modelCache.models.length>0&&e-d.modelCache.timestamp<3e5)return d.modelCache.models;const t=a.ConfigService.getInstance().getProperty("OPENAI_API_KEY");if(!t)return console.log("OpenAI API key not found"),[];try{const r=process.env.OPENAI_BASE_URL||"https://api.openai.com/v1",n=await c.default.get(`${r}/models`,{headers:{Authorization:`Bearer ${t}`}});if(200===n.status){const t=(n.data.data||[]).filter((e=>e.id.includes("gpt")||e.id.startsWith("o")));return d.modelCache={models:t,timestamp:e},t}return console.log(`Failed to fetch OpenAI models. Status code: ${n.status}`),[]}catch(e){return console.error(`Error fetching OpenAI models: ${e}`),[]}}getChatModelOptions(e,t){return new l.ChatModelOptions(null,null,!d.isO1Model(e.name))}}t.OpenAIProvider=d,d.GPT_4O_MODEL_NAME="gpt-4o",d.GPT_4O_MINI_MODEL_NAME="gpt-4o-mini",d.modelCache={models:[],timestamp:0},d.MODEL_COSTS={"gpt-4o":{input:1875e-9*1e3,output:75e-7*1e3},"gpt-4o-mini":{input:1125e-7,output:45e-5}}},4279:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SourceArtefactController=void 0;const s=r(3563),a=r(3153);let c=class{constructor(e){this.sourceArtefactService=e}async importSourceArtefact(e){return this.sourceArtefactService.importSourceArtefact(e.scheme,e.locator,e.repoUrls)}async findById(e){return this.sourceArtefactService.findById(e)}async delete(e){return this.sourceArtefactService.delete(e)}async findBySchemeAndLocator(e,t){return this.sourceArtefactService.findBySchemeAndLocator(e,t)}async query(e,t,r=1,n=10,o="locator",i="ASC"){return this.sourceArtefactService.query(e,t,r,n,o,i)}};t.SourceArtefactController=c,n([(0,s.Post)("import"),i(0,(0,s.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],c.prototype,"importSourceArtefact",null),n([(0,s.Get)(":id"),i(0,(0,s.Param)("id")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],c.prototype,"findById",null),n([(0,s.Delete)(":id"),i(0,(0,s.Param)("id")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],c.prototype,"delete",null),n([(0,s.Get)("find"),i(0,(0,s.Query)("scheme")),i(1,(0,s.Query)("locator")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],c.prototype,"findBySchemeAndLocator",null),n([(0,s.Get)(),i(0,(0,s.Query)("scheme")),i(1,(0,s.Query)("partialLocator")),i(2,(0,s.Query)("page")),i(3,(0,s.Query)("pageSize")),i(4,(0,s.Query)("sortBy")),i(5,(0,s.Query)("sortOrder")),o("design:type",Function),o("design:paramtypes",[String,String,Number,Number,String,String]),o("design:returntype",Promise)],c.prototype,"query",null),t.SourceArtefactController=c=n([(0,s.Controller)("source-artefacts"),o("design:paramtypes",[a.SourceArtefactService])],c)},4318:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ValidatorProvider=void 0;const a=r(3563),c=r(1125),l=r(4835),d=r(2992),u=r(6282),f=r(2929),p=r(873),h=s(r(9055));let g=n=class{constructor(e,t){this.validatorRegistry=e,this.treeSitterService=t}async onModuleInit(){await this.registerDefaultValidators()}async registerDefaultValidators(){const e=new l.TreeSitterValidator(this.treeSitterService);this.validatorRegistry.registerValidator(e),h.default.info(`[${n.name}] Registered TreeSitter validator with priority ${e.getPriority()}`),this.registerTypeScriptValidator(),this.registerESLintValidator(),this.registerPythonValidator()}registerTypeScriptValidator(){try{const e=new d.TypeScriptValidator;this.validatorRegistry.registerValidator(e),h.default.info(`[${n.name}] Registered TypeScript validator with priority ${e.getPriority()}`)}catch(e){h.default.warn(`[${n.name}] Failed to register TypeScript validator: ${e.message}`)}}registerESLintValidator(){try{const e=new u.ESLintValidator;this.validatorRegistry.registerValidator(e),h.default.info(`[${n.name}] Registered ESLint validator with priority ${e.getPriority()}`)}catch(e){h.default.warn(`[${n.name}] Failed to register ESLint validator: ${e.message}`)}}registerPythonValidator(){try{const e=new f.PylintValidator;this.validatorRegistry.registerValidator(e),h.default.info(`[${n.name}] Registered Pylint validator with priority ${e.getPriority()}`)}catch(e){h.default.warn(`[${n.name}] Failed to register Pylint validator: ${e.message}`)}}registerCustomValidator(e){this.validatorRegistry.registerValidator(e),h.default.info(`[${n.name}] Registered custom validator: ${e.getName()} with priority ${e.getPriority()}`)}};t.ValidatorProvider=g,t.ValidatorProvider=g=n=o([(0,a.Injectable)(),i("design:paramtypes",[c.ValidatorRegistryService,p.TreeSitterService])],g)},4358:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SchemePackageManager=void 0;const l=r(3563),d=a(r(6928)),u=a(r(857)),f=a(r(1943)),p=r(8547);let h=class{constructor(e){this.schemes=new Map(e.map((e=>[e.getName(),e])))}getScheme(e){const t=this.schemes.get(e);if(!t)throw new Error(`Unknown scheme: ${e}`);return t}async downloadAndStoreSources(e,t,r){const n=this.schemes.get(e);if(!n)return new p.SourceArtefact({scheme:e,locator:t,valid:!1,error:`Unknown scheme: ${e}`,repo:"",cacheSrcBaseDir:""});const o=d.join(u.homedir(),".eve","cached-sources");try{return await n.downloadAndStoreSources(t,o,r)}catch(r){return new p.SourceArtefact({scheme:e,locator:t,valid:!1,error:r instanceof Error?r.message:"Unknown error occurred",repo:"",cacheSrcBaseDir:""})}}async deleteSourceCache(e){if(e)try{await f.rm(e,{recursive:!0,force:!0})}catch(e){console.error(`Error deleting source cache directory: ${e}`)}}async needsImport(e){const t=this.schemes.get(e.scheme);return!t||await t.needsImport(e)}};t.SchemePackageManager=h,t.SchemePackageManager=h=s([(0,l.Injectable)(),c("design:paramtypes",[Array])],h)},4390:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchFilesTool=void 0;const u=r(3563),f=r(5317),p=r(9023),h=d(r(9055)),g=c(r(6928)),m=c(r(1943)),y=r(9581),v=r(2410),_=(0,p.promisify)(f.exec),w=500,b=10485760;let k=o=class{constructor(e){this.name="search_files",this.description="Request to perform a regex search across files in a specified directory.",this.rgPath=null,this.workingDir=e}async findRipgrepPath(){const e="win32"===process.platform,t=e?"rg.exe":"rg",r=[g.join(process.cwd(),"node_modules","@vscode","ripgrep","bin",t),g.join(process.cwd(),"node_modules","vscode-ripgrep","bin",t),t];for(const t of r)try{return await _(`${e?`"${t}"`:t} --version`),t}catch(e){}return null}getUsageInstructions(e){return`## search_files\nDescription: Request to perform a regex search across files in a specified directory, providing context-rich results. This tool searches for patterns or specific content across multiple files, displaying each match with encapsulating context. Uses ripgrep (rg) if available for performance, otherwise falls back to Node.js search.\nParameters:\n- path: (required) The path of the directory to search in (relative to the current working directory ${e.workingDir}). This directory will be recursively searched.\n- regex: (required) The regular expression pattern to search for. Uses Rust regex syntax if ripgrep is used, standard JS regex if fallback is used.\n- file_pattern: (optional) Glob pattern to filter files (e.g., '*.ts' for TypeScript files). If not provided, it will search all files (*).\nUsage:\n<search_files>\n<path>Directory path here</path>\n<regex>Your regex pattern here</regex>\n<file_pattern>file pattern here (optional)</file_pattern>\n</search_files>`}validateParams(e){return"string"==typeof e.path&&""!==e.path.trim()&&"string"==typeof e.regex&&""!==e.regex.trim()}async execute(e){const{path:t,regex:r,file_pattern:n}=e;h.default.info(`[${o.name}] Searching files in directory: ${t}, regex: ${r}, file_pattern: ${n}, relative to ${this.workingDir}`);const i=g.resolve(this.workingDir,t);if(!i.startsWith(this.workingDir)){const e=`Path traversal attempt detected: ${t} resolves outside of workspace ${this.workingDir}`;throw h.default.error(`[${o.name}] ${e}`),new y.FileSystemError(e,"PATH_TRAVERSAL_ERROR")}try{if(!(await m.stat(i)).isDirectory())throw new y.FileSystemError(`Search path is not a directory: ${t}`,"NOT_A_DIRECTORY")}catch(e){if("ENOENT"===e.code){const e=`Search path not found: ${t}`;throw h.default.error(`[${o.name}] ${e}`),new y.FileNotFoundError(e,t)}throw h.default.error(`[${o.name}] Error accessing search path ${t}: ${e.message}`),new y.FileSystemError(`Error accessing search path: ${e.message}`,e.code||"FS_ACCESS_ERROR")}try{if(null===this.rgPath&&(this.rgPath=await this.findRipgrepPath(),this.rgPath?h.default.info(`[${o.name}] Ripgrep found at: ${this.rgPath}`):h.default.warn(`[${o.name}] Ripgrep (rg) command not found. Falling back to Node.js search. Install ripgrep for better performance (e.g., 'brew install ripgrep' or 'apt-get install ripgrep').`)),!this.rgPath)return h.default.info(`[${o.name}] Using Node.js fallback search.`),this.nodeJsSearch(i,r,n);try{return h.default.info(`[${o.name}] Attempting search with ripgrep.`),await this.executeRipgrep(this.rgPath,i,r,n)}catch(e){return h.default.warn(`[${o.name}] Ripgrep execution failed: ${e.message}. Falling back to Node.js search.`),this.nodeJsSearch(i,r,n)}}catch(e){if(e instanceof y.FileNotFoundError||e instanceof y.FileSystemError)throw e;const r=`Error searching files in directory ${t}: ${e.message}`;throw h.default.error(`[${o.name}] ${r}\n${e.stack}`),new y.FileSystemError(r,e.code||"FS_SEARCH_ERROR")}}async executeRipgrep(e,t,r,n){return new Promise(((i,s)=>{const a=["--json","--context","2","--no-heading","--color","never","--line-number","--max-count",String(w)];a.push("--regexp",r),n&&a.push("--glob",n),a.push(t),h.default.debug(`[${o.name}] Executing ripgrep: ${e} ${a.join(" ")}`);const c=(0,f.spawn)(e,a,{cwd:this.workingDir,stdio:["ignore","pipe","pipe"]});let l="",d="";c.stdout.on("data",(e=>{l+=e.toString(),l.length>20971520&&(h.default.warn(`[${o.name}] Ripgrep stdout buffer exceeded limit, killing process.`),c.kill(),s(new y.FileSystemError("Ripgrep output exceeded size limit","OUTPUT_TOO_LARGE")))})),c.stderr.on("data",(e=>{d+=e.toString()})),c.on("close",(e=>{if(0!==e&&1!==e){const t=`Ripgrep exited with code ${e}: ${d||"No stderr output"}`;return h.default.error(`[${o.name}] ${t}`),void s(new y.FileSystemError(t,"RIPGREP_EXEC_ERROR"))}!d||d.includes("using explicit glob")||d.includes("No files were searched")||h.default.warn(`[${o.name}] Ripgrep stderr output: ${d}`);try{const e=this.parseRipgrepOutput(l);i(e)}catch(e){h.default.error(`[${o.name}] Error parsing ripgrep output: ${e.message}\n${e.stack}`),s(new y.FileSystemError(`Error parsing ripgrep output: ${e.message}`,"PARSE_ERROR"))}})),c.on("error",(t=>{h.default.error(`[${o.name}] Error spawning ripgrep process: ${t.message}\n${t.stack}`),"ENOENT"===t.code?s(new y.FileSystemError(`Failed to execute ripgrep binary at ${e}. Ensure it's installed and executable.`,"RIPGREP_SPAWN_ENOENT")):s(new y.FileSystemError(`Error executing ripgrep: ${t.message}`,"RIPGREP_SPAWN_ERROR"))}))}))}async nodeJsSearch(e,t,r){let n=0,i="";const s=new RegExp(t);try{const t=r?g.join(e,"**",r):g.join(e,"**","*"),a=await(0,v.glob)(t,{nodir:!0,absolute:!0,ignore:["**/node_modules/**","**/.git/**"]});for(const e of a){if(n>=w){i+="\nSearch stopped after reaching 500 results.";break}try{if((await m.stat(e)).size>b){h.default.warn(`[${o.name}] Skipping large file (Node.js search): ${e}`);continue}const t=(await m.readFile(e,"utf-8")).split("\n");let r=!1,a="";for(let o=0;o<t.length&&!(s.test(t[o])&&(r||(a+=`\n${g.relative(this.workingDir,e)}:\n`,r=!0),a+=`  ${o+1}: ${t[o]}\n`,n++,n>=w));o++);r&&(i+=a)}catch(t){h.default.warn(`[${o.name}] Error reading file ${e}: ${t.message}`)}}return i.trim()||"No matches found."}catch(e){throw h.default.error(`[${o.name}] Error during Node.js file search globbing: ${e.message}`),new y.FileSystemError(`Error finding files to search: ${e.message}`,"GLOB_ERROR")}}parseRipgrepOutput(e){if(!e.trim())return"No matches found.";const t=e.trim().split("\n"),r=[];let n=0;for(const e of t)try{if(e.trim()){const t=JSON.parse(e);r.push(t)}}catch(t){n++,n<5?h.default.warn(`[${o.name}] Error parsing ripgrep JSON line: ${t.message}. Line: "${e}"`):5===n&&h.default.warn(`[${o.name}] Too many ripgrep JSON parse errors, suppressing further warnings.`)}if(0===r.length&&n>0)return`Error: Could not parse ripgrep output. Found ${n} invalid JSON lines.`;if(0===r.length)return"No matches found.";let i="",s="",a=0;for(const e of r)if("match"===e.type){a++;const{path:t,lines:r,line_number:n}=e.data,o=t?.text||"unknown_file",c=g.relative(this.workingDir,o);c!==s&&(""!==s&&(i+="\n"),s=c,i+=`${s}:\n`),i+=`  ${n}: ${r.text.trimEnd()}\n`}else if("context"===e.type){const{path:t,lines:r,line_number:n}=e.data,o=t?.text||"unknown_file";g.relative(this.workingDir,o)}return(r.length>=w?"Showing first 500 matches.\n\n":`Found ${a} ${1===a?"match":"matches"}.\n\n`)+(i.trim()||"No matches found.")}};t.SearchFilesTool=k,t.SearchFilesTool=k=o=a([(0,u.Injectable)(),l("design:paramtypes",[String])],k)},4434:e=>{"use strict";e.exports=require("events")},4437:e=>{"use strict";e.exports=require("socket.io")},4500:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetRetrieval=void 0;const o=r(7773),i=n(r(9055));class s extends o.Tool{constructor(e){super(),this.datasetRetrievalService=e,this.name="dataset_retrieval",this.description="Search a dataset for similar content using vector similarity. Input should be a JSON string with datasetName, searchText, and optional numResults (defaults to 5)."}async _call(e){try{const t=JSON.parse(e);if(!t.datasetName||!t.searchText)throw new Error("Both datasetName and searchText are required");const r=await this.datasetRetrievalService.searchDataset(t.datasetName,t.searchText,t.numResults);return JSON.stringify(r,null,2)}catch(e){throw i.default.error(`Error in dataset retrieval tool: ${e.message}`),e}}}t.DatasetRetrieval=s},4562:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioTranscriptionService=void 0;const d=r(3563),u=r(5317),f=l(r(9055)),p=c(r(9896)),h=c(r(857)),g=c(r(6928));let m=o=class{async transcribe(e){f.default.debug(`[${o.name}] Starting audio transcription`);const t=Buffer.from(e,"base64"),r=g.join(h.tmpdir(),`audio-${Date.now()}.wav`);await p.promises.writeFile(r,t),f.default.debug(`[${o.name}] Temporary file created: ${r}`);try{const e=await this.runFasterWhisperCLI(r);return f.default.debug(`[${o.name}] Transcription completed successfully`),e}finally{await p.promises.unlink(r),f.default.debug(`[${o.name}] Temporary file deleted: ${r}`)}}runFasterWhisperCLI(e){return new Promise(((t,r)=>{const n=g.join(h.tmpdir(),`audio-${Date.now()}.srt`);f.default.debug(`[${o.name}] Running Faster Whisper CLI on file: ${e}`);const i=process.env.TRANSCRIPTION_LANGUAGE||"en",s=process.env.TRANSCRIPTION_COMPUTE_TYPE||"float32",a=[e,"-o",n,"--task","transcribe","--without_timestamps","True","--language",i,"--compute_type",s],c=`faster-whisper ${a.join(" ")}`;f.default.info(`[${o.name}] Executing command: ${c}`);const l=(0,u.spawn)("faster-whisper",a);l.stdout.on("data",(e=>{f.default.debug(`[${o.name}] Faster Whisper stdout: ${e}`)})),l.stderr.on("data",(e=>{f.default.warn(`[${o.name}] Faster Whisper stderr: ${e}`)})),l.on("error",(e=>{f.default.error(`[${o.name}] Error in Faster Whisper process: ${e}`),r(new Error("Error in Faster Whisper process - make sure you have run the ./scripts/install-faster-whisper.sh script"))})),l.on("close",(async e=>{if(0===e)try{const e=await p.promises.readFile(n,"utf-8");f.default.debug(`[${o.name}] SRT content: ${e}`);const r=this.parseSrtContent(e);f.default.debug(`[${o.name}] Faster Whisper process completed successfully`),t(r)}catch(e){f.default.error(`[${o.name}] Error reading SRT file: ${e}`),r(new Error(`Error reading SRT file: ${e.message}`))}finally{await p.promises.unlink(n),f.default.debug(`[${o.name}] Temporary SRT file deleted: ${n}`)}else f.default.error(`[${o.name}] Faster Whisper process exited with code ${e}`),r(new Error(`Faster Whisper process exited with code ${e}`))}))}))}parseSrtContent(e){const t=e.split("\n");let r="";for(let e=0;e<t.length;e++)/^\d+$/.test(t[e])||/.*-->.*$/.test(t[e])||(r+=t[e].trim()+" ");return r.trim()}};t.AudioTranscriptionService=m,t.AudioTranscriptionService=m=o=a([(0,d.Injectable)()],m)},4623:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Dataset=void 0;const n=r(9100);t.Dataset=class{constructor(e,t,r=(0,n.ulid)(),o=new Date){this.id=r,this.name=e,this.baseDir=t,this.createdAt=o}}},4624:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProviderAdapterRegistry=void 0;const a=r(3563),c=s(r(9055));let l=class{constructor(e){this.adapters=new Map;for(const t of e)this.registerAdapter(t)}registerAdapter(e){this.adapters.set(e.id,e),c.default.info(`[ProviderAdapterRegistry] Registered adapter for provider: ${e.name} (${e.id})`)}getAdapter(e){const t=this.adapters.get(e);if(!t)throw new Error(`No adapter found for provider: ${e}`);return t}getAllAdapters(){return Array.from(this.adapters.values())}};t.ProviderAdapterRegistry=l,t.ProviderAdapterRegistry=l=n([(0,a.Injectable)(),i(0,(0,a.Inject)("PROVIDER_ADAPTERS")),o("design:paramtypes",[Array])],l)},4632:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StoredFileRepository=void 0;const s=r(3563),a=(r(1832),r(5775));let c=class{constructor(e){this.knex=e,this.columns={all:["id","fileContents","originalFilename","mimeType","createdAt","sessionId","workspaceName"],withoutContent:["id","originalFilename","mimeType","createdAt","sessionId","workspaceName"]}}async findAll(){return(await this.knex("stored_files").select(this.columns.withoutContent)).map((e=>a.StoredFileDto.fromStoredFile(e)))}async findById(e){const t=await this.knex("stored_files").select(this.columns.all).where("id",e).first();return t||null}async findByIdWithoutContent(e){const t=await this.knex("stored_files").select(this.columns.withoutContent).where("id",e).first();return t?a.StoredFileDto.fromStoredFile(t):null}async create(e){await this.knex("stored_files").insert(e)}async delete(e){await this.knex("stored_files").where("id",e).delete()}async findBySessionId(e){return(await this.knex("stored_files").select(this.columns.withoutContent).where("sessionId",e)).map((e=>a.StoredFileDto.fromStoredFile(e)))}async findByWorkspaceName(e){return(await this.knex("stored_files").select(this.columns.withoutContent).where("workspaceName",e)).map((e=>a.StoredFileDto.fromStoredFile(e)))}};t.StoredFileRepository=c,t.StoredFileRepository=c=n([(0,s.Injectable)(),i(0,(0,s.Inject)("KNEX")),o("design:paramtypes",[Function])],c)},4650:e=>{"use strict";e.exports=require("adm-zip")},4652:e=>{"use strict";e.exports=require("fs-extra")},4659:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GroqProvider=void 0;const o=r(1463),i=r(8483),s=r(8959),a=r(2368),c=n(r(8938));class l extends i.BaseProvider{getName(){return"groq"}getBaseChatModel(e,t){return new o.ChatGroq({modelName:this.shortModelName(e),temperature:t.temperature,apiKey:a.ConfigService.getInstance().getProperty("GROQ_API_KEY")})}async getModelDescriptors(){return(await this.fetchModels()).map((e=>new s.ModelDescriptor("groq",e,0,0,0,0)))}isValid(){return!!a.ConfigService.getInstance().getProperty("GROQ_API_KEY")}async fetchModels(){const e=a.ConfigService.getInstance().getProperty("GROQ_API_KEY");if(!e)return console.log("Groq API key not found"),[];try{const t=await c.default.get("https://api.groq.com/openai/v1/models",{headers:{Authorization:`Bearer ${e}`}});if(200===t.status){return(t.data.data||[]).map((e=>e.id))}return console.log(`Failed to fetch Groq models. Status code: ${t.status}`),[]}catch(e){return console.error(`Error fetching Groq models: ${e}`),[]}}}t.GroqProvider=l,l.LLAMA_31_8BB_INSTANT="groq/llama-3.1-8b-instant",l.LLAMA_31_70B_VERSATILE="groq/llama-3.1-70b-versatile",l.LLAMA_3_70B_8192_TOOL_USE="groq/llama3-groq-70b-8192-tool-use-preview"},4704:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentModeHandler=void 0;const a=r(3563),c=s(r(9055)),l=r(6297),d=r(6550),u=r(5324),f=r(6349),p=r(6963),h=r(4810),g=r(6663),m=r(5444),y=r(9100);let v=n=class{constructor(e,t,r,n,o,i){this.taskService=e,this.blockService=t,this.conversationHistoryService=r,this.agentLoopOrchestrator=n,this.webSocketService=o,this.eventHelper=i}async handleChangeAgentMode(e,t){l.debugLogger.log(`Received changeAgentMode from client ${t.id} for task ${e.taskId} to mode ${e.mode}`),c.default.info(`[${n.name}] Received changeAgentMode for task ${e.taskId} to mode ${e.mode}`);try{const r=await this.taskService.getTask(e.taskId);if(r.status===m.TaskStatus.WAITING_FOR_INPUT||"created"===r.status){await this.taskService.updateTask({taskId:e.taskId,mode:e.mode});const o=await this.blockService.getLastBlockForTask(e.taskId);if(o&&"tool_call"===o.blockType&&"plan_mode_respond"===o.tagName){const r={id:(0,y.ulid)(),taskId:e.taskId,role:"user",segments:[{type:"text",content:`Mode changed to ${e.mode}. Proceeding.`}],providerId:"system",createdAt:new Date};await this.conversationHistoryService.addMessage(e.taskId,r);const o=await this.conversationHistoryService.getHistory(e.taskId);await this.agentLoopOrchestrator.runAgentLoop(e.taskId,o,t.id,e.mode),c.default.info(`[${n.name}] Agent loop started with mode ${e.mode} for task ${e.taskId}`)}else"created"===r.status&&await this.taskService.updateTask({taskId:e.taskId,status:m.TaskStatus.WAITING_FOR_INPUT}),this.eventHelper.emitTaskUpdate(t.id,e.taskId,m.TaskStatus.WAITING_FOR_INPUT,null,e.mode),c.default.info(`[${n.name}] Mode changed for task ${e.taskId}, no agent loop started.`)}else{const o=`Cannot change mode while agent is ${r.status}. Wait until ready for input.`;c.default.warn(`[${n.name}] ${o} (Task: ${e.taskId})`),this.eventHelper.emitError(t.id,e.taskId,o,"handleChangeAgentMode","task_error")}}catch(r){c.default.error(`[${n.name}] Error handling mode change for task ${e.taskId}: ${r.message}\n${r.stack}`),this.eventHelper.emitError(t.id,e.taskId,`Error changing mode: ${r.message}`,"handleChangeAgentMode","task_error")}}async handleJoinTaskRoom(e,t){c.default.info(`[${n.name}] Client ${t.id} requested to join task room: ${e.taskId}`);try{await this.taskService.getTask(e.taskId),this.webSocketService.joinRoom(t.id,e.taskId)}catch(r){c.default.error(`[${n.name}] Error joining task room ${e.taskId}: ${r.message}`),t.emit("error",{message:`Error joining task room ${e.taskId}: ${r.message}`}),this.eventHelper.emitError(t.id,e.taskId,`Error joining task room: ${r.message}`,"handleJoinTaskRoom","task_error")}}};t.AgentModeHandler=v,t.AgentModeHandler=v=n=o([(0,a.Injectable)(),i("design:paramtypes",[d.TaskService,u.BlockService,f.ConversationHistoryService,p.AgentLoopOrchestrator,h.WebSocketService,g.EventHelper])],v)},4717:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceRepository=void 0;const s=r(3563);r(1832);let a=class{constructor(e){this.knex=e}async findAll(e){let t=this.knex("workspaces").select("*");return void 0!==e&&(t=t.where("isTemp",e)),t}async findByName(e){return this.knex("workspaces").where("name",e).first()}async findById(e){return this.knex("workspaces").where("id",e).first()}async create(e){const t={...e};e.portFromBaseDir||delete t.portFromBaseDir,await this.knex("workspaces").insert(e)}async update(e,t){await this.knex("workspaces").where("name",e).update(t)}async delete(e){await this.knex("workspaces").where("name",e).delete()}async updateLastAccessedAt(e){await this.knex("workspaces").where("name",e).update("lastAccessedAt",this.knex.fn.now())}async findUnlockedTempWorkspaceByRemoteUrl(e){return this.knex("workspaces").where({remoteRepoUrl:e,isTemp:!0,isLocked:!1}).orderBy("lastAccessedAt","desc").first()}};t.WorkspaceRepository=a,t.WorkspaceRepository=a=n([(0,s.Injectable)(),i(0,(0,s.Inject)("KNEX")),o("design:paramtypes",[Function])],a)},4778:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.McpToolFactoryService=void 0;const u=r(3563),f=r(2368),p=d(r(9055)),h=r(6910),g=r(499),m=c(r(9896)),y=c(r(6928)),v=r(9023);r(3192);let _=o=class{constructor(e){this.configService=e,this.readFileAsync=(0,v.promisify)(m.readFile),this.accessAsync=(0,v.promisify)(m.access)}async createMcpTools(){const e=this.configService.getProperty(h.ConfigPropNames.MCP_SERVERS_DIRECTORY,"~/.hldk/mcp-servers"),t=e.startsWith("~")?y.join(process.env.HOME||"",e.substring(1)):e,r=y.join(t,"mcp-servers.json");try{await this.accessAsync(r,m.constants.R_OK)}catch(e){return p.default.warn(`[${o.name}] MCP servers configuration file not found at ${r}`),[]}try{const e=await this.readFileAsync(r,"utf8"),t=JSON.parse(e);if(!t.mcpServers||0===Object.keys(t.mcpServers).length)return p.default.warn(`[${o.name}] No MCP servers defined in configuration`),[];const n=[];for(const[e,r]of Object.entries(t.mcpServers))if(r.disabled)p.default.info(`[${o.name}] Skipping disabled MCP server: ${e}`);else try{p.default.info(`[${o.name}] Initializing MCP server: ${e}`);const t=new g.MCPToolkit(r);await t.initialize();const i=await t.get_tools();p.default.info(`[${o.name}] Created ${i.length} tools from MCP server: ${e}`),n.push(...i)}catch(t){p.default.error(`[${o.name}] Failed to initialize MCP server ${e}: ${t.message}`)}return p.default.info(`[${o.name}] Created a total of ${n.length} MCP tools from all servers`),n}catch(e){return p.default.error(`[${o.name}] Error processing MCP servers configuration: ${e.message}`),[]}}};t.McpToolFactoryService=_,t.McpToolFactoryService=_=o=a([(0,u.Injectable)(),l("design:paramtypes",[f.ConfigService])],_)},4810:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketService=void 0;const s=r(3563),a=i(r(9055)),c=r(6297);let l=n=class{constructor(){this.clients=new Map}onModuleInit(){a.default.info(`[${n.name}] Initialized`)}setServer(e){this.server=e,a.default.info(`[${n.name}] Server instance set`)}getServer(){return this.server}addClient(e,t){this.clients.set(e,t),c.debugLogger.log(`Client added: ${e}`),c.debugLogger.log(`Total clients: ${this.clients.size}`),a.default.info(`[${n.name}] Client added: ${e}`)}removeClient(e){this.clients.delete(e),c.debugLogger.log(`Client removed: ${e}`),c.debugLogger.log(`Remaining clients: ${this.clients.size}`),a.default.info(`[${n.name}] Client removed: ${e}`)}getClient(e){return this.clients.get(e)}getAllClients(){return this.clients}joinRoom(e,t){const r=this.clients.get(e);r?(r.join(t),a.default.info(`[${n.name}] Client ${e} joined room ${t}`)):a.default.warn(`[${n.name}] Cannot join room: Client ${e} not found`)}leaveRoom(e,t){const r=this.clients.get(e);r&&(r.leave(t),a.default.info(`[${n.name}] Client ${e} left room ${t}`))}emitToClient(e,t,r){const o=this.clients.get(e);o?(o.emit(t,r),c.debugLogger.log(`Emitted ${t} to client ${e}`)):a.default.warn(`[${n.name}] Cannot emit to client: Client ${e} not found`)}emitToRoom(e,t,r){this.server?(this.server.to(e).emit(t,r),c.debugLogger.log(`Emitted ${t} to room ${e}`)):a.default.warn(`[${n.name}] Cannot emit to room: Server not initialized`)}broadcast(e,t){this.server?(this.server.emit(e,t),c.debugLogger.log(`Broadcasted ${e} to all clients`)):a.default.warn(`[${n.name}] Cannot broadcast: Server not initialized`)}};t.WebSocketService=l,t.WebSocketService=l=n=o([(0,s.Injectable)()],l)},4833:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReadFileTool=void 0;const u=r(3563),f=c(r(1943)),p=c(r(6928)),h=d(r(9055)),g=r(9581);let m=o=class{constructor(e){this.name="read_file",this.description="Request to read the contents of a file at the specified path.",this.workingDir=e}validateParams(e){return"string"==typeof e.path&&""!==e.path.trim()}getUsageInstructions(e){return`## read_file\nDescription: Request to read the contents of a file at the specified path. Use this when you need to examine the contents of an existing file you do not know the contents of, for example to analyze code, review text files, or extract information from configuration files. Automatically extracts raw text from PDF and DOCX files. May not be suitable for other types of binary files, as it returns the raw content as a string.\nParameters:\n- path: (required) The path of the file to read (relative to the current working directory ${e.workingDir})\nUsage:\n<read_file>\n<path>File path here</path>\n</read_file>`}async execute(e){const t=e.path;h.default.info(`[${o.name}] Attempting to read file: ${t} relative to ${this.workingDir}`);const r=p.resolve(this.workingDir,t);if(!r.startsWith(this.workingDir)){const e=`Path traversal attempt detected: ${t} resolves outside of workspace ${this.workingDir}`;throw h.default.error(`[${o.name}] ${e}`),new g.FileSystemError(e,"PATH_TRAVERSAL_ERROR")}try{if(!(await f.stat(r)).isFile()){const e=`Path is not a file: ${t}`;throw h.default.error(`[${o.name}] ${e}`),new g.FileNotFoundError(e,t)}const e=await f.readFile(r,"utf8");return h.default.info(`[${o.name}] File ${t} read successfully`),e}catch(e){if("ENOENT"===e.code){const e=`File not found: ${t}`;throw h.default.error(`[${o.name}] ${e}`),new g.FileNotFoundError(e,t)}const r=`Error reading file ${t}: ${e.message}`;throw h.default.error(`[${o.name}] ${r}\n${e.stack}`),new g.FileSystemError(r,e.code||"FS_READ_ERROR")}}};t.ReadFileTool=m,t.ReadFileTool=m=o=a([(0,u.Injectable)(),l("design:paramtypes",[String])],m)},4835:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TreeSitterValidator=void 0;const a=r(3563),c=r(873),l=s(r(9055));let d=n=class{constructor(e){this.treeSitterService=e}getPriority(){return 100}canValidate(e){return this.treeSitterService.isExtensionSupported(e)}async validate(e,t,r){l.default.debug(`[${n.name}] Validating file: ${e}`);const o=this.treeSitterService.getSyntaxIssues(e,t);let i="";return o.length>0&&(i=o.map((e=>`${e.filePath}:${e.line}:${e.column}: ${e.severity}: ${e.message}`)).join("\n")),{validatorName:this.getName(),validationMethod:"TreeSitter syntax analysis",hasErrors:o.length>0,report:i}}getName(){return"TreeSitter"}};t.TreeSitterValidator=d,t.TreeSitterValidator=d=n=o([(0,a.Injectable)(),i("design:paramtypes",[c.TreeSitterService])],d)},4897:e=>{"use strict";e.exports=require("@langchain/community/document_loaders/fs/pptx")},4911:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GitCommit=void 0;const c=r(7773),l=s(r(9896)),d=s(r(6928)),u=a(r(9055)),f=a(r(3807)),p=r(2434);class h extends c.Tool{async ensureGitignoreExists(){return p.GitUtils.ensureGitignoreExists(this.repoBaseDir)}constructor(e,t,r){super(),this.repoBaseDir=e,this.requestId=t,this.sessionService=r,this.name="git_commit",this.description="Commits changes to the git repository",this.MAX_DIFF_SIZE=5e4,this.git=(0,f.default)(this.repoBaseDir)}async parseGitDiffOutput(e){const t=e.match(/(\d+) files? changed(?:, (\d+) insertions?\(\+\))?(?:, (\d+) deletions?\(-\))?/),r=t&&t[2]?parseInt(t[2]):0,n=t&&t[3]?parseInt(t[3]):0;return{filesChanged:t?parseInt(t[1]):0,insertions:r,deletions:n,linesChanged:Math.max(r,n)}}async getGitStats(){await this.git.add("-A");const e=await this.git.diff(["--cached","--shortstat"]),t=(await this.git.diff(["--cached","--name-only"])).split("\n").filter((e=>e.includes("test")));let r="";return t.length>0&&(r=await this.git.diff(["--cached","--shortstat",...t])),{allFiles:await this.parseGitDiffOutput(e),testFiles:await this.parseGitDiffOutput(r)}}async storeRequestSpecJsonFile(e){const t=await this.sessionService.getRequest(this.requestId);if(!t||!t.requestContent)return void u.default.warn(`Unable to store request content for requestId: ${this.requestId}`);if(!await this.sessionService.getSession(t.sessionId))return void u.default.warn(`Session not found for requestId: ${this.requestId}`);if("false"===process.env.STORE_SPECS_IN_WORKSPACE)return;const r=new Date,n=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`,o=d.join(this.repoBaseDir,".eve","specs",n);l.mkdirSync(o,{recursive:!0});const i=await this.sessionService.getRequestStats(this.requestId),s=i.cost,a=await this.getGitStats(),c=Date.now()-new Date(t.startedAt).getTime(),f={spec:t.requestContent,commitMessage:e,stats:{...i,cost:s,currency:"gbp",processingMillis:c,git:{...a.allFiles,testFilesChanged:a.testFiles.filesChanged,testInsertions:a.testFiles.insertions,testDeletions:a.testFiles.deletions,linesChanged:a.allFiles.linesChanged,testLinesChanged:a.testFiles.linesChanged}}},p=d.join(o,`${this.requestId}.json`);l.writeFileSync(p,JSON.stringify(f,null,2)),await this.sessionService.updateGitStats(this.requestId,{...a.allFiles,testFilesChanged:a.testFiles.filesChanged,testInsertions:a.testFiles.insertions,testDeletions:a.testFiles.deletions,linesChanged:a.allFiles.linesChanged,testLinesChanged:a.testFiles.linesChanged})}async _call(e){try{const t=await this.ensureGitignoreExists();await this.storeRequestSpecJsonFile(e),u.default.info(`Committing changes to git with message: ${e}`),await this.git.add("-A"),t&&(await this.git.add(".gitignore"),e=`${e}\n\nAutomatically added .gitignore file with default patterns`),await this.git.commit(e);const r=`Successfully committed changes with message: ${e}`;return t?`${r}\nNote: Created a new .gitignore file with default patterns`:r}catch(e){return u.default.error("Error in GitCommit tool:",e),`Failed to commit changes: ${e.message}`}}async hasUncommittedUpdates(){try{await this.ensureGitignoreExists();const e=await this.git.status();return u.default.info("Git status: %s",JSON.stringify(e)),e.files.length>0}catch(e){throw u.default.error("Error checking for uncommitted updates:",e),new Error(`Failed to check for uncommitted updates: ${e.message}`)}}async getUncommittedChanges(){try{await this.ensureGitignoreExists();const e=await this.git.status();let t="";const r=await this.git.raw(["rev-parse","--verify","HEAD"]).catch((()=>!1));if(r){const e=await this.git.diff(["HEAD"]);e&&(t+=e)}if(e.not_added.length>0)for(const r of e.not_added)if(l.existsSync(d.join(this.repoBaseDir,r))){const e=l.readFileSync(d.join(this.repoBaseDir,r),"utf8");t+=`\n\nNew file: ${r}\n`,t+=`+++ ${r}\n`,t+=e.split("\n").map((e=>`+ ${e}`)).join("\n")}if(t.length>this.MAX_DIFF_SIZE){u.default.warn("Git diff is too large to summarise - returning just the filenames");let t="";return r&&(t=await this.git.diff(["HEAD","--name-only"])),e.not_added.length>0&&(t+=(t?"\n":"")+"Untracked files:\n"+e.not_added.join("\n")),t}return u.default.debug(`Git diff: ${t}`),t||"No changes detected"}catch(e){throw u.default.error("Error getting uncommitted changes:",e),new Error(`Failed to get uncommitted changes: ${e.message}`)}}}t.GitCommit=h},4912:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MavenSourceArtefactScheme=void 0;const l=r(3563),d=r(8547),u=c(r(8938)),f=a(r(1943)),p=a(r(6928)),h=a(r(857)),g=c(r(4650)),m=c(r(9055));let y=class{getName(){return"maven"}async downloadAndStoreSources(e,t,r){if(m.default.info(`Downloading and storing sources for Maven artifact: ${e}`),!this.isValidGAV(e))throw m.default.warn(`Invalid Maven GAV coordinates: ${e}`),new l.BadRequestException("Invalid Maven GAV coordinates");const n=this.getRepoUrls(r);m.default.info(`Using repository URLs: ${n.join(", ")}`);const o=await this.findSourcesJarUrl(n,e);if(!o)throw m.default.warn(`Sources jar not found for ${e} in any of the provided repositories`),new l.BadRequestException("Sources jar not found in any of the provided repositories");m.default.info(`Found sources jar at: ${o}`);const i=await f.mkdtemp(p.join(h.tmpdir(),"maven-sources-")),s=p.join(i,"sources.jar");try{await this.downloadFile(o,s),m.default.info(`Downloaded sources jar to: ${s}`);const r=e.replace(/:/g,"/"),n=p.join(t,"maven",r);await f.mkdir(n,{recursive:!0}),m.default.info(`Created cache directory: ${n}`),await this.unzipJar(s,n),m.default.info(`Unzipped sources jar to: ${n}`);const i=new d.SourceArtefact({scheme:this.getName(),locator:e,valid:!0,error:null,repo:new URL(o).origin,cacheSrcBaseDir:n});return m.default.info(`Successfully created SourceArtefact for ${e}`),i}finally{await f.rm(i,{recursive:!0,force:!0}),m.default.info(`Cleaned up temporary directory: ${i}`)}}async needsImport(e){if(!e.cacheSrcBaseDir)return!0;try{return 0===(await f.readdir(e.cacheSrcBaseDir)).length}catch(e){return!0}}async readArtefactSourceTree(e){if(!e.cacheSrcBaseDir)throw new Error("Invalid source artefact: missing cache directory");const{generateTree:t}=await Promise.resolve().then((()=>a(r(6426))));return t(e.cacheSrcBaseDir)}async readArtefactSourceFile(e,t){if(!e.cacheSrcBaseDir)throw new Error("Invalid source artefact: missing cache directory");const r=p.join(e.cacheSrcBaseDir,t);try{return await f.readFile(r,"utf-8")}catch(e){throw new Error(`Failed to read file: ${t}`)}}isValidGAV(e){return/^[^:]+:[^:]+:[^:]+$/.test(e)}getRepoUrls(e){if(e&&e.length>0)return e;const t=process.env.MAVEN_REPO_URLS;return t?t.split(",").map((e=>e.trim())):["https://repo.maven.apache.org/maven2"]}async findSourcesJarUrl(e,t){const[r,n,o]=t.split(":"),i=`${r.replace(/\./g,"/")}/${n}/${o}/${n}-${o}-sources.jar`;for(var s of e){s.endsWith("/")||(s+="/");const e=new URL(i,s).toString();m.default.info(`Checking URL: ${e}`);try{return await u.default.head(e),e}catch(t){m.default.info(`Error checking maven url ${e}: ${t}`)}}return null}async downloadFile(e,t){const r=await u.default.get(e,{responseType:"arraybuffer"});await f.writeFile(t,r.data)}async unzipJar(e,t){new g.default(e).extractAllTo(t,!0)}};t.MavenSourceArtefactScheme=y,t.MavenSourceArtefactScheme=y=s([(0,l.Injectable)()],y)},4934:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ComputerToolLinux=void 0;const o=r(1569),i=r(5317),s=r(9023),a=r(3903),c=n(r(943)),l=n(r(3864)),d=n(r(9896)),u=n(r(6928)),f=r(7751),p=r(7650),h=(0,s.promisify)(i.exec);class g extends f.ComputerToolBase{validateParams(e){return o.z.object({action:o.z.enum(["key","type","mouse_move","left_click","left_click_drag","right_click","middle_click","double_click","screenshot","cursor_position"]),text:o.z.string().optional(),coordinate:o.z.array(o.z.number()).length(2).optional()}).parse(e)}constructor(){if(super(),this.screenshotDelay=2,this.scalingEnabled=!0,this.outputDir="/tmp/outputs",!l.default.sync("xdotool"))throw new Error("xdotool is not installed. Please install it via your package manager.");if(!l.default.sync("gnome-screenshot")&&!l.default.sync("scrot"))throw new Error("Neither gnome-screenshot nor scrot is installed. Please install one of them.");if(!l.default.sync("convert"))throw new Error("ImageMagick is not installed. Please install it via your package manager.");const e=process.env.DISPLAY_NUM;this.displayPrefix=void 0!==e?`DISPLAY=:${e} `:"",this.xdotool=`${this.displayPrefix}xdotool`}async execute(e){const t=this.validateParams(e),{action:r,text:n,coordinate:o}=t;try{let e;switch(r){case"mouse_move":case"left_click_drag":if(!o)throw new p.ToolError(`coordinate is required for ${r}`);const[t,i]=o;e="mouse_move"===r?await this.shell(`${this.xdotool} mousemove --sync ${t} ${i}`):await this.shell(`${this.xdotool} mousedown 1 mousemove --sync ${t} ${i} mouseup 1`);break;case"key":if(!n)throw new p.ToolError(`text is required for ${r}`);e=await this.shell(`${this.xdotool} key -- ${n}`);break;case"type":if(!n)throw new p.ToolError(`text is required for ${r}`);e=await this.typeText(n);break;case"left_click":case"right_click":case"middle_click":case"double_click":e=await this.clickAction(r);break;case"screenshot":return e=await this.screenshot(),[{type:"image_url",image_url:{url:`data:image/png;base64,${e.base64_image}`}}];case"cursor_position":e=await this.getCursorPosition();break;default:throw new p.ToolError(`Invalid action: ${r}`)}return e.output}catch(e){return e instanceof p.ToolError?`Error: ${e.message}`:`Unexpected error: ${e}`}}async typeText(e){const t=this.chunkText(e,50);let r="";for(const e of t){const t=`${this.xdotool} type --delay 12 -- ${c.default.quote([e])}`;r+=(await this.shell(t,!1)).output}const n=await this.screenshot();return new p.ToolResult(r,"",n.base64_image)}async clickAction(e){const t={left_click:"1",right_click:"3",middle_click:"2",double_click:"--repeat 2 --delay 500 1"}[e];return await this.shell(`${this.xdotool} click ${t}`)}async getCursorPosition(){const e=(await this.shell(`${this.xdotool} getmouselocation --shell`,!1)).output||"",t=e.match(/X=(\d+)/),r=e.match(/Y=(\d+)/);if(!t||!r)throw new p.ToolError(`Failed to parse cursor position: ${e}`);const n=parseInt(t[1],10),o=parseInt(r[1],10);return new p.ToolResult(`X=${n},Y=${o}`,"")}async screenshot(){d.default.mkdirSync(this.outputDir,{recursive:!0});const e=u.default.join(this.outputDir,`screenshot_${(0,a.v4)().replace(/-/g,"")}.png`);let t="";if(l.default.sync("gnome-screenshot"))t=`${this.displayPrefix}gnome-screenshot -f ${e} -p`;else{if(!l.default.sync("scrot"))throw new p.ToolError("Neither gnome-screenshot nor scrot is available.");t=`${this.displayPrefix}scrot -p ${e}`}const r=await this.shell(t,!1);if(await this.shell(`convert ${e} -resize ${this.width}x${this.height}! ${e}`,!1),d.default.existsSync(e)){const t=d.default.readFileSync(e).toString("base64");return new p.ToolResult("","",t)}throw new p.ToolError(`Failed to take screenshot: ${r.error}`)}async shell(e,t=!0){const{stdout:r,stderr:n}=await h(e,{shell:"/bin/bash"});let o=null;return t&&(await new Promise((e=>setTimeout(e,1e3*this.screenshotDelay))),o=(await this.screenshot()).base64_image),new p.ToolResult(r,n,o)}chunkText(e,t){const r=[];for(let n=0;n<e.length;n+=t)r.push(e.slice(n,n+t));return r}}t.ComputerToolLinux=g},4970:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReadFile=void 0;const c=r(5534),l=r(1569),d=s(r(9896)),u=s(r(6928)),f=a(r(9055));class p extends c.Tool{constructor(e){super(),this.name="read_file",this.description="Read the content of a file in the workspace. Should only be used for reading files that are expected to be text based. Do not use this tool for binary files.",this.schema=l.z.object({filePath:l.z.string().describe("The relative path of the file to read")}),this.workspaceRootDir=e}async _call(e){return`The content of the file at path: ${e.filePath} is as follows:\n${this.readFile(e.filePath)}`}readFile(e){f.default.info(`ReadFile.readFile called with: ${e}`);const t=u.join(this.workspaceRootDir,e);try{return d.readFileSync(t,"utf-8")}catch(t){return"ENOENT"===t.code?`Error: File not found - ${e}`:`Error reading file: ${t.message}`}}}t.ReadFile=p},5015:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigController=void 0;const s=r(3563),a=r(2368);let c=class{constructor(e){this.configService=e}getConfig(){return this.configService.getConfig()}async getAllProperties(){return this.configService.getAllProperties()}async getProperty(e){return this.configService.getProperty(e)}async setProperty(e,t){return await this.configService.setProperty(e,t),{message:"Property set successfully"}}async unsetProperty(e){return await this.configService.unsetProperty(e),{message:"Property unset successfully"}}async updateMultipleProperties(e){for(const[t,r]of Object.entries(e))await this.configService.setProperty(t,r);return{message:"Properties updated successfully"}}};t.ConfigController=c,n([(0,s.Get)(),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],c.prototype,"getConfig",null),n([(0,s.Get)("properties"),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],c.prototype,"getAllProperties",null),n([(0,s.Get)("property/:name"),i(0,(0,s.Param)("name")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],c.prototype,"getProperty",null),n([(0,s.Put)("property/:name"),i(0,(0,s.Param)("name")),i(1,(0,s.Body)("value")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],c.prototype,"setProperty",null),n([(0,s.Delete)("property/:name"),i(0,(0,s.Param)("name")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],c.prototype,"unsetProperty",null),n([(0,s.Post)("properties"),i(0,(0,s.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],c.prototype,"updateMultipleProperties",null),t.ConfigController=c=n([(0,s.Controller)("config"),o("design:paramtypes",[a.ConfigService])],c)},5017:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SEAgentService=void 0;const a=r(3563),c=r(6158),l=r(3470),d=s(r(9055)),u=r(2300),f=r(5277),p=r(8921);let h=class extends f.GraphAgentService{constructor(e,t,r){super(e,t,r),this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}getName(){return"se-agent"}async getTools(e){const t=["list_files","read_file","update_file","delete_file","command_line","fetch_web_page","read_dependency_source_tree","read_dependency_source_file","git_commit","current_timestamp","grep","find_files","serp_api"];return e.workspace.portFromBaseDir&&t.push("read_port_from_file"),await this.toolFactoryService.createTools(t,e)}async getSystemPrompt(e){const t=await p.EpicsPrompts.updateStoryTasks(e);let r=`As an AI Software Engineer assistant, you are tasked with analysing the software system and answering questions about it and/or making improvements to it.\n  Follow these guidelines:\n  1. Review the file structure tree below and use the read_file tool to answer questions about the system and suggest improvements where appropriate. Provide a concise summary of your findings.\n  2. When making changes to the system:\n     a. First, fetch all the files you think you might need using the read_file tool. For files in the portFromBaseDir, use the read_port_from_file tool. For gradle/maven projects you can also use the read_dependency_source_tree and read_dependency_source_file tools to fetch the source code for dependencies and inspect them to learn how to interact with them.\n     b. Make a clear plan with multiple steps.\n     c. Iterate through the plan, one step at a time.\n     d. Think step-by-step and explain the needed changes in a few short sentences.\n     e. Each change MUST be done by invoking the update_file tool to replace a part of the file with a new bit.\n     f. Before adding new dependencies to a build/dependencies file search the web to look for the latest version - your training data is old :0)\n  3. Use the read_file tool to retrieve the contents of specific files when needed rather than guessing at what they contain.\n     When making edits to previously referenced files, always keep the name/path the same.\n  4. When choosing a file path for generated artifacts, consider the structure and choose a logical location.\n  5. When a specific file name is mentioned, look for it in the structure below and use the read_file tool to get the content of that file.\n  6. Consider the following when suggesting improvements:\n     a. Code organization and structure\n     b. Adherence to best practices and design patterns\n     c. Performance optimizations\n     d. Security considerations\n     e. Scalability and maintainability\n     f. Documentation and comments\n  7. Provide clear explanations for your suggestions and recommendations.\n  8. If you need to create new files or modify existing ones, clearly indicate the file path and content.\n  9. When generating new code or modifying existing code, always look at similar or nearby files in the source tree for guidance on:\n     a. Code style and formatting\n     b. Logging practices\n     c. Error handling\n     d. Import statements and module organization\n     e. Commenting style and docstring format\n     f. Naming conventions for variables, functions, and classes\n     g. Tools, libraries, and frameworks being used\n     h. Your ending summary should be a concise summary of a) which files were updated and b) what changes were made to them.\n  10. To find similar files:\n      a. Examine the file structure provided below.\n      b. Identify files in the same directory or nearby directories with similar purposes or file extensions.\n      c. Use the read_file tool to retrieve the contents of these similar files for reference.\n  11. Ensure that new code generation and modifications align with the existing codebase's style and best practices.\n  12. Do not make assumptions about tools, libraries, or frameworks being used:\n      a. Always fetch and examine similar existing files before creating new ones.\n      b. When adding a new entity or data class, fetch an existing one first and use the same tooling and styles.\n      c. For data migrations, look at an existing migration file to understand the tooling and practices used in the repository.\n      d. Consistently use the same tools and approaches found in the existing codebase.\n  13. When making changes to the system use the update_file tool as follows:\n      a. Always provide the path to the file you want to change (or create) as the first argument.\n      b. The second argument is the SEARCH block - the bit of the existing code you want to replace. For new files this should be an empty string.\n      c. The third argument is the REPLACE block - the bit of the new code you want to replace it with. DO NOT FORGET TO INCLUDE THIS!!\n      d. Always try to minimise the size of the SEARCH block so you are only updating the specific parts of the file that need updating.\n      e. If you need to make edits to multiple parts of a single file, make a plan and do so in a series of update_file calls.\n      f. If you get an error back from the tool saying the search block was not found then you can try again with a larger search block or the entire contents of the file as the search block.\n  14. To delete a file, use the delete_file tool:\n      a. Provide the relative path of the file to delete as the argument.\n      b. Always confirm the file deletion with the user before proceeding.\n  15. When refactoring or renaming files:\n      a. Use the update_file tool to create the new file with the desired content.\n      b. Use the delete_file tool to remove the old file.\n      c. Update any references to the old file in other parts of the codebase using the update_file tool.\n  16. ${e.workspace.isGitRepo?"After making changes to the system, always commit the changes to git using the git_commit tool:\n      a. Use the git_commit tool with a brief, descriptive commit message of the changes you've made.\n      b. The git_commit tool will automatically stage and commit all changes, so you don't need to worry about git add commands.\n  17. If the user asks you to undo or /undo or undo the last changes, inform them that you cannot directly undo git commits, but they can use git reset --hard HEAD~1 in their local environment if needed.":"This workspace is not a git repository. You cannot commit changes or use git commands. Instead, focus on analyzing the code and suggesting improvements without version control operations."}\n  18. You can use the command_line tool to execute commands in the workspace directory${e.workspace.isGitRepo?", but not for git operations":""}. This includes system commands, package managers, build tools, etc. But remember the following:\n      a. Do not traverse up above the workspace directory though and only do things that are safe and can definitely be undone.\n      b. Only use package manager/build commands if you are sure of the correct one. Look in the readme or the build files to find out for sure and if not sure then do not use them. Just say what you might do to complete the task.\n      c. ALWAYS include automatic confirmation flags for interactive commands to prevent hanging:\n         - Use --yes or -y for apt, apt-get\n         - Use -y for yum\n         - Use --no-input for pip\n         - Use -f or --force for npm/pnpm\n         - Use --defaults for yeoman\n         - Use --non-interactive for composer\n         - Use --assume-yes for other tools\n         - Add appropriate silent/quiet flags when available\n  19. You can use the read_dependency_source_tree and read_dependency_source_file tools to fetch the source code for dependencies and inspect them to learn how to interact with them. Look in the build file (e.g. pom.xml or build.gradle) or package metadata (e.g. package.json) and then use that to build the correct scheme and locator.\n  20. Always use the git_commit tool for git operations instead of the command_line tool. The git_commit tool is specifically designed for safe and efficient git operations in this environment.\n      `;return e.workspace.buildOrTestCommand?r+=`\n  21. After making changes to the system, but before committing them to git, consider the following:\n      a. If you have updated any code files (not just scripts, documentation, or other non-code files), you should run the following command to test if the changes haven't broken anything:\n         Use the command_line tool to execute this command: ${e.workspace.buildOrTestCommand}\n      b. If you run the test and any errors occur, try to fix them if it seems feasible.\n      c. If the errors cannot be fixed easily, stop processing and report the error to the user without committing the changes to git.\n      d. If you don't run the test or if the build or test is successful, proceed with committing the changes to git.\n      e. Remember, you only need to run this test command if you've made changes to actual code files, not for changes to scripts, documentation, or other non-code files.`:r+='\n  21. After making changes to the system, but before committing them to git, you need to determine and run the appropriate build/compile command based on the type of code that was modified:\n\n      a. For JavaScript/TypeScript frontend projects:\n         - Look for package.json in the project root or frontend directory\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && pnpm build --force\n           2. cd <project-dir> && pnpm compile --force\n           3. cd <project-dir> && pnpm lint --force\n         \n      b. For Node.js/TypeScript backend projects:\n         - Look for package.json in the project root or backend directory\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && pnpm build --force\n           2. cd <project-dir> && pnpm compile --force\n           3. cd <project-dir> && tsc --noEmit\n           4. cd <project-dir> && pnpm lint --force\n\n      c. For Java/Kotlin projects with Maven:\n         - Look for pom.xml in the project directory\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && ./mvnw compile -DskipTests\n           2. cd <project-dir> && ./mvnw install -DskipTests\n           3. cd <project-dir> && mvn compile -DskipTests\n           4. cd <project-dir> && mvn install -DskipTests\n\n      d. For Java/Kotlin projects with Gradle:\n         - Look for build.gradle or build.gradle.kts\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && ./gradlew compileJava -x test\n           2. cd <project-dir> && ./gradlew classes -x test\n           3. cd <project-dir> && ./gradlew build -x test\n           4. cd <project-dir> && gradle compileJava -x test\n\n      e. For Python projects:\n         - Look for setup.py, pyproject.toml, or requirements.txt\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && python -m compileall .\n           2. cd <project-dir> && pylint --errors-only .\n           3. cd <project-dir> && mypy .\n\n      f. For Go projects:\n         - Look for go.mod file\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && go build ./...\n           2. cd <project-dir> && go vet ./...\n           3. cd <project-dir> && golangci-lint run --fast\n\n      g. For Rust projects:\n         - Look for Cargo.toml\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && cargo check\n           2. cd <project-dir> && cargo build\n           3. cd <project-dir> && cargo clippy\n\n      h. For .NET/C# projects:\n         - Look for .csproj or .sln files\n         - Common commands to try (in order of preference):\n           1. cd <project-dir> && dotnet build --no-restore\n           2. cd <project-dir> && dotnet build /p:TreatWarningsAsErrors=true\n\n      IMPORTANT GUIDELINES:\n      1. Always cd into the specific directory where the code was modified before running build commands\n      2. Choose the fastest command that will catch compilation/lint errors (avoid full builds if possible)\n      3. Skip tests (use flags like -DskipTests, -x test, etc.) to keep the build fast\n      4. Add appropriate flags to suppress prompts (--force, -y, etc.)\n      5. If multiple files were modified in different projects, run the appropriate command for each project\n      6. If a build fails, report the error and try to fix it before committing\n      7. Look for project-specific build scripts in package.json scripts section or similar configuration files\n      8. For monorepos, only build the affected packages/projects\n      \n      After successfully building and committing the changes, look for relevant integration tests:\n      1. Use the grep and find_files tools to search for test files related to the components you modified\n      2. Look for test files with names like "*e2e*.ts", "*integration*.ts", "*e2e-spec.ts", "*IntegrationTest.kt|java|py", "*IT.kt|java|py" etc.\n      3. If you find relevant integration tests, suggest running them to the user:\n         - Show the exact command needed to run the specific test(s)\n         - Ask if they would like to execute the test command\n         - If they agree, run the command and help fix any issues that arise\n      4. If no specific integration tests are found, suggest running the general test suite for that part of the codebase (e.g. "cd backend && gradle test" or "cd frontend && pnpm test" etc.)',r+=`\n  \n  Here is the file tree of the system:\n  ${e.repositoryTree()}\n  \n  ${e.portFromSourceTree()?`\n  Here is the "port from" file tree containing another codebase that you can learn from and/or port code from (use read_port_from_file tool to read files from here):\n  ${e.portFromSourceTree()}\n  `:""}\n\n  ${e.repositoryHints()?`Additional hints:\n${e.repositoryHints()}`:""}\n  \n  ${e.workspace.buildOrTestCommand?`Build or Test Command: ${e.workspace.buildOrTestCommand}`:""}\n  \n  IMPORTANT: Keep your final summary concise and to the point. If you have made changes to multiple files, only list the files that have been changed and a short description of the changes for each file.\n  IMPORTANT: When using the update_file tool you MUST provide all 3 arguments: filePath, search & REPLACE. DO NOT FORGET TO INCLUDE THE REPLACE BLOCK!!\n  IMPORTANT: ALWAYS GO LOOKING IN THE CODEBASE AND FETCH ANY FILES YOU THINK YOU NEED TO LEARN FROM BEFORE MAKING CHANGES. DO NOT MAKE ASSUMPTIONS ABOUT WHAT IS IN A FILE - JUST FETCH IT!\n  IMPARTANT: You must NEVER try to stop processes or kill running processes. You must only use the command_line tool to execute commands.\n  IMPORTANT: Always use the update_file tool to make changes to the codebase. Never use the command_line tool to make changes to update source code.\n  IMPORTANT: If asked by the user, you can use the fetch_web_page tool to read the content of a web page. Only use this tool when explicitly requested by the user to fetch a specific URL.\n  IMPORTANT: When using the command_line tool, ALWAYS include automatic confirmation flags (--yes, -y, --force, etc.) for interactive commands to prevent hanging.\n  IMPORTANT: Add appropriate silent/quiet flags to command line operations when available to reduce unnecessary output.\n  \n  ${e.workspace.buildOrTestCommand?`\n    IMPORTANT: Run: ${e.workspace.buildOrTestCommand} to build and test the project after making changes to the code.\n    IMPORTANT: If you get an error then fix it and run the test again until you get it right.\n    IMPORTANT: If the build error relates to a maven/gradle dependency then you should use the read_dependency_source_tree and read_dependency_source_file tools to fetch the source code for the dependency and inspect it to see if you can fix the problem.\n    `:"IMPORTANT: DO NOT FORGET TO RUN AN APPROPRIATE BUILD COMMAND TO VERIFY THAT THE CHANGES YOU HAVE MADE HAVE NOT BROKEN ANYTHING! "}\n  IMPORTANT: IF YOU MADE CODE CHANGES THEN YOU MUST REMEMBER TO COMMIT YOUR CHANGES TO GIT! DO NOT FORGET THIS!\n\n  # Task Management Instructions\n  ${t}\n\n  IMPORTANT: When implementing tasks:\n  1. Always check the task status in the task JSON file before starting work\n  2. Update the task status to "inprogress" when you start working on it\n  3. Update the task status to "done" when you complete it\n  4. Always use current_timestamp to update the updatedAt field when changing task status\n  5. Remember that task status changes may require updating the parent story status\n  `,d.default.debug(`SE Agent system prompt for workspace '${e.workspace.name}' (length: ${r.length} chars): ${r}`),r}};t.SEAgentService=h,t.SEAgentService=h=n([(0,a.Injectable)(),i(0,(0,a.Inject)((0,a.forwardRef)((()=>u.GraphAgentCollaborator)))),o("design:paramtypes",[u.GraphAgentCollaborator,c.ToolFactoryService,l.AgentRuleService])],h)},5018:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MCPTest=void 0;const o=r(5534),i=r(1569),s=r(5317),a=n(r(9055)),c=n(r(6928));class l extends o.Tool{constructor(e){super(),this.name="mcp_test",this.description="Test a command with the Model Context Protocol (MCP) lifecycle. This tool will return the MCP server capabilities JSON, available tools list, and tool invocation results",this.schema=i.z.object({command:i.z.string().describe("The command to execute to start the MCP server"),envVars:i.z.record(i.z.string()).optional().describe("Optional environment variables to set"),workingDir:i.z.string().optional().describe("Optional working directory relative to the workspace root")}),this.timeout=1e4,this.workspaceRootDir=e,this.maxOutputChars=parseInt(process.env.MAX_TOOL_OUTPUT_CHARS||"20000")}clipString(e){return e.length>this.maxOutputChars?e.slice(0,this.maxOutputChars/2)+"\n... [output truncated] ...\n"+e.slice(-this.maxOutputChars/2):e}async _call({command:e,envVars:t,workingDir:r}){try{const n=r?c.default.join(this.workspaceRootDir,r):this.workspaceRootDir;a.default.info(`Executing MCP test command: ${e} in directory: ${n}`);const o=e.split(" "),i=o[0],l=o.slice(1),d={...process.env,...t||{}};return new Promise(((t,r)=>{const o=(0,s.spawn)(i,l,{cwd:n,env:d});let c="",u="",f=!1,p="";const h=setTimeout((()=>{o.kill("SIGTERM");const e=`MCP test timed out after ${this.timeout}ms`;a.default.warn(e),r(e)}),this.timeout);o.stdout.on("data",(e=>{const t=e.toString();c+=t,a.default.debug(`MCP stdout: ${t}`);try{const e=t.split("\n").filter((e=>e.trim()));for(const t of e){const e=JSON.parse(t);2===e.id&&e.result&&e.result.tools&&(p=JSON.stringify(e.result,null,2))}}catch(e){}})),o.stderr.on("data",(e=>{const t=e.toString();u+=t,a.default.debug(`MCP stderr: ${t}`)})),o.on("close",(r=>{clearTimeout(h);const o=`MCP test ${0===r?"completed successfully":"exited with code "+r}.\nCommand: ${e}\nWorking directory: ${n}\n==== TOOLS RESPONSE ====\n${p||"No tools response received"}\n==== STDOUT ====\n${this.clipString(c)}\n==== STDERR ====\n${this.clipString(u)}`;t(o)})),o.on("error",(e=>{clearTimeout(h),a.default.error(`MCP test error: ${e.message}`),r(`Error executing MCP test: ${e.message}`)}));const g={jsonrpc:"2.0",id:1,method:"initialize",params:{protocolVersion:"2024-11-05",capabilities:{roots:{listChanged:!0},sampling:{},tools:{listChanged:!0}},clientInfo:{name:"EveMCPTestClient",version:"1.0.0"}}};a.default.debug(`Sending MCP initialize message: ${JSON.stringify(g)}`),o.stdin.write(JSON.stringify(g)+"\n"),setTimeout((()=>{const e={jsonrpc:"2.0",method:"notifications/initialized"};a.default.debug(`Sending MCP initialized notification: ${JSON.stringify(e)}`),o.stdin.write(JSON.stringify(e)+"\n"),f=!0,setTimeout((()=>{const e={jsonrpc:"2.0",id:2,method:"tools/list",params:{}};a.default.debug(`Sending MCP tools/list request: ${JSON.stringify(e)}`),o.stdin.write(JSON.stringify(e)+"\n"),setTimeout((()=>{a.default.debug("Closing MCP stdin to initiate shutdown"),o.stdin.end()}),1e3)}),500)}),500)}))}catch(t){return a.default.warn(`Error executing MCP test: ${e}`,t),`Error executing MCP test:\nCommand: ${e}\nError: ${t.message}`}}}t.MCPTest=l},5025:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentRuleRepository=void 0;const a=r(3563),c=(r(1832),s(r(9055)));let l=class{constructor(e){this.knex=e}async findByAgentName(e){return this.knex("rules").where("agentName",e).first()}async upsert(e){const t=(new Date).toISOString();try{await this.knex("rules").insert({agentName:e.agentName,content:e.content,createdAt:t,updatedAt:t}).onConflict("agentName").merge({content:e.content,updatedAt:t})}catch(t){throw c.default.error("Failed to upsert rule:",{error:t.message,stack:t.stack,rule:e}),t}}};t.AgentRuleRepository=l,t.AgentRuleRepository=l=n([(0,a.Injectable)(),i(0,(0,a.Inject)("KNEX")),o("design:paramtypes",[Function])],l)},5056:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StoredFileController=void 0;const s=r(3563),a=r(9556),c=r(7205);let l=class{constructor(e){this.storedFileService=e}async uploadFile(e,t,r){return this.storedFileService.uploadFile(e,t,r)}async getFileContent(e,t){const r=await this.storedFileService.getFile(e);r?(t.setHeader("Content-Type",r.mimeType),t.setHeader("Content-Disposition",`attachment; filename="${r.originalFilename}"`),t.send(r.fileContents)):t.status(404).send("File not found")}async getFile(e){return this.storedFileService.getFileMetadata(e)}async getAllFiles(){return this.storedFileService.getAllFiles()}async deleteFile(e){await this.storedFileService.deleteFile(e)}async getFilesBySessionId(e){return this.storedFileService.getFilesBySessionId(e)}async getFilesByWorkspaceName(e){return this.storedFileService.getFilesByWorkspaceName(e)}};t.StoredFileController=l,n([(0,s.Post)("upload"),(0,s.UseInterceptors)((0,a.FileInterceptor)("file")),i(0,(0,s.UploadedFile)()),i(1,(0,s.Query)("sessionId")),i(2,(0,s.Query)("workspaceName")),o("design:type",Function),o("design:paramtypes",[Object,String,String]),o("design:returntype",Promise)],l.prototype,"uploadFile",null),n([(0,s.Get)(":id/content"),i(0,(0,s.Param)("id")),i(1,(0,s.Res)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],l.prototype,"getFileContent",null),n([(0,s.Get)(":id"),i(0,(0,s.Param)("id")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],l.prototype,"getFile",null),n([(0,s.Get)(),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],l.prototype,"getAllFiles",null),n([(0,s.Delete)(":id"),i(0,(0,s.Param)("id")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],l.prototype,"deleteFile",null),n([(0,s.Get)("session/:sessionId"),i(0,(0,s.Param)("sessionId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],l.prototype,"getFilesBySessionId",null),n([(0,s.Get)("workspace/:workspaceName"),i(0,(0,s.Param)("workspaceName")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],l.prototype,"getFilesByWorkspaceName",null),t.StoredFileController=l=n([(0,s.Controller)("stored-files"),o("design:paramtypes",[c.StoredFileService])],l)},5096:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.HelloWorldController=void 0;const i=r(3563),s=r(5533);let a=class{constructor(e){this.helloWorldService=e}getHello(){return this.helloWorldService.getHello()}};t.HelloWorldController=a,n([(0,i.Get)(),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",String)],a.prototype,"getHello",null),t.HelloWorldController=a=n([(0,i.Controller)("hello-world"),o("design:paramtypes",[s.HelloWorldService])],a)},5124:e=>{"use strict";e.exports=require("winston")},5156:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ReplaceInFileToolFactory=void 0;const i=r(3563),s=r(3409),a=r(4243);let c=class{constructor(e){this.fileValidationService=e}getToolName(){return"replace_in_file"}create(e){return new s.ReplaceInFileTool(e.workingDir,this.fileValidationService)}};t.ReplaceInFileToolFactory=c,t.ReplaceInFileToolFactory=c=n([(0,i.Injectable)(),o("design:paramtypes",[a.FileValidationService])],c)},5177:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AccessMcpResourceToolFactory=void 0;const i=r(3563),s=r(7692),a=r(2115);let c=class{constructor(e){this.mcpHubService=e}getToolName(){return"access_mcp_resource"}create(e){return new s.AccessMcpResourceTool(this.mcpHubService)}};t.AccessMcpResourceToolFactory=c,t.AccessMcpResourceToolFactory=c=n([(0,i.Injectable)(),o("design:paramtypes",[a.McpHubService])],c)},5188:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Grep=void 0;const c=r(5534),l=r(1569),d=s(r(8489)),u=s(r(6928)),f=s(r(9896)),p=a(r(9055));class h extends c.Tool{static async main(e,t,r,n,o){p.default.info(`Starting grep search in workspace: ${e}`),p.default.info(`Parameters - startPath: ${t}, searchTerm: ${r}, filePattern: ${n}, max: ${o}`);const i=new h(e),s=await i._call({startPath:t,searchTerm:r,filePattern:n,max:o});return p.default.info("Grep search completed"),s}constructor(e){super(),this.name="grep",this.description="Use this grep tool to search for specific terms throughout the codebase when needed. Try to constrain the search to a specific files or a particular part of the codebase if possible.",this.schema=l.z.object({startPath:l.z.string().describe("The relative path to start the search from (use '.' for entire workspace)"),searchTerm:l.z.string().describe("The search term or regex pattern to look for"),filePattern:l.z.string().describe("Regex pattern to filter file names (required)"),max:l.z.number().optional().describe("Maximum number of files to return (optional, defaults to 20)")}),this.MAX_RESULTS=20,this.workspaceRootDir=e,d.config.silent=!0,d.config.fatal=!0}async _call(e){try{const{startPath:t,searchTerm:r,filePattern:n,max:o}=e,i=u.resolve(this.workspaceRootDir,t),s=o||this.MAX_RESULTS,a=5,c=new RegExp(n),l=this.getAllFiles(i,c),d=[];let h=!1;for(const e of l){if(d.length>=s){h=!0;break}try{const t=f.readFileSync(e,"utf-8").split("\n"),n=[];for(let e=0;e<t.length&&n.length<a;e++){const o=t[e];let i=!1;try{i=new RegExp(r).test(o)}catch(e){i=o.includes(r)}i&&n.push({lineNum:e+1,line:o.trim()})}n.length>0&&d.push({filePath:u.relative(this.workspaceRootDir,e),matches:n})}catch(t){p.default.info(`Skipping unreadable file ${e}: ${t.message}`);continue}}const g={matchingFiles:d};if(h){const e=`Stopped searching after finding matches in ${s} files. There may be more matching files.`;p.default.info(e),g.warning=e}return p.default.info(`Found matches in ${d.length} files`),JSON.stringify(g,null,2)}catch(e){throw p.default.info(`Error in grep search: ${e.message}`),new Error(`Error performing grep search: ${e.message}`)}}getAllFiles(e,t,r=[]){const n=f.readdirSync(e,{withFileTypes:!0});for(const o of n){const n=u.join(e,o.name);o.isDirectory()?this.getAllFiles(n,t,r):o.isFile()&&t.test(o.name)&&r.push(n)}return r}}t.Grep=h},5190:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GitService=void 0;const s=r(3563),a=r(8474),c=r(5754),l=i(r(9055)),d=i(r(3807));let u=class{constructor(e){this.workspaceService=e}async getGit(e){const t=await this.workspaceService.findOne(e);if(!t)throw new Error(`Workspace ${e} not found`);return(0,d.default)(t.repoBaseDir)}async undoLastCommit(e){const t=await this.getGit(e);try{await t.reset(["--hard","HEAD~1"])}catch(e){throw new Error(`Failed to undo last commit: ${e.message}`)}}async getGitLog(e){const t=await this.getGit(e);try{return(await t.log(["-n","15"])).all.map((e=>new c.GitLogEntry(e.hash,e.date,e.message,e.author_name,e.author_email)))}catch(e){return e instanceof Error&&e.message.includes("not a git repository")||l.default.warn(`Failed to fetch git log: ${e.message}`),[]}}async getGitDiff(e,t){const r=await this.getGit(e);try{return await r.show(["--unified",t])}catch(e){throw new Error(`Failed to get git diff: ${e.message}`)}}};t.GitService=u,t.GitService=u=n([(0,s.Injectable)(),o("design:paramtypes",[a.WorkspaceService])],u)},5266:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.FileFiltersFactory=void 0;const o=r(3563);let i=class{static depthFilter(e){const t=(t,r)=>r.currentDepth>e?"prune-children":"include";return Object.defineProperty(t,"name",{value:"depthFilter",writable:!0}),t}static defaultRootIgnoreFilter(){const e=new Set(["node_modules","dist","build","target","out","bin","vendor",".git",".eve",".next",".nuxt",".output","coverage",".nyc_output",".cache",".parcel-cache",".yarn",".pnpm-store","__pycache__","env","venv","tmp","temp","deps","pkg","Pods"]),t=t=>{const r=t.path.split("/")[0];if(e.has(r))return"exclude";const n=t.path.split("/");for(const t of n)if(e.has(t))return"exclude";return"include"};return Object.defineProperty(t,"name",{value:"defaultRootIgnoreFilter",writable:!0}),t}static limitFilter(e){const t=(t,r)=>{if(e.maxItems&&r.stats.nodesIncluded>=e.maxItems)return"exclude";if(e.maxBytes&&r.stats.bytesIncluded+(t.sizeBytes||0)>e.maxBytes)return"exclude";if(e.maxTokens){const n=t.path.length/4;if(r.stats.estimatedTokens+n>e.maxTokens)return"exclude"}return"include"};return Object.defineProperty(t,"name",{value:"limitFilter",writable:!0}),t}};t.FileFiltersFactory=i,t.FileFiltersFactory=i=n([(0,o.Injectable)()],i)},5277:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GraphAgentService=void 0;const a=r(3563),c=r(3470),l=r(1412),d=r(7249),u=r(1162),f=r(6158),p=s(r(9055)),h=r(2300);let g=class{constructor(e,t,r){this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}async getTools(e){return await this.toolFactoryService.createTools(await this.getToolNames(e),e)}async getToolNames(e){return[]}async getAgentRules(){const e=await this.ruleService.getRulesByAgentName(this.getName());return e?.content||null}async getSystemPrompt(e){const t=await this.getAgentRules(),r="Not implemented";return t?`${r}\n\nRules:\n${t}`:r}getName(){return"graph-agent"}getModelCategory(){return u.ModelCategory.CODING}isPrivateModelsOnly(){return!1}async verifyRequest(e,t){}async*processRequestStream(e){if(!e.workspaceName)throw new Error("Workspace name is required in the agent request");yield*this.agentCollaborator.processRequestStream(this,e)}async processRequest(e){return this.agentCollaborator.processRequest(this,e)}async simpleRequest(e,t,r=null){const n=new l.AgentRequest(null,e,r,null,t);return(await this.processRequest(n)).responseContent}createGraph(e,t,r){return d.StandardAgentStateManager.createWorkflow((async function(t){const r=t.messages;p.default.debug("Calling model with messages: %s",JSON.stringify(r));const n=await e.invoke(r);return p.default.debug("Received model response: %s",JSON.stringify(n)),{messages:[n]}}),t).compile({checkpointer:r})}createInitialState(){return{messages:[]}}};t.GraphAgentService=g,t.GraphAgentService=g=n([(0,a.Injectable)(),i(0,(0,a.Inject)((0,a.forwardRef)((()=>h.GraphAgentCollaborator)))),o("design:paramtypes",[h.GraphAgentCollaborator,f.ToolFactoryService,c.AgentRuleService])],g)},5299:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPlanVsActPrompt=function(e){return"ACT MODE V.S. PLAN MODE\n\nIn each user message, the environment_details will specify the current mode. There are two modes:\n\n- ACT MODE: In this mode, you have access to all tools EXCEPT the plan_mode_respond tool.\n - In ACT MODE, you use tools to accomplish the user's task. Once you've completed the user's task, you use the attempt_completion tool to present the result of the task to the user.\n- PLAN MODE: In this special mode, you have access to the plan_mode_respond tool.\n - In PLAN MODE, the goal is to gather information and get context to create a detailed plan for accomplishing the task, which the user will review and approve before they switch you to ACT MODE to implement the solution.\n - In PLAN MODE, when you need to converse with the user or present a plan, you should use the plan_mode_respond tool to deliver your response directly, rather than using <thinking> tags to analyze when to respond. Do not talk about using plan_mode_respond - just use it directly to share your thoughts and provide helpful answers.\n - In PLAN MODE, YOU SHOULD USE the read_file tool to read ANY file you are interested in. DO NOT ASK FOR PERMISSION.\n\n## What is PLAN MODE?\n\n- While you are usually in ACT MODE, the user may switch to PLAN MODE in order to have a back and forth with you to plan how to best accomplish the task. \n- When starting in PLAN MODE, depending on the user's request, you may need to do some information gathering e.g. using read_file or search_files to get more context about the task. You may also ask the user clarifying questions to get a better understanding of the task. You may return mermaid diagrams to visually display your understanding.\n- When in plan mode, if you think you need to read a file then just go ahead and use the read_file tool to do it without stopping to ask for permission.\n- Once you've gained more context about the user's request, you should architect a detailed plan for how you will accomplish the task. Returning mermaid diagrams may be helpful here as well.\n- While it is perfectly fine to make direct updates to documentation files using the replace_in_file and write_to_file tools while in PLAN MODE you should try not to use tools to edit source files. Instead you should propose the code edits in the plan and then ask to switch to ACT mode to implement the changes.\n- Then you might ask the user if they are pleased with this plan, or if they would like to make any changes. Think of this as a brainstorming session where you can discuss the task and plan the best way to accomplish it.\n- If at any point a mermaid diagram would make your plan clearer to help the user quickly see the structure, you are encouraged to include a Mermaid code block in the response. (Note: if you use colors in your mermaid diagrams, be sure to use high contrast colors so the text is readable.)\n- Finally once it seems like you've reached a good plan, ask the user to switch you back to ACT MODE to implement the solution."}},5306:e=>{"use strict";e.exports=require("serpapi")},5312:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0;t.Request=class{constructor(e,t,r,n,o={}){this.responseContent="",this.startedAt=new Date,this.endedAt=new Date,this.tookMillis=0,this.inputTokens=0,this.cacheWriteTokens=0,this.cacheReadTokens=0,this.outputTokens=0,this.totalTokens=0,this.cost=0,this.filesChanged=0,this.insertions=0,this.deletions=0,this.testFilesChanged=0,this.testInsertions=0,this.testDeletions=0,this.linesChanged=0,this.testLinesChanged=0,this.requestId=e,this.sessionId=t,this.workspaceName=r,this.requestContent=n,Object.assign(this,o)}}},5317:e=>{"use strict";e.exports=require("child_process")},5324:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BlockService=t.InternalBlockEvents=void 0;const a=r(3563),c=r(461),l=r(2776),d=s(r(9055)),u=r(6297),f=r(269);var p;!function(e){e.BLOCK_CREATED="block.created",e.BLOCK_UPDATED="block.updated",e.USAGE_TRACKED="block.usage.tracked"}(p||(t.InternalBlockEvents=p={}));let h=n=class{constructor(e,t,r){this.appDataSource=e,this.eventEmitter=t,this.dbDebugContextService=r}async createBlock(e){if(!e.blockId)throw new Error("BlockId must be provided by the provider");try{return await this.dbDebugContextService.runWithContext({operationName:"BlockService.createBlock",taskId:e.taskId},(async()=>{const t=new Date,r={blockId:e.blockId,taskId:e.taskId,role:e.role,blockType:e.blockType,tagName:e.tagName,description:e.description,status:e.status,content:e.content,errorText:e.errorText,output:e.output,metadata:e.metadata,createdAt:t,updatedAt:t};return await this.appDataSource.knex("eve_task_blocks").insert({...r,createdAt:this.appDataSource.knex.fn.now(),updatedAt:this.appDataSource.knex.fn.now()}),d.default.debug(`[${n.name}] Created block ${e.blockId} for task ${e.taskId}`),u.debugLogger.dumpObject("Created block",r),this.eventEmitter.emit(p.BLOCK_CREATED,r),r}))}catch(e){throw d.default.error(`[${n.name}] Error creating block: ${e.message}\n${e.stack}`),new Error(`Failed to create block: ${e.message}`)}}async updateBlock(e,t){try{const r=await this.getBlock(e);return await this.dbDebugContextService.runWithContext({operationName:"BlockService.updateBlock",taskId:r.taskId},(async()=>{const r={updatedAt:this.appDataSource.knex.fn.now()};void 0!==t.blockType&&(r.blockType=t.blockType),void 0!==t.tagName&&(r.tagName=t.tagName),void 0!==t.description&&(r.description=t.description),void 0!==t.status&&(r.status=t.status),void 0!==t.content&&(r.content=t.content),void 0!==t.errorText&&(r.errorText=t.errorText),void 0!==t.output&&(r.output=t.output),void 0!==t.metadata&&(r.metadata=t.metadata),await this.appDataSource.knex("eve_task_blocks").where({blockId:e}).update(r);const o=await this.getBlock(e);d.default.debug(`[${n.name}] Updated block ${e}`),u.debugLogger.dumpObject("Updated block",o);const i={blockId:o.blockId,taskId:o.taskId,...t};return this.eventEmitter.emit(p.BLOCK_UPDATED,i),o}))}catch(t){throw d.default.error(`[${n.name}] Error updating block ${e}: ${t.message}\n${t.stack}`),new Error(`Failed to update block ${e}: ${t.message}`)}}async appendToBlockContent(e,t){try{const r=await this.getBlock(e);return await this.dbDebugContextService.runWithContext({operationName:"BlockService.appendToBlockContent",taskId:r.taskId},(async()=>{const o=r.content+t;await this.appDataSource.knex("eve_task_blocks").where({blockId:e}).update({content:o,updatedAt:this.appDataSource.knex.fn.now()});const i=await this.getBlock(e);d.default.debug(`[${n.name}] Appended content to block ${e}`);const s={blockId:i.blockId,taskId:i.taskId,appendContent:t};return this.eventEmitter.emit(p.BLOCK_UPDATED,s),i}))}catch(t){throw d.default.error(`[${n.name}] Error appending content to block ${e}: ${t.message}\n${t.stack}`),new Error(`Failed to append content to block ${e}: ${t.message}`)}}async getBlock(e){try{const t=await this.appDataSource.knex("eve_task_blocks").where({blockId:e}).first();if(!t)throw new Error(`Block ${e} not found`);return t}catch(t){throw d.default.error(`[${n.name}] Error getting block ${e}: ${t.message}\n${t.stack}`),new Error(`Failed to get block ${e}: ${t.message}`)}}async getBlocksForTask(e){try{return await this.dbDebugContextService.runWithContext({operationName:"BlockService.getBlocksForTask",taskId:e},(async()=>{const t=await this.appDataSource.knex("eve_task_blocks").where({taskId:e}).orderBy("blockId","asc");return d.default.debug(`[${n.name}] Retrieved ${t.length} blocks for task ${e}`),t}))}catch(t){throw d.default.error(`[${n.name}] Error getting blocks for task ${e}: ${t.message}\n${t.stack}`),new Error(`Failed to get blocks for task ${e}: ${t.message}`)}}async getLastBlockForTask(e){try{return await this.dbDebugContextService.runWithContext({operationName:"BlockService.getLastBlockForTask",taskId:e},(async()=>{const t=await this.appDataSource.knex("eve_task_blocks").where({taskId:e}).orderBy("blockId","desc").first();return t?(d.default.debug(`[${n.name}] Retrieved last block ${t.blockId} for task ${e}`),t):(d.default.debug(`[${n.name}] No blocks found for task ${e}`),null)}))}catch(t){throw d.default.error(`[${n.name}] Error getting last block for task ${e}: ${t.message}\n${t.stack}`),new Error(`Failed to get last block for task ${e}: ${t.message}`)}}async trackUsage(e){try{return await this.dbDebugContextService.runWithContext({operationName:"BlockService.trackUsage",taskId:e.taskId},(async()=>{const[t]=await this.appDataSource.knex("eve_task_usage").insert({taskId:e.taskId,inputTokens:e.inputTokens,outputTokens:e.outputTokens,cacheWriteTokens:e.cacheWriteTokens,cacheReadTokens:e.cacheReadTokens,totalCost:e.totalCost,createdAt:this.appDataSource.knex.fn.now()}).returning("id");return await this.appDataSource.knex("eve_tasks").where({taskId:e.taskId}).increment({totalInputTokens:e.inputTokens,totalOutputTokens:e.outputTokens}),d.default.info(`[${n.name}] Tracked usage for task ${e.taskId}: ${e.inputTokens} input tokens, ${e.outputTokens} output tokens`),this.eventEmitter.emit(p.USAGE_TRACKED,{taskId:e.taskId,usageId:t,inputTokens:e.inputTokens,outputTokens:e.outputTokens,cacheWriteTokens:e.cacheWriteTokens,cacheReadTokens:e.cacheReadTokens,totalCost:e.totalCost}),t}))}catch(t){throw d.default.error(`[${n.name}] Error tracking usage for task ${e.taskId}: ${t.message}\n${t.stack}`),new Error(`Failed to track usage for task ${e.taskId}: ${t.message}`)}}async getUsageForTask(e){try{return await this.dbDebugContextService.runWithContext({operationName:"BlockService.getUsageForTask",taskId:e},(async()=>{const t=await this.appDataSource.knex("eve_task_usage").where({taskId:e}).orderBy("createdAt","asc");return d.default.debug(`[${n.name}] Retrieved ${t.length} usage records for task ${e}`),t}))}catch(t){throw d.default.error(`[${n.name}] Error getting usage for task ${e}: ${t.message}\n${t.stack}`),new Error(`Failed to get usage for task ${e}: ${t.message}`)}}async getTotalUsageForTask(e){try{return await this.dbDebugContextService.runWithContext({operationName:"BlockService.getTotalUsageForTask",taskId:e},(async()=>{const t=await this.appDataSource.knex("eve_task_usage").where({taskId:e}).sum({inputTokens:"inputTokens",outputTokens:"outputTokens"}).first();return{inputTokens:Number(t?.inputTokens||0),outputTokens:Number(t?.outputTokens||0)}}))}catch(t){throw d.default.error(`[${n.name}] Error getting total usage for task ${e}: ${t.message}\n${t.stack}`),new Error(`Failed to get total usage for task ${e}: ${t.message}`)}}};t.BlockService=h,t.BlockService=h=n=o([(0,a.Injectable)(),i("design:paramtypes",[l.AppDataSource,c.EventEmitter2,f.DbDebugContextService])],h)},5369:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApiHandlerFactory=void 0;const a=r(3563),c=r(4624),l=r(8620),d=s(r(9055));let u=n=class{constructor(e,t){this.providerAdapterRegistry=e,this.llmMetadataService=t,d.default.info(`[${n.name}] ApiHandlerFactory initialized`)}async buildApiHandler(e){const t=e?.providerName||"anthropic";d.default.info(`[${n.name}] Building API handler for provider: ${t}`);try{const r=this.providerAdapterRegistry.getAdapter(t),o=(await this.llmMetadataService.getModelsForProvider(t)).find((t=>t.modelId===e.model));o||d.default.warn(`[${n.name}] Model not found: ${e.model}, using default configuration`);const i=o?.supportsThinkingTokens?e.thinkingTokens:void 0,s={modelId:e.model,apiKey:e.apiKey||"",baseUrl:e.baseUrl,thinkingTokens:i},a=r.getModelClient(s);return{generateResponse:(e,t,r,n)=>a.generateResponse(e,t,r,n),getModel:()=>{const e=a.getModelMetadata();return{id:e.modelId,info:e}}}}catch(e){throw d.default.error(`[${n.name}] Error building API handler: ${e.message}`),e}}};t.ApiHandlerFactory=u,t.ApiHandlerFactory=u=n=o([(0,a.Injectable)(),i("design:paramtypes",[c.ProviderAdapterRegistry,l.LlmMetadataService])],u)},5390:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.goQuery=t.csharpQuery=t.cQuery=t.cppQuery=t.rubyQuery=t.rustQuery=t.javaQuery=t.javascriptQuery=t.pythonQuery=t.typescriptQuery=void 0;var o=r(1391);Object.defineProperty(t,"typescriptQuery",{enumerable:!0,get:function(){return n(o).default}});var i=r(7202);Object.defineProperty(t,"pythonQuery",{enumerable:!0,get:function(){return n(i).default}});var s=r(9791);Object.defineProperty(t,"javascriptQuery",{enumerable:!0,get:function(){return n(s).default}});var a=r(460);Object.defineProperty(t,"javaQuery",{enumerable:!0,get:function(){return n(a).default}});var c=r(242);Object.defineProperty(t,"rustQuery",{enumerable:!0,get:function(){return n(c).default}});var l=r(156);Object.defineProperty(t,"rubyQuery",{enumerable:!0,get:function(){return n(l).default}});var d=r(4219);Object.defineProperty(t,"cppQuery",{enumerable:!0,get:function(){return n(d).default}});var u=r(1547);Object.defineProperty(t,"cQuery",{enumerable:!0,get:function(){return n(u).default}});var f=r(1114);Object.defineProperty(t,"csharpQuery",{enumerable:!0,get:function(){return n(f).default}});var p=r(6654);Object.defineProperty(t,"goQuery",{enumerable:!0,get:function(){return n(p).default}})},5444:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.TaskStatus=void 0,function(e){e.IN_PROGRESS="in_progress",e.WAITING_FOR_INPUT="waiting_for_input",e.EXECUTING_TOOL="executing_tool",e.USER_CANCELLED="user_cancelled"}(r||(t.TaskStatus=r={}))},5480:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionController=void 0;const s=r(3563),a=r(7373),c=r(573);let l=class{constructor(e){this.sessionService=e}async createSession(e,t,r="",n="se-agent"){return this.sessionService.ensureSession(e,t,r,n)}async getSessions(e=1,t=10,r="createdAt",n="DESC"){return this.sessionService.getSessions(e,t,r,n)}async getSession(e){return this.sessionService.getSession(e)}async deleteSession(e){return this.sessionService.deleteSession(e)}async getItemsForSession(e,t=1,r=100,n="ASC"){const[o,i]=await this.sessionService.getItemsForSession(e,t,r,n);return{items:o,total:i}}streamSessionItems(e){return this.sessionService.streamSessionItems(e)}async abortSession(e){return this.sessionService.abortSession(e)}};t.SessionController=l,n([(0,s.Post)(),i(0,(0,s.Body)("workspaceName")),i(1,(0,s.Body)("sessionId")),i(2,(0,s.Body)("requestContent")),i(3,(0,s.Body)("agent")),o("design:type",Function),o("design:paramtypes",[String,String,String,String]),o("design:returntype",Promise)],l.prototype,"createSession",null),n([(0,s.Get)(),i(0,(0,s.Query)("page")),i(1,(0,s.Query)("limit")),i(2,(0,s.Query)("sortBy")),i(3,(0,s.Query)("sortOrder")),o("design:type",Function),o("design:paramtypes",[Number,Number,String,String]),o("design:returntype",Promise)],l.prototype,"getSessions",null),n([(0,s.Get)(":sessionId"),i(0,(0,s.Param)("sessionId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],l.prototype,"getSession",null),n([(0,s.Delete)(":sessionId"),i(0,(0,s.Param)("sessionId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],l.prototype,"deleteSession",null),n([(0,s.Get)(":sessionId/items"),i(0,(0,s.Param)("sessionId")),i(1,(0,s.Query)("page")),i(2,(0,s.Query)("limit")),i(3,(0,s.Query)("sortOrder")),o("design:type",Function),o("design:paramtypes",[String,Number,Number,String]),o("design:returntype",Promise)],l.prototype,"getItemsForSession",null),n([(0,s.Sse)(":sessionId/stream"),i(0,(0,s.Param)("sessionId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",c.Observable)],l.prototype,"streamSessionItems",null),n([(0,s.Post)(":sessionId/abort"),i(0,(0,s.Param)("sessionId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],l.prototype,"abortSession",null),t.SessionController=l=n([(0,s.Controller)("sessions"),o("design:paramtypes",[a.SessionService])],l)},5499:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolResultTransformerService=void 0;const a=r(3563),c=s(r(9055));let l=n=class{constructor(){this.transformers=new Map,this.registerTransformer("read_file",this.transformReadFile),this.registerTransformer("search_files",this.transformSearchFiles),this.registerTransformer("list_code_definition_names",this.transformListCodeDefinitionNames),this.registerTransformer("list_files",this.transformListFiles)}registerTransformer(e,t){this.transformers.set(e,t)}transformForClient(e,t){const r=this.transformers.get(e);if(r)try{return c.default.debug(`[${n.name}] Transforming result for tool: ${e}`),r(t)}catch(r){return c.default.warn(`[${n.name}] Error transforming result for tool ${e}: ${r.message}`),t}return t}hasTransformerFor(e){return this.transformers.has(e)}transformReadFile(e){if("string"==typeof e){const t=e,r=t.split("\n").length,n=t.length,o=this.extractFileName("Unknown");return{result:t,display:{summary:`File: ${o} (${r} lines, ${n.toLocaleString()} chars)`,status:"success",isCollapsible:!0,autoCollapse:!0,metadata:{fileName:o,lineCount:r,contentLength:n}}}}if(e&&"object"==typeof e){const t={...e},r=t.content?.length||0,n=t.content?.split("\n").length||0,o=this.extractFileName(t.path||"Unknown");return{...t,display:{summary:`File: ${o} (${n} lines, ${r.toLocaleString()} chars)`,status:"success",isCollapsible:!0,autoCollapse:!0,metadata:{fileName:o,lineCount:n,contentLength:r}}}}return e}transformSearchFiles(e){if(Array.isArray(e)){const t=e.length;return{result:e,display:{summary:`Found ${t} matches across ${this.countUniqueFiles(e)} files`,status:"success",isCollapsible:!0,autoCollapse:!0,metadata:{matchCount:t,fileCount:this.countUniqueFiles(e)}}}}return e}transformListCodeDefinitionNames(e){return Array.isArray(e)?{result:e,display:{summary:`Found ${e.length} code definitions`,status:"success",isCollapsible:!0,autoCollapse:!0,metadata:{definitionCount:e.length}}}:e}transformListFiles(e){return Array.isArray(e)?{result:e,display:{summary:`Listed ${e.length} files/directories`,status:"success",isCollapsible:!0,autoCollapse:!0,metadata:{fileCount:e.length}}}:e}transformAttemptCompletion(e){return e?{result:e,display:{summary:"Task completion",status:"success",isCollapsible:!1,autoCollapse:!1,metadata:{}}}:e}extractFileName(e){if(!e)return"Unknown";const t=e.split("/");return t[t.length-1]||e}countUniqueFiles(e){const t=new Set;return e.forEach((e=>{e&&e.path&&t.add(e.path)})),t.size}};t.ToolResultTransformerService=l,t.ToolResultTransformerService=l=n=o([(0,a.Injectable)(),i("design:paramtypes",[])],l)},5515:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReadWorkspaceTree=void 0;const n=r(5534),o=r(1569),i=r(6426);class s extends n.Tool{constructor(e){super(),this.name="read_workspace_tree",this.description="Read the workspace file tree, respecting .gitignore and .aiderignore files",this.schema=o.z.object({}),this.workspaceRootDir=e}async _call(){return(0,i.generateTree)(this.workspaceRootDir)}}t.ReadWorkspaceTree=s},5533:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.HelloWorldService=void 0;const o=r(3563);let i=class{getHello(){return"Hello World!"}};t.HelloWorldService=i,t.HelloWorldService=i=n([(0,o.Injectable)()],i)},5534:e=>{"use strict";e.exports=require("@langchain/core/tools")},5562:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.convertEveMessageToGemini=function(e){return{role:"assistant"===e.role?"model":"user",parts:(t=e.segments,t.flatMap((e=>{if("text"===e.type)return{text:e.content};if("thinking"===e.type)return{text:`[Thinking: ${e.content}]`};if("image"===e.type){o.default.info("[GeminiModelClient] Converting image segment to Gemini format");const t=e.metadata?.url||e.content;if(t?.startsWith("data:")){const e=t.split(",");if(2===e.length){const t=e[0].match(/:(.*?);/);if(t&&t[1])return{inlineData:{data:e[1],mimeType:t[1]}}}}return{text:`[Image: ${t||"URL missing"}]`}}return o.default.warn(`[GeminiModelClient] Unsupported segment type: ${e.type}. Converting to text.`),{text:`[Unsupported segment type: ${e.type}] ${e.content}`}})))};var t},t.getMaskedApiKey=function(e){if(!e)return"undefined";if(e.length<=8)return"********";const t=e.substring(0,4),r=e.substring(e.length-4),n=Math.max(0,e.length-8),o="*".repeat(n);return`${t}${o}${r}`};const o=n(r(9055))},5591:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MCPAgentService=void 0;const u=r(3563),f=r(6158),p=r(3470),h=d(r(9055)),g=r(2300),m=r(5277),y=r(9234),v=r(2368),_=r(6910),w=a(r(6928)),b=a(r(9896));let k=class extends m.GraphAgentService{constructor(e,t,r,n){super(e,t,r),this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r,this.configService=n}async verifyRequest(e,t){this.mcpDirectory||(this.mcpDirectory=this.initMcpDir()),t.setToolBaseDir(this.mcpDirectory)}initMcpDir(){let e=this.configService.getProperty(_.ConfigPropNames.MCP_SERVERS_DIRECTORY,"~/.hldk/mcp-servers");return e.startsWith("~")&&(e=w.join(process.env.HOME||"",e.substring(1))),this.ensureMcpDirectoryExists(e),e}ensureMcpDirectoryExists(e){try{if(!b.existsSync(e)){b.mkdirSync(e,{recursive:!0}),h.default.info(`Created MCP directory at ${e}`);const t=w.join(e,"mcp-servers.json");b.existsSync(t)||(b.writeFileSync(t,JSON.stringify({mcpServers:{}},null,2)),h.default.info(`Created empty mcp-servers.json file at ${t}`))}}catch(e){h.default.error("Failed to create MCP directory:",e)}}getName(){return"mcp-agent"}async getTools(e){return await this.toolFactoryService.createTools(["list_files","read_file","update_file","delete_file","command_line","mcp_test","fetch_web_page","git_commit","current_timestamp","grep","find_files","serp_api","read_workspace_tree"],e)}async getSystemPrompt(e){this.mcpDirectory||(this.mcpDirectory=this.initMcpDir());const t=(await this.ruleService.getRulesByAgentName(this.getName())).content||"",r=`You are an Expert Software Engineer MCP Server Manager. Your primary purpose is to help users manage their set of Model Context Protocol (MCP) servers in the MCP directory with the precision and attention to detail of a senior software engineer.\n\nIMPORTANT: Always start by reading the mcp-servers.json file to see which servers are currently enabled. All file operations are relative to the MCP directory, so you can simply use "mcp-servers.json" as the file path.\n\nHere is the MCP directory structure:\n${new y.RequestContext({...e.workspace,repoBaseDir:this.mcpDirectory},e.requestId,e.sessionId).repositoryTree()}\n\nThe mcp-servers.json file format:\n{\n  "mcpServers": {\n    "server-name-1": {\n      "command": "/usr/local/bin/npx",\n      "args": ["-y", "package-name"],\n      "env": { "API_KEY": "your-api-key" },\n      "cwd": "/optional/working/directory",\n      "disabled": false\n    },\n    "server-name-2": {\n      "command": "/usr/bin/python",\n      "args": ["-m", "server_module"],\n      "disabled": true\n    }\n  }\n}\n\nIMPORTANT: Always use the full path to executables in the "command" field (e.g., "/usr/local/bin/node" instead of "node", "/usr/bin/python" instead of "python"). Do not assume the executable will be available on the PATH when the server starts. If you're not sure about the location of an executable, use the command_line tool to look it up:\n- On Unix/Mac: command_line({ command: "which node" }) or command_line({ command: "which python" })\n- On Windows: command_line({ command: "where node" }) or command_line({ command: "where python" })\nAlways verify the executable exists at the path before using it in the configuration.\n\nTo disable a server, set the "disabled" property to true in the server's configuration in mcp-servers.json.\nTo enable a server, set "disabled" to false or remove the "disabled" property.\n\nWhat you can do:\n1. List and examine current MCP servers in the mcp-servers.json file\n2. Enable or disable existing MCP servers\n3. Search for MCP servers using SerpApi when users request to install a specific server\n4. Present options for MCP servers based on search results\n5. Help install MCP servers by following these steps:\n   - Clone the git repository to the MCP directory, preserving the original repository name\n   - Configure any necessary environment variables directly in the "env" property in mcp-servers.json\n   - Install dependencies (using pnpm install, pip install, etc.)\n   - Update the mcp-servers.json configuration file\n   - Use the mcp_test tool to verify the server installation and configuration\n   - Inform the user they can ask to "list available tools" to check if the server is working properly\n\n6. Help build new MCP servers when needed or requested\n\nFollow these guidelines when helping users:\n1. When a user asks to install an MCP server:\n   a. First, always use serp_api to search for "MCP server for [what they asked]" or "Model Context Protocol server for [what they asked]"\n   b. Analyze the search results to find GitHub repositories that implement MCP servers\n   c. Present the options to the user with brief descriptions\n   d. Confirm which option they want to install\n   e. If no appropriate server exists, offer to build a new server for them\n\n2. When installing the selected server:\n   a. Clone the repository using git (via command_line), keeping the original repository name unless specifically requested otherwise\n   b. ALWAYS CHECK if required command line tools are installed before proceeding:\n      - Before running any command that requires a specific tool (like git, node, python, etc.), verify if it's available\n      - If a required tool is missing, STOP and explicitly ask the user for permission to install it\n      - Only proceed with installation after receiving explicit user permission\n   c. For repositories containing multiple servers:\n      - Carefully examine the repository structure to identify the specific server the user wants\n      - Focus on one server at a time and only follow the README for that specific server\n      - When using the command_line tool, ALWAYS use the appropriate subDir parameter to ensure you're operating in the correct directory\n      - Example: command_line({ command: "pnpm install", subDir: "path/to/specific/server" })\n   d. Check for installation instructions in README.md or similar files for the SPECIFIC server being installed\n   e. Guide the user through any API key or credential setup\n   f. Follow the installation steps (ALWAYS using pnpm instead of npm)\n   g. When configuring the server in mcp-servers.json, always use the full path to executables in the "command" field (e.g., "/usr/local/bin/node" instead of "node"). You can use the command_line tool with "which [command]" to find the full path on Unix/Mac systems or "where [command]" on Windows systems. Always verify the executable exists before adding it to the configuration. For example:\n      - command_line({ command: "which node" }) // On Unix/Mac\n      - command_line({ command: "where node" }) // On Windows\n   \n   IMPORTANT: Do not forget to run the install command to install the relevant packages (e.g., pnpm install, pip install -r requirements.txt). Failing to install dependencies is a common cause of server startup failures.\n   \n   h. Properly set the "cwd" field in mcp-servers.json to the specific subdirectory where the server is located\n   i. Add any required environment variables to the "env" property in the server's configuration in mcp-servers.json\n   j. Update the mcp-servers.json file with the complete server configuration\n   k. Test the server installation using the mcp_test tool:\n      - Extract the command, args, env, and cwd from the mcp-servers.json configuration\n      - Construct a proper command string from command and args\n      - Use mcp_test({ command: "full command string", envVars: serverConfig.env, workingDir: serverConfig.cwd })\n      - Analyze the output to verify the server returns proper MCP protocol responses\n      - IMPORTANT: DO NOT TRY TO RUN THE COMMAND YOURSELF USING THE COMMAND LINE TOOL OTHERWISE YOU WILL HANG!! Use the test tool. \n   l. Inform the user they can ask to "list available tools" to verify if the server is properly configured\n\n3. To maintain security:\n   a. Always store sensitive information like API keys in the "env" property of the server configuration in mcp-servers.json\n   b. Ensure users understand that the mcp-servers.json file contains sensitive information and should not be shared\n   c. Never commit sensitive information to git\n   d. Explain that the "env" property in mcp-servers.json is used to provide environment variables to the server process\n\n4. Directory management best practices:\n   a. ALWAYS use the subDir parameter with the command_line tool to specify the correct working directory\n   b. When a repository contains multiple servers, carefully identify the correct subdirectory for each server\n   c. Update the "cwd" field in mcp-servers.json to point to the specific subdirectory for each server\n   d. When reading documentation or files, make sure you're looking at the files for the specific server being installed\n   e. Keep track of the current directory context when helping the user\n\n5. When building a new MCP server (if no existing server meets the requirements or if specifically requested):\n   a. First, fetch the MCP server development guide from: https://raw.githubusercontent.com/cyanheads/model-context-protocol-resources/refs/heads/main/guides/mcp-server-development-guide.md\n   b. Read the guide for best practices and implementation details\n   c. Create a new directory in the MCP directory with a descriptive name\n   d. Set up a new Node.js project using TypeScript (recommended for MCP servers)\n   e. Install the MCP SDK: pnpm add @modelcontextprotocol/sdk\n   f. Create the basic server structure according to the guide\n   g. Implement the required tools following the MCP specifications\n   h. Set up proper TypeScript configuration and build scripts\n   i. Create a README.md with clear documentation\n   j. Test the server thoroughly\n   k. Update the mcp-servers.json configuration file to include the new server with appropriate "env" configuration\n\n6. For MCP server implementation details, follow the best practices from the development guide and:\n   a. Use the MCP SDK's registerTool method to register tools\n   b. Properly define input schemas for tools using JSON Schema\n   c. Implement clear error handling with appropriate error messages\n   d. Use async/await for asynchronous operations\n   e. Provide detailed descriptions for all tools\n   f. Follow security best practices for handling credentials\n   g. Access environment variables using process.env which will be populated from the "env" property in mcp-servers.json\n   h. Implement proper logging\n\nThe MCP directory is located at: ${this.mcpDirectory}\n\nIMPORTANT: Since all file operations are already set to work relative to the MCP directory, you don't need to specify the full path when reading, writing, or updating files. For example, use "mcp-servers.json" instead of the full path.\n\nUsing the mcp_test tool:\nThe mcp_test tool allows you to test an MCP server by running through the full Model Context Protocol lifecycle. This is an excellent way to verify that a server is properly installed and configured before letting the user know it's ready to use.\n\nHow to use the mcp_test tool:\n1. Extract the server configuration from mcp-servers.json\n2. Construct the full command string by combining the command with its args\n3. Call the tool with the command, environment variables, and working directory:\n   mcp_test({ \n     command: "full command string", \n     envVars: serverConfig.env, \n     workingDir: serverConfig.cwd \n   })\n4. Analyze the response to check for:\n   - Successful initialization\n   - Server capabilities in the response\n   - No errors or timeout messages\n\nExample:\n\nFor a server configured as:\n{\n  "command": "/usr/local/bin/node",\n  "args": ["server.js"],\n  "env": { "API_KEY": "abc123" },\n  "cwd": "some-server/src"\n}\n\nUse the mcp_test tool with:\nmcp_test({ \n  command: "/usr/local/bin/node server.js", \n  envVars: { "API_KEY": "abc123" }, \n  workingDir: "some-server/src" \n})\n\nThe tool will establish a connection with the server using the MCP protocol, exchange capabilities information, and then gracefully close the connection. This verifies that the server is properly implementing the MCP specification.\n\n${t?`Additional custom rules:\n${t}\n`:""}\n\nGet started by reading the mcp-servers.json file to understand the current MCP server configurations, then help the user with their MCP server management request as an expert software engineer.\n`;return h.default.debug(`MCP Agent system prompt for workspace '${e.workspace.name}' (length: ${r.length} chars)`),r}};t.MCPAgentService=k,t.MCPAgentService=k=s([(0,u.Injectable)(),l(0,(0,u.Inject)((0,u.forwardRef)((()=>g.GraphAgentCollaborator)))),c("design:paramtypes",[g.GraphAgentCollaborator,f.ToolFactoryService,p.AgentRuleService,v.ConfigService])],k)},5610:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReviewAgentService=void 0;const a=r(3563),c=r(6158),l=r(3470),d=s(r(9055)),u=r(2300),f=r(5277);let p=class extends f.GraphAgentService{constructor(e,t,r){super(e,t,r),this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}getName(){return"review-agent"}async getTools(e){return await this.toolFactoryService.createTools(["read_file","update_file","delete_file","command_line","fetch_web_page","read_dependency_source_tree","read_dependency_source_file","git_commit","remote_git"],e)}async getSystemPrompt(e){let t=`As an AI code review assistant, you are tasked with analyzing and reviewing code changes in a pull request or specific commit.\n  Follow these guidelines:\n  1. The user input will be a URL to a pull request or a specific commit hash.\n  2. Use the "remote-git" toolkit (not implemented yet) to:\n     a. Sync the workspace to match the state of the commit/pull request.\n     b. Fetch the contents of the commit or the pull request (including comments).\n  3. Perform a thorough evaluation of the changes being made, considering:\n     a. Code quality and readability\n     b. Adherence to best practices and design patterns\n     c. Performance implications\n     d. Security considerations\n     e. Potential bugs or issues\n     f. Test coverage\n  4. Use the "remote-git" toolkit to add comments to specific parts of the code where:\n     a. Issues should be pointed out\n     b. Improvements can be suggested\n     c. Clarifications are needed\n  5. Provide a summary of the code changes, including:\n     a. An overview of the main changes\n     b. A list of files modified\n     c. Key points from your review\n     d. Any major concerns or praises\n  6. Use the read_file tool to examine the contents of specific files when needed.\n  7. If you need to reference or compare with existing code, use the read_file tool to retrieve the contents of those files.\n  8. Be constructive and respectful in your comments and feedback.\n  9. Prioritize the most important issues and suggestions in your review.\n  10. Consider the overall impact of the changes on the project's architecture and maintainability.\n\n  Here is the file tree of the system:\n  ${e.repositoryTree()}\n  \n  ${e.repositoryHints()?`Additional hints:\n${e.repositoryHints()}`:""}\n  \n  IMPORTANT: Remember that the "remote-git" toolkit is not implemented yet. When it becomes available, use it to fetch and interact with the pull request or commit data.\n  IMPORTANT: Focus on providing a thorough code review rather than making direct changes to the codebase.\n  IMPORTANT: Ensure your comments and suggestions are clear, specific, and actionable.\n  IMPORTANT: If you need to reference any existing files in the project, use the read_file tool to fetch their contents.\n  `;return d.default.debug(`Review Agent system prompt for workspace '${e.workspace.name}' (length: ${t.length} chars): ${t}`),t}};t.ReviewAgentService=p,t.ReviewAgentService=p=n([(0,a.Injectable)(),i(0,(0,a.Inject)((0,a.forwardRef)((()=>u.GraphAgentCollaborator)))),o("design:paramtypes",[u.GraphAgentCollaborator,c.ToolFactoryService,l.AgentRuleService])],p)},5630:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnthropicProvider=t.GeminiProvider=void 0;var n=r(1672);Object.defineProperty(t,"GeminiProvider",{enumerable:!0,get:function(){return n.GeminiProvider}});var o=r(209);Object.defineProperty(t,"AnthropicProvider",{enumerable:!0,get:function(){return o.AnthropicProvider}})},5699:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigPropertyRepository=void 0;const c=r(3563),l=(r(1832),a(r(9055))),d=r(1080);let u=n=class{constructor(e){this.knex=e}async getProperty(e){try{const t=await this.knex("config_properties").select("value").where("name",e).first();return t?.value||null}catch(t){return l.default.error(`[${n.name}] Error getting property ${e}`,t),null}}async setProperty(e,t){try{null===t?await this.knex("config_properties").where("name",e).delete():await this.knex("config_properties").insert({name:e,value:t}).onConflict("name").merge()}catch(t){throw l.default.error(`[${n.name}] Error setting property ${e}`,t),t}}async getAllProperties(){try{return(await this.knex("config_properties").select("*")).map((e=>new d.ConfigProperty(e.name,e.value)))}catch(e){return l.default.error(`[${n.name}] Error getting all properties`,e),[]}}async deleteProperty(e){try{await this.knex("config_properties").where("name",e).delete()}catch(t){throw l.default.error(`[${n.name}] Error deleting property ${e}`,t),t}}};t.ConfigPropertyRepository=u,t.ConfigPropertyRepository=u=n=o([(0,c.Injectable)(),s(0,(0,c.Inject)("KNEX")),i("design:paramtypes",[Function])],u)},5702:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ModelRefreshService=void 0;const s=r(3563),a=r(2776),c=r(6206),l=r(8620),d=r(9102),u=i(r(9055));let f=class{constructor(e,t,r,n){this.appDataSource=e,this.providerRegistry=t,this.llmMetadataService=r,this.eveConfigService=n,this.serviceName="ModelRefreshService"}async onModuleInit(){u.default.info(`[${this.serviceName}] Initializing model refresh service...`),await this.refreshAllProvidersModels(),u.default.info(`[${this.serviceName}] Model refresh service initialized`)}async refreshAllProvidersModels(){const e=this.providerRegistry.getAllProviders();u.default.info(`[${this.serviceName}] Refreshing models for ${e.length} providers`);for(const t of e){const e=t.getId();u.default.info(`[${this.serviceName}] Processing provider: ${e}`);await this.refreshProviderModels(e)?u.default.info(`[${this.serviceName}] Successfully refreshed models for provider: ${e}`):u.default.warn(`[${this.serviceName}] Could not refresh models for provider: ${e} - no API key available`)}}async refreshProviderModels(e){return u.default.info(`[${this.serviceName}] Attempting to refresh models for provider: ${e}`),!!await this.refreshWithGlobalApiKey(e)||await this.refreshWithUserApiKey(e)}async refreshWithGlobalApiKey(e){try{const t=this.providerRegistry.getProvider(e),r=await this.getDefaultApiKeyName(e);if(u.default.info(`[${this.serviceName}] Checking for global API key (${r}) for provider: ${e}`),r&&process.env[r]){const n=process.env[r],o=t.getDefaultBaseUrl();return u.default.info(`[${this.serviceName}] Found global API key for provider: ${e}`),await this.llmMetadataService.refreshModelsForProvider(e,n,o),u.default.info(`[${this.serviceName}] Refreshed models for provider ${e} using global API key`),!0}u.default.info(`[${this.serviceName}] No global API key found for provider: ${e}`)}catch(t){u.default.error(`[${this.serviceName}] Failed to refresh models with global API key for provider ${e}: ${t.message}`,t.stack)}return!1}async refreshWithUserApiKey(e){try{u.default.info(`[${this.serviceName}] Looking for user-configured API keys for provider: ${e}`);const t=await this.findUsersWithApiKeys(e);if(t.length>0){const{userId:r,apiKey:n,baseUrl:o}=t[0];return u.default.info(`[${this.serviceName}] Found API key from user ${r} for provider: ${e}`),await this.llmMetadataService.refreshModelsForProvider(e,n,o),u.default.info(`[${this.serviceName}] Refreshed models for provider ${e} using API key from user ${r}`),!0}u.default.info(`[${this.serviceName}] No user-configured API keys found for provider: ${e}`)}catch(t){u.default.error(`[${this.serviceName}] Failed to refresh models with user API key for provider ${e}: ${t.message}`,t.stack)}return!1}async findUsersWithApiKeys(e){return(await this.appDataSource.knex("user_llm_configurations").where("provider_id",e).whereNotNull("api_key").select("user_id","api_key","base_url")).map((e=>({userId:e.user_id,apiKey:e.api_key,baseUrl:e.base_url})))}async getDefaultApiKeyName(e){const t=await this.appDataSource.knex("agent_modes").where("default_provider_id",e).select("default_api_key_secret_name").first();return t?.default_api_key_secret_name}};t.ModelRefreshService=f,t.ModelRefreshService=f=n([(0,s.Injectable)(),o("design:paramtypes",[a.AppDataSource,c.ProviderRegistry,l.LlmMetadataService,d.EveConfigService])],f)},5754:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GitLogEntry=void 0;t.GitLogEntry=class{constructor(e,t,r,n,o){this.hash=e,this.message=r,this.date=t,this.author_name=n,this.author_email=o}}},5762:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.FileSystemEpicRepository=void 0;const l=r(3563),d=a(r(1943)),u=a(r(6928)),f=r(251),p=r(7655),h=r(9615),g=r(4717);let m=class{constructor(e){this.workspaceRepository=e}async getRequirements(e,t){const r=await this.getEpicPath(e,t),n=u.join(r,"requirements.md");try{return await d.readFile(n,"utf-8")}catch(e){throw new Error(`Requirements not found for epic ${t}`)}}async updateRequirements(e,t,r){const n=await this.getEpicPath(e,t),o=u.join(n,"requirements.md");try{return await d.writeFile(o,r),r}catch(e){throw new Error(`Failed to update requirements for epic ${t}`)}}async getEpicsBasePath(e){const t=await this.workspaceRepository.findByName(e);if(!t)throw new l.NotFoundException(`Workspace not found: ${e}`);return u.join(t.repoBaseDir,"epics")}async getEpicPath(e,t){const r=await this.getEpicsBasePath(e);return u.join(r,t)}async findStoryDirectoryNameById(e,t,r){const n=await this.getEpicPath(e,t),o=u.join(n,"stories");try{const e=await d.readdir(o);if(e.includes(r))return r;for(const t of e)try{const e=u.join(o,t,"story.json");if(JSON.parse(await d.readFile(e,"utf-8")).id===r)return t}catch(e){console.error(`Error reading story ${t}:`,e)}throw new l.NotFoundException(`Story with id ${r} not found`)}catch(e){if(e instanceof l.NotFoundException)throw e;throw new l.NotFoundException("Stories directory not found or not accessible")}}async getStoryPath(e,t,r){const n=await this.getEpicPath(e,t),o=await this.findStoryDirectoryNameById(e,t,r);return u.join(n,"stories",o,"story.json")}async getTaskPath(e,t,r,n){const o=await this.getEpicPath(e,t),i=await this.findStoryDirectoryNameById(e,t,r);return u.join(o,"stories",i,"tasks",`${n}.json`)}async ensureDirectoryExists(e){try{await d.mkdir(e,{recursive:!0})}catch(e){if("EEXIST"!==e.code)throw e}}async readTask(e,t,r,n){const o=await this.getTaskPath(e,t,r,n);try{const e=JSON.parse(await d.readFile(o,"utf-8")),t=new h.Task(e.title,e.description,e.status);return t.id=e.id,t.createdAt=new Date(e.createdAt),t.updatedAt=new Date(e.updatedAt),t}catch(e){throw new l.NotFoundException(`Task with id ${n} not found`)}}async writeTask(e,t,r,n){const o=await this.getTaskPath(e,t,r,n.id);await this.ensureDirectoryExists(u.dirname(o)),await d.writeFile(o,JSON.stringify(n,null,2))}async findAllByWorkspace(e){const t=await this.getEpicsBasePath(e);try{await d.access(t)}catch(e){return[]}let r;try{r=await d.readdir(t)}catch(e){return console.error("Error reading epics directory:",e),[]}const n=[];for(const o of r){const r=u.join(t,o),i=u.join(r,"requirements.md");try{const t=await d.readFile(i,"utf-8"),s=t.match(/# (.+?):/),a=t.match(/## Description\s+(.*?)(?=##|$)/s),c=s?s[1].trim():o,l=a?a[1].trim():"",h=u.join(r,"stories"),g=[];try{const e=await d.readdir(h);for(const t of e){const e=u.join(h,t,"story.json"),r=JSON.parse(await d.readFile(e,"utf-8")),n=new p.Story(r.title,r.description,r.acceptanceCriteria,r.status);n.id=r.id,n.createdAt=new Date(r.createdAt),n.updatedAt=new Date(r.updatedAt),g.push(n)}}catch(e){console.log(`No stories directory found for epic ${o}, continuing with empty stories array`)}n.push(new f.Epic(c,l,e,g,o))}catch(e){console.error(`Error reading epic ${o}:`,e)}}return n}async findById(e,t){const r=await this.getEpicPath(e,t);try{await d.access(r)}catch(e){return null}try{const n=u.join(r,"requirements.md"),o=await d.readFile(n,"utf-8"),i=o.match(/# (.+?):/),s=o.match(/## Description\s+(.*?)(?=##|$)/s),a=i?i[1].trim():t,c=s?s[1].trim():"",l=u.join(r,"stories");let h=[];try{const e=await d.readdir(l);for(const t of e)try{const e=u.join(l,t,"story.json"),r=JSON.parse(await d.readFile(e,"utf-8")),n=new p.Story(r.title,r.description,r.acceptanceCriteria,r.status,r.taskIds||[]);n.id=r.id,n.createdAt=new Date(r.createdAt),n.updatedAt=new Date(r.updatedAt),h.push(n)}catch(e){console.error(`Error reading story ${t}:`,e)}}catch(e){console.error("Error reading stories directory:",e)}return new f.Epic(a,c,e,h,t)}catch(e){return console.error(`Error reading epic ${t}:`,e),null}}async create(e){const t=await this.getEpicPath(e.workspaceName,e.id);await this.ensureDirectoryExists(t),await this.ensureDirectoryExists(u.join(t,"stories"));const r=`# ${e.title}:\n\n## Description\n${e.description}\n\n## Goals\n- Add goals here\n`;return await d.writeFile(u.join(t,"requirements.md"),r),e}async update(e){const t=await this.getEpicPath(e.workspaceName,e.id),r=u.join(t,"requirements.md"),n=`# ${e.title}:\n\n## Description\n${e.description}\n\n## Goals\n- Add goals here\n`;return await d.writeFile(r,n),e}async delete(e,t){const r=await this.getEpicPath(e,t);await d.rm(r,{recursive:!0,force:!0})}async addStory(e,t,r){const n=await this.getEpicPath(e,t),o=u.join(n,"stories");await this.ensureDirectoryExists(o);const i=await this.getStoryPath(e,t,r.id);return await this.ensureDirectoryExists(u.dirname(i)),await d.writeFile(i,JSON.stringify(r,null,2)),r}async updateStory(e,t,r){const n=await this.getStoryPath(e,t,r.id);return await d.writeFile(n,JSON.stringify(r,null,2)),r}async deleteStory(e,t,r){const n=await this.getStoryPath(e,t,r),o=u.dirname(n);await d.rm(o,{recursive:!0,force:!0})}async getStory(e,t,r){const n=await this.getStoryPath(e,t,r);try{const e=JSON.parse(await d.readFile(n,"utf-8")),t=new p.Story(e.title,e.description,e.acceptanceCriteria,e.status,e.taskIds||[]);return t.id=e.id,t.createdAt=new Date(e.createdAt),t.updatedAt=new Date(e.updatedAt),t}catch(e){throw new l.NotFoundException(`Story with id ${r} not found`)}}async addTask(e,t,r,n){const o=await this.findById(e,t);if(!o)throw new Error("Epic not found");if(!o.stories.find((e=>e.id===r)))throw new Error("Story not found");return await this.writeTask(e,t,r,n),n}async updateTask(e,t,r,n){const o=await this.findById(e,t);if(!o)throw new Error("Epic not found");if(!o.stories.find((e=>e.id===r)))throw new Error("Story not found");try{await this.readTask(e,t,r,n.id)}catch(e){throw new Error("Task not found")}return await this.writeTask(e,t,r,n),n}async deleteTask(e,t,r,n){const o=await this.findById(e,t);if(!o)throw new Error("Epic not found");if(!o.stories.find((e=>e.id===r)))throw new Error("Story not found");const i=await this.getTaskPath(e,t,r,n);await d.rm(i,{force:!0})}async getTasks(e,t,r){const n=await this.findById(e,t);if(!n)throw new Error("Epic not found");if(!n.stories.find((e=>e.id===r)))throw new Error("Story not found");const o=u.join(await this.getEpicPath(e,t),"stories",r,"tasks");try{const n=await d.readdir(o),i=[];for(const o of n){if(!o.endsWith(".json"))continue;const n=o.replace(".json","");try{const o=await this.readTask(e,t,r,n);i.push(o)}catch(e){console.error(`Error reading task ${n}:`,e)}}return i}catch(e){if("ENOENT"===e.code)return[];throw e}}async getTask(e,t,r,n){return this.readTask(e,t,r,n)}};t.FileSystemEpicRepository=m,t.FileSystemEpicRepository=m=s([(0,l.Injectable)(),c("design:paramtypes",[g.WorkspaceRepository])],m)},5775:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoredFileDto=void 0;class r{constructor(e){this.id=e.id,this.originalFilename=e.originalFilename,this.mimeType=e.mimeType,this.createdAt=e.createdAt,this.sessionId=e.sessionId,this.workspaceName=e.workspaceName}static fromStoredFile(e){return new r({id:e.id,originalFilename:e.originalFilename,mimeType:e.mimeType,createdAt:e.createdAt,sessionId:e.sessionId,workspaceName:e.workspaceName})}}t.StoredFileDto=r},5789:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_GEMINI_MODEL_ID=t.GEMINI_PROVIDER_ID=void 0,t.discoverGeminiModels=async function(e,r){o.default.info("[GeminiProvider] Using hardcoded model list (API key presence ignored)");return[{modelId:"gemini-2.5-pro-preview-05-06",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 2.5 Pro Preview 05-06",contextWindow:1048576,maxOutputTokens:65536,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:1.25,outputCostPerMillionTokens:10,cacheWritesPrice:1,cacheReadsPrice:.31,isDefaultForProvider:!1,metadata:{description:"Preview Gemini 2.5 Pro model 05-06"}},{modelId:"gemini-2.5-pro-preview-03-25",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 2.5 Pro Preview 03-25",contextWindow:1048576,maxOutputTokens:65536,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:1.25,outputCostPerMillionTokens:10,cacheWritesPrice:1,cacheReadsPrice:.31,isDefaultForProvider:!1,metadata:{description:"Preview Gemini 2.5 Pro model 03-25"}},{modelId:"gemini-1.5-pro-002",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 1.5 Pro 002",contextWindow:2097152,maxOutputTokens:8192,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:3.5,outputCostPerMillionTokens:10.5,cacheWritesPrice:1,cacheReadsPrice:.35,isDefaultForProvider:!0,metadata:{description:"Gemini 1.5 Pro model (version 002)."}},{modelId:"gemini-1.5-flash-002",providerId:t.GEMINI_PROVIDER_ID,name:"Gemini 1.5 Flash 002",contextWindow:1048576,maxOutputTokens:8192,supportsImages:!0,supportsToolUse:!0,supportsComputerUse:!1,supportsPromptCache:!0,supportsThinkingTokens:!1,inputCostPerMillionTokens:.35,outputCostPerMillionTokens:1.05,cacheWritesPrice:1,cacheReadsPrice:.0375,metadata:{description:"Gemini 1.5 Flash model (version 002)."}}]};const o=n(r(9055));t.GEMINI_PROVIDER_ID="gemini",t.DEFAULT_GEMINI_MODEL_ID="gemini-2.5-pro-preview-03-25"},5796:e=>{"use strict";e.exports=require("@langchain/community/vectorstores/chroma")},5814:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ExecuteCommandToolFactory=void 0;const i=r(3563),s=r(3131);let a=class{constructor(){}getToolName(){return"execute_command"}create(e){return new s.ExecuteCommandTool(e.workingDir)}};t.ExecuteCommandToolFactory=a,t.ExecuteCommandToolFactory=a=n([(0,i.Injectable)(),o("design:paramtypes",[])],a)},5853:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UseMcpToolTool=void 0;const a=r(3563),c=s(r(9055)),l=r(2115);let d=n=class{constructor(e){this.mcpHubService=e,this.name="use_mcp_tool",this.description="Request to use a tool provided by a connected MCP server."}getUsageInstructions(e){return'## use_mcp_tool\nDescription: Request to use a tool provided by a connected MCP server. Each MCP server can provide multiple tools with different capabilities. Tools have defined input schemas that specify required and optional parameters.\nParameters:\n- server_name: (required) The name of the MCP server providing the tool\n- tool_name: (required) The name of the tool to execute\n- arguments: (required) A JSON object containing the tool\'s input parameters, following the tool\'s input schema\nUsage:\n<use_mcp_tool>\n<server_name>server name here</server_name>\n<tool_name>tool name here</tool_name>\n<arguments>\n{\n  "param1": "value1",\n  "param2": "value2"\n}\n</arguments>\n</use_mcp_tool>'}validateParams(e){return"string"==typeof e.server_name&&""!==e.server_name.trim()&&"string"==typeof e.tool_name&&""!==e.tool_name.trim()&&"object"==typeof e.arguments}async execute(e){const{server_name:t,tool_name:r,arguments:o}=e;c.default.info(`[${n.name}] Using MCP tool ${r} on server ${t}`);try{const e=await this.mcpHubService.callTool(t,r,o);return c.default.info(`[${n.name}] MCP tool ${r} executed successfully`),e}catch(e){throw c.default.error(`[${n.name}] Error using MCP tool ${r}: ${e.message}\n${e.stack}`),new Error(`Error using MCP tool ${r}: ${e.message}`)}}};t.UseMcpToolTool=d,t.UseMcpToolTool=d=n=o([(0,a.Injectable)(),i("design:paramtypes",[l.McpHubService])],d)},5862:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AgentRule=void 0;t.AgentRule=class{constructor(e,t,r,n){this.agentName=e,this.content=t,this.createdAt=r,this.updatedAt=n}}},5873:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceModule=void 0;const o=r(3563),i=r(2397),s=r(8474),a=r(4717),c=r(376);let l=class{};t.WorkspaceModule=l,t.WorkspaceModule=l=n([(0,o.Module)({imports:[c.DataSourceModule],controllers:[i.WorkspaceController],providers:[s.WorkspaceService,a.WorkspaceRepository],exports:[s.WorkspaceService,a.WorkspaceRepository]})],l)},5884:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BlockController=void 0;const a=r(3563),c=r(5324),l=r(9668),d=s(r(9055));let u=class{constructor(e,t){this.blockService=e,this.userService=t,this.serviceName="BlockController"}async getBlocksForTask(e,t){try{await this.userService.getCurrentUser(),d.default.debug(`[${this.serviceName}] Received request for blocks of task ${t}`);return await this.blockService.getBlocksForTask(t)}catch(e){if(e instanceof l.AuthenticationError)throw d.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw d.default.error(`[${this.serviceName}] Error in getBlocksForTask endpoint: ${e.message}`,e.stack),e}}async getUsageForTask(e,t){try{await this.userService.getCurrentUser(),d.default.debug(`[${this.serviceName}] Received request for usage data of task ${t}`);return await this.blockService.getUsageForTask(t)}catch(e){if(e instanceof l.AuthenticationError)throw d.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw d.default.error(`[${this.serviceName}] Error in getUsageForTask endpoint: ${e.message}`,e.stack),e}}async getTotalUsageForTask(e,t){try{await this.userService.getCurrentUser(),d.default.debug(`[${this.serviceName}] Received request for total usage data of task ${t}`);return await this.blockService.getTotalUsageForTask(t)}catch(e){if(e instanceof l.AuthenticationError)throw d.default.error(`[${this.serviceName}] Authentication error: ${e.message}`),new a.UnauthorizedException(`Authentication failed: ${e.message}`);throw d.default.error(`[${this.serviceName}] Error in getTotalUsageForTask endpoint: ${e.message}`,e.stack),e}}};t.BlockController=u,n([(0,a.Get)(":taskId/blocks"),i(0,(0,a.Request)()),i(1,(0,a.Param)("taskId")),o("design:type",Function),o("design:paramtypes",[Object,String]),o("design:returntype",Promise)],u.prototype,"getBlocksForTask",null),n([(0,a.Get)(":taskId/blocks/usage"),i(0,(0,a.Request)()),i(1,(0,a.Param)("taskId")),o("design:type",Function),o("design:paramtypes",[Object,String]),o("design:returntype",Promise)],u.prototype,"getUsageForTask",null),n([(0,a.Get)(":taskId/blocks/usage/total"),i(0,(0,a.Request)()),i(1,(0,a.Param)("taskId")),o("design:type",Function),o("design:paramtypes",[Object,String]),o("design:returntype",Promise)],u.prototype,"getTotalUsageForTask",null),t.BlockController=u=n([(0,a.Controller)("eve-agent/task"),o("design:paramtypes",[c.BlockService,l.UserService])],u)},5908:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SourceArtefactRepository=void 0;const s=r(3563),a=(r(1832),r(8547)),c=r(3563),l=r(9100);let d=class{constructor(e){this.knex=e}async create(e){const t=(0,l.ulid)(),r=e.createdAt?e.createdAt:new Date;return await this.knex("source_artefacts").insert({id:t,...e,createdAt:r}),{id:t,...e}}async findById(e){const t=await this.knex("source_artefacts").where("id",e).first();return t?new a.SourceArtefact(t):null}async update(e,t){return await this.knex("source_artefacts").where("id",e).update(t),this.findById(e)}async delete(e){await this.knex("source_artefacts").where("id",e).delete()}async findBySchemeAndLocator(e,t){const r=await this.knex("source_artefacts").where({scheme:e,locator:t}).first();return r?new a.SourceArtefact(r):null}async query(e,t,r=1,n=10,o="locator",i="ASC"){const s=(r-1)*n;let c=this.knex("source_artefacts");e&&(c=c.where("scheme",e)),t&&(c=c.where("locator","like",`%${t}%`));const[l,d]=await Promise.all([c.clone().orderBy(o,i).limit(n).offset(s),c.clone().count("* as count").first()]);return{items:l.map((e=>new a.SourceArtefact(e))),total:d?.count}}};t.SourceArtefactRepository=d,t.SourceArtefactRepository=d=n([(0,s.Injectable)(),i(0,(0,c.Inject)("KNEX")),o("design:paramtypes",[Function])],d)},5915:e=>{"use strict";e.exports=require("tree-sitter-java")},5996:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AddWorkspace=void 0;const c=r(5534),l=r(1569),d=s(r(9896)),u=s(r(6928)),f=r(5317),p=r(9023),h=a(r(9055)),g=r(1943),m=a(r(3807)),y=(0,p.promisify)(f.exec);class v extends c.Tool{constructor(e,t){super(),this.name="AddWorkspace",this.description="Add a new workspace to the system",this.schema=l.z.object({baseDir:l.z.string().describe("The absolute path to the directory of the workspace (can be a git repo or not)"),name:l.z.string().optional().describe("Optional name of the workspace (no spaces)"),gitRepoUrl:l.z.string().optional().describe("Optional git repository URL to clone into the workspace")}),this.workspaceService=e,this.baseDir=t}async cloneAndCleanGitRepo(e,t){try{h.default.info(`Cloning repository from ${t} to ${e}`),await y(`git clone ${t} ${e} --quiet`),h.default.debug("Repository cloned successfully");const r=u.join(e,".git");d.existsSync(r)&&(h.default.debug(`Removing existing .git directory at ${r}`),await(0,g.rm)(r,{recursive:!0,force:!0}),h.default.debug(".git directory removed successfully")),h.default.info("Initializing new git repository");const n=(0,m.default)(e);await n.init(),h.default.debug("Git repository initialized"),await n.add("."),h.default.debug("Added all files to git"),await n.commit(`initial commit after copying from ${t}`),h.default.info("Created initial commit in new repository")}catch(e){throw h.default.error(`Failed to clone repository: ${e.message}`,e),new Error(`Failed to clone repository: ${e.message}`)}}async _call({baseDir:e,name:t,gitRepoUrl:r}){try{if(h.default.info(`Adding workspace with baseDir: ${e}, name: ${t||"not provided"}, gitRepoUrl: ${r||"not provided"}`),!u.isAbsolute(e))throw h.default.warn(`Base directory is not absolute: ${e}`),new Error(`Base directory must be an absolute path: ${e}`);const n=e;if(h.default.debug(`Full path resolved to: ${n}`),r){h.default.info(`Git repository URL provided, preparing to clone from: ${r}`);const e=u.dirname(n);if(h.default.debug(`Checking parent directory: ${e}`),!d.existsSync(e))throw h.default.error(`Parent directory does not exist: ${e}`),new Error(`Parent directory does not exist: ${e}`);h.default.debug("Parent directory exists, proceeding with clone"),await this.cloneAndCleanGitRepo(n,r)}else{if(h.default.info("No git repository URL provided, checking if directory exists"),!d.existsSync(n))throw h.default.error(`Base directory does not exist: ${n}`),new Error(`Base directory does not exist: ${n}`);h.default.debug("Directory exists, proceeding with workspace creation")}const o=t||u.basename(n);h.default.info(`Creating workspace in database with name: ${o}`),await this.workspaceService.createWorkspace({name:o,repoBaseDir:n,ensureGitRepo:!0}),h.default.debug("Workspace created in database successfully");const i=`Workspace '${o}' added successfully at ${n}${r?" (cloned from git)":""}`;return h.default.info(i),i}catch(e){return h.default.error(`Error adding workspace: ${e.message}`,e),`Error adding workspace: ${e.message}`}}}t.AddWorkspace=v},6002:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=6002,e.exports=t},6006:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parseDiff=a,t.lineTrimmedFallbackMatch=c,t.blockAnchorFallbackMatch=l,t.applyDiff=function(e,t){const r=a(t);let n=e;for(const t of r){const{search:r,replace:a}=t;if(!r.trim())return e.trim(),a;let d=n.indexOf(r),u=-1!==d?d+r.length:-1;if(-1===d){const e=c(n,r,0);if(e)[d,u]=e;else{const e=l(n,r,0);if(!e){const e=r.split("\n"),t=e[0],n=e[e.length-1],a=`${o.ERROR_MESSAGES.SEARCH_NOT_FOUND} Block starts with: "${t.substring(0,50)}${t.length>50?"...":""}" and ends with: "${n.substring(0,50)}${n.length>50?"...":""}". Ensure the SEARCH block exactly matches the file content, including whitespace and line endings.`;throw s.default.error(`[applyDiff] ${a}`),new i.FileSystemError(a,o.ERROR_TYPES.DIFF_APPLY_ERROR_NOT_FOUND)}[d,u]=e}}n=n.substring(0,d)+a+n.substring(u)}return n};const o=r(7978),i=r(9581),s=n(r(9055));function a(e){const t=e.trim();if(""===t){const e=o.ERROR_MESSAGES.EMPTY_DIFF;throw s.default.error(`[parseDiff] ${e}`),new i.FileSystemError(e,o.ERROR_TYPES.DIFF_PARSE_ERROR_NO_BLOCKS)}const r=[];if(t.includes("id: 'eve-standard-02-code-quality'")&&t.includes("id: 'eve-standard-03-documentation'")&&t.includes("id: 'eve-standard-04-security'")){const e=t.split(o.DIFF_MARKERS.SEARCH_START);for(let t=1;t<e.length;t++){const n=e[t].trim(),i=n.indexOf(o.DIFF_MARKERS.SEPARATOR),s=n.indexOf(o.DIFF_MARKERS.REPLACE_END);if(-1!==i&&-1!==s&&i<s){const e=n.substring(0,i).trim(),t=n.substring(i+o.DIFF_MARKERS.SEPARATOR.length,s).trim();r.push({search:e,replace:t})}}return r}const n=t.split(o.DIFF_MARKERS.SEARCH_START);if(1===n.length&&!t.startsWith(o.DIFF_MARKERS.SEARCH_START)){if(t.includes(o.DIFF_MARKERS.SEARCH_START)&&!t.includes(o.DIFF_MARKERS.REPLACE_END)){const e=o.ERROR_MESSAGES.INCOMPLETE_DIFF;throw s.default.error(`[parseDiff] ${e}`),new i.FileSystemError(e,o.ERROR_TYPES.DIFF_PARSE_ERROR_INCOMPLETE)}const e=`${o.ERROR_MESSAGES.INVALID_FORMAT} near "${t.substring(0,30)}..."`;throw s.default.error(`[parseDiff] ${e}`),new i.FileSystemError(e,o.ERROR_TYPES.DIFF_PARSE_ERROR_TRAILING_TEXT)}if(""!==n[0].trim()){const e=`${o.ERROR_MESSAGES.INVALID_FORMAT} near "${n[0].substring(0,30)}${n[0].length>30?"...":""}"`;throw s.default.error(`[parseDiff] ${e}`),new i.FileSystemError(e,o.ERROR_TYPES.DIFF_PARSE_ERROR_TRAILING_TEXT)}for(let e=1;e<n.length;e++){const t=n[e].trim(),a=t.indexOf(o.DIFF_MARKERS.SEPARATOR),c=t.indexOf(o.DIFF_MARKERS.REPLACE_END);if(!(-1!==a&&-1!==c&&a<c)){const e=`${o.ERROR_MESSAGES.INVALID_FORMAT} near "${t.substring(0,30)}${t.length>30?"...":""}"`;throw s.default.error(`[parseDiff] ${e}`),new i.FileSystemError(e,o.ERROR_TYPES.DIFF_PARSE_ERROR_TRAILING_TEXT)}{const l=t.substring(0,a).trim(),d=t.substring(a+o.DIFF_MARKERS.SEPARATOR.length,c).trim(),u=t.substring(c+o.DIFF_MARKERS.REPLACE_END.length).trim();if(""!==u&&(e===n.length-1||!u.startsWith(o.DIFF_MARKERS.SEARCH_START))){const e=`${o.ERROR_MESSAGES.INVALID_FORMAT} near "${u.substring(0,30)}${u.length>30?"...":""}"`;throw s.default.error(`[parseDiff] ${e}`),new i.FileSystemError(e,o.ERROR_TYPES.DIFF_PARSE_ERROR_TRAILING_TEXT)}r.push({search:l,replace:d})}}if(0===r.length){const e=o.ERROR_MESSAGES.EMPTY_DIFF;throw s.default.error(`[parseDiff] ${e}`),new i.FileSystemError(e,o.ERROR_TYPES.DIFF_PARSE_ERROR_NO_BLOCKS)}return r}function c(e,t,r){const n=e.split("\n"),o=t.split("\n");""===o[o.length-1]&&o.pop();let i=0,s=0;for(;s<r&&i<n.length;)s+=n[i].length+1,i++;for(let e=i;e<=n.length-o.length;e++){let t=!0;for(let r=0;r<o.length;r++){if(n[e+r].trim()!==o[r].trim()){t=!1;break}}if(t){let t=0;for(let r=0;r<e;r++)t+=n[r].length+1;let r=t;for(let t=0;t<o.length;t++)r+=n[e+t].length+1;return[t,r]}}return!1}function l(e,t,r){const n=e.split("\n"),o=t.split("\n");""===o[o.length-1]&&o.pop();const i=o[0].trim(),s=o[o.length-1].trim(),a=o.length;let c=0,l=0;for(;l<r&&c<n.length;)l+=n[c].length+1,c++;for(let e=c;e<=n.length-a;e++){if(n[e].trim()!==i)continue;if(n[e+a-1].trim()!==s)continue;let t=0;for(let r=0;r<e;r++)t+=n[r].length+1;let r=t;for(let t=0;t<a;t++)r+=n[e+t].length+1;return[t,r]}return!1}},6134:e=>{"use strict";e.exports=require("@nestjs/websockets")},6158:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolFactoryService=void 0;const a=r(3563),c=r(7602),l=s(r(9055)),d=r(8474),u=r(3153),f=r(7373),p=r(3923),h=r(4970),g=r(7465),m=r(7793),y=r(3765),v=r(5515),_=r(5996),w=r(1781),b=r(7600),k=r(2626),S=r(4911),R=r(3716),T=r(2923),$=r(4500),O=r(42),P=r(9461),E=r(5188),I=r(308),C=r(2900),A=r(5018),M=r(3239),D=r(6696),x=r(7205),j=r(4934),N=r(1983),F=r(4778),L=r(2368),U=r(6910);let B=n=class{constructor(e,t,r,n,o,i,s,a,c){this.mutationsService=e,this.workspaceService=t,this.sourceArtefactService=r,this.sessionService=n,this.summaryCompletion=o,this.datasetRetrievalService=i,this.storedFileService=s,this.mcpToolFactoryService=a,this.configService=c,this.toolMap={update_file:e=>new p.UpdateFile(e.getToolBaseDir(),this.mutationsService,e.sessionId,e.requestId),read_file:e=>new h.ReadFile(e.getToolBaseDir()),read_port_from_file:e=>new m.ReadPortFromFile(e.workspace.portFromBaseDir),delete_file:e=>new g.DeleteFile(e.getToolBaseDir()),command_line:e=>new y.CommandLine(e.getToolBaseDir(),this.summaryCompletion),mcp_test:e=>new A.MCPTest(e.getToolBaseDir()),read_workspace_tree:e=>new v.ReadWorkspaceTree(e.getToolBaseDir()),add_workspace:e=>new _.AddWorkspace(this.workspaceService,e.getToolBaseDir()),fetch_web_page:()=>new w.FetchWebPage(this.summaryCompletion),read_dependency_source_tree:()=>new b.ReadDependencySourceTree(this.sourceArtefactService),read_dependency_source_file:()=>new k.ReadDependencySourceFile(this.sourceArtefactService),git_commit:e=>new S.GitCommit(e.getToolBaseDir(),e.requestId,this.sessionService),git_init:e=>new R.GitInit(e.getToolBaseDir()),current_timestamp:()=>new T.CurrentTimestamp,dataset_retrieval:()=>new $.DatasetRetrieval(this.datasetRetrievalService),docx_to_html:()=>new O.DocxToHtml(this.storedFileService),list_files:e=>new P.ListFiles(e.getToolBaseDir()),grep:e=>new E.Grep(e.getToolBaseDir()),find_files:e=>new I.FindFiles(e.getToolBaseDir()),serp_api:()=>new C.SerpApi(this.configService),computer:()=>{switch(process.platform){case"linux":return new j.ComputerToolLinux;case"darwin":return new N.ComputerToolMac;case"win32":throw new Error("ComputerTool is not supported on Windows yet.");default:throw new Error(`Unsupported platform: ${process.platform}`)}}}}toSnakeCase(e){return e.split(/(?=[A-Z])/).join("_").toLowerCase()}registerTool(e,t){const r=this.toSnakeCase(e);this.toolMap[r]=t,l.default.info(`[${n.name}] Registered new tool: ${r}`)}async createTools(e,t){const r=e.map((e=>{const r=this.toSnakeCase(e),n=this.toolMap[r];if(!n)throw new Error(`Unknown tool: ${e}`);return n(t)}));if(this.configService.getBooleanProperty(U.ConfigPropNames.MCP_SERVERS_ENABLED,!0))try{const e=await this.mcpToolFactoryService.createMcpTools();e.length>0&&(l.default.info(`[${n.name}] Adding ${e.length} MCP tools to the tool list`),r.push(...e))}catch(e){l.default.error(`[${n.name}] Failed to add MCP tools: ${e.message}`)}else l.default.info(`[${n.name}] MCP servers are disabled, skipping MCP tools`);return r}createTool(e,t){const r=this.toSnakeCase(e),n=this.toolMap[r];if(!n)throw new Error(`Unknown tool: ${e}`);return n(t)}async allTools(e){const t=Object.values(this.toolMap).map((t=>t(e)));if(this.configService.getBooleanProperty(U.ConfigPropNames.MCP_SERVERS_ENABLED,!0))try{const e=await this.mcpToolFactoryService.createMcpTools();e.length>0&&(l.default.info(`[${n.name}] Adding ${e.length} MCP tools to all tools list`),t.push(...e))}catch(e){l.default.error(`[${n.name}] Failed to add MCP tools to all tools: ${e.message}`)}else l.default.info(`[${n.name}] MCP servers are disabled, skipping MCP tools in allTools`);return t}async createMcpTools(e){if(!this.configService.getBooleanProperty(U.ConfigPropNames.MCP_SERVERS_ENABLED,!0))return l.default.info(`[${n.name}] MCP servers are disabled, returning empty array`),[];try{return await this.mcpToolFactoryService.createMcpTools()}catch(e){return l.default.error(`[${n.name}] Failed to create MCP tools: ${e.message}`),[]}}};t.ToolFactoryService=B,t.ToolFactoryService=B=n=o([(0,a.Injectable)(),i("design:paramtypes",[c.MutationsService,d.WorkspaceService,u.SourceArtefactService,f.SessionService,M.SummaryCompletion,D.DatasetRetrievalService,x.StoredFileService,F.McpToolFactoryService,L.ConfigService])],B)},6170:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RulesService=void 0;const f=r(3563),p=(r(1832),c(r(6928))),h=c(r(9896)),g=r(3903),m=u(r(9055)),y=r(1145),v=r(2141),_=r(9668);let w=o=class{constructor(e,t,r){this.fileSystemService=e,this.knex=t,this.userService=r,m.default.info(`[${o.name}] RulesService initialized`)}async getAllRules(e,t){try{let r;m.default.debug(`[${o.name}] Getting all rules for working directory: ${e}`);try{const e=await this.userService.getCurrentUser();r=e.userId,m.default.debug(`[${o.name}] Using authenticated user ID: ${r} (${e.email})`)}catch(e){r="system",m.default.warn(`[${o.name}] Failed to get user ID, falling back to 'system': ${e.message}`)}const n=(await this.getAllRulesWithPreferences(e,r,t)).filter((e=>e.isEnabled));return n.length>0?(m.default.debug(`[${o.name}] Found ${n.length} enabled rules in total`),this.formatRuleOutput(n)):void m.default.debug(`[${o.name}] No enabled rules found`)}catch(e){return void m.default.error(`[${o.name}] Error getting all rules: ${e.message}\n${e.stack}`)}}formatRuleOutputLegacy(e){return e.map((e=>`---- Rules from ${e.sourceIdentifier||e.id} ----\n${e.content}\n--------------------------------`)).join("\n\n")}async getRulesBySource(e,t,r,n){try{switch(e){case y.RuleSource.REPO:if(!r)throw new f.BadRequestException("Workspace path is required for repo rules");return this.getRepoRules(r,t,n);case y.RuleSource.USER:return this.getUserRules(t);case y.RuleSource.EVE:return this.getEveRules(t);default:throw new f.BadRequestException(`Invalid rule source: ${e}`)}}catch(e){throw m.default.error(`[${o.name}] Error getting rules by source: ${e.message}\n${e.stack}`),e}}async getRepoRules(e,t,r){try{const n=p.isAbsolute(e)?e:p.resolve(process.cwd(),e);m.default.debug(`[${o.name}] Getting repo rules for workspace: ${e}`),m.default.debug(`[${o.name}] Resolved absolute workspace path: ${n}`),m.default.debug(`[${o.name}] Current working directory: ${process.cwd()}`);const i=[],s=p.join(n,"hints.md");m.default.debug(`[${o.name}] Checking for hints.md at: ${s}`),await this.addRepoRuleIfExists(i,s,t,r,n);const a=p.join(n,".clinerules");m.default.debug(`[${o.name}] Checking for .clinerules directory at: ${a}`);const c=h.existsSync(a);m.default.debug(`[${o.name}] .clinerules directory sync exists check: ${c}`);const l=await this.fileSystemService.directoryExists(a);m.default.debug(`[${o.name}] .clinerules directory async exists check: ${l}`);try{if(c){const e=h.statSync(a).isDirectory();m.default.debug(`[${o.name}] Is .clinerules a directory (sync): ${e}`),e&&m.default.debug(`[${o.name}] .clinerules contents (sync): ${h.readdirSync(a)}`)}}catch(e){m.default.error(`[${o.name}] Error checking .clinerules directory: ${e.message}`)}await this.addRepoRulesFromDirectory(i,a,t,r,n);const d=p.join(n,".everules");return m.default.debug(`[${o.name}] Checking for .everules directory at: ${d}`),m.default.debug(`[${o.name}] Directory exists: ${h.existsSync(d)}`),await this.addRepoRulesFromDirectory(i,d,t,r,n),m.default.debug(`[${o.name}] Found ${i.length} repo rules`),i}catch(e){return m.default.error(`[${o.name}] Error getting repo rules: ${e.message}\n${e.stack}`),[]}}async addRepoRuleIfExists(e,t,r,n,i){try{if(h.existsSync(t)){const i=h.readFileSync(t,"utf8"),s=p.basename(t),a=this.getRelativePath(t),c=n?`${n}:${a}`:a,l=await this.getUserRulePreference(r,c);m.default.debug(`[${o.name}] Adding repo rule: ${c}, preference: ${l?JSON.stringify(l):"null"}`),e.push({id:c,name:s,content:i,sourceType:y.RuleSource.REPO,sourceIdentifier:a,isEnabled:!l||l.isEnabled,isEditable:!0,isDeletable:!0,createdAt:new Date,updatedAt:new Date})}}catch(e){m.default.error(`[${o.name}] Error adding repo rule: ${e.message}`)}}async addRepoRulesFromDirectory(e,t,r,n,i){try{if(h.existsSync(t)&&h.statSync(t).isDirectory()){const i=h.readdirSync(t).filter((e=>e.endsWith(".md"))).sort();m.default.debug(`[${o.name}] Found ${i.length} .md files in ${t}: ${i.join(", ")}`);for(const s of i){const i=p.join(t,s);m.default.debug(`[${o.name}] Processing rule file: ${i}`);const a=h.readFileSync(i,"utf8"),c=this.getRelativePath(i),l=n?`${n}:${c}`:c;m.default.debug(`[${o.name}] Rule ID (with workspace): ${l}`);const d=await this.getUserRulePreference(r,l);m.default.debug(`[${o.name}] User preference for ${l}: ${d?JSON.stringify(d):"null"}`),m.default.debug(`[${o.name}] Adding repo rule from directory: ${l}, preference: ${d?JSON.stringify(d):"null"}`),e.push({id:l,name:s,content:a,sourceType:y.RuleSource.REPO,sourceIdentifier:c,isEnabled:!d||d.isEnabled,isEditable:!0,isDeletable:!0,createdAt:new Date,updatedAt:new Date}),m.default.debug(`[${o.name}] Added rule: ${s}`)}}else m.default.debug(`[${o.name}] Directory does not exist or is not a directory: ${t}`)}catch(e){m.default.error(`[${o.name}] Error adding repo rules from directory: ${e.message}`)}}getRelativePath(e){const t=e.split(p.sep),r=t.indexOf(".everules"),n=t.indexOf(".clinerules");return r>=0?p.join(".everules",...t.slice(r+1)):n>=0?p.join(".clinerules",...t.slice(n+1)):"hints.md"===t[t.length-1]?"hints.md":e}async getUserRules(e){try{const t=await this.knex("eve_rules").where("source_type",y.RuleSource.USER).select("*");return await Promise.all(t.map((async t=>{const r=await this.getUserRulePreference(e,t.id);return m.default.debug(`[${o.name}] Adding user rule: ${t.id}, preference: ${r?JSON.stringify(r):"null"}`),{id:t.id,name:t.name,content:t.content,sourceType:t.source_type,sourceIdentifier:t.source_identifier,isEnabled:!!r&&r.isEnabled,isEditable:t.is_editable,isDeletable:t.is_deletable,createdAt:t.created_at,updatedAt:t.updated_at}})))}catch(e){return m.default.error(`[${o.name}] Error getting user rules: ${e.message}\n${e.stack}`),[]}}async getEveRules(e){try{const t=await this.knex("eve_rules").where("source_type",y.RuleSource.EVE).select("*");return await Promise.all(t.map((async t=>{const r=await this.getUserRulePreference(e,t.id);return m.default.debug(`[${o.name}] Adding Eve rule: ${t.id}, preference: ${r?JSON.stringify(r):"null"}`),{id:t.id,name:t.name,content:t.content,sourceType:t.source_type,sourceIdentifier:t.source_identifier,isEnabled:!!r&&r.isEnabled,isEditable:!1,isDeletable:!1,createdAt:t.created_at,updatedAt:t.updated_at}})))}catch(e){return m.default.error(`[${o.name}] Error getting Eve standard rules: ${e.message}\n${e.stack}`),[]}}async getRuleContent(e,t){try{switch(t){case y.RuleSource.REPO:throw new f.BadRequestException("Use getRepoRuleContent for repo rules");case y.RuleSource.USER:case y.RuleSource.EVE:const r=await this.knex("eve_rules").where("id",e).where("source_type",t).first();if(!r)throw new f.NotFoundException(`Rule ${e} not found`);return{content:r.content};default:throw new f.BadRequestException(`Invalid rule source: ${t}`)}}catch(e){throw m.default.error(`[${o.name}] Error getting rule content: ${e.message}\n${e.stack}`),e}}async getRepoRuleContent(e,t){try{const r=p.join(e,t);if(!h.existsSync(r))throw new f.NotFoundException(`Rule file ${t} not found`);return{content:h.readFileSync(r,"utf8")}}catch(e){throw m.default.error(`[${o.name}] Error getting repo rule content: ${e.message}\n${e.stack}`),e}}async updateRuleContent(e,t,r){try{switch(t){case y.RuleSource.REPO:throw new f.BadRequestException("Use updateRepoRuleContent for repo rules");case y.RuleSource.USER:const n=await this.knex("eve_rules").where("id",e).where("source_type",t).first();if(!n)throw new f.NotFoundException(`Rule ${e} not found`);if(!n.is_editable)throw new f.BadRequestException(`Rule ${e} cannot be edited`);await this.knex("eve_rules").where("id",e).update({content:r,updated_at:new Date});break;case y.RuleSource.EVE:throw new f.BadRequestException("Eve standard rules cannot be edited");default:throw new f.BadRequestException(`Invalid rule source: ${t}`)}}catch(e){throw m.default.error(`[${o.name}] Error updating rule content: ${e.message}\n${e.stack}`),e}}async updateRepoRuleContent(e,t,r){try{const n=p.join(e,t);if(!h.existsSync(n))throw new f.NotFoundException(`Rule file ${t} not found`);h.writeFileSync(n,r)}catch(e){throw m.default.error(`[${o.name}] Error updating repo rule content: ${e.message}\n${e.stack}`),e}}async toggleRuleStatus(e,t,r){try{m.default.debug(`[${o.name}] Toggling rule status for rule ID: ${e}, user ID: ${t}, enabled: ${r}`);const n=await this.getUserRulePreference(t,e);if(m.default.debug(`[${o.name}] Existing preference: ${n?JSON.stringify(n):"none"}`),n){m.default.debug(`[${o.name}] Updating existing preference for rule ID: ${e}`);const n=await this.knex("eve_user_rule_preferences").where("user_id",t).where("rule_id",e).update({is_enabled:r?1:0,updated_at:new Date});m.default.debug(`[${o.name}] Update result: ${n} rows affected`)}else{m.default.debug(`[${o.name}] Creating new preference for rule ID: ${e}`);const n=await this.knex("eve_user_rule_preferences").insert({user_id:t,rule_id:e,is_enabled:r?1:0,created_at:new Date,updated_at:new Date});m.default.debug(`[${o.name}] Insert result: ${n}`)}const i=await this.getUserRulePreference(t,e);return void m.default.debug(`[${o.name}] Updated preference: ${i?JSON.stringify(i):"none"}`)}catch(e){throw m.default.error(`[${o.name}] Error toggling rule status: ${e.message}\n${e.stack}`),e}}async createRule(e,t,r,n,i){try{switch(e){case y.RuleSource.REPO:if(!n)throw new f.BadRequestException("Workspace path is required for repo rules");return this.createRepoRule(n,t,r,i);case y.RuleSource.USER:return this.createUserRule(t,r);case y.RuleSource.EVE:throw new f.BadRequestException("Eve standard rules cannot be created");default:throw new f.BadRequestException(`Invalid rule source: ${e}`)}}catch(e){throw m.default.error(`[${o.name}] Error creating rule: ${e.message}\n${e.stack}`),e}}async createRepoRule(e,t,r,n){try{const o=p.join(e,".everules");h.existsSync(o)||h.mkdirSync(o,{recursive:!0});const i=p.join(o,t);h.writeFileSync(i,r);const s=p.join(".everules",t);return{id:n?`${n}:${s}`:s,name:t,content:r,sourceType:y.RuleSource.REPO,sourceIdentifier:s,isEnabled:!0,isEditable:!0,isDeletable:!0,createdAt:new Date,updatedAt:new Date}}catch(e){throw m.default.error(`[${o.name}] Error creating repo rule: ${e.message}\n${e.stack}`),e}}async createUserRule(e,t){try{const r=(0,g.v4)();return await this.knex("eve_rules").insert({id:r,name:e,content:t,source_type:y.RuleSource.USER,is_editable:!0,is_deletable:!0,created_at:new Date,updated_at:new Date}),{id:r,name:e,content:t,sourceType:y.RuleSource.USER,isEnabled:!0,isEditable:!0,isDeletable:!0,createdAt:new Date,updatedAt:new Date}}catch(e){throw m.default.error(`[${o.name}] Error creating user rule: ${e.message}\n${e.stack}`),e}}async deleteRule(e,t){try{switch(t){case y.RuleSource.REPO:throw new f.BadRequestException("Use deleteRepoRule for repo rules");case y.RuleSource.USER:const r=await this.knex("eve_rules").where("id",e).where("source_type",t).first();if(!r)throw new f.NotFoundException(`Rule ${e} not found`);if(!r.is_deletable)throw new f.BadRequestException(`Rule ${e} cannot be deleted`);await this.knex("eve_rules").where("id",e).delete(),await this.knex("eve_user_rule_preferences").where("rule_id",e).delete();break;case y.RuleSource.EVE:throw new f.BadRequestException("Eve standard rules cannot be deleted");default:throw new f.BadRequestException(`Invalid rule source: ${t}`)}}catch(e){throw m.default.error(`[${o.name}] Error deleting rule: ${e.message}\n${e.stack}`),e}}async deleteRepoRule(e,t){try{const r=p.join(e,t);if(!h.existsSync(r))throw new f.NotFoundException(`Rule file ${t} not found`);h.unlinkSync(r)}catch(e){throw m.default.error(`[${o.name}] Error deleting repo rule: ${e.message}\n${e.stack}`),e}}async getUserRulePreference(e,t){try{m.default.debug(`[${o.name}] Getting user rule preference for user ID: ${e}, rule ID: ${t}`);const r=await this.knex("eve_user_rule_preferences").where("user_id",e).where("rule_id",t).first();if(!r)return m.default.debug(`[${o.name}] No preference found for user ID: ${e}, rule ID: ${t}`),null;const n=1===r.is_enabled||!0===r.is_enabled;return m.default.debug(`[${o.name}] Found preference for user ID: ${e}, rule ID: ${t}, is_enabled: ${r.is_enabled} (raw), ${n} (boolean)`),{userId:r.user_id,ruleId:r.rule_id,isEnabled:n,createdAt:r.created_at,updatedAt:r.updated_at}}catch(e){return m.default.error(`[${o.name}] Error getting user rule preference: ${e.message}\n${e.stack}`),null}}async setUserRulePreference(e,t,r){try{m.default.debug(`[${o.name}] Setting user rule preference for user ID: ${e}, rule ID: ${t}, enabled: ${r}`);if(await this.getUserRulePreference(e,t)){m.default.debug(`[${o.name}] Updating existing preference for rule ID: ${t}`);const n=await this.knex("eve_user_rule_preferences").where("user_id",e).where("rule_id",t).update({is_enabled:r?1:0,updated_at:new Date});m.default.debug(`[${o.name}] Update result: ${n} rows affected`)}else{m.default.debug(`[${o.name}] Creating new preference for rule ID: ${t}`);const n=await this.knex("eve_user_rule_preferences").insert({user_id:e,rule_id:t,is_enabled:r?1:0,created_at:new Date,updated_at:new Date});m.default.debug(`[${o.name}] Insert result: ${n}`)}const n=await this.getUserRulePreference(e,t);m.default.debug(`[${o.name}] Updated preference: ${n?JSON.stringify(n):"none"}`)}catch(e){throw m.default.error(`[${o.name}] Error setting user rule preference: ${e.message}\n${e.stack}`),e}}async getAllRulesWithPreferences(e,t,r){try{m.default.debug(`[${o.name}] Getting all rules with preferences for working directory: ${e}`);const n=await this.getRepoRules(e,t,r),i=await this.getUserRules(t),s=await this.getEveRules(t);return[...n,...i,...s]}catch(e){return m.default.error(`[${o.name}] Error getting all rules with preferences: ${e.message}\n${e.stack}`),[]}}formatRuleOutput(e){return e.map((e=>{e.sourceIdentifier||e.name;return`---- Rule: ${e.name} ----\n${e.content}\n--------------------------------`})).join("\n\n")}};t.RulesService=w,t.RulesService=w=o=a([(0,f.Injectable)(),d(1,(0,f.Inject)("KNEX")),l("design:paramtypes",[v.FileSystemService,Function,_.UserService])],w)},6206:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProviderRegistry=void 0;const s=r(3563),a=i(r(9055));let c=class{constructor(){this.serviceName="ProviderRegistry",this.providers=new Map}onModuleInit(){a.default.info(`[${this.serviceName}] Provider registry initialized`)}registerProvider(e){const t=e.getId();this.providers.set(t,e),a.default.info(`[${this.serviceName}] Registered provider: ${t}`)}getProvider(e){const t=this.providers.get(e);if(!t)throw new Error(`Provider not found: ${e}`);return t}getAllProviders(){return Array.from(this.providers.values())}getAllProviderIds(){return Array.from(this.providers.keys())}};t.ProviderRegistry=c,t.ProviderRegistry=c=n([(0,s.Injectable)(),o("design:paramtypes",[])],c)},6228:e=>{"use strict";e.exports=require("@langchain/openai")},6254:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageUtils=void 0;const o=r(1486),i=n(r(9055));class s{static processOutputEvent(e){try{i.default.debug("Processing output event: %s",JSON.stringify(e));let t,r=e?.messages,n="AI",a="No content found";if(!r&&e?.agent?.messages?r=e.agent.messages:!r&&e?.tools?.messages&&(r=e.tools.messages,n="Tool"),r&&Array.isArray(r)&&r.length>0){const c=r[r.length-1];if(!c)return i.default.warn("Last message is undefined or null"),{label:"Unknown",content:"Invalid message format"};if(c instanceof o.ToolMessage||"tool"===c.type){const e=c.name||"Unknown Tool";if(void 0!==c.content){return{label:"Tool",content:`Calling ${e}\nOutput was:\n${s.processContent(c.content)}`}}return i.default.warn("Tool message has undefined content: %s",JSON.stringify(c)),{label:"Tool",content:`Calling ${e}\nOutput was undefined`}}if(c instanceof o.AIMessage)return void 0!==c.content?(a=s.processContent(c.content),t=this.extractUsageMetadata(c),a.trim().length<1?(i.default.warn("AI message has empty content %s",{lastMessage:JSON.stringify(c)}),{label:"AI",content:JSON.stringify(c),usageMetadata:t}):{label:"AI",content:a,usageMetadata:t}):(i.default.warn("AI message has undefined content: %s",JSON.stringify(c)),{label:"AI",content:"AI message content was undefined",usageMetadata:t});if(c instanceof o.HumanMessage)return void 0!==c.content?(a=s.processContent(c.content),n=a.startsWith("Tool:")?"Tool":"Human",{label:n,content:a}):(i.default.warn("Human message has undefined content: %s",JSON.stringify(c)),{label:"Human",content:"Human message content was undefined"});if(c instanceof o.BaseMessage)return void 0!==c.content?(a=s.processContent(c.content),{label:n,content:a}):(i.default.warn("Base message has undefined content: %s",JSON.stringify(c)),{label:n,content:"Base message content was undefined"});try{i.default.warn("Processing unknown output using strings",{output:JSON.stringify(e)});const r=JSON.stringify(c),o=JSON.parse(r);if(o&&"object"==typeof o&&"kwargs"in o&&o.kwargs&&"object"==typeof o.kwargs&&"content"in o.kwargs)return a=o.kwargs.content,t=this.extractUsageMetadata(o),{label:n,content:a,usageMetadata:t}}catch(e){i.default.error("Error parsing message: %s",e)}}return i.default.warn("Processing unknown output: %s",{output:JSON.stringify(e)}),{label:"Unknown",content:JSON.stringify(e)}}catch(t){return i.default.error("Error in processOutputEvent: %s",t),i.default.error("Output that caused error: %s",JSON.stringify(e)),{label:"Error",content:`Error processing output: ${t.message}. See logs for details.`}}}static processContent(e){if(Array.isArray(e))try{return i.default.debug("Processing array content: %s",JSON.stringify(e)),e.filter((e=>e&&"object"==typeof e)).filter((e=>("text"!==e.type||"text"in e||i.default.warn('Found item with type "text" but missing text property: %s',JSON.stringify(e)),"text"===e.type&&"text"in e))).map((e=>e.text||"")).join("\n")}catch(t){return i.default.error("Error processing content array: %s",t),i.default.error("Content that caused error: %s",JSON.stringify(e)),String(e)}return String(e)}static extractUsageMetadata(e){try{if(!e)return void i.default.warn("Cannot extract usage metadata: message is undefined");const t=e.response_metadata?.usage||e.usage_metadata;if(!t)return void i.default.debug("No usage metadata found in message");i.default.debug("Raw usage data: %s",JSON.stringify(t));const r={inputTokens:t.input_tokens||0,cacheWriteTokens:t.cache_creation_input_tokens||0,cacheReadTokens:t.cache_read_input_tokens||0,outputTokens:t.output_tokens||0,totalTokens:t.total_tokens||0};return i.default.info("extractUsageMetadata - usageMetadata: %s",{usageMetadata:JSON.stringify(r)}),r}catch(t){return i.default.error("Error extracting usage metadata: %s",t),void i.default.error("Message that caused error: %s",JSON.stringify(e))}}static buildHumanMessage(e){try{if("string"==typeof e)return new o.HumanMessage(e);if(Array.isArray(e)){if(i.default.debug("Building human message from array content: %s",JSON.stringify(e)),1===e.length&&e[0]&&"object"==typeof e[0]&&"text"===e[0].type&&"text"in e[0])return new o.HumanMessage(e[0].text);const t=e;return new o.HumanMessage({content:t})}{const t=e;return new o.HumanMessage({content:t})}}catch(t){return i.default.error("Error building human message: %s",t),i.default.error("Content that caused error: %s",JSON.stringify(e)),new o.HumanMessage("Error processing message content")}}}t.MessageUtils=s},6268:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ListCodeDefinitionsTool=void 0;const u=r(3563),f=c(r(1943)),p=d(r(9055)),h=c(r(6928)),g=r(873),m=r(9581);let y=o=class{constructor(e,t){this.treeSitterService=t,this.name="list_code_definition_names",this.description="Request to list definition names (classes, functions, methods, etc.) used in source code files.",this.workingDir=e}getUsageInstructions(e){return`## list_code_definition_names\nDescription: Request to list definition names (classes, functions, methods, etc.) used in source code files at the top level of the specified directory. This tool provides insights into the codebase structure and important constructs, encapsulating high-level concepts and relationships that are crucial for understanding the overall architecture.\nParameters:\n- path: (required) The path of the directory (relative to the current working directory ${e.workingDir}) to list top level source code definitions for.\nUsage:\n<list_code_definition_names>\n<path>Directory path here</path>\n</list_code_definition_names>`}validateParams(e){return"string"==typeof e.path&&""!==e.path.trim()}async execute(e){const{path:t}=e;p.default.info(`[${o.name}] Listing code definitions in directory: ${t} relative to ${this.workingDir}`);const r=h.resolve(this.workingDir,t);if(!r.startsWith(this.workingDir)){const e=`Path traversal attempt detected: ${t} resolves outside of workspace ${this.workingDir}`;throw p.default.error(`[${o.name}] ${e}`),new m.FileSystemError(e,"PATH_TRAVERSAL_ERROR")}try{try{await f.stat(r)}catch(e){if("ENOENT"===e.code){const e=`Path not found: ${t}`;throw p.default.error(`[${o.name}] ${e}`),new m.FileNotFoundError(e,t)}throw e}const e=await this.getSourceCodeFiles(r);if(0===e.length)return"No source code files found in the specified path.";const n=await this.extractDefinitions(e);return this.formatDefinitions(n,this.workingDir)}catch(e){if(e instanceof m.FileNotFoundError||e instanceof m.FileSystemError)throw e;const r=`Error listing code definitions in directory ${t}: ${e.message}`;throw p.default.error(`[${o.name}] ${r}\n${e.stack}`),new m.FileSystemError(r,e.code||"FS_LIST_DEFINITIONS_ERROR")}}async getSourceCodeFiles(e){let t;try{t=await f.stat(e)}catch(e){if("ENOENT"===e.code)return[];throw e}if(t.isFile())return this.isSourceCodeFile(e)?[e]:[];if(!t.isDirectory())return[];const r=[];let n;try{n=await f.readdir(e,{withFileTypes:!0})}catch(t){return p.default.warn(`[${o.name}] Error reading directory ${e}: ${t.message}`),[]}for(const t of n){const n=h.join(e,t.name);if(t.isDirectory()){if(this.shouldIgnoreDirectory(t.name))continue;try{const e=await this.getSourceCodeFiles(n);r.push(...e)}catch(e){p.default.warn(`[${o.name}] Error processing subdirectory ${n}: ${e.message}`)}}else t.isFile()&&this.isSourceCodeFile(t.name)&&r.push(n)}return r}isSourceCodeFile(e){const t=h.extname(e).toLowerCase().slice(1);return this.treeSitterService.isExtensionSupported(t)}shouldIgnoreDirectory(e){return["node_modules","dist","build","out",".git",".vscode",".idea","__pycache__","venv","env"].includes(e)}async extractDefinitions(e){const t=new Map;for(const r of e)try{const e=await f.readFile(r,"utf8"),n=this.treeSitterService.parseDefinitions(r,e);n.length>0&&t.set(r,n)}catch(e){p.default.warn(`[${o.name}] Error reading file ${r}: ${e.message}`)}return t}formatDefinitions(e,t){if(0===e.size)return"No definitions found.";let r="";const n=Array.from(e.keys()).sort();for(const o of n){const n=e.get(o)||[];r+=`\n${h.relative(t,o)}:\n`,n.sort();for(const e of n)r+=`  - ${e}\n`}return r.trim()}};t.ListCodeDefinitionsTool=y,t.ListCodeDefinitionsTool=y=o=a([(0,u.Injectable)(),l("design:paramtypes",[String,g.TreeSitterService])],y)},6282:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ESLintValidator=void 0;const s=r(3563),a=r(2609),c=i(r(9055));let l=class extends a.BaseCommandLineValidator{constructor(){super({name:"ESLint",command:"npx eslint --format json {filePath}",fileExtensions:["js","jsx","ts","tsx"],issuePattern:/"line":(?<line>\d+),"column":(?<column>\d+),"severity":(?<severityNum>\d+),"message":"(?<message>[^"]+)"/g,priority:20})}hasValidationErrors(e,t,r){return 0!==r||this.config.issuePattern.test(e)||this.config.issuePattern.test(t)}formatValidationReport(e,t){try{if(e&&e.trim().startsWith("[")&&e.trim().endsWith("]")){const t=JSON.parse(e);return this.formatESLintResults(t)}}catch(e){c.default.warn(`[${this.constructor.name}] Error parsing ESLint JSON output: ${e.message}`)}return e||t}formatESLintResults(e){if(!e||0===e.length)return"No ESLint issues found.";let t="";for(const r of e)if(r.messages&&r.messages.length>0){t+=`File: ${r.filePath}\n`;for(const e of r.messages){const r=2===e.severity?"error":"warning";t+=`  ${e.line}:${e.column} ${r} ${e.message} (${e.ruleId})\n`}t+="\n"}return t||"No ESLint issues found."}};t.ESLintValidator=l,t.ESLintValidator=l=n([(0,s.Injectable)(),o("design:paramtypes",[])],l)},6292:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PersonaRegistry=void 0;const i=r(3563),s=r(3911);let a=class{constructor(e){this.softwareEngineerPersona=e,this.personas=new Map,this.registerPersona(e)}registerPersona(e){this.personas.set(e.getId(),e)}getPersona(e){const t=this.personas.get(e);return t||this.personas.get("software-engineer")}getAllPersonas(){return Array.from(this.personas.values())}};t.PersonaRegistry=a,t.PersonaRegistry=a=n([(0,i.Injectable)(),o("design:paramtypes",[s.SoftwareEngineerPersona])],a)},6295:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleAgentService=void 0;const s=r(3563),a=r(1412),c=r(8474),l=r(7373),d=r(538),u=r(3239),f=r(9234),p=r(9100),h=i(r(9055)),g=r(4911),m=r(1544),y=r(6254),v=r(6158),_=r(3470);let w=class{constructor(e,t,r,n,o,i){this.workspaceService=e,this.sessionService=t,this.homeService=r,this.summaryCompletion=n,this.toolFactory=o,this.ruleService=i,this.chatModelManager=m.ChatModelManager.getInstance()}async getAgentRules(){const e=await this.ruleService.getRulesByAgentName(this.getName());return e?.content||null}createInitialState(){return{messages:[]}}async*processRequestStream(e){const t=(0,p.ulid)();if(!await this.homeService.isAccessOkay()){const r={label:"Error",content:"Access is not valid. Please check your Eve API key and try again."},n=await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:e.sessionId||this.generateSessionId(),label:r.label,content:r.content,createdAt:new Date,requestId:t});return void(yield n)}const r=new Date;e.sessionId||(e.sessionId=this.generateSessionId());const n=await this.chatModelManager.getModel(e.config,this.getModelCategory(),this.isPrivateModelsOnly());let o;e.workspaceName?o=await this.workspaceService.lockByName(e.workspaceName):(o=await this.workspaceService.lockSessionWorkspace(e.sessionId),e.workspaceName=o.name);const i=o.name,s=new f.RequestContext(o,t,e.sessionId);let c=!1,l=0,d=0,u=0,m=0,v="";try{const o=a.AgentRequest.getFirstTextContent(e.content),i=await this.sessionService.ensureSession(e.workspaceName,e.sessionId,o,this.getName());await this.sessionService.updateSessionStatus(i.sessionId,"active"),h.default.info("%s received request: %s - %s",this.getName(),t,JSON.stringify(e)),h.default.info("Using primary model: %s",n.modelDescriptor.getFullName()),await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:e.sessionId,label:"Human",content:o,createdAt:new Date,requestId:t}),await this.sessionService.addRequest({requestId:t,sessionId:e.sessionId,workspaceName:e.workspaceName,requestContent:o,startedAt:r});const f=await this.handleAppStream(e,s,n);for await(const r of f){h.default.debug("Output Event was: %s",JSON.stringify(r));const o=y.MessageUtils.processOutputEvent(r);h.default.debug("Processed message: %s",o);const i=o.usageMetadata,s=n.calculateCost(i?.inputTokens||0,i?.cacheWriteTokens||0,i?.cacheReadTokens||0,i?.outputTokens||0),a={itemId:this.generateItemId(),sessionId:e.sessionId,label:o.label,content:o.content,createdAt:new Date,inputTokens:i?.inputTokens,cacheWriteTokens:i?.cacheWriteTokens,cacheReadTokens:i?.cacheReadTokens,outputTokens:i?.outputTokens,totalTokens:i?.totalTokens,cost:s,requestId:t},f=await this.sessionService.addItem(a);l+=i?.inputTokens||0,d+=i?.cacheWriteTokens||0,u+=i?.cacheReadTokens||0,m+=i?.outputTokens||0,v=o.content;const p=await this.sessionService.getSession(e.sessionId);if(c=p&&"aborted"===p.status,c){const t={label:"Error",content:"Session was aborted by the user."},r=await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:e.sessionId,label:t.label,content:t.content,createdAt:new Date});yield r;break}yield f}}catch(t){h.default.error("Error in Agent:",t);const r={label:"Error",content:`An error occurred: ${t.message}`},n=await this.sessionService.addItem({itemId:this.generateItemId(),sessionId:e.sessionId,label:r.label,content:r.content,createdAt:new Date});yield n}finally{try{if(!c&&o.isGitRepo){const e=new g.GitCommit(o.repoBaseDir,t,this.sessionService);if(await e.hasUncommittedUpdates()){const t=await e.getUncommittedChanges(),r="Give me a good commit message for the following diff contents - just return the message without quotes",n=await this.summaryCompletion.getSummary(r,t);h.default.info("Detected uncommitted git updates - committing changes with message: "+n),await e._call(n)}}await this.sessionService.updateSessionStatus(e.sessionId,"inactive");const i=n.calculateCost(l,d,u,m),s=new Date,a=s.getTime()-r.getTime(),f=l+d+u+m,p=await this.sessionService.updateRequest(t,{responseContent:v,endedAt:s,tookMillis:a,inputTokens:l,cacheWriteTokens:d,cacheReadTokens:u,outputTokens:m,totalTokens:f,cost:i});await this.homeService.logRequest(p),h.default.info("Agent processing completed in %s seconds - Input tokens: %s, Cache Write tokens: %s, Cache Read tokens: %s, Output tokens: %s, Total tokens: %s, Total cost: £%s",a/1e3,l,d,u,m,f,i.toFixed(6))}finally{i&&await this.workspaceService.unlockByName(i)}}}async processRequest(e){h.default.info("Processing request: %s",JSON.stringify(e));const t=this.processRequestStream(e);let r=null;for await(const e of t)r=e,h.default.info("Yielded item: %s",JSON.stringify(e));if(!r)throw new Error("No items were yielded from the generator");const n=await this.sessionService.getRequest(r?.requestId);if(!n)throw new Error("Failed to retrieve persisted request");return h.default.info("Returning request: %s",JSON.stringify(n)),n}async simpleRequest(e,t,r=null){const n=new a.AgentRequest(null,e,r,null,t);return(await this.processRequest(n)).responseContent}generateSessionId(){return(0,p.ulid)()}generateItemId(){return(0,p.ulid)()}};t.SimpleAgentService=w,t.SimpleAgentService=w=n([(0,s.Injectable)(),o("design:paramtypes",[c.WorkspaceService,l.SessionService,d.HomeService,u.SummaryCompletion,v.ToolFactoryService,_.AgentRuleService])],w)},6297:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.debugLogger=t.DebugLogger=void 0;const c=s(r(9896)),l=s(r(6928)),d=a(r(9055));class u{constructor(){this.enabled=!1;const e=l.join(process.cwd(),"logs","debug");c.existsSync(e)||c.mkdirSync(e,{recursive:!0}),this.logFile=l.join(e,`debug-${Date.now()}.log`),d.default.info(`Debug logger initialized with log file: ${this.logFile}`)}static getInstance(){return u.instance||(u.instance=new u),u.instance}enable(){this.enabled=!0,this.log("Debug logging enabled")}disable(){this.log("Debug logging disabled"),this.enabled=!1}log(e,t){if(!this.enabled)return;const r=`[${(new Date).toISOString()}] ${e}`;if(t){const e="string"==typeof t?t:JSON.stringify(t,null,2);c.appendFileSync(this.logFile,`${r}\n${e}\n\n`)}else c.appendFileSync(this.logFile,`${r}\n`)}dumpObject(e,t){this.enabled&&this.log(`${e}:`,t)}}t.DebugLogger=u,t.debugLogger=u.getInstance()},6308:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createStateManager=function(){o.default.debug("[AnthropicStateManager] Creating new state manager");const e={current:void 0,insideFence:!1,tagBuf:"",pendingPrefix:!0,TAG_BUF_LIMIT:100,isBuffering:!1,contentBuffer:"",thinkingContent:"",textContent:""};return{getState:()=>e,getCurrentBlock:()=>(e.current&&o.default.debug(`[AnthropicStateManager] Current block: ${e.current.id} (${e.current.blockType})`),e.current),setCurrentBlock:t=>{t?o.default.debug(`[AnthropicStateManager] Setting current block: ${t.id} (${t.blockType})`):o.default.debug("[AnthropicStateManager] Clearing current block"),e.current=t,t&&(e.pendingPrefix=!0)},getTagBuffer:()=>e.tagBuf,setTagBuffer:t=>{t&&o.default.debug(`[AnthropicStateManager] Setting tag buffer: "${t}"`),e.tagBuf=t},appendTagBuffer:t=>{o.default.debug(`[AnthropicStateManager] Appending to tag buffer: "${t}"`),e.tagBuf+=t,e.tagBuf.length>e.TAG_BUF_LIMIT&&(o.default.debug("[AnthropicStateManager] Tag buffer exceeded limit, truncating"),e.tagBuf=e.tagBuf.slice(0,e.TAG_BUF_LIMIT))},clearTagBuffer:()=>{e.tagBuf&&o.default.debug("[AnthropicStateManager] Clearing tag buffer"),e.tagBuf=""},getBufferedBlockId:()=>e.bufferedBlockId,setBufferedBlockId:t=>{t&&o.default.debug(`[AnthropicStateManager] Setting buffered block ID: ${t}`),e.bufferedBlockId=t},clearBufferedBlockId:()=>{e.bufferedBlockId&&o.default.debug("[AnthropicStateManager] Clearing buffered block ID"),e.bufferedBlockId=void 0},isBufferingContent:()=>e.isBuffering,startBuffering:()=>{o.default.debug("[AnthropicStateManager] Starting content buffering"),e.isBuffering=!0,e.contentBuffer=""},addToBuffer:t=>{o.default.debug(`[AnthropicStateManager] Adding to content buffer: "${t.length>20?t.substring(0,20)+"...":t}"`),e.contentBuffer+=t},getAndClearBuffer:()=>{const t=e.contentBuffer;return o.default.debug(`[AnthropicStateManager] Getting and clearing content buffer: "${t.length>20?t.substring(0,20)+"...":t}"`),e.contentBuffer="",e.isBuffering=!1,t},isInsideFence:()=>e.insideFence,setInsideFence:t=>{o.default.debug(`[AnthropicStateManager] Setting inside fence: ${t}`),e.insideFence=t},isPendingPrefix:()=>e.pendingPrefix,setPendingPrefix:t=>{o.default.debug(`[AnthropicStateManager] Setting pending prefix: ${t}`),e.pendingPrefix=t},addThinkingContent:t=>{o.default.debug(`[AnthropicStateManager] Adding thinking content: "${t.length>20?t.substring(0,20)+"...":t}"`),e.thinkingContent+=t},addTextContent:t=>{o.default.debug(`[AnthropicStateManager] Adding text content: "${t.length>20?t.substring(0,20)+"...":t}"`),e.textContent+=t},setThinkingSignature:t=>{o.default.debug(`[AnthropicStateManager] Setting thinking signature: "${t}"`),e.thinkingSignature=t},getThinkingContent:()=>e.thinkingContent,getTextContent:()=>e.textContent,getThinkingSignature:()=>e.thinkingSignature,reset:()=>{o.default.debug("[AnthropicStateManager] Resetting state"),e.current=void 0,e.insideFence=!1,e.tagBuf="",e.pendingPrefix=!0,e.isBuffering=!1,e.contentBuffer="",e.bufferedBlockId=void 0,e.thinkingContent="",e.textContent="",e.thinkingSignature=void 0}}};const o=n(r(9055))},6349:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationHistoryService=void 0;const a=r(3563),c=(r(1832),s(r(9055))),l=r(6297),d=r(269);let u=class{constructor(e,t){this.knex=e,this.dbDebugContextService=t}getContentPreview(e,t=50){if(null==e)return"null/undefined";if("string"==typeof e)return e.substring(0,t)+(e.length>t?"...":"");try{const r=JSON.stringify(e);return r.substring(0,t)+(r.length>t?"...":"")}catch(t){return`[Complex object: ${typeof e}]`}}async addMessage(e,t){if(!t.id)throw new Error("MessageInterchange must have an ID set by its creator");if(t.taskId=e,l.debugLogger.log(`[ConversationHistoryService] Adding message for task ${e}, role: ${t.role}, id: ${t.id}`),t.segments&&t.segments.length>0)for(let e=0;e<Math.min(t.segments.length,3);e++){const r=t.segments[e],n=this.getContentPreview(r.content);l.debugLogger.log(`[ConversationHistoryService] Segment ${e+1} type: ${r.type}, content: ${n}`)}try{return await this.dbDebugContextService.runWithContext({operationName:"ConversationHistoryService.addMessage",taskId:e},(async()=>{const r=JSON.stringify(t.segments);return await this.knex("eve_task_messages").insert({id:t.id,taskId:e,role:t.role,segments:r,providerId:t.providerId,providerMetadata:t.providerMetadata?JSON.stringify(t.providerMetadata):null,createdAt:t.createdAt,updatedAt:new Date}),l.debugLogger.log(`[ConversationHistoryService] Successfully added message with ID: ${t.id}`),t.id}))}catch(e){throw l.debugLogger.log(`[ConversationHistoryService] Error adding message: ${e.message}`),c.default.error(`[ConversationHistoryService] Error adding message: ${e.message}`,e.stack),new Error(`Failed to add message: ${e.message}`)}}async getHistory(e){l.debugLogger.log(`[ConversationHistoryService] Fetching history for task: ${e}`);try{return await this.dbDebugContextService.runWithContext({operationName:"ConversationHistoryService.getHistory",taskId:e},(async()=>{const t=await this.knex("eve_task_messages").where({taskId:e}).orderBy("id","asc");l.debugLogger.log(`[ConversationHistoryService] Retrieved ${t.length} messages for task ${e}`);const r=t.map((e=>({id:e.id,taskId:e.taskId,role:e.role,segments:JSON.parse(e.segments),providerId:e.providerId,providerMetadata:e.providerMetadata?JSON.parse(e.providerMetadata):void 0,createdAt:new Date(e.createdAt)})));if(r.length>0){const e=r.slice(-3);for(let t=0;t<e.length;t++){const n=e[t],o=r.length-e.length+t;if(l.debugLogger.log(`[ConversationHistoryService] Message ${o+1}/${r.length}: role=${n.role}, providerId=${n.providerId}`),n.segments&&n.segments.length>0)for(let e=0;e<Math.min(n.segments.length,2);e++){const t=n.segments[e],r=this.getContentPreview(t.content);l.debugLogger.log(`[ConversationHistoryService] Message ${o+1} segment ${e+1} type: ${t.type}, content: ${r}`)}}}else l.debugLogger.log(`[ConversationHistoryService] No history messages found for task ${e}`);return r}))}catch(e){throw l.debugLogger.log(`[ConversationHistoryService] Error retrieving message history: ${e.message}`),c.default.error(`[ConversationHistoryService] Error retrieving message history: ${e.message}`,e.stack),new Error(`Failed to retrieve message history: ${e.message}`)}}async getMessage(e){l.debugLogger.log(`[ConversationHistoryService] Fetching message with ID: ${e}`);try{return await this.dbDebugContextService.runWithContext({operationName:"ConversationHistoryService.getMessage",queryId:e},(async()=>{const t=await this.knex("eve_task_messages").where({id:e}).first();return t?(l.debugLogger.log(`[ConversationHistoryService] Retrieved message with ID ${e}`),{id:t.id,taskId:t.taskId,role:t.role,segments:JSON.parse(t.segments),providerId:t.providerId,providerMetadata:t.providerMetadata?JSON.parse(t.providerMetadata):void 0,createdAt:new Date(t.createdAt)}):(l.debugLogger.log(`[ConversationHistoryService] Message with ID ${e} not found`),null)}))}catch(t){throw l.debugLogger.log(`[ConversationHistoryService] Error retrieving message ${e}: ${t.message}`),c.default.error(`[ConversationHistoryService] Error retrieving message ${e}: ${t.message}`,t.stack),new Error(`Failed to retrieve message: ${t.message}`)}}async deleteTaskMessages(e){l.debugLogger.log(`[ConversationHistoryService] Deleting all messages for task ${e}`);try{await this.dbDebugContextService.runWithContext({operationName:"ConversationHistoryService.deleteTaskMessages",taskId:e},(async()=>{await this.knex("eve_task_messages").where({taskId:e}).delete(),l.debugLogger.log(`[ConversationHistoryService] Deleted all messages for task ${e}`)}))}catch(t){throw l.debugLogger.log(`[ConversationHistoryService] Error deleting messages for task ${e}: ${t.message}`),c.default.error(`[ConversationHistoryService] Error deleting messages for task ${e}: ${t.message}`,t.stack),new Error(`Failed to delete messages: ${t.message}`)}}async getMessagesForProvider(e,t){l.debugLogger.log(`[ConversationHistoryService] Fetching messages for task ${e} and provider ${t}`);try{return await this.dbDebugContextService.runWithContext({operationName:"ConversationHistoryService.getMessagesForProvider",taskId:e},(async()=>{const r=await this.knex("eve_task_messages").where({taskId:e,providerId:t}).orderBy("id","asc");return l.debugLogger.log(`[ConversationHistoryService] Retrieved ${r.length} messages for task ${e} and provider ${t}`),r.map((e=>({id:e.id,taskId:e.taskId,role:e.role,segments:JSON.parse(e.segments),providerId:e.providerId,providerMetadata:e.providerMetadata?JSON.parse(e.providerMetadata):void 0,createdAt:new Date(e.createdAt)})))}))}catch(e){throw l.debugLogger.log(`[ConversationHistoryService] Error retrieving messages for provider: ${e.message}`),c.default.error(`[ConversationHistoryService] Error retrieving messages for provider: ${e.message}`,e.stack),new Error(`Failed to retrieve messages for provider: ${e.message}`)}}};t.ConversationHistoryService=u,t.ConversationHistoryService=u=n([(0,a.Injectable)(),i(0,(0,a.Inject)("KNEX")),o("design:paramtypes",[Function,d.DbDebugContextService])],u)},6387:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentLoopOrchestrator=void 0;const c=r(3563),l=r(461),d=r(9100),u=a(r(9055)),f=r(6297),p=r(6550),h=r(6349),g=r(4624),m=r(7403),y=r(9581),v=r(9547),_=r(1280),w=r(5324),b=r(7485),k=r(7438),S=r(6897),R=r(5444),T=r(1623);let $=n=class{constructor(e,t,r,n,o,i,s,a,c){this.taskService=e,this.conversationHistoryService=t,this.eventEmitter=r,this.agentStateManager=n,this.contextTruncationHandler=o,this.fileContentOptimizer=i,this.llmStreamProcessorBlock=s,this.blockService=a,this.providerAdapterRegistry=c,this.setupEventListeners()}setupEventListeners(){this.eventEmitter.on(_.InternalEvents.TOOL_EXECUTION_COMPLETED,(async e=>{await this.handleToolExecutionCompleted(e.taskId,e.clientId,e.blockId,e.toolName,e.result,e.status)}))}async handleToolExecutionCompleted(e,t,r,o,i,s){u.default.info(`[${n.name}] Tool execution completed for tool ${o} with status ${s}`);const a=await this.taskService.getTask(e);if(a.status!==R.TaskStatus.USER_CANCELLED){if("rejected"===s)return await this.taskService.updateTask({taskId:e,status:R.TaskStatus.WAITING_FOR_INPUT,result:JSON.stringify({details:"Tool execution was rejected. Agent is waiting for your input."})}),void u.default.info(`[${n.name}] Task ${e} status set to ${R.TaskStatus.WAITING_FOR_INPUT} after tool rejection.`);"error"===s&&(await this.taskService.updateTask({taskId:e,status:R.TaskStatus.WAITING_FOR_INPUT,result:JSON.stringify({error:`Tool ${o} failed. Agent is waiting for input.`,details:i})}),u.default.info(`[${n.name}] Task ${e} status set to ${R.TaskStatus.WAITING_FOR_INPUT} after tool error.`));try{const r=a.mode||"act",n=await this.conversationHistoryService.getHistory(e);f.debugLogger.log(`[AgentLoopOrchestrator] Reloaded history after tool execution, message count: ${n.length}`),await this.runAgentLoop(e,n,t,r)}catch(t){u.default.error(`[${n.name}] Error handling tool execution completion for task ${e}: ${t.message}`),u.default.error(`[${n.name}] Stack trace: ${t.stack}`)}}else u.default.info(`[${n.name}] Task ${e} is cancelled, not continuing agent loop after tool execution`)}setTaskAborting(e,t){return this.agentStateManager.setTaskAborting(e,t)}isTaskAborting(e){return this.agentStateManager.isTaskAborting(e)}cleanupTask(e){this.agentStateManager.cleanupTask(e)}async runAgentLoop(e,t,r,o){f.debugLogger.log(`Starting agent loop for task ${e} with ${t.length} messages`),f.debugLogger.dumpObject("Current history",t);if((await this.taskService.getTask(e)).status===R.TaskStatus.USER_CANCELLED)return u.default.info(`[${n.name}] Task ${e} is cancelled, not running agent loop`),!1;let i,s=null;const a=(0,d.ulid)();if(this.isTaskAborting(e))return u.default.info(`[${n.name}] Task ${e} is being aborted, stopping agent loop`),!0;if(u.default.info(`[${n.name}] Running agent loop for task ${e} with ${t.length} messages in history`),u.default.info(`[${n.name}] Current mode: ${o}`),t.length>0){const e=t.slice(-3);e.forEach(((r,o)=>{const i=t.length-e.length+o;u.default.info(`[${n.name}] History[${i}] role: ${r.role}`);const s=r.segments.find((e=>"text"===e.type));if(s){const e=s.content.substring(0,100);u.default.info(`[${n.name}] History[${i}] content (first 100 chars): ${e}...`)}r.segments.find((e=>"thinking"===e.type))&&u.default.info(`[${n.name}] History[${i}] has thinking segment`)}))}else u.default.warn(`[${n.name}] No messages in history for task ${e}`);try{u.default.info(`[${n.name}] Running agent loop for task ${e}, mode: ${o}`),await this.taskService.updateTask({taskId:e,status:R.TaskStatus.IN_PROGRESS}),u.default.info(`[${n.name}] Task ${e} status set to ${R.TaskStatus.IN_PROGRESS}`);const c=this.agentStateManager.getOrCreateAbortSignal(e);f.debugLogger.log(`Using abort signal for task ${e}, aborted state: ${c.aborted}`);const l=this.fileContentOptimizer.optimizeFileContent(t);if(u.default.info(`[${n.name}] Optimized conversation history for task ${e}`),f.debugLogger.log(`[AgentLoopOrchestrator] Optimized conversation history for task ${e}, message count: ${l.length}`),l.length>0){const e=l[l.length-1];f.debugLogger.log(`[AgentLoopOrchestrator] Last message role: ${e.role}`);const t=e.segments.find((e=>"text"===e.type));if(t){const r=t.content.substring(0,50)+(t.content.length>50?"...":"");if(f.debugLogger.log(`[AgentLoopOrchestrator] Last message content: ${r}`),"assistant"===e.role){const e=t.content.includes("<thinking>");f.debugLogger.log(`[AgentLoopOrchestrator] Last assistant message has thinking block: ${e}`)}}e.segments.find((e=>"thinking"===e.type))&&f.debugLogger.log("[AgentLoopOrchestrator] Last message has thinking segment")}const d=l.length>0?l[l.length-1]:null;if(d&&"user"===d.role){d.segments.find((e=>"text"===e.type))&&(await this.blockService.createBlock({blockId:d.id,taskId:e,role:"user",blockType:"request",status:"generating",content:""}),u.default.info(`[${n.name}] Created request block ${d.id} for task ${e}`))}f.debugLogger.log(`Calling executeConversationTurn for task ${e}`);const p=await(0,v.retryWithContextTruncation)((()=>this.taskService.executeConversationTurn(e,l,o,c)),(async()=>{const{truncatedHistory:t,removedCount:n}=this.contextTruncationHandler.truncateWithNextStrategy(e,l,r),i=t;return this.taskService.executeConversationTurn(e,i,o)}),{logger:u.default,onRetry:(t,n,o)=>{const i=(0,y.toEveAgentError)(t);this.eventEmitter.emit(_.InternalEvents.TOOL_ERROR,{clientId:r,taskId:e,error:i.toUserMessage(),type:"api_error",code:i.code,context:{attempt:n,willRetryIn:o}})}});this.agentStateManager.resetMistakeCount(e);const h=await this.llmStreamProcessorBlock.processStream(p,e,r,a);if(h.messageInterchange){i=h.messageInterchange;try{await this.conversationHistoryService.addMessage(e,i),u.default.info(`[${n.name}] Saved assistant message ${i.id} for task ${e}`)}catch(t){u.default.error(`[${n.name}] Error saving assistant message for task ${e}: ${t.message}\n${t.stack}`),this.eventEmitter.emit(_.InternalEvents.TOOL_ERROR,{clientId:r,taskId:e,error:`Error saving conversation history: ${t.message}`,type:"database_error"})}}if(h.streamError)throw s=h.streamError,s;const g=await this.blockService.getLastBlockForTask(e);if(g&&"tool_call"===g.blockType){if(u.default.info(`[${n.name}] Detected tool_call block ${g.blockId} for task ${e}, status: ${g.status}, tool: ${g.tagName}`),"finished"===g.status&&!T.RESPONSE_ONLY_TOOLS.includes(g.tagName))return u.default.info(`[${n.name}] Emitting TOOL_CALL_DETECTED for regular tool ${g.tagName}`),this.eventEmitter.emit(_.InternalEvents.TOOL_CALL_DETECTED,{clientId:r,taskId:e,blockId:g.blockId,toolName:g.tagName}),!1;T.RESPONSE_ONLY_TOOLS.includes(g.tagName)?"completed"!==g.status?(u.default.info(`[${n.name}] Updating response-only tool ${g.tagName} block ${g.blockId} status to completed.`),await this.blockService.updateBlock(g.blockId,{status:"completed"})):u.default.info(`[${n.name}] Response-only tool ${g.tagName} block ${g.blockId} already completed.`):u.default.info(`[${n.name}] Tool call block ${g.blockId} has status ${g.status}, not emitting TOOL_CALL_DETECTED.`)}}catch(t){s=t,u.default.error(`[${n.name}] Error in agent loop for task ${e}: ${t.message}\n${t.stack}`);const o=t instanceof y.EveAgentError?t:(0,y.toEveAgentError)(t);return this.eventEmitter.emit(_.InternalEvents.TOOL_ERROR,{clientId:r,taskId:e,error:o.toUserMessage(),type:"task_error",code:o.code,context:o.context}),await this.taskService.updateTask({taskId:e,status:R.TaskStatus.WAITING_FOR_INPUT,result:JSON.stringify({error:o.toUserMessage(),code:o.code})}),!1}u.default.info(`[${n.name}] No tool used for task ${e}. Checking current status before updating.`);return(await this.taskService.getTask(e)).status!==R.TaskStatus.USER_CANCELLED?(u.default.info(`[${n.name}] Task ${e} is not cancelled. Setting status to waiting_for_input.`),await this.taskService.updateTask({taskId:e,status:R.TaskStatus.WAITING_FOR_INPUT,result:JSON.stringify({details:"Agent turn complete. Waiting for your input."})})):u.default.info(`[${n.name}] Task ${e} is already cancelled. Preserving USER_CANCELLED status.`),!1}};t.AgentLoopOrchestrator=$,t.AgentLoopOrchestrator=$=n=o([(0,c.Injectable)(),s(0,(0,c.Inject)((0,c.forwardRef)((()=>p.TaskService)))),i("design:paramtypes",[p.TaskService,h.ConversationHistoryService,l.EventEmitter2,b.AgentStateManager,k.ContextTruncationHandler,m.FileContentOptimizerService,S.LlmStreamProcessorBlock,w.BlockService,g.ProviderAdapterRegistry])],$)},6426:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.generateSummaryTree=m,t.generateAdaptiveTree=function(e,t=[]){if(!c.existsSync(e)||!c.statSync(e).isDirectory())return`Error: ${e} is not a valid directory.`;const r=l.join(e,".eveignore");c.existsSync(r)||(!function(e){const t=["# Binary files","*.jpg","*.jpeg","*.png","*.gif","*.ico","*.svg","*.woff","*.woff2","*.ttf","*.eot","*.otf","*.pdf","*.zip","*.tar","*.gz","*.rar","*.7z","*.exe","*.dll","*.so","*.dylib","","# Build and dependency directories","node_modules/","dist/","build/","bin/","target/",".next/",".nuxt/",".output/","coverage/",".nyc_output/",".cache/",".parcel-cache/",".yarn/","","# IDE and editor files",".idea/",".eve/",".hldk/",".vscode/","*.swp","*.swo","*.swn","*.bak","","# Logs and databases","*.log","*.sqlite","*.sqlite3","*.db","logs/","","# Environment and config files",".env",".env.*","!.env.example",".DS_Store","Thumbs.db"].join("\n"),r=l.join(e,".eveignore");c.writeFileSync(r,t),u.default.info("Created default .eveignore file with common ignore patterns")}(e),t=[]);const n=_(e,t);if(n.length<=h)return n;u.default.warn("Large file tree (%d chars) detected for workspace dir: %s",n.length,e),u.default.warn("A .eveignore file has been created/exists in the root of the repository. You can modify it to control which files are included in the tree sent to the agent");let o,i=f;for(;i>=p;){if(o=m(e,t,i),o.length<=h)return u.default.info("Automatically limited file tree to %d items per dir resulting in a tree of %d chars",i,o.length),o;i-=10}return m(e,t,p)},t.generateTree=_,t.generateTreeRecursive=b;const c=s(r(9896)),l=s(r(6928)),d=a(r(526)),u=a(r(9055)),f=50,p=5,h=3e4,g=3;function m(e,t=[],r=p){if(!c.existsSync(e)||!c.statSync(e).isDirectory())return`Error: ${e} is not a valid directory.`;return v(e,w(e,t),e,"",0,r).trimStart()}function y(e,t,r){const n=c.readdirSync(e).sort(),o={totalFiles:0,totalFolders:0,fileTypes:{}};return n.forEach((n=>{const i=l.join(e,n),s=l.relative(r,i);if(t.ignores(s))return;if(c.statSync(i).isDirectory()){o.totalFolders++;const e=y(i,t,r);o.totalFiles+=e.totalFiles,o.totalFolders+=e.totalFolders,Object.entries(e.fileTypes).forEach((([e,t])=>{o.fileTypes[e]=(o.fileTypes[e]||0)+t}))}else{o.totalFiles++;const e=l.extname(n)||"no-extension";o.fileTypes[e]=(o.fileTypes[e]||0)+1}})),o}function v(e,t,r,n="",o=0,i=p){let s=[];const a=c.readdirSync(e).sort();let d=0,u=0;a.forEach((n=>{const o=l.join(e,n),i=l.relative(r,o);t.ignores(i)||(c.statSync(o).isDirectory()?u++:d++)}));if(o>=g&&d+u>=i){const o=y(e,t,r);s.push(`${n}├── Summary: ${o.totalFiles} files, ${o.totalFolders} folders`),Object.entries(o.fileTypes).sort().forEach((([e,t],r,o)=>{const i=r===o.length-1?"└── ":"├── ",a="no-extension"===e?"files with no extension":`${e} files`;s.push(`${n}│   ${i}${t} ${a}`)}))}else{const d={};a.forEach(((u,f)=>{const p=l.join(e,u),h=l.relative(r,p);if(t.ignores(h))return;const g=c.statSync(p),m=f===a.length-1;if(g.isDirectory())s.push(`${n}${m?"└── ":"├── "}${u}`),s.push(v(p,t,r,n+(m?"    ":"│   "),o+1,i));else{const e=l.extname(u)||"no-extension";d[e]=(d[e]||0)+1,s.push(`${n}${m?"└── ":"├── "}${u}`)}}))}return s.join("\n")}function _(e,t=[]){if(!c.existsSync(e)||!c.statSync(e).isDirectory())return`Error: ${e} is not a valid directory.`;return b(e,w(e,t),e).trimStart()}function w(e,t){const r=(0,d.default)();r.add([".git",".eve",...t]);return[".gitignore",".aiderignore",".clineignore",".cursorignore",".hldkignore",".eveignore"].forEach((t=>{const n=l.join(e,t);if(c.existsSync(n)){const e=c.readFileSync(n,"utf-8");r.add(e)}})),r}function b(e,t,r,n="",o=f){let i=[];const s=c.readdirSync(e).sort();if(s.length>o){const o=y(e,t,r);return i.push(`${n}Summary: ${o.totalFiles} files, ${o.totalFolders} folders`),Object.entries(o.fileTypes).sort().forEach((([e,t],r,o)=>{const s=r===o.length-1?"└── ":"├── ",a="no-extension"===e?"files with no extension":`${e} files`;i.push(`${n}${s}${t} ${a}`)})),i.join("\n")}return s.forEach(((a,d)=>{const u=l.join(e,a),f=l.relative(r,u);if(t.ignores(f))return;const p=d===s.length-1;i.push(`${n}${p?"└── ":"├── "}${a}`),c.statSync(u).isDirectory()&&i.push(b(u,t,r,n+(p?"    ":"│   "),o))})),i.join("\n")}},6500:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.standardRules=void 0,t.mapRuleToDbRecord=function(e){return{id:e.id,name:e.name,content:e.content,source_type:e.sourceType,is_editable:e.isEditable,is_deletable:e.isDeletable,created_at:new Date,updated_at:new Date}};const n=r(1145);t.standardRules=[{id:"eve-standard-00-build-after-changes",name:"Build After Changes",content:"# Build After Changes\n\nAfter making code changes you MUST run an appropriate command to verify that your changes are correct and the project still builds or runs as expected.\n\n1.  Determine the appropriate verification command based on the changes made and the project type (e.g., `pnpm run build`, `tsc`, `python setup.py build`, `./gradlew build`, a linter command, etc.).\n2.  Use the `execute_command` tool to run this verification command.\n3.  Ensure the command executes successfully. If there are errors, address them before proceeding.\n4.  This step helps catch issues early and ensures the codebase remains in a healthy state.",sourceType:n.RuleSource.EVE,isEditable:!1,isDeletable:!1},{id:"eve-standard-01-test-after-changes",name:"Test After Changes",content:"# Test After Changes\n\nAfter making code changes you MUST run appropriate unit tests to verify the correctness of your changes before committing them or updating the memory bank.\n\n1.  Determine the appropriate test command based on the changes made and the project type (e.g., `pnpm test`, `python -m unittest discover`, `./gradlew test`, `pytest`, etc.).\n2.  Use the `execute_command` tool to run this test command.\n3.  Ensure all tests pass. If there are failing tests, address them before proceeding.\n4.  This step is crucial for maintaining code quality and preventing regressions.",sourceType:n.RuleSource.EVE,isEditable:!1,isDeletable:!1},{id:"eve-standard-02-commit-changes-to-git",name:"Commit Changes to Git",content:'# Git Commit Practice\n\nBefore calling the attempt_completion tool (and after any memory updates) you MUST commit your changes to git:\n\n1. Use the command_line tool to stage and commit changes\n2. Stage all changes with `git add -A`\n3. Create a meaningful commit message that describes the changes\n4. Use the format: `git commit -am "suitable message"`\n5. Ensure commit messages are descriptive and follow project conventions\n6. Group related changes into a single commit\n7. Keep commits focused on a single logical change\n8. Verify the changes before committing\n9. Consider using conventional commit format if the project follows it',sourceType:n.RuleSource.EVE,isEditable:!1,isDeletable:!1},{id:"eve-standard-03-memory-bank",name:"Standard Memory Bank",content:"# Eve's Memory Bank\n\nI am Eve, an expert software engineer with a unique characteristic: my memory resets completely between sessions. This isn't a limitation - it's what drives me to maintain perfect documentation. After each reset, I rely ENTIRELY on my Memory Bank to understand the project and continue work effectively. I MUST read ALL memory bank files at the start of EVERY task - this is not optional.\n\n## Memory Bank Structure\n\nThe Memory Bank consists of core files and optional context files, all in Markdown format. Files build upon each other in a clear hierarchy:\n\nflowchart TD\n    PB[projectbrief.md] --\x3e PC[productContext.md]\n    PB --\x3e SP[systemPatterns.md]\n    PB --\x3e TC[techContext.md]\n\n    PC --\x3e AC[activeContext.md]\n    SP --\x3e AC\n    TC --\x3e AC\n\n    AC --\x3e P[progress.md]\n\n### Core Files (Required)\n1. `projectbrief.md`\n   - Foundation document that shapes all other files\n   - Created at project start if it doesn't exist\n   - Defines core requirements and goals\n   - Source of truth for project scope\n\n2. `productContext.md`\n   - Why this project exists\n   - Problems it solves\n   - How it should work\n   - User experience goals\n\n3. `activeContext.md`\n   - Current work focus\n   - Recent changes\n   - Next steps\n   - Active decisions and considerations\n   - Important patterns and preferences\n   - Learnings and project insights\n\n4. `systemPatterns.md`\n   - System architecture\n   - Key technical decisions\n   - Design patterns in use\n   - Component relationships\n   - Critical implementation paths\n\n5. `techContext.md`\n   - Technologies used\n   - Development setup\n   - Technical constraints\n   - Dependencies\n   - Tool usage patterns\n\n6. `progress.md`\n   - What works\n   - What's left to build\n   - Current status\n   - Known issues\n   - Evolution of project decisions\n\n### Additional Context\nCreate additional files/folders within memory-bank/ when they help organize:\n- Complex feature documentation\n- Integration specifications\n- API documentation\n- Testing strategies\n- Deployment procedures\n\n## Core Workflows\n\n### Plan Mode\nflowchart TD\n    Start[Start] --\x3e ReadFiles[Read Memory Bank]\n    ReadFiles --\x3e CheckFiles{Files Complete?}\n\n    CheckFiles --\x3e|No| Plan[Create Plan]\n    Plan --\x3e Document[Document in Chat]\n\n    CheckFiles --\x3e|Yes| Verify[Verify Context]\n    Verify --\x3e Strategy[Develop Strategy]\n    Strategy --\x3e Present[Present Approach]\n\n### Act Mode\nflowchart TD\n    Start[Start] --\x3e Context[Check Memory Bank]\n    Context --\x3e Update[Update Documentation]\n    Update --\x3e Execute[Execute Task]\n    Execute --\x3e Document[Document Changes]\n\n## Documentation Updates\n\nMemory Bank updates occur when:\n1. Discovering new project patterns\n2. After implementing significant changes\n3. When user requests with **update memory bank** (MUST review ALL files)\n4. When context needs clarification\n\nflowchart TD\n    Start[Update Process]\n\n    subgraph Process\n        P1[Review ALL Files]\n        P2[Document Current State]\n        P3[Clarify Next Steps]\n        P4[Document Insights & Patterns]\n\n        P1 --\x3e P2 --\x3e P3 --\x3e P4\n    end\n\n    Start --\x3e Process\n\nNote: When triggered by **update memory bank**, I MUST review every memory bank file, even if some don't require updates. Focus particularly on activeContext.md and progress.md as they track current state.\n\nREMEMBER: After every memory reset, I begin completely fresh. The Memory Bank is my only link to previous work. It must be maintained with precision and clarity, as my effectiveness depends entirely on its accuracy.",sourceType:n.RuleSource.EVE,isEditable:!1,isDeletable:!1},{id:"eve-standard-04-test-driven-development",name:"Test-Driven Development",content:"# Test-Driven Development\n\nAlways follow Test-Driven Development (TDD) principles:\n\n1. Write a failing unit test before implementing any fix or feature\n2. Ensure the test clearly demonstrates the expected behavior\n3. Run the test to confirm it fails for the expected reason\n4. Only then implement the minimum code needed to make the test pass\n5. Refactor the code while keeping tests passing\n6. Follow the Red-Green-Refactor cycle\n7. Keep tests focused and isolated\n8. Test edge cases and error conditions\n9. Maintain high test coverage for critical code paths\n10. Use descriptive test names that explain the behavior being tested",sourceType:n.RuleSource.EVE,isEditable:!1,isDeletable:!1}]},6511:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToolCallingScheme=void 0;t.ToolCallingScheme=class{}},6540:e=>{"use strict";e.exports=require("tree-sitter-cpp")},6550:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TaskService=void 0;const f=r(3563),p=r(9100),h=u(r(9055)),g=r(6297),m=c(r(857)),y=r(461),v=r(2776),_=r(269),w=r(5369),b=r(9102),k=r(8010),S=r(2398),R=r(6292),T=r(8615),$=r(538),O=r(6387),P=r(9581),E=r(9547),I=r(8474),C=r(3563),A=r(5444),M=r(1280);let D=o=class{constructor(e,t,r,n,o,i,s,a,c,l,d,u){this.appDataSource=e,this.apiHandlerFactory=t,this.configService=r,this.toolExecutorService=n,this.toolProvider=o,this.mainWorkspaceService=i,this.personaRegistry=s,this.promptBuilderService=a,this.homeService=c,this.eventEmitter=l,this.dbDebugContextService=d,this.agentLoopOrchestrator=u}async createTask(e){const t=(0,p.ulid)();try{return await this.dbDebugContextService.runWithContext({operationName:"TaskService.createTask",taskId:t},(async()=>{const r=(await this.homeService.getUserData()).userId;if(!r)throw new Error("Could not determine authenticated user ID.");let n=null;if(e.workspaceName){const t=await this.mainWorkspaceService.findOne(e.workspaceName);if(!t)throw new C.NotFoundException(`Workspace with name ${e.workspaceName} not found`);n=t.name,h.default.info(`[${o.name}] Found workspace name ${n}`)}return await this.appDataSource.knex("eve_tasks").insert({taskId:t,userId:r,workspaceName:n,prompt:"",personaId:e.personaId||"software-engineer",status:A.TaskStatus.WAITING_FOR_INPUT,totalInputTokens:0,totalOutputTokens:0,createdAt:this.appDataSource.knex.fn.now(),updatedAt:this.appDataSource.knex.fn.now()}),h.default.info(`[${o.name}] Created task ${t} for user ${r}`),t}))}catch(e){throw h.default.error(`[${o.name}] Error creating task: ${e.message}\n${e.stack}`),new Error(`Failed to create task: ${e.message}`)}}async createTaskStep(e){try{const[t]=await this.appDataSource.knex("eve_task_steps").insert({taskId:e.taskId,stepNumber:e.stepNumber,toolName:e.toolName,toolInput:e.toolInput,status:"pending",createdAt:this.appDataSource.knex.fn.now(),updatedAt:this.appDataSource.knex.fn.now()}).returning("id");return h.default.info(`[${o.name}] Created task step ${t} for task ${e.taskId}`),t}catch(e){throw h.default.error(`[${o.name}] Error creating task step: ${e.message}\n${e.stack}`),new Error(`Failed to create task step: ${e.message}`)}}async updateTaskStep(e){try{await this.appDataSource.knex("eve_task_steps").where({taskId:e.taskId,stepNumber:e.stepNumber}).update({toolOutput:e.toolOutput,status:e.status,commitHash:e.commitHash,completedAt:this.appDataSource.knex.fn.now(),updatedAt:this.appDataSource.knex.fn.now()}),h.default.info(`[${o.name}] Updated task step ${e.stepNumber} for task ${e.taskId}`)}catch(e){throw h.default.error(`[${o.name}] Error updating task step: ${e.message}\n${e.stack}`),new Error(`Failed to update task step: ${e.message}`)}}async updateTask(e){g.debugLogger.log(`[${o.name}] Updating task ${e.taskId}`),g.debugLogger.dumpObject("UpdateTask options",e);try{await this.dbDebugContextService.runWithContext({operationName:"TaskService.updateTask",taskId:e.taskId},(async()=>{const t={updatedAt:this.appDataSource.knex.fn.now()};e.status&&(t.status=e.status),void 0!==e.result&&(t.result=e.result),e.mode&&(t.mode=e.mode,h.default.info(`[${o.name}] Updating task ${e.taskId} mode to ${e.mode}`)),e.originalPrompt&&(t.originalPrompt=e.originalPrompt,h.default.info(`[${o.name}] Setting originalPrompt for task ${e.taskId}`)),await this.appDataSource.knex("eve_tasks").where({taskId:e.taskId}).update(t),e.status&&(h.default.info(`[${o.name}] Updated task ${e.taskId} status to ${e.status}`),this.eventEmitter.emit(M.InternalEvents.TASK_UPDATED,{taskId:e.taskId,clientId:null,status:e.status,data:{result:e.result}}),g.debugLogger.log(`[${o.name}] Emitted ${M.InternalEvents.TASK_UPDATED} event for task ${e.taskId} with status ${e.status}`))}))}catch(t){throw h.default.error(`[${o.name}] Error updating task ${e.taskId}: ${t.message}\n${t.stack}`),new Error(`Failed to update task ${e.taskId}: ${t.message}`)}}async getTask(e){try{return await this.dbDebugContextService.runWithContext({operationName:"TaskService.getTask",taskId:e},(async()=>{const t=await this.appDataSource.knex("eve_tasks").where({taskId:e}).first();if(!t)throw new Error(`Task ${e} not found`);return t}))}catch(e){throw h.default.error(`[${o.name}] Error getting task: ${e.message}\n${e.stack}`),new Error(`Failed to get task: ${e.message}`)}}async getTaskSteps(e){try{return await this.appDataSource.knex("eve_task_steps").where({taskId:e}).orderBy("stepNumber","asc")}catch(e){throw h.default.error(`[${o.name}] Error getting task steps: ${e.message}\n${e.stack}`),new Error(`Failed to get task steps: ${e.message}`)}}async getUserTasks(e,t=10,r=0){try{return await this.appDataSource.knex("eve_tasks").where({userId:e}).orderBy("createdAt","desc").limit(t).offset(r)}catch(e){throw h.default.error(`[${o.name}] Error getting user tasks: ${e.message}\n${e.stack}`),new Error(`Failed to get user tasks: ${e.message}`)}}async getNextStepNumber(e){try{const t=await this.appDataSource.knex("eve_task_steps").where({taskId:e}).max("stepNumber as maxStep").first();return(t?.maxStep||0)+1}catch(e){throw h.default.error(`[${o.name}] Error getting next step number: ${e.message}\n${e.stack}`),new Error(`Failed to get next step number: ${e.message}`)}}async executeConversationTurn(e,t,r,n){try{h.default.debug(`[${o.name}] Executing conversation turn for task ${e} in ${r} mode with ${t.length} messages`);const i=await this.getTask(e);let s;h.default.debug(`[${o.name}] Task details: ${JSON.stringify({id:i.taskId,userId:i.userId,workspaceName:i.workspaceName,personaId:i.personaId,status:i.status})}`);const a=i.workspaceName;if(!a)throw new Error(`Task ${e} has no associated workspace name.`);{const t=await this.mainWorkspaceService.findOne(a);if(!t)throw new C.NotFoundException(`Workspace '${a}' not found when executing conversation turn for task ${e}`);s=t.repoBaseDir}h.default.debug(`[${o.name}] Working directory: ${s}`);const c=await this.homeService.getUserData();h.default.debug(`[${o.name}] User data: ${JSON.stringify({userId:i.userId,email:c.email})}`);const l={workingDir:s,workspaceName:a,user:{userId:i.userId,email:c.email},osInfo:{platform:m.platform(),release:m.release(),homeDir:m.homedir(),shell:process.env.SHELL||"/bin/bash"},currentMode:r,currentTime:(new Date).toISOString()};h.default.debug(`[${o.name}] Created system context with mode: ${r}`);const d=this.personaRegistry.getPersona(i.personaId),u=d.getToolNames(),f=this.toolProvider.getTools(u,l),p=await this.promptBuilderService.buildPersonaSystemPrompt(d,f,l);if(h.default.debug(`[${o.name}] Built system prompt with length: ${p.length} characters`),"true"===process.env.DEBUG_LOG_FULL_SYSTEM_PROMPT)h.default.debug(`[${o.name}] Full System Prompt:\n${p}`);else{const e=p.substring(0,200),t=p.substring(p.length-200);h.default.debug(`[${o.name}] System prompt start: ${e}...`),h.default.debug(`[${o.name}] System prompt end: ...${t}`)}const y=await this.configService.assembleFinalConfiguration(i.userId,r);h.default.debug(`[${o.name}] Assembled configuration for mode ${r}: ${JSON.stringify({providerId:y.providerId,modelId:y.modelId,hasApiKey:!!y.apiKey,hasBaseUrl:!!y.baseUrl,thinkingTokens:y.thinkingTokens})}`),g.debugLogger.dumpObject("[TaskService] Final Assembled Configuration:",y);const v={providerName:y.providerId,model:y.modelId,baseUrl:y.baseUrl,apiKey:y.apiKey,thinkingTokens:y.thinkingTokens};h.default.debug(`[${o.name}] Using API config for mode: ${r}`);const _=await this.apiHandlerFactory.buildApiHandler(v);return h.default.debug(`[${o.name}] Using ${t.length} messages for provider ${y.providerId}`),await(0,E.retryApiOperation)((async()=>{try{if(h.default.debug(`[${o.name}] Calling API handler generateResponse with ${t.length} messages`),t.length>0){const e=t[t.length-1];if(h.default.debug(`[${o.name}] Last message role: ${e.role}`),e.segments&&e.segments.length>0){const t=e.segments[0];h.default.debug(`[${o.name}] Last message first segment type: ${t.type}`),h.default.debug(`[${o.name}] Last message first segment content (first 100 chars): ${t.content.substring(0,100)}...`)}else h.default.warn(`[${o.name}] Last message has no segments`);e.providerMetadata&&h.default.debug(`[${o.name}] Last message has provider metadata for ${e.providerId}`)}else h.default.warn(`[${o.name}] No messages provided to API handler for task ${e}`);return _.generateResponse(p,t,e,n)}catch(t){const r=(0,P.toEveAgentError)(t);throw h.default.error(`[${o.name}] API error during conversation turn for task ${e}: ${r.code} - ${r.message}`,{taskId:e,errorCode:r.code,errorContext:r.context,retriable:r.retriable}),r}}),{maxRetries:3,initialDelayMs:1e3,maxDelayMs:1e4,logger:h.default,onRetry:(t,r,n)=>{const i=(0,P.toEveAgentError)(t);h.default.warn(`[${o.name}] Retrying API call for task ${e} after error: ${i.code} (attempt ${r}, delay: ${n}ms)`)}})}catch(t){const r=(0,P.toEveAgentError)(t);throw h.default.error(`[${o.name}] Failed to execute conversation turn for task ${e}: ${r.code} - ${r.message}`,{taskId:e,errorDetails:r.toJSON()}),r}}};t.TaskService=D,t.TaskService=D=o=a([(0,f.Injectable)(),d(11,(0,f.Inject)((0,f.forwardRef)((()=>O.AgentLoopOrchestrator)))),l("design:paramtypes",[v.AppDataSource,w.ApiHandlerFactory,b.EveConfigService,k.ToolExecutorService,S.ToolProvider,I.WorkspaceService,R.PersonaRegistry,T.PromptBuilderService,$.HomeService,y.EventEmitter2,_.DbDebugContextService,O.AgentLoopOrchestrator])],D)},6552:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetModule=void 0;const o=r(3563),i=r(376),s=r(2251),a=r(8077),c=r(7184),l=r(6932),d=r(8460),u=r(6696),f=r(7967);let p=class{};t.DatasetModule=p,t.DatasetModule=p=n([(0,o.Module)({imports:[i.DataSourceModule,f.ConfigModule],controllers:[s.DatasetController],providers:[a.DatasetService,c.DatasetRepository,l.DatasetDocumentRepository,d.DatasetIndexingService,u.DatasetRetrievalService],exports:[a.DatasetService,u.DatasetRetrievalService]})],p)},6566:e=>{"use strict";e.exports=require("xml2js")},6595:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TaskEventHandler=void 0;const a=r(3563),c=s(r(9055)),l=r(6297),d=r(461),u=r(6550),f=r(6963),p=r(1280),h=r(5444);let g=n=class{constructor(e,t,r){this.taskService=e,this.agentLoopOrchestrator=t,this.eventEmitter=r}async handleCreateTask(e,t){c.default.info(`[${n.name}] Processing createTask message from client: ${t.id}`);try{const r=await this.taskService.createTask(e);t.join(r),c.default.info(`[${n.name}] Client ${t.id} joined room ${r}`),this.eventEmitter.emit(p.InternalEvents.TASK_CREATED,{clientId:t.id,taskId:r,status:h.TaskStatus.WAITING_FOR_INPUT,data:{taskId:r}})}catch(e){c.default.error(`[${n.name}] Error creating task: ${e.message}\n${e.stack}`),this.eventEmitter.emit(p.InternalEvents.TOOL_ERROR,{clientId:t.id,taskId:"unknown",error:e.message,type:"task_error",context:{source:"createTask"}})}}async handleCreateTaskStep(e,t){c.default.info(`[${n.name}] Processing createTaskStep message from client: ${t.id}`);try{const t=await this.taskService.createTaskStep(e);c.default.info(`[${n.name}] Created task step ${t} for task ${e.taskId}. Task status remains unchanged.`)}catch(r){c.default.error(`[${n.name}] Error creating task step: ${r.message}\n${r.stack}`),this.eventEmitter.emit(p.InternalEvents.TOOL_ERROR,{clientId:t.id,taskId:e.taskId,error:r.message,type:"task_error",context:{source:"createTaskStep"}})}}async handleUpdateTaskStep(e,t){c.default.info(`[${n.name}] Processing updateTaskStep message from client: ${t.id}`);try{await this.taskService.updateTaskStep(e),c.default.info(`[${n.name}] Updated task step ${e.stepNumber} for task ${e.taskId}. Task status remains unchanged.`)}catch(r){c.default.error(`[${n.name}] Error updating task step: ${r.message}\n${r.stack}`),this.eventEmitter.emit(p.InternalEvents.TOOL_ERROR,{clientId:t.id,taskId:e.taskId,error:r.message,type:"task_error",context:{source:"updateTaskStep"}})}}async handleUpdateTask(e,t){c.default.warn(`[${n.name}] handleUpdateTask called directly. This might be deprecated. Task status should be managed by AgentLoopOrchestrator.`),c.default.info(`[${n.name}] Processing updateTask message from client: ${t.id}`);try{await this.taskService.updateTask(e),this.eventEmitter.emit(p.InternalEvents.TASK_UPDATED,{clientId:t.id,taskId:e.taskId,status:e.status,data:{result:e.result}})}catch(r){c.default.error(`[${n.name}] Error updating task: ${r.message}\n${r.stack}`),this.eventEmitter.emit(p.InternalEvents.TOOL_ERROR,{clientId:t.id,taskId:e.taskId,error:r.message,type:"task_error",context:{source:"updateTask"}})}}async handleCancelTask(e,t){c.default.info(`[${n.name}] Processing cancelTask message for task ${e.taskId} from client ${t.id}`),c.default.info(`[${n.name}] Cancellation reason: ${e.reason||"No reason provided"}`),l.debugLogger.log(`Received cancelTask for task ${e.taskId} from client ${t.id}`),l.debugLogger.dumpObject("CancelTask payload",e),l.debugLogger.log(`Setting task ${e.taskId} to aborting state`);const r=this.agentLoopOrchestrator.setTaskAborting(e.taskId,!0);r?l.debugLogger.log(`AbortSignal created for task ${e.taskId}, aborted state: ${r.aborted}`):l.debugLogger.log(`No AbortSignal returned for task ${e.taskId}`),l.debugLogger.log(`Using block-based tool call handling for task ${e.taskId}`);try{l.debugLogger.log(`[TaskService] Updating task ${e.taskId} with status USER_CANCELLED due to cancellation`),l.debugLogger.dumpObject("UpdateTask options",{taskId:e.taskId,status:h.TaskStatus.USER_CANCELLED,result:JSON.stringify({details:e.reason||"Task cancelled by user"})}),await this.taskService.updateTask({taskId:e.taskId,status:h.TaskStatus.USER_CANCELLED,result:JSON.stringify({details:e.reason||"Task cancelled by user"})}),l.debugLogger.log(`[TaskService] Emitted agent.task.updated event for task ${e.taskId} with status USER_CANCELLED`),l.debugLogger.log(`Sending ${p.NotificationEvents.TASK_STATUS_UPDATED} event to room ${e.taskId}`),l.debugLogger.dumpObject("TaskStatusUpdated payload",{clientId:t.id,taskId:e.taskId,status:h.TaskStatus.USER_CANCELLED,data:{reason:e.reason||"Task cancelled by user"}}),this.eventEmitter.emit(p.InternalEvents.TASK_UPDATED,{clientId:t.id,taskId:e.taskId,status:h.TaskStatus.USER_CANCELLED,data:{reason:e.reason||"Task cancelled by user"}}),c.default.info(`[${n.name}] Task ${e.taskId} cancelled successfully`),l.debugLogger.log(`Task ${e.taskId} cancelled successfully`)}catch(r){l.debugLogger.log(`Error updating task status for cancelled task ${e.taskId}: ${r.message}`),c.default.error(`[${n.name}] Error updating task status for cancelled task ${e.taskId}: ${r.message}\n${r.stack}`),this.eventEmitter.emit(p.InternalEvents.TASK_UPDATED,{clientId:t.id,taskId:e.taskId,status:h.TaskStatus.USER_CANCELLED,data:{reason:"Task cancelled, but failed to update task status in DB"}}),this.eventEmitter.emit(p.InternalEvents.TOOL_ERROR,{clientId:t.id,taskId:e.taskId,error:r.message,type:"task_error",context:{source:"cancelTask"}})}l.debugLogger.log(`Cleaning up resources for task ${e.taskId}`),this.agentLoopOrchestrator.cleanupTask(e.taskId),l.debugLogger.log(`Resources cleaned up for task ${e.taskId}`)}};t.TaskEventHandler=g,t.TaskEventHandler=g=n=o([(0,a.Injectable)(),i("design:paramtypes",[u.TaskService,f.AgentLoopOrchestrator,d.EventEmitter2])],g)},6610:e=>{"use strict";e.exports=require("is-zip")},6647:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TaskHistoryService=void 0;const s=r(3563),a=r(2776),c=i(r(9055)),l=r(9100),d=r(269);let u=class{constructor(e,t){this.appDataSource=e,this.dbDebugContextService=t}async getTaskSummaries(e,t=4,r){try{return await this.dbDebugContextService.runWithContext({operationName:"TaskHistoryService.getTaskSummaries"},(async()=>{const n=this.appDataSource.knex("eve_tasks").where({userId:e}).where("totalInputTokens",">",0);r&&n.where({workspaceName:r});const o=await n.select("taskId","originalPrompt as prompt","totalInputTokens as tokensIn","totalOutputTokens as tokensOut","createdAt as timestamp","mode").orderBy("createdAt","desc").limit(t);return c.default.debug(`Retrieved ${o.length} task summaries with non-zero input tokens for user ${e}${r?` in workspace ${r}`:""}`),o}))}catch(t){throw c.default.error(`Error getting task summaries for user ${e}: ${t.message}`,t.stack),new Error(`Failed to get task summaries: ${t.message}`)}}async getTaskEvents(e,t){try{return await this.dbDebugContextService.runWithContext({operationName:"TaskHistoryService.getTaskEvents",taskId:e},(async()=>{if(!await this.appDataSource.knex("eve_tasks").where({taskId:e,userId:t}).first())throw new s.UnauthorizedException("Not authorized to access this task");const r=await this.appDataSource.knex("eve_task_events").where({taskId:e}).orderBy("eventId","asc").select("eventId","eventType","payload","createdAt as timestamp"),n=r.map((e=>({...e,payload:JSON.parse(e.payload)})));return c.default.debug(`Retrieved ${r.length} events for task ${e}`),n}))}catch(t){if(t instanceof s.UnauthorizedException)throw t;throw c.default.error(`Error getting events for task ${e}: ${t.message}`,t.stack),new Error(`Failed to get task events: ${t.message}`)}}async persistEvent(e,t,r,n=1){try{return await this.dbDebugContextService.runWithContext({operationName:"TaskHistoryService.persistEvent",taskId:e},(async()=>{const n=(0,l.ulid)();await this.appDataSource.knex.transaction((async o=>{if(!await o("eve_tasks").where({taskId:e}).first("taskId"))throw new Error(`Cannot persist event: Task ${e} not found`);await o("eve_task_events").insert({eventId:n,taskId:e,eventType:t,payload:JSON.stringify(r),createdAt:o.fn.now()})})),c.default.debug(`Persisted ${t} event ${n} for task ${e}`)}))}catch(o){if(o.message.includes("database is locked")&&n<3){const o=100*Math.pow(2,n);return c.default.warn(`[TaskHistoryService] Database locked when persisting event, retrying in ${o}ms (attempt ${n})`),await new Promise((e=>setTimeout(e,o))),this.persistEvent(e,t,r,n+1)}c.default.error(`Failed to persist ${t} event for task ${e}: ${o.message}`,{taskId:e,eventType:t,error:o.stack})}}async trackApiUsage(e,t,r=1){try{return await this.dbDebugContextService.runWithContext({operationName:"TaskHistoryService.trackApiUsage",taskId:e},(async()=>{if(!e||"string"!=typeof e)throw new Error("Invalid taskId provided");const r=t.inputTokens||0,n=t.outputTokens||0;if("number"!=typeof r||"number"!=typeof n)throw new Error("Invalid token counts provided");await this.appDataSource.knex.transaction((async t=>{if(0===await t("eve_tasks").where({taskId:e}).increment({totalInputTokens:r,totalOutputTokens:n}).update({updatedAt:t.fn.now()}))throw new Error(`Task ${e} not found when updating token counts`)})),c.default.debug(`Updated token counts for task ${e}: +${r} input, +${n} output`)}))}catch(n){if(n.message.includes("database is locked")&&r<3){const n=100*Math.pow(2,r);return c.default.warn(`[TaskHistoryService] Database locked when tracking API usage, retrying in ${n}ms (attempt ${r})`),await new Promise((e=>setTimeout(e,n))),this.trackApiUsage(e,t,r+1)}c.default.error(`Failed to update token counts for task ${e}: ${n.message}`,{taskId:e,error:n.stack,usageInfo:t})}}};t.TaskHistoryService=u,t.TaskHistoryService=u=n([(0,s.Injectable)(),o("design:paramtypes",[a.AppDataSource,d.DbDebugContextService])],u)},6651:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MCPController=void 0;const u=r(3563),f=r(2368),p=r(6910),h=a(r(6928)),g=a(r(9896)),m=d(r(9055));let y=class{constructor(e){this.configService=e}getMcpDirectory(){let e=this.configService.getProperty(p.ConfigPropNames.MCP_SERVERS_DIRECTORY,"~/.eve/mcp-servers");return e.startsWith("~")&&(e=h.join(process.env.HOME||"",e.substring(1))),e}ensureMcpDirectoryExists(e){try{if(!g.existsSync(e)){g.mkdirSync(e,{recursive:!0}),m.default.info(`Created MCP directory at ${e}`);const t=h.join(e,"mcp-servers.json");g.existsSync(t)||(g.writeFileSync(t,JSON.stringify({mcpServers:{}},null,2)),m.default.info(`Created empty mcp-servers.json file at ${t}`))}}catch(e){throw m.default.error("Failed to create MCP directory:",e),new Error(`Failed to create MCP directory: ${e.message}`)}}async getMcpConfig(){try{const e=this.getMcpDirectory();this.ensureMcpDirectoryExists(e);const t=h.join(e,"mcp-servers.json"),r=g.readFileSync(t,"utf8");return JSON.parse(r)}catch(e){throw m.default.error("Failed to get MCP config:",e),new Error(`Failed to get MCP config: ${e.message}`)}}async updateMcpConfig(e){try{const t=this.getMcpDirectory();this.ensureMcpDirectoryExists(t);const r=h.join(t,"mcp-servers.json");return g.writeFileSync(r,JSON.stringify(e,null,2)),m.default.info("Updated MCP config at "+r),{success:!0}}catch(e){throw m.default.error("Failed to update MCP config:",e),new Error(`Failed to update MCP config: ${e.message}`)}}async toggleServerDisabled(e){try{const t=this.getMcpDirectory();this.ensureMcpDirectoryExists(t);const r=h.join(t,"mcp-servers.json"),n=g.readFileSync(r,"utf8"),o=JSON.parse(n);if(!o.mcpServers||!o.mcpServers[e])throw new Error(`Server '${e}' not found`);return o.mcpServers[e].disabled=!o.mcpServers[e].disabled,g.writeFileSync(r,JSON.stringify(o,null,2)),m.default.info(`Toggled disabled state for MCP server '${e}' to ${o.mcpServers[e].disabled}`),{success:!0,serverName:e,disabled:o.mcpServers[e].disabled}}catch(t){throw m.default.error(`Failed to toggle disabled state for MCP server '${e}':`,t),new Error(`Failed to toggle disabled state: ${t.message}`)}}};t.MCPController=y,s([(0,u.Get)("config"),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],y.prototype,"getMcpConfig",null),s([(0,u.Put)("config"),l(0,(0,u.Body)()),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],y.prototype,"updateMcpConfig",null),s([(0,u.Post)("servers/:serverName/toggle-disabled"),l(0,(0,u.Param)("serverName")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],y.prototype,"toggleServerDisabled",null),t.MCPController=y=s([(0,u.Controller)("mcp"),c("design:paramtypes",[f.ConfigService])],y)},6654:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n(function_declaration\n  name: (identifier) @name.definition.function) @definition.function\n\n(method_declaration\n  name: (field_identifier) @name.definition.method) @definition.method\n\n(type_declaration\n  (type_spec\n    name: (type_identifier) @name.definition.type\n    type: (struct_type))) @definition.struct\n\n(type_declaration\n  (type_spec\n    name: (type_identifier) @name.definition.type\n    type: (interface_type))) @definition.interface\n"},6663:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.EventHelper=void 0;const i=r(3563),s=r(461),a=r(1280);let c=class{constructor(e){this.eventEmitter=e}emitTaskUpdate(e,t,r,n,o){const i={clientId:e,taskId:t,status:r,mode:o,data:n};this.eventEmitter.emit(a.InternalEvents.TASK_UPDATED,i)}emitError(e,t,r,n,o="task_error",i){const s={clientId:e,taskId:t,error:r,type:o,context:{source:n,...i}};this.eventEmitter.emit(a.InternalEvents.AGENT_ERROR_NOTIFICATION,s)}emitToolExecutionCompleted(e){this.eventEmitter.emit(a.InternalEvents.TOOL_EXECUTION_COMPLETED,e)}};t.EventHelper=c,t.EventHelper=c=n([(0,i.Injectable)(),o("design:paramtypes",[s.EventEmitter2])],c)},6695:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ComputerUseAgentService=void 0;const s=r(3563),a=r(3470),c=r(5277),l=r(6158),d=r(2300),u=r(8884);let f=class extends c.GraphAgentService{constructor(e,t,r){super(e,t,r),this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}getName(){return"computer-use-agent"}async getTools(e){return await this.toolFactoryService.createTools(["computer"],e)}async getSystemPrompt(e){const t=process.platform,r="win32"===t?"Windows":"darwin"===t?"macOS":"Linux",n=(0,u.getEnv)("WIDTH"),o=(0,u.getEnv)("HEIGHT");if(!n||!o)throw new Error("Screen resolution environment variables WIDTH and HEIGHT must be set");return`\n    You are a Computer Use Agent specializing in controlling the computer through keyboard and mouse automation. Your task is to help users achieve their goals by controlling the computer interface using the computer tool.\n\n    WORKSPACE INFORMATION:\n    Current operating system: ${r}\n    Screen resolution: ${n}x${o} pixels\n\n    AVAILABLE COMPUTER TOOL FUNCTIONS:\n\n    1. Keyboard Control:\n       - key: Send keyboard key events\n         * Use for special keys and key combinations\n         * Examples: "enter", "tab", "ctrl+c", "shift+a"\n       - type: Type text directly\n         * Use for entering regular text\n         * More reliable than individual key presses for text input\n         * Example: {"action": "type", "text": "Hello World"}\n\n    2. Mouse Control:\n       - mouse_move: Move mouse cursor to specific coordinates\n         * Requires x,y coordinates within screen bounds\n         * Example: {"action": "mouse_move", "coordinate": [100, 200]}\n       - left_click: Click the left mouse button\n         * Use after positioning the cursor\n         * For basic selection and activation\n       - right_click: Click the right mouse button\n         * Use for context menus\n         * Position cursor first\n       - middle_click: Click the middle mouse button\n         * Special functions in some applications\n       - double_click: Double click at current position\n         * Use for opening files/folders\n         * More reliable than two separate clicks\n       - left_click_drag: Click and drag operation\n         * For selections and drag-drop\n         * Requires target coordinates\n         * Example: {"action": "left_click_drag", "coordinate": [300, 400]}\n\n    3. Screen Information:\n       - screenshot: Capture the current screen\n         * Use to verify current state\n         * Helps in debugging automation\n       - cursor_position: Get current mouse coordinates\n         * Use to verify cursor location\n         * Helpful for planning movements\n\n    OPERATIONAL GUIDELINES:\n\n    1. Coordinate System:\n       - Screen coordinates start at (0,0) in top-left corner\n       - X increases right (0 to ${n}), Y increases down (0 to ${o})\n       - All coordinates must stay within screen bounds (0 ≤ x ≤ ${n}, 0 ≤ y ≤ ${o})\n\n    2. Best Practices:\n       - Always verify cursor position before clicking\n       - Use type action for text input when possible\n       - Add small delays between actions if needed\n       - Break complex operations into simple steps\n       - Verify results with screenshots when needed\n\n    3. Safety Considerations:\n       - Avoid rapid mouse movements\n       - Verify coordinates before drag operations\n       - Be cautious with double-clicks\n       - Allow time for system response\n\n    IMPORTANT REMINDERS:\n    1. NEVER guess about what is on the screen - always take a screenshot first to examine the current state\n    2. Take screenshots after performing actions to verify they had the intended effect\n    3. All coordinates must be within screen bounds\n    4. Always verify current state before critical actions\n    5. Use the most appropriate function for each task\n    6. Break complex tasks into simple, verifiable steps\n    7. Consider user confirmation for critical operations\n    8. Remember that screen layout may vary by system\n    9. Be prepared to handle unexpected states\n    10. NEVER assume we need to wait for an operation to complete - if the expected result is not visible in the screenshot, assume the operation did not work\n    \n    WORKFLOW REQUIREMENTS:\n    1. Before making any plan:\n       - Take a screenshot to understand the current state\n       - Analyze the screenshot to identify UI elements and their locations\n       - Only proceed once you have clear visual confirmation of the interface\n    \n    2. After performing actions:\n       - Take another screenshot to verify the results\n       - Compare with expected outcome\n       - If results don't match expectations, adjust your approach\n       \n    3. For complex operations:\n       - Break down into smaller steps\n       - Verify each step with a screenshot before proceeding\n       - Document any unexpected behavior or states`}};t.ComputerUseAgentService=f,t.ComputerUseAgentService=f=n([(0,s.Injectable)(),i(0,(0,s.Inject)((0,s.forwardRef)((()=>d.GraphAgentCollaborator)))),o("design:paramtypes",[d.GraphAgentCollaborator,l.ToolFactoryService,a.AgentRuleService])],f)},6696:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetRetrievalService=void 0;const a=r(3563),c=r(2368),l=s(r(9055)),d=r(8077),u=r(7310),f=r(5796);let p=n=class{constructor(e,t){this.configService=e,this.datasetService=t,this.embeddingsModel=process.env.EMBEDDINGS_MODEL||"Xenova/all-mpnet-base-v2",this.chromaUrl=process.env.CHROMA_URL||"http://localhost:8000"}async searchDataset(e,t,r=20,o=void 0){try{l.default.info(`[${n.name}] Searching dataset ${e} for: ${t}`),l.default.info(`[${n.name}] Initializing embeddings model: ${this.embeddingsModel}`);const i=new u.HuggingFaceTransformersEmbeddings({modelName:this.embeddingsModel}),s=new f.Chroma(i,{collectionName:e,url:this.chromaUrl});if(!o){const o=await s.similaritySearch(t,r);return l.default.info(`[${n.name}] Found ${o.length} matches in dataset ${e}`),o}const a=await this.datasetService.getAllDatasets().then((t=>t.find((t=>t.name===e))));if(!a)throw new Error(`Dataset ${e} not found`);const c=await this.datasetService.getDocuments(a.id),d=c.map((e=>(l.default.info(`[${n.name}] Searching for ${t} in document ${e.id}`),s.similaritySearch(t,o,{original_document_id:{$eq:e.id}})))),p=(await Promise.all(d)).flat();l.default.info(`[${n.name}] Found ${p.length} matches in dataset ${e} - before deduplication`),l.default.debug(`[${n.name}] Combined results: ${JSON.stringify(p)}`);const h=p.filter(((e,t,r)=>r.findIndex((t=>t.metadata.id===e.metadata.id))===t));return l.default.info(`[${n.name}] Found ${h.length} total matches across ${c.length} documents in dataset ${e}`),p}catch(t){throw l.default.error(`[${n.name}] Failed to search dataset ${e}`),l.default.error(`[${n.name}] Error details: ${t.message}`),t.stack&&l.default.error(`[${n.name}] Stack trace: ${t.stack}`),t}}};t.DatasetRetrievalService=p,t.DatasetRetrievalService=p=n=o([(0,a.Injectable)(),i("design:paramtypes",[c.ConfigService,d.DatasetService])],p)},6724:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MentionsService=void 0;const d=r(3563),u=a(r(6928)),f=a(r(1943)),p=r(8474),h=r(6550),g=l(r(9055)),m=r(2355),y=r(7526),v=/@((?:\/|\.\/|\.\.\/|\w+:\/\/)[^\s]+?|[a-f0-9]{7,40}\b|problems\b|terminal\b|git-changes\b)(?=[.,;:!?]?(?=[\s\r\n]|$))/g;let _=class{constructor(e,t,r){this.mainWorkspaceService=e,this.taskService=t,this.ignoreConfigService=r}async getCwdForTask(e){try{const t=await this.taskService.getTask(e);if(t&&t.workspaceName){const r=await this.mainWorkspaceService.findOne(t.workspaceName);if(r&&r.repoBaseDir)return r.repoBaseDir;g.default.warn(`[MentionsService] Workspace path not found for workspaceName: ${t.workspaceName} in task ${e}`)}else t?g.default.warn(`[MentionsService] Task ${e} does not have a workspaceName.`):g.default.warn(`[MentionsService] Task ${e} not found when trying to get CWD.`)}catch(t){g.default.error(`[MentionsService] Error getting CWD for task ${e}: ${t.message}`)}}async getFileContent(e,t){try{const r=await f.stat(e),n={path:t,isBinary:!1,size:r.size,modified:r.mtime};if(await(0,m.isBinaryFile)(e).catch((()=>!1)))return n.isBinary=!0,n;const o=await f.readFile(e,"utf-8");return n.content=o,n}catch(r){return g.default.warn(`[MentionsService] Error reading file '${e}': ${r.message}`),{path:t,isBinary:!1,error:`Error reading file: ${r.message}`}}}async getDirectoryContent(e,t){try{const r=await f.readdir(e,{withFileTypes:!0});return{path:t,entries:r.map((e=>({name:e.name,isDirectory:e.isDirectory()})))}}catch(r){return g.default.warn(`[MentionsService] Error reading directory '${e}': ${r.message}`),{path:t,entries:[],error:`Error reading directory: ${r.message}`}}}async getContent(e,t,r=1){const n=u.resolve(e,t),o={files:[],directories:[]};try{const i=await f.stat(n);if(i.isFile()){const e=await this.getFileContent(n,t);return o.files.push(e),o}if(i.isDirectory())return await this.processDirectory(e,t,r,o),o}catch(e){return g.default.error(`[MentionsService] Error getting content for '${n}': ${e.message}`),o}return o}async getContentAsText(e,t,r=1){const n=await this.getContent(e,t,r);let o="";const i=new Map;for(const e of n.directories)i.set(e.path,e);const s=Array.from(i.values()).sort(((e,t)=>e.path.split("/").filter(Boolean).length-t.path.split("/").filter(Boolean).length));for(const e of s)if(e.error)o+=`<folder_content path="${e.path}">Error fetching content: ${e.error}</folder_content>\n\n`;else{let t="";e.entries.forEach(((r,n)=>{const o=n===e.entries.length-1;t+=`${o?"└── ":"├── "}${r.name}${r.isDirectory?"/":""}\n`})),o+=`<folder_content path="${e.path}">\n${t.trim()}\n</folder_content>\n\n`}for(const e of n.files)e.error?o+=`<file_content path="${e.path}">Error fetching content: ${e.error}</file_content>\n\n`:e.isBinary?o+=`<file_content path="${e.path}">(Binary file, unable to display content)</file_content>\n\n`:e.content&&(o+=`<file_content path="${e.path}">\n${e.content}\n</file_content>\n\n`);return o.trim()}async processDirectory(e,t,r,n){const o=u.resolve(e,t);try{const i=await this.getDirectoryContent(o,t);if(n.directories.push(i),r<=0)return;for(const s of i.entries){const i=u.join(t,s.name),a=u.join(o,s.name);try{if(s.isDirectory)r>1&&await this.processDirectory(e,i,r-1,n);else{const e=await this.getFileContent(a,i);n.files.push(e)}}catch(e){g.default.warn(`[MentionsService] Error processing entry '${i}': ${e.message}`),s.isDirectory?n.directories.push({path:i,entries:[],error:`Error processing directory: ${e.message}`}):n.files.push({path:i,isBinary:!1,error:`Error reading file: ${e.message}`})}}}catch(e){g.default.error(`[MentionsService] Error processing directory '${o}': ${e.message}`),n.directories.push({path:t,entries:[],error:`Error processing directory: ${e.message}`})}}async processMentions(e,t){const r=[];let n=e;const o=await this.getCwdForTask(t);if(!o)return g.default.error(`[MentionsService] Could not determine CWD for task ${t}. Mentions will not be processed.`),{originalTextSegment:{type:"text",content:e},fileContentSegments:[]};const i=[];let s=n;s=s.replace(v,((e,t)=>{if(i.push(t),t.startsWith("http"))return`'${t}' (web content fetching not yet implemented)`;if(t.startsWith("/")||t.startsWith("./")||t.startsWith("../")){const e=t.startsWith("/")?t.substring(1):t;return e.endsWith("/")?`'${e}' (see below for folder content)`:`'${e}' (see below for file content)`}return["problems","terminal","git-changes"].includes(t)||/^[a-f0-9]{7,40}$/.test(t)?`'${t}' (special mention processing not yet implemented)`:e})),n=s;for(const e of[...new Set(i)])if(e.startsWith("/")||e.startsWith("./")||e.startsWith("../")){const t=e.startsWith("/")?e.substring(1):e,n=e.endsWith("/");try{g.default.info(`[MentionsService] Processing mentioned path: ${t}`);const i=u.resolve(o,t),s=await f.stat(i);if(s.isFile()&&n||s.isDirectory()&&!n)s.isDirectory()&&!n?r.push({type:"text",content:`<file_content path="${t}">Error: Path is a directory, but mention did not end with '/'. Use '@${e}/' to reference it as a folder.</file_content>`}):s.isFile()&&n&&r.push({type:"text",content:`<folder_content path="${t}">Error: Path is a file, but mention ended with '/'. Use '@${e.slice(0,-1)}' to reference it as a file.</folder_content>`});else if(s.isFile()){const e=(await this.getContent(o,t)).files[0];e.error?r.push({type:"text",content:`<file_content path="${t}">Error fetching content: ${e.error}</file_content>`}):e.isBinary?r.push({type:"text",content:`<file_content path="${t}">(Binary file, unable to display content)</file_content>`}):e.content&&r.push({type:"text",content:`<file_content path="${t}">\n${e.content}\n</file_content>`})}else if(s.isDirectory()){const e=await this.getContent(o,t,1);if(e.directories.length>0){const n=e.directories[0];if(n.error)r.push({type:"text",content:`<folder_content path="${t}">Error fetching content: ${n.error}</folder_content>`});else{let e="";n.entries.forEach(((t,r)=>{const o=r===n.entries.length-1;e+=`${o?"└── ":"├── "}${t.name}${t.isDirectory?"/":""}\n`})),r.push({type:"text",content:`<folder_content path="${t}">\n${e.trim()}\n</folder_content>`})}}for(const t of e.files)t.error?r.push({type:"text",content:`<file_content path="${t.path}">Error fetching content: ${t.error}</file_content>`}):t.isBinary?r.push({type:"text",content:`<file_content path="${t.path}">(Binary file, unable to display content)</file_content>`}):t.content&&r.push({type:"text",content:`<file_content path="${t.path}">\n${t.content}\n</file_content>`})}}catch(o){g.default.warn(`[MentionsService] Error processing mention '${e}' for path '${t}': ${o.message}`);const i=n?"folder_content":"file_content";r.push({type:"text",content:`<${i} path="${t}">Error fetching content: ${o.message}</${i}>`})}}else e.startsWith("http")?r.push({type:"text",content:`<url_content url="${e}">Web content fetching for URLs is not yet implemented.</url_content>`}):(["problems","terminal","git-changes"].includes(e)||/^[a-f0-9]{7,40}$/.test(e))&&r.push({type:"text",content:`<special_mention type="${e}">Processing for '${e}' mentions is not yet implemented.</special_mention>`});return{originalTextSegment:{type:"text",content:n},fileContentSegments:r}}};t.MentionsService=_,t.MentionsService=_=s([(0,d.Injectable)(),c("design:paramtypes",[p.WorkspaceService,h.TaskService,y.IgnoreConfigService])],_)},6780:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parseToolParams=function(e,t){o.default.debug(`[parseToolParams] Attempting to parse XML for tool: ${t}`),o.default.debug(`[parseToolParams] Raw content:\n${e}`);const r={};try{const n=e.trim(),i=new RegExp(`<${t}\\s*>([\\s\\S]*?)<\\/${t}\\s*>`,"i"),s=n.match(i);if(!s||"string"!=typeof s[1])return o.default.warn(`[parseToolParams] Could not extract inner content for tool ${t}. Regex did not match.`),null;{const e=s[1].trim();o.default.debug(`[parseToolParams] Extracted inner content:\n${e}`);const n=/<([a-zA-Z_][a-zA-Z0-9_-]*)\s*>([\s\S]*?)<\/\1\s*>/g;let i,a=!1;for(;null!==(i=n.exec(e));){const e=i[1],t=i[2];r[e]=t,o.default.debug(`[parseToolParams] Found param: ${e} = "${t.substring(0,50)}${t.length>50?"...":""}"`),a=!0}a||o.default.warn(`[parseToolParams] No parameters found within the inner content for tool ${t}.`)}}catch(e){return o.default.error(`[parseToolParams] Error parsing tool params for ${t}: ${e.message}\n${e.stack}`),null}return r};const o=n(r(9055))},6808:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.HelloWorldModule=void 0;const o=r(3563),i=r(5096),s=r(5533);let a=class{};t.HelloWorldModule=a,t.HelloWorldModule=a=n([(0,o.Module)({controllers:[i.HelloWorldController],providers:[s.HelloWorldService]})],a)},6823:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.WriteToFileToolFactory=void 0;const i=r(3563),s=r(6946),a=r(4243);let c=class{constructor(e){this.fileValidationService=e}getToolName(){return"write_to_file"}create(e){return new s.WriteToFileTool(e.workingDir,this.fileValidationService)}};t.WriteToFileToolFactory=c,t.WriteToFileToolFactory=c=n([(0,i.Injectable)(),o("design:paramtypes",[a.FileValidationService])],c)},6844:e=>{"use strict";e.exports=require("tree-sitter-typescript")},6897:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LlmStreamProcessorBlock=void 0;const c=r(3563),l=r(461),d=r(1623),u=a(r(9055)),f=r(6297),p=r(6550),h=r(7485),g=r(5324),m=r(6349),y=r(1280);let v=n=class{constructor(e,t,r,n,o){this.taskService=e,this.eventEmitter=t,this.agentStateManager=r,this.blockService=n,this.conversationHistoryService=o}async processStream(e,t,r,o){f.debugLogger.log(`Starting to process LLM stream for task ${t} with block-based communication`);let i,s,a=null,c=0,l=0,d=null;const p=this.agentStateManager.getAbortSignal(t);if(p?.aborted)return u.default.info(`[${n.name}] Task ${t} already aborted before stream processing`),a=new Error("Task aborted before stream processing"),{streamError:a,providerId:i,messageInterchange:s};try{u.default.info(`[${n.name}] Starting to process LLM stream for task ${t}`);i=(await this.taskService.getTask(t)).providerId,u.default.info(`[${n.name}] Provider for task ${t}: ${i}`);let o=0,h=!1;try{for await(const i of e){if(this.agentStateManager.isTaskAborting(t)||p?.aborted){if(u.default.info(`[${n.name}] Task ${t} is being aborted, stopping stream processing at chunk ${o}`),d)try{const e=await this.blockService.getBlock(d);e&&"generating"===e.status&&(await this.blockService.updateBlock(d,{status:"error",errorText:"Generation cancelled by user"}),u.default.info(`[${n.name}] Updated block ${d} to error due to cancellation`))}catch(e){u.default.error(`[${n.name}] Error updating current block ${d} during cancellation: ${e.message}`)}try{const e=await this.blockService.getLastBlockForTask(t);e&&"request"===e.blockType&&(await this.blockService.updateBlock(e.blockId,{status:"error",errorText:"Task cancelled by user"}),u.default.info(`[${n.name}] Updated request block ${e.blockId} status to error due to task cancellation`))}catch(e){u.default.error(`[${n.name}] Error updating request block for cancelled task ${t}: ${e.message}\n${e.stack}`)}break}if(!h)try{const e=await this.blockService.getLastBlockForTask(t);e&&"request"===e.blockType&&(await this.blockService.updateBlock(e.blockId,{status:"finished"}),u.default.info(`[${n.name}] Updated request block ${e.blockId} status to finished`)),h=!0}catch(e){u.default.error(`[${n.name}] Error updating request block: ${e.message}`),h=!0}o++,f.debugLogger.dumpObject(`Processing chunk ${o} for task ${t}`,i);try{if("block"===i.type)await this.handleBlockChunk(i,t,r),d=i.block.blockId;else if("blockUpdate"===i.type){const e=i;if(!e.blockId)throw u.default.error(`[${n.name}] Received blockUpdate without blockId for task ${t}`),new Error(`Received blockUpdate without blockId for task ${t}`);const o=e.blockId;await this.handleBlockUpdateChunk(e,o,t,r)}else if("usage"===i.type)await this.handleUsageChunk(i,t),i.inputTokens&&(c=i.inputTokens),i.outputTokens&&(l=i.outputTokens);else if("messageInterchange"===i.type){const e=i;u.default.info(`[${n.name}] Received messageInterchange chunk for task ${t}`),s=e.messageInterchange,s.taskId=t}}catch(e){u.default.error(`[${n.name}] Error processing stream chunk for task ${t}: ${e.message}\n${e.stack}`)}}if(d)try{const e=await this.blockService.getBlock(d);e&&"finished"!==e.status&&(await this.blockService.updateBlock(d,{status:"finished"}),u.default.info(`[${n.name}] Finalized block ${d} for task ${t}`))}catch(e){u.default.warn(`[${n.name}] Could not finalize block ${d} for task ${t}: ${e.message}`)}}catch(e){a=e,u.default.error(`[${n.name}] LLM stream processing error for task ${t}: ${e.message}\n${e.stack}`),this.eventEmitter.emit(y.InternalEvents.TOOL_ERROR,{taskId:t,clientId:r,error:e.message,type:"api_error",context:{stack:e.stack}})}finally{(c>0||l>0)&&(u.default.info(`[${n.name}] Final token counts for task ${t}: Input=${c}, Output=${l}`),await this.blockService.trackUsage({taskId:t,inputTokens:c,outputTokens:l}).catch((e=>{u.default.error(`[${n.name}] Failed to track final API usage for task ${t}: ${e.message}`,{taskId:t,error:e.stack})})))}}catch(e){a=e,u.default.error(`[${n.name}] Outer error in processStream for task ${t}: ${e.message}\n${e.stack}`)}return{streamError:a,providerId:i,messageInterchange:s}}async handleBlockChunk(e,t,r){if(u.default.debug(`[${n.name}] Creating new block for task ${t}`),!e.block.blockId){const e=`Received block without blockId for task ${t}`;throw u.default.error(`[${n.name}] ${e}`),new Error(e)}const o=await this.blockService.createBlock({blockId:e.block.blockId,taskId:t,role:"assistant",blockType:e.block.blockType,tagName:e.block.tagName,status:e.block.status,content:e.block.content||""});return u.default.debug(`[${n.name}] Created block ${o.blockId} for task ${t}`),o}async handleBlockUpdateChunk(e,t,r,o){if(u.default.debug(`[${n.name}] Updating block ${t} for task ${r}`),!e.blockId){const e=`Received blockUpdate without blockId for task ${r}`;throw u.default.error(`[${n.name}] ${e}`),new Error(e)}if(e.blockId!==t){const o=`BlockUpdate blockId (${e.blockId}) does not match expected blockId (${t}) for task ${r}`;throw u.default.error(`[${n.name}] ${o}`),new Error(o)}e.appendContent&&await this.blockService.appendToBlockContent(t,e.appendContent);const i={};e.newStatus&&(i.status=e.newStatus),e.newBlockType&&(i.blockType=e.newBlockType),e.newTagName&&(i.tagName=e.newTagName),e.output&&(i.output=e.output),e.errorText&&(i.errorText=e.errorText),Object.keys(i).length>0&&(await this.blockService.updateBlock(t,i),"finished"===e.newStatus&&"tool_call"===e.newBlockType&&e.newTagName&&d.RESPONSE_ONLY_TOOLS.includes(e.newTagName)&&(await this.blockService.updateBlock(t,{status:"completed"}),u.default.info(`[${n.name}] Auto-completed response-only tool ${e.newTagName} for block ${t}`))),u.default.debug(`[${n.name}] Updated block ${t} for task ${r}`)}async handleUsageChunk(e,t){u.default.info(`[${n.name}] Tracking usage for task ${t}: ${e.inputTokens} input tokens, ${e.outputTokens} output tokens`),await this.blockService.trackUsage({taskId:t,inputTokens:e.inputTokens,outputTokens:e.outputTokens,cacheWriteTokens:e.cacheWriteTokens,cacheReadTokens:e.cacheReadTokens,totalCost:e.totalCost})}};t.LlmStreamProcessorBlock=v,t.LlmStreamProcessorBlock=v=n=o([(0,c.Injectable)(),s(0,(0,c.Inject)((0,c.forwardRef)((()=>p.TaskService)))),i("design:paramtypes",[p.TaskService,l.EventEmitter2,h.AgentStateManager,g.BlockService,m.ConversationHistoryService])],v)},6910:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigPropNames=void 0;class r{}t.ConfigPropNames=r,r.EVE_API_KEY="EVE_API_KEY",r.GOOGLE_API_KEY="GOOGLE_API_KEY",r.DEFAULT_CODING_MODEL="DEFAULT_CODING_MODEL",r.DEFAULT_REASONING_MODEL="DEFAULT_REASONING_MODEL",r.DEFAULT_SUMMARISATION_MODEL="DEFAULT_SUMMARISATION_MODEL",r.DEFAULT_RAG_QUERY_MODEL="DEFAULT_RAG_QUERY_MODEL",r.DEFAULT_ORCHESTRATION_MODEL="DEFAULT_ORCHESTRATION_MODEL",r.DEFAULT_ARCHITECT_MODEL="DEFAULT_ARCHITECT_MODEL",r.PRIVATE_CODING_MODEL="PRIVATE_CODING_MODEL",r.PRIVATE_REASONING_MODEL="PRIVATE_REASONING_MODEL",r.PRIVATE_SUMMARISATION_MODEL="PRIVATE_SUMMARISATION_MODEL",r.PRIVATE_RAG_QUERY_MODEL="PRIVATE_RAG_QUERY_MODEL",r.PRIVATE_ORCHESTRATION_MODEL="PRIVATE_ORCHESTRATION_MODEL",r.PRIVATE_ARCHITECT_MODEL="PRIVATE_ARCHITECT_MODEL",r.AGENT_RECURSION_LIMIT="AGENT_RECURSION_LIMIT",r.AGENT_ITERATION_LIMIT="AGENT_ITERATION_LIMIT",r.AGENT_SYSTEM_PROMPT="MAX_SYSTEM_PROMPT_LENGTH",r.OLLAMA_BASE_URL="OLLAMA_BASE_URL",r.MCP_SERVERS_ENABLED="MCP_SERVERS_ENABLED",r.MCP_SERVERS_DIRECTORY="MCP_SERVERS_DIRECTORY",r.VALUE_PER_LINE="VALUE_PER_LINE",r.ANTHROPIC_API_KEY="ANTHROPIC_API_KEY",r.OPENAI_API_KEY="OPENAI_API_KEY",r.GROQ_API_KEY="GROQ_API_KEY",r.HYPERBOLIC_API_KEY="HYPERBOLIC_API_KEY",r.MISTRAL_API_KEY="MISTRAL_API_KEY",r.OPENROUTER_API_KEY="OPENROUTER_API_KEY",r.GLHF_API_KEY="GLHF_API_KEY",r.DEEPSEEK_API_KEY="DEEPSEEK_API_KEY",r.SERP_API_KEY="SERP_API_KEY",r.MODE="MODE",r.COMMAND_OUTPUT_MAX_LENGTH="COMMAND_OUTPUT_MAX_LENGTH",r.COMMAND_OUTPUT_PREFIX_LENGTH="COMMAND_OUTPUT_PREFIX_LENGTH"},6928:e=>{"use strict";e.exports=require("path")},6932:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetDocumentRepository=void 0;const s=r(3563);r(1832);let a=class{constructor(e){this.knex=e}async findAll(e){return this.knex("datasetDocuments").where("datasetId",e).select("*")}async findById(e){return this.knex("datasetDocuments").where("id",e).first()}async create(e){await this.knex("datasetDocuments").insert(e)}async update(e,t){const r={...t,updatedAt:new Date};await this.knex("datasetDocuments").where("id",e).update(r)}async delete(e){await this.knex("datasetDocuments").where("id",e).delete()}async updateStatus(e,t){await this.knex("datasetDocuments").where("id",e).update({status:t,updatedAt:new Date})}};t.DatasetDocumentRepository=a,t.DatasetDocumentRepository=a=n([(0,s.Injectable)(),i(0,(0,s.Inject)("KNEX")),o("design:paramtypes",[Function])],a)},6946:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WriteToFileTool=void 0;const u=r(3563),f=c(r(1943)),p=d(r(9055)),h=c(r(6928)),g=r(9581),m=r(4243);let y=o=class{constructor(e,t){this.name="write_to_file",this.description="Request to write content to a file at the specified path.",this.workingDir=e,this.fileValidationService=t}getFailureHandlingSuggestion(e){return e>=3?`The 'write_to_file' tool has failed ${e} times consecutively. Check that the path is valid and within the workspace, and that you have permission to write to the file. Also ensure that the content is properly formatted and doesn't contain any invalid characters.`:null}getUsageInstructions(e){return`## write_to_file\nDescription: Request to write content to a file at the specified path. If the file exists, it will be overwritten with the provided content. If the file doesn't exist, it will be created. This tool will automatically create any directories needed to write the file.\nParameters:\n- path: (required) The path of the file to write to (relative to the current working directory ${e.workingDir})\n- content: (required) The content to write to the file. ALWAYS provide the COMPLETE intended content of the file, without any truncation or omissions. You MUST include ALL parts of the file, even if they haven't been modified.\nUsage:\n<write_to_file>\n<path>File path here</path>\n<content>\nYour file content here\n</content>\n</write_to_file>`}validateParams(e){return"string"==typeof e.path&&""!==e.path.trim()&&"string"==typeof e.content}async execute(e){const{path:t,content:r}=e;p.default.info(`[${o.name}] Writing to file: ${t} relative to ${this.workingDir}`);const n=h.resolve(this.workingDir,t);if(!n.startsWith(this.workingDir)){const e=`Path traversal attempt detected: ${t} resolves outside of workspace ${this.workingDir}`;throw p.default.error(`[${o.name}] ${e}`),new g.FileSystemError(e,"PATH_TRAVERSAL_ERROR")}try{const e=h.dirname(n);await f.mkdir(e,{recursive:!0}),await f.writeFile(n,r,"utf8"),p.default.info(`[${o.name}] File ${t} written successfully`);let i=`File ${t} written successfully`,s="";try{const e=await this.fileValidationService.validateFile(t,this.workingDir);e.hasErrors&&(s+="\n\nSyntax Validation Issues Found:",s+=`\n- ${e.report}`)}catch(e){p.default.error(`[${o.name}] Validation step failed for ${t}: ${e.message}`),s="\n\nNote: Syntax validation step encountered an error."}return i+=s,i}catch(e){const r=`Error writing to file ${t}: ${e.message}`;throw p.default.error(`[${o.name}] ${r}\n${e.stack}`),new g.FileSystemError(r,e.code||"FS_WRITE_ERROR")}}};t.WriteToFileTool=y,t.WriteToFileTool=y=o=a([(0,u.Injectable)(),l("design:paramtypes",[String,m.FileValidationService])],y)},6963:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.LlmStreamProcessorBlock=void 0,o(r(7485),t),o(r(7438),t),o(r(6387),t);const i=r(6897);Object.defineProperty(t,"LlmStreamProcessorBlock",{enumerable:!0,get:function(){return i.LlmStreamProcessorBlock}})},6982:e=>{"use strict";e.exports=require("crypto")},7001:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createPatternUtils=function(){o.default.debug("[AnthropicPatternUtils] Creating pattern utils");const e=/<([A-Za-z_][\w\-.]*)(\s[^>]*)?>/,t=/<([A-Za-z_][\w\-.]*)(\s[^>]*)?\/>/,r=/^```/;return{findOpeningTag:t=>{const r=e.exec(t);return r?(o.default.debug(`[AnthropicPatternUtils] Found opening tag: ${r[1]}`),{found:!0,tagName:r[1],fullMatch:r[0],index:r.index}):{found:!1}},findClosingTag:(e,t)=>{const r=new RegExp(`^</${t}\\s*>`);const n=e.match(r);return n?(o.default.debug(`[AnthropicPatternUtils] Found closing tag: ${t}`),{found:!0,fullMatch:n[0],index:n.index}):{found:!1}},findSelfClosingTag:e=>{const r=e.match(t);return r?(o.default.debug(`[AnthropicPatternUtils] Found self-closing tag: ${r[1]}`),{found:!0,tagName:r[1],fullMatch:r[0],index:r.index}):{found:!1}},findCodeFence:e=>{const t=e.match(r);return t?(o.default.debug("[AnthropicPatternUtils] Found code fence"),{found:!0,fullMatch:t[0],index:t.index}):{found:!1}},findLeadingWhitespace:e=>{const t=e.match(/^\s+/);return t?(o.default.debug(`[AnthropicPatternUtils] Found leading whitespace: "${t[0]}"`),{found:!0,whitespace:t[0],length:t[0].length}):{found:!1}},findTrailingWhitespace:e=>{const t=e.match(/\s+$/);return t?(o.default.debug(`[AnthropicPatternUtils] Found trailing whitespace: "${t[0]}"`),{found:!0,whitespace:t[0],length:t[0].length}):{found:!1}},endsWithPartialTag:e=>{if(e.match(/<[a-zA-Z0-9_]+$/))return o.default.debug(`[AnthropicPatternUtils] Text ends with partial opening tag: "${e}"`),!0;if(e.match(/<\/[a-zA-Z0-9_]+$/))return o.default.debug(`[AnthropicPatternUtils] Text ends with partial closing tag: "${e}"`),!0;const t=e.lastIndexOf("<");return-1!==t&&-1===e.indexOf(">",t)?(o.default.debug(`[AnthropicPatternUtils] Text ends with unclosed bracket: "${e}"`),!0):!(!e.endsWith("</thinking")&&!e.match(/<\/[a-zA-Z0-9_]+\s*$/))&&(o.default.debug(`[AnthropicPatternUtils] Text ends with partial closing tag with whitespace: "${e}"`),!0)},startsWithTagContinuation:e=>e.match(/^[a-zA-Z0-9_]+>/)?(o.default.debug(`[AnthropicPatternUtils] Text starts with tag name continuation: "${e}"`),!0):e.match(/^\/[a-zA-Z0-9_]+>/)?(o.default.debug(`[AnthropicPatternUtils] Text starts with closing tag continuation: "${e}"`),!0):e.match(/^\s*>/)?(o.default.debug(`[AnthropicPatternUtils] Text starts with closing bracket: "${e}"`),!0):!!e.match(/^[a-zA-Z0-9_]+_[a-zA-Z0-9_]+>/)&&(o.default.debug(`[AnthropicPatternUtils] Text starts with potential tool call tag: "${e}"`),!0),mightContainPartialTag:e=>{if(e.length<10&&e.includes("<"))return!0;const t=e.lastIndexOf("<");if(-1!==t){if(-1===e.indexOf(">",t))return!0}return e.endsWith("/")||e.endsWith("<")||null!==e.match(/<\/?[A-Za-z0-9_-]+$/)}}};const o=n(r(9055))},7016:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getObjectivePrompt=function(e){return"OBJECTIVE\n\nYou accomplish a given task iteratively, breaking it down into clear steps and working through them methodically.\n\n1. Analyze the user's task and set clear, achievable goals to accomplish it. Prioritize these goals in a logical order.\n2. Work through these goals sequentially, utilizing available tools one at a time as necessary. Each goal should correspond to a distinct step in your problem-solving process. You will be informed on the work completed and what's remaining as you go.\n3. Remember, you have extensive capabilities with access to a wide range of tools that can be used in powerful and clever ways as necessary to accomplish each goal. Before calling a tool, do some analysis within <thinking></thinking> tags. First, analyze the file structure provided in environment_details to gain context and insights for proceeding effectively. Then, think about which of the provided tools is the most relevant tool to accomplish the user's task. Next, go through each of the required parameters of the relevant tool and determine if the user has directly provided or given enough information to infer a value. When deciding if the parameter can be inferred, carefully consider all the context to see if it supports a specific value. If all of the required parameters are present or can be reasonably inferred, close the thinking tag and proceed with the tool use. BUT, if one of the values for a required parameter is missing, DO NOT invoke the tool (not even with fillers for the missing params) and instead, ask the user to provide the missing parameters using the ask_followup_question tool. DO NOT ask for more information on optional parameters if it is not provided.\n4. Once you've completed the user's task, you must use the attempt_completion tool to present the result of the task to the user. You may also provide a CLI command to showcase the result of your task; this can be particularly useful for web development tasks, where you can run e.g. `open index.html` to show the website you've built.\n5. The user may provide feedback, which you can use to make improvements and try again. But DO NOT continue in pointless back and forth conversations, i.e. don't end your responses with questions or offers for further assistance."}},7020:e=>{"use strict";e.exports=require("yazl")},7050:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ListCodeDefinitionsToolFactory=void 0;const i=r(3563),s=r(6268),a=r(873);let c=class{constructor(e){this.treeSitterService=e}getToolName(){return"list_code_definition_names"}create(e){return new s.ListCodeDefinitionsTool(e.workingDir,this.treeSitterService)}};t.ListCodeDefinitionsToolFactory=c,t.ListCodeDefinitionsToolFactory=c=n([(0,i.Injectable)(),o("design:paramtypes",[a.TreeSitterService])],c)},7093:e=>{"use strict";e.exports=require("langchain/text_splitter")},7184:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetRepository=void 0;const s=r(3563);r(1832);let a=class{constructor(e){this.knex=e}async findAll(){return this.knex("datasets").select("*")}async findById(e){return this.knex("datasets").where("id",e).first()}async create(e){await this.knex("datasets").insert(e)}async update(e,t){await this.knex("datasets").where("id",e).update(t)}async delete(e){await this.knex("datasets").where("id",e).delete()}};t.DatasetRepository=a,t.DatasetRepository=a=n([(0,s.Injectable)(),i(0,(0,s.Inject)("KNEX")),o("design:paramtypes",[Function])],a)},7188:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.MCPToolkit=void 0,t.MCPTool=p;const a=r(9150),c=r(9037),l=r(7814),d=r(5534),u=r(1569);class f extends d.BaseToolkit{constructor(e){super(),this.tools=[],this._tools=null,this.transport=null,this.client=null,this.transport=new l.StdioClientTransport(e)}async initialize(){if(null===this._tools){if(this.client=new c.Client({name:"langchain-js-client",version:"1.0.0"},{capabilities:{}}),null===this.transport)throw new Error("Transport is not initialized");await this.client.connect(this.transport),this._tools=await this.client.request({method:"tools/list"},a.ListToolsResultSchema),this.tools=await this.get_tools()}}async get_tools(){if(null===this._tools||null===this.client)throw new Error("Must initialize the toolkit first");const e=this._tools.tools.map((async e=>{if(null===this.client)throw new Error("Client is not initialized");return await p({client:this.client,name:e.name,description:e.description||"",argsSchema:h(e.inputSchema)})}));return Promise.all(e)}}async function p({client:e,name:t,description:n,argsSchema:o}){return(0,d.tool)((async n=>{const o={method:"tools/call",params:{name:t,arguments:n}},i=(await e.request(o,a.CallToolResultSchema)).content,{processImageContent:c}=await Promise.resolve().then((()=>s(r(3192)))),l=c(i);return JSON.stringify(l)}),{name:t,description:n,schema:o})}function h(e){if("object"!==e.type||!e.properties)throw new Error("Invalid schema type or missing properties");const t=Object.entries(e.properties).reduce(((e,[t,r])=>(e[t]=u.z.any(),e)),{});return u.z.object(t)}t.MCPToolkit=f},7201:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(1321);const c=r(818),l=r(6928),d=r(8781),u=r(715),f=s(r(7252)),p=r(6928),h=a(r(9055)),g=r(9187);(0,c.config)({path:(0,l.resolve)(__dirname,"../.env")});const m=r(6297);"true"===process.env.EVE_DEBUG_LOGGING&&(m.debugLogger.enable(),h.default.info("Debug logging enabled via EVE_DEBUG_LOGGING=true")),"true"===process.env.EVE_SQL_QUERY_LOGGING&&h.default.info("SQL query logging enabled via EVE_SQL_QUERY_LOGGING=true"),async function(){(0,g.getDefaultKnexConfig)();const e=await d.NestFactory.create(u.AppModule);e.setGlobalPrefix("api"),e.enableCors({origin:["http://localhost:3011","http://localhost:3012","http://localhost:3013","http://localhost:3014"],methods:["GET","POST","PUT","PATCH","DELETE","OPTIONS"],allowedHeaders:"*",exposedHeaders:["Location"]}),e.use(f.json({limit:"100mb"})),e.use(f.urlencoded({limit:"100mb",extended:!0})),e.use(f.static((0,p.join)(__dirname,"webui"))),e.use("*",((e,t,r)=>{e.originalUrl.startsWith("/api")?r():t.sendFile((0,p.join)(__dirname,"webui","index.html"))}));const t=process.env.PORT||3010;await e.listen(t);const r=`http://localhost:${t}`;console.log(`\neve-server is now available at: ${r}`);const n=["SIGTERM","SIGINT"];for(const t of n)process.on(t,(async()=>{h.default.info(`Received ${t}. Starting graceful shutdown...`),await e.close(),h.default.info("Application shut down gracefully"),process.exit(0)}))}().catch((e=>{h.default.error("Error during application bootstrap:",e),process.exit(1)}))},7202:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n(function_definition\n  name: (identifier) @name.definition.function) @definition.function\n\n(class_definition\n  name: (identifier) @name.definition.class) @definition.class\n"},7205:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StoredFileService=void 0;const d=r(3563),u=r(7607),f=r(5775),p=r(4632),h=a(r(904)),g=l(r(8817)),m=l(r(9055));let y=class{constructor(e){this.storedFileRepository=e}async uploadFile(e,t,r){let n=h.lookup(e.originalname);if(!n){const t=await g.default.fromBuffer(e.buffer);n=t?t.mime:"application/octet-stream"}const o=new u.StoredFile(e.originalname,e.buffer,n,t,r);return await this.storedFileRepository.create(o),m.default.info(`File uploaded: ${e.originalname} (${n}) for session: ${t||"none"}, workspace: ${r||"none"}`),f.StoredFileDto.fromStoredFile(o)}async getFile(e){const t=await this.storedFileRepository.findById(e);return t?m.default.info(`File retrieved: ${t.originalFilename} (${e})`):m.default.info(`File not found: ${e}`),t}async getFileMetadata(e){const t=await this.storedFileRepository.findByIdWithoutContent(e);return t?m.default.info(`File metadata retrieved: ${t.originalFilename} (${e})`):m.default.info(`File not found: ${e}`),t}async getAllFiles(){return this.storedFileRepository.findAll()}async deleteFile(e){const t=await this.storedFileRepository.findByIdWithoutContent(e);await this.storedFileRepository.delete(e),m.default.info(`File deleted: ${t?t.originalFilename:"unknown"} (${e})`)}async getFilesBySessionId(e){const t=await this.storedFileRepository.findBySessionId(e);return m.default.info(`Retrieved ${t.length} files for session: ${e}`),t}async getFilesByWorkspaceName(e){const t=await this.storedFileRepository.findByWorkspaceName(e);return m.default.info(`Retrieved ${t.length} files for workspace: ${e}`),t}};t.StoredFileService=y,t.StoredFileService=y=s([(0,d.Injectable)(),c("design:paramtypes",[p.StoredFileRepository])],y)},7223:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ArchitectAgentService=void 0;const a=r(3563),c=r(3470),l=r(6158),d=s(r(9055)),u=r(2300),f=r(5277),p=r(8921);let h=class extends f.GraphAgentService{constructor(e,t,r){super(e,t,r),this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}getName(){return"architect-agent"}async getTools(e){const t=["list_files","read_file","update_file","delete_file","fetch_web_page","current_timestamp","grep","find_files","serp_api"];return e.workspace.portFromBaseDir&&t.push("read_port_from_file"),await this.toolFactoryService.createTools(t,e)}async getSystemPrompt(e){let t=`As an expert AI Software Architect, your primary role is to analyze requirements and break them down into well-defined, implementable tasks. Your main responsibilities vary based on the type of request:\n\n1. STORY TASK BREAKDOWN (Primary Role):\n   When breaking down an existing story into tasks:\n   \n   a) First analyze the context:\n      - Read the epic's requirements.md for high-level context\n      - Study the story.json to understand specific acceptance criteria\n      - Research the existing codebase using the repository file tree defined below and the read_file to understand current implementation\n      - Read the hints.md and README.md files to understand the tech stack and any other relevant information\n      - Read any other files that seem at all relevant to the task or to see examples of how things are done\n      - Use the read_file tool to read examples of existing code that might be relevant to the task\n      - Do not make assumptions about the codebase, always use the read_file tool to understand the existing code before designing new code\n   \n   b) Create tasks that:\n      - Fulfill all acceptance criteria\n      - Include basic happy path end-to-end tests\n      - Are sized for one atomic commit (3-4 files max)\n      - Are ordered logically for implementation\n      - If possible, include both the backend and frontend code changes in the same task so they can immediately be tested together\n      - Prefer lots of small tasks over fewer larger tasks\n   \n   c) For each task provide:\n      - Clear, descriptive title\n      - List of files to be created and the files to be modified\n      - For each file, describe the changes needed with pseudo code or code snippets if applicable\n      - Define entity/dto properties if applicable\n      - Show the code for DB table creation/updates if applicable\n      - Dependencies on other tasks\n      - Basic testing requirements which should include a happy path end to end test (no mocking/fixtures)\n      - List which acceptance criteria the task fulfills\n      - Status "backlog"\n      - Assignee "se-agent"\n\n2. EPIC/STORY PLANNING:\n   When asked to create a plan for something (and no specific EPIC is mentioned):\n   \n   a) Create a new epic with:\n      - Clear requirements.md file (this can be technical in nature rather than business requirements)\n      - 1-2 initial stories\n   \n   b) STOP and present the plan to user and wait for approval before breaking down the first story\n   \n   c) Only proceed with task breakdown after user approval\n\n3. FIRST EPIC SETUP:\n   When breaking down the first epic/stories in a project (e.g. EPIC-01):\n   \n   a) First task should be either:\n      - Scaffolding: Ask user for tech stack or propose a tech stack and ask user to confirm\n      OR\n      - Rebranding: If template exists:\n        * Update all wording/readmes\n        * Disable/hide template features if needed\n        * Include startup instructions for SE agent to show user\n   \n   b) Second task should implement first actual requirement\n   \n   c) Ensure proper tech stack is defined:\n      - Check hints.md and codebase for existing choices\n      - If none found, propose stack to user and wait for confirmation\n      - Update hints.md with confirmed stack\n\n4. REFACTORING PLANS:\n   When asked to create a refactoring plan:\n   \n   a) Test Coverage:\n      - Assess existing test coverage and add and missing happy path tests for important behaviors\n      - Create test story first if needed to add tests\n      - Plan for test updates/temporary disabling tests if needed\n   \n   b) Analysis & Principles:\n      - Identify complexity, duplication, coupling, large files, etc.\n      - Follow SOLID principles\n      - Keep changes independently deployable\n      - Maintain backward compatibility during the refactoring\n   \n   c) Task Structure:\n      1. Setup (tests, infrastructure)\n      2. Extraction (new files, minimal changes, bit by bit etc)\n      3. Updates (client code, dependencies)\n      4. Cleanup (remove old code, re-enable tests)\n\n${await p.EpicsPrompts.allEpicInstructions(e)}\n\nHere is the file tree of the system:\n${e.repositoryTree()}\n\n${e.portFromSourceTree()?`\nHere is the "port from" file tree containing another codebase that you can learn from and/or port code from (use read_port_from_file tool to read files from here):\n${e.portFromSourceTree()}\n`:""}\n\n${e.repositoryHints()?`Additional hints:\n${e.repositoryHints()}`:""}\n\nIMPORTANT GUIDELINES:\n- If there is no tech stack defined yet in the repository, then propose a tech stack and STOP AND ASK USER TO CONFIRM if that technology stack is okay\n- Always use read_file to examine code before referencing it\n- Tasks should be small (single commit) but complete (testable)\n- Every acceptance criterion must have a task\n- Use current_timestamp for timestamps\n- Order tasks logically\n- You create tasks/stories only - no direct code edits unless specifically asked to do so\n- When creating first epic, focus on proper setup/scaffolding\n- Always stop and present plan to user before detailed breakdown\n\nWhat follows may be more specific instructions which should be followed in preference to the general instructions above...\n`;return d.default.debug(`Architect Agent system prompt for workspace '${e.workspace.name}' (length: ${t.length} chars): ${t}`),t}};t.ArchitectAgentService=h,t.ArchitectAgentService=h=n([(0,a.Injectable)(),i(0,(0,a.Inject)((0,a.forwardRef)((()=>u.GraphAgentCollaborator)))),o("design:paramtypes",[u.GraphAgentCollaborator,l.ToolFactoryService,c.AgentRuleService])],h)},7249:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StandardAgentStateManager=void 0;const n=r(9314),o=r(8804);t.StandardAgentStateManager=class{static createGraphState(){return{messages:{reducer:(e,t)=>e.concat(t)}}}static shouldContinue(e){const t=e.messages,r=t[t.length-1];return r.tool_calls?.length?"tools":"__end__"}static createWorkflow(e,t){const r=this.createGraphState(),i=new o.ToolNode(t);return new n.StateGraph({channels:r}).addNode("agent",(async t=>await e(t))).addNode("tools",i).addEdge("__start__","agent").addConditionalEdges("agent",this.shouldContinue).addEdge("tools","agent")}}},7252:e=>{"use strict";e.exports=require("express")},7265:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.GitController=void 0;const s=r(3563),a=r(5190);let c=class{constructor(e){this.gitService=e}async getGitLog(e){try{return await this.gitService.getGitLog(e)}catch(t){if(t.message.includes("not found"))throw new s.HttpException(`Workspace ${e} not found`,s.HttpStatus.NOT_FOUND);if(t.message.includes("not a git repository"))throw new s.HttpException("Workspace is not a git repository",s.HttpStatus.BAD_REQUEST);throw new s.HttpException(`Failed to get git log: ${t.message}`,s.HttpStatus.INTERNAL_SERVER_ERROR)}}async getGitDiff(e,t){try{return await this.gitService.getGitDiff(e,t)}catch(t){if(t.message.includes("not found"))throw new s.HttpException(`Workspace ${e} not found`,s.HttpStatus.NOT_FOUND);throw new s.HttpException(`Failed to get git diff: ${t.message}`,s.HttpStatus.INTERNAL_SERVER_ERROR)}}async undoLastCommit(e){try{await this.gitService.undoLastCommit(e)}catch(t){if(t.message.includes("not found"))throw new s.HttpException(`Workspace ${e} not found`,s.HttpStatus.NOT_FOUND);throw new s.HttpException(`Failed to undo last commit: ${t.message}`,s.HttpStatus.INTERNAL_SERVER_ERROR)}}};t.GitController=c,n([(0,s.Get)(":workspaceName/log"),i(0,(0,s.Param)("workspaceName")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],c.prototype,"getGitLog",null),n([(0,s.Get)(":workspaceName/diff/:hash"),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Param)("hash")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],c.prototype,"getGitDiff",null),n([(0,s.Post)(":workspaceName/undo-last-commit"),i(0,(0,s.Param)("workspaceName")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],c.prototype,"undoLastCommit",null),t.GitController=c=n([(0,s.Controller)("git"),o("design:paramtypes",[a.GitService])],c)},7307:function(__unused_webpack_module,exports,__webpack_require__){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__decorate=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},__importStar=this&&this.__importStar||(ownKeys=function(e){return ownKeys=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},ownKeys(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=ownKeys(e),n=0;n<r.length;n++)"default"!==r[n]&&__createBinding(t,e,r[n]);return __setModuleDefault(t,e),t}),ownKeys,__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},PluginLoaderService_1;Object.defineProperty(exports,"__esModule",{value:!0}),exports.PluginLoaderService=void 0;const common_1=__webpack_require__(3563),fs=__importStar(__webpack_require__(4652)),path=__importStar(__webpack_require__(6928)),graph_agent_collaborator_service_1=__webpack_require__(2300),graph_agent_service_1=__webpack_require__(5277),logger_1=__importDefault(__webpack_require__(9055)),tool_factory_service_1=__webpack_require__(6158),agent_rule_service_1=__webpack_require__(3470);let PluginLoaderService=PluginLoaderService_1=class PluginLoaderService{constructor(e,t,r){this.agentCollaborator=e,this.toolFactoryService=t,this.ruleService=r}async loadPlugins(){const e=[];try{const t=process.env.PLUGIN_DIR||path.join(__dirname,"..","..","plugins");if(logger_1.default.info(`[${PluginLoaderService_1.name}] Loading plugins from: ${t}`),!t)return logger_1.default.info(`[${PluginLoaderService_1.name}] PLUGIN_DIR not set, skipping plugin loading`),e;if(!await fs.pathExists(t))return logger_1.default.warn(`[${PluginLoaderService_1.name}] Plugin directory not found: ${t}`),e;const r=await fs.readdir(t);for(const n of r){const r=path.join(t,n,"plugin-config.json");if(await fs.pathExists(r)){const o=await fs.readJson(r),i=await this.loadPlugin(t,n,o);e.push(...i)}else logger_1.default.warn(`[${PluginLoaderService_1.name}] No plugin-config.json found for plugin: ${n}. Skipping.`)}}catch(e){logger_1.default.error(`[${PluginLoaderService_1.name}] Error loading plugins: ${e.message}\n${e.stack}`)}return e}async loadPlugin(e,t,r){logger_1.default.info(`[${PluginLoaderService_1.name}] Loading plugin: ${t}`);const n=[];if(r.agents)for(const[o,i]of Object.entries(r.agents)){const r=await this.loadAgent(e,t,o,i);r&&n.push(r)}if(r.tools)for(const[n,o]of Object.entries(r.tools))await this.loadTool(e,t,n,o);return r.tests&&await this.runTests(e,t,r.tests),n}async loadAgent(pluginDir,pluginName,agentName,agentFile){const agentPath=path.join(pluginDir,pluginName,agentFile);if(await fs.pathExists(agentPath))try{const AgentModule=eval("require")(agentPath),agentImplementation=AgentModule.default||AgentModule,agent=new graph_agent_service_1.GraphAgentService(this.agentCollaborator,this.toolFactoryService,this.ruleService);for(const e of Object.getOwnPropertyNames(agentImplementation))"function"==typeof agentImplementation[e]&&"constructor"!==e&&(logger_1.default.info(`[${PluginLoaderService_1.name}] Delegating method: ${e} to plugin: ${pluginName}/${agentName}`),agent[e]=async(...t)=>await agentImplementation[e](...t));return agent.getName=()=>agentName,logger_1.default.info(`[${PluginLoaderService_1.name}] Loaded agent: ${agentFile} from plugin: ${pluginName} with name: ${agent.getName()}`),agent}catch(e){logger_1.default.error(`[${PluginLoaderService_1.name}] Error loading agent: ${agentFile} from plugin: ${pluginName}\n${e.stack}`)}else logger_1.default.warn(`[${PluginLoaderService_1.name}] Agent file not found: ${agentPath}`);return null}async loadTool(pluginDir,pluginName,toolName,toolFile){logger_1.default.info(`[${PluginLoaderService_1.name}] Loading tool: ${toolName} (${toolFile}) from plugin: ${pluginName}`);const toolPath=path.join(pluginDir,pluginName,toolFile);if(await fs.pathExists(toolPath))try{const ToolModule=eval("require")(toolPath);"function"==typeof ToolModule.createTool?(this.toolFactoryService.registerTool(toolName,ToolModule.createTool),logger_1.default.info(`[${PluginLoaderService_1.name}] Loaded tool: ${toolName} (${toolFile}) from plugin: ${pluginName}`)):logger_1.default.warn(`[${PluginLoaderService_1.name}] Tool ${toolName} (${toolFile}) from plugin: ${pluginName} does not export a 'createTool' function`)}catch(e){logger_1.default.error(`[${PluginLoaderService_1.name}] Error loading tool: ${toolName} (${toolFile}) from plugin: ${pluginName}\n${e.stack}`)}}async runTests(e,t,r){for(const n of r){const r=path.join(e,t,n);if(await fs.pathExists(r))try{const e=await Promise.resolve(`${r}`).then((e=>__importStar(__webpack_require__(6002)(e))));"function"==typeof e.default&&await e.default(),logger_1.default.info(`[${PluginLoaderService_1.name}] Ran test: ${n} for plugin: ${t}`)}catch(e){logger_1.default.error(`[${PluginLoaderService_1.name}] Error running test: ${n} for plugin: ${t}\n${e.stack}`)}}}};exports.PluginLoaderService=PluginLoaderService,exports.PluginLoaderService=PluginLoaderService=PluginLoaderService_1=__decorate([(0,common_1.Injectable)(),__metadata("design:paramtypes",[graph_agent_collaborator_service_1.GraphAgentCollaborator,tool_factory_service_1.ToolFactoryService,agent_rule_service_1.AgentRuleService])],PluginLoaderService)},7310:e=>{"use strict";e.exports=require("@langchain/community/embeddings/hf_transformers")},7373:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionService=void 0;const s=r(3563),a=r(5312),c=r(573),l=r(4434),d=r(3936),u=r(9095),f=r(811),p=i(r(9055)),h=r(9100);let g=class{constructor(e,t,r){this.sessionRepository=e,this.itemRepository=t,this.requestRepository=r,this.eventEmitter=new l.EventEmitter}async getSessions(e=1,t=10,r="createdAt",n="DESC"){const{sessions:o,total:i}=await this.sessionRepository.findAll({page:e,limit:t},{field:r,order:n}),s=o.map((e=>e.sessionId)),a=await this.itemRepository.getSessionStats(s),c=await this.requestRepository.getSessionGitStats(s);return{sessions:o.map((e=>({...e,stats:{inputTokens:0,cacheWriteTokens:0,cacheReadTokens:0,outputTokens:0,totalTokens:0,cost:0,...a[e.sessionId]||{}},gitStats:{filesChanged:0,insertions:0,deletions:0,testFilesChanged:0,testInsertions:0,testDeletions:0,...c[e.sessionId]||{}}}))),total:i}}async getSessionStats(e){return{...(await this.itemRepository.getSessionStats([e]))[e]||{inputTokens:0,cacheWriteTokens:0,cacheReadTokens:0,outputTokens:0,totalTokens:0,cost:0}}}async getRequestStats(e){return{...(await this.itemRepository.getRequestStats([e]))[e]||{inputTokens:0,cacheWriteTokens:0,cacheReadTokens:0,outputTokens:0,totalTokens:0,cost:0}}}async ensureSession(e,t,r,n){const o=await this.sessionRepository.findById(t);if(o){if(o.workspaceName!==e)throw new Error(`Session ${t} exists but belongs to a different workspace`);if("active"===o.status)throw new Error(`Session ${t} is currently active`);return o.requestSnippet||(o.requestSnippet=r.slice(0,250),await this.sessionRepository.update(t,{requestSnippet:o.requestSnippet})),o}const i={sessionId:t,workspaceName:e,status:"inactive",createdAt:new Date,requestSnippet:r.slice(0,250),agent:n};return await this.sessionRepository.create(i),i}async getSession(e){return this.sessionRepository.findById(e)}async deleteSession(e){await this.sessionRepository.delete(e)}async deleteSessionForWorkspace(e,t){await this.sessionRepository.delete(t)}async addItem(e){return"AI"===e.label||"Human"===e.label?p.default.info("Adding item to session: %s with label: %s, content: %s",e.sessionId,e.label,e.content):p.default.debug("Adding item to session %s with label %s, content: %s",e.sessionId,e.label,e.content),await this.itemRepository.create(e),this.eventEmitter.emit("newItem",e),e}async getItemsForSession(e,t=1,r=100,n="ASC"){return[await this.itemRepository.findBySessionId(e,{page:t,limit:r},{field:"createdAt",order:n}),await this.itemRepository.countBySessionId(e)]}streamSessionItems(e){return new c.Observable((t=>{this.getItemsForSession(e).then((([e])=>{e.forEach((e=>{t.next({data:e})}))}));const r=r=>{r.sessionId===e&&t.next({data:r})};return this.eventEmitter.on("newItem",r),()=>{this.eventEmitter.removeListener("newItem",r)}}))}async updateSessionStatus(e,t){await this.sessionRepository.update(e,{status:t})}async abortSession(e){if(!await this.sessionRepository.findById(e))throw new s.NotFoundException(`Session with id ${e} not found`);return await this.updateSessionStatus(e,"aborted"),this.sessionRepository.findById(e)}generateSessionId(){return(0,h.ulid)()}generateItemId(){return(0,h.ulid)()}async addRequest(e){p.default.info("Adding request to session: %s, workspaceName: %s, requestContent: %s",e.sessionId,e.workspaceName,e.requestContent);const t=new a.Request(e.requestId||this.generateRequestId(),e.sessionId,e.workspaceName,e.requestContent,e);return await this.requestRepository.create(t),t}async updateRequest(e,t){return p.default.info("Updating request: %s, updateData: %s",e,JSON.stringify(t)),await this.requestRepository.updateRequest(e,t),this.requestRepository.findById(e)}generateRequestId(){return(0,h.ulid)()}async getRequest(e){return this.requestRepository.findById(e)}async updateGitStats(e,t){p.default.info("Updating git stats for request: %s, gitStats: %s",e,JSON.stringify(t)),await this.requestRepository.updateGitStats(e,t)}};t.SessionService=g,t.SessionService=g=n([(0,s.Injectable)(),o("design:paramtypes",[d.SessionRepository,u.ItemRepository,f.RequestRepository])],g)},7393:e=>{"use strict";e.exports=require("mammoth")},7403:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FileContentOptimizerService=void 0;const s=r(3563),a=i(r(9055)),c=r(4155);let l=class{constructor(e){this.responseFormatter=e}optimizeFileContent(e){if(e.length<=1)return e;const t=JSON.parse(JSON.stringify(e)),r={};t.forEach(((e,t)=>{for(const n of e.segments)if("text"===n.type){const e=this.extractFileContentPaths(n.content);for(const n of e)r[n]=t}}));for(let e=0;e<t.length;e++){const n=t[e];for(let o=0;o<n.segments.length;o++){const i=n.segments[o];"text"===i.type&&(t[e].segments[o].content=this.replaceOlderFileContent(i.content,e,r))}}return t}extractFileContentPaths(e){const t=/<file_content path="([^"]+)">/g,r=[];let n;for(;null!==(n=t.exec(e));)r.push(n[1]);return r}replaceOlderFileContent(e,t,r){const n=/<file_content path="([^"]+)">([\s\S]*?)<\/file_content>/g;let o=e;const i=[];let s;for(;null!==(s=n.exec(e));){const e=s[1],n=s[0];if(r[e]===t)continue;const o=`<file_content path="${e}">${this.responseFormatter.duplicateFileReadNotice()}</file_content>`;i.push({original:n,replacement:o}),a.default.debug(`[FileContentOptimizerService] Replacing older file_content block for ${e} at index ${t}`)}for(const{original:e,replacement:t}of i)o=o.replace(e,t);return o}};t.FileContentOptimizerService=l,t.FileContentOptimizerService=l=n([(0,s.Injectable)(),o("design:paramtypes",[c.ResponseFormatterService])],l)},7438:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ContextTruncationHandler=void 0;const a=r(3563),c=r(461),l=r(9100),d=s(r(9055)),u=r(136),f=r(1280),p=r(7485),h=r(4155);let g=n=class{constructor(e,t,r){this.agentStateManager=e,this.eventEmitter=t,this.responseFormatter=r}getTruncationStrategy(e){return this.agentStateManager.getTruncationStrategy(e)||{strategy:"preserve_recent",percentToRemove:25}}updateToNextTruncationStrategy(e){const t=this.getTruncationStrategy(e),r=(0,u.getNextTruncationStrategy)(t.strategy);return d.default.warn(`[${n.name}] Context window exceeded for task ${e}. Updating to next truncation strategy: ${r.strategy}, percentToRemove: ${r.percentToRemove}%`),this.agentStateManager.setTruncationStrategy(e,r),r}truncateHistory(e,t){const r=this.getTruncationStrategy(e);return(0,u.truncateConversationHistory)(t,r)}truncateWithNextStrategy(e,t,r){const o=this.updateToNextTruncationStrategy(e),i=(0,u.truncateConversationHistory)(t,o),s=t.length-i.length;if(d.default.info(`[${n.name}] Truncated history for task ${e}. Removed ${s} messages using strategy ${o.strategy}.`),s>0){const t={id:(0,l.ulid)(),taskId:e,role:"user",segments:[{type:"text",content:this.responseFormatter.contextTruncationNotice()}],providerId:"system",createdAt:new Date};i.unshift(t)}return r&&this.eventEmitter.emit(f.NotificationEvents.CONTEXT_TRUNCATED,{taskId:e,clientId:r,message:`Context window exceeded, removed ${s} messages using strategy ${o.strategy}.`,removedCount:s}),{truncatedHistory:i,removedCount:s}}};t.ContextTruncationHandler=g,t.ContextTruncationHandler=g=n=o([(0,a.Injectable)(),i("design:paramtypes",[p.AgentStateManager,c.EventEmitter2,h.ResponseFormatterService])],g)},7465:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteFile=void 0;const c=r(5534),l=r(1569),d=s(r(9896)),u=s(r(6928)),f=a(r(9055));class p extends c.Tool{constructor(e){super(),this.name="delete_file",this.description="Delete a file from the workspace",this.schema=l.z.object({filePath:l.z.string().describe("The relative path of the file to delete")}),this.workspaceRootDir=e}async _call(e){return this.deleteFile(e.filePath)}deleteFile(e){const t=u.join(this.workspaceRootDir,e);try{return d.existsSync(t)?(f.default.info(`Deleting file: ${e}`),d.unlinkSync(t),`Successfully deleted file: ${e}`):`Error: File not found - ${e}`}catch(e){return`Error deleting file: ${e.message}`}}}t.DeleteFile=p},7485:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentStateManager=void 0;const a=r(3563),c=s(r(9055)),l=r(6297),d=r(1302);let u=n=class{constructor(){this.isAborting=new Map,this.abortControllers=new Map,this.consecutiveMistakeCount=new Map,this.consecutiveToolFailures=new Map,this.truncationStrategies=new Map}setTaskAborting(e,t){if(t){this.isAborting.set(e,!0),this.abortControllers.has(e)||this.abortControllers.set(e,new AbortController);const t=this.abortControllers.get(e);return t.signal.aborted?(c.default.info(`[${n.name}] Task ${e} already aborted`),l.debugLogger.log(`Task ${e} already aborted, signal state: ${t.signal.aborted}`)):(t.abort(),c.default.info(`[${n.name}] Task ${e} marked for abortion and AbortController aborted`),l.debugLogger.log(`AbortSignal created for task ${e}, aborted state: ${t.signal.aborted}`)),t.signal}return this.isAborting.delete(e),this.abortControllers.set(e,new AbortController),void c.default.info(`[${n.name}] Abortion flag removed for task ${e} and new AbortController created`)}isTaskAborting(e){return this.isAborting.get(e)||!1}getAbortSignal(e){const t=this.abortControllers.get(e);return t?.signal}getOrCreateAbortSignal(e){return this.abortControllers.has(e)||this.abortControllers.set(e,new AbortController),this.abortControllers.get(e).signal}setupStreamAbortHandling(e,t,r){const o=this.getAbortSignal(t);if(o)(0,d.setupAbortHandling)(e,r,o);else{c.default.info(`[${n.name}] No abort signal for task ${t}, creating one`);const o=this.getOrCreateAbortSignal(t);(0,d.setupAbortHandling)(e,r,o)}}getMistakeCount(e){return this.consecutiveMistakeCount.get(e)||0}setMistakeCount(e,t){this.consecutiveMistakeCount.set(e,t)}incrementMistakeCount(e){const t=this.getMistakeCount(e)+1;return this.setMistakeCount(e,t),t}resetMistakeCount(e){this.setMistakeCount(e,0)}getToolFailureCount(e,t){return(this.consecutiveToolFailures.get(e)||{})[t]||0}setToolFailureCount(e,t,r){const n=this.consecutiveToolFailures.get(e)||{};n[t]=r,this.consecutiveToolFailures.set(e,n)}incrementToolFailureCount(e,t){const r=this.getToolFailureCount(e,t)+1;return this.setToolFailureCount(e,t,r),r}resetToolFailureCount(e,t){this.setToolFailureCount(e,t,0)}getTruncationStrategy(e){return this.truncationStrategies.get(e)}setTruncationStrategy(e,t){this.truncationStrategies.set(e,t)}cleanupTask(e){this.isAborting.delete(e),this.consecutiveMistakeCount.delete(e),this.consecutiveToolFailures.delete(e),this.truncationStrategies.delete(e),this.abortControllers.delete(e),c.default.info(`[${n.name}] Cleaned up state for task ${e}`)}};t.AgentStateManager=u,t.AgentStateManager=u=n=o([(0,a.Injectable)(),i("design:paramtypes",[])],u)},7510:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReportingService=void 0;const a=r(3563),c=(r(1832),s(r(9055))),l=r(2368),d=r(6910);let u=class{constructor(e,t){this.knex=e,this.configService=t}async generateReport(e,t,r,n){try{const{startDate:o,endDate:i}=this.resolveDateRange(e,t,r),s=await this.getRequestTotalsData(o,i,n);return{requestTotals:s,dailyMetrics:await this.getHistoricStats(o,i,n),dateRange:{startDate:o,endDate:i}}}catch(e){throw c.default.error(`Error generating report: ${e.message}`,e.stack),e}}resolveDateRange(e,t,r){const n=new Date;let o,i;try{if(e&&t)o=new Date(e),i=new Date(t),i.setHours(23,59,59,999);else if(r)switch(i=new Date(n),i.setHours(23,59,59,999),r){case"today":o=new Date(n),o.setHours(0,0,0,0);break;case"this-week":o=new Date(n),o.setDate(o.getDate()-7),o.setHours(0,0,0,0);break;case"this-month":o=new Date(n),o.setDate(o.getDate()-30),o.setHours(0,0,0,0);break;case"all-time":o=new Date(n),o.setDate(o.getDate()-90),o.setHours(0,0,0,0);break;default:throw new Error("Invalid period specified")}else o=new Date(n),o.setDate(o.getDate()-90),o.setHours(0,0,0,0),i=new Date(n),i.setHours(23,59,59,999);return{startDate:o,endDate:i}}catch(e){throw c.default.error(`Error resolving date range: ${e.message}`,e.stack),e}}async getRequestTotalsData(e,t,r){try{let n=this.knex("requests").select(this.knex.raw("COUNT(*) as totalRequests"),this.knex.raw("COALESCE(SUM(tookMillis), 0) as totalProcessingMillis"),this.knex.raw("COALESCE(AVG(tookMillis), 0) as avgProcessingMillis"),this.knex.raw("COALESCE(SUM(inputTokens), 0) as totalInputTokens"),this.knex.raw("COALESCE(SUM(outputTokens), 0) as totalOutputTokens"),this.knex.raw("COALESCE(SUM(totalTokens), 0) as totalTokens"),this.knex.raw("COALESCE(SUM(cost), 0) as totalCost"),this.knex.raw("COALESCE(AVG(cost), 0) as avgCostPerRequest"),this.knex.raw("COALESCE(SUM(CASE WHEN linesChanged <= 500 THEN linesChanged ELSE 0 END), 0) as totalLinesChanged"),this.knex.raw("COALESCE(AVG(CASE WHEN linesChanged <= 500 THEN linesChanged ELSE NULL END), 0) as avgLinesChangedPerRequest"),this.knex.raw("COALESCE(SUM(filesChanged), 0) as totalFilesChanged"),this.knex.raw("COALESCE(SUM(insertions), 0) as totalInsertions"),this.knex.raw("COALESCE(SUM(deletions), 0) as totalDeletions"),this.knex.raw("COALESCE(SUM(CASE WHEN linesChanged <= 500 THEN testLinesChanged ELSE 0 END), 0) as totalTestLinesChanged"),this.knex.raw("COALESCE(SUM(testFilesChanged), 0) as totalTestFilesChanged"),this.knex.raw("COALESCE(SUM(testInsertions), 0) as totalTestInsertions"),this.knex.raw("COALESCE(SUM(testDeletions), 0) as totalTestDeletions"),this.knex.raw("COALESCE(SUM(cacheReadTokens), 0) as totalCacheReadTokens"),this.knex.raw("COALESCE(SUM(cacheWriteTokens), 0) as totalCacheWriteTokens")).whereBetween("startedAt",[e,t]);r&&""!==r.trim()&&(n=n.where("workspaceName",r));const o=await n.first(),i=o.totalLinesChanged-o.totalTestLinesChanged,s=o.totalFilesChanged-o.totalTestFilesChanged,a=o.totalLinesChanged>0?o.totalCost/o.totalLinesChanged:0,c=this.configService.getNumericProperty(d.ConfigPropNames.VALUE_PER_LINE)||2.4,l=o.totalLinesChanged*c,u=o.totalRequests>0?l/o.totalRequests:0,f=o.totalInputTokens+o.totalCacheReadTokens>0?100*o.totalCacheReadTokens/(o.totalInputTokens+o.totalCacheReadTokens):0;return{totalRequests:o.totalRequests,totalProcessingMillis:o.totalProcessingMillis,avgProcessingMillis:o.avgProcessingMillis,totalInputTokens:o.totalInputTokens,totalOutputTokens:o.totalOutputTokens,totalTokens:o.totalTokens,totalCost:o.totalCost,avgCostPerRequest:o.avgCostPerRequest,avgCostPerLine:a,totalLinesChanged:o.totalLinesChanged,totalFilesChanged:o.totalFilesChanged,totalInsertions:o.totalInsertions,totalDeletions:o.totalDeletions,totalTestLinesChanged:o.totalTestLinesChanged,totalTestFilesChanged:o.totalTestFilesChanged,totalTestInsertions:o.totalTestInsertions,totalTestDeletions:o.totalTestDeletions,totalProductionLinesChanged:i,totalProductionFilesChanged:s,totalValueCreated:l,avgValueCreatedPerRequest:u,avgLinesChangedPerRequest:o.avgLinesChangedPerRequest,totalCacheReadTokens:o.totalCacheReadTokens,totalCacheWriteTokens:o.totalCacheWriteTokens,inputCacheHitPercentage:f}}catch(e){throw c.default.error(`Error getting request totals data: ${e.message}`,e.stack),e}}async getHistoricStats(e,t,r){try{let n=this.knex("requests").select(this.knex.raw("strftime('%Y-%m-%d', datetime(startedAt/1000, 'unixepoch')) as label"),this.knex.raw("COALESCE(SUM(CASE WHEN linesChanged <= 500 THEN linesChanged ELSE 0 END), 0) as linesChanged"),this.knex.raw("COALESCE(SUM(cost), 0) as cost"),this.knex.raw("COUNT(*) as requests"),this.knex.raw("COALESCE(SUM(tookMillis), 0) as processingTime")).whereBetween("startedAt",[e,t]);r&&""!==r.trim()&&(n=n.where("workspaceName",r)),n=n.groupBy("label").orderBy("label","asc"),c.default.debug(`Query: ${n.toString()}`);const o=await n,i=this.configService.getNumericProperty(d.ConfigPropNames.VALUE_PER_LINE)||2.4;return o.map((e=>({label:e.label,linesChanged:e.linesChanged,cost:e.cost,valueCreated:e.linesChanged*i,requests:e.requests,processingTime:e.processingTime})))}catch(e){throw c.default.error(`Error getting historic stats: ${e.message}`,e.stack),e}}};t.ReportingService=u,t.ReportingService=u=n([(0,a.Injectable)(),i(0,(0,a.Inject)("KNEX")),o("design:paramtypes",[Function,l.ConfigService])],u)},7516:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ContextManagerService=void 0;const a=r(3563),c=s(r(9055));let l=n=class{constructor(){c.default.info(`[${n.name}] ContextManagerService initialized`)}getNewContextMessagesAndMetadata(e,t,r,n,o){let i=!1;if(o>=0){const s=t[o];if(s&&s.text){const{tokensIn:t,tokensOut:o,cacheWrites:a,cacheReads:c}=JSON.parse(s.text),l=(t||0)+(o||0)+(a||0)+(c||0);let d,u=r.getModel().info.contextWindow||128e3;switch(u){case 64e3:d=u-27e3;break;case 128e3:d=u-3e4;break;case 2e5:d=u-4e4;break;default:d=Math.max(u-4e4,.8*u)}if(l>=d){const t=l/2>d?"quarter":"half";n=this.getNextTruncationRange(e,n,t),i=!0}}}return{conversationHistoryDeletedRange:n,updatedConversationHistoryDeletedRange:i,truncatedConversationHistory:this.getTruncatedMessages(e,n)}}getNextTruncationRange(e,t,r){const n=t?t[1]+1:1;let o;o="half"===r?2*Math.floor((e.length-n)/4):2*Math.floor(3*(e.length-n)/4/2);let i=n+o-1;return"user"!==e[i]?.role&&(i-=1),[1,i]}getTruncatedMessages(e,t){if(!t)return e;const[r,n]=t;return[...e.slice(0,r),...e.slice(n+1)]}};t.ContextManagerService=l,t.ContextManagerService=l=n=o([(0,a.Injectable)(),i("design:paramtypes",[])],l)},7526:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.IgnoreConfigService=void 0;const u=r(3563),f=c(r(1943)),p=c(r(6928)),h=d(r(526)),g=d(r(9055)),m=r(8756);let y=o=class{constructor(){this.gitIgnoreCache=new Map,this.eveIgnoreCache=new Map,this.eveIncludeCache=new Map,g.default.info(`[${o.name}] IgnoreConfigService initialized`)}async getGitIgnoreInstance(e){const t=p.join(e,".gitignore");try{const r=(await f.stat(t)).mtime.getTime(),n=this.gitIgnoreCache.get(e);if(n&&n.mtime===r)return n.ignoreInstance;const i=await f.readFile(t,"utf-8"),s=(0,h.default)().add([".git"]).add(i);return this.gitIgnoreCache.set(e,{mtime:r,ignoreInstance:s}),g.default.debug(`[${o.name}] Parsed .gitignore for ${e}`),s}catch(t){if("ENOENT"===t.code){const t=(0,h.default)().add([".git"]);return this.gitIgnoreCache.set(e,{mtime:0,ignoreInstance:t}),t}throw g.default.error(`[${o.name}] Error reading .gitignore: ${t.message}`),t}}async getEveIgnoreInstance(e){const t=p.join(e,".eveignore");try{const r=(await f.stat(t)).mtime.getTime(),n=this.eveIgnoreCache.get(e);if(n&&n.mtime===r)return n.ignoreInstance;const i=await f.readFile(t,"utf-8"),s=(0,h.default)().add(i);return this.eveIgnoreCache.set(e,{mtime:r,ignoreInstance:s}),g.default.debug(`[${o.name}] Parsed .eveignore for ${e}`),s}catch(t){if("ENOENT"===t.code){const t=(0,h.default)();return this.eveIgnoreCache.set(e,{mtime:0,ignoreInstance:t}),t}throw g.default.error(`[${o.name}] Error reading .eveignore: ${t.message}`),t}}async getEveIncludePatterns(e){const t=p.join(e,".eveinclude");try{const r=(await f.stat(t)).mtime.getTime(),n=this.eveIncludeCache.get(e);if(n&&n.mtime===r)return n.patterns;const i=(await f.readFile(t,"utf-8")).split("\n").map((e=>e.trim())).filter((e=>e&&!e.startsWith("#")));return this.eveIncludeCache.set(e,{mtime:r,patterns:i}),g.default.debug(`[${o.name}] Parsed .eveinclude for ${e}: ${i.length} patterns`),i}catch(t){if("ENOENT"===t.code)return this.eveIncludeCache.set(e,{mtime:0,patterns:[]}),[];throw g.default.error(`[${o.name}] Error reading .eveinclude: ${t.message}`),t}}createGitIgnoreFilter(e){const t=async t=>{if(""===t.path)return"include";const r=await this.getGitIgnoreInstance(e),n=r.ignores(t.path);if(!n&&t.isDir){const e=t.path.endsWith("/")?t.path:`${t.path}/`;if(r.ignores(e))return"exclude"}if(!n){const e=t.path.split("/");let n="";for(let t=0;t<e.length-1;t++)if(n=n?`${n}/${e[t]}`:e[t],r.ignores(n)||r.ignores(`${n}/`))return"exclude"}return n?"exclude":"include"};return Object.defineProperty(t,"name",{value:"gitIgnoreFilter",writable:!0}),t}createEveIgnoreFilter(e){const t=async t=>{if(""===t.path)return"include";return(await this.getEveIgnoreInstance(e)).ignores(t.path)?"exclude":"include"};return Object.defineProperty(t,"name",{value:"eveIgnoreFilter",writable:!0}),t}createEveIncludeFilter(e){const t=async t=>{if(""===t.path)return"include";const r=await this.getEveIncludePatterns(e);if(0===r.length)return"include";for(const e of r)if(this.matchesPattern(t.path,e))return"include";for(const e of r){const r=e.endsWith("/")?e:`${e}/`;if(t.path.startsWith(r.substring(0,r.length-1))||`${t.path}/`.startsWith(r))return"include"}if(t.isDir)for(const e of r)if(e.startsWith(`${t.path}/`))return"include";return"exclude"};return Object.defineProperty(t,"name",{value:"eveIncludeFilter",writable:!0}),t}matchesPattern(e,t){return t.endsWith("/")&&!e.endsWith("/")&&(e=`${e}/`),(0,m.minimatch)(e,t,{dot:!0})}};t.IgnoreConfigService=y,t.IgnoreConfigService=y=o=a([(0,u.Injectable)(),l("design:paramtypes",[])],y)},7600:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReadDependencySourceTree=void 0;const n=r(5534),o=r(1569);class i extends n.Tool{constructor(e){super(),this.name="read_dependency_source_tree",this.description='Read the source tree hierarchy (directories and file names only) of a dependency, using the package manager scheme (e.g. "maven") and locator (e.g. "com.example:example:1.0.0"). \n  Use this tool if you need to know more about how to use a specific dependency.\n  Look in the build file (e.g. pom.xml or build.gradle) or package metadata (e.g. package.json) and then use that to build the correct scheme and locator.\n  Currently only maven is supported so the scheme is always "maven" and the locator is always a Maven GAV tuple (group:artifact:version).\n  If no repository URLs are provided then the default Maven central repository will be used.\n  ',this.schema=o.z.object({input:o.z.string().describe("A JSON string containing packageManagerScheme, locator, and optional repositoryUrls")}),this.sourceArtefactService=e}async _call(e){const{packageManagerScheme:t,locator:r,repositoryUrls:n}=JSON.parse(e.input);try{return await this.sourceArtefactService.readArtefactSourceTree(t,r,n)}catch(e){return`Error: Unable to read dependency source tree. ${e instanceof Error?e.message:"Unknown error occurred"}`}}}t.ReadDependencySourceTree=i},7602:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.MutationsService=void 0;const i=r(3563),s=r(672);let a=class{constructor(e){this.mutationRepository=e}async getMutationsForSession(e){return(await this.mutationRepository.findBySessionId(e,void 0,{field:"updatedAt",order:"DESC"})).map((e=>({id:e.id,type:e.type,filePath:e.filePath,updatedAt:e.updatedAt,description:e.description,fileContentsBefore:e.fileContentsBefore,fileContentsAfter:e.fileContentsAfter,requestId:e.requestId})))}async getMutation(e){return this.mutationRepository.findById(e)}async getMutationsForRequest(e){return(await this.mutationRepository.findByRequestId(e)).map((e=>({id:e.id,type:e.type,filePath:e.filePath,updatedAt:e.updatedAt,description:e.description,fileContentsBefore:e.fileContentsBefore,fileContentsAfter:e.fileContentsAfter,requestId:e.requestId})))}async createMutation(e){if(!e.sessionId)throw new Error("sessionId is required to create a mutation");if(!e.requestId)throw new Error("requestId is required to create a mutation");return await this.mutationRepository.create({...e,updatedAt:e.updatedAt||new Date})}};t.MutationsService=a,t.MutationsService=a=n([(0,i.Injectable)(),o("design:paramtypes",[s.MutationRepository])],a)},7607:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoredFile=void 0;const n=r(9100);t.StoredFile=class{constructor(e,t,r,o,i,s=(0,n.ulid)(),a=new Date){this.id=s,this.originalFilename=e,this.fileContents=t,this.mimeType=r,this.sessionId=o,this.workspaceName=i,this.createdAt=a}}},7627:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createStreamProcessor=function(e,t,r){return{async*processStream(a,c,l){const d={value:""};let u="",f=0,p="";t.reset(),t.setInToolUse(!1);try{i.default.info("[StreamProcessor] Starting to process stream");for await(const e of a){if(l?.aborted){i.default.info(`[StreamProcessor] Abort signal detected during stream processing after ${f} chunks`);break}f++,s.debugLogger.dumpObject(`Raw Gemini chunk #${f}`,e);let t="",o=!1;try{t=e.text(),t=t.replace(/\\n/g,"\n"),e.candidates&&e.candidates[0]&&e.candidates[0].content&&e.candidates[0].content.finishReason&&(o=!0,i.default.info(`[StreamProcessor] Detected finishReason: ${e.candidates[0].content.finishReason}`))}catch(t){if(i.default.warn(`[StreamProcessor] Chunk #${f} has no text content.`),!(e.candidates&&e.candidates[0]&&e.candidates[0].content&&e.candidates[0].content.finishReason))continue;o=!0,i.default.info(`[StreamProcessor] Detected finishReason: ${e.candidates[0].content.finishReason} in textless chunk`)}u+=t;let a=p+t;p="",r.shouldBufferChunk(a)?(a.length<10?i.default.info(`[StreamProcessor] Buffering small chunk (${a.length} chars)`):r.endsWithBacktickOrPartialFence(a)?i.default.info("[StreamProcessor] Buffering chunk ending with potential fence marker"):r.endsWithTagStartOrPartialTag(a)&&i.default.info("[StreamProcessor] Buffering chunk ending with potential tag marker"),p=a):yield*n(a,d,o)}i.default.info(`[StreamProcessor] Finished processing stream loop with ${f} chunks`),p.length>0&&(i.default.info(`[StreamProcessor] Processing final buffered content: ${p.length} chars`),yield*n(p,d,!0),p=""),yield*e.finishCurrentBlockIfNeeded(),t.resetFencedToolCallState();const h={id:(0,o.ulid)(),taskId:c,role:"assistant",segments:[{type:"text",content:u}],providerId:"gemini",providerMetadata:{format:"structured"},createdAt:new Date};s.debugLogger.dumpObject("[StreamProcessor] Emitting final messageInterchange:",h),yield{type:"messageInterchange",messageInterchange:h}}catch(t){throw i.default.error(`[StreamProcessor] Error processing stream: ${t.message}`,t.stack),("AbortError"===t.name||t.message.includes("aborted"))&&i.default.info(`[StreamProcessor] Detected abort error during stream processing: ${t.message}`),yield*e.startNewBlock("error",null,`Stream processing error: ${t.message}`),yield*e.finishCurrentBlockIfNeeded(),t}}};async function*n(n,o,s){if(r.isToolUseStartTag(n)&&!t.isInToolUse()){const i=n.split("<tool_use>",2);i[0].length>0&&(yield*e.appendOrStartText(i[0],o)),t.setInToolUse(!0);const s=n.substring(i[0].length+10),a=r.extractToolFromToolUse(s);if(a.toolName&&a.content&&(yield*e.createToolCallBlockFromContent(a.toolName,a.content),r.isToolUseEndTag(s))){t.setInToolUse(!1);const r=s.indexOf("</tool_use>");if(-1!==r&&r+11<s.length){const t=s.substring(r+11);yield*e.appendOrStartText(t,o)}}return}if(t.isInToolUse()){const i=r.extractToolFromToolUse(n);if(i.toolName&&i.content&&(yield*e.createToolCallBlockFromContent(i.toolName,i.content)),r.isToolUseEndTag(n)){t.setInToolUse(!1);const r=n.indexOf("</tool_use>");if(-1!==r&&r+11<n.length){const t=n.substring(r+11);yield*e.appendOrStartText(t,o)}}return}if(n.includes("```xml")&&!t.isInXmlFence()){const c=n.split("```xml",2);c[0].length>0&&(yield*e.appendOrStartText(c[0],o)),yield*e.finishCurrentBlockIfNeeded(),t.setInXmlFence(!0);const l=r.extractAfterFencedXmlStart(n),d=r.findPotentialToolName(l);if(d){i.default.info(`[StreamProcessor] Detected potential tool call in fenced XML: ${d}`),t.setInFencedToolCall(!0),t.setFencedToolCallName(d),t.setFencedXmlStarted(!0),t.setFencedXmlComplete(!1);const r=`<${d}>`;yield*e.startNewBlock("tool_call",d,r),yield*a(l,o,s)}else i.default.warn("[StreamProcessor] Found ```xml but no recognized tool tag immediately after. Treating as code."),yield*e.appendOrStartText(n,o);return}if(t.isInXmlFence())return t.isInFencedToolCall()?yield*a(n,o,s):yield*e.appendOrStartText(n,o),void(r.containsCompleteFenceEnd(n)&&t.setInXmlFence(!1));const c=r.findToolCallStart(n);if(c.found){const r=n.substring(0,c.index);r.length>0&&(yield*e.appendOrStartText(r,o),yield*e.finishCurrentBlockIfNeeded()),t.setInToolCall(!0),t.setCurrentToolName(c.toolName);const a=n.substring(c.index+c.length),l=`<${c.toolName}>`;return yield*e.startNewBlock("tool_call",c.toolName,l),void(yield*async function*(r,n,o){const s=t.getCurrentToolName();if(!s)return void i.default.error("[StreamProcessor] In tool call but no tool name set!");const a=`</${s}>`,c=r.indexOf(a);if(-1!==c){const o=r.substring(0,c);if(o.length>0){const t=e.safeEmitUpdate({appendContent:o});t&&(yield t),n.value+=o}const i=e.safeEmitUpdate({appendContent:a,newStatus:"finished"});i&&(yield i),n.value+=a,t.setBlockGenerating(!1),t.setCurrentBlockId(null),t.setCurrentBlockType(null),t.setCurrentTagName(null),t.setInToolCall(!1),t.setCurrentToolName(null);const s=r.substring(c+a.length);s.length>0&&(yield*e.appendOrStartText(s,n))}else{if(r.length>0){const t=e.safeEmitUpdate({appendContent:r});t&&(yield t),n.value+=r}if(o){i.default.warn(`[StreamProcessor] Stream finished, but closing tag </${s}> not found. Finishing block.`);const r=e.safeEmitUpdate({newStatus:"finished"});r&&(yield r),t.setBlockGenerating(!1),t.setCurrentBlockId(null),t.setCurrentBlockType(null),t.setCurrentTagName(null),t.setInToolCall(!1),t.setCurrentToolName(null)}}}(a,o,s))}s?yield*e.appendAndFinishText(n,o):yield*e.appendOrStartText(n,o)}async function*a(r,n,o){const s=r.search(/```\s*($|\n)/);if(-1!==s){const o=r.substring(0,s);if(o.length>0){const r=e.safeEmitUpdate({appendContent:o,newStatus:"finished"});r&&(yield r),n.value+=o,t.setBlockGenerating(!1),t.setCurrentBlockId(null),t.setCurrentBlockType(null),t.setCurrentTagName(null)}else{const r=e.safeEmitUpdate({newStatus:"finished"});r&&(yield r),t.setBlockGenerating(!1),t.setCurrentBlockId(null),t.setCurrentBlockType(null),t.setCurrentTagName(null)}t.setFencedXmlComplete(!0);const i=/```\s*($|\n)/.exec(r);if(i&&i.index+i[0].length<r.length){const t=r.substring(i.index+i[0].length);yield*e.appendOrStartText(t,n)}t.resetFencedToolCallState(),t.setInXmlFence(!1)}else{if(r.length>0){const t=e.safeEmitUpdate({appendContent:r});t&&(yield t),n.value+=r}if(o){i.default.warn("[StreamProcessor] Stream finished, but end fence ``` not found for tool call. Finishing block.");const r=e.safeEmitUpdate({newStatus:"finished"});r&&(yield r),t.setBlockGenerating(!1),t.setCurrentBlockId(null),t.setCurrentBlockType(null),t.setCurrentTagName(null),t.resetFencedToolCallState(),t.setInXmlFence(!1)}}}};const o=r(9100),i=n(r(9055)),s=r(6297)},7650:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToolResult=t.ToolError=void 0;class r extends Error{constructor(e){super(e),this.name="ToolError"}}t.ToolError=r;class n{constructor(e="",t="",r=null){this.output=e,this.error=t,this.base64_image=r}replace({output:e=null,error:t=null,base64_image:r=null}){return new n(null!==e?e:this.output,null!==t?t:this.error,null!==r?r:this.base64_image)}}t.ToolResult=n},7655:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Story=t.StoryStatus=void 0;const n=r(9100);var o;!function(e){e.BACKLOG="backlog",e.IN_PROGRESS="in_progress",e.DONE="done"}(o||(t.StoryStatus=o={}));t.Story=class{constructor(e,t,r=[],i=o.BACKLOG,s=(0,n.ulid)(),a=new Date,c=new Date){this.id=s,this.title=e,this.description=t,this.status=i,this.acceptanceCriteria=r,this.createdAt=a,this.updatedAt=c}}},7660:e=>{"use strict";e.exports=require("tree-sitter-javascript")},7663:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserPromptHandler=void 0;const a=r(3563),c=s(r(9055)),l=r(6297),d=r(461),u=r(6550),f=r(6349),p=r(9100),h=r(5324),g=r(6963),m=r(1280),y=r(5444),v=r(8474),_=r(6724);let w=n=class{constructor(e,t,r,n,o,i,s){this.taskService=e,this.conversationHistoryService=t,this.blockService=r,this.agentLoopOrchestrator=n,this.eventEmitter=o,this.mainWorkspaceService=i,this.mentionsService=s}async handleUserPrompt(e,t){c.default.info(`[${n.name}] Processing userPrompt for task ${e.taskId} from client ${t}`),l.debugLogger.log(`[${n.name}] Received userPrompt for task ${e.taskId}`,e);try{const r=await this.taskService.getTask(e.taskId);if(!r)return c.default.error(`[${n.name}] Task not found: ${e.taskId}`),void this.eventEmitter.emit(m.InternalEvents.AGENT_ERROR_NOTIFICATION,{clientId:t,taskId:e.taskId,error:`Task not found: ${e.taskId}`,type:"task_error",context:{source:"handleUserPromptValidation"}});if(r.status===y.TaskStatus.EXECUTING_TOOL)return c.default.warn(`[${n.name}] Rejecting user prompt for task ${e.taskId} (status: ${y.TaskStatus.EXECUTING_TOOL})`),void this.eventEmitter.emit(m.InternalEvents.AGENT_ERROR_NOTIFICATION,{clientId:t,taskId:e.taskId,error:"Cannot accept new prompt while a tool is executing.",type:"task_error",context:{source:"handleUserPromptValidation"}});let o=[];if(!(e.segments&&e.segments.length>0))return c.default.warn(`[${n.name}] No content provided in prompt for task ${e.taskId}`),void this.eventEmitter.emit(m.InternalEvents.AGENT_ERROR_NOTIFICATION,{clientId:t,taskId:e.taskId,error:"No content provided in prompt",type:"task_error",context:{source:"handleUserPromptValidation"}});{for(const t of e.segments)if("text"===t.type)o.push({type:"text",content:t.content});else if("image"===t.type){const e=t.metadata?.mediaType||(t.content.startsWith("data:image/png")?"image/png":t.content.startsWith("data:image/webp")?"image/webp":"image/jpeg");o.push({type:"image",content:t.content,metadata:{url:t.metadata?.url||t.content,mediaType:e}})}for(const t of o){const r=(0,p.ulid)();if("text"===t.type)await this.blockService.createBlock({blockId:r,taskId:e.taskId,role:"user",blockType:"text",status:"completed",content:t.content,description:"User Input (Text)"});else if("image"===t.type){const n=t.metadata?.mediaType||(t.content.startsWith("data:image/png")?"image/png":t.content.startsWith("data:image/webp")?"image/webp":"image/jpeg");await this.blockService.createBlock({blockId:r,taskId:e.taskId,role:"user",blockType:"image",status:"completed",content:t.content,metadata:JSON.stringify({url:t.metadata?.url||t.content,mediaType:n}),description:"User Input (Image)"})}}const t=o.findIndex((e=>"text"===e.type));if(-1!==t){const r=o[t].content,{originalTextSegment:n,fileContentSegments:i}=await this.mentionsService.processMentions(r,e.taskId);o[t]=n,o=[...o,...i]}}if(!r.originalPrompt&&o.length>0){const t=o.find((e=>"text"===e.type)),r=t?t.content.substring(0,200):"[Image message]";await this.taskService.updateTask({taskId:e.taskId,originalPrompt:r})}const i=r.workspaceName;if(r.status===y.TaskStatus.USER_CANCELLED&&(c.default.info(`[${n.name}] Restarting previously cancelled task ${e.taskId} with new prompt`),await this.taskService.updateTask({taskId:e.taskId,status:y.TaskStatus.WAITING_FOR_INPUT,result:JSON.stringify({details:"Task restarted with new prompt"})}),c.default.info(`[${n.name}] Task ${e.taskId} status updated from USER_CANCELLED to WAITING_FOR_INPUT`)),i){c.default.info(`[${n.name}] Task ${e.taskId} has workspaceName: ${i}. Validating...`);if(!await this.mainWorkspaceService.findOne(i))throw c.default.error(`[${n.name}] Workspace details not found for name: ${i}`),new a.NotFoundException(`Workspace with name ${i} not found during user prompt handling.`);c.default.info(`[${n.name}] Workspace ${i} validated.`)}else c.default.info(`[${n.name}] Task ${e.taskId} does not have a workspaceName associated.`);await this.taskService.updateTask({taskId:e.taskId,mode:e.mode}),c.default.info(`[${n.name}] Updated task ${e.taskId} mode to ${e.mode}`);const s={id:(0,p.ulid)(),taskId:e.taskId,role:"user",segments:o,providerId:"system",createdAt:new Date};await this.conversationHistoryService.addMessage(e.taskId,s),o.forEach(((t,r)=>{if("text"===t.type){const o=t.content.substring(0,200);l.debugLogger.log(`[${n.name}] Adding segment ${r} to history (Task ${e.taskId}): type=${t.type}, content='${o}...'`)}else l.debugLogger.log(`[${n.name}] Adding segment ${r} to history (Task ${e.taskId}): type=${t.type}`)}));const d=o.find((e=>"text"===e.type)),u=d?d.content.substring(0,100):"[Non-text segments]";c.default.info(`[${n.name}] Added user message with ${o.length} segments. First text segment: ${u}...`);(await this.taskService.getTask(e.taskId)).status===y.TaskStatus.WAITING_FOR_INPUT&&c.default.info(`[${n.name}] Task ${e.taskId} was waiting for user input. Agent loop will set status to IN_PROGRESS.`);const f=await this.conversationHistoryService.getHistory(e.taskId);if(c.default.info(`[${n.name}] Loaded updated history with ${f.length} messages`),f.length>0){const e=f.slice(-3);e.forEach(((t,r)=>{const o=f.length-e.length+r;c.default.info(`[${n.name}] History[${o}] role: ${t.role}, segments: ${t.segments.map((e=>e.type)).join(", ")}`);const i=t.segments.find((e=>"text"===e.type));if(i){const e=i.content.substring(0,100);c.default.info(`[${n.name}] History[${o}] content (first 100 chars): ${e}...`)}}))}await this.agentLoopOrchestrator.runAgentLoop(e.taskId,f,t,e.mode),c.default.info(`[${n.name}] Agent loop initiated for task ${e.taskId}.`)}catch(r){c.default.error(`[${n.name}] Error handling userPrompt for task ${e.taskId}: ${r.message}\n${r.stack}`),this.eventEmitter.emit(m.InternalEvents.AGENT_ERROR_NOTIFICATION,{clientId:t,taskId:e.taskId,error:r.message,type:"task_error",context:{source:"userPromptMainCatch"}})}}};t.UserPromptHandler=w,t.UserPromptHandler=w=n=o([(0,a.Injectable)(),i("design:paramtypes",[u.TaskService,f.ConversationHistoryService,h.BlockService,g.AgentLoopOrchestrator,d.EventEmitter2,v.WorkspaceService,_.MentionsService])],w)},7692:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AccessMcpResourceTool=void 0;const a=r(3563),c=s(r(9055)),l=r(2115);let d=n=class{constructor(e){this.mcpHubService=e,this.name="access_mcp_resource",this.description="Request to access a resource provided by a connected MCP server."}getUsageInstructions(e){return"## access_mcp_resource\nDescription: Request to access a resource provided by a connected MCP server. Resources represent data sources that can be used as context, such as files, API responses, or system information.\nParameters:\n- server_name: (required) The name of the MCP server providing the resource\n- uri: (required) The URI identifying the specific resource to access\nUsage:\n<access_mcp_resource>\n<server_name>server name here</server_name>\n<uri>resource URI here</uri>\n</access_mcp_resource>"}validateParams(e){return"string"==typeof e.server_name&&""!==e.server_name.trim()&&"string"==typeof e.uri&&""!==e.uri.trim()}async execute(e){const{server_name:t,uri:r}=e;c.default.info(`[${n.name}] Accessing MCP resource ${r} on server ${t}`);try{const e=await this.mcpHubService.readResource(t,r);return c.default.info(`[${n.name}] MCP resource ${r} accessed successfully`),e}catch(e){throw c.default.error(`[${n.name}] Error accessing MCP resource ${r}: ${e.message}\n${e.stack}`),new Error(`Error accessing MCP resource ${r}: ${e.message}`)}}};t.AccessMcpResourceTool=d,t.AccessMcpResourceTool=d=n=o([(0,a.Injectable)(),i("design:paramtypes",[l.McpHubService])],d)},7751:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComputerToolBase=void 0;const n=r(5534),o=r(1569);class i extends n.Tool{constructor(){super(),this.name="computer",this.description='Interact with the screen, keyboard, and mouse of the current computer. Available actions:\n    - key: Send keyboard key events (requires text parameter with key sequence)\n    - type: Type text directly (requires text parameter with content to type)\n    - mouse_move: Move mouse cursor to coordinates (requires coordinate parameter [x, y])\n    - left_click: Perform a left mouse click at current position\n    - left_click_drag: Click and drag from current position to coordinates (requires coordinate parameter [x, y])\n    - right_click: Perform a right mouse click at current position\n    - middle_click: Perform a middle mouse click at current position\n    - double_click: Perform a double click at current position\n    - screenshot: Take a screenshot of the current screen\n    - cursor_position: Get the current cursor position\n    \n    Example: {"action": "type", "text": "Hello World"} or {"action": "mouse_move", "coordinate": [100, 200]}',this.schema=o.z.object({input:o.z.string().optional()}).transform((e=>{try{return JSON.parse(e.input||"{}")}catch(e){return{}}})),this.scale=parseFloat(process.env.SCALE||"0.5"),(isNaN(this.scale)||this.scale<=0||this.scale>1)&&(console.warn(`Invalid SCALE value ${process.env.SCALE}, defaulting to 0.5`),this.scale=.5),this.width=process.env.WIDTH?parseInt(process.env.WIDTH,10):null,this.height=process.env.HEIGHT?parseInt(process.env.HEIGHT,10):null,this.maxOutputChars=2e3}clipString(e){return e.length>this.maxOutputChars?e.slice(-this.maxOutputChars):e}async _call(e){return this.execute(e)}}t.ComputerToolBase=i},7773:e=>{"use strict";e.exports=require("langchain/tools")},7781:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.EpicsController=void 0;const s=r(3563),a=r(8610);let c=class{constructor(e){this.epicsService=e}async getRequirements(e,t){return{content:await this.epicsService.getRequirements(e,t)}}async updateRequirements(e,t,r){return{content:await this.epicsService.updateRequirements(e,t,r.content)}}async findAll(e){return this.epicsService.findAllEpics(e)}async findOne(e,t){return this.epicsService.findEpicById(e,t)}async create(e,t){return this.epicsService.createEpic(e,t.title,t.description)}async update(e,t,r){return this.epicsService.updateEpic(e,t,r.title,r.description)}async remove(e,t){return this.epicsService.deleteEpic(e,t)}async addStory(e,t,r){return this.epicsService.addStory(e,t,r.title,r.description,r.acceptanceCriteria)}async updateStory(e,t,r,n){return this.epicsService.updateStory(e,t,r,n.title,n.description,n.acceptanceCriteria)}async getStory(e,t,r){return this.epicsService.getStory(e,t,r)}async removeStory(e,t,r){return this.epicsService.deleteStory(e,t,r)}async addTask(e,t,r,n){return this.epicsService.addTask(e,t,r,n.title,n.description)}async updateTask(e,t,r,n,o){return this.epicsService.updateTask(e,t,r,n,o.title,o.description,o.status)}async removeTask(e,t,r,n){return this.epicsService.deleteTask(e,t,r,n)}async getTasks(e,t,r){return this.epicsService.getTasks(e,t,r)}async getTask(e,t,r,n){return this.epicsService.getTask(e,t,r,n)}};t.EpicsController=c,n([(0,s.Get)(":epicId/requirements"),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Param)("epicId")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],c.prototype,"getRequirements",null),n([(0,s.Put)(":epicId/requirements"),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Param)("epicId")),i(2,(0,s.Body)()),o("design:type",Function),o("design:paramtypes",[String,String,Object]),o("design:returntype",Promise)],c.prototype,"updateRequirements",null),n([(0,s.Get)(),i(0,(0,s.Param)("workspaceName")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],c.prototype,"findAll",null),n([(0,s.Get)(":epicId"),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Param)("epicId")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],c.prototype,"findOne",null),n([(0,s.Post)(),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Body)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],c.prototype,"create",null),n([(0,s.Put)(":epicId"),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Param)("epicId")),i(2,(0,s.Body)()),o("design:type",Function),o("design:paramtypes",[String,String,Object]),o("design:returntype",Promise)],c.prototype,"update",null),n([(0,s.Delete)(":epicId"),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Param)("epicId")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],c.prototype,"remove",null),n([(0,s.Post)(":epicId/stories"),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Param)("epicId")),i(2,(0,s.Body)()),o("design:type",Function),o("design:paramtypes",[String,String,Object]),o("design:returntype",Promise)],c.prototype,"addStory",null),n([(0,s.Put)(":epicId/stories/:storyId"),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Param)("epicId")),i(2,(0,s.Param)("storyId")),i(3,(0,s.Body)()),o("design:type",Function),o("design:paramtypes",[String,String,String,Object]),o("design:returntype",Promise)],c.prototype,"updateStory",null),n([(0,s.Get)(":epicId/stories/:storyId"),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Param)("epicId")),i(2,(0,s.Param)("storyId")),o("design:type",Function),o("design:paramtypes",[String,String,String]),o("design:returntype",Promise)],c.prototype,"getStory",null),n([(0,s.Delete)(":epicId/stories/:storyId"),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Param)("epicId")),i(2,(0,s.Param)("storyId")),o("design:type",Function),o("design:paramtypes",[String,String,String]),o("design:returntype",Promise)],c.prototype,"removeStory",null),n([(0,s.Post)(":epicId/stories/:storyId/tasks"),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Param)("epicId")),i(2,(0,s.Param)("storyId")),i(3,(0,s.Body)()),o("design:type",Function),o("design:paramtypes",[String,String,String,Object]),o("design:returntype",Promise)],c.prototype,"addTask",null),n([(0,s.Put)(":epicId/stories/:storyId/tasks/:taskId"),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Param)("epicId")),i(2,(0,s.Param)("storyId")),i(3,(0,s.Param)("taskId")),i(4,(0,s.Body)()),o("design:type",Function),o("design:paramtypes",[String,String,String,String,Object]),o("design:returntype",Promise)],c.prototype,"updateTask",null),n([(0,s.Delete)(":epicId/stories/:storyId/tasks/:taskId"),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Param)("epicId")),i(2,(0,s.Param)("storyId")),i(3,(0,s.Param)("taskId")),o("design:type",Function),o("design:paramtypes",[String,String,String,String]),o("design:returntype",Promise)],c.prototype,"removeTask",null),n([(0,s.Get)(":epicId/stories/:storyId/tasks"),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Param)("epicId")),i(2,(0,s.Param)("storyId")),o("design:type",Function),o("design:paramtypes",[String,String,String]),o("design:returntype",Promise)],c.prototype,"getTasks",null),n([(0,s.Get)(":epicId/stories/:storyId/tasks/:taskId"),i(0,(0,s.Param)("workspaceName")),i(1,(0,s.Param)("epicId")),i(2,(0,s.Param)("storyId")),i(3,(0,s.Param)("taskId")),o("design:type",Function),o("design:paramtypes",[String,String,String,String]),o("design:returntype",Promise)],c.prototype,"getTask",null),t.EpicsController=c=n([(0,s.Controller)("workspaces/:workspaceName/epics"),o("design:paramtypes",[a.EpicsService])],c)},7793:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReadPortFromFile=void 0;const c=r(5534),l=r(1569),d=s(r(9896)),u=s(r(6928)),f=a(r(9055));class p extends c.Tool{constructor(e){super(),this.name="read_port_from_file",this.description="Read the content of a file from the portFromBaseDir in the workspace. Should only be used for reading files that are expected to be text based. Do not use this tool for binary files.",this.schema=l.z.object({filePath:l.z.string().describe("The relative path of the file to read")}),this.portFromBaseDir=e}async _call(e){return this.readFile(e.filePath)}readFile(e){f.default.info(`ReadPortFromFile.readFile called with: ${e}`);const t=u.join(this.portFromBaseDir,e);try{return d.readFileSync(t,"utf-8")}catch(t){return"ENOENT"===t.code?`Error: File not found - ${e}`:`Error reading file: ${t.message}`}}}t.ReadPortFromFile=p},7814:e=>{"use strict";e.exports=require("@modelcontextprotocol/sdk/client/stdio.js")},7823:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoredDocDTO=void 0;class r{constructor(e,t,r,n,o){this.id=e,this.mimeType=t,this.createdAt=r,this.sessionId=n,this.workspaceName=o}static fromStoredDoc(e){return new r(e.id,e.mimeType,e.createdAt,e.sessionId,e.workspaceName)}}t.StoredDocDTO=r},7852:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.SourceArtefactModule=void 0;const o=r(3563),i=r(4279),s=r(3153),a=r(5908),c=r(376),l=r(4358),d=r(4912);let u=class{};t.SourceArtefactModule=u,t.SourceArtefactModule=u=n([(0,o.Module)({imports:[c.DataSourceModule],controllers:[i.SourceArtefactController],providers:[s.SourceArtefactService,a.SourceArtefactRepository,d.MavenSourceArtefactScheme,{provide:l.SchemePackageManager,useFactory:e=>new l.SchemePackageManager([e]),inject:[d.MavenSourceArtefactScheme]}],exports:[s.SourceArtefactService]})],u)},7886:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7890:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createStreamProcessor=function(e,t){i.default.debug("[AnthropicStreamProcessor] Creating stream processor"),s.debugLogger.enable(),s.debugLogger.log("[AnthropicStreamProcessor] Creating stream processor with debug logging enabled");const r=(0,c.createBlockManager)(e),n=async function*(n){if(i.default.debug(`[AnthropicStreamProcessor] Processing text chunk: "${n.length>20?n.substring(0,20)+"...":n}"`),s.debugLogger.log(`Processing text chunk: "${n}"`),e.addTextContent(n),e.isBufferingContent()){i.default.debug(`[AnthropicStreamProcessor] Adding to existing buffer: "${n.length>20?n.substring(0,20)+"...":n}"`),e.addToBuffer(n);const r=e.getAndClearBuffer();return t.mightContainPartialTag(r)?(i.default.debug("[AnthropicStreamProcessor] Combined content still has partial tag, continuing to buffer"),e.startBuffering(),void e.addToBuffer(r)):(i.default.debug(`[AnthropicStreamProcessor] Processing buffered content: "${r.length>20?r.substring(0,20)+"...":r}"`),s.debugLogger.log(`Processing buffered content: "${r}"`),void(yield*u(r)))}if(e.getTagBuffer()){const r=e.getTagBuffer()+n;return i.default.debug(`[AnthropicStreamProcessor] Processing combined tag buffer: "${r.length>20?r.substring(0,20)+"...":r}"`),s.debugLogger.log(`Processing combined tag buffer: "${r}"`),e.clearTagBuffer(),t.mightContainPartialTag(r)?(i.default.debug("[AnthropicStreamProcessor] Combined buffer still has partial tag, switching to content buffering"),e.startBuffering(),void e.addToBuffer(r)):void(yield*u(r))}if(t.mightContainPartialTag(n))return i.default.debug(`[AnthropicStreamProcessor] Starting buffer for potential partial tag: "${n.length>20?n.substring(0,20)+"...":n}"`),e.startBuffering(),void e.addToBuffer(n);const o=t.findOpeningTag(n);if(o.found&&0===o.index&&a.TOOL_CALL_TAGS.includes(o.tagName)){i.default.debug(`[AnthropicStreamProcessor] Found tool call tag at start of text chunk: ${o.tagName}`),s.debugLogger.log(`Found tool call tag at start of text chunk: ${o.tagName}`);const t=e.getCurrentBlock();if(t&&!t.finished){i.default.debug(`[AnthropicStreamProcessor] Finishing existing block before tool call: ${t.id}`),s.debugLogger.log(`Finishing existing block before tool call: ${t.id}`);const e=r.finishBlock();e&&(yield e)}}yield*u(n)},l=async function*(t){i.default.debug(`[AnthropicStreamProcessor] Processing thinking delta: "${t.length>20?t.substring(0,20)+"...":t}"`),s.debugLogger.log(`Processing thinking delta: "${t}"`),e.addThinkingContent(t);const n=e.getCurrentBlock();if(!n||"thinking"!==n.blockType){if(n){i.default.debug(`[AnthropicStreamProcessor] Finishing existing block before creating thinking block: ${n.id}`),s.debugLogger.log(`Finishing existing block before creating thinking block: ${n.id}, type: ${n.blockType}`);const e=r.finishBlock();e&&(yield e)}i.default.debug("[AnthropicStreamProcessor] Creating new thinking block"),s.debugLogger.log("[AnthropicStreamProcessor] Creating new thinking block");const e=r.openBlock("thinking");yield e}i.default.debug(`[AnthropicStreamProcessor] Appending thinking content to block: ${e.getCurrentBlock().id}`),s.debugLogger.log(`Appending thinking content to block: ${e.getCurrentBlock().id}`),yield{type:"blockUpdate",blockId:e.getCurrentBlock().id,appendContent:t}},d=async function*(t){return i.default.debug(`[AnthropicStreamProcessor] Processing signature delta: "${t}"`),s.debugLogger.log(`Processing signature delta: "${t}"`),e.setThinkingSignature(t),s.debugLogger.log("Set thinking signature for MessageInterchange"),[]},u=async function*(n){let o=n;for(;o;){if(e.isInsideFence()){const t=o.indexOf("```");if(-1!==t){const n=o.substring(0,t+3);i.default.debug(`[AnthropicStreamProcessor] Found end of code fence, emitting content before fence: "${n.length>20?n.substring(0,20)+"...":n}"`),yield*r.emitText(n),e.setInsideFence(!1),o=o.substring(t+3);continue}i.default.debug(`[AnthropicStreamProcessor] Still in code fence, emitting all text: "${o.length>20?o.substring(0,20)+"...":o}"`),yield*r.emitText(o),o="";continue}const n=o.indexOf("```");if(-1!==n){const t=o.substring(0,n);t&&(i.default.debug(`[AnthropicStreamProcessor] Found start of code fence, emitting content before fence: "${t.length>20?t.substring(0,20)+"...":t}"`),yield*r.emitText(t)),i.default.debug("[AnthropicStreamProcessor] Entering code fence mode"),e.setInsideFence(!0),yield*r.emitText("```"),o=o.substring(n+3);continue}const s=e.getCurrentBlock();if(s&&(a.THINKING_TAGS.includes(s.tagName)||a.TOOL_CALL_TAGS.includes(s.tagName))){const n=`</${s.tagName}>`,a=o.indexOf(n);if(-1!==a){const c=o.substring(0,a);c&&(i.default.debug(`[AnthropicStreamProcessor] Found closing tag, appending content before closing: "${c.length>20?c.substring(0,20)+"...":c}"`),yield{type:"blockUpdate",blockId:s.id,appendContent:c}),i.default.debug(`[AnthropicStreamProcessor] Appending closing tag: "${n}"`),yield{type:"blockUpdate",blockId:s.id,appendContent:n},i.default.debug(`[AnthropicStreamProcessor] Finishing block after closing tag: ${s.id}`);const l=r.finishBlock();l&&(yield l);const d=o.substring(a+n.length);d&&t.endsWithPartialTag(d)?(i.default.debug(`[AnthropicStreamProcessor] Found partial tag at end after closing tag, buffering: "${d}"`),e.setTagBuffer(d),o=""):d?(yield*u(d),o=""):o="";continue}i.default.debug(`[AnthropicStreamProcessor] No closing tag found, appending all text: "${o.length>20?o.substring(0,20)+"...":o}"`),yield{type:"blockUpdate",blockId:s.id,appendContent:o},o="";continue}const c=t.findOpeningTag(o);if(c.found){const e=c.tagName,t=a.THINKING_TAGS.includes(e)||a.TOOL_CALL_TAGS.includes(e),n=o.substring(0,c.index);if(n&&(i.default.debug(`[AnthropicStreamProcessor] Found opening tag, emitting content before tag: "${n.length>20?n.substring(0,20)+"...":n}"`),yield*r.emitText(n)),t){if(s){i.default.debug(`[AnthropicStreamProcessor] Finishing existing block before opening tag: ${s.id}`);const e=r.finishBlock();e&&(yield e)}const t=o.substring(c.index+c.fullMatch.length),n=`</${e}>`,a=t.indexOf(n);if(-1!==a){const s=c.fullMatch+t.substring(0,a)+n;i.default.debug(`[AnthropicStreamProcessor] Found self-contained tag, emitting immediate block: ${e} with content: "${s.length>20?s.substring(0,20)+"...":s}"`);const l=r.emitImmediateBlock(e,s);yield l,o=t.substring(a+n.length);continue}{i.default.debug(`[AnthropicStreamProcessor] Starting new block with tag: ${e}`);const n=r.openBlock(e,c.fullMatch);yield n,o=t;continue}}if(i.default.debug(`[AnthropicStreamProcessor] Found non-top-level tag: ${e}, emitting as text`),s&&!s.finished){i.default.debug(`[AnthropicStreamProcessor] Appending tag to current block: ${s.id}`);const e=o.substring(0,c.index+c.fullMatch.length);yield{type:"blockUpdate",blockId:s.id,appendContent:e},o=o.substring(c.index+c.fullMatch.length);continue}yield*r.emitText(o.substring(0,c.index+c.fullMatch.length)),o=o.substring(c.index+c.fullMatch.length)}else if(t.endsWithPartialTag(o)){const t=e.getCurrentBlock();t&&(i.default.debug(`[AnthropicStreamProcessor] Found partial tag at end, buffering with block ID: ${t.id}`),e.setBufferedBlockId(t.id)),i.default.debug(`[AnthropicStreamProcessor] Found partial tag at end, buffering: "${o}"`),e.setTagBuffer(o),o=""}else if(t.mightContainPartialTag(o)){i.default.debug(`[AnthropicStreamProcessor] Text might contain partial tag, starting content buffering: "${o}"`),e.startBuffering(),e.addToBuffer(o);const t=e.getCurrentBlock();t&&(i.default.debug(`[AnthropicStreamProcessor] Storing current block ID with buffer: ${t.id}`),e.setBufferedBlockId(t.id)),o=""}else i.default.debug(`[AnthropicStreamProcessor] No special patterns, emitting as text: "${o.length>20?o.substring(0,20)+"...":o}"`),yield*r.emitText(o),o=""}};return{processStream:async function*(t,a,c){i.default.debug(`[AnthropicStreamProcessor] Processing stream for task: ${a}`),s.debugLogger.log(`Processing stream for task: ${a}`),e.reset();let u=null;try{for await(const o of t){if(c?.aborted){i.default.debug("[AnthropicStreamProcessor] Stream processing aborted");break}if(s.debugLogger.log("Processing chunk:",o),("content_block_start"===o.type||"content_block_delta"===o.type)&&void 0!==o.index&&null!==u&&o.index!==u){i.default.debug(`[AnthropicStreamProcessor] Switching from block index ${u} to ${o.index}`),s.debugLogger.log(`Switching from block index ${u} to ${o.index}`);const t=e.getCurrentBlock();if(t&&!t.finished){i.default.debug(`[AnthropicStreamProcessor] Finishing block due to index change: ${t.id}`),s.debugLogger.log(`Finishing block due to index change: ${t.id}`);const e=r.finishBlock();e&&(yield e)}}if("content_block_start"!==o.type&&"content_block_delta"!==o.type||void 0===o.index||(u=o.index),"message_start"===o.type&&o.message?.usage){i.default.debug(`[AnthropicStreamProcessor] Processing message_start with usage: ${JSON.stringify(o.message.usage)}`);const e={type:"usage",inputTokens:o.message.usage.input_tokens||0,outputTokens:o.message.usage.output_tokens||0,cacheWriteTokens:o.message.usage.cache_creation_input_tokens||0,cacheReadTokens:o.message.usage.cache_read_input_tokens||0};yield e}else if("content_block_start"===o.type&&"thinking"===o.content_block?.type)i.default.debug("[AnthropicStreamProcessor] Processing content_block_start with thinking"),yield*l(o.content_block.thinking||"");else if("content_block_start"===o.type&&"text"===o.content_block?.type)i.default.debug("[AnthropicStreamProcessor] Processing content_block_start with text"),yield*n(o.content_block.text||"");else if("content_block_delta"===o.type&&"thinking_delta"===o.delta?.type)i.default.debug("[AnthropicStreamProcessor] Processing content_block_delta with thinking_delta"),yield*l(o.delta.thinking||"");else if("content_block_delta"===o.type&&"text_delta"===o.delta?.type)i.default.debug("[AnthropicStreamProcessor] Processing content_block_delta with text_delta"),yield*n(o.delta.text||"");else if("content_block_delta"===o.type&&"signature_delta"===o.delta?.type)i.default.debug("[AnthropicStreamProcessor] Processing content_block_delta with signature_delta"),yield*d(o.delta.signature||"");else if("message_delta"===o.type&&o.usage){i.default.debug(`[AnthropicStreamProcessor] Processing message_delta with usage: ${JSON.stringify(o.usage)}`);const e={type:"usage",inputTokens:0,outputTokens:o.usage.output_tokens||0};yield e}else if("content_block_stop"===o.type){i.default.debug(`[AnthropicStreamProcessor] Processing content_block_stop for index ${o.index}`),s.debugLogger.log(`Processing content_block_stop for index ${o.index}`);const t=e.getCurrentBlock();if(t&&!t.finished){i.default.debug(`[AnthropicStreamProcessor] Finishing block due to content_block_stop: ${t.id}`),s.debugLogger.log(`Finishing block due to content_block_stop: ${t.id}`);const e=r.finishBlock();e&&(yield e)}}}const f=e.getCurrentBlock();if(f&&!f.finished){i.default.debug(`[AnthropicStreamProcessor] Finishing remaining block: ${f.id}`);const e=r.finishBlock();e&&(yield e)}const p=(0,o.ulid)(),h=[];e.getThinkingContent()&&(i.default.debug("[AnthropicStreamProcessor] Adding thinking segment to MessageInterchange"),h.push({type:"thinking",content:e.getThinkingContent(),metadata:e.getThinkingSignature()?{signature:e.getThinkingSignature()}:void 0})),e.getTextContent()&&(i.default.debug("[AnthropicStreamProcessor] Adding text segment to MessageInterchange"),h.push({type:"text",content:e.getTextContent()})),i.default.debug(`[AnthropicStreamProcessor] Creating MessageInterchange with ${h.length} segments`);const g={type:"messageInterchange",messageInterchange:{id:p,taskId:a,role:"assistant",segments:h,providerId:"anthropic",createdAt:new Date}};yield g}catch(t){i.default.error(`[AnthropicStreamProcessor] Error processing stream: ${t.message}`,t.stack);const r=e.getCurrentBlock();throw r&&!r.finished&&(i.default.debug(`[AnthropicStreamProcessor] Finishing block with error: ${r.id}`),yield{type:"blockUpdate",blockId:r.id,newStatus:"error",errorText:`Error processing stream: ${t.message}`}),t}},processTextChunk:n,processThinkingDelta:l,processSignatureDelta:d}};const o=r(9100),i=n(r(9055)),s=r(6297),a=r(1685),c=r(9560)},7915:e=>{"use strict";e.exports=require("@langchain/community/document_loaders/fs/unstructured")},7916:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.GeminiAdapter=void 0;const i=r(3563),s=r(1926),a=r(9100),c=r(5562);let l=class{constructor(e){this.provider=e,this.id="gemini",this.name="Google Gemini"}getProvider(){return this.provider}getModelClient(e){return this.provider.getModelClient(e)}toProviderFormat(e){return e.map((e=>(0,c.convertEveMessageToGemini)(e)))}fromProviderFormat(e){return e.map((e=>{const t=[];if(e.parts&&Array.isArray(e.parts))for(const r of e.parts)if("text"in r&&r.text){const e=r.text.match(/\[Thinking:(.*?)\]/s);if(e){t.push({type:"thinking",content:e[1].trim(),metadata:{}});const n=r.text.replace(/\[Thinking:.*?\]/s,"").trim();n&&t.push({type:"text",content:n})}else t.push({type:"text",content:r.text})}else"inlineData"in r&&r.inlineData&&t.push({type:"other",content:"[Image data]",metadata:{providerSpecificType:"image",mimeType:r.inlineData.mimeType,data:r.inlineData.data}});else"string"==typeof e.parts&&t.push({type:"text",content:e.parts});return{id:(0,a.ulid)(),taskId:"",role:"model"===e.role?"assistant":"user",segments:t,providerId:"gemini",providerMetadata:{format:"structured"},createdAt:new Date}}))}extractMetadata(e){return{format:"structured"}}supportsThinking(){return!1}supportsFormatConversion(e){return!0}};t.GeminiAdapter=l,t.GeminiAdapter=l=n([(0,i.Injectable)(),o("design:paramtypes",[s.GeminiProvider])],l)},7967:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigModule=void 0;const o=r(3563),i=r(5015),s=r(2368),a=r(5699),c=r(3713),l=r(376);let d=class{};t.ConfigModule=d,t.ConfigModule=d=n([(0,o.Module)({imports:[l.DataSourceModule],controllers:[i.ConfigController],providers:[s.ConfigService,a.ConfigPropertyRepository,c.ConfigPropertyDescriptor,c.ConfigSection,c.ConfigDescriptors],exports:[s.ConfigService,a.ConfigPropertyRepository,c.ConfigPropertyDescriptor,c.ConfigSection,c.ConfigDescriptors]})],d)},7978:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DIFF_REGEX_PATTERN=t.ERROR_MESSAGES=t.ERROR_TYPES=t.DIFF_MARKERS=void 0,t.DIFF_MARKERS={SEARCH_START:"<<<<<<< SEARCH",SEPARATOR:"=======",REPLACE_END:">>>>>>> REPLACE"},t.ERROR_TYPES={DIFF_PARSE_ERROR_NO_BLOCKS:"DIFF_PARSE_ERROR_NO_BLOCKS",DIFF_PARSE_ERROR_TRAILING_TEXT:"DIFF_PARSE_ERROR_TRAILING_TEXT",DIFF_PARSE_ERROR_INCOMPLETE:"DIFF_PARSE_ERROR_INCOMPLETE",DIFF_APPLY_ERROR_NOT_FOUND:"DIFF_APPLY_ERROR_NOT_FOUND"},t.ERROR_MESSAGES={EMPTY_DIFF:"Invalid or empty diff format. Expected one or more SEARCH/REPLACE blocks.",INVALID_FORMAT:"Invalid diff format: Unexpected content found after the last REPLACE block",INCOMPLETE_DIFF:"Incomplete diff format: Found SEARCH marker but missing REPLACE marker",SEARCH_NOT_FOUND:"Search block not found in the current file content."},t.DIFF_REGEX_PATTERN="<<<<<<< SEARCH\\n([\\s\\S]*?)\\n=======\\n([\\s\\S]*?)\\n>>>>>>> REPLACE"},8010:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolExecutorService=void 0;const f=r(3563),p=r(461),h=r(9100),g=c(r(857)),m=c(r(8787)),y=u(r(9055)),v=r(6297),_=r(6780),w=r(5324),b=r(6550),k=r(6349),S=r(2398),R=r(8474),T=r(538),$=r(6292),O=r(5499),P=r(2776),E=r(3563),I=r(5444),C=r(1280),A=r(9581);let M=o=class{constructor(e,t,r,n,i,s,a,c,l,d){this.eventEmitter=e,this.blockService=t,this.conversationHistoryService=r,this.toolProvider=n,this.mainWorkspaceService=i,this.homeService=s,this.personaRegistry=a,this.toolResultTransformerService=c,this.appDataSource=l,this.taskService=d,this.setupEventListeners(),y.default.info(`[${o.name}] ToolExecutorService initialized`)}setupEventListeners(){y.default.info(`[${o.name}] Setting up event listeners`)}decodeHtmlEntitiesInParams(e){if("string"==typeof e)return m.decode(e);if(Array.isArray(e))return e.map((e=>this.decodeHtmlEntitiesInParams(e)));if("object"==typeof e&&null!==e){const t={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=this.decodeHtmlEntitiesInParams(e[r]));return t}return e}async handleToolCallDetected(e){const{clientId:t,taskId:r,blockId:n,toolName:i}=e;y.default.info(`[${o.name}] Tool call detected for tool ${i} (blockId: ${n})`);try{const e=await this.blockService.getBlock(n);if(!e)throw new Error(`Block ${n} not found for tool ${i}`);y.default.debug(`[${o.name}] Raw block content for ${n}:\n${e.content}`);let s=null,a=!1;try{s=JSON.parse(e.content),a=!0,y.default.info(`[${o.name}] Successfully parsed block content as JSON for block ${n}.`)}catch(a){y.default.info(`[${o.name}] Block content for ${n} is not valid JSON. Attempting XML parsing.`),y.default.debug(`[${o.name}] Full block content for ${n}:\n${e.content}`);try{if(s=(0,_.parseToolParams)(e.content,i),!s)throw y.default.error(`[${o.name}] Failed to parse XML content for tool ${i}. Full block content:\n${e.content}`),new Error(`Failed to parse XML content for tool ${i}`);y.default.info(`[${o.name}] Successfully parsed block content as XML for tool ${i} (block ${n}).`)}catch(e){return y.default.error(`[${o.name}] Failed to parse parameters for tool ${i} from block ${n}. Content was neither valid JSON nor parsable XML. Error: ${e.message}`),await this.blockService.updateBlock(n,{status:"error",errorText:`Failed to parse tool parameters: ${e.message}`}),await this.taskService.updateTask({taskId:r,status:I.TaskStatus.WAITING_FOR_INPUT}),void this.eventEmitter.emit(C.InternalEvents.TOOL_EXECUTION_COMPLETED,{clientId:t,taskId:r,blockId:n,toolName:i,result:{error:`Failed to parse tool parameters: ${e.message}`},status:"error"})}}if(!s)return y.default.error(`[${o.name}] Parameters object is null after parsing attempts for block ${n}. Cannot proceed.`),y.default.error(`[${o.name}] Full block content for ${n}:\n${e.content}`),await this.blockService.updateBlock(n,{status:"error",errorText:"Internal error: Parameter parsing resulted in null."}),await this.taskService.updateTask({taskId:r,status:I.TaskStatus.WAITING_FOR_INPUT}),void this.eventEmitter.emit(C.InternalEvents.TOOL_EXECUTION_COMPLETED,{clientId:t,taskId:r,blockId:n,toolName:i,result:{error:"Internal error: Parameter parsing resulted in null."},status:"error"});const c=this.decodeHtmlEntitiesInParams(s);y.default.debug(`[${o.name}] Decoded parameters for tool ${i} (block ${n}):`,c);const l=c.requires_approval;let d;if(void 0!==l)d="string"==typeof l?"true"===l.toLowerCase():!!l,y.default.info(`[${o.name}] Approval requirement determined by explicit 'requires_approval' parameter: ${d}`);else{d=!await this.shouldAutoApproveTool(r,i,c),y.default.info(`[${o.name}] Approval requirement determined by auto-approval logic: ${d}`)}d?(y.default.info(`[${o.name}] Tool ${i} requires user approval.`),await this.blockService.updateBlock(n,{status:"question"})):(y.default.info(`[${o.name}] Tool ${i} is auto-approved. Proceeding with execution.`),await this.executeToolForBlock(t,r,n,i,c))}catch(e){const s=e instanceof Error?e.message:String(e);y.default.error(`[${o.name}] Unhandled error during tool call detection/approval for ${i} (block ${n}): ${s}\n${e instanceof Error?e.stack:""}`);try{await this.blockService.updateBlock(n,{status:"error",errorText:`Error handling tool call: ${s}`}),await this.taskService.updateTask({taskId:r,status:I.TaskStatus.WAITING_FOR_INPUT}),y.default.info(`[${o.name}] Task ${r} status set back to ${I.TaskStatus.WAITING_FOR_INPUT} due to error during tool call handling.`),this.eventEmitter.emit(C.InternalEvents.TOOL_EXECUTION_COMPLETED,{clientId:t,taskId:r,blockId:n,toolName:i,result:{error:s},status:"error"})}catch(e){const t=e instanceof Error?e.message:String(e);y.default.error(`[${o.name}] Failed to update block/task status after error for block ${n}: ${t}`)}}}async executeToolForBlock(e,t,r,n,i){y.default.info(`[${o.name}] Executing tool ${n} for block ${r}`);if((await this.taskService.getTask(t)).status===I.TaskStatus.USER_CANCELLED)return y.default.info(`[${o.name}] Task ${t} is cancelled, not executing tool ${n}`),await this.blockService.updateBlock(r,{status:"error",errorText:"Tool execution cancelled by user"}),void this.eventEmitter.emit(C.InternalEvents.TOOL_EXECUTION_COMPLETED,{clientId:e,taskId:t,blockId:r,toolName:n,result:{error:"Tool execution cancelled by user"},status:"error"});await this.taskService.updateTask({taskId:t,status:I.TaskStatus.EXECUTING_TOOL}),y.default.info(`[${o.name}] Task ${t} status set to ${I.TaskStatus.EXECUTING_TOOL}`);try{if(await this.blockService.updateBlock(r,{status:"executing"}),!await this.isValidTool(t,n))throw new Error(`Tool ${n} is not valid for task ${t}`);const o=await this.getTask(t);let s;const a=o.workspaceName;if(!a)throw new Error(`Task ${t} has no associated workspace name`);{const e=await this.mainWorkspaceService.findOne(a);if(!e)throw new E.NotFoundException(`Workspace '${a}' not found`);s=e.repoBaseDir}const c=await this.homeService.getUserData(),l={workingDir:s,user:{userId:o.userId,email:c.email},osInfo:{platform:g.platform(),release:g.release(),homeDir:g.homedir(),shell:process.env.SHELL||"/bin/bash"},currentMode:o.mode||"act",currentTime:(new Date).toISOString()},d=this.toolProvider.getTools([n],l);if(0===d.length)throw new Error(`Tool not found: ${n}`);const u=d[0],f=await this.executeTool(u,i);await this.createToolResultMessage(t,n,f),await this.blockService.updateBlock(r,{status:"completed",output:"string"==typeof f?f:JSON.stringify(f)});const p=this.toolResultTransformerService.transformForClient(n,f);this.eventEmitter.emit(C.InternalEvents.TOOL_EXECUTION_COMPLETED,{clientId:e,taskId:t,blockId:r,toolName:n,result:f,status:"success"}),this.eventEmitter.emit(C.InternalEvents.TOOL_EXECUTED,{clientId:e,taskId:t,toolName:n,result:p,blockId:r,wasTransformed:this.toolResultTransformerService.hasTransformerFor(n)})}catch(i){y.default.error(`[${o.name}] Error executing tool ${n} for block ${r}: ${i.message}`);const s=i instanceof A.EveAgentError?i:new A.ToolExecutionError(i.message||"Unknown tool execution error",n,i.code||"TOOL_EXECUTION_ERROR",{originalError:i},!1);await this.blockService.updateBlock(r,{status:"error",errorText:s.message}),await this.createToolErrorMessage(t,n,s),this.eventEmitter.emit(C.InternalEvents.TOOL_EXECUTION_COMPLETED,{clientId:e,taskId:t,blockId:r,toolName:n,result:{error:s.message,code:s.code,context:s.context},status:"error"}),this.eventEmitter.emit(C.InternalEvents.TOOL_ERROR,{clientId:e,taskId:t,error:s.toUserMessage(),type:"tool_error",code:s.code,context:{toolName:n,blockId:r}})}}async createToolResultMessage(e,t,r){const n={id:(0,h.ulid)(),taskId:e,role:"user",segments:[{type:"text",content:this.formatToolResultMessage(t,r)}],providerId:"system",createdAt:new Date};await this.conversationHistoryService.addMessage(e,n)}async createToolErrorMessage(e,t,r){const n={id:(0,h.ulid)(),taskId:e,role:"user",segments:[{type:"text",content:this.formatToolErrorMessage(t,r)}],providerId:"system",createdAt:new Date};await this.conversationHistoryService.addMessage(e,n)}formatToolResultMessage(e,t){let r;try{r="string"==typeof t?t:JSON.stringify(t,null,2)}catch(e){r="[Complex result that cannot be stringified]"}return`[${e} result]\n${r}`}formatToolErrorMessage(e,t){return`[${e} error] ${t.message}\n${t.code?`Error code: ${t.code}\n`:""}${t.context?.failureSuggestion?`Suggestion: ${t.context.failureSuggestion}`:""}`}async getTask(e){try{const t=await this.appDataSource.knex("eve_tasks").where({taskId:e}).first();if(!t)throw new Error(`Task ${e} not found`);return t}catch(e){throw y.default.error(`[${o.name}] Error getting task: ${e.message}\n${e.stack}`),new Error(`Failed to get task: ${e.message}`)}}async shouldAutoApproveTool(e,t,r){v.debugLogger.log(`Checking auto-approval for tool ${t} for task ${e}`);try{const e=["read_file","list_files","list_code_definition_names","search_files","replace_in_file","write_to_file"];if(r&&void 0!==r.requires_approval){const e="string"==typeof r.requires_approval?"true"===r.requires_approval.toLowerCase():!!r.requires_approval;return v.debugLogger.log(`Tool ${t} has explicit requires_approval: ${e}`),!e}const n=e.includes(t);return v.debugLogger.log(`Auto-approval result for ${t}: ${n}`),n}catch(e){return y.default.error(`[${o.name}] Error checking auto-approval for tool ${t}: ${e.message}\n${e.stack}`),!1}}async getTools(){const e=process.cwd();y.default.warn(`[${o.name}] getTools using default working directory: ${e}. Implement proper default workspace handling.`);const t={workingDir:e,user:{userId:"default",email:"default@example.com"},osInfo:{platform:g.platform(),release:g.release(),homeDir:g.homedir(),shell:process.env.SHELL||"/bin/bash"},currentMode:"act",currentTime:(new Date).toISOString()},r=this.toolProvider.getAllToolFactories().map((e=>e.getToolName()));return this.toolProvider.getTools(r,t)}async isValidTool(e,t){try{const r=await this.getTask(e),n=this.personaRegistry.getPersona(r.personaId);return n.getToolNames().includes(t)}catch(e){return y.default.error(`[${o.name}] Error checking if tool is valid: ${e.message}\n${e.stack}`),!1}}async getToolInstance(e,t){try{const r=await this.getTask(e);let n;const o=r.workspaceName;if(!o)throw new Error(`Task ${e} has no associated workspace name.`);{const t=await this.mainWorkspaceService.findOne(o);if(!t)throw new E.NotFoundException(`Workspace '${o}' not found when getting tool instance for task ${e}`);n=t.repoBaseDir}const i=await this.homeService.getUserData(),s={workingDir:n,user:{userId:r.userId,email:i.email},osInfo:{platform:g.platform(),release:g.release(),homeDir:g.homedir(),shell:process.env.SHELL||"/bin/bash"},currentMode:r.mode||"act",currentTime:(new Date).toISOString()},a=this.toolProvider.getTools([t],s);return a.length>0?a[0]:void 0}catch(e){return void y.default.error(`[${o.name}] Error getting tool instance for ${t}: ${e.message}\n${e.stack}`)}}async executeTool(e,t){y.default.info(`[${o.name}] Executing tool: ${e.name}`),y.default.debug(`[${o.name}] Params type before validation: ${typeof t}`);let r=t;if("string"==typeof t)try{y.default.debug(`[${o.name}] Attempting to parse params string as JSON`);let e=t;e=e.replace(/"\s*"([^"]+)":/g,'","$1":'),r=JSON.parse(e),y.default.debug(`[${o.name}] Successfully parsed params string to object`)}catch(e){y.default.error(`[${o.name}] Failed to parse params string: ${e.message}`)}r&&"string"==typeof r.requires_approval&&(y.default.debug(`[${o.name}] Converting requires_approval from string "${r.requires_approval}" to boolean.`),r.requires_approval="true"===r.requires_approval.toLowerCase(),y.default.debug(`[${o.name}] Converted requires_approval is now type: ${typeof r.requires_approval}, value: ${r.requires_approval}`));try{y.default.debug(`[${o.name}] Params value before validation: ${JSON.stringify(r,null,2)}`)}catch(e){y.default.error(`[${o.name}] Could not stringify params before validation: ${e.message}`),y.default.debug(`[${o.name}] Params raw value before validation:`,r)}if(!e.validateParams(r))throw y.default.error(`[${o.name}] Invalid parameters for tool ${e.name}: ${JSON.stringify(r)}`),new Error(`Invalid parameters for tool ${e.name}`);try{const t=await e.execute(r);return y.default.info(`[${o.name}] Tool ${e.name} executed successfully`),t}catch(t){throw y.default.error(`[${o.name}] Error executing tool ${e.name}: ${t.message}\n${t.stack}`),new Error(`Error executing tool ${e.name}: ${t.message}`)}}};t.ToolExecutorService=M,a([(0,p.OnEvent)(C.InternalEvents.TOOL_CALL_DETECTED),l("design:type",Function),l("design:paramtypes",[Object]),l("design:returntype",Promise)],M.prototype,"handleToolCallDetected",null),t.ToolExecutorService=M=o=a([(0,f.Injectable)(),d(9,(0,f.Inject)((0,f.forwardRef)((()=>b.TaskService)))),l("design:paramtypes",[p.EventEmitter2,w.BlockService,k.ConversationHistoryService,S.ToolProvider,R.WorkspaceService,T.HomeService,$.PersonaRegistry,O.ToolResultTransformerService,P.AppDataSource,b.TaskService])],M)},8077:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetService=void 0;const u=r(3563),f=r(9896),p=d(r(9055)),h=c(r(6928)),g=r(4623),m=r(1747),y=r(7184),v=r(6932),_=r(8460),w=r(8884),b=c(r(857));let k=o=class{constructor(e,t,r){this.datasetRepository=e,this.documentRepository=t,this.indexingService=r}async getAllDatasets(){return this.datasetRepository.findAll()}async getDatasetById(e){return this.datasetRepository.findById(e)}async createDataset(e,t){const r=(0,w.getEnv)("DATASETS_BASE_DIR",h.join(b.homedir(),".eve","datasets")),n=t||h.join(r,e);await f.promises.mkdir(n,{recursive:!0});const o=new g.Dataset(e,n);return await this.datasetRepository.create(o),o}async updateDataset(e,t){await this.datasetRepository.update(e,t)}async deleteDataset(e){const t=await this.documentRepository.findAll(e);for(const e of t)await this.deleteDocument(e.id);await this.datasetRepository.delete(e)}async getDocuments(e){return this.documentRepository.findAll(e)}async getDocumentById(e){return this.documentRepository.findById(e)}async createDocument(e,t,r,n){const i=await this.getDatasetById(e);if(!i)throw new Error("Dataset not found");const s=new m.DatasetDocument(e,t,r);await this.documentRepository.create(s);const a=h.join(i.baseDir,t);return await f.promises.mkdir(h.dirname(a),{recursive:!0}),await f.promises.writeFile(a,n),this.indexingService.indexDocument(s.id,e,a).catch((e=>{p.default.error(`[${o.name}] Failed to index document ${s.id}: ${e.message}\n${e.stack}`)})),s}async updateDocumentStatus(e,t){await this.documentRepository.updateStatus(e,t)}async deleteDocument(e){const t=await this.documentRepository.findById(e);if(!t)throw new Error("Document not found");const r=await this.getDatasetById(t.datasetId);if(!r)throw new Error("Dataset not found");try{await this.indexingService.removeDocumentFromIndex(e,r.name)}catch(t){p.default.error(`[${o.name}] Error removing document ${e} from index:`,t)}const n=h.join(r.baseDir,t.filename);try{await f.promises.unlink(n)}catch(e){p.default.error(`[${o.name}] Error deleting file ${n}:`,e)}await this.documentRepository.delete(e)}};t.DatasetService=k,t.DatasetService=k=o=a([(0,u.Injectable)(),l("design:paramtypes",[y.DatasetRepository,v.DatasetDocumentRepository,_.DatasetIndexingService])],k)},8144:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StoredDocController=void 0;const s=r(3563),a=r(3381),c=r(7823);let l=class{constructor(e){this.storedDocService=e}async storeDoc(e,t,r){const n=await this.storedDocService.storeDoc(e,t,r);return c.StoredDocDTO.fromStoredDoc(n)}async getDoc(e){return this.storedDocService.getDoc(e)}async getDocContent(e,t){const r=await this.storedDocService.getDoc(e);if(!r)throw new Error(`Document not found with id: ${e}`);t.setHeader("Content-Type",r.mimeType),t.send(r.contents)}async getDocsBySession(e){return(await this.storedDocService.getDocsBySession(e)).map((e=>c.StoredDocDTO.fromStoredDoc(e)))}async getDocsByWorkspace(e){return(await this.storedDocService.getDocsByWorkspace(e)).map((e=>c.StoredDocDTO.fromStoredDoc(e)))}};t.StoredDocController=l,n([(0,s.Post)(),i(0,(0,s.Body)("contents")),i(1,(0,s.Query)("sessionId")),i(2,(0,s.Query)("workspaceName")),o("design:type",Function),o("design:paramtypes",[String,String,String]),o("design:returntype",Promise)],l.prototype,"storeDoc",null),n([(0,s.Get)(":id"),i(0,(0,s.Param)("id")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],l.prototype,"getDoc",null),n([(0,s.Get)(":id/contents"),i(0,(0,s.Param)("id")),i(1,(0,s.Res)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],l.prototype,"getDocContent",null),n([(0,s.Get)("session/:sessionId"),i(0,(0,s.Param)("sessionId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],l.prototype,"getDocsBySession",null),n([(0,s.Get)("workspace/:workspaceName"),i(0,(0,s.Param)("workspaceName")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],l.prototype,"getDocsByWorkspace",null),t.StoredDocController=l=n([(0,s.Controller)("stored-docs"),o("design:paramtypes",[a.StoredDocService])],l)},8190:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CancellationResetService=void 0;const c=r(3563),l=r(461),d=a(r(9055)),u=r(5324),f=r(6550),p=r(1280),h=r(5444);let g=n=class{constructor(e,t,r){this.blockService=e,this.taskService=t,this.eventEmitter=r,this.cancelledTasks=new Map,this.setupListeners(),d.default.info(`[${n.name}] CancellationResetService initialized`)}setupListeners(){this.eventEmitter.on(p.InternalEvents.TASK_UPDATED,(e=>{e.status===h.TaskStatus.USER_CANCELLED?this.handleTaskCancellation(e.taskId):this.cancelledTasks.has(e.taskId)&&(d.default.info(`[${n.name}] Task ${e.taskId} status changed to ${e.status}, clearing reset timeout.`),clearTimeout(this.cancelledTasks.get(e.taskId)),this.cancelledTasks.delete(e.taskId))})),d.default.info(`[${n.name}] Listening for TASK_STATUS_UPDATED events`)}handleTaskCancellation(e){d.default.info(`[${n.name}] Task ${e} cancelled. Setting reset timeout.`),this.cancelledTasks.has(e)&&clearTimeout(this.cancelledTasks.get(e));const t=setTimeout((()=>this.checkAndResetTask(e)),2e3);this.cancelledTasks.set(e,t)}async checkAndResetTask(e){this.cancelledTasks.delete(e);try{d.default.info(`[${n.name}] Checking if cancelled task ${e} can be reset to waiting_for_input.`);const t=await this.taskService.getTask(e);if(t.status!==h.TaskStatus.USER_CANCELLED)return void d.default.info(`[${n.name}] Task ${e} is no longer cancelled (status: ${t.status}), not resetting.`);const r=(await this.blockService.getBlocksForTask(e)).slice(-5);if(r.some((e=>"generating"===e.status||"executing"===e.status))){const t=r.filter((e=>"generating"===e.status||"executing"===e.status)).map((e=>`${e.blockId} (${e.status})`)).join(", ");d.default.info(`[${n.name}] Task ${e} still has active blocks: [${t}]. Setting another timeout.`);const o=setTimeout((()=>this.checkAndResetTask(e)),1e3);this.cancelledTasks.set(e,o)}else d.default.info(`[${n.name}] Task ${e} has no active blocks. Resetting to waiting_for_input.`),await this.taskService.updateTask({taskId:e,status:h.TaskStatus.WAITING_FOR_INPUT,result:JSON.stringify({details:"Task was cancelled and has now been reset. You can continue."})})}catch(t){d.default.error(`[${n.name}] Error checking/resetting task ${e}: ${t.message}\n${t.stack}`);const r=setTimeout((()=>this.checkAndResetTask(e)),2e3);this.cancelledTasks.set(e,r)}}};t.CancellationResetService=g,t.CancellationResetService=g=n=o([(0,c.Injectable)(),s(1,(0,c.Inject)((0,c.forwardRef)((()=>f.TaskService)))),i("design:paramtypes",[u.BlockService,f.TaskService,l.EventEmitter2])],g)},8191:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createStateManager=function(){let e=null,t=null,r=null,n=!1,i=!1,s=null,a=!1,c=null,l=!1,d=[],u=!1,f=null,p=!1,h=!1,g="",m=!1,y=!1;return{getCurrentBlockId:()=>e,setCurrentBlockId(t){e=t},getCurrentBlockType:()=>t,setCurrentBlockType(e){t=e},getCurrentTagName:()=>r,setCurrentTagName(e){r=e},isBlockGenerating:()=>n,setBlockGenerating(e){n=e},isInCodeBlock:()=>i,setInCodeBlock(e){i=e},getCodeBlockLanguage:()=>s,setCodeBlockLanguage(e){s=e},isInToolCall:()=>a,setInToolCall(e){a=e},getCurrentToolName:()=>c,setCurrentToolName(e){c=e},isFinalChunk:()=>l,setFinalChunk(e){l=e},getToolTagStack:()=>d,pushToolTag(e){d.push(e)},popToolTag:()=>d.pop(),clearToolTagStack(){d=[]},isInFencedToolCall:()=>u,setInFencedToolCall(e){u=e},getFencedToolCallName:()=>f,setFencedToolCallName(e){f=e},isFencedXmlStarted:()=>p,setFencedXmlStarted(e){p=e},isFencedXmlComplete:()=>h,setFencedXmlComplete(e){h=e},getPendingFencedContent:()=>g,setPendingFencedContent(e){g=e},appendPendingFencedContent(e){g+=e},resetFencedToolCallState(){u=!1,f=null,p=!1,h=!1,g=""},isInXmlFence:()=>m,setInXmlFence(e){m=e},isInToolUse:()=>y,setInToolUse(e){y=e},reset(){o.default.debug("[StateManager] Resetting all state"),e=null,t=null,r=null,n=!1,i=!1,s=null,a=!1,c=null,l=!1,d=[],u=!1,f=null,p=!1,h=!1,g="",m=!1,y=!1}}};const o=n(r(9055))},8221:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.ReportingModule=void 0;const o=r(3563),i=r(353),s=r(7510),a=r(376),c=r(7967);let l=class{};t.ReportingModule=l,t.ReportingModule=l=n([(0,o.Module)({imports:[a.DataSourceModule,c.ConfigModule],controllers:[i.ReportingController],providers:[s.ReportingService]})],l)},8312:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OllamaProvider=void 0;const n=r(3548),o=r(8483),i=r(8959),s=r(2368);class a extends o.BaseProvider{getName(){return"ollama"}getBaseChatModel(e,t){return new n.ChatOllama({baseUrl:this.getBaseUrl(),model:this.shortModelName(e),temperature:t.temperature})}async getModelDescriptors(){return(await this.fetchModels()).map((e=>new i.ModelDescriptor("ollama",e,0,0,0,0)))}isValid(){return!!this.getBaseUrl()}getBaseUrl(){return s.ConfigService.getInstance().getProperty("OLLAMA_BASE_URL")}async fetchModels(){const e=this.getBaseUrl();try{const t=await fetch(`${e}/api/tags`);if(t.ok){const e=await t.json();return(e.models||[]).map((e=>e.name))}return console.log(`Failed to fetch Ollama models. Status code: ${t.status}`),[]}catch(e){return console.error(`Error fetching Ollama models: ${e}`),[]}}}t.OllamaProvider=a},8377:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.EpicsModule=void 0;const o=r(3563),i=r(7781),s=r(8610),a=r(5762),c=r(5873);let l=class{};t.EpicsModule=l,t.EpicsModule=l=n([(0,o.Module)({imports:[c.WorkspaceModule],controllers:[i.EpicsController],providers:[s.EpicsService,a.FileSystemEpicRepository],exports:[s.EpicsService]})],l)},8434:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPatternUtils=function(){return{endsWithPartialPattern(e){if(/[`]{1,2}$/.test(e))return!0;if(/<[a-zA-Z0-9_-]*$/.test(e))return!0;const t=e.lastIndexOf("<");return-1!==t&&-1===e.indexOf(">",t)},findToolCallStart(e){for(const t of n.TOOL_CALL_TAGS){const r=`<${t}>`,n=e.indexOf(r);if(-1!==n)return{found:!0,toolName:t,index:n,length:r.length}}return{found:!1}},findCodeBlockStart(e){const t=e.match(/```(\w*)\s*\n?/);return t?{found:!0,language:t[1]?.trim()||void 0,index:t.index,length:t[0].length}:{found:!1}},findCodeBlockEnd(e){const t=e.indexOf("```");return-1!==t?{found:!0,contentBefore:e.substring(0,t),index:t,length:3}:{found:!1}},findToolCallInXml(e){for(const t of n.TOOL_CALL_TAGS){const r=`<${t}>`,n=`</${t}>`,o=e.indexOf(r),i=e.indexOf(n);if(-1!==o&&-1!==i&&i>o){return{found:!0,toolName:t,content:e.substring(o,i+n.length),index:o}}}return{found:!1}},countOccurrences(e,t){let r=0,n=0;for(;n=e.indexOf(t,n),-1!==n;)r++,n+=t.length;return r},findBreakPoint(e,t){if(e.length<=t)return e.length;const r=e.indexOf("\n",t);if(-1!==r)return r+1;const n=/[.!?]\s+/g;let o,i=-1;for(;null!==(o=n.exec(e));){if(o.index>=t)return o.index+o[0].length;i=o.index+o[0].length}if(-1!==i&&i>=t/2)return i;const s=e.indexOf(" ",t);return-1!==s?s+1:Math.min(e.length,t)},hasFencedXmlStart:e=>e.includes("```xml"),extractAfterFencedXmlStart(e){const t="```xml",r=e.indexOf(t);if(-1===r)return"";let n=r+6;return"\n"===e[n]&&n++,e.substring(n)},hasFencedXmlEnd:e=>/```\s*($|\n)/.test(e),extractBeforeFencedXmlEnd(e){const t=/```\s*($|\n)/.exec(e);return t?e.substring(0,t.index):e},findPotentialToolName(e){const t=/^\s*<([a-zA-Z0-9_]+)[\s>]/.exec(e);if(!t)return null;const r=t[1];return n.TOOL_CALL_TAGS.includes(r)?r:null},shouldBufferChunk(e){return e.length<10||(!!this.endsWithBacktickOrPartialFence(e)||!!this.endsWithTagStartOrPartialTag(e))},endsWithBacktickOrPartialFence(e){if(e.endsWith("`")||e.endsWith("``"))return!0;if(e.endsWith("```"))return!0;if(e.endsWith("```x")||e.endsWith("```xm"))return!0;const t=e.lastIndexOf("`");if(-1!==t){const r=e.substring(t);if(r.startsWith("`")&&(r.includes("``")||"`"===r)&&!r.includes("```"))return!0;if(r.startsWith("```")&&("```"===r||"```x"===r||"```xm"===r||r.startsWith("```x")))return!0}return!1},endsWithTagStartOrPartialTag(e){if(e.endsWith("<"))return!0;const t=e.lastIndexOf("<");return-1!==t&&-1===e.indexOf(">",t)},containsCompleteFenceEnd:e=>/```\s*($|\n)/.test(e),isToolUseStartTag:e=>e.includes("<tool_use>"),isToolUseEndTag:e=>e.includes("</tool_use>"),extractToolFromToolUse(e){for(const t of n.TOOL_CALL_TAGS){const r=`<${t}>`,n=`</${t}>`,o=e.indexOf(r),i=e.indexOf(n);if(-1!==o&&-1!==i&&i>o){return{toolName:t,content:e.substring(o,i+n.length)}}}return{toolName:null,content:null}}}};const n=r(1685)},8444:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigEventHandler=void 0;const c=r(3563),l=r(6134),d=r(4437),u=a(r(9055)),f=r(6297),p=r(9668),h=r(9102),g=r(6663);let m=n=class{constructor(e,t,r){this.userService=e,this.configService=t,this.eventHelper=r}async handleGetConfig(e){f.debugLogger.log(`Received getConfig message from client ${e.id}`),u.default.info(`[${n.name}] Received getConfig message from client: ${e.id}`);try{const t=await this.userService.getCurrentUser(),r=await this.configService.assembleFinalConfiguration(t.userId,"plan"),o=await this.configService.assembleFinalConfiguration(t.userId,"act"),i={plan:{provider:r.providerId,model:r.modelId,baseUrl:r.baseUrl,thinkingTokens:r.thinkingTokens},act:{provider:o.providerId,model:o.modelId,baseUrl:o.baseUrl,thinkingTokens:o.thinkingTokens}};return u.default.info(`[${n.name}] Sending config response to client ${e.id}`),e.emit("config",{event:"config",data:i}),{event:"config",data:i}}catch(t){const r=t instanceof p.AuthenticationError?`Authentication failed: ${t.message}`:t.message;return u.default.error(`[${n.name}] Error in handleGetConfig: ${r}`,t.stack),e.emit("error",{message:r}),this.eventHelper.emitError(e.id,"unknown_task",r,"handleGetConfig","api_error"),{event:"error",data:{message:r}}}}};t.ConfigEventHandler=m,o([s(0,(0,l.ConnectedSocket)()),i("design:type",Function),i("design:paramtypes",[d.Socket]),i("design:returntype",Promise)],m.prototype,"handleGetConfig",null),t.ConfigEventHandler=m=n=o([(0,c.Injectable)(),i("design:paramtypes",[p.UserService,h.EveConfigService,g.EventHelper])],m)},8460:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetIndexingService=void 0;const u=r(3563),f=r(2368),p=d(r(9055)),h=r(6932),g=r(7184),m=r(7093),y=r(5796),v=r(7310),_=r(8565),w=r(9179),b=r(7915),k=r(4897),S=r(779),R=c(r(6928)),T=r(9100);let $=o=class{constructor(e,t,r){this.configService=e,this.datasetRepository=t,this.documentRepository=r,this.embeddingsModel=process.env.EMBEDDINGS_MODEL||"Xenova/all-mpnet-base-v2",this.chunkSize=parseInt(process.env.CHUNK_SIZE||"1000",10),this.chunkOverlap=parseInt(process.env.CHUNK_OVERLAP||"200",10),this.chromaUrl=process.env.CHROMA_URL||"http://localhost:8000"}getLoader(e){const t=R.extname(e).toLowerCase();let r;switch(p.default.info(`[${o.name}] Selecting loader for file extension: ${t}`),t){case".pdf":p.default.info(`[${o.name}] Using PDFLoader`),r=new _.PDFLoader(e);break;case".docx":p.default.info(`[${o.name}] Using DocxLoader`),r=new w.DocxLoader(e);break;case".pptx":p.default.info(`[${o.name}] Using PPTXLoader`),r=new k.PPTXLoader(e);break;case".csv":p.default.info(`[${o.name}] Using CSVLoader`),r=new S.CSVLoader(e);break;default:p.default.info(`[${o.name}] Using UnstructuredLoader for unknown file type`),r=new b.UnstructuredLoader(e)}return r}async indexDocument(e,t,r){try{p.default.info(`[${o.name}] Starting indexing process for document ${e} in dataset ${t}`),await this.documentRepository.updateStatus(e,"indexing"),p.default.info(`[${o.name}] Updated document status to 'indexing'`),p.default.info(`[${o.name}] Loading document from path: ${r}`);const n=this.getLoader(r),i=await n.load();p.default.info(`[${o.name}] Successfully loaded document with ${i.length} pages/sections`),p.default.info(`[${o.name}] Splitting text with chunk size ${this.chunkSize} and overlap ${this.chunkOverlap}`);const s=new m.RecursiveCharacterTextSplitter({chunkSize:this.chunkSize,chunkOverlap:this.chunkOverlap}),a=await s.splitDocuments(i);p.default.info(`[${o.name}] Text split into ${a.length} chunks`),a.forEach((t=>{const r=(0,T.ulid)();t.id=r,t.metadata.original_document_id=e,t.metadata.id=r})),p.default.info(`[${o.name}] Initializing embeddings model: ${this.embeddingsModel}`);const c=new v.HuggingFaceTransformersEmbeddings({modelName:this.embeddingsModel}),l=await this.datasetRepository.findById(t);if(!l)throw new Error("Dataset not found");p.default.info(`[${o.name}] Using dataset collection name: ${l.name}`),p.default.info(`[${o.name}] Storing vectors in Chroma at ${this.chromaUrl}`);await y.Chroma.fromDocuments(a,c,{collectionName:l.name,url:this.chromaUrl});p.default.info(`[${o.name}] Successfully stored vectors in Chroma`),await this.documentRepository.updateStatus(e,"indexed"),p.default.info(`[${o.name}] Successfully completed indexing of document ${e} in dataset ${t}`)}catch(r){throw p.default.error(`[${o.name}] Failed to index document ${e} in dataset ${t}`),p.default.error(`[${o.name}] Error details: ${r.message}`),r.stack&&p.default.error(`[${o.name}] Stack trace: ${r.stack}`),await this.documentRepository.updateStatus(e,"error"),r}}async removeDocumentFromIndex(e,t){try{p.default.info(`[${o.name}] Removing document ${e} from index collection ${t}`);const r=new v.HuggingFaceTransformersEmbeddings({modelName:this.embeddingsModel}),n=new y.Chroma(r,{collectionName:t,url:this.chromaUrl});await n.delete({filter:{original_document_id:e}}),p.default.info(`[${o.name}] Successfully removed document ${e} from index`)}catch(t){throw p.default.error(`[${o.name}] Failed to remove document ${e} from index: ${t.message}`),t}}};t.DatasetIndexingService=$,t.DatasetIndexingService=$=o=a([(0,u.Injectable)(),l("design:paramtypes",[f.ConfigService,g.DatasetRepository,h.DatasetDocumentRepository])],$)},8471:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PrivateCoderAgentService=void 0;const i=r(3563),s=r(989),a=r(1e3),c=r(8474),l=r(7373),d=r(538),u=r(3239),f=r(6158),p=r(1162),h=r(8921),g=r(3470);let m=class extends s.BaseToolCallingAgent{constructor(e,t,r,n,o,i,s){super(e,t,r,n,o,i,s)}getName(){return"private-coder-agent"}getModelCategory(){return p.ModelCategory.CODING}isPrivateModelsOnly(){return!0}getTools(e){const t=this.toolFactory.createTool("read_file",e),r=this.toolFactory.createTool("update_file",e),n=this.toolFactory.createTool("command_line",e),o=this.toolFactory.createTool("current_timestamp",e);return n.setPrivateRequired(!0),[t,r,n,o]}async getSpecificSystemPrompt(e){const t=await h.EpicsPrompts.updateStoryTasks(e);return`\nYou are an AI coding assistant focused on making high-quality code changes. Your task is to help implement the user's request by following this multi-step process:\n\n1. Initial Research (ALWAYS DO THIS FIRST):\n   a. Use the read_file tool to examine any relevant files before planning any changes.\n   b. Look at similar files in the codebase to understand:\n      - Code style and formatting conventions\n      - Use of DTOs vs use of domain entities etc\n      - Error handling patterns\n      - Logging practices\n      - Import organization\n      - Naming conventions\n      - Documentation style\n      - Tools and patterns being used\n   c. Never make assumptions about file contents - always verify with read_file\n   d. Study the existing patterns thoroughly before proceeding to planning.\n\n2. Planning (ONLY AFTER RESEARCH IS COMPLETE):\n   a. Based on the research, make a clear plan with multiple steps.\n   b. Break down complex changes into smaller, manageable steps.\n   c. Think through potential impacts on other parts of the codebase.\n   d. Consider how to maintain consistency with existing patterns.\n\n3. Implementation (FOLLOW PLAN STEP BY STEP):\n   a. Execute each step in the plan sequentially, explaining each change.\n   b. Make changes using the update_file tool, always providing all three arguments:\n      - filePath: The path to the file to modify\n      - search: The specific code block to replace\n      - replace: The new code block (never forget this!)\n   c. Keep changes focused and minimal - update only what's necessary.\n   d. Ensure code changes follow these principles:\n      - Clean, maintainable code structure\n      - Performance optimization\n      - Security best practices\n      - Scalability considerations\n      - Proper error handling\n      - Clear documentation\n      - Consistent with existing patterns (e.g. code style, formatting, naming conventions, dto's, repository patterns, etc)\n\n4. Testing:\n   a. After code changes, use the command_line tool to run: ${e.workspace.buildOrTestCommand}\n   b. If errors occur, analyze and fix them before proceeding.\n   c. Ensure all changes are properly tested.\n\n5. Summary:\n   Provide a concise final summary listing:\n   a. Files that were modified\n   b. Brief description of changes made to each file\n\nThe repository file structure is:\n${e.repositoryTree()}\n\n${e.repositoryHints()?`Additional hints provided by the user that must be adhered to:\n${e.repositoryHints()}`:""}\n\nIMPORTANT REMINDERS:\n- ALWAYS do thorough research first (use the read_file tool) and return that as a response\n- Keep reading more files if needed until you have a thorough understanding of the codebase\n- Then make a clear plan based on research findings and return that as a response (continue)\n- Then iterate through the plan step by step, using the update_file tool to make changes to the code\n- Keep changes minimal and focused (use the update_file tool)\n- Build/Test after making changes (use the command_line tool)\n- Provide clear, concise summaries\n\n# Task Management Instructions\n${t}\n\nIMPORTANT: When implementing tasks:\n1. Always check the task status in the task JSON file before starting work\n2. Update the task status to "inprogress" when you start working on it\n3. Update the task status to "done" when you complete it\n4. Always use current_timestamp to update the updatedAt field when changing task status\n5. Remember that task status changes may require updating the parent story status\n\n- COMMAND LINE TOOL RESTRICTIONS:\n  * Only use the command_line tool for:\n    1. Running the build/test command (${e.workspace.buildOrTestCommand})\n    2. Installing new local packages for the project\n  * Never use it for any other system changes\n  * Never traverse up above the workspace directory\n  * Always include automatic confirmation flags (--yes, -y, --force, etc.) for package installations\n`}};t.PrivateCoderAgentService=m,t.PrivateCoderAgentService=m=n([(0,i.Injectable)(),o("design:paramtypes",[c.WorkspaceService,l.SessionService,d.HomeService,u.SummaryCompletion,f.ToolFactoryService,a.CheckpointerService,g.AgentRuleService])],m)},8474:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceService=void 0;const d=r(3563),u=r(4717),f=a(r(9896)),p=a(r(6928)),h=l(r(9055)),g=l(r(3807)),m=r(2434);let y=class{constructor(e){this.workspaceRepository=e}async lockSessionWorkspace(e){const t=`session/${e}`;if(await this.workspaceRepository.findByName(t))return this.lockByName(t);const r=process.env.TEMP_WORKSPACE_ROOT_DIR||"~/.eve/temp-workspaces/",n=p.join(r,"session",e);f.mkdirSync(n,{recursive:!0});const o=await this.createWorkspace({name:t,repoBaseDir:n,isTemp:!0});return this.lockByName(o.name)}async lockTempWorkspace(e){const t=await this.workspaceRepository.findUnlockedTempWorkspaceByRemoteUrl(e);if(t)return this.lockByName(t.name);const r=this.generateWorkspaceName(e),n=this.createWorkspaceDirectory(r);await this.cloneRepository(e,n);const o=await this.createWorkspace({name:r,repoBaseDir:n,isTemp:!0});return this.lockByName(o.name)}generateWorkspaceName(e){return`${p.basename(e,".git")}-${Math.random().toString(36).substring(2,7)}`}createWorkspaceDirectory(e){const t=process.env.TEMP_WORKSPACE_ROOT_DIR||p.join(process.env.HOME||"","/.eve/temp-workspaces/"),r=p.join(t,e);return f.mkdirSync(r,{recursive:!0}),r}async cloneRepository(e,t){const r=(0,g.default)();await r.clone(e,t)}async updateWorkspace(e,t){const r=await this.workspaceRepository.findByName(e);if(!r)throw new d.NotFoundException(`Workspace with name ${e} not found`);return r.buildOrTestCommand=t.buildOrTestCommand,r.portFromBaseDir=t.portFromBaseDir,await this.workspaceRepository.update(e,{buildOrTestCommand:t.buildOrTestCommand,portFromBaseDir:t.portFromBaseDir}),h.default.info(`Workspace updated successfully: ${JSON.stringify(r)}`),r}async lockByName(e){const t=await this.workspaceRepository.findByName(e);if(!t)throw new d.NotFoundException(`Workspace with name ${e} not found`);if(t.isLocked)throw new d.BadRequestException(`Workspace with name ${e} is already locked`);return t.isLocked=!0,t.lastAccessedAt=new Date,await this.workspaceRepository.update(e,{isLocked:!0,lastAccessedAt:t.lastAccessedAt}),h.default.info(`Workspace locked successfully: ${JSON.stringify(t)}`),t}async unlockByName(e){const t=await this.workspaceRepository.findByName(e);if(!t)throw new d.NotFoundException(`Workspace with name ${e} not found`);return t.isLocked=!1,await this.workspaceRepository.update(e,{isLocked:!1}),h.default.info(`Workspace unlocked successfully: ${JSON.stringify(t)}`),t}async createWorkspace(e){h.default.info(`Importing workspace with request: ${JSON.stringify(e)}`);let t=e.name;t||(t=p.basename(e.repoBaseDir));if(await this.workspaceRepository.findByName(t))throw new d.BadRequestException("A workspace with the same name already exists");if(!f.existsSync(e.repoBaseDir)||!f.statSync(e.repoBaseDir).isDirectory())throw new d.BadRequestException("The specified repository directory does not exist or is not a directory");let r=await this.isValidGitRepo(e.repoBaseDir);if(h.default.info(`isGitRepo: ${r}`),!r&&e.ensureGitRepo){const t=(0,g.default)(e.repoBaseDir);await t.init(),r=!0,h.default.info(`Initialized new Git repository in ${e.repoBaseDir}`)}if(r){if(m.GitUtils.ensureGitignoreExists(e.repoBaseDir)){const t=(0,g.default)(e.repoBaseDir);await t.add(".gitignore"),await t.commit("Added default .gitignore file"),h.default.info("Added default .gitignore file")}}const n={name:t,repoBaseDir:e.repoBaseDir,status:"Created",remoteRepoUrl:"",buildOrTestCommand:null,isGitRepo:r,isLocked:!1,isTemp:e.isTemp??!1,lastAccessedAt:new Date,portFromBaseDir:e.portFromBaseDir};if(r)try{n.remoteRepoUrl=await this.getRemoteRepoUrl(e.repoBaseDir);(0,g.default)(e.repoBaseDir);await this.hasCommits(e.repoBaseDir)&&await this.getCurrentBranch(e.repoBaseDir)}catch(e){console.error("Error getting Git information:",e),n.status="Error: Unable to get Git information"}return await this.workspaceRepository.create(n),h.default.info(`Workspace created successfully: ${JSON.stringify(n)}`),n}async findAll(e){return this.workspaceRepository.findAll(e)}async findOne(e){return this.workspaceRepository.findByName(e)}async findById(e){return this.workspaceRepository.findById(e)}async updateLastAccessedAt(e){await this.workspaceRepository.updateLastAccessedAt(e)}async removeWorkspace(e){if(!await this.workspaceRepository.findByName(e))throw new d.NotFoundException(`Workspace with name ${e} not found`);await this.workspaceRepository.delete(e),h.default.info(`Workspace removed successfully: ${e}`)}async getRemoteRepoUrl(e){const t=(0,g.default)(e),r=(await t.getRemotes(!0)).find((e=>"origin"===e.name));return r?r.refs.fetch:""}async getCurrentBranch(e){return(0,g.default)(e).revparse(["--abbrev-ref","HEAD"])}async isValidGitRepo(e){try{const t=(0,g.default)(e);return await t.revparse(["--is-inside-work-tree"]),!0}catch(e){return!1}}async hasCommits(e){try{const t=(0,g.default)(e);return(await t.log(["--oneline","-1"])).total>0}catch(e){return!1}}};t.WorkspaceService=y,t.WorkspaceService=y=s([(0,d.Injectable)(),c("design:paramtypes",[u.WorkspaceRepository])],y)},8483:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseProvider=void 0;const o=r(8959),i=n(r(9055)),s=r(2088);t.BaseProvider=class{async getModelDescriptor(e){const t=await this.getModelDescriptors();if(!e)return t[0];const r=this.shortModelName(e),n=t.find((e=>e.name===r));if(!n&&this.supportsOnDemandModels())return new o.ModelDescriptor(this.getName(),r,0,0,0,0);if(!n)throw new Error(`Model ${r} not found for provider ${this.getName()}`);return n}shortModelName(e){const t=e.indexOf("/");if(-1===t)throw new Error(`Model name ${e} is not in the format provider/model`);return e.substring(t+1)||e}getChatModelOptions(e,t){return new s.ChatModelOptions}isPromptCachingEnabled(e){const t=!0===e?.cachePrompt;return i.default.info("isPromptCachingEnabled - cachePrompt: %s, result: %s",e?.cachePrompt,t),t}supportsOnDemandModels(){return!1}}},8489:e=>{"use strict";e.exports=require("shelljs")},8507:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchFilesToolFactory=void 0;const i=r(3563),s=r(4390);let a=class{constructor(){}getToolName(){return"search_files"}create(e){return new s.SearchFilesTool(e.workingDir)}};t.SearchFilesToolFactory=a,t.SearchFilesToolFactory=a=n([(0,i.Injectable)(),o("design:paramtypes",[])],a)},8547:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SourceArtefact=void 0;t.SourceArtefact=class{constructor(e){Object.assign(this,e)}}},8565:e=>{"use strict";e.exports=require("@langchain/community/document_loaders/fs/pdf")},8610:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.EpicsService=void 0;const i=r(3563),s=r(5762),a=r(251),c=r(7655),l=r(9615);let d=class{constructor(e){this.epicRepository=e}async getRequirements(e,t){return this.epicRepository.getRequirements(e,t)}async updateRequirements(e,t,r){return this.epicRepository.updateRequirements(e,t,r)}async findAllEpics(e){return this.epicRepository.findAllByWorkspace(e)}async findEpicById(e,t){const r=await this.epicRepository.findById(e,t);if(!r)throw new Error(`Epic with id ${t} not found`);return r}async createEpic(e,t,r){const n=new a.Epic(t,r,e);return this.epicRepository.create(n)}async updateEpic(e,t,r,n){const o=await this.findEpicById(e,t);return o.title=r,o.description=n,o.updatedAt=new Date,this.epicRepository.update(o)}async deleteEpic(e,t){await this.epicRepository.delete(e,t)}async addStory(e,t,r,n,o){const i=new c.Story(r,n,o);return this.epicRepository.addStory(e,t,i)}async updateStory(e,t,r,n,o,i){const s=(await this.findEpicById(e,t)).stories.find((e=>e.id===r));if(!s)throw new Error(`Story with id ${r} not found`);return s.title=n,s.description=o,s.acceptanceCriteria=i,s.updatedAt=new Date,this.epicRepository.updateStory(e,t,s)}async deleteStory(e,t,r){await this.epicRepository.deleteStory(e,t,r)}async getStory(e,t,r){return this.epicRepository.getStory(e,t,r)}async addTask(e,t,r,n,o){const i=new l.Task(n,o);return this.epicRepository.addTask(e,t,r,i)}async updateTask(e,t,r,n,o,i,s){const a=new l.Task(o,i,s,n);return a.updatedAt=new Date,this.epicRepository.updateTask(e,t,r,a)}async deleteTask(e,t,r,n){await this.epicRepository.deleteTask(e,t,r,n)}async getTasks(e,t,r){if(!(await this.findEpicById(e,t)).stories.find((e=>e.id===r)))throw new Error(`Story with id ${r} not found`);return this.epicRepository.getTasks(e,t,r)}async getTask(e,t,r,n){if(!(await this.findEpicById(e,t)).stories.find((e=>e.id===r)))throw new Error(`Story with id ${r} not found`);return this.epicRepository.getTask(e,t,r,n)}};t.EpicsService=d,t.EpicsService=d=n([(0,i.Injectable)(),o("design:paramtypes",[s.FileSystemEpicRepository])],d)},8615:function(e,t,r){"use strict";var n,o,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),o=0;o<r.length;o++)"default"!==r[o]&&i(t,e,r[o]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromptBuilderService=void 0;const u=r(3563),f=c(r(6928)),p=d(r(9055)),h=r(2141),g=r(6170),m=r(9668),y=r(8474);let v=o=class{constructor(e,t,r,n){this.fileSystemService=e,this.rulesService=t,this.userService=r,this.workspaceService=n,this.FILE_LIST_LIMIT=1e3,p.default.info(`[${o.name}] PromptBuilderService initialized`)}async buildPersonaSystemPrompt(e,t,r){p.default.debug(`[${o.name}] Building system prompt for persona: ${e.getId()}`),p.default.debug(`[${o.name}] Context mode: ${r.currentMode}, working dir: ${r.workingDir}`),p.default.debug(`[${o.name}] Tools count: ${t.length}`);const n=await e.getSystemPrompt(r);p.default.debug(`[${o.name}] Base prompt length: ${n.length} characters`);const i=this.generateToolInstructions(t,r);p.default.debug(`[${o.name}] Tool instructions length: ${i.length} characters`);const s=await this.getUserInstructions(r.workingDir,r.workspaceName);p.default.debug(`[${o.name}] User instructions found: ${s?"yes":"no"}`),s&&p.default.debug(`[${o.name}] User instructions length: ${s.length} characters`);const a=await this.buildEnvironmentDetailsBlock(e,r);p.default.debug(`[${o.name}] Environment details length: ${a.length} characters`);const c=`${n}\n\n# Tools\n\n${i}\n\n====\n\n${a}\n\n${s?`\n====\n\nUSER'S CUSTOM INSTRUCTIONS\n\nIMPORTANT: THE FOLLOWING ADDITIONAL INSTRUCTIONS ARE PROVIDED BY THE USER AND MUST BE FOLLOWED TO THE BEST OF YOUR ABILITY (WITHOUT INTERFERRING WITH THE TOOL USE GUIDE).\nWhen you do something because of a user instruction then call it out the rule you are following by name.\n\n${s}\n`:""}`;return p.default.debug(`[${o.name}] Final prompt assembled with total length: ${c.length} characters`),c}async buildEnvironmentDetailsBlock(e,t){p.default.debug(`[${o.name}] Building environment details block for persona: ${e.getId()}`);let r=`<environment_details>\n# Current Time\n${t.currentTime}`;if(e.requiresFileList?.()){p.default.debug(`[${o.name}] Persona requires file list, getting workspace files for: ${t.workingDir}`);r+=`\n\n${await this.buildWorkspaceContextBlock(t.workingDir,{maxTokens:5e4,maxFiles:this.FILE_LIST_LIMIT,includeStats:!1})}`}else p.default.debug(`[${o.name}] Persona does not require file list, skipping`);return r+=`\n\n# Current Mode\n${t.currentMode.toUpperCase()} MODE`,"plan"===t.currentMode&&(r+='\nIn this mode you should focus on information gathering, asking questions, and architecting a solution. Once you have a plan, use the plan_mode_respond tool to engage in a conversational back and forth with the user. Do not use the plan_mode_respond tool until you\'ve gathered all the information you need e.g. with read_file or ask_followup_question.\n(Remember: If it seems the user wants you to use tools only available in Act Mode, you should ask the user to "toggle to Act mode" (use those words) - they will have to manually do this themselves with the Plan/Act toggle button below. You do not have the ability to switch to Act Mode yourself, and must wait for the user to do it themselves once they are satisfied with the plan. You also cannot present an option to toggle to Act mode, as this will be something you need to direct the user to do manually themselves.)'),r+="\n</environment_details>",r}generateToolInstructions(e,t){return e.map((e=>e.getUsageInstructions(t))).join("\n\n")}async getUserInstructions(e,t){try{const r=await this.userService.getCurrentUser(),n=r.userId;return p.default.debug(`[${o.name}] Getting user instructions with user ID: ${n} (${r.email})`),await this.getRulesForSystemPrompt(e,n,t)}catch(e){return void p.default.error(`[${o.name}] Error getting user instructions: ${e.message}\n${e.stack}`)}}async getRulesForSystemPrompt(e,t,r){try{p.default.debug(`[${o.name}] Getting rules for system prompt from working directory: ${e}`),r||(r=f.basename(e),p.default.debug(`[${o.name}] Extracted workspace name from path: ${r}`));const n=(await this.rulesService.getAllRulesWithPreferences(e,t,r)).filter((e=>e.isEnabled));return n.length>0?(p.default.debug(`[${o.name}] Found ${n.length} enabled rules for system prompt`),this.rulesService.formatRuleOutput(n)):void p.default.debug(`[${o.name}] No enabled rules found for system prompt`)}catch(e){return void p.default.error(`[${o.name}] Error getting rules for system prompt: ${e.message}`)}}async buildWorkspaceContextBlock(e,t={}){p.default.debug(`[${o.name}] Building workspace context block for: ${e}`);const{files:r,truncationMarkers:n,stats:i}=await this.fileSystemService.getWorkspaceFileListForLLM(e,{maxTokens:t.maxTokens||5e4,maxFiles:t.maxFiles||1e3});p.default.info(`[${o.name}] File list stats: ${i.includedFiles}/${i.totalFiles} files, ~${Math.round(i.estimatedTokens/1e3)}K tokens, truncated: ${i.truncated}`),p.default.debug(`[${o.name}] Full file list: ${JSON.stringify(r.map((e=>e.path)))}`);let s="# Workspace Files\n\n";(i.truncated||t.includeStats)&&(s+=`${i.truncated?"⚠️ ":""}File list ${i.truncated?"truncated ":""}`,s+=`(${i.includedFiles}/${i.totalFiles} files, ~${Math.round(i.estimatedTokens/1e3)}K tokens)\n\n`);const a=new Map(n.map((e=>[e.directory,e])));let c="";for(const e of r){const t=e.path.includes("/")?e.path.substring(0,e.path.lastIndexOf("/")):"";if(t!==c){if(a.has(t)){s+=`- ${t}/ _(${a.get(t).droppedCount} more files not shown)_\n`,a.delete(t)}c=t}s+=`- ${e.path}${e.isDir?"/":""}\n`}for(const[e,t]of a.entries())s+=`- ${e}/ _(${t.droppedCount} more files not shown)_\n`;return s}async buildTaskWorkspaceContextBlock(e){p.default.debug(`[${o.name}] Building task workspace context for workspace: ${e}`);const t=await this.workspaceService.findOne(e);if(!t)throw new Error(`Workspace ${e} not found`);return this.buildWorkspaceContextBlock(t.repoBaseDir,{maxTokens:5e4,maxFiles:1e3,includeStats:!0})}};t.PromptBuilderService=v,t.PromptBuilderService=v=o=a([(0,u.Injectable)(),l("design:paramtypes",[h.FileSystemService,g.RulesService,m.UserService,y.WorkspaceService])],v)},8620:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LlmMetadataService=void 0;const s=r(3563),a=r(2776),c=r(6206),l=r(2368),d=i(r(9055));let u=class{constructor(e,t){this.appDataSource=e,this.providerRegistry=t,this.serviceName="LlmMetadataService"}get knex(){return this.appDataSource.knex}async onModuleInit(){await this.ensureProvidersInDatabase(),await this.refreshModelsFromProviderApis(),d.default.info(`[${this.serviceName}] LLM metadata service initialized`)}async ensureProvidersInDatabase(){const e=this.providerRegistry.getAllProviders();for(const t of e){const e=t.getId();await this.knex("llm_providers").where("provider_id",e).first()?(await this.knex("llm_providers").where("provider_id",e).update({name:t.getName(),default_model_id:t.getDefaultModelId(),default_base_url:t.getDefaultBaseUrl(),requires_api_key:t.requiresApiKey(),metadata:JSON.stringify(t.getMetadata()),updated_at:this.knex.fn.now()}),d.default.info(`[${this.serviceName}] Updated provider in database: ${e}`)):(await this.knex("llm_providers").insert({provider_id:e,name:t.getName(),default_model_id:t.getDefaultModelId(),default_base_url:t.getDefaultBaseUrl(),requires_api_key:t.requiresApiKey(),metadata:JSON.stringify(t.getMetadata())}),d.default.info(`[${this.serviceName}] Added provider to database: ${e}`))}}async refreshModelsFromProviderApis(){const e=this.providerRegistry.getAllProviders();for(const t of e){const e=t.getId();try{const r=t.getApiKeyName(),n=l.ConfigService.getProperty(r),o=t.getDefaultBaseUrl();n||d.default.warn(`[${this.serviceName}] No API key found for provider: ${e} (looked for environment variable: ${r})`);try{await this.refreshModelsForProvider(e,n||"",o),d.default.info(`[${this.serviceName}] Refreshed models for provider: ${e}`)}catch(t){d.default.error(`[${this.serviceName}] Failed to refresh models for provider ${e}: ${t.message}`)}}catch(t){d.default.error(`[${this.serviceName}] Error processing provider ${e}: ${t.message}`)}}}async refreshModelsForProvider(e,t,r){d.default.debug(`[${this.serviceName}] Refreshing models for provider: ${e}`);try{const n=this.providerRegistry.getProvider(e);d.default.debug(`[${this.serviceName}] Provider found: ${n.getName()}`),d.default.debug(`[${this.serviceName}] Calling discoverModels for provider: ${e}`);const o=await n.discoverModels(t,r);d.default.debug(`[${this.serviceName}] Discovered ${o.length} models for provider: ${e}`);for(const e of o)d.default.debug(`[${this.serviceName}] Discovered model: ${e.modelId} (${e.name})`);for(const e of o)try{await this.knex("llm_models").where({model_id:e.modelId,provider_id:e.providerId}).first()?(d.default.info(`[${this.serviceName}] Updating existing model in database: ${e.modelId}`),await this.knex("llm_models").where({model_id:e.modelId,provider_id:e.providerId}).update({name:e.name,context_window:e.contextWindow,max_output_tokens:e.maxOutputTokens,supports_images:e.supportsImages,supports_tool_use:e.supportsToolUse,supports_computer_use:e.supportsComputerUse,supports_prompt_cache:e.supportsPromptCache,supports_thinking_tokens:e.supportsThinkingTokens,recommended_thinking_tokens:e.recommendedThinkingTokens,max_thinking_tokens:e.maxThinkingTokens,input_cost_per_million_tokens:e.inputCostPerMillionTokens,output_cost_per_million_tokens:e.outputCostPerMillionTokens,cache_writes_price:e.cacheWritesPrice,cache_reads_price:e.cacheReadsPrice,metadata:JSON.stringify(e.metadata||{}),is_default_for_provider:e.isDefaultForProvider,updated_at:this.knex.fn.now()}),d.default.info(`[${this.serviceName}] Successfully updated model in database: ${e.modelId}`)):(d.default.info(`[${this.serviceName}] Adding new model to database: ${e.modelId}`),await this.knex("llm_models").insert({model_id:e.modelId,provider_id:e.providerId,name:e.name,context_window:e.contextWindow,max_output_tokens:e.maxOutputTokens,supports_images:e.supportsImages,supports_tool_use:e.supportsToolUse,supports_computer_use:e.supportsComputerUse,supports_prompt_cache:e.supportsPromptCache,supports_thinking_tokens:e.supportsThinkingTokens,recommended_thinking_tokens:e.recommendedThinkingTokens,max_thinking_tokens:e.maxThinkingTokens,input_cost_per_million_tokens:e.inputCostPerMillionTokens,output_cost_per_million_tokens:e.outputCostPerMillionTokens,cache_writes_price:e.cacheWritesPrice,cache_reads_price:e.cacheReadsPrice,metadata:JSON.stringify(e.metadata||{}),is_default_for_provider:e.isDefaultForProvider}),d.default.info(`[${this.serviceName}] Successfully added model to database: ${e.modelId}`))}catch(t){d.default.error(`[${this.serviceName}] Error processing model ${e.modelId}: ${t.message}`,t.stack)}const i=await this.getModelsForProvider(e);d.default.info(`[${this.serviceName}] Retrieved ${i.length} models for provider ${e} after refresh`)}catch(t){throw d.default.error(`[${this.serviceName}] Error refreshing models for provider ${e}: ${t.message}`,t.stack),t}}async getModelsForProvider(e){d.default.debug(`[${this.serviceName}] Getting models for provider: ${e}`);try{const t=this.providerRegistry.getProvider(e);d.default.info(`[${this.serviceName}] Provider found in registry: ${t.getName()}`);const r=await this.knex("llm_models").where("provider_id",e).select("*");d.default.debug(`[${this.serviceName}] Retrieved ${r.length} models for provider ${e} from database`);return r.map((e=>({modelId:e.model_id,providerId:e.provider_id,name:e.name,contextWindow:e.context_window,maxOutputTokens:e.max_output_tokens,supportsImages:e.supports_images,supportsToolUse:e.supports_tool_use,supportsComputerUse:e.supports_computer_use,supportsPromptCache:e.supports_prompt_cache,supportsThinkingTokens:e.supports_thinking_tokens||!1,recommendedThinkingTokens:e.recommended_thinking_tokens,maxThinkingTokens:e.max_thinking_tokens,inputCostPerMillionTokens:e.input_cost_per_million_tokens,outputCostPerMillionTokens:e.output_cost_per_million_tokens,cacheWritesPrice:e.cache_writes_price,cacheReadsPrice:e.cache_reads_price,metadata:e.metadata?JSON.parse(e.metadata):void 0,isDefaultForProvider:e.is_default_for_provider})))}catch(t){throw d.default.error(`[${this.serviceName}] Error getting models for provider ${e}: ${t.message}`,t.stack),t}}};t.LlmMetadataService=u,t.LlmMetadataService=u=n([(0,s.Injectable)(),o("design:paramtypes",[a.AppDataSource,c.ProviderRegistry])],u)},8624:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.StoredFileModule=void 0;const o=r(3563),i=r(5056),s=r(7205),a=r(4632),c=r(376);let l=class{};t.StoredFileModule=l,t.StoredFileModule=l=n([(0,o.Module)({imports:[c.DataSourceModule],controllers:[i.StoredFileController],providers:[s.StoredFileService,a.StoredFileRepository],exports:[s.StoredFileService]})],l)},8627:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.KnexMigrationManager=void 0;const o=n(r(9055));t.KnexMigrationManager=class{constructor(e){this.knexInstance=e}async runMigrations(){try{const e=await this.knexInstance.migrate.latest();return o.default.info(`Ran ${e[1].length} migrations`),e[1]}catch(e){throw o.default.error("Failed to run Knex migrations",e),e}}async getMigrationStatus(){try{const e=await this.knexInstance.migrate.list();return{completed:e[0],newMigrations:e[1]}}catch(e){throw o.default.error("Failed to get Knex migration status",e),e}}}},8648:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StoredDocRepository=void 0;const s=r(3563),a=(r(1832),r(3543)),c=r(7823);let l=class{constructor(e){this.knex=e,this.columns={all:["id","contents","mimeType","createdAt","sessionId","workspaceName"],withoutContents:["id","mimeType","createdAt","sessionId","workspaceName"]}}async save(e){await this.knex("stored_docs").insert({id:e.id,contents:e.contents,mimeType:e.mimeType,createdAt:e.createdAt,sessionId:e.sessionId,workspaceName:e.workspaceName})}async findById(e){const t=await this.knex("stored_docs").select(this.columns.all).where("id",e).first();return t?new a.StoredDoc(t.contents,t.mimeType,t.sessionId,t.workspaceName,t.id,t.createdAt):null}async findByIdWithoutContents(e){const t=await this.knex("stored_docs").select(this.columns.withoutContents).where("id",e).first();return t?c.StoredDocDTO.fromStoredDoc(t):null}async findBySessionId(e){return(await this.knex("stored_docs").select(this.columns.withoutContents).where("sessionId",e)).map((e=>c.StoredDocDTO.fromStoredDoc(e)))}async findByWorkspaceName(e){return(await this.knex("stored_docs").select(this.columns.withoutContents).where("workspaceName",e)).map((e=>c.StoredDocDTO.fromStoredDoc(e)))}};t.StoredDocRepository=l,t.StoredDocRepository=l=n([(0,s.Injectable)(),i(0,(0,s.Inject)("KNEX")),o("design:paramtypes",[Function])],l)},8678:e=>{"use strict";e.exports=require("tree-sitter-c-sharp")},8756:e=>{"use strict";e.exports=require("minimatch")},8781:e=>{"use strict";e.exports=require("@nestjs/core")},8787:e=>{"use strict";e.exports=require("he")},8804:e=>{"use strict";e.exports=require("@langchain/langgraph/prebuilt")},8817:e=>{"use strict";e.exports=require("file-type")},8884:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEnv=function(e,t){let r;"undefined"!=typeof process&&process.env?r=process.env[e]:"undefined"!=typeof globalThis&&"Deno"in globalThis?r=globalThis.Deno.env.get(e):console.warn(`Unable to access environment variables. Key: ${e}`);return void 0!==r?r:t}},8910:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MistralProvider=void 0;const o=r(2196),i=r(8483),s=r(8959),a=r(2368),c=n(r(8938));class l extends i.BaseProvider{getName(){return"mistral"}getBaseChatModel(e,t){return new o.ChatMistralAI({modelName:this.shortModelName(e),temperature:t.temperature,apiKey:a.ConfigService.getInstance().getProperty("MISTRAL_API_KEY")})}async getModelDescriptors(){return(await this.fetchModels()).map((e=>{let t=1e-6,r=3e-6;return e.id.includes("large")?(t=7e-6,r=2e-5):e.id.includes("medium")&&(t=25e-7,r=7e-6),new s.ModelDescriptor("mistral",e.id,t,0,0,r)}))}isValid(){return!!a.ConfigService.getInstance().getProperty("MISTRAL_API_KEY")}async fetchModels(){if(l.modelsCache&&Date.now()-l.modelsCache.timestamp<l.CACHE_TTL)return l.modelsCache.models;const e=a.ConfigService.getInstance().getProperty("MISTRAL_API_KEY");if(!e)return console.log("Mistral API key not found"),[];try{const t=await c.default.get("https://api.mistral.ai/v1/models",{headers:{Authorization:`Bearer ${e}`}});if(200===t.status){const e=t.data.data||[];return l.modelsCache={models:e,timestamp:Date.now()},e}return console.log(`Failed to fetch Mistral models. Status code: ${t.status}`),[]}catch(e){return console.error(`Error fetching Mistral models: ${e}`),[]}}}t.MistralProvider=l,l.modelsCache=null,l.CACHE_TTL=3e5},8921:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EpicsPrompts=void 0;const c=r(6426),l=s(r(6928)),d=s(r(9896)),u=a(r(526));t.EpicsPrompts=class{static async getEpicsTree(e){const t=l.join(e.workspace.repoBaseDir,"epics"),r=(0,u.default)();return d.existsSync(t)?(0,c.generateTreeRecursive)(t,r,t):(d.mkdirSync(t,{recursive:!0}),"└── (empty epics directory)")}static async existingEpicsAndStories(e){return`To work with epics in this workspace, you need to understand the file structure:\n\n${await this.getEpicsTree(e)}\n\nEach epic follows this structure:\nEPIC-XX_Name/\n  ├── requirements.md (contains epic title and description)\n  └── stories/\n      └── STORY-XX_Name/\n          ├── story.json (contains story details)\n          └── tasks/\n              └── TASK-XX_Name.json (individual task details)\n\nUse the read_file tool (e.g. path: ./epics/EPIC-XX_Name/requirements.md) to inspect these files and understand the current state of epics.`}static async updateEpicInstructions(e){return"To create or update an epic:\n\n1. For a new epic:\n   - Create a directory named EPIC-XX_Name (where XX is a sequential number and Name is a short title)\n   - Use update_file to create requirements.md in the epic directory with this structure:\n     # XX_Name\n     \n     ## Description\n     Epic description goes here\n     \n     ## Goals\n     - Add specific, measurable goals here\n     \n     ## Success Criteria\n     - List the criteria that define when this epic is complete\n\n2. For updating an existing epic:\n   - Use read_file to get the current requirements.md content\n   - Use update_file to update the requirements.md with the new content (path: ./epics/EPIC-XX_Name/requirements.md)\n   - Maintain the same format with title, description, goals, and success criteria sections\n\nThe epic directory should be under the workspace at: ./epics/EPIC-XX_Name/"}static async updateEpicStories(e){return'To create or update stories in an epic:\n\n1. For a new story:\n   - Create a directory named STORY-XX_Name under the epic\'s stories directory\n   - Use update_file to create story.json with this structure:\n     {\n       "id": "STORY-XX_Name",\n       "title": "Story Title",\n       "description": "Detailed story description",\n       "status": "backlog",\n       "createdAt": "<use current_timestamp>",\n       "updatedAt": "<use current_timestamp>",\n       "acceptanceCriteria": [\n         "AC01: Given a normal user, when they log in, then they should see a welcome message",\n         "AC02: Given an admin user, when they log in, then they should be taken to the admin dashboard"\n       ]\n     }\n\n2. For updating an existing story:\n   - Use read_file to get the current story.json content\n   - Use update_file to update the story.json with the new content\n   - Maintain all existing fields and update only what\'s changed\n   - Update the updatedAt timestamp using current_timestamp\n\nThe story file should be under the stories directory of the epic which is under the workspace at: ./epics/EPIC-XX_Name/stories/STORY-XX_Name/story.json\n\nValid status values are: "backlog", "inprogress", "done" (all lowercase)'}static async updateStoryTasks(e){return`To create or update tasks in a story:\n\n1. For a new task:\n   - Create a new file named TASK-XX_Name.json in the story's tasks directory\n   - Use update_file to create the task with this structure:\n     {\n       "id": "TASK-XX_Name",\n       "title": "Task Title",\n       "description": "Detailed task description",\n       "assignee": "Agent-X",\n       "status": "backlog",\n       "createdAt": "<use current_timestamp>",\n       "updatedAt": "<use current_timestamp>"\n     }\n\n2. For updating an existing task:\n   - Use read_file to get the current task JSON file\n   - Update the necessary fields\n   - Update the updatedAt timestamp using current_timestamp\n   - Use update_file to save the modified task\n\nThe task files should be at: ${e.workspace.repoBaseDir}/epics/EPIC-XX_Name/stories/STORY-XX_Name/tasks/TASK-XX_Name.json\n\nValid task status values are: "backlog", "inprogress", "done" (all lowercase)\n\nRemember to update the story's status based on its tasks:\n- If all tasks are done -> story is done\n- If any task is inprogress -> story is inprogress\n- If all tasks are backlog or no tasks -> story is backlog\n\nAlso update the story.json file to reflect the current task status.`}static async allEpicInstructions(e){return`# Complete Epic Management Instructions\n\n${await this.existingEpicsAndStories(e)}\n\n${await this.updateEpicInstructions(e)}\n\n${await this.updateEpicStories(e)}\n\n${await this.updateStoryTasks(e)}\n\nRemember:\n1. Keep timestamps updated using current_timestamp\n2. Maintain proper status transitions\n3. Preserve existing data when updating\n4. Follow the exact file structure and formats`}}},8938:e=>{"use strict";e.exports=require("axios")},8959:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModelDescriptor=void 0;t.ModelDescriptor=class{constructor(e,t,r,n,o,i,s=!1){this.provider=e,this.name=t,this.costPerInputToken=r,this.costPerCacheWriteToken=n,this.costPerCacheReadToken=o,this.costPerOutputToken=i,this.supportsThinking=s}getFullName(){return`${this.provider}/${this.name}`}}},9023:e=>{"use strict";e.exports=require("util")},9037:e=>{"use strict";e.exports=require("@modelcontextprotocol/sdk/client/index.js")},9055:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=s(r(5124)),l=s(r(9896)),d=s(r(6928)),u=r(8884),f=a(r(9233)),p=d.join(process.cwd(),"logs");l.existsSync(p)||l.mkdirSync(p,{recursive:!0});const h=d.join(p,"debug");l.existsSync(h)||l.mkdirSync(h,{recursive:!0});const g=d.join(p,"eve-server-%DATE%.log"),m=(0,u.getEnv)("LOG_FILE_PATH",g);console.log(`Log file pattern: ${m}`);const y=new f.default({filename:m,datePattern:"YYYY-MM-DD",zippedArchive:!0,maxSize:"20m",maxFiles:"14d",level:"debug"}),v=c.format.printf((e=>{const{level:t,message:r,timestamp:n}=e,o=new Date(n);return`${`${(o.getMonth()+1).toString().padStart(2,"0")}/${o.getDate().toString().padStart(2,"0")}/${o.getFullYear()}, ${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}:${o.getSeconds().toString().padStart(2,"0")} ${o.getHours()>=12?"PM":"AM"}`} - ${t.toUpperCase()}: ${r}`})),_=c.createLogger({level:"debug",format:c.format.combine(c.format.splat(),c.format.timestamp(),v),transports:[new c.transports.Console({level:"info"}),y]});t.default=_},9076:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FeedbackEventHandler=void 0;const a=r(3563),c=s(r(9055)),l=r(461),d=r(6550),u=r(6349),f=r(9100),p=r(1280),h=r(5444);let g=n=class{constructor(e,t,r){this.taskService=e,this.conversationHistoryService=t,this.eventEmitter=r}async handleFollowupResponse(e,t){c.default.info(`[${n.name}] Processing followupResponse message from client: ${t.id}`);try{await this.taskService.updateTaskStep({taskId:e.taskId,stepNumber:e.stepNumber,toolOutput:JSON.stringify({response:e.response}),status:"completed"}),this.eventEmitter.emit(p.InternalEvents.TASK_UPDATED,{clientId:t.id,taskId:e.taskId,status:h.TaskStatus.IN_PROGRESS,data:{action:"followup_response_received",details:"Processing followup response..."}})}catch(r){c.default.error(`[${n.name}] Error handling followup response: ${r.message}\n${r.stack}`),this.eventEmitter.emit(p.InternalEvents.TOOL_ERROR,{clientId:t.id,taskId:e.taskId,error:r.message,type:"task_error",context:{source:"followupResponse",stepNumber:e.stepNumber}})}}async handleCompletionFeedback(e,t,r){c.default.info(`[${n.name}] Processing completionFeedback message from client: ${t.id}`);try{const o={id:(0,f.ulid)(),taskId:e.taskId,role:"user",segments:[{type:"text",content:e.feedback}],providerId:"system",createdAt:new Date};if(await this.conversationHistoryService.addMessage(e.taskId,o),e.continueTask){c.default.info(`[${n.name}] Continuing task ${e.taskId} with feedback`),await this.taskService.updateTask({taskId:e.taskId,status:h.TaskStatus.IN_PROGRESS}),this.eventEmitter.emit(p.InternalEvents.TASK_UPDATED,{clientId:t.id,taskId:e.taskId,status:h.TaskStatus.IN_PROGRESS,data:{details:"Processing feedback..."}});const o=(await this.taskService.getTask(e.taskId)).mode||"act";await r(e.taskId,t.id,o)}else this.eventEmitter.emit(p.InternalEvents.TASK_UPDATED,{clientId:t.id,taskId:e.taskId,status:h.TaskStatus.WAITING_FOR_INPUT,data:{action:"feedback_received",details:"Feedback received. Task not continued."}})}catch(r){c.default.error(`[${n.name}] Error handling completion feedback: ${r.message}\n${r.stack}`),this.eventEmitter.emit(p.InternalEvents.TOOL_ERROR,{clientId:t.id,taskId:e.taskId,error:r.message,type:"task_error",context:{source:"completionFeedback"}})}}};t.FeedbackEventHandler=g,t.FeedbackEventHandler=g=n=o([(0,a.Injectable)(),i("design:paramtypes",[d.TaskService,u.ConversationHistoryService,l.EventEmitter2])],g)},9086:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.execCommand=async function(e,t){return new Promise((r=>{i.default.debug(`Executing command: ${e}`),(0,o.exec)(e,t,((e,t,n)=>{const o={stdout:t?t.toString():"",stderr:n?n.toString():"",code:e?e.code||1:0};i.default.debug(`Command execution completed with code ${o.code}`),0!==o.code&&i.default.debug(`Command stderr: ${o.stderr}`),r(o)}))}))};const o=r(5317),i=n(r(9055))},9095:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ItemRepository=void 0;const s=r(3563);r(1832);let a=class{constructor(e){this.knex=e}async findAll(e,t){let r=this.knex("items").select("*");if(t&&(r=r.orderBy(t.field,t.order.toLowerCase())),e){const{page:t,limit:n}=e,o=(t-1)*n;r=r.offset(o).limit(n)}return r}async findById(e){return this.knex("items").where("itemId",e).first()}async findBySessionId(e,t,r){let n=this.knex("items").where("sessionId",e);if(r&&(n=n.orderBy(r.field,r.order.toLowerCase())),t){const{page:e,limit:r}=t,o=(e-1)*r;n=n.offset(o).limit(r)}return n}async create(e){await this.knex("items").insert(e)}async update(e,t){await this.knex("items").where("itemId",e).update(t)}async delete(e){await this.knex("items").where("itemId",e).delete()}async countBySessionId(e){const t=await this.knex("items").where("sessionId",e).count("* as count").first();return t?.count}async getSessionStats(e){const t=await this.knex("items").select("sessionId").sum("inputTokens as inputTokens").sum("cacheWriteTokens as cacheWriteTokens").sum("cacheReadTokens as cacheReadTokens").sum("outputTokens as outputTokens").sum("totalTokens as totalTokens").sum("cost as cost").whereIn("sessionId",e).groupBy("sessionId"),r={};return t.forEach((e=>{r[e.sessionId]={inputTokens:e.inputTokens,cacheWriteTokens:e.cacheWriteTokens,cacheReadTokens:e.cacheReadTokens,outputTokens:e.outputTokens,totalTokens:e.totalTokens,cost:e.cost}})),r}async getRequestStats(e){const t=await this.knex("items").select("requestId").sum("inputTokens as inputTokens").sum("cacheWriteTokens as cacheWriteTokens").sum("cacheReadTokens as cacheReadTokens").sum("outputTokens as outputTokens").sum("totalTokens as totalTokens").sum("cost as cost").whereIn("requestId",e).groupBy("requestId"),r={};return t.forEach((e=>{r[e.requestId]={inputTokens:e.inputTokens,cacheWriteTokens:e.cacheWriteTokens,cacheReadTokens:e.cacheReadTokens,outputTokens:e.outputTokens,totalTokens:e.totalTokens,cost:e.cost}})),r}};t.ItemRepository=a,t.ItemRepository=a=n([(0,s.Injectable)(),i(0,(0,s.Inject)("KNEX")),o("design:paramtypes",[Function])],a)},9100:e=>{"use strict";e.exports=require("ulid")},9102:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EveConfigService=void 0;const d=r(3563),u=r(2776),f=a(r(6982)),p=r(2368),h=r(6206),g=l(r(9055));let m=class{constructor(e,t){this.appDataSource=e,this.providerRegistry=t,this.serviceName="EveConfigService",this.encryptionEnabled=!!process.env.API_KEY_ENCRYPTION_SECRET,this.encryptionKey=this.encryptionEnabled?f.scryptSync(process.env.API_KEY_ENCRYPTION_SECRET,"salt",32):Buffer.alloc(32),this.encryptionIv=Buffer.from("1234567890123456"),this.encryptionEnabled?g.default.info(`[${this.serviceName}] API key encryption is enabled`):g.default.warn(`[${this.serviceName}] API key encryption is disabled - API keys will be stored in plain text. Set API_KEY_ENCRYPTION_SECRET to enable encryption.`)}get knex(){return this.appDataSource.knex}async getAllProviders(){try{return(await this.knex("llm_providers").select("*")).map((e=>({providerId:e.provider_id,name:e.name,defaultModelId:e.default_model_id,defaultBaseUrl:e.default_base_url,requiresApiKey:e.requires_api_key,metadata:e.metadata?JSON.parse(e.metadata):void 0})))}catch(e){throw g.default.error(`[${this.serviceName}] Failed to get providers: ${e}`),new Error("Failed to get providers")}}async getProvider(e){try{const t=await this.knex("llm_providers").where("provider_id",e).first();return t?{providerId:t.provider_id,name:t.name,defaultModelId:t.default_model_id,defaultBaseUrl:t.default_base_url,requiresApiKey:t.requires_api_key,metadata:t.metadata?JSON.parse(t.metadata):void 0}:null}catch(t){throw g.default.error(`[${this.serviceName}] Failed to get provider ${e}: ${t}`),new Error(`Failed to get provider: ${e}`)}}async getModelsForProvider(e){try{return(await this.knex("llm_models").where("provider_id",e).select("*")).map((e=>({modelId:e.model_id,providerId:e.provider_id,name:e.name,contextWindow:e.context_window,maxOutputTokens:e.max_output_tokens,supportsImages:e.supports_images,supportsToolUse:e.supports_tool_use,supportsComputerUse:e.supports_computer_use,supportsPromptCache:e.supports_prompt_cache,supportsThinkingTokens:e.supports_thinking_tokens||!1,recommendedThinkingTokens:e.recommended_thinking_tokens,maxThinkingTokens:e.max_thinking_tokens,inputCostPerMillionTokens:e.input_cost_per_million_tokens,outputCostPerMillionTokens:e.output_cost_per_million_tokens,cacheWritesPrice:e.cache_writes_price,cacheReadsPrice:e.cache_reads_price,metadata:e.metadata?JSON.parse(e.metadata):void 0,isDefaultForProvider:e.is_default_for_provider})))}catch(t){throw g.default.error(`[${this.serviceName}] Failed to get models for provider ${e}: ${t}`),new Error(`Failed to get models for provider: ${e}`)}}async getModel(e){try{const t=await this.knex("llm_models").where("model_id",e).first();return t?{modelId:t.model_id,providerId:t.provider_id,name:t.name,contextWindow:t.context_window,maxOutputTokens:t.max_output_tokens,supportsImages:t.supports_images,supportsToolUse:t.supports_tool_use,supportsComputerUse:t.supports_computer_use,supportsPromptCache:t.supports_prompt_cache,supportsThinkingTokens:t.supports_thinking_tokens||!1,recommendedThinkingTokens:t.recommended_thinking_tokens,maxThinkingTokens:t.max_thinking_tokens,inputCostPerMillionTokens:t.input_cost_per_million_tokens,outputCostPerMillionTokens:t.output_cost_per_million_tokens,cacheWritesPrice:t.cache_writes_price,cacheReadsPrice:t.cache_reads_price,metadata:t.metadata?JSON.parse(t.metadata):void 0,isDefaultForProvider:t.is_default_for_provider}:null}catch(t){throw g.default.error(`[${this.serviceName}] Failed to get model ${e}: ${t}`),new Error(`Failed to get model: ${e}`)}}async getAllModes(){try{return(await this.knex("agent_modes").select("*")).map((e=>({modeId:e.mode_id,name:e.name,description:e.description,defaultProviderId:e.default_provider_id,defaultModelId:e.default_model_id,defaultThinkingTokens:e.default_thinking_tokens,defaultBaseUrl:e.default_base_url,defaultApiKeySecretName:e.default_api_key_secret_name})))}catch(e){throw g.default.error(`[${this.serviceName}] Failed to get modes: ${e}`),new Error("Failed to get modes")}}async getMode(e){try{const t=await this.knex("agent_modes").where("mode_id",e).first();return t?{modeId:t.mode_id,name:t.name,description:t.description,defaultProviderId:t.default_provider_id,defaultModelId:t.default_model_id,defaultThinkingTokens:t.default_thinking_tokens,defaultBaseUrl:t.default_base_url,defaultApiKeySecretName:t.default_api_key_secret_name}:null}catch(t){throw g.default.error(`[${this.serviceName}] Failed to get mode ${e}: ${t}`),new Error(`Failed to get mode: ${e}`)}}async getUserConfiguration(e){try{const t=await this.knex("user_llm_configurations").where("user_id",e).select("*"),r=await this.getAllModes(),n={};for(const e of r)n[e.modeId]={activeProviderId:e.defaultProviderId,providerSettings:{}};for(const e of t)n[e.mode_id]||(n[e.mode_id]={activeProviderId:e.provider_id,providerSettings:{}}),e.is_active_for_mode&&(n[e.mode_id].activeProviderId=e.provider_id),n[e.mode_id].providerSettings[e.provider_id]={providerId:e.provider_id,selectedModelId:e.selected_model_id,baseUrl:e.base_url,thinkingTokens:e.thinking_tokens,apiKey:e.api_key?this.getMaskedApiKey(e.api_key):void 0,isApiKeySet:!!e.api_key};return n}catch(t){throw g.default.error(`[${this.serviceName}] Failed to get user configuration for ${e}: ${t}`),new Error(`Failed to get user configuration: ${e}`)}}async updateUserModeConfiguration(e,t,r,n){try{const o={};void 0!==n.selectedModelId&&(o.selected_model_id=n.selectedModelId),void 0!==n.baseUrl&&(o.base_url=n.baseUrl),void 0!==n.thinkingTokens&&(o.thinking_tokens=n.thinkingTokens),void 0!==n.apiKey&&(o.api_key=n.apiKey?this.encryptApiKey(n.apiKey):null);const i=await this.knex("user_llm_configurations").where({user_id:e,mode_id:t,provider_id:r}).first();"thinkingTokens"in n?o.thinking_tokens=void 0===n.thinkingTokens?null:n.thinkingTokens:i&&(o.thinking_tokens=null),i?await this.knex("user_llm_configurations").where({user_id:e,mode_id:t,provider_id:r}).update({...o,updated_at:this.knex.fn.now()}):await this.knex("user_llm_configurations").insert({user_id:e,mode_id:t,provider_id:r,...o,is_active_for_mode:!1})}catch(n){throw g.default.error(`[${this.serviceName}] Failed to update user configuration for ${e}, ${t}, ${r}: ${n}`),new Error(`Failed to update user configuration: ${e}, ${t}, ${r}`)}}async setActiveProviderForMode(e,t,r){try{await this.knex.transaction((async n=>{await n("user_llm_configurations").where({user_id:e,mode_id:t}).update({is_active_for_mode:!1,updated_at:n.fn.now()});await n("user_llm_configurations").where({user_id:e,mode_id:t,provider_id:r}).first()?await n("user_llm_configurations").where({user_id:e,mode_id:t,provider_id:r}).update({is_active_for_mode:!0,updated_at:n.fn.now()}):await n("user_llm_configurations").insert({user_id:e,mode_id:t,provider_id:r,is_active_for_mode:!0})}))}catch(n){throw g.default.error(`[${this.serviceName}] Failed to set active provider for ${e}, ${t}, ${r}: ${n}`),new Error(`Failed to set active provider: ${e}, ${t}, ${r}`)}}async assembleFinalConfiguration(e,t){try{const r=await this.getMode(t);if(!r)throw new Error(`Mode not found: ${t}`);const n=(await this.getUserConfiguration(e))[t];if(!n){const e=await this.getProvider(r.defaultProviderId);if(!e)throw new Error(`Default provider not found: ${r.defaultProviderId}`);const n=r.defaultModelId||e.defaultModelId;if(!n)throw new Error(`No default model found for mode: ${t} and provider: ${e.providerId}`);const o=await this.getModel(n);if(!o)throw new Error(`Model not found: ${n}`);let i;return r.defaultApiKeySecretName&&(i=process.env[r.defaultApiKeySecretName]),{modeId:t,providerId:e.providerId,modelId:n,baseUrl:r.defaultBaseUrl||e.defaultBaseUrl,apiKey:i,thinkingTokens:this.determineThinkingTokens(r,o),modelInfo:o}}const o=n.activeProviderId,i=await this.getProvider(o);if(!i)throw new Error(`Provider not found: ${o}`);const s=n.providerSettings[o]||{providerId:o,isApiKeySet:!1},a=s.selectedModelId||r.defaultModelId||i.defaultModelId;if(!a)throw new Error(`No model found for mode: ${t} and provider: ${i.providerId}`);const c=await this.getModel(a);if(!c)throw new Error(`Model not found: ${a}`);let l;if(s.isApiKeySet){const r=await this.knex("user_llm_configurations").where({user_id:e,mode_id:t,provider_id:o}).select("api_key").first();r&&r.api_key&&(l=this.decryptApiKey(r.api_key),g.default.info(`[${this.serviceName}] Using API key from user configurations for provider ${o}`))}if(!l)try{const e=this.providerRegistry.getProvider(o).getApiKeyName();if(l=p.ConfigService.getProperty(e),!l)throw new Error(`No API key found for provider ${o}. Please configure an API key in settings or system configuration.`);g.default.info(`[${this.serviceName}] Using API key from ConfigService for provider ${o}`)}catch(e){throw g.default.error(`[${this.serviceName}] Error getting API key for provider ${o}: ${e.message}`),new Error(`No valid API key configuration found for provider ${o}.`)}const d=s.baseUrl||r.defaultBaseUrl||i.defaultBaseUrl;return{modeId:t,providerId:o,modelId:a,baseUrl:d,apiKey:l,thinkingTokens:this.determineThinkingTokens(r,c,s.thinkingTokens),modelInfo:c}}catch(r){throw g.default.error(`[${this.serviceName}] Failed to assemble configuration for ${e}, ${t}: ${r}`),new Error(`Failed to assemble configuration: ${e}, ${t}`)}}determineThinkingTokens(e,t,r){if(t.supportsThinkingTokens)return void 0!==r?r:void 0!==e.defaultThinkingTokens?e.defaultThinkingTokens:void 0!==t.recommendedThinkingTokens?t.recommendedThinkingTokens:2048}encryptApiKey(e){if(!this.encryptionEnabled)return e;try{const t=f.createCipheriv("aes-256-cbc",this.encryptionKey,this.encryptionIv);let r=t.update(e,"utf8","hex");return r+=t.final("hex"),`enc:${r}`}catch(t){return g.default.error(`[${this.serviceName}] Failed to encrypt API key: ${t}`),e}}isEncryptedApiKey(e){return e.startsWith("enc:")}decryptApiKey(e){if(!this.isEncryptedApiKey(e))return e;if(!this.encryptionEnabled)return g.default.warn(`[${this.serviceName}] Found encrypted API key but encryption is not enabled`),e.substring(4);const t=e.substring(4);try{const e=f.createDecipheriv("aes-256-cbc",this.encryptionKey,this.encryptionIv);let r=e.update(t,"hex","utf8");return r+=e.final("utf8"),r}catch(e){return g.default.error(`[${this.serviceName}] Failed to decrypt API key: ${e}`),t}}getMaskedApiKey(e){try{const t=this.decryptApiKey(e);if(t.length<=8)return t;const r=t.substring(0,8);return`${r}${"*".repeat(Math.min(t.length-8,10))}`}catch(e){return g.default.error(`[${this.serviceName}] Failed to mask API key: ${e}`),"********"}}async findApiKeyForProvider(e,t){try{g.default.info(`[${this.serviceName}] Finding API key for user ${e} and provider ${t}`);const r=await this.knex("user_llm_configurations").where({user_id:e,provider_id:t}).whereNotNull("api_key").first();return r&&r.api_key?(g.default.info(`[${this.serviceName}] Found API key for provider ${t} from user ${e}`),{apiKey:this.decryptApiKey(r.api_key),baseUrl:r.base_url}):void g.default.info(`[${this.serviceName}] No API key found for provider ${t} from user ${e}`)}catch(e){return void g.default.error(`[${this.serviceName}] Error finding API key for provider ${t}: ${e.message}`)}}};t.EveConfigService=m,t.EveConfigService=m=s([(0,d.Injectable)(),c("design:paramtypes",[u.AppDataSource,h.ProviderRegistry])],m)},9123:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.IssueSeverity=void 0,function(e){e.ERROR="error",e.WARNING="warning",e.INFO="info"}(r||(t.IssueSeverity=r={}))},9150:e=>{"use strict";e.exports=require("@modelcontextprotocol/sdk/types.js")},9161:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatCompletionModule=void 0;const o=r(3563),i=r(3239);let s=class{};t.ChatCompletionModule=s,t.ChatCompletionModule=s=n([(0,o.Module)({providers:[i.SummaryCompletion],exports:[i.SummaryCompletion]})],s)},9179:e=>{"use strict";e.exports=require("@langchain/community/document_loaders/fs/docx")},9187:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultKnexConfig=function(){y||(y=m());return y};const c=s(r(9896)),l=s(r(6928)),d=s(r(857)),u=a(r(9055)),f=l.join(d.homedir(),".eve","db","eve.sqlite");function p(){let e=__dirname,t=l.join(e,"migrations");for(u.default.info(`Looking for migrations in: ${t} - will recurse up looking for migrations`);!h(t);)e=l.dirname(e),t=l.join(e,"migrations");if(g(t)||(t=l.join(process.cwd(),"migrations")),g(t)||(t=l.join(process.cwd(),"server","migrations")),!g(t))throw new Error("No migrations directory found in any of the usual locations");return t}function h(e){return c.existsSync(e)&&g(e)}function g(e){return c.readdirSync(e).some((e=>e.endsWith(".js")))}function m(e){let t;void 0===e&&(e=process.env.DB_CHOICE||"local"),u.default.info(`Using database configuration: ${e}`);try{t=function(e=process.env.DB_CHOICE||"local"){let t,r=process.env.DB_CONFIG_PATH||"db-config.json";try{t=c.readFileSync(r,"utf8")}catch(e){r=l.join(process.cwd(),"config","db-config.json");try{t=c.readFileSync(r,"utf8")}catch(e){throw new Error("Unable to find db-config.json")}}u.default.info(`Using db config at: ${r}`);const n=JSON.parse(t);if(!n[e])throw u.default.error(`Invalid DB_CHOICE: ${e} - not found in db-config.json - ${JSON.stringify(n)}`),new Error(`Invalid DB_CHOICE: ${e} - not found in db-config.json`);const o=n[e],i=o.connection;if("object"==typeof i&&"filename"in i&&(i.filename=i.filename.replace("~",d.homedir()),!c.existsSync(i.filename))){const e=l.dirname(r),t=l.resolve(e,i.filename);u.default.info(`Resolved filename: ${t} from config file directory: ${e} using relative path: ${i.filename}`),c.existsSync(t)?i.filename=t:u.default.warn(`DB File does not exist: ${t}`)}const s=o.migrations;if(s&&"string"==typeof s.directory){const e=l.resolve(l.dirname(r),s.directory);g(e)&&(o.migrations.directory=e)}return o.useNullAsDefault=!0,o}(e)}catch(r){if("local"!==e)throw u.default.error("error",r),u.default.error(`Invalid DB_CHOICE: ${e} - no db-config.json found`),new Error(`Invalid DB_CHOICE: ${e} - no db-config.json found`);u.default.info("Did not find db-config.json, using default SQLite configuration"),t={client:"better-sqlite3",connection:{filename:f},useNullAsDefault:!0}}if(u.default.info(`Using db config (after making paths absolute): ${JSON.stringify(t)}`),t.migrations||(u.default.warn("No migrations directory found in db-config.json, using default"),t.migrations={directory:p()}),t.migrations.extension="js","better-sqlite3"===t.client?(u.default.warn("Enforcing single connection pool (min: 1, max: 1) for SQLite client to prevent locking issues."),t.pool={min:1,max:1,acquireTimeoutMillis:9e4},t.pragma&&t.pragma.busy_timeout&&(u.default.warn("Removing busy_timeout pragma as pool size is 1."),delete t.pragma.busy_timeout)):t.pool={min:1,max:10,acquireTimeoutMillis:6e4},t.connection&&"object"==typeof t.connection&&"filename"in t.connection){const e=t.connection.filename,r=l.dirname(e);c.existsSync(r)||(u.default.info(`Creating Database directory: ${r}`),c.mkdirSync(r,{recursive:!0}))}return u.default.info(`Using knex config: ${JSON.stringify(t)}`),t}var y=void 0;t.default=m},9191:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LlmInitializerService=void 0;const s=r(3563),a=r(2776),c=i(r(9055));let l=class{constructor(e){this.appDataSource=e,this.serviceName="LlmInitializerService"}async onModuleInit(){c.default.info(`[${this.serviceName}] Initializing LLM configuration data...`);try{await this.initializeProviders(),await this.initializeModels(),await this.initializeAgentModes(),c.default.info(`[${this.serviceName}] LLM configuration data initialized successfully.`)}catch(e){c.default.error(`[${this.serviceName}] Error initializing LLM configuration data: ${e.message}`,e.stack)}}async initializeProviders(){try{await this.appDataSource.knex("llm_providers").where("provider_id","anthropic").first()?c.default.info(`[${this.serviceName}] Anthropic provider already exists.`):(c.default.info(`[${this.serviceName}] Creating Anthropic provider...`),await this.appDataSource.knex("llm_providers").insert({provider_id:"anthropic",name:"Anthropic",default_model_id:"claude-3-7-sonnet-20250219",requires_api_key:!0,metadata:JSON.stringify({description:"Anthropic Claude models",website:"https://www.anthropic.com"})}),c.default.info(`[${this.serviceName}] Anthropic provider created successfully.`));await this.appDataSource.knex("llm_providers").where("provider_id","gemini").first()?c.default.info(`[${this.serviceName}] Gemini provider already exists.`):(c.default.info(`[${this.serviceName}] Creating Gemini provider...`),await this.appDataSource.knex("llm_providers").insert({provider_id:"gemini",name:"Google Gemini",requires_api_key:!0,metadata:JSON.stringify({description:"Google Gemini models",website:"https://deepmind.google/technologies/gemini/"})}),c.default.info(`[${this.serviceName}] Gemini provider created successfully.`))}catch(e){if(!e.message.includes("UNIQUE constraint failed"))throw c.default.error(`[${this.serviceName}] Error initializing providers: ${e.message}`),e;c.default.info(`[${this.serviceName}] Anthropic provider already exists (concurrent initialization).`)}}async initializeModels(){try{await this.appDataSource.knex("llm_models").where("model_id","claude-3-7-sonnet-20250219").first()?c.default.info(`[${this.serviceName}] Claude 3.7 Sonnet model already exists.`):(c.default.info(`[${this.serviceName}] Creating Claude 3.7 Sonnet model...`),await this.appDataSource.knex("llm_models").insert({model_id:"claude-3-7-sonnet-20250219",provider_id:"anthropic",name:"Claude 3.7 Sonnet",context_window:2e5,max_output_tokens:4096,supports_images:!0,supports_tool_use:!0,supports_computer_use:!0,supports_prompt_cache:!1,supports_thinking_tokens:!0,recommended_thinking_tokens:1024,max_thinking_tokens:4e3,input_cost_per_million_tokens:15,output_cost_per_million_tokens:75,is_default_for_provider:!0,metadata:JSON.stringify({description:"Claude 3.7 Sonnet is a powerful, general-purpose AI assistant that excels at a wide range of tasks from creative content generation to complex reasoning.",release_date:"2025-02-19"})}),c.default.info(`[${this.serviceName}] Claude 3.7 Sonnet model created successfully.`))}catch(e){if(!e.message.includes("UNIQUE constraint failed"))throw c.default.error(`[${this.serviceName}] Error initializing models: ${e.message}`),e;c.default.info(`[${this.serviceName}] Claude 3.7 Sonnet model already exists (concurrent initialization).`)}}async initializeAgentModes(){try{await this.appDataSource.knex("agent_modes").where("mode_id","plan").first()?c.default.info(`[${this.serviceName}] Plan mode already exists.`):(c.default.info(`[${this.serviceName}] Creating plan mode...`),await this.appDataSource.knex("agent_modes").insert({mode_id:"plan",name:"Plan Mode",description:"Mode for planning tasks",default_provider_id:"anthropic",default_model_id:"claude-3-7-sonnet-20250219",default_thinking_tokens:1024,default_api_key_secret_name:"ANTHROPIC_API_KEY"}),c.default.info(`[${this.serviceName}] Plan mode created successfully.`))}catch(e){if(!e.message.includes("UNIQUE constraint failed"))throw c.default.error(`[${this.serviceName}] Error initializing plan mode: ${e.message}`),e;c.default.info(`[${this.serviceName}] Plan mode already exists (concurrent initialization).`)}try{await this.appDataSource.knex("agent_modes").where("mode_id","act").first()?c.default.info(`[${this.serviceName}] Act mode already exists.`):(c.default.info(`[${this.serviceName}] Creating act mode...`),await this.appDataSource.knex("agent_modes").insert({mode_id:"act",name:"Act Mode",description:"Mode for executing tasks",default_provider_id:"anthropic",default_model_id:"claude-3-7-sonnet-20250219",default_thinking_tokens:1024,default_api_key_secret_name:"ANTHROPIC_API_KEY"}),c.default.info(`[${this.serviceName}] Act mode created successfully.`))}catch(e){if(!e.message.includes("UNIQUE constraint failed"))throw c.default.error(`[${this.serviceName}] Error initializing act mode: ${e.message}`),e;c.default.info(`[${this.serviceName}] Act mode already exists (concurrent initialization).`)}}};t.LlmInitializerService=l,t.LlmInitializerService=l=n([(0,s.Injectable)(),o("design:paramtypes",[a.AppDataSource])],l)},9220:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AskFollowupQuestionToolFactory=void 0;const i=r(3563),s=r(1921);let a=class{constructor(){}getToolName(){return"ask_followup_question"}create(e){return new s.AskFollowupQuestionTool}};t.AskFollowupQuestionToolFactory=a,t.AskFollowupQuestionToolFactory=a=n([(0,i.Injectable)(),o("design:paramtypes",[])],a)},9233:e=>{"use strict";e.exports=require("winston-daily-rotate-file")},9234:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.RequestContext=void 0;const a=r(6426),c=s(r(9896)),l=s(r(6928));class d{constructor(e,t,r){this.workspace=e,this.requestId=t,this.sessionId=r,this.toolBaseDir=null}getToolBaseDir(){return null!==this.toolBaseDir?this.toolBaseDir:this.workspace.repoBaseDir}setToolBaseDir(e){this.toolBaseDir=e}portFromSourceTree(){if(this.workspace.portFromBaseDir)return(0,a.generateAdaptiveTree)(this.workspace.portFromBaseDir)}repositoryTree(){return(0,a.generateAdaptiveTree)(this.workspace.repoBaseDir)}repositoryHints(){const e=l.join(this.workspace.repoBaseDir,"hints.md");if(c.existsSync(e))return c.readFileSync(e,"utf-8")}productHints(){const e=l.join(this.workspace.repoBaseDir,"product-hints.md");if(c.existsSync(e))return c.readFileSync(e,"utf-8")}}t.RequestContext=d,d.TREE_SIZE_WARNING_THRESHOLD=1e5},9235:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ListFilesToolFactory=void 0;const i=r(3563),s=r(62),a=r(2141),c=r(4155);let l=class{constructor(e,t){this.fileSystemService=e,this.responseFormatter=t}getToolName(){return"list_files"}create(e){return new s.ListFilesTool(this.fileSystemService,this.responseFormatter,e.workingDir)}};t.ListFilesToolFactory=l,t.ListFilesToolFactory=l=n([(0,i.Injectable)(),o("design:paramtypes",[a.FileSystemService,c.ResponseFormatterService])],l)},9314:e=>{"use strict";e.exports=require("@langchain/langgraph")},9352:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeepSeekProvider=void 0;const n=r(8483),o=r(8959),i=r(2368),s=r(6228);class a extends n.BaseProvider{getName(){return"deepseek"}getBaseChatModel(e,t){return new s.ChatOpenAI({modelName:this.shortModelName(e),temperature:t.temperature,openAIApiKey:i.ConfigService.getInstance().getProperty("DEEPSEEK_API_KEY"),configuration:{baseURL:a.BASE_URL}})}async getModelDescriptors(){return[new o.ModelDescriptor("deepseek",a.DEEPSEEK_CHAT,0,0,0,0),new o.ModelDescriptor("deepseek",a.DEEPSEEK_REASONER,0,0,0,0)]}isValid(){return!!i.ConfigService.getInstance().getProperty("DEEPSEEK_API_KEY")}supportsOnDemandModels(){return!1}}t.DeepSeekProvider=a,a.DEEPSEEK_CHAT="deepseek-chat",a.DEEPSEEK_REASONER="deepseek-reasoner",a.BASE_URL="https://api.deepseek.com/v1"},9361:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleProvider=void 0;const n=r(8483),o=r(8959),i=r(9664),s=r(2368);class a extends n.BaseProvider{getName(){return"google"}getBaseChatModel(e,t){const r=s.ConfigService.getInstance().getProperty("GOOGLE_API_KEY");if(!r)throw new Error("Google API key not found in configuration");const n=s.ConfigService.getInstance().getProperty("GOOGLE_BASE_URL")||"https://generativelanguage.googleapis.com";return new i.ChatGoogleGenerativeAI({model:this.shortModelName(e),maxOutputTokens:65536,apiKey:r,baseUrl:n})}supportsCancellation(){return!0}async getModelDescriptors(){return[new o.ModelDescriptor(this.getName(),a.GEMINI_PRO_EXP_MODEL,0,0,0,0)]}isValid(){return!!s.ConfigService.getInstance().getProperty("GOOGLE_API_KEY")}}t.GoogleProvider=a,a.GEMINI_PRO_EXP_MODEL="gemini-2.5-pro-exp-03-25"},9445:e=>{"use strict";e.exports=require("tree-sitter-go")},9448:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createStreamProcessor=t.createPatternUtils=t.createStateManager=t.createBlockManager=void 0;const n=r(1075);Object.defineProperty(t,"createBlockManager",{enumerable:!0,get:function(){return n.createBlockManager}});const o=r(8191);Object.defineProperty(t,"createStateManager",{enumerable:!0,get:function(){return o.createStateManager}});const i=r(8434);Object.defineProperty(t,"createPatternUtils",{enumerable:!0,get:function(){return i.createPatternUtils}});const s=r(7627);Object.defineProperty(t,"createStreamProcessor",{enumerable:!0,get:function(){return s.createStreamProcessor}})},9449:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.LangchainModule=void 0;const o=r(3563),i=r(1e3);let s=class{};t.LangchainModule=s,t.LangchainModule=s=n([(0,o.Module)({providers:[i.CheckpointerService],exports:[i.CheckpointerService]})],s)},9461:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ListFiles=void 0;const c=r(5534),l=r(1569),d=s(r(9896)),u=s(r(6928)),f=a(r(9055));class p extends c.Tool{constructor(e){super(),this.name="list_files",this.description="List files and directories, showing size, timestamps, and for directories also showing total size and latest update time",this.schema=l.z.object({dirPath:l.z.string().describe("The relative path of the directory to list")}),this.workspaceRootDir=e}async _call(e){const t=this.listFiles(e.dirPath);return"Directory listing for "+e.dirPath+":\n"+JSON.stringify(t,null,2)}getFilePermissions(e){const t=["---","--x","-w-","-wx","r--","r-x","rw-","rwx"];return`${t[e>>6&7]}${t[e>>3&7]}${t[7&e]}`}getDirStats(e){let t=0,r=new Date(0);try{return d.readdirSync(e).forEach((n=>{const o=u.join(e,n),i=d.statSync(o);t+=i.size,i.mtime>r&&(r=i.mtime)})),{totalSize:t,latestUpdate:r.toISOString()}}catch(e){return f.default.error(`Error getting directory stats: ${e.message}`),{totalSize:0,latestUpdate:new Date(0).toISOString()}}}listFiles(e){f.default.info(`ListFiles.listFiles called with: ${e}`);const t=u.join(this.workspaceRootDir,e);try{return d.readdirSync(t).map((e=>{const r=u.join(t,e),n=d.statSync(r),o={name:e,size:n.size,modifiedTime:n.mtime.toISOString(),isDirectory:n.isDirectory(),permissions:this.getFilePermissions(n.mode)};if(n.isDirectory()){const e=this.getDirStats(r);o.totalSize=e.totalSize,o.latestUpdate=e.latestUpdate}return o}))}catch(t){if(f.default.error(`Error listing directory: ${t.message}`),"ENOENT"===t.code)throw new Error(`Directory not found - ${e}`);throw new Error(`Error listing directory: ${t.message}`)}}}t.ListFiles=p},9503:function(e,t,r){"use strict";var n,o=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EveAgentInternalGateway=void 0;const a=r(3563),c=r(461),l=s(r(9055)),d=r(6550),u=r(5444),f=r(1280);let p=n=class{constructor(e,t){this.taskService=e,this.eventEmitter=t,l.default.info(`[${n.name}] Gateway initialized`)}async handleToolExecutionCompleted(e){if(l.default.info(`[${n.name}] Processing ${f.InternalEvents.TOOL_EXECUTION_COMPLETED} for task ${e.taskId}, status: ${e.status}`),"rejected"===e.status)try{await this.taskService.updateTask({taskId:e.taskId,status:u.TaskStatus.WAITING_FOR_INPUT});const t={taskId:e.taskId,clientId:e.clientId,status:u.TaskStatus.WAITING_FOR_INPUT};this.eventEmitter.emit(f.InternalEvents.TASK_UPDATED,t),l.default.info(`[${n.name}] Updated task ${e.taskId} status to WAITING_FOR_INPUT after tool rejection`)}catch(t){l.default.error(`[${n.name}] Error updating task status after tool rejection for task ${e.taskId}: ${t.message}`),this.eventEmitter.emit(f.InternalEvents.AGENT_ERROR_NOTIFICATION,{taskId:e.taskId,clientId:e.clientId,error:`Failed to update task status after tool rejection: ${t.message}`,type:"task_error"})}}async handleGenericInternalError(e){l.default.warn(`[${n.name}] Received ${f.InternalEvents.TOOL_ERROR} for task ${e.taskId}: ${e.error}`)}};t.EveAgentInternalGateway=p,o([(0,c.OnEvent)(f.InternalEvents.TOOL_EXECUTION_COMPLETED),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Promise)],p.prototype,"handleToolExecutionCompleted",null),o([(0,c.OnEvent)(f.InternalEvents.TOOL_ERROR),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Promise)],p.prototype,"handleGenericInternalError",null),t.EveAgentInternalGateway=p=n=o([(0,a.Injectable)(),i("design:paramtypes",[d.TaskService,c.EventEmitter2])],p)},9547:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.retry=s,t.retryApiOperation=a,t.retryWithContextTruncation=async function(e,t,r={}){try{return await a(e,r)}catch(e){if((0,o.toEveAgentError)(e)instanceof o.ContextWindowError){return(r.logger||i.logger).warn("[RetryUtil] Context window exceeded. Truncating conversation history and retrying."),await t()}throw e}};const o=r(9581),i={maxRetries:3,initialDelayMs:1e3,maxDelayMs:3e4,backoffFactor:2,jitter:!0,isRetriable:e=>(0,o.toEveAgentError)(e).retriable,onRetry:()=>{},logger:n(r(9055)).default};async function s(e,t={}){const r={...i,...t};let n,s=0;for(;s<=r.maxRetries;)try{return await e()}catch(e){if(n=e,s++,s>r.maxRetries||!r.isRetriable(e))throw e;let t=r.initialDelayMs*Math.pow(r.backoffFactor,s-1);if(r.jitter){const e=.8+.4*Math.random();t=Math.floor(t*e)}t=Math.min(t,r.maxDelayMs);const i=(0,o.toEveAgentError)(e);i instanceof o.RateLimitError&&i.context?.retryAfterSeconds&&(t=Math.max(t,1e3*i.context.retryAfterSeconds)),r.logger.warn(`[RetryUtil] Retrying operation after error (attempt ${s}/${r.maxRetries}, delay: ${t}ms): ${i.message}`),r.onRetry(e,s,t),await new Promise((e=>setTimeout(e,t)))}throw n}async function a(e,t={}){return s(e,{...t,isRetriable:e=>{const r=(0,o.toEveAgentError)(e);return!(r instanceof o.ContextWindowError)&&(r instanceof o.ApiError?r.retriable:t.isRetriable?t.isRetriable(e):i.isRetriable(e))}})}},9556:e=>{"use strict";e.exports=require("@nestjs/platform-express")},9560:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createBlockManager=function(e){s.default.debug("[AnthropicBlockManager] Creating block manager");const t=()=>(0,o.ulid)();return{openBlock:(r,n="")=>{s.default.debug(`[AnthropicBlockManager] Opening new block with tag: ${r}`);const o=(0,i.mapTagToBlockType)(r),a={type:"block",block:{blockId:t(),blockType:o,..."tool_call"===o&&{tagName:r},status:"generating",content:n}};return s.default.debug(`[AnthropicBlockManager] Created block: ${a.block.blockId} (${o})`),e.setCurrentBlock({id:a.block.blockId,tagName:r,blockType:o,emitted:!0,finished:!1}),a},updateBlock:(e,t)=>(s.default.debug(`[AnthropicBlockManager] Updating block: ${e}`),{type:"blockUpdate",blockId:e,...t}),finishBlock:()=>{const t=e.getCurrentBlock();if(!t||t.finished)return s.default.debug("[AnthropicBlockManager] No active block to finish"),null;s.default.debug(`[AnthropicBlockManager] Finishing block: ${t.id}`),t.finished=!0;const r={type:"blockUpdate",blockId:t.id,newStatus:"finished"};return e.setCurrentBlock(void 0),r},emitImmediateBlock:(e,r)=>{s.default.debug(`[AnthropicBlockManager] Emitting immediate block with tag: ${e}`);const n=(0,i.mapTagToBlockType)(e),o={type:"block",block:{blockId:t(),blockType:n,..."tool_call"===n&&{tagName:e},status:"finished",content:r}};return s.default.debug(`[AnthropicBlockManager] Created immediate block: ${o.block.blockId} (${n})`),o},emitText:r=>{const n=e.getCurrentBlock(),o=[];if(!n){const n=t();let a=r;const c=a.match(/^(\s*)<([A-Za-z_][\w\-.]*)/);if(c){const e=c[1]||"",t=c[2];i.TOOL_CALL_TAGS.includes(t)&&e&&(a=a.substring(e.length),s.default.debug(`[AnthropicBlockManager] Trimmed leading whitespace before tool call tag: "${a.length>20?a.substring(0,20)+"...":a}"`))}else if(""===a.trim())return s.default.debug("[AnthropicBlockManager] Skipping whitespace-only text"),async function*(){}();e.setPendingPrefix(!1);const l=a.match(/^<([A-Za-z_][\w\-.]*)/);if(l){const t=l[1];i.TOOL_CALL_TAGS.includes(t)?(s.default.debug(`[AnthropicBlockManager] Creating new tool_call block for tag ${t} with content: "${a.length>20?a.substring(0,20)+"...":a}"`),o.push({type:"block",block:{blockId:n,blockType:"tool_call",tagName:t,status:"generating",content:a}}),e.setCurrentBlock({id:n,tagName:t,blockType:"tool_call",emitted:!0,finished:!1})):(s.default.debug(`[AnthropicBlockManager] Creating new text block with content: "${a.length>20?a.substring(0,20)+"...":a}"`),o.push({type:"block",block:{blockId:n,blockType:"text",status:"generating",content:a}}),e.setCurrentBlock({id:n,tagName:"text",blockType:"text",emitted:!0,finished:!1}))}else s.default.debug(`[AnthropicBlockManager] Creating new text block with content: "${a.length>20?a.substring(0,20)+"...":a}"`),o.push({type:"block",block:{blockId:n,blockType:"text",status:"generating",content:a}}),e.setCurrentBlock({id:n,tagName:"text",blockType:"text",emitted:!0,finished:!1});return async function*(){for(const e of o)yield e}()}let a=r;if("tool_call"===n.blockType&&!n.finished&&e.isPendingPrefix()){if(new RegExp(`^\\s+<${n.tagName}`).test(a)){const e=a.indexOf("<"+n.tagName);a=a.substring(e),s.default.debug(`[AnthropicBlockManager] Trimmed leading whitespace before tool call tag: "${a.length>20?a.substring(0,20)+"...":a}"`)}}return e.setPendingPrefix(!1),a?(s.default.debug(`[AnthropicBlockManager] Appending to block ${n.id}: "${a.length>20?a.substring(0,20)+"...":a}"`),o.push({type:"blockUpdate",blockId:n.id,appendContent:a}),async function*(){for(const e of o)yield e}()):(s.default.debug("[AnthropicBlockManager] No content left after whitespace handling"),async function*(){}())}}};const o=r(9100),i=r(1685),s=n(r(9055))},9581:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MissingToolParameterError=t.InvalidToolParameterError=t.ToolRejectedError=t.CommandExecutionError=t.PermissionError=t.FileNotFoundError=t.FileSystemError=t.ToolExecutionError=t.RateLimitError=t.ContextWindowError=t.ApiError=t.EveAgentError=void 0,t.toEveAgentError=function(e,t="UNKNOWN_ERROR",s="An unknown error occurred."){if(e instanceof r)return e;const a=e?.message||s,c=e?.code||t,l=e?.context||{};if("context_length_exceeded"===c||a.includes("context window")||a.includes("context length")||a.includes("token limit"))return new o(a,l.provider||"unknown",l);if("rate_limit_exceeded"===c||a.includes("rate limit")||a.includes("too many requests"))return new i(a,l.provider||"unknown",e?.retryAfter,l);if(e?.statusCode||e?.status){const t=e?.statusCode||e?.status;return new n(a,c,t,l,function(e){if(!e)return!1;return 429===e||e>=500&&e<600}(t))}return new r(a,c,l)};class r extends Error{constructor(e,t="UNKNOWN_ERROR",n,o=!1){super(e),this.name=this.constructor.name,this.code=t,this.context=n,this.retriable=o,Object.setPrototypeOf(this,r.prototype)}toUserMessage(){return this.message}toLlmMessage(){return`[Error: ${this.code}] ${this.message}`}toJSON(){return{name:this.name,message:this.message,code:this.code,context:this.context,retriable:this.retriable}}}t.EveAgentError=r;class n extends r{constructor(e,t="API_ERROR",r,o,i=!1){super(e,t,o,i),this.statusCode=r,Object.setPrototypeOf(this,n.prototype)}toJSON(){return{...super.toJSON(),statusCode:this.statusCode}}toUserMessage(){return`API Error: ${this.message}${this.statusCode?` (Status: ${this.statusCode})`:""}`}toLlmMessage(){return`[API Error: ${this.code}${this.statusCode?`, Status: ${this.statusCode}`:""}] ${this.message}`}}t.ApiError=n;class o extends n{constructor(e="The context window has been exceeded.",t="unknown",r){super(e,"CONTEXT_WINDOW_EXCEEDED",413,{...r,provider:t},!0),Object.setPrototypeOf(this,o.prototype)}toUserMessage(){return"The conversation history is too large for the AI model. Some older messages will be automatically removed to continue."}toLlmMessage(){return"[Context Window Exceeded] The conversation history was truncated to fit within the model's context window. Some earlier messages have been removed."}}t.ContextWindowError=o;class i extends n{constructor(e="Rate limit exceeded. Please try again later.",t="unknown",r,n){super(e,"RATE_LIMIT_EXCEEDED",429,{...n,provider:t,retryAfterSeconds:r},!0),Object.setPrototypeOf(this,i.prototype)}toUserMessage(){const e=this.context?.retryAfterSeconds;return e?`Rate limit exceeded. Please try again in ${e} seconds.`:"Rate limit exceeded. Please try again later."}}t.RateLimitError=i;class s extends r{constructor(e,t,r="TOOL_EXECUTION_ERROR",n,o=!1){super(e,r,n,o),this.toolName=t,Object.setPrototypeOf(this,s.prototype)}toJSON(){return{...super.toJSON(),toolName:this.toolName}}toUserMessage(){return`Error executing tool '${this.toolName}': ${this.message}`}toLlmMessage(){return`[Tool Error: ${this.code}, Tool: ${this.toolName}] ${this.message}`}}t.ToolExecutionError=s;class a extends s{constructor(e,t,r,n="FILE_SYSTEM_ERROR",o,i=!1){super(e,t,n,{...o,path:r},i),this.path=r,Object.setPrototypeOf(this,a.prototype)}toJSON(){return{...super.toJSON(),path:this.path}}toUserMessage(){return this.path?`Error with file '${this.path}': ${this.message}`:super.toUserMessage()}toLlmMessage(){return this.path?`[File Error: ${this.code}, Path: ${this.path}] ${this.message}`:super.toLlmMessage()}}t.FileSystemError=a;class c extends a{constructor(e,t,r){super(`File not found: ${e}`,t,e,"FILE_NOT_FOUND",r,!1),Object.setPrototypeOf(this,c.prototype)}}t.FileNotFoundError=c;class l extends a{constructor(e,t,r){super(`Permission denied: ${e}`,t,e,"PERMISSION_DENIED",r,!1),Object.setPrototypeOf(this,l.prototype)}}t.PermissionError=l;class d extends s{constructor(e,t,r,n){super(e,"execute_command","COMMAND_EXECUTION_ERROR",{...n,command:t,exitCode:r},!1),this.command=t,this.exitCode=r,Object.setPrototypeOf(this,d.prototype)}toJSON(){return{...super.toJSON(),command:this.command,exitCode:this.exitCode}}toUserMessage(){return this.command?`Error executing command '${this.command}'${this.exitCode?` (Exit code: ${this.exitCode})`:""}: ${this.message}`:super.toUserMessage()}toLlmMessage(){return this.command?`[Command Error${this.exitCode?`, Exit Code: ${this.exitCode}`:""}] Error executing '${this.command}': ${this.message}`:super.toLlmMessage()}}t.CommandExecutionError=d;class u extends s{constructor(e,t){super("The user denied this operation.",e,"TOOL_REJECTED",t,!1),Object.setPrototypeOf(this,u.prototype)}toLlmMessage(){return`[Tool Rejected] The user denied the use of the '${this.toolName}' tool. Consider an alternative approach or ask for more information.`}}t.ToolRejectedError=u;class f extends s{constructor(e,t,r,n){super(r||`Invalid parameter '${e}' for tool '${t}'.`,t,"INVALID_TOOL_PARAMETER",{...n,paramName:e},!1),this.paramName=e,Object.setPrototypeOf(this,f.prototype)}toJSON(){return{...super.toJSON(),paramName:this.paramName}}toLlmMessage(){return`[Invalid Parameter: ${this.paramName}] ${this.message}`}}t.InvalidToolParameterError=f;class p extends f{constructor(e,t,r){super(e,t,`Missing required parameter '${e}' for tool '${t}'.`,r),Object.setPrototypeOf(this,p.prototype)}}t.MissingToolParameterError=p},9615:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Task=t.TaskStatus=void 0;const n=r(9100);var o;!function(e){e.BACKLOG="backlog",e.IN_PROGRESS="in_progress",e.DONE="done"}(o||(t.TaskStatus=o={}));t.Task=class{constructor(e,t,r=o.BACKLOG,i=(0,n.ulid)(),s=new Date,a=new Date){this.id=i,this.title=e,this.description=t,this.status=r,this.createdAt=s,this.updatedAt=a}}},9664:e=>{"use strict";e.exports=require("@langchain/google-genai")},9668:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserService=t.AuthenticationError=void 0;const d=r(3563),u=r(2368),f=l(r(8938)),p=a(r(857)),h=l(r(9055));class g extends Error{constructor(e,t){super(e),this.cause=t,this.name="AuthenticationError"}}t.AuthenticationError=g;let m=class{constructor(e){this.configService=e,this.userData=null,this.lastAuthCheck=null,this.CACHE_TTL_MS=864e5}async getCurrentUser(){if(h.default.debug("[UserService] Getting current user data"),this.userData&&this.lastAuthCheck&&Date.now()-this.lastAuthCheck.getTime()<this.CACHE_TTL_MS)return h.default.debug(`[UserService] Using cached user data: ${this.userData.email} (ID: ${this.userData.userId})`),this.userData;h.default.debug("[UserService] No valid cached user data, authenticating with API");const e=this.configService.getProperty("EVE_API_KEY");if(!e)throw h.default.error("[UserService] API Key is not configured"),new g("API Key is not configured");if(!this.isValidUUID(e))throw h.default.error("[UserService] Invalid API Key format"),new g("Invalid API Key format");try{const t=p.hostname(),r=await f.default.post("https://otiiwxlfsrejhbrxdras.supabase.co/functions/v1/log-access",{hostname:t},{headers:{Authorization:`Bearer ${e}`},timeout:3e3});if(r.data&&r.data.userId&&r.data.email){const{userId:e,email:t}=r.data;return this.userData={userId:e,email:t},this.lastAuthCheck=new Date,h.default.info(`[UserService] Access granted for user: ${t} (ID: ${e})`),this.userData}throw h.default.error("[UserService] Log access response did not contain expected user data"),new g("Authentication response did not contain expected user data")}catch(e){const t=e;throw t.response?(h.default.error(`[UserService] Authentication failed with status ${t.response.status}`),new g(`Authentication failed with status ${t.response.status}`,e)):t.request?(h.default.error("[UserService] Authentication request failed - no response from server"),new g("Authentication server is unreachable",e)):(h.default.error("[UserService] Authentication request setup failed",e),new g("Authentication request setup failed",e))}}isValidUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}};t.UserService=m,t.UserService=m=s([(0,d.Injectable)(),c("design:paramtypes",[u.ConfigService])],m)},9791:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n(function_declaration\n  name: (identifier) @name.definition.function) @definition.function\n\n(method_definition\n  name: (property_identifier) @name.definition.method) @definition.method\n\n(class_declaration\n  name: (identifier) @name.definition.class) @definition.class\n"},9841:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AttemptCompletionToolFactory=void 0;const i=r(3563),s=r(3060);let a=class{constructor(){}getToolName(){return"attempt_completion"}create(e){return new s.AttemptCompletionTool}};t.AttemptCompletionToolFactory=a,t.AttemptCompletionToolFactory=a=n([(0,i.Injectable)(),o("design:paramtypes",[])],a)},9863:e=>{"use strict";e.exports=require("xpath")},9896:e=>{"use strict";e.exports=require("fs")},9970:e=>{"use strict";e.exports=require("@anthropic-ai/sdk")},9989:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MutationsController=void 0;const s=r(3563),a=r(7602);let c=class{constructor(e){this.mutationsService=e}async getMutationsForSession(e){return this.mutationsService.getMutationsForSession(e)}async getMutation(e){return this.mutationsService.getMutation(e)}};t.MutationsController=c,n([(0,s.Get)("session/:sessionId"),i(0,(0,s.Param)("sessionId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],c.prototype,"getMutationsForSession",null),n([(0,s.Get)(":id"),i(0,(0,s.Param)("id")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],c.prototype,"getMutation",null),t.MutationsController=c=n([(0,s.Controller)("mutations"),o("design:paramtypes",[a.MutationsService])],c)}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(r.exports,r,r.exports,__webpack_require__),r.loaded=!0,r.exports}__webpack_require__.c=__webpack_module_cache__,__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var __webpack_exports__=__webpack_require__(__webpack_require__.s=7201)})();